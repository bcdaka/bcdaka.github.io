<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【C&#43;&#43;】AVL树/红黑树实现及map与set的封装 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f31c0c28651a71a0b94b2751a58cea72/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【C&#43;&#43;】AVL树/红黑树实现及map与set的封装">
  <meta property="og:description" content="前言
【C&#43;&#43;】二叉树进阶（二叉搜索树） 这篇文章讲述了关于二叉搜索树知识，但是二叉搜索树有其自身的缺陷，假如往树中插入的元素有序或者接近有序，二叉搜索树就会退化成单支树，时间复杂度会退化成O(N)，因此map、set等关联式容器的底层结构是对二叉树进行了平衡处理，即采用平衡树来实现，AVL树和红黑树都在不同程度下优化了二叉搜索树。在这篇文章中 【C&#43;&#43;】─篇文章带你熟练掌握 map 与 set 的使用 我们对map与set的使用进行了详细的讲解，那么这篇文章会在实现AVL树的基础上对map与set进行封装。
目录 一、AVL 树1.1 AVL树的概念1.2 AVL树节点的定义1.3 AVL树的插入1.4 AVL树的旋转1.4.1 新节点插入较高左子树的左侧----左左高：右单旋1.4.2 新节点插入较高右子树的右侧----右右高：左单旋1.4.3 新节点插入较高左子树的右侧---左右高：先左单旋再右单旋1.4.4 新节点插入较高右子树的左侧---右左高：先右单旋再左单旋 1.5 AVL树的验证1.6 AVL树的性能1.7 AVL树的整体实现 二、红黑树2.1 红黑树的概念2.2 红黑树的性质2.3 红黑树节点的定义2.4 红黑树的结构2.5 红黑树的插入操作2.6 红黑树的验证2.7 红黑树与AVL树的比较 三、红黑树的模拟实现3.1 红黑树中迭代器的实现3.2 红黑树中clear、size 和 empty 的实现3.3 获得红黑树中的最左/右节点3.4 红黑树中 begin 和 end 的实现3.5 红黑树中 insert 的实现3.6 红黑树中 find 的实现3.7 红黑树的整体实现 四、set 和 map 的封装4.1 set的封装4.2 map的封装 结尾 一、AVL 树 1.1 AVL树的概念 二叉搜索树虽可以缩短查找的效率，但如果数据有序或接近有序二叉搜索树将退化为单支树，查
找元素相当于在顺序表中搜索元素，效率低下。因此，两位俄罗斯的数学家G.M.Adelson-Velskii
和E.M.Landis在1962年发明了一种解决上述问题的方法：当向二叉搜索树中插入新结点后，如果能保证每个结点的左右子树高度之差的绝对值不超过1(需要对树中的结点进行调整)，即可降低树的高度，从而减少平均搜索长度。
一棵AVL树或者是空树，或者是具有以下性质的二叉搜索树：
它或是它的左右子树都是AVL树左右子树的高度差（平衡因子）的绝对值不超过1 如果一棵二叉搜索树是高度平衡的，它就是AVL树。如果它有n个结点，其高度可保持在 O ( l o g 2 n ) O(log_2 n) O(log2​n)，搜索时间复杂度O( l o g 2 n log_2 n log2​n)">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-14T13:00:41+08:00">
    <meta property="article:modified_time" content="2024-06-14T13:00:41+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【C&#43;&#43;】AVL树/红黑树实现及map与set的封装</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/3a/a0/vQw1Upqh_o.gif" alt="在这里插入图片描述"></p> 
<p><strong>前言</strong><br> <a href="http://t.csdnimg.cn/IAofR" rel="nofollow">【C++】二叉树进阶（二叉搜索树）</a> 这篇文章讲述了关于二叉搜索树知识，但是二叉搜索树有其自身的缺陷，假如往树中插入的元素有序或者接近有序，二叉搜索树就会退化成单支树，时间复杂度会退化成O(N)，因此map、set等关联式容器的底层结构是对二叉树进行了平衡处理，即采用平衡树来实现，AVL树和红黑树都在不同程度下优化了二叉搜索树。在这篇文章中 <a href="http://t.csdnimg.cn/gaCeJ" rel="nofollow">【C++】─篇文章带你熟练掌握 map 与 set 的使用</a> 我们对map与set的使用进行了详细的讲解，那么这篇文章会在实现AVL树的基础上对map与set进行封装。</p> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#AVL__9" rel="nofollow">一、AVL 树</a></li><li><ul><li><a href="#11_AVL_10" rel="nofollow">1.1 AVL树的概念</a></li><li><a href="#12_AVL_28" rel="nofollow">1.2 AVL树节点的定义</a></li><li><a href="#13_AVL_57" rel="nofollow">1.3 AVL树的插入</a></li><li><a href="#14_AVL_192" rel="nofollow">1.4 AVL树的旋转</a></li><li><ul><li><a href="#141__194" rel="nofollow">1.4.1 新节点插入较高左子树的左侧----左左高：右单旋</a></li><li><a href="#142__255" rel="nofollow">1.4.2 新节点插入较高右子树的右侧----右右高：左单旋</a></li><li><a href="#143__314" rel="nofollow">1.4.3 新节点插入较高左子树的右侧---左右高：先左单旋再右单旋</a></li><li><a href="#144__367" rel="nofollow">1.4.4 新节点插入较高右子树的左侧---右左高：先右单旋再左单旋</a></li></ul> 
   </li><li><a href="#15_AVL_422" rel="nofollow">1.5 AVL树的验证</a></li><li><a href="#16_AVL_503" rel="nofollow">1.6 AVL树的性能</a></li><li><a href="#17_AVL_508" rel="nofollow">1.7 AVL树的整体实现</a></li></ul> 
  </li><li><a href="#_862" rel="nofollow">二、红黑树</a></li><li><ul><li><a href="#21__863" rel="nofollow">2.1 红黑树的概念</a></li><li><a href="#22__867" rel="nofollow">2.2 红黑树的性质</a></li><li><a href="#23__879" rel="nofollow">2.3 红黑树节点的定义</a></li><li><a href="#24__912" rel="nofollow">2.4 红黑树的结构</a></li><li><a href="#25__919" rel="nofollow">2.5 红黑树的插入操作</a></li><li><a href="#26__1198" rel="nofollow">2.6 红黑树的验证</a></li><li><a href="#27_AVL_1293" rel="nofollow">2.7 红黑树与AVL树的比较</a></li></ul> 
  </li><li><a href="#_1299" rel="nofollow">三、红黑树的模拟实现</a></li><li><ul><li><a href="#31__1300" rel="nofollow">3.1 红黑树中迭代器的实现</a></li><li><a href="#32_clearsize__empty__1412" rel="nofollow">3.2 红黑树中clear、size 和 empty 的实现</a></li><li><a href="#33__1465" rel="nofollow">3.3 获得红黑树中的最左/右节点</a></li><li><a href="#34__begin__end__1505" rel="nofollow">3.4 红黑树中 begin 和 end 的实现</a></li><li><a href="#35__insert__1557" rel="nofollow">3.5 红黑树中 insert 的实现</a></li><li><a href="#36__find__1896" rel="nofollow">3.6 红黑树中 find 的实现</a></li><li><a href="#37__1940" rel="nofollow">3.7 红黑树的整体实现</a></li></ul> 
  </li><li><a href="#set__map__2560" rel="nofollow">四、set 和 map 的封装</a></li><li><ul><li><a href="#41_set_2562" rel="nofollow">4.1 set的封装</a></li><li><a href="#42_map_2660" rel="nofollow">4.2 map的封装</a></li></ul> 
  </li><li><a href="#_2759" rel="nofollow">结尾</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="AVL__9"></a>一、AVL 树</h2> 
<h3><a id="11_AVL_10"></a>1.1 AVL树的概念</h3> 
<p><strong>二叉搜索树虽可以缩短查找的效率，但如果数据有序或接近有序二叉搜索树将退化为单支树，查<br> 找元素相当于在顺序表中搜索元素，效率低下</strong>。因此，两位俄罗斯的数学家G.M.Adelson-Velskii<br> 和E.M.Landis在1962年发明了一种解决上述问题的方法：<strong>当向二叉搜索树中插入新结点后，如果能保证每个结点的左右子树高度之差的绝对值不超过1(需要对树中的结点进行调整)，即可降低树的高度，从而减少平均搜索长度。</strong></p> 
<p>一棵AVL树或者是空树，或者是具有以下性质的二叉搜索树：</p> 
<ul><li>它或是它的左右子树都是AVL树</li><li>左右子树的高度差（平衡因子）的绝对值不超过1</li></ul> 
<p><img src="https://images2.imgbox.com/52/eb/C9rkFY5I_o.png" alt="在这里插入图片描述"></p> 
<p>如果一棵二叉搜索树是高度平衡的，它就是AVL树。如果它有n个结点，其高度可保持在<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         O 
        
       
         ( 
        
       
         l 
        
       
         o 
        
        
        
          g 
         
        
          2 
         
        
       
         n 
        
       
         ) 
        
       
      
        O(log_2 n) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span></span>，搜索时间复杂度O(<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         l 
        
       
         o 
        
        
        
          g 
         
        
          2 
         
        
       
         n 
        
       
      
        log_2 n 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal">n</span></span></span></span></span>)</p> 
<hr> 
<h3><a id="12_AVL_28"></a>1.2 AVL树节点的定义</h3> 
<p>由于AVL树比红黑树稍逊一筹，后面set和map的封装不会使用AVL树，所以这里AVL树将会简单的进行编写。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">AVLTreeNode</span>
<span class="token punctuation">{<!-- --></span>
	AVLTreeNode<span class="token operator">*</span> _left<span class="token punctuation">;</span>
	AVLTreeNode<span class="token operator">*</span> _right<span class="token punctuation">;</span>
	AVLTreeNode<span class="token operator">*</span> _parent<span class="token punctuation">;</span>

	pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span> _kv<span class="token punctuation">;</span>

	<span class="token keyword">int</span> _bf<span class="token punctuation">;</span>  <span class="token comment">// 平衡因子</span>

	<span class="token function">AVLTreeNode</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">_left</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_right</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_parent</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_kv</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_bf</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>

	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h3><a id="13_AVL_57"></a>1.3 AVL树的插入</h3> 
<p>AVL树就是在二叉搜索树的基础上引入了平衡因子，因此AVL树也可以看成是二叉搜索树。那么<br> AVL树的插入过程可以分为两步：</p> 
<ol><li><strong>找到新节点应该插入的位置进行链接(这里写的AVL树不允许插入相同的元素)</strong></li><li><strong>插入新节点后，若出现某棵树的平衡因子异常的情况，则需要进行调整</strong></li></ol> 
<p>这里的左旋、右旋等在下面AVL树的旋转进行讲解</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">AVLTree</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">typedef</span> AVLTreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">bool</span> <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>_root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		Node<span class="token operator">*</span> parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 有相同的K，插入失败</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>


		<span class="token comment">// 插入新节点</span>
		cur <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
			cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> cur<span class="token punctuation">;</span>
			cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 平衡旋转</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> cur<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent<span class="token operator">-&gt;</span>_bf<span class="token operator">--</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				parent<span class="token operator">-&gt;</span>_bf<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// 如果当前树插入新节点后的平衡因子变为0</span>
			<span class="token comment">// 那么说明新插入的节点并没有使当前树的高度增加</span>
			<span class="token comment">// 更不会对当前节点到根节点路径上节点的平衡因子造成影响</span>
			<span class="token comment">// 所以说这里break不需要继续处理</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 当父节点的平衡因子为1/-1时，那么说明这个新插入的节点影响了父节点的高度</span>
			<span class="token comment">// 也有可能影响新插入节点以上节点的平衡因子，向上判断该节点是否影响上面树的平衡性</span>
			<span class="token comment">// 若影响上面树的平衡性，那么需要旋转来平衡树，使其平衡</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> _root<span class="token punctuation">)</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				cur <span class="token operator">=</span> parent<span class="token punctuation">;</span>
				parent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">||</span> parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 右右高，左单旋</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">RotateL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 左左高，右单旋</span>
				<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">RotateR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 右左高，右左双旋，先将当前节点右单旋，再将父亲节点左单旋</span>
				<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">RotateRL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 左右高，左右双旋，先将当前节点左单旋，再将父亲节点右旋单旋</span>
				<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">RotateLR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">assert</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 当父亲节点的平衡因子为其他值时，那么这棵树一定是出现了问题</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token function">assert</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h3><a id="14_AVL_192"></a>1.4 AVL树的旋转</h3> 
<h4><a id="141__194"></a>1.4.1 新节点插入较高左子树的左侧----左左高：右单旋</h4> 
<p>这里无论是在t1还是t2插入一个新节点都是右单旋，只有平衡因子的区别，这里介绍一下再t1的情况。</p> 
<p>t1、t2和t3都是高度为 h（h&gt;=0） 的AVL树，首先在新节点未插入时，节点10的平衡因子为0，节点20的平衡因子为-1，此时所有树都满足AVL树的条件。当在t1上插入一个节点，就导致节点10的平衡因子为-1,节点20的平衡因子为-2，此时节点20为根的这颗数违反了AVL树的规则，需要进行选择调整。</p> 
<p>首先，t2这颗树上的节点都是比20小、比10大的节点，使t2变为节点20的左，再将节点20变为节点10的右，就能够使整体树的高度与之前的一样，但是这里的树可能是一颗完整的树，也有可能是一颗子树，若是子树需要处理好旋转后与上面节点的连接问题，详细的如何连接大家可以看下面代码。</p> 
<p><mark>注意</mark>：当树进行旋转后，树中的某些节点的平衡因子会进行变化，所以大家在旋转后需要对节点的平衡因子做好调整。</p> 
<p><img src="https://images2.imgbox.com/f5/05/YgrGdHQp_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">AVLTree</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">typedef</span> AVLTreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token comment">// 右单旋</span>
	<span class="token keyword">void</span> <span class="token function">RotateR</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> subL <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> subLR <span class="token operator">=</span> subL<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>

		parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subLR<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>subLR<span class="token punctuation">)</span>
			subLR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		Node<span class="token operator">*</span> Pparent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		subL<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		parent<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> subL<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> _root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_root <span class="token operator">=</span> subL<span class="token punctuation">;</span>
			subL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			subL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> Pparent<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>Pparent<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> parent<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Pparent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subL<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				Pparent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subL<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> subL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h4><a id="142__255"></a>1.4.2 新节点插入较高右子树的右侧----右右高：左单旋</h4> 
<p>这里无论是在t2还是t3插入一个新节点都是左单旋，只有平衡因子的区别，这里介绍一下再t3的情况。</p> 
<p>t1、t2和t3都是高度为 h（h&gt;=0） 的AVL树，首先在新节点未插入时，节点20的平衡因子为0，节点10的平衡因子为1，此时所有树都满足AVL树的条件。当在t3上插入一个节点，就导致节点20的平衡因子为1，节点10的平衡因子为2,此时节点20为根的这颗数违反了AVL树的规则，需要进行选择调整。</p> 
<p>首先，t2这颗树上的节点都是比20小、比10大的节点，使t2变为节点10的右，再将节点10变为节点20的左，就能够使整体树的高度与之前的一样，但是这里的树可能是一颗完整的树，也有可能是一颗子树，若是子树需要处理好旋转后与上面节点的连接问题，详细的如何连接大家可以看下面代码。</p> 
<p><mark>注意</mark>：当树进行旋转后，树中的某些节点的平衡因子会进行变化，所以大家在旋转后需要对节点的平衡因子做好调整。<br> <img src="https://images2.imgbox.com/f8/29/wzuDosRp_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">AVLTree</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">typedef</span> AVLTreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token comment">// 左单旋</span>
	<span class="token keyword">void</span> <span class="token function">RotateL</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> subR <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> subRL <span class="token operator">=</span> subR<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>

		parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subRL<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>subRL<span class="token punctuation">)</span>
			subRL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		Node<span class="token operator">*</span> Pparent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		parent<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> subR<span class="token punctuation">;</span>
		subR<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> _root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_root <span class="token operator">=</span> subR<span class="token punctuation">;</span>
			subR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			subR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> Pparent<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>Pparent<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> parent<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Pparent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subR<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				Pparent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subR<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> subR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h4><a id="143__314"></a>1.4.3 新节点插入较高左子树的右侧—左右高：先左单旋再右单旋</h4> 
<p>这里无论是在t2还是t3插入一个新节点都是左右双旋，只有平衡因子的区别，所以这里只画了在插入t3插入的这种情况，插入t2的情况，大家可以自己下来试试。</p> 
<p>t1、t4是高度为 h 的AVL树，t2和t3都是高度为 h-1（h&gt;=1） 的AVL树，首先在新节点未插入时，节点20的平衡因子为0，节点10的平衡因子为0，节点30的平衡因子为-1，此时所有树都满足AVL树的条件。当在t3上插入一个节点，就导致节点20的平衡因子为1，节点10的平衡因子为1，节点30的平衡因子为-2,此时节点30为根的这颗数违反了AVL树的规则，需要进行旋转调整。</p> 
<p>当我们知道这里需要进行旋转调整，但是只有一边高的时候能够使用单旋，而这里是两边高，那么这里就将将这棵树处理为一边高就可以使用单旋了。</p> 
<p>看下图，首先这里对节点10这棵树使用左单旋就可以使节点30的这棵树变为只有左左高，再对节点30这棵树进行右单旋，这么做能够使整体树的高度与之前的一样，但是这里的树可能是一颗完整的树，也有可能是一颗子树，若是子树需要处理好旋转后与上面节点的连接问题，详细的如何连接大家可以看下面代码。</p> 
<p><mark>注意</mark>：当树进行旋转后，树中的某些节点的平衡因子会进行变化，所以大家在旋转后需要对节点的平衡因子做好调整。<br> <img src="https://images2.imgbox.com/d0/53/i40kfwDX_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">AVLTree</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">typedef</span> AVLTreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token comment">// 左右双旋</span>
	<span class="token keyword">void</span> <span class="token function">RotateLR</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> subL <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> subLR <span class="token operator">=</span> subL<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		<span class="token keyword">int</span> bf <span class="token operator">=</span> subLR<span class="token operator">-&gt;</span>_bf<span class="token punctuation">;</span>

		<span class="token function">RotateL</span><span class="token punctuation">(</span>subL<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">RotateR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> subL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> subLR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			subL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			subLR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			subL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
			parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			subLR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h4><a id="144__367"></a>1.4.4 新节点插入较高右子树的左侧—右左高：先右单旋再左单旋</h4> 
<p>这里无论是在t2还是t3插入一个新节点都是右左双旋，只有平衡因子的区别，所以这里只画了在插入t3插入的这种情况，插入t2的情况，大家可以自己下来试试。</p> 
<p>t1、t4是高度为 h 的AVL树，t2和t3都是高度为 h-1（h&gt;=1） 的AVL树，首先在新节点未插入时，节点20的平衡因子为0，节点30的平衡因子为0，节点10的平衡因子为1，此时所有树都满足AVL树的条件。当在t3上插入一个节点，就导致节点20的平衡因子为1，节点30的平衡因子为-1,节点10的平衡因子为2,此时节点30为根的这颗数违反了AVL树的规则，需要进行旋转调整。</p> 
<p>当我们知道这里需要进行旋转调整，但是只有一边高的时候能够使用单旋，而这里是两边高，那么这里就将将这棵树处理为一边高就可以使用单旋了。</p> 
<p>看下图，首先这里对节点20这棵树使用右单旋就可以使节点10的这棵树变为只有右右高，再对节点10这棵树进行左单旋，这么做能够使整体树的高度与之前的一样，但是这里的树可能是一颗完整的树，也有可能是一颗子树，若是子树需要处理好旋转后与上面节点的连接问题，详细的如何连接大家可以看下面代码。</p> 
<p><mark>注意</mark>：当树进行旋转后，树中的某些节点的平衡因子会进行变化，所以大家在旋转后需要对节点的平衡因子做好调整。<br> <img src="https://images2.imgbox.com/14/2e/nYBviT6l_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">AVLTree</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">typedef</span> AVLTreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token comment">// 右左双旋</span>
	<span class="token keyword">void</span> <span class="token function">RotateRL</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> subR <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> subRL <span class="token operator">=</span> subR<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token keyword">int</span> bf <span class="token operator">=</span> subRL<span class="token operator">-&gt;</span>_bf<span class="token punctuation">;</span>

		<span class="token function">RotateR</span><span class="token punctuation">(</span>subR<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">RotateL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> subR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> subRL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			subRL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			subR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			subRL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
			subR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h3><a id="15_AVL_422"></a>1.5 AVL树的验证</h3> 
<p>AVL树是在二叉搜索树的基础上加入了平衡性的限制，因此要验证AVL树，可以分两步：</p> 
<ol><li><strong>验证其为二叉搜索树</strong><br> 如果中序遍历可得到一个有序的序列，就说明为二叉搜索树</li><li><strong>验证其为平衡树</strong><br> (a) 每个节点子树高度差的绝对值不超过1(注意节点中如果没有平衡因子)<br> (b) 节点的平衡因子是否计算正确</li></ol> 
<p>在下面函数的实现中，大家可以发现都嵌套了一个函数，由于函数按照递归实现的，而递归的实现是需要根节点的，封装外是无法访问的根节点的，但是封装内是可以直接访问根节点的，所以嵌套了一层。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">AVLTree</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">typedef</span> AVLTreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token comment">// 中序变量</span>
	<span class="token keyword">void</span> <span class="token function">InOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">_InOrder</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 判断是否为AVL树</span>
	<span class="token keyword">bool</span> <span class="token function">IsBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">_IsBalance</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 计算树的高度</span>
	<span class="token keyword">int</span> <span class="token function">Height</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">_Height</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">bool</span> <span class="token function">_IsBalance</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

		<span class="token keyword">bool</span> left <span class="token operator">=</span> <span class="token function">_IsBalance</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>left<span class="token punctuation">)</span> <span class="token keyword">return</span> left<span class="token punctuation">;</span>

		<span class="token keyword">bool</span> right <span class="token operator">=</span> <span class="token function">_IsBalance</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>right<span class="token punctuation">)</span> <span class="token keyword">return</span> right<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span> <span class="token operator">!=</span> root<span class="token operator">-&gt;</span>_bf<span class="token punctuation">)</span>
			cout <span class="token operator">&lt;&lt;</span> root<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> <span class="token string">":"</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"平衡因子异常"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

		<span class="token keyword">return</span> left <span class="token operator">&amp;&amp;</span> right <span class="token operator">&amp;&amp;</span>
			<span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">int</span> <span class="token function">_Height</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

		<span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> right <span class="token operator">=</span> <span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span>  left <span class="token operator">&gt;</span> right <span class="token operator">?</span> left <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> right <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">_InOrder</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>

		<span class="token function">_InOrder</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>

		cout <span class="token operator">&lt;&lt;</span> root<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token function">_InOrder</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h3><a id="16_AVL_503"></a>1.6 AVL树的性能</h3> 
<p>AVL树是一棵绝对平衡的二叉搜索树，其要求每个节点的左右子树高度差的绝对值都不超过1，这样可以保证查询时高效的时间复杂度，即<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         l 
        
       
         o 
        
        
        
          g 
         
        
          2 
         
        
       
         ( 
        
       
         N 
        
       
         ) 
        
       
      
        log_2 (N) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.109em;">N</span><span class="mclose">)</span></span></span></span></span>。但是如果要对AVL树做一些结构修改的操作，性能非常低下，比如：插入时要维护其绝对平衡，旋转的次数比较多，更差的是在删除时，有可能一直要让旋转持续到根的位置。因此：如果需要一种查询高效且有序的数据结构，而且数据的个数为静态的(即不会改变)，可以考虑AVL树，但一个结构经常修改，就不太适合。</p> 
<hr> 
<h3><a id="17_AVL_508"></a>1.7 AVL树的整体实现</h3> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assert.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">AVLTreeNode</span>
<span class="token punctuation">{<!-- --></span>
	AVLTreeNode<span class="token operator">*</span> _left<span class="token punctuation">;</span>
	AVLTreeNode<span class="token operator">*</span> _right<span class="token punctuation">;</span>
	AVLTreeNode<span class="token operator">*</span> _parent<span class="token punctuation">;</span>

	pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span> _kv<span class="token punctuation">;</span>

	<span class="token keyword">int</span> _bf<span class="token punctuation">;</span>  <span class="token comment">// 平衡因子</span>

	<span class="token function">AVLTreeNode</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">_left</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_right</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_parent</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_kv</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_bf</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">AVLTree</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">typedef</span> AVLTreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">bool</span> <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>_root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		Node<span class="token operator">*</span> parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 有相同的K，插入失败</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 插入新节点</span>
		cur <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
			cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> cur<span class="token punctuation">;</span>
			cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 平衡旋转</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> cur<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent<span class="token operator">-&gt;</span>_bf<span class="token operator">--</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				parent<span class="token operator">-&gt;</span>_bf<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// 如果当前树插入新节点后的平衡因子变为0</span>
			<span class="token comment">// 那么说明新插入的节点并没有使当前树的高度增加</span>
			<span class="token comment">// 更不会对当前节点到根节点路径上节点的平衡因子造成影响</span>
			<span class="token comment">// 所以说这里break不需要继续处理</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 当父节点的平衡因子为1/-1时，那么说明这个新插入的节点影响了父节点的高度</span>
			<span class="token comment">// 也有可能影响新插入节点以上节点的平衡因子，向上判断该节点是否影响上面树的平衡性</span>
			<span class="token comment">// 若影响上面树的平衡性，那么需要旋转来平衡树，使其平衡</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">||</span> parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> _root<span class="token punctuation">)</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				cur <span class="token operator">=</span> parent<span class="token punctuation">;</span>
				parent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">||</span> parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 右右高，左单旋</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">RotateL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 左左高，右单旋</span>
				<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">RotateR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 右左高，右左双旋，先将当前节点右单旋，再将父亲节点左单旋</span>
				<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">RotateRL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 左右高，左右双旋，先将当前节点左单旋，再将父亲节点右旋单旋</span>
				<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">RotateLR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">assert</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 当父亲节点的平衡因子为其他值时，那么这棵树一定是出现了问题</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token function">assert</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">InOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">_InOrder</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">_InOrder</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>

		<span class="token function">_InOrder</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>

		cout <span class="token operator">&lt;&lt;</span> root<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token function">_InOrder</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

	<span class="token keyword">bool</span> <span class="token function">IsBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">_IsBalance</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	size_t <span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">_Size</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">int</span> <span class="token function">Height</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">_Height</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">bool</span> <span class="token function">_IsBalance</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

		<span class="token keyword">bool</span> left <span class="token operator">=</span> <span class="token function">_IsBalance</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>left<span class="token punctuation">)</span> <span class="token keyword">return</span> left<span class="token punctuation">;</span>

		<span class="token keyword">bool</span> right <span class="token operator">=</span> <span class="token function">_IsBalance</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>right<span class="token punctuation">)</span> <span class="token keyword">return</span> right<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span> <span class="token operator">!=</span> root<span class="token operator">-&gt;</span>_bf<span class="token punctuation">)</span>
			cout <span class="token operator">&lt;&lt;</span> root<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> <span class="token string">":"</span> <span class="token operator">&lt;&lt;</span> <span class="token string">"平衡因子异常"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

		<span class="token keyword">return</span> left <span class="token operator">&amp;&amp;</span> right <span class="token operator">&amp;&amp;</span>
			<span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	size_t <span class="token function">_Size</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> <span class="token function">_Size</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">_Size</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token keyword">int</span> <span class="token function">_Height</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

		<span class="token keyword">int</span> left <span class="token operator">=</span> <span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> right <span class="token operator">=</span> <span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span>  left <span class="token operator">&gt;</span> right <span class="token operator">?</span> left <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> right <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 右单旋</span>
	<span class="token keyword">void</span> <span class="token function">RotateR</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> subL <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> subLR <span class="token operator">=</span> subL<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>

		parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subLR<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>subLR<span class="token punctuation">)</span>
			subLR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		Node<span class="token operator">*</span> Pparent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		subL<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		parent<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> subL<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> _root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_root <span class="token operator">=</span> subL<span class="token punctuation">;</span>
			subL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			subL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> Pparent<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>Pparent<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> parent<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Pparent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subL<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				Pparent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subL<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> subL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 左单旋</span>
	<span class="token keyword">void</span> <span class="token function">RotateL</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> subR <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> subRL <span class="token operator">=</span> subR<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>

		parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subRL<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>subRL<span class="token punctuation">)</span>
			subRL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		Node<span class="token operator">*</span> Pparent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		parent<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> subR<span class="token punctuation">;</span>
		subR<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> _root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_root <span class="token operator">=</span> subR<span class="token punctuation">;</span>
			subR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			subR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> Pparent<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>Pparent<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> parent<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Pparent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subR<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				Pparent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subR<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> subR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 左右双旋</span>
	<span class="token keyword">void</span> <span class="token function">RotateLR</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> subL <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> subLR <span class="token operator">=</span> subL<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		<span class="token keyword">int</span> bf <span class="token operator">=</span> subLR<span class="token operator">-&gt;</span>_bf<span class="token punctuation">;</span>

		<span class="token function">RotateL</span><span class="token punctuation">(</span>subL<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">RotateR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> subL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> subLR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			subL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			subLR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			subL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
			parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			subLR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 右左双旋</span>
	<span class="token keyword">void</span> <span class="token function">RotateRL</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> subR <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> subRL <span class="token operator">=</span> subR<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token keyword">int</span> bf <span class="token operator">=</span> subRL<span class="token operator">-&gt;</span>_bf<span class="token punctuation">;</span>

		<span class="token function">RotateR</span><span class="token punctuation">(</span>subR<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">RotateL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> subR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> subRL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			subRL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			subR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>bf <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			subRL<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			parent<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
			subR<span class="token operator">-&gt;</span>_bf <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> 
<hr> 
<h2><a id="_862"></a>二、红黑树</h2> 
<h3><a id="21__863"></a>2.1 红黑树的概念</h3> 
<p><strong>红黑树，是一种二叉搜索树</strong>，但在<strong>每个结点上增加一个存储位表示结点的颜色，可以是Red或Black</strong>。 通过对任何一条从根到叶子的路径上各个结点着色方式的限制，<strong>红黑树确保没有一条路径会比其他路径长出俩倍</strong>，因而是接近平衡的。</p> 
<hr> 
<h3><a id="22__867"></a>2.2 红黑树的性质</h3> 
<ol><li><strong>红黑树中的根节点必定为黑色节点</strong></li><li><strong>红黑树上的节点不是黑色节点就是红色节点</strong></li><li><strong>红黑树中可以存在连续黑色节点，但是不能出现连续红色节点</strong></li><li><strong>红黑树中的每一条路径上的黑色节点的数目相同</strong></li></ol> 
<p><strong>思考：为什么满足上面的性质，红黑树就能保证：其最长路径中节点个数不会超过最短路径节点个数的两倍？</strong></p> 
<p><mark>解答</mark>：由于红黑树中的所有路径上的黑色节点数目相同，红黑树中又不能出现连续的红色节点，所以红色节点插入在黑色节点之间或是黑色节点的后面。最短路径的一定是路径上的所有节点都为黑色节点，最长路径一定是在最短路径的基础上，每两个黑色节点中插入一个红色节点，再在最后一个黑色节点后面插入一个红色节点，所以最长路径的节点个数不会超过最短路径的两倍。</p> 
<hr> 
<h3><a id="23__879"></a>2.3 红黑树节点的定义</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">enum</span> <span class="token class-name">Color</span>
<span class="token punctuation">{<!-- --></span>
	RED<span class="token punctuation">,</span>
	BLACK
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">RBTreeNode</span>
<span class="token punctuation">{<!-- --></span>
	RBTreeNode<span class="token operator">*</span> _left<span class="token punctuation">;</span>
	RBTreeNode<span class="token operator">*</span> _right<span class="token punctuation">;</span>
	RBTreeNode<span class="token operator">*</span> _parent<span class="token punctuation">;</span>
	T _date<span class="token punctuation">;</span>
	Color _col<span class="token punctuation">;</span>

	<span class="token function">RBTreeNode</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> date<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">_right</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>   <span class="token comment">// 节点的右孩子</span>
		<span class="token punctuation">,</span> <span class="token function">_left</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>    <span class="token comment">// 节点的左孩子</span>
		<span class="token punctuation">,</span> <span class="token function">_parent</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>  <span class="token comment">// 节点的父亲</span>
		<span class="token punctuation">,</span> <span class="token function">_col</span><span class="token punctuation">(</span>RED<span class="token punctuation">)</span>         <span class="token comment">// 节点的颜色</span>
		<span class="token punctuation">,</span> <span class="token function">_date</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span>       <span class="token comment">// 节点存储的内容</span>
		<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>思考：在节点的定义中，为什么要将节点的默认颜色给成红色的？</strong></p> 
<p><mark>解答</mark>：<strong>由于红黑树上每条路径上的黑色节点的数量是相同的</strong>，插入一个节点而节点的颜色是黑色，就会导致插入黑色节点的那个路径上的黑色节点的数量比其他路径上的黑色节点数量多上一个，那么这颗树就会出现问题。而插入节点的颜色为红色，可以出现问题，就算出现问题最多就是出现连续的两个红色节点，可以通过变色、旋转来解决连续红色节点的问题，操作起来更加的简单。</p> 
<hr> 
<h3><a id="24__912"></a>2.4 红黑树的结构</h3> 
<p><img src="https://images2.imgbox.com/5e/62/yAzQiItQ_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h3><a id="25__919"></a>2.5 红黑树的插入操作</h3> 
<p>红黑树是在二叉搜索树的基础上加上其平衡限制条件，因此红黑树的插入可分为两步：</p> 
<ol><li><strong>按照二叉搜索的树规则插入新节点</strong></li><li><strong>检测新节点插入后，红黑树的性质是否造到破坏</strong><br> 因为<strong>新节点的默认颜色是红色</strong>，因此：<strong>如果其双亲节点的颜色是黑色，没有违反红黑树任何性质</strong>，则不需要调整；但<strong>当新插入节点的双亲节点颜色为红色时，就违反了性质三不能有连在一起的红色节点</strong>，此时需要对红黑树分情况来讨论：</li></ol> 
<p><mark><strong>约定:c为当前节点，p为父节点，g为祖父节点，u为叔叔节点</strong></mark></p> 
<hr> 
<pre><code>情况一: c为红，p为红，g为黑，u存在且为红
</code></pre> 
<p><img src="https://images2.imgbox.com/1b/a9/4tWWGoym_o.png" alt="在这里插入图片描述"></p> 
<p><mark>问题</mark>：c和p均为红，违反了性质三，此处能否将p直接改为黑？<br> <mark>解答</mark>：不可以，将p直接改为黑色，会使含有p节点的路径多一个黑色节点，<strong>违反了每条路径有相同黑色节点数量的原则</strong>。</p> 
<p><strong><mark>解决方式</mark>：将p,u改为黑，g改为红，然后把g当成c，继续向上调整。</strong></p> 
<hr> 
<pre><code>情况二: c为红，p为红，g为黑，u不存在/u存在且为黑
</code></pre> 
<p>说明:u的情况有两种</p> 
<ol><li><strong>如果u节点不存在，则c一定是新插入节点，因为如果c不是新插入节点，则c和p一定有一个节点的颜色是黑色，就不满足性质4:每条路径黑色节点个数相同。</strong></li><li><strong>如果u节点存在，则其一定是黑色的，那么c节点原来的颜色一定是黑色的，现在看到其是红色的原因是因为c的子树在调整的过程中将c节点的颜色由黑色改成红色。</strong></li></ol> 
<p><img src="https://images2.imgbox.com/18/a5/oTj9wnb2_o.png" alt="在这里插入图片描述"></p> 
<p><strong>p为g的左孩子，c为p的左孩子，则进行右单旋转；相反，<br> p为g的右孩子，c为p的右孩子，则进行左单旋转<br> p、g变色–p变黑，g变红</strong></p> 
<hr> 
<pre><code>情况三: c为红，p为红，g为黑，u不存在/u存在且为黑
</code></pre> 
<p><img src="https://images2.imgbox.com/80/d0/oMTxd7g7_o.png" alt="在这里插入图片描述"></p> 
<p><strong>p为g的左孩子，c为p的右孩子，则针对p做左单旋转，变为情况二，再进行一次右单旋；<br> p为g的右孩子，c为p的左孩子，则针对p做右单旋转，变为情况二，再进行一次左单旋。</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">RBTree</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>

	<span class="token comment">// 在红黑树中插入值为data的节点，插入成功返回true，否则返回false</span>
	<span class="token comment">// 注意：为了简单起见，本次实现红黑树不存储重复性元素</span>
	pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> date<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">==</span> _root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
			_root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token function">iterator</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		KofT koft<span class="token punctuation">;</span>

		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">koft</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_date<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">koft</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">koft</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_date<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">koft</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> 
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token function">iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 插入新节点</span>
		cur <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 由于后面cur可能会随着旋转而改变</span>
		<span class="token comment">// 这里定义一个newNode记录一下</span>
		Node<span class="token operator">*</span> newNode <span class="token operator">=</span> cur<span class="token punctuation">;</span>

		cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">koft</span><span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_date<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">koft</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> cur<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 有向上处理的情况，可能存在parent不存在的情况</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> grandfather <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
			<span class="token comment">//        g</span>
			<span class="token comment">//		p   u</span>
			<span class="token comment">//   c</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
				<span class="token comment">// 叔叔存在且叔叔的颜色为红色</span>
				<span class="token comment">// 变色完后子树的根节点为红色，并且该节点的父亲节点的颜色可能为红色</span>
				<span class="token comment">// 需要向上调整</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

					cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
					parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 叔叔存在且叔叔的颜色为黑色 || 叔叔不存在</span>
				<span class="token comment">// 旋转完后子树的根节点为黑色不需要向上调整</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token comment">// 左左 则 右旋</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>

						parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 左右 则 左右双旋</span>
					<span class="token keyword">else</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token function">RotateL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>

						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
						cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			
			<span class="token comment">// (parent == grandfather-&gt;_right)</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token comment">//        g</span>
				<span class="token comment">//	    u   p</span>
				<span class="token comment">//			  c</span>
				Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
				<span class="token comment">// 叔叔存在且为红色</span>
				<span class="token comment">// 叔叔和父亲变为黑色，祖父变为红色</span>
				<span class="token comment">// 由于祖父的父亲可能为红色，继续向上处理</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

					cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
					parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 叔叔不存在或叔叔存在且为黑色色</span>
				<span class="token comment">// 旋转处理，旋转后父亲变黑，祖父变红</span>
				<span class="token comment">// 子树的根节点为黑色不需要继续处理</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token comment">//        g</span>
					<span class="token comment">//	    u   p</span>
					<span class="token comment">//			  c</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>

						parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">//         g</span>
					<span class="token comment">//	    u     p</span>
					<span class="token comment">//		    c</span>
					<span class="token keyword">else</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token function">RotateR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>

						cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				
			<span class="token punctuation">}</span>
			<span class="token comment">// 将根节点变为黑色</span>
		<span class="token punctuation">}</span>
		_root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token function">iterator</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token comment">// 右单旋</span>
	<span class="token keyword">void</span> <span class="token function">RotateR</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> subL <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> subLR <span class="token operator">=</span> subL<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>

		parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subLR<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>subLR<span class="token punctuation">)</span>
			subLR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		Node<span class="token operator">*</span> Pparent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		subL<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		parent<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> subL<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> _root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_root <span class="token operator">=</span> subL<span class="token punctuation">;</span>
			subL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			subL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> Pparent<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>Pparent<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> parent<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Pparent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subL<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				Pparent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subL<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 左单旋</span>
	<span class="token keyword">void</span> <span class="token function">RotateL</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> subR <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> subRL <span class="token operator">=</span> subR<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>

		parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subRL<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>subRL<span class="token punctuation">)</span>
			subRL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		Node<span class="token operator">*</span> Pparent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		parent<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> subR<span class="token punctuation">;</span>
		subR<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> _root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_root <span class="token operator">=</span> subR<span class="token punctuation">;</span>
			subR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			subR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> Pparent<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>Pparent<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> parent<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Pparent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subR<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				Pparent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subR<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	size_t _size<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h3><a id="26__1198"></a>2.6 红黑树的验证</h3> 
<p>红黑树的检测分为两步：</p> 
<ol><li>检测其是否满足二叉搜索树(中序遍历是否为有序序列)</li><li>检测其是否满足红黑树的性质</li></ol> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KofT</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">RBTree</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>

	<span class="token comment">// 检测红黑树是否为有效的红黑树，注意：其内部主要依靠_IsValidRBTRee函数检测</span>
	<span class="token keyword">bool</span> <span class="token function">IsValidRBTRee</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">==</span> _root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>_root<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">int</span> blackCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> BLACK<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				blackCount<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token function">_IsValidRBTRee</span><span class="token punctuation">(</span>_root<span class="token punctuation">,</span> blackCount<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 中序遍历</span>
	<span class="token keyword">void</span> <span class="token function">InOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">_InOrder</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">_InOrder</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> pRoot<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pRoot <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token function">_InOrder</span><span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> pRoot<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> <span class="token char">':'</span> <span class="token operator">&lt;&lt;</span>
			pRoot<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>second <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token function">_InOrder</span><span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">bool</span> <span class="token function">_IsValidRBTRee</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> pRoot<span class="token punctuation">,</span> size_t blackCount<span class="token punctuation">,</span> size_t pathBlack<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 判断是否每条路径黑色节点是否相同</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">==</span> pRoot<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>blackCount <span class="token operator">!=</span> pathBlack<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cout <span class="token operator">&lt;&lt;</span> <span class="token string">"有路径黑色节点不相同"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> BLACK<span class="token punctuation">)</span>
			pathBlack<span class="token operator">++</span><span class="token punctuation">;</span>

		<span class="token comment">// 判断是否出现连续红色节点</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED <span class="token operator">&amp;&amp;</span> pRoot<span class="token operator">-&gt;</span>_parent<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cout <span class="token operator">&lt;&lt;</span> <span class="token string">"有连续红色节点"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token function">_IsValidRBTRee</span><span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_left<span class="token punctuation">,</span> blackCount<span class="token punctuation">,</span> pathBlack<span class="token punctuation">)</span>
			<span class="token operator">&amp;&amp;</span> <span class="token function">_IsValidRBTRee</span><span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_right<span class="token punctuation">,</span> blackCount<span class="token punctuation">,</span> pathBlack<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	size_t _size<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h3><a id="27_AVL_1293"></a>2.7 红黑树与AVL树的比较</h3> 
<p><strong>红黑树和AVL树都是高效的平衡二叉树，增删改查的时间复杂度都是O(<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          l 
         
        
          o 
         
         
         
           g 
          
         
           2 
          
         
        
          N 
         
        
       
         log_2 N 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right: 0.109em;">N</span></span></span></span></span>)，红黑树不追求绝对平衡，其只需保证最长路径不超过最短路径的2倍，相对而言，降低了插入和旋转的次数，所以在经常进行增删的结构中性能比AVL树更优，而且红黑树实现比较简单，所以实际运用中红黑树更多。</strong></p> 
<hr> 
<h2><a id="_1299"></a>三、红黑树的模拟实现</h2> 
<h3><a id="31__1300"></a>3.1 红黑树中迭代器的实现</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Ref</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Ptr</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">__TreeIterator</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> __TreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Ref<span class="token punctuation">,</span> Ptr<span class="token operator">&gt;</span> Self<span class="token punctuation">;</span>

	<span class="token function">__TreeIterator</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> node<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_node</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

	Ref <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> _node<span class="token operator">-&gt;</span>_date<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	Ptr <span class="token keyword">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token operator">&amp;</span>_node<span class="token operator">-&gt;</span>_date<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> Self<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> _node <span class="token operator">==</span> s<span class="token punctuation">.</span>_node<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Self<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> _node <span class="token operator">!=</span> s<span class="token punctuation">.</span>_node<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 左子树 根 右子树</span>
	<span class="token comment">// 若当前节点的右树不为空，则指向当前节点的最右节点</span>
	<span class="token comment">// 若当前节点右树为空，则沿着这条路径向上查找</span>
	<span class="token comment">// 找到孩子是父亲左的祖先，使迭代器指向这个祖先</span>
	Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>_node<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">!=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 指向右树</span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token comment">// 指向右树最左节点</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			_node <span class="token operator">=</span> cur<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>

			<span class="token comment">// cur为根节点时，parent为空</span>
			<span class="token comment">// 所以这里要判断parent是否为空</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> parent<span class="token punctuation">;</span>
				parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 找到了cur是parent左</span>

			_node <span class="token operator">=</span> parent<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 右子树 根 左子树</span>
	<span class="token comment">// 若当前节点的左子树不为空，则找到左子树的最右节点</span>
	<span class="token comment">// 若当前节点的左子树为空，则沿着这条路径向上查找</span>
	<span class="token comment">// 找到孩子是父亲的右的祖先节点，使迭代器指向这个节点</span>
	Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _node<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">!=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>

			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			_node <span class="token operator">=</span> cur<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>parent<span class="token punctuation">;</span>

			<span class="token comment">// cur为根节点时，parent为空</span>
			<span class="token comment">// 所以这里要判断parent是否为空</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> parent<span class="token punctuation">;</span>
				parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			_node <span class="token operator">=</span> parent<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	Node<span class="token operator">*</span> _node<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h3><a id="32_clearsize__empty__1412"></a>3.2 红黑树中clear、size 和 empty 的实现</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KofT</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">RBTree</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>

	<span class="token keyword">bool</span> <span class="token function">Empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> _root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">_Clear</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	size_t <span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> _size<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	size_t <span class="token function">_Size</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> pRoot<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pRoot <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token function">_Size</span><span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span> <span class="token operator">+</span>
			<span class="token function">_Size</span><span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">_Clear</span><span class="token punctuation">(</span>Node<span class="token operator">*</span><span class="token operator">&amp;</span> pRoot<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pRoot <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>

		<span class="token function">_Clear</span><span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">_Clear</span><span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">delete</span> pRoot<span class="token punctuation">;</span>
		pRoot <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	size_t _size<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> 
<hr> 
<h3><a id="33__1465"></a>3.3 获得红黑树中的最左/右节点</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KofT</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">RBTree</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
	<span class="token comment">// 获取红黑树最左侧节点</span>
	Node<span class="token operator">*</span> <span class="token function">LeftMost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> cur<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 获取红黑树最右侧节点</span>
	Node<span class="token operator">*</span> <span class="token function">RightMost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> cur<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	size_t _size<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h3><a id="34__begin__end__1505"></a>3.4 红黑树中 begin 和 end 的实现</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KofT</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">RBTree</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> __TreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> iterator<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> __TreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> const_iterator<span class="token punctuation">;</span>

	iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>

		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	const_iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>

		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token function">const_iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	const_iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">const_iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	size_t _size<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h3><a id="35__insert__1557"></a>3.5 红黑树中 insert 的实现</h3> 
<p>这里类模版参数中的<code>KofT</code>是为了后面set和map封装，由于插入节点时需要有元素的比较，set是直接使用<code>K</code>直接进行比较，而map是取<code>pair&lt;K,V&gt;</code>中的<code>K</code>，那么两种对象比较方式不同，而将insert写两遍不方便，那么换一个思路，那么就写一个仿函数，可以让set取到<code>K</code>，map取到<code>pair&lt;K,V&gt;</code>中的<code>K</code>，而这个仿函数在封装set和map中写到，并在创建对象时将仿函数传给<code>KofT</code>。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KofT</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">RBTree</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> __TreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> iterator<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> __TreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> const_iterator<span class="token punctuation">;</span>

	<span class="token comment">// 在红黑树中插入值为data的节点，插入成功返回true，否则返回false</span>
	<span class="token comment">// 注意：为了简单起见，本次实现红黑树不存储重复性元素</span>

	<span class="token comment">// 这里pair的返回值应该是pair&lt;iterator,bool&gt;</span>
	<span class="token comment">// 但是由于set封装中的，无论是iterator还是const_iterator</span>
	<span class="token comment">// 实际上都是const_iterator，而这里的iterator并不能用来构造const_iterator</span>
	<span class="token comment">// 我们可以写一个iterator用来构造const_iterator</span>
	<span class="token comment">// 但是这里为了方便就返回一个节点的指针Node*</span>
	<span class="token comment">// Node* 无论是iterator还是const_iterator都能构造</span>
	pair<span class="token operator">&lt;</span>Node<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> date<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">==</span> _root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
			_root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
			_size<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>_root<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		KofT koft<span class="token punctuation">;</span>

		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">koft</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_date<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">koft</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">koft</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_date<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">koft</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 插入新节点</span>
		cur <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 由于后面cur可能会随着旋转而改变</span>
		<span class="token comment">// 这里定义一个newNode记录一下</span>
		Node<span class="token operator">*</span> newNode <span class="token operator">=</span> cur<span class="token punctuation">;</span>

		cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">koft</span><span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_date<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">koft</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> cur<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 有向上处理的情况，可能存在parent不存在的情况</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> grandfather <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
			<span class="token comment">//        g</span>
			<span class="token comment">//		p   u</span>
			<span class="token comment">//   c</span>


			<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
				<span class="token comment">// 叔叔存在且叔叔的颜色为红色</span>
				<span class="token comment">// 变色完后子树的根节点为红色，并且该节点的父亲节点的颜色可能为红色</span>
				<span class="token comment">// 需要向上调整</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

					cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
					parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 叔叔存在且叔叔的颜色为黑色 || 叔叔不存在</span>
				<span class="token comment">// 旋转完后子树的根节点为黑色不需要向上调整</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token comment">// 左左 则 右旋</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>

						parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 左右 则 左右双旋</span>
					<span class="token keyword">else</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token function">RotateL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>

						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
						cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>


					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>


			<span class="token comment">// (parent == grandfather-&gt;_right)</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token comment">//        g</span>
				<span class="token comment">//	    u   p</span>
				<span class="token comment">//			  c</span>
				Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
				<span class="token comment">// 叔叔存在且为红色</span>
				<span class="token comment">// 叔叔和父亲变为黑色，祖父变为红色</span>
				<span class="token comment">// 由于祖父的父亲可能为红色，继续向上处理</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

					cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
					parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 叔叔不存在或叔叔存在且为黑色色</span>
				<span class="token comment">// 旋转处理，旋转后父亲变黑，祖父变红</span>
				<span class="token comment">// 子树的根节点为黑色不需要继续处理</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token comment">//        g</span>
					<span class="token comment">//	    u   p</span>
					<span class="token comment">//			  c</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>

						parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">//         g</span>
					<span class="token comment">//	    u     p</span>
					<span class="token comment">//		    c</span>
					<span class="token keyword">else</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token function">RotateR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>

						cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

			<span class="token punctuation">}</span>
			<span class="token comment">// 将根节点变为黑色</span>
		<span class="token punctuation">}</span>
		_root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
		_size<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>newNode<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment"> 在红黑树中插入值为data的节点，插入成功返回true，否则返回false</span>
	<span class="token comment"> 注意：为了简单起见，本次实现红黑树不存储重复性元素</span>
	<span class="token comment">//pair&lt;iterator,bool&gt; Insert(const T&amp; date)</span>
	<span class="token comment">//{<!-- --></span>
	<span class="token comment">//	if (nullptr == _root)</span>
	<span class="token comment">//	{<!-- --></span>
	<span class="token comment">//		_root = new Node(date);</span>
	<span class="token comment">//		_root-&gt;_col = BLACK;</span>
	<span class="token comment">//		_size++;</span>
	<span class="token comment">//		return make_pair(iterator(_root),true);</span>
	<span class="token comment">//	}</span>

	<span class="token comment">//	Node* cur = _root;</span>
	<span class="token comment">//	Node* parent = cur-&gt;_parent;</span>
	<span class="token comment">//	KofT koft;</span>

	<span class="token comment">//	while (cur)</span>
	<span class="token comment">//	{<!-- --></span>
	<span class="token comment">//		if (koft(cur-&gt;_date) &gt; koft(date))</span>
	<span class="token comment">//		{<!-- --></span>
	<span class="token comment">//			parent = cur;</span>
	<span class="token comment">//			cur = cur-&gt;_left;</span>
	<span class="token comment">//		}</span>
	<span class="token comment">//		else if (koft(cur-&gt;_date) &lt; koft(date))</span>
	<span class="token comment">//		{<!-- --></span>
	<span class="token comment">//			parent = cur;</span>
	<span class="token comment">//			cur = cur-&gt;_right;</span>
	<span class="token comment">//		}</span>
	<span class="token comment">//		else </span>
	<span class="token comment">//		{<!-- --></span>
	<span class="token comment">//			return make_pair(iterator(cur),false);</span>
	<span class="token comment">//		}</span>
	<span class="token comment">//	}</span>

	<span class="token comment">//	// 插入新节点</span>
	<span class="token comment">//	cur = new Node(date);</span>
	<span class="token comment">//	// 由于后面cur可能会随着旋转而改变</span>
	<span class="token comment">//	// 这里定义一个newNode记录一下</span>
	<span class="token comment">//	Node* newNode = cur;</span>

	<span class="token comment">//	cur-&gt;_parent = parent;</span>
	<span class="token comment">//	if (koft(parent-&gt;_date) &gt; koft(date))</span>
	<span class="token comment">//	{<!-- --></span>
	<span class="token comment">//		parent-&gt;_left = cur;</span>
	<span class="token comment">//	}</span>
	<span class="token comment">//	else</span>
	<span class="token comment">//	{<!-- --></span>
	<span class="token comment">//		parent-&gt;_right = cur;</span>
	<span class="token comment">//	}</span>

	<span class="token comment">//	// 有向上处理的情况，可能存在parent不存在的情况</span>
	<span class="token comment">//	while (parent &amp;&amp; parent-&gt;_col == RED)</span>
	<span class="token comment">//	{<!-- --></span>
	<span class="token comment">//		Node* grandfather = parent-&gt;_parent;</span>
	<span class="token comment">//		//        g</span>
	<span class="token comment">//		//		p   u</span>
	<span class="token comment">//		//   c</span>


	<span class="token comment">//		if (parent == grandfather-&gt;_left)</span>
	<span class="token comment">//		{<!-- --></span>
	<span class="token comment">//			Node* uncle = grandfather-&gt;_right;</span>
	<span class="token comment">//			// 叔叔存在且叔叔的颜色为红色</span>
	<span class="token comment">//			// 变色完后子树的根节点为红色，并且该节点的父亲节点的颜色可能为红色</span>
	<span class="token comment">//			// 需要向上调整</span>
	<span class="token comment">//			if (uncle &amp;&amp; uncle-&gt;_col == RED)</span>
	<span class="token comment">//			{<!-- --></span>
	<span class="token comment">//				parent-&gt;_col = uncle-&gt;_col = BLACK;</span>
	<span class="token comment">//				grandfather-&gt;_col = RED;</span>

	<span class="token comment">//				cur = grandfather;</span>
	<span class="token comment">//				parent = cur-&gt;_parent;</span>
	<span class="token comment">//			}</span>
	<span class="token comment">//			// 叔叔存在且叔叔的颜色为黑色 || 叔叔不存在</span>
	<span class="token comment">//			// 旋转完后子树的根节点为黑色不需要向上调整</span>
	<span class="token comment">//			else</span>
	<span class="token comment">//			{<!-- --></span>
	<span class="token comment">//				// 左左 则 右旋</span>
	<span class="token comment">//				if (cur == parent-&gt;_left)</span>
	<span class="token comment">//				{<!-- --></span>
	<span class="token comment">//					RotateR(grandfather);</span>

	<span class="token comment">//					parent-&gt;_col = BLACK;</span>
	<span class="token comment">//					grandfather-&gt;_col = RED;</span>
	<span class="token comment">//				}</span>
	<span class="token comment">//				// 左右 则 左右双旋</span>
	<span class="token comment">//				else</span>
	<span class="token comment">//				{<!-- --></span>
	<span class="token comment">//					RotateL(parent);</span>
	<span class="token comment">//					RotateR(grandfather);</span>

	<span class="token comment">//					grandfather-&gt;_col = RED;</span>
	<span class="token comment">//					cur-&gt;_col = BLACK;</span>
	<span class="token comment">//				}</span>
	<span class="token comment">//				</span>

	<span class="token comment">//				break;</span>
	<span class="token comment">//			}</span>
	<span class="token comment">//		}</span>
	<span class="token comment">//		</span>
	<span class="token comment">//		</span>
	<span class="token comment">//		// (parent == grandfather-&gt;_right)</span>
	<span class="token comment">//		else</span>
	<span class="token comment">//		{<!-- --></span>
	<span class="token comment">//			//        g</span>
	<span class="token comment">//			//	    u   p</span>
	<span class="token comment">//			//			  c</span>
	<span class="token comment">//			Node* uncle = grandfather-&gt;_left;</span>
	<span class="token comment">//			// 叔叔存在且为红色</span>
	<span class="token comment">//			// 叔叔和父亲变为黑色，祖父变为红色</span>
	<span class="token comment">//			// 由于祖父的父亲可能为红色，继续向上处理</span>
	<span class="token comment">//			if (uncle &amp;&amp; uncle-&gt;_col == RED)</span>
	<span class="token comment">//			{<!-- --></span>
	<span class="token comment">//				parent-&gt;_col = uncle-&gt;_col = BLACK;</span>
	<span class="token comment">//				grandfather-&gt;_col = RED;</span>

	<span class="token comment">//				cur = grandfather;</span>
	<span class="token comment">//				parent = cur-&gt;_parent;</span>
	<span class="token comment">//			}</span>
	<span class="token comment">//			// 叔叔不存在或叔叔存在且为黑色色</span>
	<span class="token comment">//			// 旋转处理，旋转后父亲变黑，祖父变红</span>
	<span class="token comment">//			// 子树的根节点为黑色不需要继续处理</span>
	<span class="token comment">//			else</span>
	<span class="token comment">//			{<!-- --></span>
	<span class="token comment">//				//        g</span>
	<span class="token comment">//				//	    u   p</span>
	<span class="token comment">//				//			  c</span>
	<span class="token comment">//				if (cur == parent-&gt;_right)</span>
	<span class="token comment">//				{<!-- --></span>
	<span class="token comment">//					RotateL(grandfather);</span>

	<span class="token comment">//					parent-&gt;_col = BLACK;</span>
	<span class="token comment">//					grandfather-&gt;_col = RED;</span>
	<span class="token comment">//				}</span>
	<span class="token comment">//				//         g</span>
	<span class="token comment">//				//	    u     p</span>
	<span class="token comment">//				//		    c</span>
	<span class="token comment">//				else</span>
	<span class="token comment">//				{<!-- --></span>
	<span class="token comment">//					RotateR(parent);</span>
	<span class="token comment">//					RotateL(grandfather);</span>

	<span class="token comment">//					cur-&gt;_col = BLACK;</span>
	<span class="token comment">//					grandfather-&gt;_col = RED;</span>
	<span class="token comment">//				}</span>
	<span class="token comment">//				</span>
	<span class="token comment">//				break;</span>
	<span class="token comment">//			}</span>
	<span class="token comment">//			</span>
	<span class="token comment">//		}</span>
	<span class="token comment">//		// 将根节点变为黑色</span>
	<span class="token comment">//	}</span>
	<span class="token comment">//	_size++;</span>
	<span class="token comment">//	_root-&gt;_col = BLACK;</span>
	<span class="token comment">//	return make_pair(iterator(newNode) , true);</span>
	<span class="token comment">//}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	size_t _size<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h3><a id="36__find__1896"></a>3.6 红黑树中 find 的实现</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KofT</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">RBTree</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> __TreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> iterator<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> __TreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> const_iterator<span class="token punctuation">;</span>

	<span class="token comment">// 检测红黑树中是否存在值为data的节点，存在返回该节点的地址，否则返回nullptr</span>
	<span class="token comment">// Node* 无论是iterator还是const_iterator都能构造</span>
	Node<span class="token operator">*</span> <span class="token function">Find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> k<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		KofT koft<span class="token punctuation">;</span>

		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">koft</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_date<span class="token punctuation">)</span> <span class="token operator">&lt;</span> k<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">koft</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_date<span class="token punctuation">)</span> <span class="token operator">&gt;</span> k<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> cur<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	size_t _size<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h3><a id="37__1940"></a>3.7 红黑树的整体实现</h3> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">enum</span> <span class="token class-name">Color</span>
<span class="token punctuation">{<!-- --></span>
	RED<span class="token punctuation">,</span>
	BLACK
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">RBTreeNode</span>
<span class="token punctuation">{<!-- --></span>
	RBTreeNode<span class="token operator">*</span> _left<span class="token punctuation">;</span>
	RBTreeNode<span class="token operator">*</span> _right<span class="token punctuation">;</span>
	RBTreeNode<span class="token operator">*</span> _parent<span class="token punctuation">;</span>
	T _date<span class="token punctuation">;</span>
	Color _col<span class="token punctuation">;</span>

	<span class="token function">RBTreeNode</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> date<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">_right</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_left</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_parent</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_col</span><span class="token punctuation">(</span>RED<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_date</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Ref</span> <span class="token punctuation">,</span><span class="token keyword">class</span> <span class="token class-name">Ptr</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">__TreeIterator</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> __TreeIterator<span class="token operator">&lt;</span>T <span class="token punctuation">,</span> Ref <span class="token punctuation">,</span> Ptr<span class="token operator">&gt;</span> Self<span class="token punctuation">;</span>
	
	<span class="token function">__TreeIterator</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> node<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_node</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

	Ref <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> _node<span class="token operator">-&gt;</span>_date<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	Ptr <span class="token keyword">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token operator">&amp;</span>_node<span class="token operator">-&gt;</span>_date<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> Self<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> _node <span class="token operator">==</span> s<span class="token punctuation">.</span>_node<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Self<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> _node <span class="token operator">!=</span> s<span class="token punctuation">.</span>_node<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 左子树 根 右子树</span>
	<span class="token comment">// 若当前节点的右树不为空，则指向当前节点的最右节点</span>
	<span class="token comment">// 若当前节点右树为空，则沿着这条路径向上查找</span>
	<span class="token comment">// 找到孩子是父亲左的祖先，使迭代器指向这个祖先</span>
	Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>_node<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">!=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 指向右树</span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token comment">// 指向右树最左节点</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			_node <span class="token operator">=</span> cur<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>

			<span class="token comment">// cur为根节点时，parent为空</span>
			<span class="token comment">// 所以这里要判断parent是否为空</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> parent<span class="token punctuation">;</span>
				parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 找到了cur是parent左</span>

			_node <span class="token operator">=</span> parent<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 右子树 根 左子树</span>
	<span class="token comment">// 若当前节点的左子树不为空，则找到左子树的最右节点</span>
	<span class="token comment">// 若当前节点的左子树为空，则沿着这条路径向上查找</span>
	<span class="token comment">// 找到孩子是父亲的右的祖先节点，使迭代器指向这个节点</span>
	Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _node<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">!=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>

			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			_node <span class="token operator">=</span> cur<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>parent<span class="token punctuation">;</span>

			<span class="token comment">// cur为根节点时，parent为空</span>
			<span class="token comment">// 所以这里要判断parent是否为空</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> parent<span class="token punctuation">;</span>
				parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			_node <span class="token operator">=</span> parent<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	Node<span class="token operator">*</span> _node<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span> <span class="token punctuation">,</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KofT</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">RBTree</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> __TreeIterator<span class="token operator">&lt;</span>T <span class="token punctuation">,</span> T<span class="token operator">&amp;</span> <span class="token punctuation">,</span>T<span class="token operator">*</span><span class="token operator">&gt;</span> iterator<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> __TreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> const_iterator<span class="token punctuation">;</span>

	<span class="token comment">// 在红黑树中插入值为data的节点，插入成功返回true，否则返回false</span>
	<span class="token comment">// 注意：为了简单起见，本次实现红黑树不存储重复性元素</span>

	<span class="token comment">// 这里pair的返回值应该是pair&lt;iterator,bool&gt;</span>
	<span class="token comment">// 但是由于set封装中的，无论是iterator还是const_iterator</span>
	<span class="token comment">// 实际上都是const_iterator，而这里的iterator并不能用来构造const_iterator</span>
	<span class="token comment">// 我们可以写一个iterator用来构造const_iterator</span>
	<span class="token comment">// 但是这里为了方便就返回一个节点的指针Node*</span>
	<span class="token comment">// Node* 无论是iterator还是const_iterator都能构造</span>
	pair<span class="token operator">&lt;</span>Node<span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> date<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">==</span> _root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
			_root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
			_size<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>_root<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		KofT koft<span class="token punctuation">;</span>

		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">koft</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_date<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">koft</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">koft</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_date<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">koft</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 插入新节点</span>
		cur <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 由于后面cur可能会随着旋转而改变</span>
		<span class="token comment">// 这里定义一个newNode记录一下</span>
		Node<span class="token operator">*</span> newNode <span class="token operator">=</span> cur<span class="token punctuation">;</span>

		cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">koft</span><span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_date<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">koft</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> cur<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 有向上处理的情况，可能存在parent不存在的情况</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> grandfather <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
			<span class="token comment">//        g</span>
			<span class="token comment">//		p   u</span>
			<span class="token comment">//   c</span>


			<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
				<span class="token comment">// 叔叔存在且叔叔的颜色为红色</span>
				<span class="token comment">// 变色完后子树的根节点为红色，并且该节点的父亲节点的颜色可能为红色</span>
				<span class="token comment">// 需要向上调整</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

					cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
					parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 叔叔存在且叔叔的颜色为黑色 || 叔叔不存在</span>
				<span class="token comment">// 旋转完后子树的根节点为黑色不需要向上调整</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token comment">// 左左 则 右旋</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>

						parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 左右 则 左右双旋</span>
					<span class="token keyword">else</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token function">RotateL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>

						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
						cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>


					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>


			<span class="token comment">// (parent == grandfather-&gt;_right)</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token comment">//        g</span>
				<span class="token comment">//	    u   p</span>
				<span class="token comment">//			  c</span>
				Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
				<span class="token comment">// 叔叔存在且为红色</span>
				<span class="token comment">// 叔叔和父亲变为黑色，祖父变为红色</span>
				<span class="token comment">// 由于祖父的父亲可能为红色，继续向上处理</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

					cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
					parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 叔叔不存在或叔叔存在且为黑色色</span>
				<span class="token comment">// 旋转处理，旋转后父亲变黑，祖父变红</span>
				<span class="token comment">// 子树的根节点为黑色不需要继续处理</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token comment">//        g</span>
					<span class="token comment">//	    u   p</span>
					<span class="token comment">//			  c</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>

						parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">//         g</span>
					<span class="token comment">//	    u     p</span>
					<span class="token comment">//		    c</span>
					<span class="token keyword">else</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token function">RotateR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>

						cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

			<span class="token punctuation">}</span>
			<span class="token comment">// 将根节点变为黑色</span>
		<span class="token punctuation">}</span>
		_root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
		_size<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>newNode<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment"></span>
	iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>

		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	const_iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>

		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token function">const_iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	const_iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">const_iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	 
	<span class="token comment">/*const_iterator begin()const
	{
		Node* cur = _root;

		while (cur &amp;&amp; cur-&gt;_left)
		{
			cur = cur-&gt;_left;
		}

		return iterator(cur);
	}

	const_iterator end()const
	{
		return iterator(nullptr);
	}*/</span>

	<span class="token comment">/*bool operator!=(iterator it)
	{
		return this-&gt;_node != it-&gt;_node;
	}

	bool operator==(iterator it)
	{
		return this-&gt;_node == it-&gt;_node;
	}*/</span>
	<span class="token comment"></span>
	<span class="token comment">// 检测红黑树中是否存在值为data的节点，存在返回该节点的地址，否则返回nullptr</span>
	<span class="token comment">// Node* 无论是iterator还是const_iterator都能构造	</span>
	Node<span class="token operator">*</span> <span class="token function">Find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> k<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		KofT koft<span class="token punctuation">;</span>

		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">koft</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_date<span class="token punctuation">)</span> <span class="token operator">&lt;</span> k<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">koft</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_date<span class="token punctuation">)</span> <span class="token operator">&gt;</span> k<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> cur<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>


	<span class="token comment">// 获取红黑树最左侧节点</span>
	Node<span class="token operator">*</span> <span class="token function">LeftMost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> cur<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 获取红黑树最右侧节点</span>
	Node<span class="token operator">*</span> <span class="token function">RightMost</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> cur<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 检测红黑树是否为有效的红黑树，注意：其内部主要依靠_IsValidRBTRee函数检测</span>
	<span class="token keyword">bool</span> <span class="token function">IsValidRBTRee</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">==</span> _root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>_root<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">int</span> blackCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> BLACK<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				blackCount<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token function">_IsValidRBTRee</span><span class="token punctuation">(</span>_root<span class="token punctuation">,</span> blackCount<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">InOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">_InOrder</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	size_t <span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> _size<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	size_t <span class="token function">Height</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">_Height</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">bool</span> <span class="token function">Empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> _root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">Destroy</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">_InOrder</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> pRoot<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pRoot <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token function">_InOrder</span><span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> pRoot<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> <span class="token char">':'</span> <span class="token operator">&lt;&lt;</span>
			pRoot<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>second <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token function">_InOrder</span><span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	size_t <span class="token function">_Height</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> pRoot<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pRoot <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		size_t HeightLeft <span class="token operator">=</span> <span class="token function">_Height</span><span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
		size_t HeightRight <span class="token operator">=</span> <span class="token function">_Height</span><span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> HeightLeft <span class="token operator">&gt;</span> HeightRight <span class="token operator">?</span> 
			HeightLeft <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> HeightRight <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">Destroy</span><span class="token punctuation">(</span>Node<span class="token operator">*</span><span class="token operator">&amp;</span> pRoot<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pRoot <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>

		<span class="token function">Destroy</span><span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">Destroy</span><span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">delete</span> pRoot<span class="token punctuation">;</span>
		pRoot <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">bool</span> <span class="token function">_IsValidRBTRee</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> pRoot<span class="token punctuation">,</span> size_t blackCount<span class="token punctuation">,</span> size_t pathBlack<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 判断是否每条路径黑色节点是否相同</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">nullptr</span> <span class="token operator">==</span> pRoot<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>blackCount <span class="token operator">!=</span> pathBlack<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cout <span class="token operator">&lt;&lt;</span> <span class="token string">"有路径黑色节点不相同"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> BLACK<span class="token punctuation">)</span>
			pathBlack<span class="token operator">++</span><span class="token punctuation">;</span>

		<span class="token comment">// 判断是否出现连续红色节点</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED <span class="token operator">&amp;&amp;</span> pRoot<span class="token operator">-&gt;</span>_parent<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cout <span class="token operator">&lt;&lt;</span> <span class="token string">"有连续红色节点"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token function">_IsValidRBTRee</span><span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_left<span class="token punctuation">,</span> blackCount<span class="token punctuation">,</span> pathBlack<span class="token punctuation">)</span>
			<span class="token operator">&amp;&amp;</span> <span class="token function">_IsValidRBTRee</span><span class="token punctuation">(</span>pRoot<span class="token operator">-&gt;</span>_right<span class="token punctuation">,</span> blackCount<span class="token punctuation">,</span> pathBlack<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 右单旋</span>
	<span class="token keyword">void</span> <span class="token function">RotateR</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> subL <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> subLR <span class="token operator">=</span> subL<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>

		parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subLR<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>subLR<span class="token punctuation">)</span>
			subLR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		Node<span class="token operator">*</span> Pparent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		subL<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		parent<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> subL<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> _root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_root <span class="token operator">=</span> subL<span class="token punctuation">;</span>
			subL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			subL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> Pparent<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>Pparent<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> parent<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Pparent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subL<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				Pparent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subL<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 左单旋</span>
	<span class="token keyword">void</span> <span class="token function">RotateL</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> subR <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> subRL <span class="token operator">=</span> subR<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>

		parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subRL<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>subRL<span class="token punctuation">)</span>
			subRL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		Node<span class="token operator">*</span> Pparent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		parent<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> subR<span class="token punctuation">;</span>
		subR<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> _root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_root <span class="token operator">=</span> subR<span class="token punctuation">;</span>
			subR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			subR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> Pparent<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>Pparent<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> parent<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Pparent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subR<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				Pparent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subR<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	size_t _size<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h2><a id="set__map__2560"></a>四、set 和 map 的封装</h2> 
<h3><a id="41_set_2562"></a>4.1 set的封装</h3> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"RBTree.h"</span></span>

<span class="token keyword">namespace</span> aj
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token operator">&gt;</span>
	<span class="token keyword">class</span> <span class="token class-name">set</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">public</span><span class="token operator">:</span>
		<span class="token keyword">struct</span> <span class="token class-name">SetKofT</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">const</span> K<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> k<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> k<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>

		<span class="token comment">// 对类模板取内嵌类型，加typename告诉编译器这里是类型</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> SetKofT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_iterator iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> SetKofT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_iterator const_iterator<span class="token punctuation">;</span>

		pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> k<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _set<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		size_t <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _set<span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 这里无论是iterator还是const_iterator</span>
		<span class="token comment">// 实际上都是const_iterator</span>
		<span class="token comment">// 由于set无论是const版本还是非const版本都不能进行修改</span>
		<span class="token comment">// 所以这里不需要重载const版本</span>
		iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _set<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _set<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">/*const_iterator begin()const
		{
			return _set.begin();
		}

		const_iterator end()const
		{
			return _set.end();
		}*/</span>

		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span>iterator it<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token keyword">this</span> <span class="token operator">!=</span> it<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span>iterator it<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token keyword">this</span> <span class="token operator">==</span> it<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">bool</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _set<span class="token punctuation">.</span><span class="token function">Empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_set<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> k<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _set<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_iterator <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> k<span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _set<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token keyword">private</span><span class="token operator">:</span>
		RBTree<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> SetKofT<span class="token operator">&gt;</span> _set<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre> 
<hr> 
<h3><a id="42_map_2660"></a>4.2 map的封装</h3> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"RBTree.h"</span></span>

<span class="token keyword">namespace</span> aj
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span><span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
	<span class="token keyword">class</span> <span class="token class-name">map</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">public</span><span class="token operator">:</span>
		<span class="token keyword">struct</span> <span class="token class-name">MapKofT</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">const</span> K<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> k<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> k<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>

		<span class="token comment">// 这里pair中的K需要加const，是因为要和下面的成员变量类型相同</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapKofT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapKofT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_iterator const_iterator<span class="token punctuation">;</span>

		pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> k<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _map<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		size_t <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _map<span class="token punctuation">.</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _map<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _map<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _map<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _map<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span>iterator it<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token keyword">this</span> <span class="token operator">!=</span> it<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span>iterator it<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token keyword">this</span> <span class="token operator">==</span> it<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">bool</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _map<span class="token punctuation">.</span><span class="token function">Empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_map<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> k<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _map<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_iterator <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> k<span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _map<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		V<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> k<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 如果k在_map中存在，则operator[]充当查找的作用</span>
			<span class="token comment">// 如果k在_map中不存在，则operator[]充当插入的作用</span>
			pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> ret <span class="token operator">=</span> _map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token function">make_pair</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span><span class="token function">V</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> ret<span class="token punctuation">.</span>first<span class="token operator">-&gt;</span>second<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token keyword">private</span><span class="token operator">:</span>
		RBTree<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span>V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapKofT<span class="token operator">&gt;</span> _map<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<h2><a id="_2759"></a>结尾</h2> 
<p>如果有什么建议和疑问，或是有什么错误，大家可以在评论区中提出。<br> 希望大家以后也能和我一起进步！！🌹🌹<br> 如果这篇文章对你有用的话，希望大家给一个三连支持一下！！🌹🌹</p> 
<p><img src="https://images2.imgbox.com/94/c8/C9tHbT6Z_o.gif" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7fbdccfd7056e50499830350aa6a7409/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">体验亚马逊AIGC——Amazon Bedrock</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7c17486904d410fabc360d302dbffbd4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">浅谈C&#43;&#43;基本框架内涵及其学习路线</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>