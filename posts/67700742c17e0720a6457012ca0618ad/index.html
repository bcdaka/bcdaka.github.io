<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>本科阶段最后一次竞赛Vlog——2024年智能车大赛智慧医疗组准备全过程——2Yolo使用之ONNX模型准备 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/67700742c17e0720a6457012ca0618ad/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="本科阶段最后一次竞赛Vlog——2024年智能车大赛智慧医疗组准备全过程——2Yolo使用之ONNX模型准备">
  <meta property="og:description" content="本科阶段最后一次竞赛Vlog——2024年智能车大赛智慧医疗组准备全过程——2Yolo使用之ONNX模型准备 ​ 大家好，因为板端BPU环境，可以加速目标检测的速度，所以今天在此先给大家带来如何准备一个模型，下一期会给大家带来如何在板端部署这一期的目标识别模型
​ 本文给大家带来的是yolov5-2.0 版本，在我最先接触的就是这个板子，当时也是参考了地平线社区的大佬带来一些方法，当然这个参考是在下一期哈哈、
​ 这一期其方法上是通用的，出这一期也是能够方便大家以后学会yolo任何版本的使用。
​ 因为我没有研究很深入，我写是针对比赛，至于其他版本会不会在使用过程中有小坑，在地平线官网也是有教程的，大家需要其他版本的可以去看看其他大佬的文章。
1.获取目标检测源码 ​ 首先，是要获得yolov5-2.0得源码，正常情况是要教大家去github进行下载源码的，但是咳咳好像不太容易，因为“科学上网”
​ 当然下载完成2.0版本还有有很多bug的，这里给大家以附件形式给出我的源码吧
​ 下载的源码里主要由一下文件夹
2.数据准备与标记 ​ 要训练一个模型，首先需要一定的图片数据，然后标记，接下来开始告诉大家如何进行这些准备
​ 当然你首先要有Pyhton环境，这里就不教大家配置Python了，我这里使用的是Anaconda&#43;Pycharm
​ 之前发现哔哩哔哩有好多讲解使用，大家可以看下
2.1 数据集准备 ​ 首先建立一个文件夹dataset，里面放置image和label，每个子文件夹里面放置train和test。然后把你的jpg或者png图片放在image的train里面
​ 2.2 数据标记 ​ 打开你的命令行，输入如下
pip install labelimg ​ 稍等安装完毕，然后在命令行输入，如下内容，你会发现弹出如下窗口
labelimg ​ 接下来点击View-选择第一行设置自动保存模式
​ 接下来点击 Open Dir——&gt;选择你刚才image所在的目录
​ 接下来选择 Change Save Dir 找到你的label文件夹里的train
​ ​ 最后保证选择Yolo模式
​ 此刻你就可以看到你的图片已经加载进来了
​ 这里把鼠标移动到页面里，按下键盘里w,会出现一个十字
​ 这时候你就可以，进行绘制矩形了，绘制完成后，就会出现一个提示框，这里写上你的标签
​ 当你打完这个标签之后，使用键盘键A和D，可以切换上一张，下一张，最后你标记完成你所有图片，应该是下面这个样子
​ 一个文件夹有图片，另外一个文件夹里面是txt格式文件
​ 3.配置文件 3.1目录结构 ​ 在你下载的源码中创建下面这样的文件夹，接下来，我将挨个进行刚才没有提及的文件进行解释">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-02T21:39:52+08:00">
    <meta property="article:modified_time" content="2024-08-02T21:39:52+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">本科阶段最后一次竞赛Vlog——2024年智能车大赛智慧医疗组准备全过程——2Yolo使用之ONNX模型准备</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Vlog20242YoloONNX_0"></a>本科阶段最后一次竞赛Vlog——2024年智能车大赛智慧医疗组准备全过程——2Yolo使用之ONNX模型准备</h2> 
<p>​ 大家好，因为板端BPU环境，可以加速目标检测的速度，所以今天在此先给大家带来如何准备一个模型，下一期会给大家带来如何在板端部署这一期的目标识别模型</p> 
<p>​ 本文给大家带来的是yolov5-2.0 版本，在我最先接触的就是这个板子，当时也是参考了地平线社区的大佬带来一些方法，当然这个参考是在下一期哈哈、</p> 
<p>​ 这一期其方法上是通用的，出这一期也是能够方便大家以后学会yolo任何版本的使用。</p> 
<p>​ 因为我没有研究很深入，我写是针对比赛，至于其他版本会不会在使用过程中有小坑，在地平线官网也是有教程的，大家需要其他版本的可以去看看其他大佬的文章。</p> 
<h2><a id="1_10"></a>1.获取目标检测源码</h2> 
<p>​ 首先，是要获得yolov5-2.0得源码，正常情况是要教大家去github进行下载源码的，但是咳咳好像不太容易，因为“科学上网”</p> 
<p>​ 当然下载完成2.0版本还有有很多bug的，这里给大家以附件形式给出我的源码吧</p> 
<p>​ 下载的源码里主要由一下文件夹</p> 
<p><img src="https://images2.imgbox.com/46/31/qXbKfd5Z_o.png" alt="image-20240802203012603"></p> 
<h2><a id="2_20"></a>2.数据准备与标记</h2> 
<p>​ 要训练一个模型，首先需要一定的图片数据，然后标记，接下来开始告诉大家如何进行这些准备</p> 
<p>​ 当然你首先要有Pyhton环境，这里就不教大家配置Python了，我这里使用的是Anaconda+Pycharm</p> 
<p>​ 之前发现哔哩哔哩有好多讲解使用，大家可以看下</p> 
<h3><a id="21__28"></a>2.1 数据集准备</h3> 
<p>​ 首先建立一个文件夹dataset，里面放置image和label，每个子文件夹里面放置train和test。然后把你的jpg或者png图片放在image的train里面</p> 
<p>​ <img src="https://images2.imgbox.com/da/37/nVlMpPgc_o.png" alt="image-20240802203525930"></p> 
<h3><a id="22__34"></a>2.2 数据标记</h3> 
<p>​ 打开你的命令行，输入如下</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> labelimg
</code></pre> 
<p><img src="https://images2.imgbox.com/2e/f2/CorzcXFi_o.png" alt="image-20240802204001016"></p> 
<p>​ 稍等安装完毕，然后在命令行输入，如下内容，你会发现弹出如下窗口</p> 
<pre><code>labelimg
</code></pre> 
<p><img src="https://images2.imgbox.com/32/50/BwJ6KKA4_o.png" alt="image-20240802204130724"></p> 
<p>​ 接下来点击View-选择第一行设置自动保存模式</p> 
<p><img src="https://images2.imgbox.com/56/0c/WT0vk5nS_o.png" alt="image-20240802204209178"></p> 
<p>​ 接下来点击 Open Dir——&gt;选择你刚才image所在的目录</p> 
<p><img src="https://images2.imgbox.com/65/c5/L1TGErHo_o.png" alt="image-20240802204350234"></p> 
<p>​ 接下来选择 Change Save Dir 找到你的label文件夹里的train</p> 
<p>​ <img src="https://images2.imgbox.com/8f/67/ReLDR6k4_o.png" alt="image-20240802204743843"></p> 
<p>​ 最后保证选择Yolo模式</p> 
<p><img src="https://images2.imgbox.com/c1/bb/7sHMvqMF_o.png" alt="image-20240802205052804"></p> 
<p>​ 此刻你就可以看到你的图片已经加载进来了</p> 
<p><img src="https://images2.imgbox.com/bd/de/vPGQpS5L_o.png" alt="image-20240802205131915"></p> 
<p>​ 这里把鼠标移动到页面里，按下键盘里w,会出现一个十字</p> 
<p><img src="https://images2.imgbox.com/1e/0f/qnGUANIt_o.png" alt="image-20240802205239892"></p> 
<p>​ 这时候你就可以，进行绘制矩形了，绘制完成后，就会出现一个提示框，这里写上你的标签</p> 
<p><img src="https://images2.imgbox.com/8c/e4/Th68kub1_o.png" alt="image-20240802205304825"></p> 
<p>​ 当你打完这个标签之后，使用键盘键A和D，可以切换上一张，下一张，最后你标记完成你所有图片，应该是下面这个样子</p> 
<p>​ 一个文件夹有图片，另外一个文件夹里面是txt格式文件</p> 
<p>​ <img src="https://images2.imgbox.com/eb/5b/GcG48lAn_o.png" alt="image-20240802205653908"></p> 
<h2><a id="3_86"></a>3.配置文件</h2> 
<h3><a id="31_88"></a>3.1目录结构</h3> 
<p>​ 在你下载的源码中创建下面这样的文件夹，接下来，我将挨个进行刚才没有提及的文件进行解释</p> 
<p><img src="https://images2.imgbox.com/e6/6d/OidAXvlp_o.png" alt="image-20240802205927731"></p> 
<h3><a id="32_test_94"></a>3.2 test</h3> 
<p>​ 对于test里面的文件夹，这里下面我给大家提供一个分割脚本，其实本质是就是将刚才打标签的所有内容，进行划分，分成两部分</p> 
<p>​ 当然下面代码是要大家改一些东西的，一些路径字符串我已经给大家写好了，大家改成自己对应的就可以了</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> shutil
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split


<span class="token keyword">def</span> <span class="token function">move_files</span><span class="token punctuation">(</span>src_dir<span class="token punctuation">,</span> dst_dir<span class="token punctuation">,</span> files<span class="token punctuation">,</span> extension<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""将指定的文件从源目录移动到目标目录。"""</span>
    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>dst_dir<span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 如果目标目录不存在，则创建</span>
    <span class="token keyword">for</span> base_name <span class="token keyword">in</span> files<span class="token punctuation">:</span>
        src_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>src_dir<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>base_name<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>extension<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        dst_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>dst_dir<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>base_name<span class="token punctuation">}</span></span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>extension<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        shutil<span class="token punctuation">.</span>move<span class="token punctuation">(</span>src_path<span class="token punctuation">,</span> dst_path<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">split_dataset</span><span class="token punctuation">(</span>src_images_dir<span class="token punctuation">,</span> src_labels_dir<span class="token punctuation">,</span> dst_dirs<span class="token punctuation">,</span> train_ratio<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span> val_ratio<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    将数据集分为训练集、验证集和测试集，并移动到指定目录。

    参数:
    - src_images_dir: 图片的源目录。
    - src_labels_dir: 标签的源目录。
    - dst_dirs: 目标目录的字典，包含'train', 'val', 'test'对应的图片和标签目录。
    - train_ratio: 训练集在总数据中的比例。
    - val_ratio: 验证集在总数据中的比例。
    """</span>
    test_ratio <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> train_ratio <span class="token operator">-</span> val_ratio
    <span class="token keyword">assert</span> test_ratio <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Invalid ratios: Sum of train and val ratios must be less than 1."</span>

    <span class="token comment"># 读取并分割数据</span>
    files <span class="token operator">=</span> <span class="token punctuation">[</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>src_images_dir<span class="token punctuation">)</span><span class="token punctuation">]</span>
    train_files<span class="token punctuation">,</span> test_files <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>files<span class="token punctuation">,</span> test_size<span class="token operator">=</span>test_ratio<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
    train_files<span class="token punctuation">,</span> val_files <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>train_files<span class="token punctuation">,</span> test_size<span class="token operator">=</span>val_ratio <span class="token operator">/</span> <span class="token punctuation">(</span>train_ratio <span class="token operator">+</span> val_ratio<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                              random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>

    <span class="token comment"># 移动文件到相应的目录</span>
    <span class="token keyword">for</span> part<span class="token punctuation">,</span> file_list <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'train'</span><span class="token punctuation">,</span> train_files<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'val'</span><span class="token punctuation">,</span> val_files<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> test_files<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        move_files<span class="token punctuation">(</span>src_images_dir<span class="token punctuation">,</span> dst_dirs<span class="token punctuation">[</span>part<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'images'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> file_list<span class="token punctuation">,</span> <span class="token string">'.jpg'</span><span class="token punctuation">)</span> <span class="token comment">#这里使用的是jpg格式，如果是png需要修改</span>
        move_files<span class="token punctuation">(</span>src_labels_dir<span class="token punctuation">,</span> dst_dirs<span class="token punctuation">[</span>part<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'labels'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> file_list<span class="token punctuation">,</span> <span class="token string">'.txt'</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 定义源目录</span>
    src_images_dir <span class="token operator">=</span> <span class="token string">r'刚才的tain里面的所有图片'</span>
    src_labels_dir <span class="token operator">=</span> <span class="token string">r'刚才label所有txt'</span>

    <span class="token comment"># 定义目标目录</span>
    dst_dirs <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'train'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'images'</span><span class="token punctuation">:</span> <span class="token string">r'训练集图片路径'</span><span class="token punctuation">,</span>
                  <span class="token string">'labels'</span><span class="token punctuation">:</span> <span class="token string">r'训练集标签路径'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'val'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'images'</span><span class="token punctuation">:</span> <span class="token string">r'验证集图片路径'</span><span class="token punctuation">,</span>
                <span class="token string">'labels'</span><span class="token punctuation">:</span> <span class="token string">r'验证集标签路径'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'test'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'images'</span><span class="token punctuation">:</span> <span class="token string">r'测试集标签路径'</span><span class="token punctuation">,</span>
                 <span class="token string">'labels'</span><span class="token punctuation">:</span> <span class="token string">r'测试集标签路径'</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 调用函数，进行数据划分和文件移动</span>
    split_dataset<span class="token punctuation">(</span>src_images_dir<span class="token punctuation">,</span> src_labels_dir<span class="token punctuation">,</span> dst_dirs<span class="token punctuation">,</span> train_ratio<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span> val_ratio<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="33_my_modelyaml_164"></a>3.3 my_model.yaml</h3> 
<p>​ 对于这个yaml文件，大家只需要吧第一个参数nc改成自己的实际类别，对于小白其他参数不需要管</p> 
<pre><code class="prism language-yaml"><span class="token comment"># parameters</span>
<span class="token key atrule">nc</span><span class="token punctuation">:</span> <span class="token number">1</span>  <span class="token comment"># number of classes</span>
<span class="token key atrule">depth_multiple</span><span class="token punctuation">:</span> <span class="token number">0.33</span>  <span class="token comment"># model depth multiple</span>
<span class="token key atrule">width_multiple</span><span class="token punctuation">:</span> <span class="token number">0.50</span>  <span class="token comment"># layer channel multiple</span>

<span class="token comment"># anchors</span>
<span class="token key atrule">anchors</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">]</span>  <span class="token comment"># P3/8</span>
  <span class="token punctuation">-</span> <span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token number">61</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span><span class="token number">119</span><span class="token punctuation">]</span>  <span class="token comment"># P4/16</span>
  <span class="token punctuation">-</span> <span class="token punctuation">[</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">,</span><span class="token number">198</span><span class="token punctuation">,</span> <span class="token number">373</span><span class="token punctuation">,</span><span class="token number">326</span><span class="token punctuation">]</span>  <span class="token comment"># P5/32</span>

<span class="token comment"># YOLOv5 backbone</span>
<span class="token key atrule">backbone</span><span class="token punctuation">:</span>
  <span class="token comment"># [from, number, module, args]</span>
  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Focus<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 0-P1/2</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 1-P2/4</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> BottleneckCSP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 3-P3/8</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> BottleneckCSP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 5-P4/16</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> BottleneckCSP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 7-P5/32</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> SPP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> BottleneckCSP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token boolean important">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 9</span>
  <span class="token punctuation">]</span>

<span class="token comment"># YOLOv5 head</span>
<span class="token key atrule">head</span><span class="token punctuation">:</span>
  <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> nn.Upsample<span class="token punctuation">,</span> <span class="token punctuation">[</span>None<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'nearest'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Concat<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># cat backbone P4</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> BottleneckCSP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token boolean important">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 13</span>

   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> nn.Upsample<span class="token punctuation">,</span> <span class="token punctuation">[</span>None<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'nearest'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Concat<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># cat backbone P3</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> BottleneckCSP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token boolean important">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 17</span>

   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Concat<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># cat head P4</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> BottleneckCSP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token boolean important">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 20</span>

   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Conv<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Concat<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># cat head P5</span>
   <span class="token punctuation">[</span><span class="token number">-1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> BottleneckCSP<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token boolean important">False</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># 23</span>

   <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Detect<span class="token punctuation">,</span> <span class="token punctuation">[</span>nc<span class="token punctuation">,</span> anchors<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token comment"># Detect(P3, P4, P5)</span>
  <span class="token punctuation">]</span>

</code></pre> 
<h3><a id="34_my_parayaml_220"></a>3.4 my_para.yaml</h3> 
<p>​ 对于这个yaml文件，下面四个参数都要修改，具体修改下面已经用中文给出大家了</p> 
<pre><code class="prism language-yaml"><span class="token comment"># COCO 2017 dataset http://cocodataset.org - first 128 training images</span>
<span class="token comment"># Download command:  python -c "from yolov5.utils.google_utils import *; gdrive_download('1n_oKgR81BJtqk75b00eAjdv03qVCQn2f', 'coco128.zip')"</span>
<span class="token comment"># Train command: python train.py --data coco128.yaml</span>
<span class="token comment"># Default dataset location is next to /yolov5:</span>
<span class="token comment">#   /parent_folder</span>
<span class="token comment">#     /coco128</span>
<span class="token comment">#     /yolov5</span>


<span class="token comment"># train and val data as 1) directory: path/images/, 2) file: path/images.txt, or 3) list: [path1/images/, path2/images/]</span>
<span class="token key atrule">train</span><span class="token punctuation">:</span> <span class="token string">"训练集图片的路径"</span>  <span class="token comment"># 128 images</span>
<span class="token key atrule">val</span><span class="token punctuation">:</span> <span class="token string">"验证集的图片路径"</span>  <span class="token comment"># 128 images</span>

<span class="token comment"># 这个地方写类别个数，数字</span>
<span class="token key atrule">nc</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token comment"># class names</span>
<span class="token key atrule">names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'刚才标记的字符串名字'</span><span class="token punctuation">,</span><span class="token string">'标记的第二个label名字'</span><span class="token punctuation">]</span>

</code></pre> 
<h2><a id="4_246"></a>4.训练配置</h2> 
<h3><a id="41trainpy_248"></a>4.1train.py</h3> 
<p>​ 对于训练，打开train.py 按照我下面截图框进行设置，下面是解释</p> 
<p>​ （1）cfg 这个把刚才的my_mode.yaml路径放进来</p> 
<p>​ （2）data这个把刚才的my_para.yaml路径放进来</p> 
<p>​ （3）epochs：这个设置轮数</p> 
<p>​ （4）device：选择cpu，当然我这里是0 是因为我配置了cuda</p> 
<p>​ （5）img-size：这里注意一下。这里选择672*672 和我一样就行，方便后面转模型，我也没有研究很深入，好像是转模型有点影响</p> 
<p><img src="https://images2.imgbox.com/58/ab/nEu4EGHC_o.png" alt="image-20240802211637078"></p> 
<h3><a id="42_modelyolopy_264"></a>4.2 model/yolo.py</h3> 
<p>​ 现在我们是训练阶段，我给大家提供的里面就是我现在截图这个样子，</p> 
<p>​ 大家需要把红框的这个取消注释</p> 
<p>​ 把红框下面的进行注释掉</p> 
<p><img src="https://images2.imgbox.com/38/55/5B8TBvKJ_o.png" alt="image-20240802212009895"></p> 
<h3><a id="43_274"></a>4.3正式训练</h3> 
<p>​ 到现在你就可以愉快的进行训练啦</p> 
<p>​ 当你看到类似下面这种情况，代表你的模型正常训练了</p> 
<p><img src="https://images2.imgbox.com/14/2f/JMO7DijS_o.png" alt="image-20240802212419007"></p> 
<h3><a id="44_282"></a>4.4训练完成</h3> 
<p>​ 训练时间还是挺漫长的，当你最后训练完成了，你会发现，控制台输出了一个日志，当然不一定和我的一模一样，因为我的是v5-7.0版本</p> 
<p><img src="https://images2.imgbox.com/91/b8/r7FMfg9A_o.png" alt="image-20240802212455738"></p> 
<p>​ 哈哈大同小异，反正根据日志找到位置就好了，然后你会看到，里面有这些，通常我们会使用best.pt</p> 
<p>​ 到此为止，windows的模型就训练得到啦</p> 
<p><img src="https://images2.imgbox.com/8a/36/xorkfrRk_o.png" alt="image-20240802212626331"></p> 
<h2><a id="5_ONNX_294"></a>5 ONNX模型转化</h2> 
<p>​ 这一步就很简单了，大家只需要，先把yolo.py里面的换到处onnx该使用的那一行就好啦</p> 
<p><img src="https://images2.imgbox.com/2e/50/CrSDeZXR_o.png" alt="image-20240802213044574"></p> 
<p>​ 这个时候大家吧expoer.py里面的weights路径改成刚才的pt就行了</p> 
<p>​ 运行代码你就会发现，现在onnx成功转化了，然后你就可以使用这个进行下一期的bin模型转化了</p> 
<p><img src="https://images2.imgbox.com/f8/34/T2QWSKtv_o.png" alt="image-20240802213032934"></p> 
<h2><a id="6_308"></a>6.总结与下期预告</h2> 
<p>本期，给大家带来了如何在windows训练yolov5，大家可以试试</p> 
<p>当然本期介绍确实没啥含金量，网上有关教程也满天飞，我也参考了好多大佬的文章，也就是对于大佬们详细版本的总结一下</p> 
<p>下一期讲给大家带来与地平线更为相关的内容，包括bin模型转化环境，以及转化过程的提炼版本</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/648557870dc6924e709b3122e27b79f8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MSF回弹木马ubuntu测试</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f6eb22efed107eecc1284d3bdac38bb1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【人工智能】边缘计算与 AI：实时智能的未来</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>