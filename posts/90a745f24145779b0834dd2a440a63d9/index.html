<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>GraphRAGå¦‚ä½•ä½¿ç”¨ollamaæä¾›çš„llm model å’ŒEmbedding modelæœåŠ¡æ„å»ºæœ¬åœ°çŸ¥è¯†åº“ - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/90a745f24145779b0834dd2a440a63d9/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="GraphRAGå¦‚ä½•ä½¿ç”¨ollamaæä¾›çš„llm model å’ŒEmbedding modelæœåŠ¡æ„å»ºæœ¬åœ°çŸ¥è¯†åº“">
  <meta property="og:description" content="ä½¿ç”¨GraphRAGè¸©å‘æ— æ•° åœ¨GraphRAGçš„ä½¿ç”¨è¿‡ç¨‹ä¸­å°†éœ€è¦è¸©çš„å‘éƒ½è¸©äº†ä¸€éï¼ˆä¸å¾—ä¸åæ§½ä¸‹ï¼Œå®˜æ–¹ä»£ç æœ‰å¾ˆå¤šé—ç•™é—®é¢˜ï¼Œä»–ä»¬è‡ªå·±ä¹Ÿæ‰¿è®¤å·¥ä½œé‡å¿ƒåœ¨ç®—æ³•çš„ä¼˜åŒ–è€Œä¸æ˜¯å„ç§æ¨¡å‹å’Œæ¡†æ¶çš„å…¼å®¹æ€§é€‚é…æ€§ä¸Šï¼‰ï¼Œç»è¿‡äº†å¤§é‡çš„æŸ¥é˜…å„ç§èµ„æ–™ä»¥åŠdebugè¿‡ç¨‹ï¼ˆIndexingçš„è¿‡ç¨‹æœ‰ç‚¹è´¹æœºå™¨ï¼‰ï¼Œæœ€ç»ˆæˆåŠŸè¿è¡Œäº†GraphRAGé¡¹ç›®ã€‚å…ˆåæµ‹è¯•äº†ä¸¤ç§æ–¹å¼ï¼Œéƒ½æˆåŠŸäº†:
ä½¿ç”¨ollamaæä¾›æœ¬åœ°llm modelå’ŒEmbedding modelæœåŠ¡ä½¿ç”¨ollamaæä¾›llm modelæœåŠ¡ï¼Œä½¿ç”¨lm-studioæä¾›embedding modelæœåŠ¡ ä¹‹æ‰€ä»¥è¦ä½¿ç”¨ollamaåŒæ—¶æä¾›llmå’ŒEmbeddingæ¨¡å‹æœåŠ¡ï¼Œæ˜¯å› ä¸ºollamaå®åœ¨æ˜¯å¤ªä¼˜é›…äº†ï¼Œä½¿ç”¨è¶…çº§ç®€å•ï¼Œå“åº”é€Ÿåº¦ä¹Ÿè¶…çº§å¿«ã€‚
ä½¿ç”¨ollamaæä¾›æœåŠ¡çš„æ–¹å¼å¦‚ä¸‹ï¼š 1ã€å®‰è£…GraphRAG:
pip install graphrag -i https://pypi.tuna.tsinghua.edu.cn/simple åˆ›å»ºä¸€ä¸ªæ–‡ä»¶è·¯å¾„:./ragtest/input mkdir -p ./ragtest/input å°†è¯­æ–™æ–‡æœ¬æ–‡ä»¶æ”¾åœ¨è¿™ä¸ªè·¯å¾„ä¸‹ï¼Œ æ–‡ä»¶æ ¼å¼ä¸ºtxtï¼Œ æ³¨æ„ï¼štxtæ–‡ä»¶å¿…é¡»æ˜¯utf-8ç¼–ç çš„ï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€å¦å­˜ä¸ºå¾—åˆ°ã€‚ä½¿ç”¨å‘½ä»¤python -m graphrag.index --init --root ./ragteståˆå§‹åŒ–å·¥ç¨‹: python -m graphrag.index --init --root ./ragtest ä¿®æ”¹.envæ–‡ä»¶å†…å®¹å¦‚ä¸‹: GRAPHRAG_API_KEY=ollama GRAPHRAG_CLAIM_EXTRACTION_ENABLED=True æ³¨æ„ï¼šå¿…é¡»åŠ ä¸Šå‚æ•°GRAPHRAG_CLAIM_EXTRACTION_ENABLED=Trueï¼Œå¦åˆ™æ— æ³•ç”Ÿæˆåå˜é‡covariatesï¼Œ åœ¨Local Searchæ—¶ä¼šå‡ºé”™ã€‚
ä¿®æ”¹.setting.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹: encoding_model: cl100k_base skip_workflows: [] llm: api_key: ollama type: openai_chat # or azure_openai_chat model: qwen2 model_supports_json: true # recommended if this is available for your model. # max_tokens: 4000 # request_timeout: 180.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-30T09:43:49+08:00">
    <meta property="article:modified_time" content="2024-08-30T09:43:49+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">GraphRAGå¦‚ä½•ä½¿ç”¨ollamaæä¾›çš„llm model å’ŒEmbedding modelæœåŠ¡æ„å»ºæœ¬åœ°çŸ¥è¯†åº“</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="GraphRAG_0"></a>ä½¿ç”¨GraphRAGè¸©å‘æ— æ•°</h3> 
<p>åœ¨GraphRAGçš„ä½¿ç”¨è¿‡ç¨‹ä¸­å°†éœ€è¦è¸©çš„å‘éƒ½è¸©äº†ä¸€éï¼ˆä¸å¾—ä¸åæ§½ä¸‹ï¼Œå®˜æ–¹ä»£ç æœ‰å¾ˆå¤šé—ç•™é—®é¢˜ï¼Œä»–ä»¬è‡ªå·±ä¹Ÿæ‰¿è®¤å·¥ä½œé‡å¿ƒåœ¨ç®—æ³•çš„ä¼˜åŒ–è€Œä¸æ˜¯å„ç§æ¨¡å‹å’Œæ¡†æ¶çš„å…¼å®¹æ€§é€‚é…æ€§ä¸Šï¼‰ï¼Œç»è¿‡äº†å¤§é‡çš„æŸ¥é˜…å„ç§èµ„æ–™ä»¥åŠdebugè¿‡ç¨‹ï¼ˆIndexingçš„è¿‡ç¨‹æœ‰ç‚¹è´¹æœºå™¨ï¼‰ï¼Œæœ€ç»ˆæˆåŠŸè¿è¡Œäº†GraphRAGé¡¹ç›®ã€‚å…ˆåæµ‹è¯•äº†ä¸¤ç§æ–¹å¼ï¼Œéƒ½æˆåŠŸäº†:</p> 
<ol><li><strong>ä½¿ç”¨ollamaæä¾›æœ¬åœ°llm modelå’ŒEmbedding modelæœåŠ¡</strong></li><li><strong>ä½¿ç”¨ollamaæä¾›llm modelæœåŠ¡ï¼Œä½¿ç”¨lm-studioæä¾›embedding modelæœåŠ¡</strong></li></ol> 
<p>ä¹‹æ‰€ä»¥è¦ä½¿ç”¨ollamaåŒæ—¶æä¾›llmå’ŒEmbeddingæ¨¡å‹æœåŠ¡ï¼Œæ˜¯å› ä¸º<strong>ollamaå®åœ¨æ˜¯å¤ªä¼˜é›…äº†</strong>ï¼Œä½¿ç”¨è¶…çº§ç®€å•ï¼Œå“åº”é€Ÿåº¦ä¹Ÿè¶…çº§å¿«ã€‚</p> 
<h3><a id="ollama_8"></a>ä½¿ç”¨ollamaæä¾›æœåŠ¡çš„æ–¹å¼å¦‚ä¸‹ï¼š</h3> 
<p>1ã€å®‰è£…GraphRAG:</p> 
<pre><code class="prism language-shell">pip <span class="token function">install</span> graphrag <span class="token parameter variable">-i</span> https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre> 
<ol start="2"><li>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶è·¯å¾„:<code>./ragtest/input</code></li></ol> 
<pre><code class="prism language-shell"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> ./ragtest/input
</code></pre> 
<ol start="3"><li>å°†è¯­æ–™æ–‡æœ¬æ–‡ä»¶æ”¾åœ¨è¿™ä¸ªè·¯å¾„ä¸‹ï¼Œ æ–‡ä»¶æ ¼å¼ä¸ºtxtï¼Œ <strong>æ³¨æ„</strong>ï¼štxtæ–‡ä»¶å¿…é¡»æ˜¯<code>utf-8</code>ç¼–ç çš„ï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€å¦å­˜ä¸ºå¾—åˆ°ã€‚</li><li>ä½¿ç”¨å‘½ä»¤<code>python -m graphrag.index --init --root ./ragtest</code>åˆå§‹åŒ–å·¥ç¨‹:</li></ol> 
<pre><code class="prism language-shell">python <span class="token parameter variable">-m</span> graphrag.index <span class="token parameter variable">--init</span> <span class="token parameter variable">--root</span> ./ragtest
</code></pre> 
<ol start="5"><li>ä¿®æ”¹<code>.env</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹:</li></ol> 
<pre><code class="prism language-shell"><span class="token assign-left variable">GRAPHRAG_API_KEY</span><span class="token operator">=</span>ollama
<span class="token assign-left variable">GRAPHRAG_CLAIM_EXTRACTION_ENABLED</span><span class="token operator">=</span>True
</code></pre> 
<p><strong>æ³¨æ„</strong>ï¼šå¿…é¡»åŠ ä¸Šå‚æ•°<code>GRAPHRAG_CLAIM_EXTRACTION_ENABLED=True</code>ï¼Œå¦åˆ™æ— æ³•ç”Ÿæˆåå˜é‡covariatesï¼Œ åœ¨Local Searchæ—¶ä¼šå‡ºé”™ã€‚</p> 
<ol start="6"><li>ä¿®æ”¹.<code>setting.yaml</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹:</li></ol> 
<pre><code class="prism language-yaml"><span class="token key atrule">encoding_model</span><span class="token punctuation">:</span> cl100k_base
<span class="token key atrule">skip_workflows</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token key atrule">llm</span><span class="token punctuation">:</span>
  <span class="token key atrule">api_key</span><span class="token punctuation">:</span> ollama
  <span class="token key atrule">type</span><span class="token punctuation">:</span> openai_chat <span class="token comment"># or azure_openai_chat</span>
  <span class="token key atrule">model</span><span class="token punctuation">:</span> qwen2
  <span class="token key atrule">model_supports_json</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># recommended if this is available for your model.</span>
  <span class="token comment"># max_tokens: 4000</span>
  <span class="token comment"># request_timeout: 180.0</span>
  <span class="token key atrule">api_base</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>11434/v1/
  <span class="token comment"># api_version: 2024-02-15-preview</span>
  <span class="token comment"># organization: &lt;organization_id&gt;</span>
  <span class="token comment"># deployment_name: &lt;azure_model_deployment_name&gt;</span>
  <span class="token comment"># tokens_per_minute: 150_000 # set a leaky bucket throttle</span>
  <span class="token comment"># requests_per_minute: 10_000 # set a leaky bucket throttle</span>
  <span class="token comment"># max_retries: 10</span>
  <span class="token comment"># max_retry_wait: 10.0</span>
  <span class="token comment"># sleep_on_rate_limit_recommendation: true # whether to sleep when azure suggests wait-times</span>
  <span class="token comment"># concurrent_requests: 25 # the number of parallel inflight requests that may be made</span>

<span class="token key atrule">parallelization</span><span class="token punctuation">:</span>
  <span class="token key atrule">stagger</span><span class="token punctuation">:</span> <span class="token number">0.3</span>
  <span class="token comment"># num_threads: 50 # the number of threads to use for parallel processing</span>

<span class="token key atrule">async_mode</span><span class="token punctuation">:</span> threaded <span class="token comment"># or asyncio</span>

<span class="token key atrule">embeddings</span><span class="token punctuation">:</span>
  <span class="token comment">## parallelization: override the global parallelization settings for embeddings</span>
  <span class="token key atrule">async_mode</span><span class="token punctuation">:</span> threaded <span class="token comment"># or asyncio</span>
  <span class="token key atrule">llm</span><span class="token punctuation">:</span>
    <span class="token key atrule">api_key</span><span class="token punctuation">:</span> ollama
    <span class="token key atrule">type</span><span class="token punctuation">:</span> openai_embedding <span class="token comment"># or azure_openai_embedding</span>
    <span class="token key atrule">model</span><span class="token punctuation">:</span> nomic<span class="token punctuation">-</span>embed<span class="token punctuation">-</span>text
    <span class="token key atrule">api_base</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>11434/api
    <span class="token comment"># api_version: 2024-02-15-preview</span>
    <span class="token comment"># organization: &lt;organization_id&gt;</span>
    <span class="token comment"># deployment_name: &lt;azure_model_deployment_name&gt;</span>
    <span class="token comment"># tokens_per_minute: 150_000 # set a leaky bucket throttle</span>
    <span class="token comment"># requests_per_minute: 10_000 # set a leaky bucket throttle</span>
    <span class="token comment"># max_retries: 10</span>
    <span class="token comment"># max_retry_wait: 10.0</span>
    <span class="token comment"># sleep_on_rate_limit_recommendation: true # whether to sleep when azure suggests wait-times</span>
    <span class="token comment"># concurrent_requests: 25 # the number of parallel inflight requests that may be made</span>
    <span class="token comment"># batch_size: 16 # the number of documents to send in a single request</span>
    <span class="token comment"># batch_max_tokens: 8191 # the maximum number of tokens to send in a single request</span>
    <span class="token comment"># target: required # or optional</span>
    <span class="token punctuation">...</span>
  
</code></pre> 
<ol start="7"><li>ä½¿ç”¨ollamaå¯åŠ¨llmå’ŒEmbeddingæœåŠ¡ï¼Œå…¶ä¸­embedding æ¨¡å‹æ˜¯<code>nomic-embed-text</code>:</li></ol> 
<pre><code class="prism language-shell">ollama pull qwen2
ollama pull nomic-embed-text
ollama serve
</code></pre> 
<ol start="8"><li>ä¿®æ”¹æ–‡ä»¶:<code>D:\ProgramData\miniconda3\envs\graphRAG\Lib\site-packages\graphrag\llm\openai\openai_embeddings_llm.py</code>å†…å®¹(æ ¹æ®å¤§å®¶è‡ªå·±å®‰è£…GraphRAGçš„è·¯å¾„æŸ¥æ‰¾)ï¼Œè°ƒç”¨ollamaæœåŠ¡:</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> ollama

<span class="token comment"># ....</span>

<span class="token keyword">class</span> <span class="token class-name">OpenAIEmbeddingsLLM</span><span class="token punctuation">(</span>BaseLLM<span class="token punctuation">[</span>EmbeddingInput<span class="token punctuation">,</span> EmbeddingOutput<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""A text-embedding generator LLM."""</span>

    _client<span class="token punctuation">:</span> OpenAIClientTypes
    _configuration<span class="token punctuation">:</span> OpenAIConfiguration

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> client<span class="token punctuation">:</span> OpenAIClientTypes<span class="token punctuation">,</span> configuration<span class="token punctuation">:</span> OpenAIConfiguration<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>client <span class="token operator">=</span> client
        self<span class="token punctuation">.</span>configuration <span class="token operator">=</span> configuration

    <span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">_execute_llm</span><span class="token punctuation">(</span>
        self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">:</span> EmbeddingInput<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">:</span> Unpack<span class="token punctuation">[</span>LLMInput<span class="token punctuation">]</span>
    <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> EmbeddingOutput <span class="token operator">|</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        args <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"model"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span>model<span class="token punctuation">,</span>
            <span class="token operator">**</span><span class="token punctuation">(</span>kwargs<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"model_parameters"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token triple-quoted-string string">'''
        embedding = await self.client.embeddings.create(
            input=input,
            **args,
        )
        return [d.embedding for d in embedding.data]
        '''</span>
        embedding_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> inp <span class="token keyword">in</span> <span class="token builtin">input</span><span class="token punctuation">:</span>
            embedding <span class="token operator">=</span> ollama<span class="token punctuation">.</span>embeddings<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">"nomic-embed-text"</span><span class="token punctuation">,</span>prompt<span class="token operator">=</span>inp<span class="token punctuation">)</span>
            embedding_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>embedding<span class="token punctuation">[</span><span class="token string">"embedding"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> embedding_list

</code></pre> 
<p>ä¸Šé¢æ³¨é‡Šéƒ¨åˆ†ä¸ºå®˜æ–¹åŸå§‹ä»£ç ï¼Œå¢åŠ çš„ä»£ç æ˜¯:</p> 
<pre><code class="prism language-python">        embedding_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> inp <span class="token keyword">in</span> <span class="token builtin">input</span><span class="token punctuation">:</span>
            embedding <span class="token operator">=</span> ollama<span class="token punctuation">.</span>embedding<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">"nomic-embed-text"</span><span class="token punctuation">,</span>prompt<span class="token operator">=</span>inp<span class="token punctuation">)</span>
            embedding_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>embedding<span class="token punctuation">[</span><span class="token string">"embedding"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> embedding_list
</code></pre> 
<ol start="9"><li>ä¿®æ”¹æ–‡ä»¶ï¼š<code>D:\ProgramData\miniconda3\envs\graphRAG\Lib\site-packages\graphrag\query\llm\oai\embedding.py</code>, è°ƒç”¨ollamaæä¾›çš„æ¨¡å‹æœåŠ¡ï¼Œ ä»£ç ä½ç½®åœ¨:</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> ollama
<span class="token comment">#.....</span>

embedding <span class="token operator">=</span> ollama<span class="token punctuation">.</span>embeddings<span class="token punctuation">(</span>model<span class="token operator">=</span><span class="token string">'nomic-embed-text'</span><span class="token punctuation">,</span> prompt<span class="token operator">=</span>chunk<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'embedding'</span><span class="token punctuation">]</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b5/65/FmvxNWoa_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> ä¸Šé¢æ³¨é‡Šçš„æ˜¯å®˜æ–¹ä»£ç ï¼Œç®­å¤´æŒ‡å‘çš„æ˜¯è¦æ–°å¢çš„ä»£ç ã€‚</p> 
<ol start="10"><li>ä¿®æ”¹æ–‡ä»¶:<code>D:\ProgramData\miniconda3\envs\graphRAG\Lib\site-packages\graphrag\query\llm\text_utils.py</code>é‡Œå…³äº<code>chunk_text()</code>å‡½æ•°çš„å®šä¹‰:</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">chunk_text</span><span class="token punctuation">(</span>
    text<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> max_tokens<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> token_encoder<span class="token punctuation">:</span> tiktoken<span class="token punctuation">.</span>Encoding <span class="token operator">|</span> <span class="token boolean">None</span> <span class="token operator">=</span> <span class="token boolean">None</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Chunk text by token length."""</span>
    <span class="token keyword">if</span> token_encoder <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        token_encoder <span class="token operator">=</span> tiktoken<span class="token punctuation">.</span>get_encoding<span class="token punctuation">(</span><span class="token string">"cl100k_base"</span><span class="token punctuation">)</span>
    tokens <span class="token operator">=</span> token_encoder<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>text<span class="token punctuation">)</span>  <span class="token comment"># type: ignore</span>
    tokens <span class="token operator">=</span> token_encoder<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>tokens<span class="token punctuation">)</span> <span class="token comment"># å°†tokensè§£ç æˆå­—ç¬¦ä¸²</span>

    chunk_iterator <span class="token operator">=</span> batched<span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span>tokens<span class="token punctuation">)</span><span class="token punctuation">,</span> max_tokens<span class="token punctuation">)</span>
    <span class="token keyword">yield</span> <span class="token keyword">from</span> chunk_iterator
</code></pre> 
<p>å¢åŠ çš„è¯­å¥æ˜¯:</p> 
<pre><code class="prism language-python">tokens <span class="token operator">=</span> token_encoder<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>tokens<span class="token punctuation">)</span> <span class="token comment"># å°†tokensè§£ç æˆå­—ç¬¦ä¸²</span>
</code></pre> 
<p>è¿™é‡Œåº”è¯¥æ˜¯GraphRAGå®˜æ–¹ä»£ç é‡Œçš„bugï¼Œå¼€å‘äººå‘˜å¿˜è®°å°†åˆ†è¯åçš„tokenè§£ç æˆå­—ç¬¦ä¸²ï¼Œå¯¼è‡´åœ¨åç»­Embeddingå¤„ç†è¿‡ç¨‹ä¸­ä¼šæŠ¥é”™ï¼š<code>ZeroDivisionError: Weights sum to zero, can't be normalized</code></p> 
<pre><code class="prism language-shell"><span class="token punctuation">(</span>graphrag<span class="token punctuation">)</span> D:<span class="token punctuation">\</span>Learn<span class="token punctuation">\</span>GraphRAG<span class="token operator">&gt;</span>python <span class="token parameter variable">-m</span> graphrag.query <span class="token parameter variable">--root</span> ./newTest12 <span class="token parameter variable">--method</span> <span class="token builtin class-name">local</span> <span class="token string">"è°æ˜¯å¶æ–‡æ´"</span>


INFO: Reading settings from newTest12<span class="token punctuation">\</span>settings.yaml
creating llm client with <span class="token punctuation">{<!-- --></span><span class="token string">'api_key'</span><span class="token builtin class-name">:</span> <span class="token string">'REDACTED,len=6'</span>, <span class="token string">'type'</span><span class="token builtin class-name">:</span> <span class="token string">"openai_chat"</span>, <span class="token string">'model'</span><span class="token builtin class-name">:</span> <span class="token string">'qwen2'</span>, <span class="token string">'max_tokens'</span><span class="token builtin class-name">:</span> <span class="token number">4000</span>, <span class="token string">'temperature'</span><span class="token builtin class-name">:</span> <span class="token number">0.0</span>, <span class="token string">'top_p'</span><span class="token builtin class-name">:</span> <span class="token number">1.0</span>, <span class="token string">'n'</span><span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">'request_timeout'</span><span class="token builtin class-name">:</span> <span class="token number">180.0</span>, <span class="token string">'api_base'</span><span class="token builtin class-name">:</span> <span class="token string">'http://localhost:11434/v1/'</span>, <span class="token string">'api_version'</span><span class="token builtin class-name">:</span> None, <span class="token string">'organization'</span><span class="token builtin class-name">:</span> None, <span class="token string">'proxy'</span><span class="token builtin class-name">:</span> None, <span class="token string">'cognitive_services_endpoint'</span><span class="token builtin class-name">:</span> None, <span class="token string">'deployment_name'</span><span class="token builtin class-name">:</span> None, <span class="token string">'model_supports_json'</span><span class="token builtin class-name">:</span> True, <span class="token string">'tokens_per_minute'</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">'requests_per_minute'</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">'max_retries'</span><span class="token builtin class-name">:</span> <span class="token number">10</span>, <span class="token string">'max_retry_wait'</span><span class="token builtin class-name">:</span> <span class="token number">10.0</span>, <span class="token string">'sleep_on_rate_limit_recommendation'</span><span class="token builtin class-name">:</span> True, <span class="token string">'concurrent_requests'</span><span class="token builtin class-name">:</span> <span class="token number">25</span><span class="token punctuation">}</span>
creating embedding llm client with <span class="token punctuation">{<!-- --></span><span class="token string">'api_key'</span><span class="token builtin class-name">:</span> <span class="token string">'REDACTED,len=9'</span>, <span class="token string">'type'</span><span class="token builtin class-name">:</span> <span class="token string">"openai_embedding"</span>, <span class="token string">'model'</span><span class="token builtin class-name">:</span> <span class="token string">'nomic-ai/nomic-embed-text-v1.5/nomic-embed-text-v1.5.Q8_0.gguf'</span>, <span class="token string">'max_tokens'</span><span class="token builtin class-name">:</span> <span class="token number">4000</span>, <span class="token string">'temperature'</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">'top_p'</span><span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">'n'</span><span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">'request_timeout'</span><span class="token builtin class-name">:</span> <span class="token number">180.0</span>, <span class="token string">'api_base'</span><span class="token builtin class-name">:</span> <span class="token string">'http://localhost:1234/v1'</span>, <span class="token string">'api_version'</span><span class="token builtin class-name">:</span> None, <span class="token string">'organization'</span><span class="token builtin class-name">:</span> None, <span class="token string">'proxy'</span><span class="token builtin class-name">:</span> None, <span class="token string">'cognitive_services_endpoint'</span><span class="token builtin class-name">:</span> None, <span class="token string">'deployment_name'</span><span class="token builtin class-name">:</span> None, <span class="token string">'model_supports_json'</span><span class="token builtin class-name">:</span> None, <span class="token string">'tokens_per_minute'</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">'requests_per_minute'</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">'max_retries'</span><span class="token builtin class-name">:</span> <span class="token number">10</span>, <span class="token string">'max_retry_wait'</span><span class="token builtin class-name">:</span> <span class="token number">10.0</span>, <span class="token string">'sleep_on_rate_limit_recommendation'</span><span class="token builtin class-name">:</span> True, <span class="token string">'concurrent_requests'</span><span class="token builtin class-name">:</span> <span class="token number">1</span><span class="token punctuation">}</span>
Error embedding chunk <span class="token punctuation">{<!-- --></span><span class="token string">'OpenAIEmbedding'</span><span class="token builtin class-name">:</span> <span class="token string">'Error code: 400 - {\'</span>error<span class="token punctuation">\</span>': <span class="token string">"\'input\' field must be a string or an array of strings"</span><span class="token punctuation">}</span><span class="token string">'}
Traceback (most recent call last):
  File "D:\ProgramData\miniconda3\envs\graphrag\lib\runpy.py", line 196, in _run_module_as_main
    return _run_code(code, main_globals, None,
  File "D:\ProgramData\miniconda3\envs\graphrag\lib\runpy.py", line 86, in _run_code
    exec(code, run_globals)
  File "D:\ProgramData\miniconda3\envs\graphrag\lib\site-packages\graphrag\query\__main__.py", line 76, in &lt;module&gt;
    run_local_search(
  File "D:\ProgramData\miniconda3\envs\graphrag\lib\site-packages\graphrag\query\cli.py", line 153, in run_local_search
    result = search_engine.search(query=query)
  File "D:\ProgramData\miniconda3\envs\graphrag\lib\site-packages\graphrag\query\structured_search\local_search\search.py", line 118, in search
    context_text, context_records = self.context_builder.build_context(
  File "D:\ProgramData\miniconda3\envs\graphrag\lib\site-packages\graphrag\query\structured_search\local_search\mixed_context.py", line 139, in build_context
    selected_entities = map_query_to_entities(
  File "D:\ProgramData\miniconda3\envs\graphrag\lib\site-packages\graphrag\query\context_builder\entity_extraction.py", line 55, in map_query_to_entities
    search_results = text_embedding_vectorstore.similarity_search_by_text(
  File "D:\ProgramData\miniconda3\envs\graphrag\lib\site-packages\graphrag\vector_stores\lancedb.py", line 118, in similarity_search_by_text
    query_embedding = text_embedder(text)
  File "D:\ProgramData\miniconda3\envs\graphrag\lib\site-packages\graphrag\query\context_builder\entity_extraction.py", line 57, in &lt;lambda&gt;
    text_embedder=lambda t: text_embedder.embed(t),
  File "D:\ProgramData\miniconda3\envs\graphrag\lib\site-packages\graphrag\query\llm\oai\embedding.py", line 96, in embed
    chunk_embeddings = np.average(chunk_embeddings, axis=0, weights=chunk_lens)
  File "D:\ProgramData\miniconda3\envs\graphrag\lib\site-packages\numpy\lib\function_base.py", line 550, in average
    raise ZeroDivisionError(
ZeroDivisionError: Weights sum to zero, can'</span>t be normalized
</code></pre> 
<ol start="11"><li>å¼€å§‹Indexingå¤„ç†:</li></ol> 
<pre><code class="prism language-shell">python <span class="token parameter variable">-m</span> graphrag.index <span class="token parameter variable">--root</span> ./ragtest
</code></pre> 
<p>è¿è¡Œæ•ˆæœ:</p> 
<pre><code class="prism language-shell"><span class="token punctuation">(</span>graphrag<span class="token punctuation">)</span> D:<span class="token punctuation">\</span>Learn<span class="token punctuation">\</span>GraphRAG<span class="token operator">&gt;</span>python <span class="token parameter variable">-m</span> graphrag.index <span class="token parameter variable">--root</span> ./newTest12
ğŸš€ Reading settings from newTest12<span class="token punctuation">\</span>settings.yaml
D:<span class="token punctuation">\</span>ProgramData<span class="token punctuation">\</span>miniconda3<span class="token punctuation">\</span>envs<span class="token punctuation">\</span>graphrag<span class="token punctuation">\</span>lib<span class="token punctuation">\</span>site-packages<span class="token punctuation">\</span>numpy<span class="token punctuation">\</span>core<span class="token punctuation">\</span>fromnumeric.py:59: FutureWarning:
<span class="token string">'DataFrame.swapaxes'</span> is deprecated and will be removed <span class="token keyword">in</span> a future version. Please use <span class="token string">'DataFrame.transpose'</span> instead.
  <span class="token builtin class-name">return</span> bound<span class="token punctuation">(</span>*args, **kwds<span class="token punctuation">)</span>
ğŸš€ create_base_text_units
                                  <span class="token function">id</span>  <span class="token punctuation">..</span>. n_tokens
<span class="token number">0</span>   eb94998b0499b6271136701074a1d890  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">1</span>   ae83a5ece6993bb8441110c128374267  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">2</span>   8debc287482f854d941a17262b4fe9b4  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">3</span>   0afae36282bd8db18b85ed0ff5c6bfcf  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">4</span>   6029ac47ac05acb22ae6b625c2e726e5  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">5</span>   18a2202cc4756368e833007edc118b83  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">6</span>   0f1ca0e967c49c0eccb0641e4dca1d07  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">7</span>   0f2c27b592f5ed732eb5dbf041475950  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">8</span>   319702df76e338acb4ad3d0e02dd3d6f  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">9</span>   919746c8d00d55401129a3eb6eb335d9  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">10</span>  4cf72e5c48316b181b279c62ada7ee6d  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">11</span>  6a7c6d9db387332aa7d9178d22014fa6  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">12</span>  bd7e44fb9063cf8e02da39443f4c67eb  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">13</span>  3239241f8fba889b9ebd1851c4f68aa5  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">14</span>  c9d05edb3d1a58711f42639e18cdcea2  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">15</span>  a4c53469e9283bad549f1d10568bba4b  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">16</span>  01e50959b91fc167df1bd0fe83f2928b  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">17</span>  91d7b0359c7417bd8c4ff0931c6ba236  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">18</span>  0c2f21e8f141de2a2e03f17a875de54a  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">19</span>  7716c29d83922f69e228eca2c99128ce  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">20</span>  af2ef2f39176a565b509d48ef91f5ca6  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">21</span>  38a919532f499e6c873162a050619f31  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">22</span>  587fbda555a7a3a371ae35b16084f555  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">23</span>  4dbcb435fc91cdbe2bbd4ca075e7df4d  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">24</span>  a08a77fbbf1ea343ef915b776beb4fad  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">25</span>  5d57d8d015e8d98ef355f0f42e114bb0  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">26</span>  cba7a1ca9b4099be67035d5263d3cbab  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">27</span>  403ee5e0425c850acea5f66494ab5590  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">28</span>  f19574bd0b5f9db26188fbe7ce063035  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">29</span>  f0577fe53579d7da7f4bded3cc209220  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">30</span>  01ba18a8dc1159200e6e5418392b2de1  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">31</span>  3bec09f620a572b869885b19b82c520e  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">32</span>  8081e9512c0bd1163378659ea18fa589  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">33</span>  78fb8731a8b51236488c07546bb39ab0  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">34</span>  949ee97d8a055ea639b65db190326580  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">35</span>  d7c149cd8df10e29d99c0a257cbab60f  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">36</span>  42241043af1a3ae708fe06d4644b79fe  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">37</span>  824ff7fe74b00fa6af083d9c42bfe0ef  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">38</span>  43adb8cbfbfb7f8631ff19988d27f8f0  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">39</span>  a621a38808af24546ac397393e8bc6be  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">40</span>  5ee1a053b42c395db7c0abdc55e88af7  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">41</span>  364150258ec05bb31b80141b75d7a5ca  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">42</span>  d760b8e30ecd977add71ba4274b0c9dd  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">43</span>  ebf935b232b056a6973cb6763a532a43  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">44</span>  299966570cf5d14d7d46a4a81555907b  <span class="token punctuation">..</span>.      <span class="token number">300</span>
<span class="token number">45</span>  d6e4272bf5306dd8d1054e9a56ad7114  <span class="token punctuation">..</span>.      <span class="token number">200</span>

<span class="token punctuation">[</span><span class="token number">46</span> rows x <span class="token number">5</span> columns<span class="token punctuation">]</span>
ğŸš€ create_base_extracted_entities
                                        entity_graph
<span class="token number">0</span>  <span class="token operator">&lt;</span>graphml <span class="token assign-left variable">xmlns</span><span class="token operator">=</span><span class="token string">"http://graphml.graphdrawing.or...
D:\ProgramData\miniconda3<span class="token entity" title="\e">\e</span>nvs\graphrag\lib\site-packages\datashaper<span class="token entity" title="\e">\e</span>ngine<span class="token entity" title="\v">\v</span>erbs<span class="token entity" title="\c">\c</span>onvert.py:65: FutureWarning:
errors='ignore' is deprecated and will raise in a future version. Use to_numeric without passing <span class="token variable"><span class="token variable">`</span>errors<span class="token variable">`</span></span> and catch
exceptions explicitly instead
  column_numeric = cast(pd.Series, pd.to_numeric(column, errors="</span>ignore<span class="token string">"))
ğŸš€ create_final_covariates
                                      id human_readable_id  ...                        document_ids n_tokens
0   fa863911-f68e-4f11-bf1f-5c074ce528c8                 1  ...  [9907241b0721ab0f48fbbc9d784175eb]      300
1   6245da46-086e-476c-b4b7-b3efc1bd82bb                 2  ...  [9907241b0721ab0f48fbbc9d784175eb]      300
2   7f4ee402-0065-4b2e-a5d8-3eef944b18f3                 3  ...  [9907241b0721ab0f48fbbc9d784175eb]      300
3   1927e65b-3a8c-4c3a-bda8-4bbc1804737f                 4  ...  [9907241b0721ab0f48fbbc9d784175eb]      300
4   ebb53a51-9f03-4ede-924b-93f6f74320da                 5  ...  [9907241b0721ab0f48fbbc9d784175eb]      300
..                                   ...               ...  ...                                 ...      ...
56  81dc46bc-1c00-46a8-b745-aae710bfd949                57  ...  [9907241b0721ab0f48fbbc9d784175eb]      300
57  c96c929d-80be-4fc5-a865-ced074fe2f01                58  ...  [9907241b0721ab0f48fbbc9d784175eb]      300
58  785b12a8-3669-48fc-a017-f8fa1b60348e                59  ...  [9907241b0721ab0f48fbbc9d784175eb]      300
59  47cb429c-c402-4eb9-bcab-4c427cea6176                60  ...  [9907241b0721ab0f48fbbc9d784175eb]      300
60  701529fc-1499-4efe-bdac-0bc3a49a942c                61  ...  [9907241b0721ab0f48fbbc9d784175eb]      200

[61 rows x 16 columns]
ğŸš€ create_summarized_entities
                                        entity_graph
0  &lt;graphml xmlns="</span>http://graphml.graphdrawing.or<span class="token punctuation">..</span>.
ğŸš€ join_text_units_to_covariate_ids
                        text_unit_id  <span class="token punctuation">..</span>.                                <span class="token function">id</span>
<span class="token number">0</span>   eb94998b0499b6271136701074a1d890  <span class="token punctuation">..</span>.  eb94998b0499b6271136701074a1d890
<span class="token number">1</span>   ae83a5ece6993bb8441110c128374267  <span class="token punctuation">..</span>.  ae83a5ece6993bb8441110c128374267
<span class="token number">2</span>   8debc287482f854d941a17262b4fe9b4  <span class="token punctuation">..</span>.  8debc287482f854d941a17262b4fe9b4
<span class="token number">3</span>   0afae36282bd8db18b85ed0ff5c6bfcf  <span class="token punctuation">..</span>.  0afae36282bd8db18b85ed0ff5c6bfcf
<span class="token number">4</span>   6029ac47ac05acb22ae6b625c2e726e5  <span class="token punctuation">..</span>.  6029ac47ac05acb22ae6b625c2e726e5
<span class="token number">5</span>   18a2202cc4756368e833007edc118b83  <span class="token punctuation">..</span>.  18a2202cc4756368e833007edc118b83
<span class="token number">6</span>   0f1ca0e967c49c0eccb0641e4dca1d07  <span class="token punctuation">..</span>.  0f1ca0e967c49c0eccb0641e4dca1d07
<span class="token number">7</span>   0f2c27b592f5ed732eb5dbf041475950  <span class="token punctuation">..</span>.  0f2c27b592f5ed732eb5dbf041475950
<span class="token number">8</span>   319702df76e338acb4ad3d0e02dd3d6f  <span class="token punctuation">..</span>.  319702df76e338acb4ad3d0e02dd3d6f
<span class="token number">9</span>   919746c8d00d55401129a3eb6eb335d9  <span class="token punctuation">..</span>.  919746c8d00d55401129a3eb6eb335d9
<span class="token number">10</span>  4cf72e5c48316b181b279c62ada7ee6d  <span class="token punctuation">..</span>.  4cf72e5c48316b181b279c62ada7ee6d
<span class="token number">11</span>  6a7c6d9db387332aa7d9178d22014fa6  <span class="token punctuation">..</span>.  6a7c6d9db387332aa7d9178d22014fa6
<span class="token number">12</span>  bd7e44fb9063cf8e02da39443f4c67eb  <span class="token punctuation">..</span>.  bd7e44fb9063cf8e02da39443f4c67eb
<span class="token number">13</span>  3239241f8fba889b9ebd1851c4f68aa5  <span class="token punctuation">..</span>.  3239241f8fba889b9ebd1851c4f68aa5
<span class="token number">14</span>  c9d05edb3d1a58711f42639e18cdcea2  <span class="token punctuation">..</span>.  c9d05edb3d1a58711f42639e18cdcea2
<span class="token number">15</span>  a4c53469e9283bad549f1d10568bba4b  <span class="token punctuation">..</span>.  a4c53469e9283bad549f1d10568bba4b
<span class="token number">16</span>  01e50959b91fc167df1bd0fe83f2928b  <span class="token punctuation">..</span>.  01e50959b91fc167df1bd0fe83f2928b
<span class="token number">17</span>  91d7b0359c7417bd8c4ff0931c6ba236  <span class="token punctuation">..</span>.  91d7b0359c7417bd8c4ff0931c6ba236
<span class="token number">18</span>  0c2f21e8f141de2a2e03f17a875de54a  <span class="token punctuation">..</span>.  0c2f21e8f141de2a2e03f17a875de54a
<span class="token number">19</span>  7716c29d83922f69e228eca2c99128ce  <span class="token punctuation">..</span>.  7716c29d83922f69e228eca2c99128ce
<span class="token number">20</span>  af2ef2f39176a565b509d48ef91f5ca6  <span class="token punctuation">..</span>.  af2ef2f39176a565b509d48ef91f5ca6
<span class="token number">21</span>  38a919532f499e6c873162a050619f31  <span class="token punctuation">..</span>.  38a919532f499e6c873162a050619f31
<span class="token number">22</span>  587fbda555a7a3a371ae35b16084f555  <span class="token punctuation">..</span>.  587fbda555a7a3a371ae35b16084f555
<span class="token number">23</span>  4dbcb435fc91cdbe2bbd4ca075e7df4d  <span class="token punctuation">..</span>.  4dbcb435fc91cdbe2bbd4ca075e7df4d
<span class="token number">24</span>  a08a77fbbf1ea343ef915b776beb4fad  <span class="token punctuation">..</span>.  a08a77fbbf1ea343ef915b776beb4fad
<span class="token number">25</span>  5d57d8d015e8d98ef355f0f42e114bb0  <span class="token punctuation">..</span>.  5d57d8d015e8d98ef355f0f42e114bb0
<span class="token number">26</span>  f0577fe53579d7da7f4bded3cc209220  <span class="token punctuation">..</span>.  f0577fe53579d7da7f4bded3cc209220
<span class="token number">27</span>  8081e9512c0bd1163378659ea18fa589  <span class="token punctuation">..</span>.  8081e9512c0bd1163378659ea18fa589
<span class="token number">28</span>  78fb8731a8b51236488c07546bb39ab0  <span class="token punctuation">..</span>.  78fb8731a8b51236488c07546bb39ab0
<span class="token number">29</span>  949ee97d8a055ea639b65db190326580  <span class="token punctuation">..</span>.  949ee97d8a055ea639b65db190326580
<span class="token number">30</span>  d7c149cd8df10e29d99c0a257cbab60f  <span class="token punctuation">..</span>.  d7c149cd8df10e29d99c0a257cbab60f
<span class="token number">31</span>  42241043af1a3ae708fe06d4644b79fe  <span class="token punctuation">..</span>.  42241043af1a3ae708fe06d4644b79fe
<span class="token number">32</span>  824ff7fe74b00fa6af083d9c42bfe0ef  <span class="token punctuation">..</span>.  824ff7fe74b00fa6af083d9c42bfe0ef
<span class="token number">33</span>  a621a38808af24546ac397393e8bc6be  <span class="token punctuation">..</span>.  a621a38808af24546ac397393e8bc6be
<span class="token number">34</span>  ebf935b232b056a6973cb6763a532a43  <span class="token punctuation">..</span>.  ebf935b232b056a6973cb6763a532a43
<span class="token number">35</span>  299966570cf5d14d7d46a4a81555907b  <span class="token punctuation">..</span>.  299966570cf5d14d7d46a4a81555907b
<span class="token number">36</span>  d6e4272bf5306dd8d1054e9a56ad7114  <span class="token punctuation">..</span>.  d6e4272bf5306dd8d1054e9a56ad7114

<span class="token punctuation">[</span><span class="token number">37</span> rows x <span class="token number">3</span> columns<span class="token punctuation">]</span>
ğŸš€ create_base_entity_graph
   level                                    clustered_graph
<span class="token number">0</span>      <span class="token number">0</span>  <span class="token operator">&lt;</span>graphml <span class="token assign-left variable">xmlns</span><span class="token operator">=</span><span class="token string">"http://graphml.graphdrawing.or...
D:\ProgramData\miniconda3<span class="token entity" title="\e">\e</span>nvs\graphrag\lib\site-packages<span class="token entity" title="\n">\n</span>umpy<span class="token entity" title="\c">\c</span>ore<span class="token entity" title="\f">\f</span>romnumeric.py:59: FutureWarning:
'DataFrame.swapaxes' is deprecated and will be removed in a future version. Please use 'DataFrame.transpose' instead.
  return bound(*args, **kwds)
D:\ProgramData\miniconda3<span class="token entity" title="\e">\e</span>nvs\graphrag\lib\site-packages<span class="token entity" title="\n">\n</span>umpy<span class="token entity" title="\c">\c</span>ore<span class="token entity" title="\f">\f</span>romnumeric.py:59: FutureWarning:
'DataFrame.swapaxes' is deprecated and will be removed in a future version. Please use 'DataFrame.transpose' instead.
  return bound(*args, **kwds)
ğŸš€ create_final_entities
                                  id  ...                              description_embedding
0   b45241d70f0e43fca764df95b2b81f77  ...  [-0.037392858415842056, 0.06525952368974686, -...
1   4119fd06010c494caa07f439b333f4c5  ...  [0.010907179675996304, 0.026875361800193787, -...
2   d3835bf3dda84ead99deadbeac5d0d7d  ...  [0.054428134113550186, -9.018656419357285e-05,...
3   077d2820ae1845bcbb1803379a3d1eae  ...  [0.020732643082737923, 0.0034371891524642706, ...
4   3671ea0dd4e84c1a9b02c5ab2c8f4bac  ...  [-0.0012893152888864279, 0.037432845681905746,...
..                               ...  ...                                                ...
59  958beecdb5bb4060948415ffd75d2b03  ...  [0.01642344333231449, 0.021773478016257286, -0...
60  b999ed77e19e4f85b7f1ae79af5c002a  ...  [0.002400514902547002, 0.047308988869190216, -...
61  48c0c4d72da74ff5bb926fa0c856d1a7  ...  [-0.01692129857838154, 0.0539858303964138, -0....
62  4f3c97517f794ebfb49c4c6315f9cf23  ...  [0.0010956701589748263, 0.04648151248693466, -...
63  1745a2485a9443bab76587ad650e9be0  ...  [-0.007561820093542337, 0.045520562678575516, ...

[64 rows x 8 columns]
D:\ProgramData\miniconda3<span class="token entity" title="\e">\e</span>nvs\graphrag\lib\site-packages<span class="token entity" title="\n">\n</span>umpy<span class="token entity" title="\c">\c</span>ore<span class="token entity" title="\f">\f</span>romnumeric.py:59: FutureWarning:
'DataFrame.swapaxes' is deprecated and will be removed in a future version. Please use 'DataFrame.transpose' instead.
  return bound(*args, **kwds)
D:\ProgramData\miniconda3<span class="token entity" title="\e">\e</span>nvs\graphrag\lib\site-packages\datashaper<span class="token entity" title="\e">\e</span>ngine<span class="token entity" title="\v">\v</span>erbs<span class="token entity" title="\c">\c</span>onvert.py:72: FutureWarning:
errors='ignore' is deprecated and will raise in a future version. Use to_datetime without passing <span class="token variable"><span class="token variable">`</span>errors<span class="token variable">`</span></span> and catch
exceptions explicitly instead
  datetime_column = pd.to_datetime(column, errors="</span>ignore<span class="token string">")
D:\ProgramData\miniconda3<span class="token entity" title="\e">\e</span>nvs\graphrag\lib\site-packages\datashaper<span class="token entity" title="\e">\e</span>ngine<span class="token entity" title="\v">\v</span>erbs<span class="token entity" title="\c">\c</span>onvert.py:72: UserWarning: Could not
infer format, so each element will be parsed individually, falling back to <span class="token variable"><span class="token variable">`</span>dateutil<span class="token variable">`</span></span>. To ensure parsing is consistent
and as-expected, please specify a format.
  datetime_column = pd.to_datetime(column, errors="</span>ignore<span class="token string">")
ğŸš€ create_final_nodes
    level     title            type  ...                 top_level_node_id  x  y
0       0    "</span>çº¢è‰²è”åˆ<span class="token string">"  "</span>ORGANIZATION<span class="token string">"  ...  b45241d70f0e43fca764df95b2b81f77  0  0
1       0  "</span>å››Â·äºŒå…«å…µå›¢<span class="token string">"  "</span>ORGANIZATION<span class="token string">"  ...  4119fd06010c494caa07f439b333f4c5  0  0
2       0   "</span><span class="token number">1967</span>å¹´<span class="token string">"         "</span>EVENT<span class="token string">"  ...  d3835bf3dda84ead99deadbeac5d0d7d  0  0
3       0    "</span>å®‰çœ è¯ç“¶<span class="token string">"        "</span>OBJECT<span class="token string">"  ...  077d2820ae1845bcbb1803379a3d1eae  0  0
4       0     "</span>é“ç‚‰å­<span class="token string">"           "</span>GEO<span class="token string">"  ...  3671ea0dd4e84c1a9b02c5ab2c8f4bac  0  0
..    ...       ...             ...  ...                               ... .. ..
59      0     "</span>è€æ ¡å·¥<span class="token string">"  "</span>ORGANIZATION<span class="token string">"  ...  958beecdb5bb4060948415ffd75d2b03  0  0
60      0   "</span>æ•™å·¥å®¿èˆæ¥¼<span class="token string">"           "</span>GEO<span class="token string">"  ...  b999ed77e19e4f85b7f1ae79af5c002a  0  0
61      0     "</span>é˜®è€å¸ˆ<span class="token string">"        "</span>PERSON<span class="token string">"  ...  48c0c4d72da74ff5bb926fa0c856d1a7  0  0
62      0      "</span>é˜®é›¯<span class="token string">"        "</span>PERSON<span class="token string">"  ...  4f3c97517f794ebfb49c4c6315f9cf23  0  0
63      0      "</span>æ–‡æ´<span class="token string">"        "</span>PERSON<span class="token string">"  ...  1745a2485a9443bab76587ad650e9be0  0  0

[64 rows x 14 columns]
D:\ProgramData\miniconda3<span class="token entity" title="\e">\e</span>nvs\graphrag\lib\site-packages<span class="token entity" title="\n">\n</span>umpy<span class="token entity" title="\c">\c</span>ore<span class="token entity" title="\f">\f</span>romnumeric.py:59: FutureWarning:
'DataFrame.swapaxes' is deprecated and will be removed in a future version. Please use 'DataFrame.transpose' instead.
  return bound(*args, **kwds)
D:\ProgramData\miniconda3<span class="token entity" title="\e">\e</span>nvs\graphrag\lib\site-packages<span class="token entity" title="\n">\n</span>umpy<span class="token entity" title="\c">\c</span>ore<span class="token entity" title="\f">\f</span>romnumeric.py:59: FutureWarning:
'DataFrame.swapaxes' is deprecated and will be removed in a future version. Please use 'DataFrame.transpose' instead.
  return bound(*args, **kwds)
ğŸš€ create_final_communities
  id        title  ...                                   relationship_ids
text_unit_ids
0  0  Community 0  ...  [32e6ccab20d94029811127dbbe424c64, 94a964c6992...
[0f2c27b592f5ed732eb5dbf041475950,a621a38808af...

[1 rows x 6 columns]
ğŸš€ join_text_units_to_entity_ids
                       text_unit_ids  ...                                id
0   0f1ca0e967c49c0eccb0641e4dca1d07  ...  0f1ca0e967c49c0eccb0641e4dca1d07
1   18a2202cc4756368e833007edc118b83  ...  18a2202cc4756368e833007edc118b83
2   6029ac47ac05acb22ae6b625c2e726e5  ...  6029ac47ac05acb22ae6b625c2e726e5
3   eb94998b0499b6271136701074a1d890  ...  eb94998b0499b6271136701074a1d890
4   0c2f21e8f141de2a2e03f17a875de54a  ...  0c2f21e8f141de2a2e03f17a875de54a
5   0f2c27b592f5ed732eb5dbf041475950  ...  0f2c27b592f5ed732eb5dbf041475950
6   319702df76e338acb4ad3d0e02dd3d6f  ...  319702df76e338acb4ad3d0e02dd3d6f
7   3bec09f620a572b869885b19b82c520e  ...  3bec09f620a572b869885b19b82c520e
8   403ee5e0425c850acea5f66494ab5590  ...  403ee5e0425c850acea5f66494ab5590
9   5d57d8d015e8d98ef355f0f42e114bb0  ...  5d57d8d015e8d98ef355f0f42e114bb0
10  5ee1a053b42c395db7c0abdc55e88af7  ...  5ee1a053b42c395db7c0abdc55e88af7
11  949ee97d8a055ea639b65db190326580  ...  949ee97d8a055ea639b65db190326580
12  af2ef2f39176a565b509d48ef91f5ca6  ...  af2ef2f39176a565b509d48ef91f5ca6
13  f19574bd0b5f9db26188fbe7ce063035  ...  f19574bd0b5f9db26188fbe7ce063035
14  ae83a5ece6993bb8441110c128374267  ...  ae83a5ece6993bb8441110c128374267
15  8debc287482f854d941a17262b4fe9b4  ...  8debc287482f854d941a17262b4fe9b4
16  0afae36282bd8db18b85ed0ff5c6bfcf  ...  0afae36282bd8db18b85ed0ff5c6bfcf
17  3239241f8fba889b9ebd1851c4f68aa5  ...  3239241f8fba889b9ebd1851c4f68aa5
18  c9d05edb3d1a58711f42639e18cdcea2  ...  c9d05edb3d1a58711f42639e18cdcea2
19  a621a38808af24546ac397393e8bc6be  ...  a621a38808af24546ac397393e8bc6be
20  919746c8d00d55401129a3eb6eb335d9  ...  919746c8d00d55401129a3eb6eb335d9
21  4cf72e5c48316b181b279c62ada7ee6d  ...  4cf72e5c48316b181b279c62ada7ee6d
22  6a7c6d9db387332aa7d9178d22014fa6  ...  6a7c6d9db387332aa7d9178d22014fa6
23  8081e9512c0bd1163378659ea18fa589  ...  8081e9512c0bd1163378659ea18fa589
24  91d7b0359c7417bd8c4ff0931c6ba236  ...  91d7b0359c7417bd8c4ff0931c6ba236
25  a4c53469e9283bad549f1d10568bba4b  ...  a4c53469e9283bad549f1d10568bba4b
26  bd7e44fb9063cf8e02da39443f4c67eb  ...  bd7e44fb9063cf8e02da39443f4c67eb
27  d7c149cd8df10e29d99c0a257cbab60f  ...  d7c149cd8df10e29d99c0a257cbab60f
28  f0577fe53579d7da7f4bded3cc209220  ...  f0577fe53579d7da7f4bded3cc209220
29  01e50959b91fc167df1bd0fe83f2928b  ...  01e50959b91fc167df1bd0fe83f2928b
30  7716c29d83922f69e228eca2c99128ce  ...  7716c29d83922f69e228eca2c99128ce
31  38a919532f499e6c873162a050619f31  ...  38a919532f499e6c873162a050619f31
32  587fbda555a7a3a371ae35b16084f555  ...  587fbda555a7a3a371ae35b16084f555
33  4dbcb435fc91cdbe2bbd4ca075e7df4d  ...  4dbcb435fc91cdbe2bbd4ca075e7df4d
34  a08a77fbbf1ea343ef915b776beb4fad  ...  a08a77fbbf1ea343ef915b776beb4fad
35  cba7a1ca9b4099be67035d5263d3cbab  ...  cba7a1ca9b4099be67035d5263d3cbab
36  01ba18a8dc1159200e6e5418392b2de1  ...  01ba18a8dc1159200e6e5418392b2de1
37  78fb8731a8b51236488c07546bb39ab0  ...  78fb8731a8b51236488c07546bb39ab0
38  42241043af1a3ae708fe06d4644b79fe  ...  42241043af1a3ae708fe06d4644b79fe
39  824ff7fe74b00fa6af083d9c42bfe0ef  ...  824ff7fe74b00fa6af083d9c42bfe0ef
40  43adb8cbfbfb7f8631ff19988d27f8f0  ...  43adb8cbfbfb7f8631ff19988d27f8f0
41  299966570cf5d14d7d46a4a81555907b  ...  299966570cf5d14d7d46a4a81555907b
42  364150258ec05bb31b80141b75d7a5ca  ...  364150258ec05bb31b80141b75d7a5ca
43  d760b8e30ecd977add71ba4274b0c9dd  ...  d760b8e30ecd977add71ba4274b0c9dd
44  ebf935b232b056a6973cb6763a532a43  ...  ebf935b232b056a6973cb6763a532a43
45  d6e4272bf5306dd8d1054e9a56ad7114  ...  d6e4272bf5306dd8d1054e9a56ad7114

[46 rows x 3 columns]
D:\ProgramData\miniconda3<span class="token entity" title="\e">\e</span>nvs\graphrag\lib\site-packages<span class="token entity" title="\n">\n</span>umpy<span class="token entity" title="\c">\c</span>ore<span class="token entity" title="\f">\f</span>romnumeric.py:59: FutureWarning:
'DataFrame.swapaxes' is deprecated and will be removed in a future version. Please use 'DataFrame.transpose' instead.
  return bound(*args, **kwds)
D:\ProgramData\miniconda3<span class="token entity" title="\e">\e</span>nvs\graphrag\lib\site-packages<span class="token entity" title="\n">\n</span>umpy<span class="token entity" title="\c">\c</span>ore<span class="token entity" title="\f">\f</span>romnumeric.py:59: FutureWarning:
'DataFrame.swapaxes' is deprecated and will be removed in a future version. Please use 'DataFrame.transpose' instead.
  return bound(*args, **kwds)
D:\ProgramData\miniconda3<span class="token entity" title="\e">\e</span>nvs\graphrag\lib\site-packages\datashaper<span class="token entity" title="\e">\e</span>ngine<span class="token entity" title="\v">\v</span>erbs<span class="token entity" title="\c">\c</span>onvert.py:65: FutureWarning:
errors='ignore' is deprecated and will raise in a future version. Use to_numeric without passing <span class="token variable"><span class="token variable">`</span>errors<span class="token variable">`</span></span> and catch
exceptions explicitly instead
  column_numeric = cast(pd.Series, pd.to_numeric(column, errors="</span>ignore<span class="token string">"))
ğŸš€ create_final_relationships
         source                 target  weight  ... source_degree target_degree rank
0         "</span>SHE<span class="token string">"  "</span>CULTURAL REVOLUTION<span class="token string">"     1.0  ...             1             2    3
1    "</span>THE CITY<span class="token string">"  "</span>CULTURAL REVOLUTION<span class="token string">"     1.0  ...             1             2    3
2  "</span>RED GUARDS<span class="token string">"     "</span>FEMALE RED GUARD<span class="token string">"     1.0  ...             2             1    3
3  "</span>RED GUARDS<span class="token string">"       "</span>MALE RED GUARD<span class="token string">"     1.0  ...             2             1    3
4        "</span>å°çº¢å«å…µ<span class="token string">"          "</span>QUESTIONING<span class="token string">"     1.0  ...             1             1    2

[5 rows x 10 columns]
ğŸš€ join_text_units_to_relationship_ids
                                 id                                   relationship_ids
0  0f2c27b592f5ed732eb5dbf041475950  [32e6ccab20d94029811127dbbe424c64, 94a964c6992...
1  cba7a1ca9b4099be67035d5263d3cbab  [1eb829d0ace042089f0746f78729696c, 015e7b58d1a...
2  8081e9512c0bd1163378659ea18fa589                 [26f88ab3e2e04c33a459ad6270ade565]
ğŸš€ create_final_community_reports
  community  ...                                    id
0         0  ...  a1ceb1f1-c824-420b-a93f-2a76e83a4398

[1 rows x 10 columns]
ğŸš€ create_final_text_units
                                  id  ...                                      covariate_ids
0   0f2c27b592f5ed732eb5dbf041475950  ...  [2c940a06-373b-402e-9203-b7b43b5ff0a4, d5dcbf1...
1   8081e9512c0bd1163378659ea18fa589  ...  [4a8f80d6-6509-4470-a6f2-788fbe81f52e, cbc8bf5...
2   eb94998b0499b6271136701074a1d890  ...  [fa863911-f68e-4f11-bf1f-5c074ce528c8, 6245da4...
3   ae83a5ece6993bb8441110c128374267  ...             [1927e65b-3a8c-4c3a-bda8-4bbc1804737f]
4   8debc287482f854d941a17262b4fe9b4  ...
5   0afae36282bd8db18b85ed0ff5c6bfcf  ...  [5e0d4564-20f6-4d9e-b562-7ffe3f44278d, 2069b5d...
6   6029ac47ac05acb22ae6b625c2e726e5  ...  [f3a2ef27-fb45-473a-bbc9-e43cb9d34d1c, 63dd709...
7   18a2202cc4756368e833007edc118b83  ...             [0eb5023a-8012-4881-8593-2de54301c8bb]
8   0f1ca0e967c49c0eccb0641e4dca1d07  ...
9   319702df76e338acb4ad3d0e02dd3d6f  ...             [423c8608-0d59-41f2-9197-ae612f1239e0]
10  919746c8d00d55401129a3eb6eb335d9  ...             [3d7ecd82-20ac-438e-ac86-997f6ad58cc5]
11  4cf72e5c48316b181b279c62ada7ee6d  ...  [82df9600-0bb7-4d0b-950c-067740692784, f89ecbc...
12  6a7c6d9db387332aa7d9178d22014fa6  ...             [1d4aff9a-f347-4aea-b255-8b9c092421c4]
13  bd7e44fb9063cf8e02da39443f4c67eb  ...
14  3239241f8fba889b9ebd1851c4f68aa5  ...  [87efcce8-fbfb-4806-b2ce-834b2a7327c9, aecb7f3...
15  c9d05edb3d1a58711f42639e18cdcea2  ...             [467b2889-ad04-4d39-b84f-d0567fe220ce]
16  a4c53469e9283bad549f1d10568bba4b  ...
17  01e50959b91fc167df1bd0fe83f2928b  ...             [8afcb698-9fb9-4ee9-bb38-49c854f1f9b6]
18  91d7b0359c7417bd8c4ff0931c6ba236  ...
19  0c2f21e8f141de2a2e03f17a875de54a  ...             [68e16f47-8b94-4f3f-bf8f-30042b0d797e]
20  7716c29d83922f69e228eca2c99128ce  ...  [bf2f48b8-3f39-453c-a020-b8e3c4937f43, f2593f9...
21  af2ef2f39176a565b509d48ef91f5ca6  ...             [9f6423b6-3168-4650-bc27-e7f7d3b4eee1]
22  38a919532f499e6c873162a050619f31  ...             [5a98452e-b66f-4ba8-995a-384a9907424a]
23  587fbda555a7a3a371ae35b16084f555  ...  [628e6f7c-b9ef-494f-a2b6-c5e9ffe58fab, 9943f75...
24  4dbcb435fc91cdbe2bbd4ca075e7df4d  ...             [141cdefd-3e39-41d3-9a05-7b4d3a0e3cda]
25  a08a77fbbf1ea343ef915b776beb4fad  ...             [11d29b8f-f528-455a-af29-0af3dd9c1f69]
26  5d57d8d015e8d98ef355f0f42e114bb0  ...  [b26c0619-4051-4b31-80bb-ba064c7153bd, c12d27f...
27  f0577fe53579d7da7f4bded3cc209220  ...             [1b5269e5-7cdd-4485-ae8d-ed7dffaadda4]
28  78fb8731a8b51236488c07546bb39ab0  ...
29  949ee97d8a055ea639b65db190326580  ...             [97e3724c-eca5-43ed-a308-f23296458464]
30  d7c149cd8df10e29d99c0a257cbab60f  ...             [94eb196e-5a69-4dd4-87dd-92746a88215c]
31  42241043af1a3ae708fe06d4644b79fe  ...             [56c81b53-0bfd-44e3-98dd-3b69d4997b68]
32  824ff7fe74b00fa6af083d9c42bfe0ef  ...             [81dc46bc-1c00-46a8-b745-aae710bfd949]
33  a621a38808af24546ac397393e8bc6be  ...
34  ebf935b232b056a6973cb6763a532a43  ...             [785b12a8-3669-48fc-a017-f8fa1b60348e]
35  299966570cf5d14d7d46a4a81555907b  ...             [47cb429c-c402-4eb9-bcab-4c427cea6176]
36  d6e4272bf5306dd8d1054e9a56ad7114  ...             [701529fc-1499-4efe-bdac-0bc3a49a942c]
37  cba7a1ca9b4099be67035d5263d3cbab  ...                                               None
38  403ee5e0425c850acea5f66494ab5590  ...                                               None
39  f19574bd0b5f9db26188fbe7ce063035  ...                                               None
40  01ba18a8dc1159200e6e5418392b2de1  ...                                               None
41  3bec09f620a572b869885b19b82c520e  ...                                               None
42  43adb8cbfbfb7f8631ff19988d27f8f0  ...                                               None
43  5ee1a053b42c395db7c0abdc55e88af7  ...                                               None
44  364150258ec05bb31b80141b75d7a5ca  ...                                               None
45  d760b8e30ecd977add71ba4274b0c9dd  ...                                               None

[46 rows x 7 columns]
D:\ProgramData\miniconda3<span class="token entity" title="\e">\e</span>nvs\graphrag\lib\site-packages\datashaper<span class="token entity" title="\e">\e</span>ngine<span class="token entity" title="\v">\v</span>erbs<span class="token entity" title="\c">\c</span>onvert.py:72: FutureWarning:
errors='ignore' is deprecated and will raise in a future version. Use to_datetime without passing <span class="token variable"><span class="token variable">`</span>errors<span class="token variable">`</span></span> and catch
exceptions explicitly instead
  datetime_column = pd.to_datetime(column, errors="</span>ignore"<span class="token punctuation">)</span>
ğŸš€ create_base_documents
                                 <span class="token function">id</span>  <span class="token punctuation">..</span>.   title
<span class="token number">0</span>  9907241b0721ab0f48fbbc9d784175eb  <span class="token punctuation">..</span>.  01.txt

<span class="token punctuation">[</span><span class="token number">1</span> rows x <span class="token number">4</span> columns<span class="token punctuation">]</span>
ğŸš€ create_final_documents
                                 <span class="token function">id</span>  <span class="token punctuation">..</span>.   title
<span class="token number">0</span>  9907241b0721ab0f48fbbc9d784175eb  <span class="token punctuation">..</span>.  01.txt

<span class="token punctuation">[</span><span class="token number">1</span> rows x <span class="token number">4</span> columns<span class="token punctuation">]</span>
â  GraphRAG Indexer
â”œâ”€â”€ Loading Input <span class="token punctuation">(</span>text<span class="token punctuation">)</span> - <span class="token number">1</span> files loaded <span class="token punctuation">(</span><span class="token number">0</span> filtered<span class="token punctuation">)</span> â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” <span class="token number">100</span>% <span class="token number">0</span>:00:00 <span class="token number">0</span>:00:00
â”œâ”€â”€ create_base_text_units
â”œâ”€â”€ create_base_extracted_entities
â”œâ”€â”€ create_final_covariates
â”œâ”€â”€ create_summarized_entities
â”œâ”€â”€ join_text_units_to_covariate_ids
â”œâ”€â”€ create_base_entity_graph
â”œâ”€â”€ create_final_entities
â”œâ”€â”€ create_final_nodes
â”œâ”€â”€ create_final_communities
â”œâ”€â”€ join_text_units_to_entity_ids
â”œâ”€â”€ create_final_relationships
â”œâ”€â”€ join_text_units_to_relationship_ids
â”œâ”€â”€ create_final_community_reports
â”œâ”€â”€ create_final_text_units
â”œâ”€â”€ create_base_documents
â””â”€â”€ create_final_documents
ğŸš€ All workflows completed successfully.
</code></pre> 
<p>12 . æ‰§è¡Œå…¨å±€æŸ¥è¯¢<code>global Search</code>:</p> 
<pre><code class="prism language-shell">python <span class="token parameter variable">-m</span> graphrag.query <span class="token parameter variable">--root</span> ./newTest12 <span class="token parameter variable">--method</span> global <span class="token string">"è°æ˜¯å¶æ–‡æ´"</span>
</code></pre> 
<p>è¿è¡Œæ•ˆæœ:</p> 
<pre><code class="prism language-shell"><span class="token punctuation">(</span>graphrag<span class="token punctuation">)</span> D:<span class="token punctuation">\</span>Learn<span class="token punctuation">\</span>GraphRAG<span class="token operator">&gt;</span>python <span class="token parameter variable">-m</span> graphrag.query <span class="token parameter variable">--root</span> ./newTest12 <span class="token parameter variable">--method</span> global <span class="token string">"è°æ˜¯å¶æ–‡æ´"</span>


INFO: Reading settings from newTest12<span class="token punctuation">\</span>settings.yaml
creating llm client with <span class="token punctuation">{<!-- --></span><span class="token string">'api_key'</span><span class="token builtin class-name">:</span> <span class="token string">'REDACTED,len=6'</span>, <span class="token string">'type'</span><span class="token builtin class-name">:</span> <span class="token string">"openai_chat"</span>, <span class="token string">'model'</span><span class="token builtin class-name">:</span> <span class="token string">'qwen2'</span>, <span class="token string">'max_tokens'</span><span class="token builtin class-name">:</span> <span class="token number">4000</span>, <span class="token string">'temperature'</span><span class="token builtin class-name">:</span> <span class="token number">0.0</span>, <span class="token string">'top_p'</span><span class="token builtin class-name">:</span> <span class="token number">1.0</span>, <span class="token string">'n'</span><span class="token builtin class-name">:</span> <span class="token number">1</span>, <span class="token string">'request_timeout'</span><span class="token builtin class-name">:</span> <span class="token number">180.0</span>, <span class="token string">'api_base'</span><span class="token builtin class-name">:</span> <span class="token string">'http://localhost:11434/v1/'</span>, <span class="token string">'api_version'</span><span class="token builtin class-name">:</span> None, <span class="token string">'organization'</span><span class="token builtin class-name">:</span> None, <span class="token string">'proxy'</span><span class="token builtin class-name">:</span> None, <span class="token string">'cognitive_services_endpoint'</span><span class="token builtin class-name">:</span> None, <span class="token string">'deployment_name'</span><span class="token builtin class-name">:</span> None, <span class="token string">'model_supports_json'</span><span class="token builtin class-name">:</span> True, <span class="token string">'tokens_per_minute'</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">'requests_per_minute'</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, <span class="token string">'max_retries'</span><span class="token builtin class-name">:</span> <span class="token number">10</span>, <span class="token string">'max_retry_wait'</span><span class="token builtin class-name">:</span> <span class="token number">10.0</span>, <span class="token string">'sleep_on_rate_limit_recommendation'</span><span class="token builtin class-name">:</span> True, <span class="token string">'concurrent_requests'</span><span class="token builtin class-name">:</span> <span class="token number">25</span><span class="token punctuation">}</span>

SUCCESS: Global Search Response: å¶æ–‡æ´æ˜¯ä¸€ä½åœ¨ã€Šä¸‰ä½“ã€‹ç³»åˆ—å°è¯´ä¸­æ‰®æ¼”é‡è¦è§’è‰²çš„ç§‘å­¦å®¶ã€‚å¥¹æ˜¯ä¸­å›½ç¬¬ä¸€ä½å¤©çº¿ç‰©ç†å­¦å®¶ï¼Œåœ¨æ•…äº‹æ—©æœŸé˜¶æ®µå¯¹ç ”ç©¶ä¸‰ä½“æ–‡æ˜åšå‡ºäº†è´¡çŒ®ã€‚

æ ¹æ®åˆ†æå¸ˆ1çš„æŠ¥å‘Šï¼Œå¶æ–‡æ´çš„èº«ä»½å’ŒèƒŒæ™¯åœ¨ã€Šä¸‰ä½“ã€‹ç³»åˆ—ä¸­è¢«è¯¦ç»†æç»˜ã€‚å¥¹æ˜¯è¯¥ç³»åˆ—ä¸­çš„å…³é”®äººç‰©ä¹‹ä¸€ï¼Œé€šè¿‡å¥¹çš„ç§‘å­¦å·¥ä½œå’Œå¯¹ä¸‰ä½“æ–‡æ˜çš„ç ”ç©¶ï¼Œä¸ºæ•´ä¸ªæ•…äº‹çš„å‘å±•æä¾›äº†é‡è¦çš„æ¨åŠ¨åŠ›ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼šå¶æ–‡æ´æ˜¯ä¸€ä½åœ¨ç§‘å¹»å°è¯´ã€Šä¸‰ä½“ã€‹ç³»åˆ—ä¸­å…·æœ‰é‡è¦åœ°ä½çš„ç§‘å­¦å®¶è§’è‰²ã€‚

è¯·æ³¨æ„ï¼Œåˆ†æå¸ˆæŠ¥å‘Šä¸­æåˆ°çš„å…·ä½“æ•°æ®è®°å½•ï¼ˆå¦‚ç¼–å·2ã€7ã€34ã€46ã€64ç­‰ï¼‰ç”¨äºæ”¯æŒä¸Šè¿°ä¿¡æ¯ï¼Œä½†ä¸ºäº†ç®€æ´èµ·è§ï¼Œåœ¨æ­¤æœªè¯¦ç»†åˆ—å‡ºã€‚è¿™äº›æ•°æ®è®°å½•æä¾›äº†å…³äºå¶æ–‡æ´åœ¨å°è¯´ä¸­çš„å…·ä½“æè¿°å’ŒèƒŒæ™¯ä¿¡æ¯ã€‚
</code></pre> 
<ol start="13"><li>æ‰§è¡Œå±€éƒ¨æŸ¥è¯¢<code>Local search</code>:</li></ol> 
<pre><code class="prism language-shell">python <span class="token parameter variable">-m</span> graphrag.query <span class="token parameter variable">--root</span> ./newTest12 <span class="token parameter variable">--method</span> <span class="token builtin class-name">local</span> <span class="token string">"è°æ˜¯å¶æ–‡æ´"</span>
</code></pre> 
<p>è¿è¡Œæ•ˆæœ:</p> 
<pre><code class="prism language-shell">SUCCESS: Local Search Response: å¶æ–‡æ´æ˜¯ä¸­å›½ç§‘å¹»å°è¯´ã€Šä¸‰ä½“ã€‹ç³»åˆ—ä¸­çš„ä¸€ä¸ªä¸»è¦è§’è‰²ï¼Œç”±åˆ˜æ…ˆæ¬£æ‰€åˆ›é€ ã€‚åœ¨æ•…äº‹ä¸­ï¼Œå¥¹æ˜¯ä¸€ä½å¤©ä½“ç‰©ç†å­¦å®¶å’Œå·¥ç¨‹å¸ˆï¼Œåœ¨ä¸­å›½ç§‘å­¦é™¢å·¥ä½œï¼Œå¹¶å‚ä¸äº†â€œçº¢å²¸å·¥ç¨‹â€ï¼Œè¿™æ˜¯ä¸­å›½çš„ä¸€ä¸ªå¤–æ˜Ÿæ–‡æ˜æ¢æµ‹é¡¹ç›®ã€‚ å¶æ–‡æ´å› ä¸ºå¯¹äººç±»ç¤¾ä¼šçš„å¤±æœ›ä»¥åŠå¯¹å®‡å®™æ¢ç´¢çš„çƒ­æƒ…ï¼Œè€Œé€‰æ‹©ä¸å¤–æ˜Ÿæ–‡æ˜æ¥è§¦ï¼Œè¿™ä¸€è¡Œä¸ºå¯¼è‡´äº†å¥¹çš„èŒä¸šç”Ÿæ¶¯é­å—é‡åˆ›ã€‚

åœ¨ã€Šä¸‰ä½“ã€‹ç³»åˆ—ä¸­ï¼Œå¶æ–‡æ´çš„æ•…äº‹çº¿è´¯ç©¿æ•´ä¸ªæ•…äº‹ï¼Œå¥¹ç»å†äº†ä»ç§‘å­¦å®¶åˆ°è¢«è¿½æ•è€…ã€å†åˆ°æˆä¸ºæŠµæŠ—ç»„ç»‡æ ¸å¿ƒæˆå‘˜çš„è§’è‰²è½¬å˜ã€‚å¥¹å¯¹äºäººç±»ç¤¾ä¼šçš„å¤±æœ›å’Œå¯¹æœªçŸ¥å®‡å®™çš„å¥½å¥‡å¿ƒï¼Œä½¿å¾—å¥¹åœ¨é¢å¯¹å¤–æ˜Ÿæ–‡æ˜æ—¶æœ‰ç€ç‹¬ç‰¹çš„è§†è§’å’Œè¡ŒåŠ¨æ–¹å¼ã€‚å¶æ–‡æ´çš„ å½¢è±¡åœ¨ç§‘å¹»æ–‡å­¦ä¸­å…·æœ‰ä¸€å®šçš„ä»£è¡¨æ€§ï¼Œå±•ç°äº†äººæ€§ä¸­çš„å¤æ‚æ€§å’Œå¯¹æœªçŸ¥ä¸–ç•Œæ¢ç´¢çš„æ¸´æœ›ã€‚

ã€Šä¸‰ä½“ã€‹ç³»åˆ—æ˜¯ä¸­å›½ç§‘å¹»æ–‡å­¦çš„é‡è¦ä½œå“ä¹‹ä¸€ï¼Œè·å¾—äº†åŒ…æ‹¬â€œé›¨æœå¥–â€åœ¨å†…çš„å¤šä¸ªå¥–é¡¹ï¼Œæ·±å—è¯»è€…å–œçˆ±ï¼Œå¹¶åœ¨å…¨çƒèŒƒå›´å†…äº§ç”Ÿäº†å¹¿æ³›å½±å“ã€‚
</code></pre> 
<ol start="14"><li>æŸ¥çœ‹å¤§æ¨¡å‹å›ç­”é—®é¢˜æ‰€ä¾èµ–çš„ä¸Šä¸‹æ–‡ï¼Œè¿™æ—¶éœ€è¦ä½¿ç”¨GraphRAG çš„pythonè°ƒç”¨æ–¹å¼:</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os

<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> tiktoken <span class="token comment"># Tiktoken æ˜¯ä¸€ç§æ–‡æœ¬å¤„ç†å·¥å…·ï¼Œå®ƒèƒ½å¤Ÿå°†æ–‡æœ¬åˆ†è§£æˆæ›´å°çš„å•å…ƒï¼Œé€šå¸¸ç”¨äºè‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰ä»»åŠ¡ä¸­çš„æ–‡æœ¬ç¼–ç ã€‚</span>

<span class="token keyword">from</span> graphrag<span class="token punctuation">.</span>query<span class="token punctuation">.</span>context_builder<span class="token punctuation">.</span>entity_extraction <span class="token keyword">import</span> EntityVectorStoreKey
<span class="token keyword">from</span> graphrag<span class="token punctuation">.</span>query<span class="token punctuation">.</span>indexer_adapters <span class="token keyword">import</span> <span class="token punctuation">(</span>
    read_indexer_covariates<span class="token punctuation">,</span>
    read_indexer_entities<span class="token punctuation">,</span>
    read_indexer_relationships<span class="token punctuation">,</span>
    read_indexer_reports<span class="token punctuation">,</span>
    read_indexer_text_units<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">from</span> graphrag<span class="token punctuation">.</span>query<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>dfs <span class="token keyword">import</span> <span class="token punctuation">(</span>
    store_entity_semantic_embeddings<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">from</span> graphrag<span class="token punctuation">.</span>query<span class="token punctuation">.</span>llm<span class="token punctuation">.</span>oai<span class="token punctuation">.</span>chat_openai <span class="token keyword">import</span> ChatOpenAI
<span class="token keyword">from</span> graphrag<span class="token punctuation">.</span>query<span class="token punctuation">.</span>llm<span class="token punctuation">.</span>oai<span class="token punctuation">.</span>embedding <span class="token keyword">import</span> OpenAIEmbedding
<span class="token keyword">from</span> graphrag<span class="token punctuation">.</span>query<span class="token punctuation">.</span>llm<span class="token punctuation">.</span>oai<span class="token punctuation">.</span>typing <span class="token keyword">import</span> OpenaiApiType
<span class="token keyword">from</span> graphrag<span class="token punctuation">.</span>query<span class="token punctuation">.</span>question_gen<span class="token punctuation">.</span>local_gen <span class="token keyword">import</span> LocalQuestionGen
<span class="token keyword">from</span> graphrag<span class="token punctuation">.</span>query<span class="token punctuation">.</span>structured_search<span class="token punctuation">.</span>local_search<span class="token punctuation">.</span>mixed_context <span class="token keyword">import</span> <span class="token punctuation">(</span>
    LocalSearchMixedContext<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">from</span> graphrag<span class="token punctuation">.</span>query<span class="token punctuation">.</span>structured_search<span class="token punctuation">.</span>local_search<span class="token punctuation">.</span>search <span class="token keyword">import</span> LocalSearch
<span class="token keyword">from</span> graphrag<span class="token punctuation">.</span>vector_stores<span class="token punctuation">.</span>lancedb <span class="token keyword">import</span> LanceDBVectorStore

<span class="token comment"># é…ç½®å‚æ•°</span>
INPUT_DIR <span class="token operator">=</span> <span class="token string">"../newTest12/output/20240802-103645/artifacts"</span> <span class="token comment"># è¿™é‡Œæ¢æˆæ‰€åœ¨å·¥ç¨‹çš„è¾“å‡ºè·¯å¾„</span>
LANCEDB_URI <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"./lancedb"</span></span>

COMMUNITY_REPORT_TABLE <span class="token operator">=</span> <span class="token string">"create_final_community_reports"</span>
ENTITY_TABLE <span class="token operator">=</span> <span class="token string">"create_final_nodes"</span>
ENTITY_EMBEDDING_TABLE <span class="token operator">=</span> <span class="token string">"create_final_entities"</span>
RELATIONSHIP_TABLE <span class="token operator">=</span> <span class="token string">"create_final_relationships"</span>
COVARIATE_TABLE <span class="token operator">=</span> <span class="token string">"create_final_covariates"</span>
TEXT_UNIT_TABLE <span class="token operator">=</span> <span class="token string">"create_final_text_units"</span>
COMMUNITY_LEVEL <span class="token operator">=</span> <span class="token number">2</span>

<span class="token comment"># è¯»å–å®ä½“entities</span>
<span class="token comment"># read nodes table to get community and degree data</span>
entity_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_parquet<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>INPUT_DIR<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>ENTITY_TABLE<span class="token punctuation">}</span></span><span class="token string">.parquet"</span></span><span class="token punctuation">)</span>
entity_embedding_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_parquet<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>INPUT_DIR<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>ENTITY_EMBEDDING_TABLE<span class="token punctuation">}</span></span><span class="token string">.parquet"</span></span><span class="token punctuation">)</span>

entities <span class="token operator">=</span> read_indexer_entities<span class="token punctuation">(</span>entity_df<span class="token punctuation">,</span> entity_embedding_df<span class="token punctuation">,</span> COMMUNITY_LEVEL<span class="token punctuation">)</span>

<span class="token comment"># load description embeddings to an in-memory lancedb vectorstore</span>
<span class="token comment"># to connect to a remote db, specify url and port values.</span>
description_embedding_store <span class="token operator">=</span> LanceDBVectorStore<span class="token punctuation">(</span>
    collection_name<span class="token operator">=</span><span class="token string">"entity_description_embeddings"</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
description_embedding_store<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>db_uri<span class="token operator">=</span>LANCEDB_URI<span class="token punctuation">)</span>
entity_description_embeddings <span class="token operator">=</span> store_entity_semantic_embeddings<span class="token punctuation">(</span>
    entities<span class="token operator">=</span>entities<span class="token punctuation">,</span> vectorstore<span class="token operator">=</span>description_embedding_store
<span class="token punctuation">)</span>

<span class="token comment"># è¯»å–å…³ç³»relationships</span>
relationship_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_parquet<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>INPUT_DIR<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>RELATIONSHIP_TABLE<span class="token punctuation">}</span></span><span class="token string">.parquet"</span></span><span class="token punctuation">)</span>
relationships <span class="token operator">=</span> read_indexer_relationships<span class="token punctuation">(</span>relationship_df<span class="token punctuation">)</span>

<span class="token comment"># è¯»å–åå˜é‡covariates</span>
covariate_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_parquet<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>INPUT_DIR<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>COVARIATE_TABLE<span class="token punctuation">}</span></span><span class="token string">.parquet"</span></span><span class="token punctuation">)</span>

claims <span class="token operator">=</span> read_indexer_covariates<span class="token punctuation">(</span>covariate_df<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Claim records: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">len</span><span class="token punctuation">(</span>claims<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
covariates <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"claims"</span><span class="token punctuation">:</span> claims<span class="token punctuation">}</span>

<span class="token comment"># è¯»å–ç¤¾åŒºæŠ¥å‘Š</span>
report_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_parquet<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>INPUT_DIR<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>COMMUNITY_REPORT_TABLE<span class="token punctuation">}</span></span><span class="token string">.parquet"</span></span><span class="token punctuation">)</span>
reports <span class="token operator">=</span> read_indexer_reports<span class="token punctuation">(</span>report_df<span class="token punctuation">,</span> entity_df<span class="token punctuation">,</span> COMMUNITY_LEVEL<span class="token punctuation">)</span>

<span class="token comment"># è¯»å–æ–‡æœ¬å—</span>
text_unit_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_parquet<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>INPUT_DIR<span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>TEXT_UNIT_TABLE<span class="token punctuation">}</span></span><span class="token string">.parquet"</span></span><span class="token punctuation">)</span>
text_units <span class="token operator">=</span> read_indexer_text_units<span class="token punctuation">(</span>text_unit_df<span class="token punctuation">)</span>

<span class="token comment"># é…ç½®æ¨¡å‹å‚æ•°</span>
llm <span class="token operator">=</span> ChatOpenAI<span class="token punctuation">(</span>
    api_key<span class="token operator">=</span><span class="token string">'ollama'</span><span class="token punctuation">,</span>
    model<span class="token operator">=</span><span class="token string">'qwen2'</span><span class="token punctuation">,</span>
    api_base<span class="token operator">=</span><span class="token string">'http://localhost:11434/v1/'</span><span class="token punctuation">,</span>
    api_type<span class="token operator">=</span>OpenaiApiType<span class="token punctuation">.</span>OpenAI<span class="token punctuation">,</span>  <span class="token comment"># OpenaiApiType.OpenAI or OpenaiApiType.AzureOpenAI</span>
    max_retries<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

token_encoder <span class="token operator">=</span> tiktoken<span class="token punctuation">.</span>get_encoding<span class="token punctuation">(</span><span class="token string">"cl100k_base"</span><span class="token punctuation">)</span>

text_embedder <span class="token operator">=</span> OpenAIEmbedding<span class="token punctuation">(</span>
    api_key<span class="token operator">=</span><span class="token string">'ollama'</span><span class="token punctuation">,</span>
    api_type<span class="token operator">=</span>OpenaiApiType<span class="token punctuation">.</span>OpenAI<span class="token punctuation">,</span>
    api_base<span class="token operator">=</span><span class="token string">'http://localhost:11434/api'</span><span class="token punctuation">,</span>
    model<span class="token operator">=</span><span class="token string">'qwen2'</span><span class="token punctuation">,</span>
    deployment_name<span class="token operator">=</span><span class="token string">'qwen2'</span><span class="token punctuation">,</span>
    max_retries<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># åˆ›å»ºå±€éƒ¨æœç´¢ä¸Šä¸‹æ–‡æ„å»ºå™¨context-builder</span>
context_builder <span class="token operator">=</span> LocalSearchMixedContext<span class="token punctuation">(</span>
    community_reports<span class="token operator">=</span>reports<span class="token punctuation">,</span>
    text_units<span class="token operator">=</span>text_units<span class="token punctuation">,</span>
    entities<span class="token operator">=</span>entities<span class="token punctuation">,</span>
    relationships<span class="token operator">=</span>relationships<span class="token punctuation">,</span>
    covariates<span class="token operator">=</span>covariates<span class="token punctuation">,</span>
    entity_text_embeddings<span class="token operator">=</span>description_embedding_store<span class="token punctuation">,</span>
    embedding_vectorstore_key<span class="token operator">=</span>EntityVectorStoreKey<span class="token punctuation">.</span>ID<span class="token punctuation">,</span>  <span class="token comment"># if the vectorstore uses entity title as ids, set this to EntityVectorStoreKey.TITLE</span>
    text_embedder<span class="token operator">=</span>text_embedder<span class="token punctuation">,</span>
    token_encoder<span class="token operator">=</span>token_encoder<span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token comment"># åˆ›å»ºå±€éƒ¨æœç´¢å¼•æ“</span>
local_context_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"text_unit_prop"</span><span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>
    <span class="token string">"community_prop"</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
    <span class="token string">"conversation_history_max_turns"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token string">"conversation_history_user_turns_only"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
    <span class="token string">"top_k_mapped_entities"</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token string">"top_k_relationships"</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token string">"include_entity_rank"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
    <span class="token string">"include_relationship_weight"</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
    <span class="token string">"include_community_rank"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
    <span class="token string">"return_candidate_context"</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span>
    <span class="token string">"embedding_vectorstore_key"</span><span class="token punctuation">:</span> EntityVectorStoreKey<span class="token punctuation">.</span>ID<span class="token punctuation">,</span>  <span class="token comment"># set this to EntityVectorStoreKey.TITLE if the vectorstore uses entity title as ids</span>
    <span class="token string">"max_tokens"</span><span class="token punctuation">:</span> <span class="token number">12_000</span><span class="token punctuation">,</span>  <span class="token comment"># change this based on the token limit you have on your model (if you are using a model with 8k limit, a good setting could be 5000)</span>
<span class="token punctuation">}</span>

llm_params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"max_tokens"</span><span class="token punctuation">:</span> <span class="token number">2_000</span><span class="token punctuation">,</span>  <span class="token comment"># change this based on the token limit you have on your model (if you are using a model with 8k limit, a good setting could be 1000=1500)</span>
    <span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

search_engine <span class="token operator">=</span> LocalSearch<span class="token punctuation">(</span>
    llm<span class="token operator">=</span>llm<span class="token punctuation">,</span>
    context_builder<span class="token operator">=</span>context_builder<span class="token punctuation">,</span>
    token_encoder<span class="token operator">=</span>token_encoder<span class="token punctuation">,</span>
    llm_params<span class="token operator">=</span>llm_params<span class="token punctuation">,</span>
    context_builder_params<span class="token operator">=</span>local_context_params<span class="token punctuation">,</span>
    response_type<span class="token operator">=</span><span class="token string">"multiple paragraphs"</span><span class="token punctuation">,</span>  <span class="token comment"># free form text describing the response type and format, can be anything, e.g. prioritized list, single paragraph, multiple paragraphs, multiple-page report</span>
<span class="token punctuation">)</span>

<span class="token comment"># æ‰§è¡Œå±€éƒ¨æœç´¢</span>
result <span class="token operator">=</span> <span class="token keyword">await</span> search_engine<span class="token punctuation">.</span>asearch<span class="token punctuation">(</span><span class="token string">"å¶æ–‡æ´æ˜¯è°"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>response<span class="token punctuation">)</span>

<span class="token comment"># æŸ¥çœ‹local Searchä¾èµ–çš„ä¸Šä¸‹æ–‡:</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>context_data<span class="token punctuation">)</span>
</code></pre> 
<p>è¿è¡Œæ•ˆæœï¼š</p> 
<pre><code class="prism language-shell">å¶æ–‡æ´æ˜¯ä¸­å›½ç§‘å¹»ä½œå®¶åˆ˜æ…ˆæ¬£çš„é•¿ç¯‡ç§‘å¹»å°è¯´ã€Šä¸‰ä½“ã€‹ä¸­çš„ä¸€ä¸ªä¸»è¦è§’è‰²ã€‚åœ¨æ•…äº‹ä¸­ï¼Œå¥¹æ˜¯ä¸€ä½èµ„æ·±çš„å¤©æ–‡å­¦å®¶å’Œç‰©ç†å­¦å®¶ï¼Œåœ¨ä¸­å›½ç§‘å­¦é™¢ä»äº‹ç ”ç©¶å·¥ä½œã€‚

å¶æ–‡æ´åœ¨å¹´è½»æ—¶å› æ”¿æ²»åŸå› é­å—è¿«å®³ï¼Œåæ¥æˆä¸ºâ€œçº¢å«å…µâ€è¿åŠ¨çš„ç§¯æå‚ä¸è€…ï¼Œå¹¶å› æ­¤è¢«ä¸‹æ”¾åˆ°å†œæ‘åŠ³åŠ¨æ”¹é€ ã€‚åœ¨å°è¯´ä¸­ï¼Œå¥¹é€šè¿‡æ— çº¿ç”µæ³¢å‘å®‡å®™å‘é€äº†æ±‚æ•‘ä¿¡å·ï¼Œç»“æœæ„å¤–åœ°æ¥æ”¶åˆ°ä¸‰ä½“æ–‡æ˜çš„ä¿¡æ¯ï¼Œä»è€Œå¼•å‘äº†åç»­ä¸€ç³»åˆ—æƒŠå¿ƒåŠ¨é­„çš„æ•…äº‹ã€‚

å¶æ–‡æ´çš„æ€§æ ¼å¤æ‚å¤šé¢ï¼Œæ—¢æœ‰å¯¹ç§‘å­¦å’ŒçœŸç†çš„æ‰§ç€è¿½æ±‚ï¼Œä¹Ÿæœ‰å¯¹äººæ€§å’Œç¤¾ä¼šçš„æ·±åˆ»æ´å¯Ÿã€‚å¥¹åœ¨æ•…äº‹ä¸­çš„ç»å†åæ˜ äº†äººç±»åœ¨é¢å¯¹æœªçŸ¥ã€ææƒ§ä¸å¸Œæœ›ä¹‹é—´çš„æŒ£æ‰ï¼Œä»¥åŠåœ¨æç«¯ç¯å¢ƒä¸‹ä¸ªäººå‘½è¿çš„è„†å¼±æ€§å’ŒåšéŸ§æ€§çš„äº¤ç»‡ã€‚
</code></pre> 
<p>ä¾èµ–çš„ä¸Šä¸‹æ–‡:</p> 
<pre><code class="prism language-shell"><span class="token punctuation">{<!-- --></span><span class="token string">'relationships'</span><span class="token builtin class-name">:</span>   <span class="token function">id</span>  <span class="token builtin class-name">source</span>         target                                description weight  <span class="token punctuation">\</span>
 <span class="token number">0</span>  <span class="token number">4</span>  <span class="token string">"å°çº¢å«å…µ"</span>  <span class="token string">"QUESTIONING"</span>  <span class="token string">"å°çº¢å«å…µå¯¹å¶å“²æ³°çš„å›ç­”æå‡ºç–‘é—®ï¼Œè¯•å›¾ç†è§£æ˜¯å¦æœ‰ä¸Šå¸çš„å­˜åœ¨ã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"entity"</span>    <span class="token number">1.0</span>   
 
   rank  in_context  
 <span class="token number">0</span>    <span class="token number">2</span>        True  ,
 <span class="token string">'claims'</span><span class="token builtin class-name">:</span> Empty DataFrame
 Columns: <span class="token punctuation">[</span>in_context<span class="token punctuation">]</span>
 Index: <span class="token punctuation">[</span><span class="token punctuation">]</span>,
 <span class="token string">'entities'</span><span class="token builtin class-name">:</span>     <span class="token function">id</span>                    entity  <span class="token punctuation">\</span>
 <span class="token number">0</span>   <span class="token number">52</span>                      <span class="token string">"ä¼šåœº"</span>   
 <span class="token number">1</span>   <span class="token number">45</span>                    <span class="token string">"å››ä½å°å°†"</span>   
 <span class="token number">2</span>   <span class="token number">26</span>                       <span class="token string">"ç³"</span>   
 <span class="token number">3</span>   <span class="token number">60</span>                   <span class="token string">"æ•™å·¥å®¿èˆæ¥¼"</span>   
 <span class="token number">4</span>   <span class="token number">51</span>                       <span class="token string">"å¸"</span>   
 <span class="token number">5</span>   <span class="token number">49</span>                    <span class="token string">"å°çº¢å«å…µ"</span>   
 <span class="token number">6</span>   <span class="token number">53</span>                      <span class="token string">"å®—æ•™"</span>   
 <span class="token number">7</span>   <span class="token number">41</span>                    <span class="token string">"å®éªŒç»“æœ"</span>   
 <span class="token number">8</span>   <span class="token number">21</span>                     <span class="token string">"åŸºç¡€è¯¾"</span>   
 <span class="token number">9</span>    <span class="token number">4</span>                     <span class="token string">"é“ç‚‰å­"</span>   
 <span class="token number">10</span>   <span class="token number">6</span>                 <span class="token string">"å…¨å›½èŒƒå›´çš„æ­¦æ–—"</span>   
 <span class="token number">11</span>  <span class="token number">15</span>                     <span class="token string">"æ‰¹æ–—ä¼š"</span>   
 <span class="token number">12</span>  <span class="token number">62</span>                      <span class="token string">"é˜®é›¯"</span>   
 <span class="token number">13</span>  <span class="token number">61</span>                     <span class="token string">"é˜®è€å¸ˆ"</span>   
 <span class="token number">14</span>  <span class="token number">58</span>                      <span class="token string">"çˆ¶äº²"</span>   
 <span class="token number">15</span>  <span class="token number">48</span>                     <span class="token string">"èƒ¡å«å…µ"</span>   
 <span class="token number">16</span>  <span class="token number">19</span>  <span class="token string">"æ‰¹åˆ¤"</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>SPAN<span class="token operator">&gt;</span>EVENT<span class="token operator">&lt;</span>/SPAN<span class="token operator">&gt;</span><span class="token punctuation">)</span>   
 <span class="token number">17</span>  <span class="token number">28</span>                  <span class="token string">"ç”Ÿæ€å®‡å®™æ¨¡å‹"</span>   
 <span class="token number">18</span>  <span class="token number">56</span>                      <span class="token string">"ç»„ç»‡"</span>   
 <span class="token number">19</span>  <span class="token number">25</span>                   <span class="token string">"é©å‘½å°å°†ä»¬"</span>   
 
                                           description number of relationships  <span class="token punctuation">\</span>
 <span class="token number">0</span>                         <span class="token string">"ä¼šåœºæ˜¯ä¸€ä¸ªç‰¹å®šçš„åœ°ç‚¹ï¼Œå¯èƒ½æ˜¯æŸä¸ªä¼šè®®æˆ–é›†ä¼šçš„åœ°æ–¹ã€‚"</span>                       <span class="token number">0</span>   
 <span class="token number">1</span>   <span class="token string">"å››ä½å°å°†"</span>æŒ‡çš„æ˜¯æ¥è‡ªé™„ä¸­çš„å››ä½å¥³æ€§å­¦ç”Ÿï¼Œå¥¹ä»¬ä»¥ä¸€ç§åšå®šçš„æ–¹å¼è¿›è¡Œâ€œé©å‘½â€ï¼Œé€šè¿‡å®é™…è¡ŒåŠ¨è¡¨è¾¾<span class="token punctuation">..</span>.                       <span class="token number">0</span>   
 <span class="token number">2</span>           <span class="token string">"ç³æ˜¯å¶å“²æ³°çš„å¦»å­æˆ–å¥³å„¿ï¼Œä»¥å…¶è¿‡äººçš„å¤©èµ„å’Œèªæ˜æ‰æ™ºè‘—ç§°ï¼Œåœ¨å­¦æœ¯ä¸Šæœ‰ç€é‡è¦çš„åœ°ä½ã€‚"</span>                       <span class="token number">0</span>   
 <span class="token number">3</span>                          <span class="token string">"æ•™å·¥å®¿èˆæ¥¼æ˜¯å¶æ–‡æ´ç”Ÿæ´»å’Œå·¥ä½œçš„åœ°ç‚¹ï¼Œä½äºå­¦æ ¡å†…ã€‚"</span>                       <span class="token number">0</span>   
 <span class="token number">4</span>            <span class="token string">"å¸æ˜¯ä¸€ä¸ªè±¡å¾æ€§çš„å­˜åœ¨ï¼Œä»£è¡¨æŸç§è¶…è‡ªç„¶æˆ–å®‡å®™ä¹‹å¤–çš„åŠ›é‡ã€‚"</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token string">"entity"</span>                       <span class="token number">0</span>   
 <span class="token number">5</span>                    <span class="token string">"å°çº¢å«å…µå¯¹å¶å“²æ³°çš„å›ç­”æ„Ÿåˆ°å›°æƒ‘ï¼Œå¹¶è¯•å›¾ç†è§£æ˜¯å¦æœ‰ä¸Šå¸çš„å­˜åœ¨ã€‚"</span>                       <span class="token number">1</span>   
 <span class="token number">6</span>             <span class="token string">"å®—æ•™åœ¨è¿™é‡Œå¯èƒ½æ˜¯æŒ‡æŸç§ä¿¡ä»°ä½“ç³»ï¼Œè¢«æè¿°ä¸ºè¢«ç»Ÿæ²»é˜¶çº§ç”¨æ¥æ§åˆ¶äººæ°‘çš„ç²¾ç¥å·¥å…·ã€‚"</span>                       <span class="token number">0</span>   
 <span class="token number">7</span>                        <span class="token string">"å®éªŒç»“æœæŒ‡çš„æ˜¯ä¸é‡å­æ³¢å‡½æ•°åç¼©ç›¸å…³çš„ç§‘å­¦å®éªŒçš„ç»“æœã€‚"</span>                       <span class="token number">0</span>   
 <span class="token number">8</span>    <span class="token string">"åŸºç¡€è¯¾æŒ‡çš„æ˜¯æ•™è‚²ä½“ç³»ä¸­çš„ä¸€ä¸ªè¯¾ç¨‹æˆ–é˜¶æ®µï¼Œæ¶‰åŠåˆ°ç‰©ç†å­¦çš„åŸºç¡€ç†è®ºæ•™å­¦ã€‚"</span><span class="token punctuation">)</span>  <span class="token punctuation">(</span><span class="token string">"entity"</span>                       <span class="token number">0</span>   
 <span class="token number">9</span>          <span class="token string">"é“ç‚‰å­æ˜¯ä¸€ä¸ªå……æ»¡çƒˆæ€§ç‚¸è¯çš„åœ°æ–¹ï¼Œæš—ç¤ºäº†æ½œåœ¨çš„å±é™©æˆ–å†²çªã€‚"</span><span class="token punctuation">)</span>  <span class="token punctuation">(</span><span class="token string">"entity"</span>                       <span class="token number">0</span>   
 <span class="token number">10</span>        <span class="token string">"å…¨å›½èŒƒå›´çš„æ­¦æ–—"</span>æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªå¹¿æ³›åŒºåŸŸå†…çš„æ­¦è£…å†²çªæˆ–æ–—äº‰æ´»åŠ¨ã€‚<span class="token punctuation">)</span>  <span class="token punctuation">(</span><span class="token string">"entity"</span>                       <span class="token number">0</span>   
 <span class="token number">11</span>       <span class="token string">"æ‰¹æ–—ä¼šæ˜¯ä¸€ä¸ªå‡ åƒäººå‚åŠ çš„äº‹ä»¶ï¼Œåœ¨è¿™ä¸ªäº‹ä»¶ä¸­ï¼Œäººä»¬èšé›†èµ·æ¥å¯¹ä¸€ä¸ªååŠ¨å­¦æœ¯æƒå¨è¿›è¡Œæ‰¹åˆ¤ã€‚"</span>                       <span class="token number">0</span>   
 <span class="token number">12</span>       <span class="token string">"é˜®é›¯æ˜¯æ•…äº‹ä¸­çš„ä¸€ä¸ªè§’è‰²ï¼Œå¥¹æ‹¥æœ‰è‡ªå·±çš„å®¶ï¼Œå¹¶ä¸”ä¸å¶æ–‡æ´æœ‰å…³ç³»ã€‚"</span><span class="token punctuation">)</span>  <span class="token punctuation">(</span><span class="token string">"entity"</span>                       <span class="token number">0</span>   
 <span class="token number">13</span>      <span class="token string">"é˜®è€å¸ˆæ˜¯é˜®é›¯é™¤çˆ¶äº²å¤–æœ€äº²è¿‘çš„äººï¼Œåœ¨åœè¯¾é—¹é©å‘½æœŸé—´ä¸€ç›´é™ªä¼´ç€å¥¹ã€‚"</span><span class="token punctuation">)</span>  <span class="token punctuation">(</span><span class="token string">"entity"</span>                       <span class="token number">0</span>   
 <span class="token number">14</span>                         <span class="token string">"çˆ¶äº²æ˜¯å¶æ–‡æ´çš„å·²æ•…äº²äººï¼Œå¥¹å°†çƒŸæ–—æ”¾åœ¨äº†ä»–çš„æ‰‹ä¸­ã€‚"</span>                       <span class="token number">0</span>   
 <span class="token number">15</span>                   <span class="token string">"èƒ¡å«å…µå¯èƒ½æ˜¯ä¸€ä¸ªä¸çº¢å«å…µç›¸å…³çš„ç»„ç»‡æˆ–ç¾¤ä½“ï¼Œä½†å…·ä½“ä¿¡æ¯ä¸æ˜ç¡®ã€‚"</span>                       <span class="token number">0</span>   
 <span class="token number">16</span>  <span class="token string">"æ‰¹åˆ¤"</span>æŒ‡çš„æ˜¯é•¿æ—¶é—´çš„æ‰¹è¯„æ´»åŠ¨ï¼Œå®ƒåœ¨æ”¿æ²»ä¸Šäº§ç”Ÿäº†å¼ºçƒˆçš„å½±å“ï¼Œæ‘§æ¯äº†å‚ä¸è€…çš„æ„è¯†å’Œæ€æƒ³ä½“ç³»ã€‚å‚<span class="token punctuation">..</span>.                       <span class="token number">0</span>   
 <span class="token number">17</span>    <span class="token string">"ç”Ÿæ€å®‡å®™æ¨¡å‹æ˜¯ä¸€ä¸ªè¢«æ‰¹åˆ¤çš„æ¦‚å¿µï¼Œå› ä¸ºå®ƒå¦è®¤ç‰©è´¨è¿åŠ¨çš„æœ¬è´¨ï¼Œè¢«è®¤ä¸ºæ˜¯åè¾©è¯æ³•å’ŒååŠ¨å”¯å¿ƒä¸»ä¹‰ã€‚"</span>                       <span class="token number">0</span>   
 <span class="token number">18</span>             <span class="token string">"å¶æ–‡æ´æ˜¯æ•…äº‹ä¸­çš„ä¸€ä¸ªäººç‰©ï¼Œå¥¹ä¸çˆ¶äº²å¶å“²æ³°æœ‰å…³è”ã€‚"</span><span class="token punctuation">)</span>  <span class="token punctuation">(</span><span class="token string">"entity"</span>                       <span class="token number">0</span>   
 <span class="token number">19</span>   <span class="token string">"é©å‘½å°å°†æ˜¯å¸®åŠ©å¥¹é†’æ‚Ÿå¹¶æ”¯æŒå¥¹çš„ç¾¤ä½“ï¼Œè¡¨æ˜äº†ä»–ä»¬å¯¹ç¤¾ä¼šå˜é©çš„æ”¯æŒå’Œå‚ä¸."</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token string">"entity"</span>                       <span class="token number">0</span>   
 
     in_context  
 <span class="token number">0</span>         True  
 <span class="token number">1</span>         True  
 <span class="token number">2</span>         True  
 <span class="token number">3</span>         True  
 <span class="token number">4</span>         True  
 <span class="token number">5</span>         True  
 <span class="token number">6</span>         True  
 <span class="token number">7</span>         True  
 <span class="token number">8</span>         True  
 <span class="token number">9</span>         True  
 <span class="token number">10</span>        True  
 <span class="token number">11</span>        True  
 <span class="token number">12</span>        True  
 <span class="token number">13</span>        True  
 <span class="token number">14</span>        True  
 <span class="token number">15</span>        True  
 <span class="token number">16</span>        True  
 <span class="token number">17</span>        True  
 <span class="token number">18</span>        True  
 <span class="token number">19</span>        True  ,
 <span class="token string">'sources'</span><span class="token builtin class-name">:</span>     <span class="token function">id</span>                                               text
 <span class="token number">0</span>   <span class="token number">29</span>  ç›¸ä¿¡å®ƒä¸å­˜åœ¨äº†ã€‚<span class="token punctuation">\</span>n<span class="token punctuation">\</span>nã€€ã€€è¿™å¥å¤§é€†ä¸é“çš„è¯åœ¨æ•´ä¸ªä¼šåœºå¼•èµ·äº†éªšåŠ¨ï¼Œåœ¨å°ä¸Šä¸€åçº¢å«å…µçš„å¸¦é¢†ä¸‹ï¼Œ<span class="token punctuation">..</span>.
 <span class="token number">1</span>   <span class="token number">40</span>  ä¸è®²ã€‚ä½†æ¥è‡ªé™„ä¸­çš„å››ä½å°å°†è‡ªæœ‰å¥¹ä»¬â€œæ— åšä¸æ‘§â€çš„é©å‘½æ–¹å¼ï¼Œåˆšæ‰åŠ¨æ‰‹çš„é‚£ä¸ªå¥³å­©å„¿åˆç‹ æŠ½äº†å¶å“²æ³°<span class="token punctuation">..</span>.
 <span class="token number">2</span>   <span class="token number">21</span>  ï¿½æ€å®‡å®™æ¨¡å‹ï¼Œå¦å®šäº†ç‰©è´¨çš„è¿åŠ¨æœ¬æ€§ï¼Œæ˜¯åè¾©è¯æ³•çš„ï¼å®ƒè®¤ä¸ºå®‡å®™æœ‰é™ï¼Œæ›´æ˜¯å½»å¤´å½»å°¾çš„ååŠ¨å”¯å¿ƒä¸»ä¹‰<span class="token punctuation">..</span>.
 <span class="token number">3</span>   <span class="token number">43</span>  å››è‚¢ä»ä¿æŒç€è€æ ¡å·¥æŠ“ç€å¥¹æ—¶çš„å§¿æ€ï¼Œä¸€åŠ¨ä¸åŠ¨ï¼ŒåƒçŸ³åŒ–äº†ä¸€èˆ¬ã€‚è¿‡äº†å¥½ä¹…ï¼Œå¥¹æ‰å°†æ‚¬ç©ºçš„æ‰‹è‡‚æ”¾ä¸‹æ¥ï¼Œ<span class="token punctuation">..</span>.
 <span class="token number">4</span>   <span class="token number">28</span>  å¸çš„å­˜åœ¨ç•™ä¸‹äº†ä½ç½®ã€‚â€ç»ç³å¯¹å¥³å­©å„¿ç‚¹ç‚¹å¤´æç¤ºè¯´ã€‚<span class="token punctuation">\</span>n<span class="token punctuation">\</span>nã€€ã€€å°çº¢å«å…µé‚£èŒ«ç„¶çš„æ€è·¯ç«‹åˆ»æ‰¾åˆ°äº†ç«‹<span class="token punctuation">..</span>.
 <span class="token number">5</span>    <span class="token number">1</span>  é‚£ä¸€ä¸ªï¼Œå¥¹ä¸ç”±è‡ªä¸»åœ°é—®é“ï¼š â€œè¿æ—¶é—´éƒ½æ˜¯ä»é‚£ä¸ªå¥‡ç‚¹å¼€å§‹çš„ï¼ï¼Ÿé‚£å¥‡ç‚¹ä»¥å‰æœ‰ä»€ä¹ˆï¼Ÿâ€<span class="token punctuation">\</span>n<span class="token punctuation">\</span>nã€€ã€€<span class="token punctuation">..</span>.
 <span class="token number">6</span>   <span class="token number">39</span>  ç¥å…äºå½»åº•å®æ‰ã€‚â€œå¶å“²æ³°ï¼Œè¿™ä¸€ç‚¹ä½ æ˜¯æ— æ³•æŠµèµ–çš„ï¼ä½ å¤šæ¬¡å‘å­¦ç”Ÿæ•£å¸ƒååŠ¨çš„å“¥æœ¬å“ˆæ ¹è§£é‡Šï¼â€<span class="token punctuation">\</span>n<span class="token punctuation">\</span><span class="token punctuation">..</span>.
 <span class="token number">7</span>   <span class="token number">17</span>  ï¿½äºŒè‡³å…­äº”å±Šçš„åŸºç¡€è¯¾ä¸­ï¼Œä½ æ˜¯ä¸æ˜¯æ“…è‡ªåŠ å…¥äº†å¤§é‡çš„ç›¸å¯¹è®ºå†…å®¹ï¼Ÿï¼â€<span class="token punctuation">\</span>n<span class="token punctuation">\</span>nã€€ã€€â€œç›¸å¯¹è®ºå·²ç»æˆä¸º<span class="token punctuation">..</span>.
 <span class="token number">8</span>    <span class="token number">3</span>  é“ç‚‰å­ï¼Œé‡Œé¢å¡æ»¡äº†çƒˆæ€§ç‚¸è¯ï¼Œç”¨ç”µé›·ç®¡ä¸²è”èµ·æ¥ï¼Œä»–çœ‹ä¸åˆ°å®ƒä»¬ï¼Œä½†èƒ½æ„Ÿè§‰åˆ°å®ƒä»¬ç£çŸ³èˆ¬çš„å­˜åœ¨ï¼Œå¼€å…³<span class="token punctuation">..</span>.
 <span class="token number">9</span>    <span class="token number">5</span>  ï¿½ï¼Œå…¨å›½èŒƒå›´çš„æ­¦æ–—ä¹Ÿè¿›å…¥é«˜æ½®ã€‚<span class="token punctuation">)</span>â€”â€”è¿åŒé‚£äº›æ¢­æ ‡å’Œå¤§åˆ€ç­‰å†·å…µå™¨ï¼Œæ„æˆäº†ä¸€éƒ¨æµ“ç¼©çš„è¿‘ç°ä»£å²â€¦â€¦<span class="token punctuation">..</span>.
 <span class="token number">10</span>   <span class="token number">9</span>  ï¿½ï¿½åœºä¸Šï¼Œä¸€åœºå‡ åƒäººå‚åŠ çš„æ‰¹æ–—ä¼šå·²ç»è¿›è¡Œäº†è¿‘ä¸¤ä¸ªå°æ—¶ã€‚åœ¨è¿™ä¸ªæ´¾åˆ«æ—ç«‹çš„å¹´ä»£ï¼Œä»»ä½•ä¸€å¤„éƒ½æœ‰é”™ç»¼<span class="token punctuation">..</span>.
 <span class="token number">11</span>  <span class="token number">34</span>  ä»¬æ‹¿åœ¨æ‰‹ä¸­å’Œå«åœ¨å˜´é‡Œæ·±æ€çš„é‚£ä¸ªç”·äººçš„æ™ºæ…§ï¼Œä½†é˜®é›¯ä»æœªæèµ·è¿‡ä»–ã€‚è¿™ä¸ªé›…è‡´æ¸©æš–çš„å°ä¸–ç•Œæˆä¸ºæ–‡æ´é€ƒ<span class="token punctuation">..</span>.
 <span class="token number">12</span>  <span class="token number">45</span>  æ¥åœè¯¾é—¹é©å‘½è‡³ä»Šï¼Œé˜®è€å¸ˆä¸€ç›´æ˜¯å¥¹é™¤çˆ¶äº²å¤–æœ€äº²è¿‘çš„äººã€‚é˜®é›¯æ›¾ç•™å­¦å‰‘æ¡¥ï¼Œå¥¹çš„å®¶æ›¾å¯¹å¶æ–‡æ´å……æ»¡äº†å¸<span class="token punctuation">..</span>.
 <span class="token number">13</span>  <span class="token number">41</span>  åŠ¨çš„ä¸€ä¸ªï¼â€ä¸€åç”·çº¢å«å…µè¯•å›¾è½¬ç§»è¯é¢˜ã€‚<span class="token punctuation">\</span>n<span class="token punctuation">\</span>nã€€ã€€â€œä¹Ÿè®¸ä»¥åè¿™ä¸ªç†è®ºä¼šè¢«æ¨ç¿»ï¼Œä½†æœ¬ä¸–çºªçš„ä¸¤å¤§<span class="token punctuation">..</span>.
 <span class="token number">14</span>  <span class="token number">12</span>  é˜¶æ®µï¼Œæ—·æ—¥æŒä¹…çš„æ‰¹åˆ¤å°†é²œæ˜çš„æ”¿æ²»å›¾åƒå¦‚æ°´é“¶èˆ¬ï¼šæ³¨å…¥äº†ä»–ä»¬çš„æ„è¯†ï¼Œå°†ä»–ä»¬é‚£ç”±çŸ¥è¯†å’Œç†æ€§æ„ç­‘çš„æ€<span class="token punctuation">..</span>.
 <span class="token number">15</span>  <span class="token number">42</span>  ï¿½ï¼Œè¿™å£°éŸ³æ˜¯ç²¾ç¥å·²å½»åº•å´©æºƒçš„ç»ç³å‘å‡ºçš„ï¼Œå¬èµ·æ¥ååˆ†ææ€–ã€‚äººä»¬å¼€å§‹ç¦»å»ï¼Œæœ€åå‘å±•æˆä¸€åœºå¤§æºƒé€ƒï¼Œ<span class="token punctuation">..</span>.
 <span class="token number">16</span>  <span class="token number">20</span>  ï¿½è¿å…¶ä¸­çš„é¢¤æŠ–ä¹Ÿæ”¾å¤§äº†ï¼Œâ€œä½ æ²¡æœ‰æƒ³åˆ°æˆ‘ä¼šç«™å‡ºæ¥æ­å‘ä½ ï¼Œæ‰¹åˆ¤ä½ å§ï¼ï¼Ÿæ˜¯çš„ï¼Œæˆ‘ä»¥å‰å—ä½ æ¬ºéª—ï¼Œä½ ç”¨<span class="token punctuation">..</span>.<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="ollamallmlmstudioEmbeddingGraphRAG_827"></a>ä½¿ç”¨ollamaæä¾›llmæœåŠ¡ï¼Œlm-studioæä¾›EmbeddingæœåŠ¡ï¼Œè¿è¡ŒGraphRAGçš„æ–¹æ³•</h2> 
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœä½¿ç”¨lm-studioæä¾›EmbeddingæœåŠ¡ï¼Œä¸éœ€è¦ä¿®æ”¹è¿™ä¸¤ä¸ªæ–‡ä»¶<code>D:\ProgramData\miniconda3\envs\graphRAG\Lib\site-packages\graphrag\llm\openai\openai_embeddings_llm.py</code>å’Œ<code>D:\ProgramData\miniconda3\envs\graphRAG\Lib\site-packages\graphrag\query\llm\oai\embedding.py</code>ï¼Œç»´æŒå®˜æ–¹æä¾›åŸå§‹çš„æ ·å­ï¼š</p> 
<ul><li>.envçš„ä¿®æ”¹åŒä¸Šï¼š</li></ul> 
<pre><code class="prism language-shell">
<span class="token assign-left variable">GRAPHRAG_API_KEY</span><span class="token operator">=</span>ollama
<span class="token assign-left variable">GRAPHRAG_CLAIM_EXTRACTION_ENABLED</span><span class="token operator">=</span>True
</code></pre> 
<ul><li><code>setting.yaml</code>çš„é…ç½®å¦‚ä¸‹:</li></ul> 
<pre><code class="prism language-yaml">
<span class="token key atrule">encoding_model</span><span class="token punctuation">:</span> cl100k_base
<span class="token key atrule">skip_workflows</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token key atrule">llm</span><span class="token punctuation">:</span>
  <span class="token key atrule">api_key</span><span class="token punctuation">:</span> ollama
  <span class="token key atrule">type</span><span class="token punctuation">:</span> openai_chat <span class="token comment"># or azure_openai_chat</span>
  <span class="token key atrule">model</span><span class="token punctuation">:</span> qwen2
  <span class="token key atrule">model_supports_json</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># recommended if this is available for your model.</span>
  <span class="token comment"># max_tokens: 4000</span>
  <span class="token comment"># request_timeout: 180.0</span>
  <span class="token key atrule">api_base</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>11434/v1/
  <span class="token comment"># api_version: 2024-02-15-preview</span>
  <span class="token comment"># organization: &lt;organization_id&gt;</span>
  <span class="token comment"># deployment_name: &lt;azure_model_deployment_name&gt;</span>
  <span class="token comment"># tokens_per_minute: 150_000 # set a leaky bucket throttle</span>
  <span class="token comment"># requests_per_minute: 10_000 # set a leaky bucket throttle</span>
  <span class="token comment"># max_retries: 10</span>
  <span class="token comment"># max_retry_wait: 10.0</span>
  <span class="token comment"># sleep_on_rate_limit_recommendation: true # whether to sleep when azure suggests wait-times</span>
  <span class="token comment"># concurrent_requests: 25 # the number of parallel inflight requests that may be made</span>

<span class="token key atrule">parallelization</span><span class="token punctuation">:</span>
  <span class="token key atrule">stagger</span><span class="token punctuation">:</span> <span class="token number">0.3</span>
  <span class="token comment"># num_threads: 50 # the number of threads to use for parallel processing</span>

<span class="token key atrule">async_mode</span><span class="token punctuation">:</span> threaded <span class="token comment"># or asyncio</span>

<span class="token key atrule">embeddings</span><span class="token punctuation">:</span>
  <span class="token comment">## parallelization: override the global parallelization settings for embeddings</span>
  <span class="token key atrule">async_mode</span><span class="token punctuation">:</span> threaded <span class="token comment"># or asyncio</span>
  <span class="token key atrule">llm</span><span class="token punctuation">:</span>
    <span class="token comment">#api_key: ${GRAPHRAG_API_KEY}</span>
    <span class="token key atrule">api_key</span><span class="token punctuation">:</span> lm<span class="token punctuation">-</span>studio
    <span class="token key atrule">type</span><span class="token punctuation">:</span> openai_embedding <span class="token comment"># or azure_openai_embedding</span>
    <span class="token key atrule">model</span><span class="token punctuation">:</span> nomic<span class="token punctuation">-</span>ai/nomic<span class="token punctuation">-</span>embed<span class="token punctuation">-</span>text<span class="token punctuation">-</span>v1.5/nomic<span class="token punctuation">-</span>embed<span class="token punctuation">-</span>text<span class="token punctuation">-</span>v1.5.Q8_0.gguf
    <span class="token key atrule">api_base</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>1234/v1
    <span class="token comment"># api_version: 2024-02-15-preview</span>
    <span class="token comment"># organization: &lt;organization_id&gt;</span>
    <span class="token comment"># deployment_name: &lt;azure_model_deployment_name&gt;</span>
    <span class="token comment"># tokens_per_minute: 150_000 # set a leaky bucket throttle</span>
    <span class="token comment"># requests_per_minute: 10_000 # set a leaky bucket throttle</span>
    <span class="token comment"># max_retries: 10</span>
    <span class="token comment"># max_retry_wait: 10.0</span>
    <span class="token comment"># sleep_on_rate_limit_recommendation: true # whether to sleep when azure suggests wait-times</span>
    <span class="token key atrule">concurrent_requests</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># the number of parallel inflight requests that may be made</span>
    <span class="token comment"># batch_size: 16 # the number of documents to send in a single request</span>
    <span class="token comment"># batch_max_tokens: 8191 # the maximum number of tokens to send in a single request</span>
    <span class="token comment"># target: required # or optional</span>
  <span class="token punctuation">...</span>

</code></pre> 
<ul><li><code>chunk_text()</code>å‡½æ•°ä¿®æ”¹åŒä¸Š:</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">chunk_text</span><span class="token punctuation">(</span>
    text<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> max_tokens<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span> token_encoder<span class="token punctuation">:</span> tiktoken<span class="token punctuation">.</span>Encoding <span class="token operator">|</span> <span class="token boolean">None</span> <span class="token operator">=</span> <span class="token boolean">None</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Chunk text by token length."""</span>
    <span class="token keyword">if</span> token_encoder <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        token_encoder <span class="token operator">=</span> tiktoken<span class="token punctuation">.</span>get_encoding<span class="token punctuation">(</span><span class="token string">"cl100k_base"</span><span class="token punctuation">)</span>
    tokens <span class="token operator">=</span> token_encoder<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>text<span class="token punctuation">)</span>  <span class="token comment"># type: ignore</span>
    tokens <span class="token operator">=</span> token_encoder<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>tokens<span class="token punctuation">)</span> <span class="token comment"># å°†tokensè§£ç æˆå­—ç¬¦ä¸²</span>

    chunk_iterator <span class="token operator">=</span> batched<span class="token punctuation">(</span><span class="token builtin">iter</span><span class="token punctuation">(</span>tokens<span class="token punctuation">)</span><span class="token punctuation">,</span> max_tokens<span class="token punctuation">)</span>
    <span class="token keyword">yield</span> <span class="token keyword">from</span> chunk_iterator

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5843ea509f6a874b54ef93ab079e90dd/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">nodeä¸­å¦‚ä½•å®šä¹‰ä¸­é—´ä»¶</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dc565487353d8e788d0d4b485f081ea4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">spring boot æ ¹æ®å®ä½“ç±»ç”Ÿæˆè¡¨</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>