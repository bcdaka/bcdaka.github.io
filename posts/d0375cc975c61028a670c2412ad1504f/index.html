<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Redis安全加固策略：绑定Redis监听的IP地址 &amp; 修改默认端口 &amp; 禁用或者重命名高危命令 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/d0375cc975c61028a670c2412ad1504f/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Redis安全加固策略：绑定Redis监听的IP地址 & 修改默认端口 & 禁用或者重命名高危命令">
  <meta property="og:description" content="Redis安全加固策略：绑定Redis监听的IP地址 &amp; 修改默认端口 &amp; 禁用或者重命名高危命令 1.1 绑定Redis监听的IP地址1.2 修改默认端口1.3 禁用或者重命名高危命令1.4 附：redis配置文件详解（来源于网络） 💖The Begin💖点点关注，收藏不迷路💖 1.1 绑定Redis监听的IP地址 设置Redis配置文件设置bind选项。这个选项指定了Redis服务器监听的IP地址，可以是单个IP地址、多个IP地址或者0.0.0.0表示监听所有网络接口。
为了安全起见，建议将Redis服务器绑定到特定的IP地址，而不是监听所有网络接口。这样可以限制Redis只接受来自指定IP地址的连接，提高安全性。
检测方法：
执行一下命令查看当前运行数据库实例的配置文件名称：
【安装路径】/redis-cli -p 【数据库端口】-a 【认证密码】 -h 【数据库主机名称或IP】 redis-cli -h 127.0.0.1 -p 8801 -a Zyl##2024 127.0.0.1:6379&gt; CONFIG GET bind 1) &#34;bind&#34; 2) &#34;0.0.0.0&#34; 127.0.0.1:6379&gt; 或查看配置文件中的相应配置。
判定依据： bind配置了相关地址限制则为合规，否则为不合规。
加固参考配置操作：
1、修改配置文件在bind后添加需要连接的IP地址 vi /usr/local/redis-7.0.9/redis.conf ## 添加/修改内容： bind 具体IP地址 这里建议配置固定需要连接redis数据库的IP。
2、重新启动redis数据库。
systemctl restart redis 1.2 修改默认端口 修改默认端口可以增加系统的安全性，因为大多数攻击者会尝试连接到常见的默认端口，如6379。
通过将Redis服务器迁移到非标准端口，可以减少受到自动扫描和恶意攻击的风险。
检测方法：
执行以下命令查看当前数据库使用的端口：
Linux
【安装路径】/redis-cli -p 【数据库端口】-a 【认证密码】 -h 【数据库主机名称或IP】 redis-cli -h 127.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-03T02:42:06+08:00">
    <meta property="article:modified_time" content="2024-03-03T02:42:06+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Redis安全加固策略：绑定Redis监听的IP地址 &amp; 修改默认端口 &amp; 禁用或者重命名高危命令</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Redis安全加固策略：绑定Redis监听的IP地址 &amp; 修改默认端口 &amp; 禁用或者重命名高危命令</h4> 
 <ul><li><ul><li><a href="#11_RedisIP_12" rel="nofollow">1.1 绑定Redis监听的IP地址</a></li><li><a href="#12__66" rel="nofollow">1.2 修改默认端口</a></li><li><a href="#13__125" rel="nofollow">1.3 禁用或者重命名高危命令</a></li><li><a href="#14_redis_198" rel="nofollow">1.4 附：redis配置文件详解（来源于网络）</a></li></ul> 
 </li></ul> 
</div> 
<br> 
<br> 
<p></p> 
<table width="100%"><tbody><tr><td width="50%"> 
    <div align="center"> 
     <font color="#E73B3E"><em>💖The Begin💖点点关注，收藏不迷路💖<em></em></em></font> 
    </div> </td></tr></tbody></table> 
<h3><a id="11_RedisIP_12"></a>1.1 绑定Redis监听的IP地址</h3> 
<p>设置Redis配置文件设置bind选项。这个选项指定了Redis服务器监听的IP地址，可以是单个IP地址、多个IP地址或者0.0.0.0表示监听所有网络接口。</p> 
<p>为了安全起见，建议将Redis服务器绑定到特定的IP地址，而不是监听所有网络接口。这样可以限制Redis只接受来自指定IP地址的连接，提高安全性。</p> 
<p><strong><code>检测方法：</code></strong></p> 
<p>执行一下命令查看当前运行数据库实例的配置文件名称：</p> 
<pre><code class="prism language-sql">【安装路径】<span class="token operator">/</span>redis<span class="token operator">-</span>cli <span class="token operator">-</span>p 【数据库端口】<span class="token operator">-</span>a 【认证密码】 <span class="token operator">-</span>h 【数据库主机名称或IP】

redis<span class="token operator">-</span>cli <span class="token operator">-</span>h <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span>p <span class="token number">8801</span> <span class="token operator">-</span>a Zyl<span class="token comment">##2024</span>

<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> CONFIG GET bind
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"bind"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"0.0.0.0"</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> 
</code></pre> 
<p>或查看配置文件中的相应配置。</p> 
<p><img src="https://images2.imgbox.com/60/83/KL7AWGlo_o.png" alt="在这里插入图片描述"></p> 
<p>判定依据： bind配置了相关地址限制则为合规，否则为不合规。</p> 
<p><strong>加固参考配置操作：</strong></p> 
<pre><code class="prism language-sql"><span class="token number">1</span>、修改配置文件在bind后添加需要连接的IP地址

vi <span class="token operator">/</span>usr<span class="token operator">/</span><span class="token keyword">local</span><span class="token operator">/</span>redis<span class="token operator">-</span><span class="token number">7.0</span><span class="token number">.9</span><span class="token operator">/</span>redis<span class="token punctuation">.</span>conf

<span class="token comment">## 添加/修改内容：</span>

bind 具体IP地址
</code></pre> 
<p><img src="https://images2.imgbox.com/11/7b/GBfK0db7_o.png" alt="在这里插入图片描述"></p> 
<p><strong><code>这里建议配置固定需要连接redis数据库的IP。</code></strong></p> 
<p>2、重新启动redis数据库。</p> 
<pre><code class="prism language-sql">systemctl restart redis
</code></pre> 
<h3><a id="12__66"></a>1.2 修改默认端口</h3> 
<p>修改默认端口可以增加系统的安全性，因为大多数攻击者会尝试连接到常见的默认端口，如6379。</p> 
<p>通过将Redis服务器迁移到非标准端口，可以减少受到自动扫描和恶意攻击的风险。</p> 
<p><strong><code>检测方法：</code></strong></p> 
<p>执行以下命令查看当前数据库使用的端口：</p> 
<p>Linux</p> 
<pre><code class="prism language-sql">【安装路径】<span class="token operator">/</span>redis<span class="token operator">-</span>cli <span class="token operator">-</span>p 【数据库端口】<span class="token operator">-</span>a 【认证密码】 <span class="token operator">-</span>h 【数据库主机名称或IP】
redis<span class="token operator">-</span>cli <span class="token operator">-</span>h <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span>p <span class="token number">8801</span> <span class="token operator">-</span>a Zyl<span class="token comment">##2024</span>

CONFIG GET port
</code></pre> 
<p>Windows</p> 
<pre><code class="prism language-sql">【安装路径】<span class="token operator">/</span>redis<span class="token operator">-</span>cli <span class="token operator">-</span>p 【数据库端口】<span class="token operator">-</span>a 【认证密码】 <span class="token operator">-</span>h 【数据库主机名称或IP】 
redis<span class="token operator">-</span>cli <span class="token operator">-</span>h <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span>p <span class="token number">8801</span> <span class="token operator">-</span>a Zyl<span class="token comment">##2024</span>

CONFIG GET port
</code></pre> 
<p><strong><code>判定依据：</code></strong> 使用端口不是默认端口6379则为合规，否则为不合规。</p> 
<p><img src="https://images2.imgbox.com/2a/40/uMPxs9cc_o.png" alt="在这里插入图片描述"></p> 
<p><strong><code>加固参考配置操作：</code></strong></p> 
<p>1、编辑对应的配置文件，在配置文件中找到port选项，修改默认端口号；</p> 
<pre><code class="prism language-sql">port <span class="token number">8801</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9f/0b/fWryrA1g_o.png" alt="在这里插入图片描述"></p> 
<p>2、重新启动redis数据库。</p> 
<pre><code class="prism language-sql">systemctl restart redis
</code></pre> 
<p>3、端口配置检查</p> 
<pre><code class="prism language-sql">CONFIG GET port

或者
ps <span class="token operator">-</span>ef <span class="token operator">|</span> grep redis
</code></pre> 
<p><img src="https://images2.imgbox.com/aa/a8/5mcherg3_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/0a/d0/DSbHthvE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="13__125"></a>1.3 禁用或者重命名高危命令</h3> 
<p>在Redis中，可以通过修改配置文件来禁用或重命名危险命令，以增强安全性。</p> 
<p><strong><code>检测方法：</code></strong></p> 
<p>1、查看Redis数据库配置文件redis.conf中是否重命名了危险的命令，例如:</p> 
<pre><code class="prism language-sql"><span class="token keyword">rename</span><span class="token operator">-</span>command CONFIG CONFIG_b9fc8327c4dee7
<span class="token keyword">rename</span><span class="token operator">-</span>command <span class="token keyword">SHUTDOWN</span> SHUTDOWN_b9fc8327c4dee7
<span class="token keyword">rename</span><span class="token operator">-</span>command FLUSHDB <span class="token string">""</span>
<span class="token keyword">rename</span><span class="token operator">-</span>command FLUSHALL <span class="token string">""</span>
</code></pre> 
<p><strong><code>判定依据：</code></strong> 危险的的命令已经重命名则为合规，否则为不合规。</p> 
<p><strong><code>加固参考配置操作：</code></strong></p> 
<p>1、编辑配置文件重命名危险命令，如下所示：</p> 
<pre><code class="prism language-sql"><span class="token keyword">rename</span><span class="token operator">-</span>command CONFIG CONFIG_b9fc8327c4dee7      <span class="token comment">#重命名CONFIG命令</span>
<span class="token keyword">rename</span><span class="token operator">-</span>command <span class="token keyword">SHUTDOWN</span> SHUTDOWN_b9fc8327c4dee7  <span class="token comment">#重命SHUTDOWN命令 </span>
<span class="token keyword">rename</span><span class="token operator">-</span>command FLUSHDB <span class="token string">""</span>          <span class="token comment">#禁用FLUSHDB</span>
<span class="token keyword">rename</span><span class="token operator">-</span>command FLUSHALL <span class="token string">""</span>         <span class="token comment">#禁用FLUSHALL</span>
</code></pre> 
<p>根据实际需求，可以根据需要禁用或重命名其他危险命令，以增强Redis的安全性。<br> <img src="https://images2.imgbox.com/3f/64/hKXKW7nx_o.png" alt="在这里插入图片描述"></p> 
<p>2、重新启动Redis服务。</p> 
<pre><code class="prism language-sql">systemctl restart redis
</code></pre> 
<p>3、验证配置修改</p> 
<pre><code class="prism language-sql">redis<span class="token operator">-</span>cli <span class="token operator">-</span>h <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">-</span>p <span class="token number">8801</span> <span class="token operator">-</span>a Zyl<span class="token comment">##2024</span>


<span class="token punctuation">[</span>root<span class="token variable">@zyl</span><span class="token operator">-</span>server <span class="token operator">~</span><span class="token punctuation">]</span><span class="token comment"># redis-cli -h 127.0.0.1 -p 8801 -a Zyl##2024</span>
Warning: <span class="token keyword">Using</span> a password <span class="token keyword">with</span> <span class="token string">'-a'</span> <span class="token operator">or</span> <span class="token string">'-u'</span> <span class="token keyword">option</span> <span class="token keyword">on</span> the command line interface may <span class="token operator">not</span> be safe<span class="token punctuation">.</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">8801</span><span class="token operator">&gt;</span> config <span class="token keyword">set</span> <span class="token number">111</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR unknown command <span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token keyword">with</span> args beginning <span class="token keyword">with</span>: <span class="token string">'set'</span> <span class="token string">'111'</span> 
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">8801</span><span class="token operator">&gt;</span> <span class="token keyword">SHUTDOWN</span> 
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR unknown command <span class="token string">'SHUTDOWN'</span><span class="token punctuation">,</span> <span class="token keyword">with</span> args beginning <span class="token keyword">with</span>: 
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">8801</span><span class="token operator">&gt;</span> FLUSHDB 
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR unknown command <span class="token string">'FLUSHDB'</span><span class="token punctuation">,</span> <span class="token keyword">with</span> args beginning <span class="token keyword">with</span>: 
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">8801</span><span class="token operator">&gt;</span> 
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">8801</span><span class="token operator">&gt;</span> FLUSHALL 
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR unknown command <span class="token string">'FLUSHALL'</span><span class="token punctuation">,</span> <span class="token keyword">with</span> args beginning <span class="token keyword">with</span>: 
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">8801</span><span class="token operator">&gt;</span> 
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">8801</span><span class="token operator">&gt;</span> CONFIG_b9fc8327c4dee7 get port
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"port"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"8801"</span>
<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">8801</span><span class="token operator">&gt;</span> 

</code></pre> 
<p><img src="https://images2.imgbox.com/e2/a9/GStNatvn_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/75/4f/olVQwAj7_o.png" alt="在这里插入图片描述"></p> 
<p>可以看到，这些高危命令已禁用和重命名成功。</p> 
<h3><a id="14_redis_198"></a>1.4 附：redis配置文件详解（来源于网络）</h3> 
<pre><code class="prism language-sql"><span class="token comment"># 当配置中需要配置内存大小时，可以使用 1k, 5GB, 4M 等类似的格式，其转换方式如下(不区分大小写)</span>
<span class="token comment">#</span>
<span class="token comment"># 1k =&gt; 1000 bytes</span>
<span class="token comment"># 1kb =&gt; 1024 bytes</span>
<span class="token comment"># 1m =&gt; 1000000 bytes</span>
<span class="token comment"># 1mb =&gt; 1024*1024 bytes</span>
<span class="token comment"># 1g =&gt; 1000000000 bytes</span>
<span class="token comment"># 1gb =&gt; 1024*1024*1024 bytes</span>
<span class="token comment">#</span>
<span class="token comment"># 不区分大小写：内存配置大小写是一样的.比如 1gb 1Gb 1GB 1gB</span>

<span class="token comment"># daemonize no 默认情况下，redis不是在后台运行的，如果需要在后台运行，把该项的值更改为yes</span>
daemonize yes

<span class="token comment"># 当redis在后台运行的时候，Redis默认会把pid文件放在/var/run/redis.pid，你可以配置到其他地址。</span>
<span class="token comment"># 当运行多个redis服务时，需要指定不同的pid文件和端口</span>
pidfile <span class="token operator">/</span>var<span class="token operator">/</span>run<span class="token operator">/</span>redis<span class="token punctuation">.</span>pid

<span class="token comment"># 指定redis运行的端口，默认是6379</span>
port <span class="token number">6379</span>

<span class="token comment"># 指定redis只接收来自于该IP地址的请求，如果不进行设置，那么将处理所有请求，</span>
<span class="token comment"># 在生产环境中最好设置该项</span>
<span class="token comment"># bind 127.0.0.1</span>

<span class="token comment"># Specify the path for the unix socket that will be used to listen for</span>
<span class="token comment"># incoming connections. There is no default, so Redis will not listen</span>
<span class="token comment"># on a unix socket when not specified.</span>
<span class="token comment">#</span>
<span class="token comment"># unixsocket /tmp/redis.sock</span>
<span class="token comment"># unixsocketperm 755</span>

<span class="token comment"># 设置客户端连接时的超时时间，单位为秒。当客户端在这段时间内没有发出任何指令，那么关闭该连接</span>
<span class="token comment"># 0是关闭此设置</span>
timeout <span class="token number">0</span>

<span class="token comment"># 指定日志记录级别</span>
<span class="token comment"># Redis总共支持四个级别：debug、verbose、notice、warning，默认为verbose</span>
<span class="token comment"># debug 记录很多信息，用于开发和测试</span>
<span class="token comment"># varbose 有用的信息，不像debug会记录那么多</span>
<span class="token comment"># notice 普通的verbose，常用于生产环境</span>
<span class="token comment"># warning 只有非常重要或者严重的信息会记录到日志</span>
loglevel debug

<span class="token comment"># 配置log文件地址</span>
<span class="token comment"># 默认值为stdout，标准输出，若后台模式会输出到/dev/null</span>
<span class="token comment">#logfile stdout</span>
logfile <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>redis<span class="token operator">/</span>redis<span class="token punctuation">.</span>log

<span class="token comment"># To enable logging to the system logger, just set 'syslog-enabled' to yes,</span>
<span class="token comment"># and optionally update the other syslog parameters to suit your needs.</span>
<span class="token comment"># syslog-enabled no</span>

<span class="token comment"># Specify the syslog identity.</span>
<span class="token comment"># syslog-ident redis</span>

<span class="token comment"># Specify the syslog facility. Must be USER or between LOCAL0-LOCAL7.</span>
<span class="token comment"># syslog-facility local0</span>

<span class="token comment"># 可用数据库数</span>
<span class="token comment"># 默认值为16，默认数据库为0，数据库范围在0-（database-1）之间</span>
<span class="token keyword">databases</span> <span class="token number">16</span>

<span class="token comment">################################ 快照 #################################</span>
<span class="token comment">#</span>
<span class="token comment"># 保存数据到磁盘，格式如下:</span>
<span class="token comment">#</span>
<span class="token comment"># save &lt;seconds&gt; &lt;changes&gt;</span>
<span class="token comment">#</span>
<span class="token comment"># 指出在多长时间内，有多少次更新操作，就将数据同步到数据文件rdb。</span>
<span class="token comment"># 相当于条件触发抓取快照，这个可以多个条件配合</span>
<span class="token comment">#</span>
<span class="token comment"># 比如默认配置文件中的设置，就设置了三个条件</span>
<span class="token comment">#</span>
<span class="token comment"># save 900 1 900秒内至少有1个key被改变</span>
<span class="token comment"># save 300 10 300秒内至少有300个key被改变</span>
<span class="token comment"># save 60 10000 60秒内至少有10000个key被改变</span>

<span class="token keyword">save</span> <span class="token number">900</span> <span class="token number">1</span>
<span class="token keyword">save</span> <span class="token number">300</span> <span class="token number">10</span>
<span class="token keyword">save</span> <span class="token number">60</span> <span class="token number">10000</span>

<span class="token comment"># 存储至本地数据库时（持久化到rdb文件）是否压缩数据，默认为yes</span>
rdbcompression yes

<span class="token comment"># 本地持久化数据库文件名，默认值为dump.rdb</span>
dbfilename <span class="token keyword">dump</span><span class="token punctuation">.</span>rdb

<span class="token comment"># 工作目录</span>
<span class="token comment">#</span>
<span class="token comment"># 数据库镜像备份的文件放置的路径。</span>
<span class="token comment"># 这里的路径跟文件名要分开配置是因为redis在进行备份时，先会将当前数据库的状态写入到一个临时文件中，等备份完成时，</span>
<span class="token comment"># 再把该该临时文件替换为上面所指定的文件，而这里的临时文件和上面所配置的备份文件都会放在这个指定的路径当中。</span>
<span class="token comment">#</span>
<span class="token comment"># AOF文件也会存放在这个目录下面</span>
<span class="token comment">#</span>
<span class="token comment"># 注意这里必须制定一个目录而不是文件</span>
dir <span class="token punctuation">.</span><span class="token operator">/</span>

<span class="token comment">################################# 复制 #################################</span>

<span class="token comment"># 主从复制. 设置该数据库为其他数据库的从数据库.</span>
<span class="token comment"># 设置当本机为slav服务时，设置master服务的IP地址及端口，在Redis启动时，它会自动从master进行数据同步</span>
<span class="token comment">#</span>
<span class="token comment"># slaveof &lt;masterip&gt; &lt;masterport&gt;</span>

<span class="token comment"># 当master服务设置了密码保护时(用requirepass制定的密码)</span>
<span class="token comment"># slav服务连接master的密码</span>
<span class="token comment">#</span>
<span class="token comment"># masterauth &lt;master-password&gt;</span>


<span class="token comment"># 当从库同主机失去连接或者复制正在进行，从机库有两种运行方式：</span>
<span class="token comment">#</span>
<span class="token comment"># 1) 如果slave-serve-stale-data设置为yes(默认设置)，从库会继续相应客户端的请求</span>
<span class="token comment">#</span>
<span class="token comment"># 2) 如果slave-serve-stale-data是指为no，出去INFO和SLAVOF命令之外的任何请求都会返回一个</span>
<span class="token comment"># 错误"SYNC with master in progress"</span>
<span class="token comment">#</span>
slave<span class="token operator">-</span>serve<span class="token operator">-</span>stale<span class="token operator">-</span><span class="token keyword">data</span> yes

<span class="token comment"># 从库会按照一个时间间隔向主库发送PINGs.可以通过repl-ping-slave-period设置这个时间间隔，默认是10秒</span>
<span class="token comment">#</span>
<span class="token comment"># repl-ping-slave-period 10</span>

<span class="token comment"># repl-timeout 设置主库批量数据传输时间或者ping回复时间间隔，默认值是60秒</span>
<span class="token comment"># 一定要确保repl-timeout大于repl-ping-slave-period</span>
<span class="token comment"># repl-timeout 60</span>

<span class="token comment">################################## 安全 ###################################</span>

<span class="token comment"># 设置客户端连接后进行任何其他指定前需要使用的密码。</span>
<span class="token comment"># 警告：因为redis速度相当快，所以在一台比较好的服务器下，一个外部的用户可以在一秒钟进行150K次的密码尝试，这意味着你需要指定非常非常强大的密码来防止暴力破解</span>
<span class="token comment">#</span>
<span class="token comment"># requirepass foobared</span>

<span class="token comment"># 命令重命名.</span>
<span class="token comment">#</span>
<span class="token comment"># 在一个共享环境下可以重命名相对危险的命令。比如把CONFIG重名为一个不容易猜测的字符。</span>
<span class="token comment">#</span>
<span class="token comment"># 举例:</span>
<span class="token comment">#</span>
<span class="token comment"># rename-command CONFIG b840fc02d524045429941cc15f59e41cb7be6c52</span>
<span class="token comment">#</span>
<span class="token comment"># 如果想删除一个命令，直接把它重命名为一个空字符""即可，如下：</span>
<span class="token comment">#</span>
<span class="token comment"># rename-command CONFIG ""</span>

<span class="token comment">################################### 约束 ####################################</span>

<span class="token comment"># 设置同一时间最大客户端连接数，默认无限制，Redis可以同时打开的客户端连接数为Redis进程可以打开的最大文件描述符数，</span>
<span class="token comment"># 如果设置 maxclients 0，表示不作限制。</span>
<span class="token comment"># 当客户端连接数到达限制时，Redis会关闭新的连接并向客户端返回max number of clients reached错误信息</span>
<span class="token comment">#</span>
<span class="token comment"># maxclients 128</span>

<span class="token comment"># 指定Redis最大内存限制，Redis在启动时会把数据加载到内存中，达到最大内存后，Redis会先尝试清除已到期或即将到期的Key</span>
<span class="token comment"># Redis同时也会移除空的list对象</span>
<span class="token comment">#</span>
<span class="token comment"># 当此方法处理后，仍然到达最大内存设置，将无法再进行写入操作，但仍然可以进行读取操作</span>
<span class="token comment">#</span>
<span class="token comment"># 注意：Redis新的vm机制，会把Key存放内存，Value会存放在swap区</span>
<span class="token comment">#</span>
<span class="token comment"># maxmemory的设置比较适合于把redis当作于类似memcached的缓存来使用，而不适合当做一个真实的DB。</span>
<span class="token comment"># 当把Redis当做一个真实的数据库使用的时候，内存使用将是一个很大的开销</span>
<span class="token comment"># maxmemory &lt;bytes&gt;</span>

<span class="token comment"># 当内存达到最大值的时候Redis会选择删除哪些数据？有五种方式可供选择</span>
<span class="token comment">#</span>
<span class="token comment"># volatile-lru -&gt; 利用LRU算法移除设置过过期时间的key (LRU:最近使用 Least Recently Used )</span>
<span class="token comment"># allkeys-lru -&gt; 利用LRU算法移除任何key</span>
<span class="token comment"># volatile-random -&gt; 移除设置过过期时间的随机key</span>
<span class="token comment"># allkeys-&gt;random -&gt; remove a random key, any key</span>
<span class="token comment"># volatile-ttl -&gt; 移除即将过期的key(minor TTL)</span>
<span class="token comment"># noeviction -&gt; 不移除任何可以，只是返回一个写错误</span>
<span class="token comment">#</span>
<span class="token comment"># 注意：对于上面的策略，如果没有合适的key可以移除，当写的时候Redis会返回一个错误</span>
<span class="token comment">#</span>
<span class="token comment"># 写命令包括: set setnx setex append</span>
<span class="token comment"># incr decr rpush lpush rpushx lpushx linsert lset rpoplpush sadd</span>
<span class="token comment"># sinter sinterstore sunion sunionstore sdiff sdiffstore zadd zincrby</span>
<span class="token comment"># zunionstore zinterstore hset hsetnx hmset hincrby incrby decrby</span>
<span class="token comment"># getset mset msetnx exec sort</span>
<span class="token comment">#</span>
<span class="token comment"># 默认是:</span>
<span class="token comment">#</span>
<span class="token comment"># maxmemory-policy volatile-lru</span>

<span class="token comment"># LRU 和 minimal TTL 算法都不是精准的算法，但是相对精确的算法(为了节省内存)，随意你可以选择样本大小进行检测。</span>
<span class="token comment"># Redis默认的灰选择3个样本进行检测，你可以通过maxmemory-samples进行设置</span>
<span class="token comment">#</span>
<span class="token comment"># maxmemory-samples 3</span>

<span class="token comment">############################## AOF ###############################</span>


<span class="token comment"># 默认情况下，redis会在后台异步的把数据库镜像备份到磁盘，但是该备份是非常耗时的，而且备份也不能很频繁，如果发生诸如拉闸限电、拔插头等状况，那么将造成比较大范围的数据丢失。</span>
<span class="token comment"># 所以redis提供了另外一种更加高效的数据库备份及灾难恢复方式。</span>
<span class="token comment"># 开启append only模式之后，redis会把所接收到的每一次写操作请求都追加到appendonly.aof文件中，当redis重新启动时，会从该文件恢复出之前的状态。</span>
<span class="token comment"># 但是这样会造成appendonly.aof文件过大，所以redis还支持了BGREWRITEAOF指令，对appendonly.aof 进行重新整理。</span>
<span class="token comment"># 你可以同时开启asynchronous dumps 和 AOF</span>

appendonly <span class="token keyword">no</span>

<span class="token comment"># AOF文件名称 (默认: "appendonly.aof")</span>
<span class="token comment"># appendfilename appendonly.aof</span>

<span class="token comment"># Redis支持三种同步AOF文件的策略:</span>
<span class="token comment">#</span>
<span class="token comment"># no: 不进行同步，系统去操作 . Faster.</span>
<span class="token comment"># always: always表示每次有写操作都进行同步. Slow, Safest.</span>
<span class="token comment"># everysec: 表示对写操作进行累积，每秒同步一次. Compromise.</span>
<span class="token comment">#</span>
<span class="token comment"># 默认是"everysec"，按照速度和安全折中这是最好的。</span>
<span class="token comment"># 如果想让Redis能更高效的运行，你也可以设置为"no"，让操作系统决定什么时候去执行</span>
<span class="token comment"># 或者相反想让数据更安全你也可以设置为"always"</span>
<span class="token comment">#</span>
<span class="token comment"># 如果不确定就用 "everysec".</span>

<span class="token comment"># appendfsync always</span>
appendfsync everysec
<span class="token comment"># appendfsync no</span>

<span class="token comment"># AOF策略设置为always或者everysec时，后台处理进程(后台保存或者AOF日志重写)会执行大量的I/O操作</span>
<span class="token comment"># 在某些Linux配置中会阻止过长的fsync()请求。注意现在没有任何修复，即使fsync在另外一个线程进行处理</span>
<span class="token comment">#</span>
<span class="token comment"># 为了减缓这个问题，可以设置下面这个参数no-appendfsync-on-rewrite</span>
<span class="token comment">#</span>
<span class="token comment"># This means that while another child is saving the durability of Redis is</span>
<span class="token comment"># the same as "appendfsync none", that in pratical terms means that it is</span>
<span class="token comment"># possible to lost up to 30 seconds of log in the worst scenario (with the</span>
<span class="token comment"># default Linux settings).</span>
<span class="token comment">#</span>
<span class="token comment"># If you have latency problems turn this to "yes". Otherwise leave it as</span>
<span class="token comment"># "no" that is the safest pick from the point of view of durability.</span>
<span class="token keyword">no</span><span class="token operator">-</span>appendfsync<span class="token operator">-</span><span class="token keyword">on</span><span class="token operator">-</span>rewrite <span class="token keyword">no</span>

<span class="token comment"># Automatic rewrite of the append only file.</span>
<span class="token comment"># AOF 自动重写</span>
<span class="token comment"># 当AOF文件增长到一定大小的时候Redis能够调用 BGREWRITEAOF 对日志文件进行重写</span>
<span class="token comment">#</span>
<span class="token comment"># 它是这样工作的：Redis会记住上次进行些日志后文件的大小(如果从开机以来还没进行过重写，那日子大小在开机的时候确定)</span>
<span class="token comment">#</span>
<span class="token comment"># 基础大小会同现在的大小进行比较。如果现在的大小比基础大小大制定的百分比，重写功能将启动</span>
<span class="token comment"># 同时需要指定一个最小大小用于AOF重写，这个用于阻止即使文件很小但是增长幅度很大也去重写AOF文件的情况</span>
<span class="token comment"># 设置 percentage 为0就关闭这个特性</span>

auto<span class="token operator">-</span>aof<span class="token operator">-</span>rewrite<span class="token operator">-</span>percentage <span class="token number">100</span>
auto<span class="token operator">-</span>aof<span class="token operator">-</span>rewrite<span class="token operator">-</span>min<span class="token operator">-</span>size <span class="token number">64</span>mb

<span class="token comment">################################## SLOW LOG ###################################</span>

<span class="token comment"># Redis Slow Log 记录超过特定执行时间的命令。执行时间不包括I/O计算比如连接客户端，返回结果等，只是命令执行时间</span>
<span class="token comment">#</span>
<span class="token comment"># 可以通过两个参数设置slow log：一个是告诉Redis执行超过多少时间被记录的参数slowlog-log-slower-than(微妙)，</span>
<span class="token comment"># 另一个是slow log 的长度。当一个新命令被记录的时候最早的命令将被从队列中移除</span>

<span class="token comment"># 下面的时间以微妙微单位，因此1000000代表一分钟。</span>
<span class="token comment"># 注意制定一个负数将关闭慢日志，而设置为0将强制每个命令都会记录</span>
slowlog<span class="token operator">-</span>log<span class="token operator">-</span>slower<span class="token operator">-</span>than <span class="token number">10000</span>

<span class="token comment"># 对日志长度没有限制，只是要注意它会消耗内存</span>
<span class="token comment"># 可以通过 SLOWLOG RESET 回收被慢日志消耗的内存</span>
slowlog<span class="token operator">-</span>max<span class="token operator">-</span>len <span class="token number">1024</span>

<span class="token comment">################################ VM ###############################</span>

<span class="token comment">### WARNING! Virtual Memory is deprecated in Redis 2.4</span>
<span class="token comment">### The use of Virtual Memory is strongly discouraged.</span>

<span class="token comment"># Virtual Memory allows Redis to work with datasets bigger than the actual</span>
<span class="token comment"># amount of RAM needed to hold the whole dataset in memory.</span>
<span class="token comment"># In order to do so very used keys are taken in memory while the other keys</span>
<span class="token comment"># are swapped into a swap file, similarly to what operating systems do</span>
<span class="token comment"># with memory pages.</span>
<span class="token comment">#</span>
<span class="token comment"># To enable VM just set 'vm-enabled' to yes, and set the following three</span>
<span class="token comment"># VM parameters accordingly to your needs.</span>

vm<span class="token operator">-</span>enabled <span class="token keyword">no</span>
<span class="token comment"># vm-enabled yes</span>

<span class="token comment"># This is the path of the Redis swap file. As you can guess, swap files</span>
<span class="token comment"># can't be shared by different Redis instances, so make sure to use a swap</span>
<span class="token comment"># file for every redis process you are running. Redis will complain if the</span>
<span class="token comment"># swap file is already in use.</span>
<span class="token comment">#</span>
<span class="token comment"># The best kind of storage for the Redis swap file (that's accessed at random)</span>
<span class="token comment"># is a Solid State Disk (SSD).</span>
<span class="token comment">#</span>
<span class="token comment"># *** WARNING *** if you are using a shared hosting the default of putting</span>
<span class="token comment"># the swap file under /tmp is not secure. Create a dir with access granted</span>
<span class="token comment"># only to Redis user and configure Redis to create the swap file there.</span>
vm<span class="token operator">-</span>swap<span class="token operator">-</span><span class="token keyword">file</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>redis<span class="token punctuation">.</span>swap

<span class="token comment"># vm-max-memory configures the VM to use at max the specified amount of</span>
<span class="token comment"># RAM. Everything that deos not fit will be swapped on disk *if* possible, that</span>
<span class="token comment"># is, if there is still enough contiguous space in the swap file.</span>
<span class="token comment">#</span>
<span class="token comment"># With vm-max-memory 0 the system will swap everything it can. Not a good</span>
<span class="token comment"># default, just specify the max amount of RAM you can in bytes, but it's</span>
<span class="token comment"># better to leave some margin. For instance specify an amount of RAM</span>
<span class="token comment"># that's more or less between 60 and 80% of your free RAM.</span>
vm<span class="token operator">-</span>max<span class="token operator">-</span>memory <span class="token number">0</span>

<span class="token comment"># Redis swap files is split into pages. An object can be saved using multiple</span>
<span class="token comment"># contiguous pages, but pages can't be shared between different objects.</span>
<span class="token comment"># So if your page is too big, small objects swapped out on disk will waste</span>
<span class="token comment"># a lot of space. If you page is too small, there is less space in the swap</span>
<span class="token comment"># file (assuming you configured the same number of total swap file pages).</span>
<span class="token comment">#</span>
<span class="token comment"># If you use a lot of small objects, use a page size of 64 or 32 bytes.</span>
<span class="token comment"># If you use a lot of big objects, use a bigger page size.</span>
<span class="token comment"># If unsure, use the default :)</span>
vm<span class="token operator">-</span>page<span class="token operator">-</span>size <span class="token number">32</span>

<span class="token comment"># Number of total memory pages in the swap file.</span>
<span class="token comment"># Given that the page table (a bitmap of free/used pages) is taken in memory,</span>
<span class="token comment"># every 8 pages on disk will consume 1 byte of RAM.</span>
<span class="token comment">#</span>
<span class="token comment"># The total swap size is vm-page-size * vm-pages</span>
<span class="token comment">#</span>
<span class="token comment"># With the default of 32-bytes memory pages and 134217728 pages Redis will</span>
<span class="token comment"># use a 4 GB swap file, that will use 16 MB of RAM for the page table.</span>
<span class="token comment">#</span>
<span class="token comment"># It's better to use the smallest acceptable value for your application,</span>
<span class="token comment"># but the default is large in order to work in most conditions.</span>
vm<span class="token operator">-</span>pages <span class="token number">134217728</span>

<span class="token comment"># Max number of VM I/O threads running at the same time.</span>
<span class="token comment"># This threads are used to read/write data from/to swap file, since they</span>
<span class="token comment"># also encode and decode objects from disk to memory or the reverse, a bigger</span>
<span class="token comment"># number of threads can help with big objects even if they can't help with</span>
<span class="token comment"># I/O itself as the physical device may not be able to couple with many</span>
<span class="token comment"># reads/writes operations at the same time.</span>
<span class="token comment">#</span>
<span class="token comment"># The special value of 0 turn off threaded I/O and enables the blocking</span>
<span class="token comment"># Virtual Memory implementation.</span>
vm<span class="token operator">-</span>max<span class="token operator">-</span>threads <span class="token number">4</span>

<span class="token comment">############################### ADVANCED CONFIG ###############################</span>

<span class="token comment"># 当hash中包含超过指定元素个数并且最大的元素没有超过临界时，</span>
<span class="token comment"># hash将以一种特殊的编码方式（大大减少内存使用）来存储，这里可以设置这两个临界值</span>
<span class="token comment"># Redis Hash对应Value内部实际就是一个HashMap，实际这里会有2种不同实现，</span>
<span class="token comment"># 这个Hash的成员比较少时Redis为了节省内存会采用类似一维数组的方式来紧凑存储，而不会采用真正的HashMap结构，对应的value redisObject的encoding为zipmap,</span>
<span class="token comment"># 当成员数量增大时会自动转成真正的HashMap,此时encoding为ht。</span>
<span class="token keyword">hash</span><span class="token operator">-</span>max<span class="token operator">-</span>zipmap<span class="token operator">-</span>entries <span class="token number">512</span>
<span class="token keyword">hash</span><span class="token operator">-</span>max<span class="token operator">-</span>zipmap<span class="token operator">-</span><span class="token keyword">value</span> <span class="token number">64</span>

<span class="token comment"># list数据类型多少节点以下会采用去指针的紧凑存储格式。</span>
<span class="token comment"># list数据类型节点值大小小于多少字节会采用紧凑存储格式。</span>
list<span class="token operator">-</span>max<span class="token operator">-</span>ziplist<span class="token operator">-</span>entries <span class="token number">512</span>
list<span class="token operator">-</span>max<span class="token operator">-</span>ziplist<span class="token operator">-</span><span class="token keyword">value</span> <span class="token number">64</span>

<span class="token comment"># set数据类型内部数据如果全部是数值型，且包含多少节点以下会采用紧凑格式存储。</span>
<span class="token keyword">set</span><span class="token operator">-</span>max<span class="token operator">-</span>intset<span class="token operator">-</span>entries <span class="token number">512</span>

<span class="token comment"># zsort数据类型多少节点以下会采用去指针的紧凑存储格式。</span>
<span class="token comment"># zsort数据类型节点值大小小于多少字节会采用紧凑存储格式。</span>
zset<span class="token operator">-</span>max<span class="token operator">-</span>ziplist<span class="token operator">-</span>entries <span class="token number">128</span>
zset<span class="token operator">-</span>max<span class="token operator">-</span>ziplist<span class="token operator">-</span><span class="token keyword">value</span> <span class="token number">64</span>

<span class="token comment"># Redis将在每100毫秒时使用1毫秒的CPU时间来对redis的hash表进行重新hash，可以降低内存的使用</span>
<span class="token comment">#</span>
<span class="token comment"># 当你的使用场景中，有非常严格的实时性需要，不能够接受Redis时不时的对请求有2毫秒的延迟的话，把这项配置为no。</span>
<span class="token comment">#</span>
<span class="token comment"># 如果没有这么严格的实时性要求，可以设置为yes，以便能够尽可能快的释放内存</span>
activerehashing yes

<span class="token comment">################################## INCLUDES ###################################</span>

<span class="token comment"># 指定包含其它的配置文件，可以在同一主机上多个Redis实例之间使用同一份配置文件，而同时各个实例又拥有自己的特定配置文件</span>

<span class="token comment"># include /path/to/local.conf</span>
<span class="token comment"># include /path/to/other.conf</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fc/ee/aUh0b7b8_o.png" alt="在这里插入图片描述"></p> 
<br> 
<table width="100%"><tbody><tr><td width="50%"> 
    <div align="center"> 
     <font color="#E73B3E"><em>💖The End💖点点关注，收藏不迷路💖<em></em></em></font> 
    </div> </td></tr></tbody></table>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6f13518b65adfd27fbd1e601b80dcbc6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何使用 CrewAI 构建协作型 AI Agents</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d574f7e5be841ca5e36f3e1fd79a6c37/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">前端Vue篇之vue如何监听对象或者数组某个属性的变化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>