<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>力扣SQL仅数据库(196~569) - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/bc1cdcc1ecb61ee38d71336a995887c3/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="力扣SQL仅数据库(196~569)">
  <meta property="og:description" content="196. 删除重复的电子邮箱 题目：编写解决方案 删除 所有重复的电子邮件，只保留一个具有最小 id 的唯一电子邮件。
（对于 SQL 用户，请注意你应该编写一个 DELETE 语句而不是 SELECT 语句。）
（对于 Pandas 用户，请注意你应该直接修改 Person 表。）
数据准备：
Create table If Not Exists Person (Id int, Email varchar(255)) Truncate table Person insert into Person (id, email) values (&#39;1&#39;, &#39;john@example.com&#39;) insert into Person (id, email) values (&#39;2&#39;, &#39;bob@example.com&#39;) insert into Person (id, email) values (&#39;3&#39;, &#39;john@example.com&#39;) 代码实现：
delete from Person where id not in ( select a.id from (select min(id) id from Person group by email)a); 197.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-31T20:15:52+08:00">
    <meta property="article:modified_time" content="2024-08-31T20:15:52+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">力扣SQL仅数据库(196~569)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>196. 删除重复的电子邮箱</h3> 
<p>题目：编写解决方案<strong> 删除</strong> 所有重复的电子邮件，只保留一个具有最小 <code>id</code> 的唯一电子邮件。</p> 
<p>（对于 SQL 用户，请注意你应该编写一个 <code>DELETE</code> 语句而不是 <code>SELECT</code> 语句。）</p> 
<p>（对于 Pandas 用户，请注意你应该直接修改 <code>Person</code> 表。）</p> 
<p>数据准备：</p> 
<pre><code class="language-sql">Create table If Not Exists Person (Id int, Email varchar(255))
Truncate table Person
insert into Person (id, email) values ('1', 'john@example.com')
insert into Person (id, email) values ('2', 'bob@example.com')
insert into Person (id, email) values ('3', 'john@example.com')</code></pre> 
<p>代码实现：</p> 
<pre><code class="language-sql">delete from Person where id not in (
    select a.id from (select min(id) id from Person group by email)a);</code></pre> 
<h3>197. 上升的温度</h3> 
<p>题目：编写解决方案，找出与之前（昨天的）日期相比温度更高的所有日期的 <code>id</code> 。</p> 
<p>数据准备：</p> 
<pre><code class="language-sql">Create table If Not Exists Weather (id int, recordDate date, temperature int)
Truncate table Weather
insert into Weather (id, recordDate, temperature) values ('1', '2015-01-01', '10')
insert into Weather (id, recordDate, temperature) values ('2', '2015-01-02', '25')
insert into Weather (id, recordDate, temperature) values ('3', '2015-01-03', '20')
insert into Weather (id, recordDate, temperature) values ('4', '2015-01-04', '30')</code></pre> 
<p>思路：</p> 
<table cellspacing="0"><tbody><tr><td style="vertical-align:middle;width:54pt;"></td><td style="vertical-align:middle;width:58pt;"></td><td style="vertical-align:middle;width:76.5pt;"></td><td style="background-color:#fff3ca;text-align:center;vertical-align:middle;width:83pt;"><span style="color:#000000;">weather1</span></td><td style="vertical-align:middle;width:163.5pt;"></td><td style="vertical-align:middle;width:284pt;"></td></tr><tr><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">date_add得出前一天的日期</span></td><td style="vertical-align:middle;"></td></tr><tr><td style="vertical-align:middle;"></td><td style="background-color:#fce4d3;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">id</span></td><td style="background-color:#fce4d3;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;"> recordDate</span></td><td style="background-color:#fce4d3;text-align:center;vertical-align:middle;"><span style="color:#000000;"> temperature</span></td><td style="background-color:#fce4d3;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">yesterday</span></td><td style="vertical-align:middle;"></td></tr><tr><td style="vertical-align:middle;"></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">1</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2015/1/1</span></td><td style="text-align:center;vertical-align:middle;"><span style="color:#000000;">10</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2014/12/31</span></td><td style="vertical-align:middle;"></td></tr><tr><td style="vertical-align:middle;"></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2015/1/2</span></td><td style="text-align:center;vertical-align:middle;"><span style="color:#000000;">25</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2015/1/1</span></td><td style="vertical-align:middle;"></td></tr><tr><td style="vertical-align:middle;"></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">3</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2015/1/3</span></td><td style="text-align:center;vertical-align:middle;"><span style="color:#000000;">20</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2015/1/2</span></td><td style="vertical-align:middle;"></td></tr><tr><td style="vertical-align:middle;"></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">4</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2015/1/4</span></td><td style="text-align:center;vertical-align:middle;"><span style="color:#000000;">30</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2015/1/3</span></td><td style="vertical-align:middle;"></td></tr><tr><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td></tr><tr><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td></tr><tr><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td colspan="3" style="background-color:#fff3ca;text-align:center;vertical-align:middle;"><span style="color:#000000;">weather1与weather表join连接</span></td><td style="vertical-align:middle;"></td></tr><tr><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td></tr><tr><td style="background-color:#fce4d3;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">id</span></td><td style="background-color:#fce4d3;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;"> recordDate</span></td><td style="background-color:#fce4d3;text-align:center;vertical-align:middle;"><span style="color:#000000;"> temperature</span></td><td style="background-color:#fce4d3;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">yesterday</span></td><td style="background-color:#fce4d3;text-align:center;vertical-align:middle;"><span style="color:#000000;">yesterday日期的temperature</span></td><td style="background-color:#fce4d3;vertical-align:middle;"><span style="color:#000000;">今日的temperature是否大于昨日的temoerature</span></td></tr><tr><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">1</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2015/1/1</span></td><td style="text-align:center;vertical-align:middle;"><span style="color:#000000;">10</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2014/12/31</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"></td></tr><tr><td style="background-color:#e3f2d9;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2015/1/2</span></td><td style="text-align:center;vertical-align:middle;"><span style="color:#000000;">25</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2015/1/1</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">10</span></td><td style="background-color:#e3f2d9;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">1</span></td></tr><tr><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">3</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2015/1/3</span></td><td style="text-align:center;vertical-align:middle;"><span style="color:#000000;">20</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2015/1/2</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">25</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">0</span></td></tr><tr><td style="background-color:#e3f2d9;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">4</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2015/1/4</span></td><td style="text-align:center;vertical-align:middle;"><span style="color:#000000;">30</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2015/1/3</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">20</span></td><td style="background-color:#e3f2d9;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">1</span></td></tr></tbody></table> 
<p>代码实现：</p> 
<pre><code class="language-sql">with t1 as (select id,temperature,recordDate,date_sub(recordDate,interval 1 day) yesterday from weather)
select t1.id from t1 join weather on Weather.recordDate=t1.yesterday 
where t1.temperature&gt;Weather.temperature;</code></pre> 
<h3>262. 行程和用户</h3> 
<p>题目：编写解决方案找出 <code>"2013-10-01"</code><strong> </strong>至 <code>"2013-10-03"</code><strong> </strong>期间非禁止用户（<strong>乘客和司机都必须未被禁止</strong>）的取消率。非禁止用户即 banned 为 No 的用户，禁止用户即 banned 为 Yes 的用户。其中取消率 <code>Cancellation Rate</code> 需要四舍五入保留 <strong>两位小数</strong> </p> 
<p><strong>取消率</strong> 的计算方式如下：(被司机或乘客取消的非禁止用户生成的订单数量) / (非禁止用户生成的订单总数)。</p> 
<p>数据准备：</p> 
<pre><code class="language-sql">Create table If Not Exists Trips (id int, client_id int, driver_id int, city_id int, status ENUM('completed', 'cancelled_by_driver', 'cancelled_by_client'), request_at varchar(50))
Create table If Not Exists Users (users_id int, banned varchar(50), role ENUM('client', 'driver', 'partner'))
Truncate table Trips
insert into Trips (id, client_id, driver_id, city_id, status, request_at) values ('1', '1', '10', '1', 'completed', '2013-10-01')
insert into Trips (id, client_id, driver_id, city_id, status, request_at) values ('2', '2', '11', '1', 'cancelled_by_driver', '2013-10-01')
insert into Trips (id, client_id, driver_id, city_id, status, request_at) values ('3', '3', '12', '6', 'completed', '2013-10-01')
insert into Trips (id, client_id, driver_id, city_id, status, request_at) values ('4', '4', '13', '6', 'cancelled_by_client', '2013-10-01')
insert into Trips (id, client_id, driver_id, city_id, status, request_at) values ('5', '1', '10', '1', 'completed', '2013-10-02')
insert into Trips (id, client_id, driver_id, city_id, status, request_at) values ('6', '2', '11', '6', 'completed', '2013-10-02')
insert into Trips (id, client_id, driver_id, city_id, status, request_at) values ('7', '3', '12', '6', 'completed', '2013-10-02')
insert into Trips (id, client_id, driver_id, city_id, status, request_at) values ('8', '2', '12', '12', 'completed', '2013-10-03')
insert into Trips (id, client_id, driver_id, city_id, status, request_at) values ('9', '3', '10', '12', 'completed', '2013-10-03')
insert into Trips (id, client_id, driver_id, city_id, status, request_at) values ('10', '4', '13', '12', 'cancelled_by_driver', '2013-10-03')
Truncate table Users
insert into Users (users_id, banned, role) values ('1', 'No', 'client')
insert into Users (users_id, banned, role) values ('2', 'Yes', 'client')
insert into Users (users_id, banned, role) values ('3', 'No', 'client')
insert into Users (users_id, banned, role) values ('4', 'No', 'client')
insert into Users (users_id, banned, role) values ('10', 'No', 'driver')
insert into Users (users_id, banned, role) values ('11', 'No', 'driver')
insert into Users (users_id, banned, role) values ('12', 'No', 'driver')
insert into Users (users_id, banned, role) values ('13', 'No', 'driver')</code></pre> 
<p>代码实现：</p> 
<pre><code class="language-sql">with t as (select * from Trips where 
    client_id in (select users_id from Users where banned='no')
    and driver_id in (select users_id from Users where banned='no'))
select request_at day,round(sum(if(status != 'completed',1,0))/count(id),2) 'Cancellation Rate' from t
where request_at between '2013-10-01' and '2013-10-03' group by request_at;</code></pre> 
<h3>511. 游戏玩法1</h3> 
<p>问题：查询每位玩家 <strong>第一次登录平台的日期</strong>。</p> 
<p>数据准备：</p> 
<pre><code class="language-sql">Create table If Not Exists Activity (player_id int, device_id int, event_date date, games_played int)
Truncate table Activity
insert into Activity (player_id, device_id, event_date, games_played) values ('1', '2', '2016-03-01', '5')
insert into Activity (player_id, device_id, event_date, games_played) values ('1', '2', '2016-05-02', '6')
insert into Activity (player_id, device_id, event_date, games_played) values ('2', '3', '2017-06-25', '1')
insert into Activity (player_id, device_id, event_date, games_played) values ('3', '1', '2016-03-02', '0')
insert into Activity (player_id, device_id, event_date, games_played) values ('3', '4', '2018-07-03', '5')</code></pre> 
<p>代码实现：</p> 
<pre><code class="language-sql">select player_id,min(event_date) from activity group by player_id;</code></pre> 
<h3>512. 游戏玩法2</h3> 
<p>问题·：请编写解决方案，描述每一个玩家首次登陆的设备名称</p> 
<p>数据准备：</p> 
<pre><code class="language-sql">Create table If Not Exists Activity (player_id int, device_id int, event_date date, games_played int)
Truncate table Activity;
insert into Activity (player_id, device_id, event_date, games_played) values ('1', '2', '2016-03-01', '5')
insert into Activity (player_id, device_id, event_date, games_played) values ('1', '2', '2016-05-02', '6')
insert into Activity (player_id, device_id, event_date, games_played) values ('2', '3', '2017-06-25', '1')
insert into Activity (player_id, device_id, event_date, games_played) values ('3', '1', '2016-03-02', '0')
insert into Activity (player_id, device_id, event_date, games_played) values ('3', '4', '2018-07-03', '5')</code></pre> 
<p>代码实现：</p> 
<pre><code class="language-sql">with t1 as (select player_id player_id1,min(event_date) event_date1 from activity group by player_id)
select player_id,device_id from activity join t1 on Activity.player_id=t1.player_id1
where event_date=t1.event_date1;</code></pre> 
<h3>513. 游戏玩法3</h3> 
<p>问题：编写一个解决方案，同时报告每组玩家和日期，以及玩家到 目前为止 玩了多少游戏。 也就是说，玩家在该日期之前所玩的游戏总数。详细情况请查看示例。</p> 
<p>数据准备：</p> 
<pre><code class="language-sql">Create table If Not Exists Activity (player_id int, device_id int, event_date date, games_played int)
Truncate table Activity
insert into Activity (player_id, device_id, event_date, games_played) values ('1', '2', '2016-03-01', '5')
insert into Activity (player_id, device_id, event_date, games_played) values ('1', '2', '2016-03-02', '6')
insert into Activity (player_id, device_id, event_date, games_played) values ('2', '3', '2017-06-25', '1')
insert into Activity (player_id, device_id, event_date, games_played) values ('3', '1', '2016-03-02', '0')
insert into Activity (player_id, device_id, event_date, games_played) values ('3', '4', '2018-07-03', '5');</code></pre> 
<p>代码实现：</p> 
<pre><code class="language-sql">select player_id,
sum(games_played)over(partition by player_id order by event_date rows between unbounded preceding and current row) con
from activity;</code></pre> 
<h3>514. 游戏玩法4</h3> 
<p>问题：报告在首次登录的第二天再次登录的玩家的 比率，四舍五入到小数点后两位。换句话说，你需要计算从首次登录日期开始至少连续两天登录的玩家的数量，然后除以玩家总数。</p> 
<p>数据准备：</p> 
<pre><code class="language-sql">Create table If Not Exists Activity (player_id int, device_id int, event_date date, games_played int)
Truncate table Activity
insert into Activity (player_id, device_id, event_date, games_played) values ('1', '2', '2016-03-01', '5')
insert into Activity (player_id, device_id, event_date, games_played) values ('1', '2', '2016-03-02', '6')
insert into Activity (player_id, device_id, event_date, games_played) values ('2', '3', '2017-06-25', '1')
insert into Activity (player_id, device_id, event_date, games_played) values ('3', '1', '2016-03-02', '0')
insert into Activity (player_id, device_id, event_date, games_played) values ('3', '4', '2018-07-03', '5');</code></pre> 
<p>思路：</p> 
<table cellspacing="0"><tbody><tr><td style="vertical-align:middle;width:63pt;"></td><td style="vertical-align:middle;width:70pt;"></td><td style="vertical-align:middle;width:76.5pt;"></td><td style="vertical-align:middle;width:90pt;"></td><td style="vertical-align:middle;width:63pt;"></td><td colspan="4" style="text-align:center;vertical-align:middle;width:299.5pt;"><span style="color:#000000;">筛选出各玩家第一次登录的记录</span></td><td style="vertical-align:middle;width:63pt;"></td></tr><tr><td style="background-color:#e3f2d9;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">player_id</span></td><td style="background-color:#e3f2d9;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;"> device_id</span></td><td style="background-color:#e3f2d9;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;"> event_date</span></td><td style="background-color:#e3f2d9;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;"> games_played</span></td><td style="vertical-align:middle;"></td><td style="background-color:#fce4d3;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">player_id</span></td><td style="background-color:#fce4d3;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;"> device_id</span></td><td style="background-color:#fce4d3;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;"> event_date</span></td><td style="background-color:#fce4d3;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;"> games_played</span></td><td style="background-color:#fce4d3;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">第二天</span></td></tr><tr><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">1</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2016/3/1</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">5</span></td><td style="vertical-align:middle;"></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">1</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2016/3/1</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">5</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2016/3/2</span></td></tr><tr><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">1</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2016/3/2</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">6</span></td><td style="vertical-align:middle;"></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">3</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2017/6/25</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">1</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2017/6/26</span></td></tr><tr><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">3</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2017/6/25</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">1</span></td><td style="vertical-align:middle;"></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">3</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">1</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2016/3/2</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">0</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2016/3/3</span></td></tr><tr><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">3</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">1</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2016/3/2</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">0</span></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td></tr><tr><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">3</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">4</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2018/7/3</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">5</span></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td></tr><tr><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td><td style="vertical-align:middle;"></td></tr><tr><td colspan="9" style="text-align:center;vertical-align:middle;"><span style="color:#000000;">两张表内连接，player_id相等且第一次登录的第二天的时间等于原表中该用户的登录时间</span></td><td style="vertical-align:middle;"></td></tr><tr><td style="background-color:#fce4d3;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">player_id</span></td><td style="background-color:#fce4d3;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;"> device_id</span></td><td style="background-color:#fce4d3;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;"> event_date</span></td><td style="background-color:#fce4d3;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;"> games_played</span></td><td style="background-color:#fce4d3;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">第二天</span></td><td style="background-color:#e3f2d9;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">player_id</span></td><td style="background-color:#e3f2d9;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;"> device_id</span></td><td style="background-color:#e3f2d9;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;"> event_date</span></td><td style="background-color:#e3f2d9;border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;"> games_played</span></td><td style="vertical-align:middle;"></td></tr><tr><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">1</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2016/3/1</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">5</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2016/3/2</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">1</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">2016/3/2</span></td><td style="border-color:#000000;text-align:center;vertical-align:middle;"><span style="color:#000000;">6</span></td><td style="vertical-align:middle;"></td></tr></tbody></table> 
<p>代码实现：</p> 
<p>t1 筛选出每个玩家第一次登陆的记录</p> 
<p>t2 在该记录的后面添加一列第二天列</p> 
<p>t3 将表连接，筛选出玩家有第二天登录的记录</p> 
<p>最后求出比值</p> 
<pre><code class="language-sql">with t1 as (select player_id player_id1,min(event_date) event_date1 from activity group by player_id)
,t2 as (select *,date_add(event_date1,interval 1 day) date from t1)
,t3 as (select  player_id1 from t2 join activity
    on t2.player_id1=Activity.player_id and t2.date=Activity.event_date)
select round((select count(distinct player_id1) from t3)/(select count(distinct player_id) from activity),2) as fraction
;</code></pre> 
<h3>569. 员工薪水中位数</h3> 
<p>问题：编写解决方案，找出每个公司的工资中位数。</p> 
<p>数据准备：</p> 
<pre><code class="language-sql">Create table If Not Exists Employee (id int, company varchar(255), salary int)
Truncate table Employee
insert into Employee (id, company, salary) values ('1', 'A', '2341')
insert into Employee (id, company, salary) values ('2', 'A', '341')
insert into Employee (id, company, salary) values ('3', 'A', '15')
insert into Employee (id, company, salary) values ('4', 'A', '15314')
insert into Employee (id, company, salary) values ('5', 'A', '451')
insert into Employee (id, company, salary) values ('6', 'A', '513')
insert into Employee (id, company, salary) values ('7', 'B', '15')
insert into Employee (id, company, salary) values ('8', 'B', '13')
insert into Employee (id, company, salary) values ('9', 'B', '1154')
insert into Employee (id, company, salary) values ('10', 'B', '1345')
insert into Employee (id, company, salary) values ('11', 'B', '1221')
insert into Employee (id, company, salary) values ('12', 'B', '234')
insert into Employee (id, company, salary) values ('13', 'C', '2345')
insert into Employee (id, company, salary) values ('14', 'C', '2645')
insert into Employee (id, company, salary) values ('15', 'C', '2645')
insert into Employee (id, company, salary) values ('16', 'C', '2652')
insert into Employee (id, company, salary) values ('17', 'C', '65');</code></pre> 
<p>代码实现：</p> 
<p>t1 对所有员工的工资进行连续不并列排序</p> 
<p>t2 找出有偶数个员工的公司的员工工资</p> 
<p>t3 找出有奇数个员工的公司的员工工资</p> 
<p>联合t2和t3</p> 
<pre><code class="language-sql">with t1 as (select *,row_number() over (partition by company order by salary)ran from employee)
,t2 as (select company,round(max(ran)/2,0)rou1,round(max(ran)/2+1,0)rou2 from t1 group by company having max(ran)%2=0)
,t3 as (select company,round(max(ran)/2+0.5,0) rou from t1 group by company having max(ran)%2=1)
select t1.id,t1.company,t1.salary from t1 join t2 on t1.company=t2.company where ran in (rou1,rou2)
union all
select t1.id,t1.company,t1.salary from t1 join t3 on t1.company=t3.company where ran = rou;</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a8f823b8febb3e803495241404219bea/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于FPGA的lz4解压缩仿真调试</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/53adfb1d0df00f12e2f0f2c153d6cf4e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">反向迭代器：reverse_iterator的实现</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>