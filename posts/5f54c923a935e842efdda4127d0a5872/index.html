<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>51单片机嵌入式开发：21、STC89C52R控制抢答器&#43;数码管&#43;后台显示&#43;LCD1602x显示 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/5f54c923a935e842efdda4127d0a5872/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="51单片机嵌入式开发：21、STC89C52R控制抢答器&#43;数码管&#43;后台显示&#43;LCD1602x显示">
  <meta property="og:description" content="配套程序
STC89C52R控制抢答器&#43;数码管&#43;后台显示&#43;LCD1602x显示 STC89C52R控制抢答器&#43;数码管&#43;后台显示&#43;LCD1602x显示1 概述1.1 项目概述1.2 项目组成部分1.3 功能描述 2 开发环境2.1 支持设备2.2 硬件电路 3 软件代码工程4 演示Proteus仿真5 总结 配套程序
STC89C52R控制抢答器&#43;数码管&#43;后台显示&#43;LCD1602x显示 1 概述 1.1 项目概述 该项目旨在利用STC89C52R单片机构建一个多功能抢答器显示系统，涵盖LCD1602x显示屏、数码管和后台数码显示器。通过串口通信，单片机能够与后台数码显示器进行数据交换和控制，实现更加灵活和多样化的显示功能。
1.2 项目组成部分 （1）STC89C52R单片机：
（2）LCD1602显示：
（3）数码管：
（4）后台数码显示器（通过串口通信）：
（5）按键：
（6）Proteus：
1.3 功能描述 （1）LCD1602:
LCD1602显示屏用于展示文字信息，能够显示实时数据如日期、时间、温度等。
（2）数码管:
数码管用于呈现数字信息，例如计数器数值、计时器时间等。
后台数码显示器（通过串口通信）:
借助串口通信，单片机与后台数码显示器相连，实现双向数据传输和控制，扩展显示功能。
（3）按键:
通过4个按键实现抢答器按钮功能。
（4）Proteus:
使用实物演示和Proteus仿真方式展示系统功能。
2 开发环境 2.1 支持设备 我们采用华晴51开发板、Keil开发工具和PROTEUS仿真软件。结合这三者，开发人员得以进行完整的嵌入式系统开发流程。他们可以利用Keil开发工具编写、编译和调试8051单片机程序，接着通过PROTEUS仿真软件验证程序正确性和系统功能。一旦验证通过，程序可下载至华晴51开发板进行实际硬件调试和测试，完成嵌入式系统的开发。这些工具的综合运用使得开发人员能够全面开发和验证嵌入式系统，提升开发效率、降低成本，并确保系统的稳定性和可靠性。
（1）华晴51开发板：
华晴51开发板是一款基于8051系列单片机的专用开发板，主要用于嵌入式系统的学习、开发和测试。该开发板拥有多样的外设接口，包括LED、按键、数码管、LCD显示屏、通信接口等，使用户能够轻松进行各种实验和项目开发。此外，华晴51开发板支持多种编程方式，如汇编语言、C语言等，适用于各类用户，无论是初学者还是专业开发人员。
（2）Keil开发工具：
Keil开发工具是一套专业的嵌入式系统开发工具，主要针对ARM和8051等处理器的嵌入式软件开发。其中，Keil C51是专为8051系列单片机设计的C语言集成开发环境，提供编译、调试、仿真等功能，使开发人员能够高效进行嵌入式软件开发。该工具配备了强大的调试功能，可帮助开发人员快速定位和解决程序中的问题，提升开发效率。
（3）PROTEUS仿真软件：
PROTEUS是一款被广泛应用于电子电路设计和仿真的软件。在嵌入式系统开发领域，PROTEUS通常用于对电路设计和单片机程序进行仿真，以验证系统功能、调试程序并检测潜在问题。该软件提供了丰富的元件库和仿真功能，使用户能够轻松搭建电路原理图、加载单片机程序，并进行实时仿真。
2.2 硬件电路 （1）STC89C52R单片机：
晶振使用11.0592Mhz
（2）LCD1602码表：
（3）数码管：
（4）后台数码显示器（通过串口通信）：
（5）按键：
按键使用独立按键形式，P34 P35 P36 P37引脚
（6）实物与Proteus：
3 软件代码工程 //main.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-29T11:52:03+08:00">
    <meta property="article:modified_time" content="2024-07-29T11:52:03+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">51单片机嵌入式开发：21、STC89C52R控制抢答器&#43;数码管&#43;后台显示&#43;LCD1602x显示</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><a href="https://download.csdn.net/download/sinat_30943509/89594469"><code>配套程序</code></a></p> 
<p></p> 
<div class="toc"> 
 <h4>STC89C52R控制抢答器+数码管+后台显示+LCD1602x显示</h4> 
 <ul><li><a href="#STC89C52RLCD1602x_17" rel="nofollow">STC89C52R控制抢答器+数码管+后台显示+LCD1602x显示</a></li><li><a href="#1%09_21" rel="nofollow">1 概述</a></li><li><ul><li><a href="#11%09_22" rel="nofollow">1.1 项目概述</a></li><li><a href="#12%09_24" rel="nofollow">1.2 项目组成部分</a></li><li><a href="#13%09_35" rel="nofollow">1.3 功能描述</a></li></ul> 
  </li><li><a href="#2%09_46" rel="nofollow">2 开发环境</a></li><li><ul><li><a href="#21%09_47" rel="nofollow">2.1 支持设备</a></li><li><a href="#22%09_57" rel="nofollow">2.2 硬件电路</a></li></ul> 
  </li><li><a href="#3%09_96" rel="nofollow">3 软件代码工程</a></li><li><a href="#4%09Proteus_667" rel="nofollow">4 演示Proteus仿真</a></li><li><a href="#5%09_672" rel="nofollow">5 总结</a></li></ul> 
</div> 
<p></p> 
<p><a href="https://download.csdn.net/download/sinat_30943509/89594469"><code>配套程序</code></a></p> 
<hr> 
<p><img src="https://images2.imgbox.com/26/1a/T3Mfmr1l_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="STC89C52RLCD1602x_17"></a>STC89C52R控制抢答器+数码管+后台显示+LCD1602x显示</h2> 
<h2><a id="1%09_21"></a>1 概述</h2> 
<h3><a id="11%09_22"></a>1.1 项目概述</h3> 
<p>该项目旨在利用STC89C52R单片机构建一个多功能抢答器显示系统，涵盖LCD1602x显示屏、数码管和后台数码显示器。通过串口通信，单片机能够与后台数码显示器进行数据交换和控制，实现更加灵活和多样化的显示功能。</p> 
<h3><a id="12%09_24"></a>1.2 项目组成部分</h3> 
<p>（1）STC89C52R单片机：<br> （2）LCD1602显示：<br> （3）数码管：<br> （4）后台数码显示器（通过串口通信）：<br> （5）按键：<br> （6）Proteus：</p> 
<p><img src="https://images2.imgbox.com/ca/fe/2zuH3O6h_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="13%09_35"></a>1.3 功能描述</h3> 
<p>（1）LCD1602:<br> LCD1602显示屏用于展示文字信息，能够显示实时数据如日期、时间、温度等。<br> （2）数码管:<br> 数码管用于呈现数字信息，例如计数器数值、计时器时间等。<br> 后台数码显示器（通过串口通信）:<br> 借助串口通信，单片机与后台数码显示器相连，实现双向数据传输和控制，扩展显示功能。<br> （3）按键:<br> 通过4个按键实现抢答器按钮功能。<br> （4）Proteus:<br> 使用实物演示和Proteus仿真方式展示系统功能。</p> 
<h2><a id="2%09_46"></a>2 开发环境</h2> 
<h3><a id="21%09_47"></a>2.1 支持设备</h3> 
<p>我们采用华晴51开发板、Keil开发工具和PROTEUS仿真软件。结合这三者，开发人员得以进行完整的嵌入式系统开发流程。他们可以利用Keil开发工具编写、编译和调试8051单片机程序，接着通过PROTEUS仿真软件验证程序正确性和系统功能。一旦验证通过，程序可下载至华晴51开发板进行实际硬件调试和测试，完成嵌入式系统的开发。这些工具的综合运用使得开发人员能够全面开发和验证嵌入式系统，提升开发效率、降低成本，并确保系统的稳定性和可靠性。<br> （1）华晴51开发板：<br> 华晴51开发板是一款基于8051系列单片机的专用开发板，主要用于嵌入式系统的学习、开发和测试。该开发板拥有多样的外设接口，包括LED、按键、数码管、LCD显示屏、通信接口等，使用户能够轻松进行各种实验和项目开发。此外，华晴51开发板支持多种编程方式，如汇编语言、C语言等，适用于各类用户，无论是初学者还是专业开发人员。<br> （2）Keil开发工具：<br> Keil开发工具是一套专业的嵌入式系统开发工具，主要针对ARM和8051等处理器的嵌入式软件开发。其中，Keil C51是专为8051系列单片机设计的C语言集成开发环境，提供编译、调试、仿真等功能，使开发人员能够高效进行嵌入式软件开发。该工具配备了强大的调试功能，可帮助开发人员快速定位和解决程序中的问题，提升开发效率。<br> （3）PROTEUS仿真软件：<br> PROTEUS是一款被广泛应用于电子电路设计和仿真的软件。在嵌入式系统开发领域，PROTEUS通常用于对电路设计和单片机程序进行仿真，以验证系统功能、调试程序并检测潜在问题。该软件提供了丰富的元件库和仿真功能，使用户能够轻松搭建电路原理图、加载单片机程序，并进行实时仿真。</p> 
<h3><a id="22%09_57"></a>2.2 硬件电路</h3> 
<p>（1）STC89C52R单片机：</p> 
<p><img src="https://images2.imgbox.com/49/e1/DC7yINsD_o.png" alt="在这里插入图片描述"></p> 
<p>晶振使用11.0592Mhz</p> 
<p><img src="https://images2.imgbox.com/d7/f8/YgPhE0wc_o.png" alt="在这里插入图片描述"></p> 
<p>（2）LCD1602码表：</p> 
<p><img src="https://images2.imgbox.com/57/0a/LnBzjfZq_o.png" alt="在这里插入图片描述"></p> 
<p>（3）数码管：</p> 
<p><img src="https://images2.imgbox.com/c3/f8/B52Kb9km_o.png" alt="在这里插入图片描述"></p> 
<p>（4）后台数码显示器（通过串口通信）：</p> 
<p><img src="https://images2.imgbox.com/7b/d7/ImLuHTfV_o.png" alt="在这里插入图片描述"></p> 
<p>（5）按键：<br> 按键使用独立按键形式，P34 P35 P36 P37引脚</p> 
<p><img src="https://images2.imgbox.com/67/f3/8UTzpGzd_o.png" alt="在这里插入图片描述"></p> 
<p>（6）实物与Proteus：</p> 
<p><img src="https://images2.imgbox.com/dd/9a/EGxbkCfi_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/6a/52/niq5h3eN_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3%09_96"></a>3 软件代码工程</h2> 
<p>//main.c文件</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"includes.h"</span></span>



<span class="token comment">/******************************************************************/</span>
<span class="token comment">/*                    微秒延时函数  //10us                         */</span>
<span class="token comment">/******************************************************************/</span>
<span class="token keyword">void</span> <span class="token function">delay_us</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> us<span class="token punctuation">)</span><span class="token comment">//delay us</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>us<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/******************************************************************/</span>
<span class="token comment">/*                    微秒延时函数                                */</span>
<span class="token comment">/******************************************************************/</span>
<span class="token keyword">void</span> <span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Ms<span class="token punctuation">)</span><span class="token comment">//delay us</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>Ms<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">delay_us</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>





<span class="token comment">/*------------------------------------------------
                    主函数
------------------------------------------------*/</span>


<span class="token keyword">unsigned</span> <span class="token keyword">char</span> pro_key_data <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">char</span> Test2<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"                "</span><span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> databuf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">//串口外设初始化</span>
	<span class="token function">sys_uart_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//LCD1602显示屏初始化</span>
	<span class="token function">LCD_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
	<span class="token function">sprintf</span><span class="token punctuation">(</span>Test2<span class="token punctuation">,</span><span class="token string">"Nunber:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">LCD_write_strl</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>Test2<span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	P1 <span class="token operator">=</span> <span class="token number">0xFF</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
		<span class="token comment">//获取按键值</span>
		pro_key_data <span class="token operator">=</span> <span class="token function">sys_key_single</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		
		
		<span class="token keyword">if</span><span class="token punctuation">(</span>pro_key_data<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//指示灯显示</span>
			P1 <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>pro_key_data<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			<span class="token comment">//数码管显示</span>
			<span class="token function">sys_keynum_ledon</span><span class="token punctuation">(</span>pro_key_data<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			
			<span class="token comment">//LCD1602显示</span>
			<span class="token function">LCD_write_com</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token operator">+</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">lcd_number</span><span class="token punctuation">(</span>pro_key_data<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>//includes.h文件</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__INCLUDES_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__INCLUDES_H__</span></span>

<span class="token comment">//#include&lt;reg52.h&gt; </span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;intrins.h&gt;</span> <span class="token comment">//汇编指令_nop_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span> 	<span class="token comment">//标准输入输出</span></span>

<span class="token comment">//_nop_(); 产生一条NOP指令</span>
<span class="token comment">//作用：对于延时很短的，要求在us级的，采用“_nop_”函数，这个函数相当汇编NOP指令，延时几微秒。</span>
<span class="token comment">//NOP指令为单周期指令，可由晶振频率算出延时时间。</span>

<span class="token comment">//8051 为每个机器周期 12 时钟</span>
<span class="token comment">//对于12M晶振，延时1uS。</span>
<span class="token comment">//11.0592M晶振，延时1.0851uS。</span>

<span class="token comment">//对于延时比较长的，要求在大于10us，采用C51中的循环语句来实现。</span>


<span class="token comment">//包含头文件，一般情况不需要改动，头文件包含特殊功能寄存器的定义</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"STC89C5xRC_RDP.h"</span></span>

<span class="token comment">//应用层头文件</span>
<span class="token comment">//#include "c51_gpio.h"</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"c51_ledtube.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"c51_key.h"</span></span>
<span class="token comment">//#include "c51_timer.h"</span>
<span class="token comment">//#include "c51_exit.h"</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"c51_lcd1602.h"</span></span>
<span class="token comment">//#include "c51_iic.h"</span>
<span class="token comment">//#include "c51_tx1838.h"</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"c51_uart.h"</span></span>
<span class="token comment">//#include "c51_28byj48.h"</span>
<span class="token comment">//#include "c51_ds1302.h"</span>

<span class="token keyword">extern</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> pro_key_data<span class="token punctuation">;</span>



<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">delay_us</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> us<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//delay us;</span>
<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Ms<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//delay Ms;</span>




<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> 
<p>//c51_ledtube.c文件</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"includes.h"</span></span>

<span class="token comment"> 显示段码值01234567,可对应原理图查看显示不同图形对应的引脚高点电平配置状态</span>
<span class="token comment">//unsigned char const EL[]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f,0x77,0x7c,0x39,0x5e,0x79,0x71};//0-F</span>

code <span class="token keyword">unsigned</span> <span class="token keyword">char</span> ledmap<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0x3f</span><span class="token punctuation">,</span><span class="token number">0x06</span><span class="token punctuation">,</span><span class="token number">0x5b</span><span class="token punctuation">,</span><span class="token number">0x4f</span><span class="token punctuation">,</span><span class="token number">0x66</span><span class="token punctuation">,</span><span class="token number">0x6d</span><span class="token punctuation">,</span><span class="token number">0x7d</span><span class="token punctuation">,</span><span class="token number">0x07</span><span class="token punctuation">,</span><span class="token number">0x7f</span><span class="token punctuation">,</span><span class="token number">0x6f</span><span class="token punctuation">,</span><span class="token number">0x77</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">///********************************************************</span>
<span class="token comment">//函数名称：sys_ledtube_on1</span>
<span class="token comment">//函数功能：点亮一个数码管全为亮起来</span>
<span class="token comment">//入口参数：</span>
<span class="token comment">//出口参数：</span>
<span class="token comment">//修    改：</span>
<span class="token comment">//内    容：</span>
<span class="token comment">//********************************************************/</span>
<span class="token comment">//void sys_ledtube_on1(void)</span>
<span class="token comment">//{<!-- --></span>
<span class="token comment">//	//根据原理图，将P0口全部输出高电平，P2选择0号数码管</span>
<span class="token comment">//	P0=0xFF;//取显示数据，段码</span>
<span class="token comment">//	P2=0;  	//取位码</span>
<span class="token comment">//}</span>

<span class="token comment">///********************************************************</span>
<span class="token comment">//函数名称：sys_ledtube_on2</span>
<span class="token comment">//函数功能：显示一组数据</span>
<span class="token comment">//入口参数：</span>
<span class="token comment">//出口参数：</span>
<span class="token comment">//修    改：</span>
<span class="token comment">//内    容：</span>
<span class="token comment">//********************************************************/</span>
<span class="token comment">//static unsigned char ledtube_cnt = 0;</span>

<span class="token comment">//void sys_ledtube_on2(void)</span>
<span class="token comment">//{<!-- --></span>
<span class="token comment">//	ledtube_cnt++;</span>
<span class="token comment">//	if(ledtube_cnt&gt;7)</span>
<span class="token comment">//	{<!-- --></span>
<span class="token comment">//		ledtube_cnt = 0;</span>
<span class="token comment">//	}</span>
<span class="token comment">//	P0 = 0x00;				//防止切换数码管瞬间有虚影出现</span>
<span class="token comment">//	P2 = 0x00;</span>
<span class="token comment">//	P0 = ledmap[ledtube_cnt];	//取显示数据，段码</span>
<span class="token comment">//	P2 = ledtube_cnt;  		//取位码</span>
<span class="token comment">//	</span>
<span class="token comment">//	//根据人眼适应虚影缓冲时间为50ms左右</span>
<span class="token comment">//	//我们调整delay在500以下可以看到明显的看起来是一串数据一起显示</span>
<span class="token comment">//	delay(100); 			</span>
<span class="token comment">//}</span>


<span class="token comment">///********************************************************</span>
<span class="token comment">//函数名称：sys_keynum_ledon</span>
<span class="token comment">//函数功能：显示按键数值</span>
<span class="token comment">//入口参数：按键数值</span>
<span class="token comment">//出口参数：</span>
<span class="token comment">//修    改：</span>
<span class="token comment">//内    容：</span>
<span class="token comment">//********************************************************/</span>
<span class="token keyword">void</span> <span class="token function">sys_keynum_ledon</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> num<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> pn<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//根据原理图，将P0口全部输出高电平，P2选择0号数码管</span>
	P0 <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>		<span class="token comment">//防止切换数码管瞬间有虚影出现</span>
	P2 <span class="token operator">=</span> pn<span class="token punctuation">;</span>  		<span class="token comment">//取位码</span>
	P0 <span class="token operator">=</span> ledmap<span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">//取显示数据，段码</span>
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	
	P2 <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>  		<span class="token comment">//取位码</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>//c51_ledtube.h文件</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__C51_LEDTUBE_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__C51_LEDTUBE_H__</span></span>


<span class="token comment">//extern unsigned char const EL[];</span>

<span class="token comment">//extern void sys_ledtube_on1(void);</span>
<span class="token comment">//extern void sys_ledtube_on2(void);</span>

<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">sys_keynum_ledon</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> num<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> pn<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> 
<p>//c51_uart.c文件</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"includes.h"</span></span>



<span class="token comment">/*-----------------------------------------------
  名称：串口通信
  内容：连接好串口或者usb转串口至电脑，下载该程序，打开电源
        打开串口调试程序，将波特率设置为9600，无奇偶校验
        晶振11.0592MHz，发送和接收使用的格式相同，如都使用
        字符型格式，在发送框输入 hello，I Love MCU ，在接
        收框中同样可以看到相同字符，说明设置和通信正确
------------------------------------------------*/</span>
                    


<span class="token comment">/******************************************************************/</span>
<span class="token keyword">void</span> <span class="token function">sys_uart_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>


	SCON  <span class="token operator">=</span> <span class="token number">0x50</span><span class="token punctuation">;</span>		        <span class="token comment">/* SCON: 模式 1, 8-bit UART, 使能接收         */</span>
	TMOD <span class="token operator">|=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>               <span class="token comment">/* TMOD: timer 1, mode 2, 8-bit reload        */</span>
	TH1   <span class="token operator">=</span> <span class="token number">0xFD</span><span class="token punctuation">;</span>               <span class="token comment">/* TH1:  reload value for 9600 baud @ 11.0592MHz   */</span>
	TR1   <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                  <span class="token comment">/* TR1:  timer 1 run                          */</span>
	EA    <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                  <span class="token comment">/*打开总中断*/</span>
	<span class="token comment">//ES    = 1;                  /*打开串口中断*///当使用串口协议通讯时可以使用此型号中断</span>

<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token function">Uart_SendChar</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span>  dat<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    SBUF <span class="token operator">=</span> dat<span class="token punctuation">;</span> 
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>TI<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
 
<span class="token keyword">char</span> <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span><span class="token comment">//重定向</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">Uart_SendChar</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> c<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment">/******************************************************************/</span>
<span class="token comment">/*                  串口中断程序                                  */</span>
<span class="token comment">/******************************************************************/</span>


<span class="token keyword">static</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> uart_temp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>          <span class="token comment">//定义临时变量 </span>
<span class="token keyword">static</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> uart_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>          <span class="token comment">//定义临时变量 </span>


<span class="token keyword">void</span> <span class="token function">UART_isr</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> interrupt <span class="token number">4</span> <span class="token comment">//串行中断服务程序</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>RI<span class="token punctuation">)</span>                        <span class="token comment">//判断是接收中断产生</span>
	<span class="token punctuation">{<!-- --></span>
		RI<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>                      <span class="token comment">//标志位清零</span>
		uart_temp<span class="token operator">=</span>SBUF<span class="token punctuation">;</span>                 <span class="token comment">//读入缓冲区的值</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>uart_cnt<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0x02</span> <span class="token operator">==</span> uart_temp<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				uart_cnt <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				uart_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>uart_cnt<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0x05</span> <span class="token operator">==</span> uart_temp<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				uart_cnt <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				uart_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>uart_cnt<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			uart_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token comment">//P1=uart_temp;                   //把值输出到P1口，用于观察</span>
			SBUF<span class="token operator">=</span>uart_temp<span class="token punctuation">;</span>                 <span class="token comment">//把接收到的值再发回电脑端</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			uart_cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>TI<span class="token punctuation">)</span>                        <span class="token comment">//如果是发送标志位，清零</span>
	<span class="token punctuation">{<!-- --></span>
		TI<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span> 
</code></pre> 
<p>//c51_uart.h文件</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__C51_UART_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__C51_UART_H__</span></span>


<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">Uart_SendChar</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span>  dat<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">char</span> <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token keyword">char</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//重定向</span>

<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">sys_uart_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">UART_isr</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> 
<p>//c51_lcd1602.c文件</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"includes.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>

<span class="token comment">/******************************************************************/</span>
<span class="token comment">/*                   写入命令函数                                 */</span>
<span class="token comment">/******************************************************************/</span>
<span class="token keyword">void</span> <span class="token function">LCD_write_com</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> com<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>  
	RS_CLR<span class="token punctuation">;</span> 
	RW_CLR<span class="token punctuation">;</span> 
	EN_SET<span class="token punctuation">;</span> 
	P0 <span class="token operator">=</span> com<span class="token punctuation">;</span> 
	<span class="token function">delay_us</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
	EN_CLR<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/******************************************************************/</span>
<span class="token comment">/*                   写入数据函数                                 */</span>
<span class="token comment">/******************************************************************/</span>
<span class="token keyword">void</span> <span class="token function">LCD_write_Data</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Data<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
	RS_SET<span class="token punctuation">;</span> 
	RW_CLR<span class="token punctuation">;</span> 
	EN_SET<span class="token punctuation">;</span> 
	P0 <span class="token operator">=</span> Data<span class="token punctuation">;</span> 
	<span class="token function">delay_us</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
	EN_CLR<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/****************************************
函数功能：LCD显示数字0-9
*****************************************/</span>
<span class="token keyword">void</span> <span class="token function">lcd_number</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> number<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> num<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0x30</span><span class="token punctuation">,</span><span class="token number">0x31</span><span class="token punctuation">,</span><span class="token number">0x32</span><span class="token punctuation">,</span><span class="token number">0x33</span><span class="token punctuation">,</span><span class="token number">0x34</span><span class="token punctuation">,</span><span class="token number">0x35</span><span class="token punctuation">,</span><span class="token number">0x36</span><span class="token punctuation">,</span><span class="token number">0x37</span><span class="token punctuation">,</span><span class="token number">0x38</span><span class="token punctuation">,</span><span class="token number">0x39</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">switch</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span><span class="token function">LCD_write_Data</span><span class="token punctuation">(</span>num<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span><span class="token function">LCD_write_Data</span><span class="token punctuation">(</span>num<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span><span class="token function">LCD_write_Data</span><span class="token punctuation">(</span>num<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span><span class="token function">LCD_write_Data</span><span class="token punctuation">(</span>num<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span><span class="token function">LCD_write_Data</span><span class="token punctuation">(</span>num<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span><span class="token function">LCD_write_Data</span><span class="token punctuation">(</span>num<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span><span class="token function">LCD_write_Data</span><span class="token punctuation">(</span>num<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span><span class="token function">LCD_write_Data</span><span class="token punctuation">(</span>num<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span><span class="token function">LCD_write_Data</span><span class="token punctuation">(</span>num<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">9</span><span class="token operator">:</span><span class="token function">LCD_write_Data</span><span class="token punctuation">(</span>num<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/******************************************************************/</span>
<span class="token comment">/*                   初始化函数                                   */</span>
<span class="token comment">/******************************************************************/</span>
<span class="token keyword">void</span> <span class="token function">LCD_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
	<span class="token function">LCD_write_com</span><span class="token punctuation">(</span><span class="token number">0x38</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*显示模式设置*/</span> 
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token function">LCD_write_com</span><span class="token punctuation">(</span><span class="token number">0x38</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token function">LCD_write_com</span><span class="token punctuation">(</span><span class="token number">0x38</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token function">LCD_write_com</span><span class="token punctuation">(</span><span class="token number">0x38</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
	<span class="token function">LCD_write_com</span><span class="token punctuation">(</span><span class="token number">0x08</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*显示关闭*/</span> 
	<span class="token function">LCD_write_com</span><span class="token punctuation">(</span><span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*显示清屏*/</span> 
	<span class="token function">LCD_write_com</span><span class="token punctuation">(</span><span class="token number">0x06</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*显示光标移动设置*/</span> 
	<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token function">LCD_write_com</span><span class="token punctuation">(</span><span class="token number">0x0C</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/*显示开及光标设置*/</span>
<span class="token punctuation">}</span>


 
<span class="token comment">/******************************************************************/</span>
<span class="token comment">/*                   写入字符串函数                                */</span>
<span class="token comment">/*      X:第几列 Y：第几行  *s字符串为空时跳出                      */</span>
<span class="token comment">/******************************************************************/</span>
<span class="token keyword">void</span> <span class="token function">LCD_write_strl</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> x<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> y<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">,</span><span class="token keyword">unsigned</span> length<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>     
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">//LCD_write_com(0x01);    /*显示清屏*/ </span>
	
	<span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{<!-- --></span>     
		<span class="token function">LCD_write_com</span><span class="token punctuation">(</span><span class="token number">0x80</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>     
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> 
	<span class="token punctuation">{<!-- --></span>     
		<span class="token function">LCD_write_com</span><span class="token punctuation">(</span><span class="token number">0xC0</span> <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>     
	<span class="token punctuation">}</span>
       
	<span class="token keyword">while</span><span class="token punctuation">(</span>length<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>     
		<span class="token function">LCD_write_Data</span><span class="token punctuation">(</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>     
		s <span class="token operator">++</span><span class="token punctuation">;</span>
		cnt<span class="token operator">++</span><span class="token punctuation">;</span>
		
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>//c51_lcd1602.h文件</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__C51_LCD1602_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__C51_LCD1602_H__</span></span>



<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"STC89C5xRC_RDP.h"</span></span>


<span class="token comment">//定义宏定义</span>

sbit RS <span class="token operator">=</span> P2<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span>   <span class="token comment">//定义端口 </span>
sbit RW <span class="token operator">=</span> P2<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span>
sbit EN <span class="token operator">=</span> P2<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">RS_CLR</span> <span class="token expression">RS<span class="token operator">=</span><span class="token number">0</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">RS_SET</span> <span class="token expression">RS<span class="token operator">=</span><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">RW_CLR</span> <span class="token expression">RW<span class="token operator">=</span><span class="token number">0</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">RW_SET</span> <span class="token expression">RW<span class="token operator">=</span><span class="token number">1</span> </span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">EN_CLR</span> <span class="token expression">EN<span class="token operator">=</span><span class="token number">0</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">EN_SET</span> <span class="token expression">EN<span class="token operator">=</span><span class="token number">1</span></span></span>


<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">LCD_write_com</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> com<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">LCD_write_Data</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Data<span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">lcd_number</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> number<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">LCD_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">LCD_write_strl</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> x<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> y<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">,</span><span class="token keyword">unsigned</span> length<span class="token punctuation">)</span> <span class="token punctuation">;</span>




<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> 
<p>//c51_key.c文件</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"includes.h"</span></span>

sbit key1<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">7</span><span class="token punctuation">;</span><span class="token comment">//定义按键位置 需要切换到独立按键模式 </span>
sbit key2<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>
sbit key3<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span>
sbit key4<span class="token operator">=</span>P3<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span>
bit Flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> key_num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">/******************************************************************/</span>
<span class="token comment">/*                    主函数                                      */</span>
<span class="token comment">/******************************************************************/</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">sys_key_single</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Flag<span class="token punctuation">)</span>           <span class="token comment">//执行一次就停止了 先检测到的相应 复位后有效</span>
      <span class="token punctuation">{<!-- --></span>
		  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>key1<span class="token punctuation">)</span>     <span class="token punctuation">{<!-- --></span>P1<span class="token operator">=</span><span class="token number">0xFE</span><span class="token punctuation">;</span>Flag<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>key_num<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The key_num ：Number 1;\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//</span>
		  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>key2<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>P1<span class="token operator">=</span><span class="token number">0xFD</span><span class="token punctuation">;</span>Flag<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>key_num<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The key_num ：Number 2;\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//</span>
		  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>key3<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>P1<span class="token operator">=</span><span class="token number">0xFB</span><span class="token punctuation">;</span>Flag<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>key_num<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The key_num ：Number 3;\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//</span>
		  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>key4<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>P1<span class="token operator">=</span><span class="token number">0xF7</span><span class="token punctuation">;</span>Flag<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>key_num<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The key_num ：Number 4;\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//</span>
		  <span class="token keyword">else</span> 
		  <span class="token punctuation">{<!-- --></span>
			key_num<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		  <span class="token punctuation">}</span>
		  
		  
		<span class="token comment">//串口后台打印数字</span>
      <span class="token punctuation">}</span>
	  <span class="token keyword">return</span> key_num<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//如果有干扰请加去抖程序</span>
<span class="token comment">//红外接收头部分用黑色物质遮光，防止干扰按键</span>
</code></pre> 
<p>//c51_key.h文件</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__C51_KEY_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__C51_KEY_H__</span></span>


<span class="token keyword">extern</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">sys_key_single</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//键盘扫描函数，使用行列反转扫描法</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> 
<p><a href="https://download.csdn.net/download/sinat_30943509/89594469"><code>配套程序</code></a></p> 
<h2><a id="4%09Proteus_667"></a>4 演示Proteus仿真</h2> 
<p><img src="https://images2.imgbox.com/f2/ff/GjTeNVYR_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="5%09_672"></a>5 总结</h2> 
<p>STC89C52R控制抢答器+数码管+后台显示+LCD1602x显示具有以下价值和优势：<br> 1. <br> 功能丰富性：整合抢答器、数码管、后台显示和LCD1602x显示功能，实现多样化的信息展示和控制功能。<br> 2. 灵活性：通过STC89C52R控制，系统具有灵活的数据交换和控制能力，可根据需求定制显示内容和功能。<br> 3. 用户体验：提供直观的数码显示和LCD1602x显示，增强用户交互体验，使信息更加清晰和易读。<br> 4. 系统稳定性：采用STC89C52R作为控制核心，系统稳定可靠，保证长时间稳定运行。<br> 5. 开发效率：整合多种显示功能和控制模块，简化开发流程，提高开发效率和系统集成度。<br> 6. 教育和培训：适用于教育和培训领域，帮助学习者理解嵌入式系统开发和控制原理。<br> 7. 应用广泛：可用于各类竞赛、培训、演示等活动中，扩展了系统应用领域和功能范围。<br> 这些优势使得STC89C52R控制的抢答器与数码管、后台显示和LCD1602x显示系统成为一款具有实用性和创新性的嵌入式系统，能够满足多样化的需求并提升用户体验。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/83a94b4ba2e15a422333228acdcd27cb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">T-Eval：大模型智能体能力评测基准解读 | ACL 2024</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/56382e548d890855cbcb623d8c996719/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">我们的前端开发逆天了！1 小时搞定了新网站，还跟我说 “不要钱”</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>