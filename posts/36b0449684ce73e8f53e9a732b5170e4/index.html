<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Godot4.2】GodotXML插件 - 解析和生成XML - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/36b0449684ce73e8f53e9a732b5170e4/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【Godot4.2】GodotXML插件 - 解析和生成XML">
  <meta property="og:description" content="概述 近期在研究Godot的XML和SVG解析，Godot提供了XMLParser类型，但本身只提供了低级的XML解析接口和功能，想要完成完整的XML文档解析和存储可能还需要在其基础上编写类或功能，就像我在昨天（2024年7月20日）基于XMLParser编写了一个简易的SVG文件解析器SVGParser。
但是我早就知道存在GodotXML这样的解析器。加上群友推荐，于是上手试用了一下。和以往一样，看源码里一堆英文注释就手痒，就机翻之，感觉代码布局不合理就稍加改动，并自己加一些注释。
本文主要简介GodotXML项目及其核心文件和核心类的方法，并贴出了汉化后的源代码内容。希望大家一起来学习和使用。
GodotXML简介 GodotXML是一个为Godot4.x引擎提供高级XML支持的插件。支持Godot 4.0-4.2，以及可能的未来版本。项目代码在Github上开源，项目地址：https://github.com/elenakrittik/GodotXML。 功能 基于GDSCript内置的XMLParser编写可以解析文件或字符串形式XML数据，并方便转换为GDSCript中的字典形式美化XML（带换行和Tab缩进，类似于VSCode中的“文档格式化”功能）可以基于GDSCript对象形式生成XML文档结构并方便存储 下载安装 在Godot4资产库中搜索 “GodotXML” 插件安装或者在Github项目主页下载ZIP压缩包到本地，将 addons/ 文件夹复制到项目的根目录。 下载下来后核心只有3个.gd文件，说是插件其实本质就是1个静态函数库&#43;2个类。
源码翻译&#43;重排 XML [外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-qnBr0RJ5-1721699899307)(https://i-blog.csdnimg.cn/direct/e9d1943b34444ef49256d5d2ddaca551.png)]
xml.gd内部是一个class_name为XML的静态函数库使用XML.parse_file()可以解析XML文件为XMLDocument实例使用XML.parse_string()可以解析XML字符串为XMLDocument实例使用XML.parse_buffer()可以解析PackedByteArray类型的XML内容为XMLDocument实例 源代码：
# ================================================================== # 名称：XML # 描述：GodotXML - Godot4的高级XML支持。此类允许从文件解析XML数据并将其转储到各种源。 # 原作者：elenakrittik（https://github.com/elenakrittik） # 翻译&#43;重排：巽星石 最后修改：2024年7月21日15:56:39 # ================================================================== class_name XML extends RefCounted # =============================== 表层解析函数（直接调用） =============================== # 将文件内容作为XML解析为 XMLDocument 实例 # 指定路径处的文件必须可读，文件内容必须是语法有效的XML文档。 static func parse_file(path: String) -&gt; XMLDocument: var file = FileAccess.open(path, FileAccess.READ) var xml: PackedByteArray = file.get_as_text().to_utf8_buffer() file = null return XML.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-23T10:09:05+08:00">
    <meta property="article:modified_time" content="2024-07-23T10:09:05+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Godot4.2】GodotXML插件 - 解析和生成XML</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>概述</h3> 
<p>近期在研究Godot的XML和SVG解析，Godot提供了<code>XMLParser</code>类型，但本身只提供了低级的XML解析接口和功能，想要完成完整的XML文档解析和存储可能还需要在其基础上编写类或功能，就像我在昨天（2024年7月20日）基于<code>XMLParser</code>编写了一个简易的SVG文件解析器<a href="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=https%3A%2F%2Fblog.csdn.net%2Fgraypigen1990%2Farticle%2Fdetails%2F140580540&amp;pos_id=img-a0wJ3oAu-1721651125825" rel="nofollow">SVGParser</a>。</p> 
<p>但是我早就知道存在GodotXML这样的解析器。加上群友推荐，于是上手试用了一下。和以往一样，看源码里一堆英文注释就手痒，就机翻之，感觉代码布局不合理就稍加改动，并自己加一些注释。</p> 
<p>本文主要简介GodotXML项目及其核心文件和核心类的方法，并贴出了汉化后的源代码内容。希望大家一起来学习和使用。</p> 
<h4><a id="GodotXML_6"></a>GodotXML简介</h4> 
<ul><li>GodotXML是一个为Godot4.x引擎提供高级XML支持的插件。支持Godot 4.0-4.2，以及可能的未来版本。</li><li>项目代码在Github上开源，项目地址：<a href="https://github.com/elenakrittik/GodotXML">https://github.com/elenakrittik/GodotXML</a>。</li></ul> 
<h4><a id="_9"></a>功能</h4> 
<ul><li>基于GDSCript内置的<code>XMLParser</code>编写</li><li>可以解析文件或字符串形式XML数据，并方便转换为GDSCript中的字典形式</li><li>美化XML（带换行和Tab缩进，类似于VSCode中的“文档格式化”功能）</li><li>可以基于GDSCript对象形式生成XML文档结构并方便存储</li></ul> 
<h4><a id="_14"></a>下载安装</h4> 
<ul><li>在Godot4资产库中搜索 “GodotXML” 插件安装</li><li>或者在Github项目主页下载ZIP压缩包到本地，将 <code>addons/</code> 文件夹复制到项目的根目录。</li></ul> 
<p>下载下来后核心只有3个.gd文件，说是插件其实本质就是1个静态函数库+2个类。<br> <img src="https://images2.imgbox.com/5e/17/Z1lMVOVo_o.png" alt="image.png"></p> 
<h3><a id="_21"></a>源码翻译+重排</h3> 
<h4><a id="XML_22"></a>XML</h4> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-qnBr0RJ5-1721699899307)(https://i-blog.csdnimg.cn/direct/e9d1943b34444ef49256d5d2ddaca551.png)]</p> 
<ul><li><code>xml.gd</code>内部是一个<code>class_name</code>为<code>XML</code>的静态函数库</li><li>使用<code>XML.parse_file()</code>可以解析XML文件为<code>XMLDocument</code>实例</li><li>使用<code>XML.parse_string()</code>可以解析XML字符串为<code>XMLDocument</code>实例</li><li>使用<code>XML.parse_buffer()</code>可以解析<code>PackedByteArray</code>类型的XML内容为<code>XMLDocument</code>实例</li></ul> 
<p>源代码：</p> 
<pre><code class="prism language-swift"># <span class="token operator">==================================================================</span>
# 名称：<span class="token constant">XML</span>
# 描述：<span class="token class-name">GodotXML</span> <span class="token operator">-</span> <span class="token class-name">Godot4</span>的高级<span class="token constant">XML</span>支持。此类允许从文件解析<span class="token constant">XML</span>数据并将其转储到各种源。
# 原作者：elenakrittik（https<span class="token punctuation">:</span><span class="token operator">//</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>elenakrittik）
# 翻译<span class="token operator">+</span>重排：巽星石 最后修改：<span class="token number">2024</span>年<span class="token number">7</span>月<span class="token number">21</span>日<span class="token number">15</span><span class="token punctuation">:</span><span class="token number">56</span><span class="token punctuation">:</span><span class="token number">39</span>
# <span class="token operator">==================================================================</span>
class_name <span class="token constant">XML</span> extends <span class="token class-name">RefCounted</span>
# <span class="token operator">===============================</span> 表层解析函数（直接调用） <span class="token operator">===============================</span>
# 将文件内容作为<span class="token constant">XML</span>解析为 <span class="token class-name">XMLDocument</span> 实例
# 指定路径处的文件必须可读，文件内容必须是语法有效的<span class="token constant">XML</span>文档。
<span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">parse_file</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">XMLDocument</span><span class="token punctuation">:</span>
	<span class="token keyword">var</span> file <span class="token operator">=</span> <span class="token class-name">FileAccess</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token class-name">FileAccess</span><span class="token punctuation">.</span><span class="token constant">READ</span><span class="token punctuation">)</span>
	<span class="token keyword">var</span> xml<span class="token punctuation">:</span> <span class="token class-name">PackedByteArray</span> <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">get_as_text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_utf8_buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	file <span class="token operator">=</span> null
	<span class="token keyword">return</span> <span class="token constant">XML</span><span class="token punctuation">.</span><span class="token function">_parse</span><span class="token punctuation">(</span>xml<span class="token punctuation">)</span>

# 将字符串作为<span class="token constant">XML</span>解析为 <span class="token class-name">XMLDocument</span> 实例
# 字符串内容必须是语法有效的<span class="token constant">XML</span>文档
<span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">parse_str</span><span class="token punctuation">(</span>xml<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">XMLDocument</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> <span class="token constant">XML</span><span class="token punctuation">.</span><span class="token function">_parse</span><span class="token punctuation">(</span>xml<span class="token punctuation">.</span><span class="token function">to_utf8_buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

# 将字 <span class="token class-name">PackedByteArray</span> 作为<span class="token constant">XML</span>解析为 <span class="token class-name">XMLDocument</span> 实例
# <span class="token class-name">PackedByteArray</span> 内容必须是语法有效的<span class="token constant">XML</span>文档。
<span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">parse_buffer</span><span class="token punctuation">(</span>xml<span class="token punctuation">:</span> <span class="token class-name">PackedByteArray</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">XMLDocument</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> <span class="token constant">XML</span><span class="token punctuation">.</span><span class="token function">_parse</span><span class="token punctuation">(</span>xml<span class="token punctuation">)</span>

# <span class="token operator">===============================</span> 核心解析函数（底层、被调用） <span class="token operator">===============================</span>
# 被<span class="token function">parse_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span>、<span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span>、<span class="token function">parse_buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>调用
<span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">_parse</span><span class="token punctuation">(</span>xml<span class="token punctuation">:</span> <span class="token class-name">PackedByteArray</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">XMLDocument</span><span class="token punctuation">:</span>
	xml <span class="token operator">=</span> <span class="token function">_cleanup_double_blankets</span><span class="token punctuation">(</span>xml<span class="token punctuation">)</span>  # 见函数体中的注释

	<span class="token keyword">var</span> doc <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token class-name">XMLDocument</span><span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">var</span> queue<span class="token punctuation">:</span> <span class="token class-name">Array</span><span class="token punctuation">[</span><span class="token class-name">XMLNode</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  # 未关闭的标签队列

	<span class="token keyword">var</span> parser <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token class-name">XMLParser</span><span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	parser<span class="token punctuation">.</span><span class="token function">open_buffer</span><span class="token punctuation">(</span>xml<span class="token punctuation">)</span>

	<span class="token keyword">while</span> parser<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">ERR_FILE_EOF</span><span class="token punctuation">:</span>
		<span class="token keyword">var</span> node<span class="token punctuation">:</span> <span class="token class-name">XMLNode</span> <span class="token operator">=</span> <span class="token function">_make_node</span><span class="token punctuation">(</span>queue<span class="token punctuation">,</span> parser<span class="token punctuation">)</span>

		# 如果节点类型为<span class="token constant">NODE_TEXT</span>，则没有节点，因此我们跳过
		<span class="token keyword">if</span> node <span class="token operator">==</span> null<span class="token punctuation">:</span>
			<span class="token keyword">continue</span>

		# 如果我们刚刚开始，我们将第一个节点设置为根节点并初始化队列
		<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
			doc<span class="token punctuation">.</span>root <span class="token operator">=</span> node
			queue<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
		<span class="token keyword">else</span><span class="token punctuation">:</span>
			<span class="token keyword">var</span> node_type <span class="token punctuation">:</span><span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">get_node_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

			# 下面，`queue<span class="token punctuation">.</span>back（）<span class="token punctuation">.</span>childs<span class="token punctuation">.</span>append（…）`表示：
			# <span class="token operator">-</span> 获取最后一个节点
			# <span class="token operator">-</span> 因为我们在那个未闭合的节点内，所以我们得到的所有非闭合节点都是它的子节点
			# <span class="token operator">-</span> 因此，我们访问<span class="token punctuation">.</span>childs并将我们的非闭合节点附加到它们上
			
			# 希望这能说明一切
			<span class="token keyword">if</span> node<span class="token punctuation">.</span>standalone<span class="token punctuation">:</span>
				queue<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>

			# 这里一样
			elif node_type <span class="token operator">==</span> <span class="token class-name">XMLParser</span><span class="token punctuation">.</span><span class="token constant">NODE_ELEMENT_END</span><span class="token punctuation">:</span>
				<span class="token keyword">var</span> last <span class="token punctuation">:</span><span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  # 获取删除最后一个未关闭的节点

				# 如果我们有一个关闭节点，但它的名称与打开节点的名称不同，这是一个错误
				<span class="token keyword">if</span> node<span class="token punctuation">.</span>name <span class="token operator">!=</span> last<span class="token punctuation">.</span>name<span class="token punctuation">:</span>
					<span class="token function">push_error</span><span class="token punctuation">(</span>
						<span class="token string-literal"><span class="token string">"Invalid closing tag: started with %s but ended with %s. Ignoring (output may be incorrect)."</span></span> <span class="token operator">%</span> <span class="token punctuation">[</span>last<span class="token punctuation">.</span>name<span class="token punctuation">,</span> node<span class="token punctuation">.</span>name<span class="token punctuation">]</span>
					<span class="token punctuation">)</span>
					# 我们没有在这里打断，而是继续，因为无效的名字往往只是一个拼写错误
					<span class="token keyword">continue</span>

				# we just closed a node<span class="token punctuation">,</span> so <span class="token keyword">if</span> the queue <span class="token keyword">is</span> empty we stop <span class="token function">parsing</span> <span class="token punctuation">(</span>effectively ignoring
				# anything past the first root<span class="token punctuation">)</span><span class="token punctuation">.</span> this <span class="token keyword">is</span> done to prevent latter roots overwriting former
				# ones <span class="token keyword">in</span> <span class="token keyword">case</span> when there's more than one <span class="token function">root</span> <span class="token punctuation">(</span>invalid per standard<span class="token punctuation">,</span> but still used <span class="token keyword">in</span>
				# <span class="token keyword">some</span> documents<span class="token punctuation">)</span><span class="token punctuation">.</span> we <span class="token keyword">do</span> not natively support multiple <span class="token function">roots</span> <span class="token punctuation">(</span>and will not<span class="token punctuation">,</span> please <span class="token keyword">do</span> not
				# <span class="token keyword">open</span> <span class="token class-name">PRs</span> <span class="token keyword">for</span> that<span class="token punctuation">)</span><span class="token punctuation">,</span> but <span class="token keyword">if</span> the user really needs to<span class="token punctuation">,</span> it <span class="token keyword">is</span> trivial to wrap the input with
				# another <span class="token string-literal"><span class="token string">"housing"</span></span> node<span class="token punctuation">.</span>
				
				# 我们刚刚关闭了一个节点，因此如果队列为空，我们将停止解析（实际上忽略了
				# 任何超过第一根的东西）。这样做是为了防止后根覆盖前根
				# 如果有多个根（根据标准无效，但仍在使用
				# 一些文件）。我们本身不支持多个根（也不会，请不要
				# 为此打开<span class="token constant">PR</span>），但如果用户真的需要，用以下内容包装输入是很简单的
				# 另一个“住房”节点。
				<span class="token keyword">if</span> queue<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
					<span class="token keyword">break</span>

			# opening node
			<span class="token keyword">else</span><span class="token punctuation">:</span>
				queue<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
				queue<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>  # 移动到节点体内

	# 如果解析已结束，但仍有未关闭的节点，我们会报告它
	<span class="token keyword">if</span> not queue<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		queue<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token keyword">var</span> names<span class="token punctuation">:</span> <span class="token class-name">Array</span><span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

		<span class="token keyword">for</span> node <span class="token keyword">in</span> queue<span class="token punctuation">:</span>
			names<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>name<span class="token punctuation">)</span>

		<span class="token function">push_error</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"The following nodes were not closed: %s"</span></span> <span class="token operator">%</span> <span class="token string-literal"><span class="token string">", "</span></span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>names<span class="token punctuation">)</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> doc

# <span class="token operator">===============================</span> 转换函数 <span class="token operator">===============================</span>
# 将 <span class="token class-name">XMLDocument</span> 实例转为纯文本存储到指定文件
<span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">dump_file</span><span class="token punctuation">(</span>
	path<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
	document<span class="token punctuation">:</span> <span class="token class-name">XMLDocument</span><span class="token punctuation">,</span>
	pretty<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	indent_level<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
	indent_length<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> void<span class="token punctuation">:</span>
	<span class="token keyword">return</span> document<span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">dump_file</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> pretty<span class="token punctuation">,</span> indent_level<span class="token punctuation">,</span> indent_length<span class="token punctuation">)</span>


# 将 <span class="token class-name">XMLDocument</span> 实例转为 <span class="token class-name">PackedByteArray</span>形式
<span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">dump_buffer</span><span class="token punctuation">(</span>
	document<span class="token punctuation">:</span> <span class="token class-name">XMLDocument</span><span class="token punctuation">,</span>
	pretty<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	indent_level<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
	indent_length<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">PackedByteArray</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> document<span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">dump_buffer</span><span class="token punctuation">(</span>pretty<span class="token punctuation">,</span> indent_level<span class="token punctuation">,</span> indent_length<span class="token punctuation">)</span>


## 将 <span class="token class-name">XMLDocument</span> 实例转为 <span class="token class-name">String</span> 形式
<span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">dump_str</span><span class="token punctuation">(</span>
	document<span class="token punctuation">:</span> <span class="token class-name">XMLDocument</span><span class="token punctuation">,</span>
	pretty<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
	indent_level<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
	indent_length<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> document<span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">dump_str</span><span class="token punctuation">(</span>pretty<span class="token punctuation">,</span> indent_level<span class="token punctuation">,</span> indent_length<span class="token punctuation">)</span>


# 创建节点
<span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">_make_node</span><span class="token punctuation">(</span>queue<span class="token punctuation">:</span> <span class="token class-name">Array</span><span class="token punctuation">[</span><span class="token class-name">XMLNode</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parser<span class="token punctuation">:</span> <span class="token class-name">XMLParser</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Variant</span><span class="token punctuation">:</span>
	<span class="token keyword">var</span> node_type <span class="token punctuation">:</span><span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">get_node_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	match node_type<span class="token punctuation">:</span>
		<span class="token class-name">XMLParser</span><span class="token punctuation">.</span><span class="token constant">NODE_ELEMENT</span><span class="token punctuation">:</span>
			<span class="token keyword">return</span> <span class="token constant">XML</span><span class="token punctuation">.</span><span class="token function">_make_node_element</span><span class="token punctuation">(</span>parser<span class="token punctuation">)</span>
		<span class="token class-name">XMLParser</span><span class="token punctuation">.</span><span class="token constant">NODE_ELEMENT_END</span><span class="token punctuation">:</span>
			<span class="token keyword">return</span> <span class="token constant">XML</span><span class="token punctuation">.</span><span class="token function">_make_node_element_end</span><span class="token punctuation">(</span>parser<span class="token punctuation">)</span>
		<span class="token class-name">XMLParser</span><span class="token punctuation">.</span><span class="token constant">NODE_TEXT</span><span class="token punctuation">:</span>
			# 忽略根节点前的空白文本；这样更容易，相信我
			<span class="token keyword">if</span> queue<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
				<span class="token keyword">return</span>
			<span class="token constant">XML</span><span class="token punctuation">.</span><span class="token function">_attach_node_data</span><span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> parser<span class="token punctuation">)</span>
			<span class="token keyword">return</span>
		<span class="token class-name">XMLParser</span><span class="token punctuation">.</span><span class="token constant">NODE_CDATA</span><span class="token punctuation">:</span>
			<span class="token keyword">if</span> queue<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
				<span class="token keyword">return</span>
			<span class="token function">_attach_node_cdata</span><span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> parser<span class="token punctuation">)</span>
			<span class="token keyword">return</span>

	<span class="token keyword">return</span>

# 创建节点元素
<span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">_make_node_element</span><span class="token punctuation">(</span>parser<span class="token punctuation">:</span> <span class="token class-name">XMLParser</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">XMLNode</span><span class="token punctuation">:</span>
	<span class="token keyword">var</span> node <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token class-name">XMLNode</span><span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	node<span class="token punctuation">.</span>name <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">get_node_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	node<span class="token punctuation">.</span>attributes <span class="token operator">=</span> <span class="token constant">XML</span><span class="token punctuation">.</span><span class="token function">_get_attributes</span><span class="token punctuation">(</span>parser<span class="token punctuation">)</span>
	node<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
	node<span class="token punctuation">.</span>standalone <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  # see <span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> docs
	node<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

	<span class="token keyword">return</span> node

# 创建结束标签
<span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">_make_node_element_end</span><span class="token punctuation">(</span>parser<span class="token punctuation">:</span> <span class="token class-name">XMLParser</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">XMLNode</span><span class="token punctuation">:</span>
	<span class="token keyword">var</span> node <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token class-name">XMLNode</span><span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	node<span class="token punctuation">.</span>name <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">get_node_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	node<span class="token punctuation">.</span>attributes <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	node<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
	node<span class="token punctuation">.</span>standalone <span class="token operator">=</span> <span class="token boolean">false</span>  # 独立节点始终为<span class="token constant">NODE_ELEMENT</span>
	node<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

	<span class="token keyword">return</span> node

# 
<span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">_attach_node_data</span><span class="token punctuation">(</span>node<span class="token punctuation">:</span> <span class="token class-name">XMLNode</span><span class="token punctuation">,</span> parser<span class="token punctuation">:</span> <span class="token class-name">XMLParser</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> void<span class="token punctuation">:</span>
	# <span class="token class-name">XMLParser</span>将节点之间的空白内容视为<span class="token constant">NODE_TEXT</span>，这是不需要的
	# 因此，我们去除了“空格”，导致只有实际的内容滑入到内容中
	node<span class="token punctuation">.</span>content <span class="token operator">+=</span> parser<span class="token punctuation">.</span><span class="token function">get_node_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">strip_edges</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">_attach_node_cdata</span><span class="token punctuation">(</span>node<span class="token punctuation">:</span> <span class="token class-name">XMLNode</span><span class="token punctuation">,</span> parser<span class="token punctuation">:</span> <span class="token class-name">XMLParser</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> void<span class="token punctuation">:</span>
	node<span class="token punctuation">.</span>cdata<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>parser<span class="token punctuation">.</span><span class="token function">get_node_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">strip_edges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

# 获取属性
<span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">_get_attributes</span><span class="token punctuation">(</span>parser<span class="token punctuation">:</span> <span class="token class-name">XMLParser</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Dictionary</span><span class="token punctuation">:</span>
	<span class="token keyword">var</span> attrs<span class="token punctuation">:</span> <span class="token class-name">Dictionary</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token keyword">var</span> attr_count<span class="token punctuation">:</span> int <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">get_attribute_count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> attr_idx <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>attr_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
		attrs<span class="token punctuation">[</span>parser<span class="token punctuation">.</span><span class="token function">get_attribute_name</span><span class="token punctuation">(</span>attr_idx<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">get_attribute_value</span><span class="token punctuation">(</span>attr_idx<span class="token punctuation">)</span>

	<span class="token keyword">return</span> attrs


<span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token function-definition function">_cleanup_double_blankets</span><span class="token punctuation">(</span>xml<span class="token punctuation">:</span> <span class="token class-name">PackedByteArray</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">PackedByteArray</span><span class="token punctuation">:</span>
	# <span class="token other-directive property">#XMLParser</span>再次“不正确”，并且由于双空格转义而重复节点
	# https<span class="token punctuation">:</span><span class="token operator">//</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>godotengine<span class="token operator">/</span>godot<span class="token operator">/</span>issues<span class="token operator">/</span><span class="token number">81896</span><span class="token other-directive property">#issuecomment</span><span class="token operator">-</span><span class="token number">1731320027</span>

	<span class="token keyword">var</span> rm_count <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token number">0</span> # <span class="token class-name">How</span> much <span class="token function">elements</span> <span class="token punctuation">(</span>blankets<span class="token punctuation">)</span> to remove from the source
	<span class="token keyword">var</span> idx <span class="token punctuation">:</span><span class="token operator">=</span> xml<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>

	# 以相反的顺序迭代。这对perf很重要，否则我们
	# 需要执行double<span class="token punctuation">.</span>reverse（）并从一开始就删除元素
	# 这两种阵列都相当昂贵
	<span class="token keyword">while</span> idx <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
		<span class="token keyword">if</span> xml<span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">:</span> # <span class="token punctuation">[</span><span class="token punctuation">\</span>t<span class="token punctuation">,</span> <span class="token punctuation">\</span>n<span class="token punctuation">,</span> <span class="token punctuation">\</span>r<span class="token punctuation">]</span>
			rm_count <span class="token operator">+=</span> <span class="token number">1</span>
			idx <span class="token operator">-=</span> <span class="token number">1</span>
		<span class="token keyword">else</span><span class="token punctuation">:</span>
			<span class="token keyword">break</span>

	# 移除空格
	<span class="token keyword">while</span> rm_count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
		xml<span class="token punctuation">.</span><span class="token function">remove_at</span><span class="token punctuation">(</span>xml<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
		rm_count <span class="token operator">-=</span> <span class="token number">1</span>

	<span class="token keyword">return</span> xml
</code></pre> 
<h4><a id="XMLDocument_259"></a>XMLDocument</h4> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-6J3w9fdL-1721699899309)(https://i-blog.csdnimg.cn/direct/fb4373b9eeda4c02b522d65970bcd396.png)]</p> 
<p><code>xml_document.gd</code>中申明了一个<code>XMLDocument</code>类，用于表示XML文档，只提供一个<code>root</code>属性表示XML文档的根节点。</p> 
<pre><code class="prism language-swift"># <span class="token operator">==================================================================</span>
# 名称：<span class="token class-name">XMLDocument</span>
# 描述：表示<span class="token constant">XML</span>文档
# 原作者：elenakrittik（https<span class="token punctuation">:</span><span class="token operator">//</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>elenakrittik）
# 翻译<span class="token operator">+</span>重排：巽星石 最后修改：<span class="token number">2024</span>年<span class="token number">7</span>月<span class="token number">21</span>日<span class="token number">15</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">23</span>
# <span class="token operator">==================================================================</span>
class_name <span class="token class-name">XMLDocument</span> extends <span class="token class-name">RefCounted</span>
<span class="token keyword">var</span> root<span class="token punctuation">:</span> <span class="token class-name">XMLNode</span>
<span class="token keyword">func</span> <span class="token function-definition function">_to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"&lt;XMLDocument root=%s&gt;"</span></span> <span class="token operator">%</span> <span class="token keyword">self</span><span class="token punctuation">.</span>root
</code></pre> 
<h4><a id="XMLNode_275"></a>XMLNode</h4> 
<p>可以看到比较核心和重要的内容放到了<code>XMLNode</code>类上。<br> [外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-I6v0DgEY-1721699899309)(https://i-blog.csdnimg.cn/direct/37345cf497eb44afa87f6d4d880153c8.png)]</p> 
<pre><code class="prism language-swift"># <span class="token operator">==================================================================</span>
# 名称：<span class="token class-name">XMLNode</span>
# 描述：表示<span class="token constant">XML</span>元素（又名<span class="token constant">XML</span>节点）。
# 提示：如果只有一个同名的子节点，您可以通过 this_node<span class="token punctuation">.</span>my_child_name 访问它！
# 原作者：elenakrittik（https<span class="token punctuation">:</span><span class="token operator">//</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>elenakrittik）
# 翻译<span class="token operator">+</span>重排：巽星石 最后修改：<span class="token number">2024</span>年<span class="token number">7</span>月<span class="token number">21</span>日<span class="token number">15</span><span class="token punctuation">:</span><span class="token number">38</span><span class="token punctuation">:</span><span class="token number">23</span>
# <span class="token operator">==================================================================</span>
class_name <span class="token class-name">XMLNode</span> extends <span class="token class-name">RefCounted</span>
# <span class="token operator">==========================================</span> 属性 <span class="token operator">==========================================</span>
<span class="token keyword">var</span> name<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>             # 节点名称
<span class="token keyword">var</span> attributes<span class="token punctuation">:</span> <span class="token class-name">Dictionary</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>   # 节点属性字典
<span class="token keyword">var</span> content<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>          # 节点内容
<span class="token keyword">var</span> cdata<span class="token punctuation">:</span> <span class="token class-name">Array</span><span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>     # <span class="token constant">CDATA</span>
<span class="token keyword">var</span> standalone<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">false</span>      # 是否为空节点（也就是自闭合标签）
<span class="token keyword">var</span> children<span class="token punctuation">:</span> <span class="token class-name">Array</span><span class="token punctuation">[</span><span class="token class-name">XMLNode</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> # 子节点

<span class="token keyword">var</span> _node_props<span class="token punctuation">:</span> <span class="token class-name">Array</span>
<span class="token keyword">var</span> _node_props_initialized<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">false</span>

const <span class="token constant">KNOWN_PROPERTIES</span><span class="token punctuation">:</span> <span class="token class-name">Array</span><span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"name"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"attributes"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"content"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"cdata"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"standalone"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"children"</span></span><span class="token punctuation">]</span>
# <span class="token operator">==========================================</span> 虚函数 <span class="token operator">==========================================</span>
# <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>或调用<span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>时返回的文本
<span class="token keyword">func</span> <span class="token function-definition function">_to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"&lt;XMLNode name=%s attributes=%s content=%s cdata=%s standalone=%s children=%s&gt;"</span></span> <span class="token operator">%</span> <span class="token punctuation">[</span>
		<span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span>
		<span class="token string-literal"><span class="token string">"{...}"</span></span> <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>attributes<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token string-literal"><span class="token string">"{}"</span></span><span class="token punctuation">,</span>
		'<span class="token string-literal"><span class="token string">"..."</span></span>' <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> '<span class="token string-literal"><span class="token string">""</span></span>'<span class="token punctuation">,</span>
		<span class="token string-literal"><span class="token string">"[...]"</span></span> <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cdata<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token string-literal"><span class="token string">"[]"</span></span><span class="token punctuation">,</span>
		<span class="token keyword">self</span><span class="token punctuation">.</span>standalone<span class="token punctuation">,</span>
		<span class="token string-literal"><span class="token string">"[...]"</span></span> <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token string-literal"><span class="token string">"[]"</span></span>
	<span class="token punctuation">]</span>

# 通过<span class="token class-name">GDScript</span>进行点访问
<span class="token keyword">func</span> <span class="token function-definition function">_get</span><span class="token punctuation">(</span>property<span class="token punctuation">:</span> <span class="token class-name">StringName</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> not <span class="token keyword">self</span><span class="token punctuation">.</span>_node_props_initialized<span class="token punctuation">:</span>
		<span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">_initialize_node_properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>
		property not <span class="token keyword">in</span> <span class="token constant">KNOWN_PROPERTIES</span>
		and property <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>_node_props
	<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">for</span> child <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>children<span class="token punctuation">:</span>
			<span class="token keyword">if</span> child<span class="token punctuation">.</span>name <span class="token operator">==</span> property<span class="token punctuation">:</span>
				<span class="token keyword">return</span> child

# 通过编辑器进行点式访问
<span class="token keyword">func</span> <span class="token function-definition function">_get_property_list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Array</span><span class="token punctuation">[</span><span class="token class-name">Dictionary</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
	<span class="token keyword">var</span> props<span class="token punctuation">:</span> <span class="token class-name">Array</span><span class="token punctuation">[</span><span class="token class-name">Dictionary</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

	<span class="token keyword">if</span> not <span class="token keyword">self</span><span class="token punctuation">.</span>_node_props_initialized<span class="token punctuation">:</span>
		<span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">_initialize_node_properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> child_name <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>_node_props<span class="token punctuation">:</span>
		props<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
			<span class="token string-literal"><span class="token string">"name"</span></span><span class="token punctuation">:</span> child_name<span class="token punctuation">,</span>
			<span class="token string-literal"><span class="token string">"type"</span></span><span class="token punctuation">:</span> <span class="token constant">TYPE_OBJECT</span><span class="token punctuation">,</span>
			<span class="token string-literal"><span class="token string">"class_name"</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"XMLNode"</span></span><span class="token punctuation">,</span>
			<span class="token string-literal"><span class="token string">"usage"</span></span><span class="token punctuation">:</span> <span class="token constant">PROPERTY_USAGE_DEFAULT</span><span class="token punctuation">,</span>
			<span class="token string-literal"><span class="token string">"hint"</span></span><span class="token punctuation">:</span> <span class="token constant">PROPERTY_HINT_NONE</span><span class="token punctuation">,</span>
			<span class="token string-literal"><span class="token string">"hint_string"</span></span><span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token keyword">return</span> props

# 初始化节点属性
<span class="token keyword">func</span> <span class="token function-definition function">_initialize_node_properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> void<span class="token punctuation">:</span>
	<span class="token keyword">var</span> names_to_nodes <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

	<span class="token keyword">for</span> child<span class="token punctuation">:</span> <span class="token class-name">XMLNode</span> <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>children<span class="token punctuation">:</span>
		<span class="token keyword">if</span> not child<span class="token punctuation">.</span>name <span class="token keyword">in</span> names_to_nodes<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
			names_to_nodes<span class="token punctuation">[</span>child<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> child
		<span class="token keyword">else</span><span class="token punctuation">:</span>
			names_to_nodes<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>name<span class="token punctuation">)</span>

	<span class="token keyword">self</span><span class="token punctuation">.</span>_node_props <span class="token operator">=</span> names_to_nodes<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">self</span><span class="token punctuation">.</span>_node_props_initialized <span class="token operator">=</span> <span class="token boolean">true</span>
# <span class="token operator">==========================================</span> 方法 <span class="token operator">==========================================</span>
# 将当前节点（及其所有子节点）转换为字典形式
<span class="token keyword">func</span> <span class="token function-definition function">to_dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">Dictionary</span><span class="token punctuation">:</span>
	<span class="token keyword">var</span> output <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	output<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"__name__"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name         # 节点名称
	output<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"__content__"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>content   # 节点内容
	output<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"__cdata__"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>cdata       # <span class="token constant">CDATA</span>
	output<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"attrs"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>attributes      # 节点属性
	# 遍历<span class="token operator">+</span>递归获取子节点的字典形式
	<span class="token keyword">var</span> children_dict <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token keyword">for</span> child <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>children<span class="token punctuation">:</span>
		children_dict<span class="token punctuation">[</span>child<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">to_dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	output<span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"children"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> children_dict
	<span class="token keyword">return</span> output

# <span class="token operator">--------------------</span> 类型转化 <span class="token operator">--------------------</span> 
# 将当前节点转储到指定文件
<span class="token keyword">func</span> <span class="token function-definition function">dump_file</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>pretty<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>indent_level<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>indent_length<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> void<span class="token punctuation">:</span>
	<span class="token keyword">var</span> file <span class="token operator">=</span> <span class="token class-name">FileAccess</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token class-name">FileAccess</span><span class="token punctuation">.</span><span class="token constant">WRITE</span><span class="token punctuation">)</span>
	<span class="token keyword">var</span> xml<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">dump_str</span><span class="token punctuation">(</span>pretty<span class="token punctuation">,</span> indent_level<span class="token punctuation">,</span> indent_length<span class="token punctuation">)</span>
	file<span class="token punctuation">.</span><span class="token function">store_string</span><span class="token punctuation">(</span>xml<span class="token punctuation">)</span>
	file <span class="token operator">=</span> null

# 将当前节点转化为 <span class="token class-name">PackedByteArray</span> 形式
<span class="token keyword">func</span> <span class="token function-definition function">dump_buffer</span><span class="token punctuation">(</span>pretty<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>indent_level<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>indent_length<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">PackedByteArray</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">dump_str</span><span class="token punctuation">(</span>pretty<span class="token punctuation">,</span> indent_level<span class="token punctuation">,</span> indent_length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_utf8_buffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


# 将当前节点转化为 <span class="token class-name">String</span> 形式。
<span class="token keyword">func</span> <span class="token function-definition function">dump_str</span><span class="token punctuation">(</span>pretty<span class="token punctuation">:</span> bool <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>indent_level<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>indent_length<span class="token punctuation">:</span> int <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">:</span>
	<span class="token keyword">if</span> indent_level <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
		<span class="token function">push_warning</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"indent_level必须&gt;= 0"</span></span><span class="token punctuation">)</span>
		indent_level <span class="token operator">=</span> <span class="token number">0</span>
		
	<span class="token keyword">if</span> indent_length <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
		<span class="token function">push_warning</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"indent_length必须&gt;= 0"</span></span><span class="token punctuation">)</span>
		indent_length <span class="token operator">=</span> <span class="token number">0</span>

	<span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">_dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> not pretty <span class="token keyword">else</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">_dump_pretty</span><span class="token punctuation">(</span>indent_level<span class="token punctuation">,</span> indent_length<span class="token punctuation">)</span>

# <span class="token operator">--------------------</span> 类型转化核心函数（底层、被调用） <span class="token operator">--------------------</span> 
# 转化核心函数
<span class="token keyword">func</span> <span class="token function-definition function">_dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">:</span>
	<span class="token keyword">var</span> attribute_string <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
	<span class="token keyword">var</span> children_string <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
	<span class="token keyword">var</span> cdata_string <span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>

	<span class="token keyword">if</span> not <span class="token keyword">self</span><span class="token punctuation">.</span>attributes<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		attribute_string <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">" "</span></span>

		<span class="token keyword">for</span> attribute_key <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>attributes<span class="token punctuation">:</span>
			<span class="token keyword">var</span> attribute_value <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>attributes<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>attribute_key<span class="token punctuation">)</span>

			<span class="token keyword">if</span> attribute_value <span class="token keyword">is</span> <span class="token class-name">String</span><span class="token punctuation">:</span>
				attribute_value <span class="token operator">=</span> attribute_value<span class="token punctuation">.</span><span class="token function">xml_escape</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

			attribute_string <span class="token operator">+=</span> '<span class="token punctuation">{<!-- --></span>key<span class="token punctuation">}</span><span class="token operator">=</span><span class="token string-literal"><span class="token string">"{value}"</span></span>'<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string-literal"><span class="token string">"key"</span></span><span class="token punctuation">:</span> attribute_key<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"value"</span></span><span class="token punctuation">:</span> attribute_value<span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> child<span class="token punctuation">:</span> <span class="token class-name">XMLNode</span> <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>children<span class="token punctuation">:</span>
		children_string <span class="token operator">+=</span> child<span class="token punctuation">.</span><span class="token function">_dump</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> cdata_content <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>cdata<span class="token punctuation">:</span>
		cdata_string <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"&lt;![CDATA[%s]]&gt;"</span></span> <span class="token operator">%</span> cdata_content<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"]]&gt;"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"]]]]&gt;&lt;![CDATA[&gt;"</span></span><span class="token punctuation">)</span>

	<span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>standalone<span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token string-literal"><span class="token string">"&lt;"</span></span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">+</span> attribute_string <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"/&gt;"</span></span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			<span class="token string-literal"><span class="token string">"&lt;"</span></span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">+</span> attribute_string <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"&gt;"</span></span> <span class="token operator">+</span>
			<span class="token keyword">self</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">xml_escape</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> cdata_string <span class="token operator">+</span> children_string <span class="token operator">+</span>
			<span class="token string-literal"><span class="token string">"&lt;/"</span></span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"&gt;"</span></span>
		<span class="token punctuation">)</span>
# <span class="token operator">--------------------</span> 格式化 <span class="token operator">--------------------</span> 
# 格式化<span class="token constant">XML</span>文档
# 让杂乱的内容变的清晰美观
<span class="token keyword">func</span> <span class="token function-definition function">_dump_pretty</span><span class="token punctuation">(</span>indent_level<span class="token punctuation">:</span> int<span class="token punctuation">,</span> indent_length<span class="token punctuation">:</span> int<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">:</span>
	<span class="token keyword">var</span> indent_string <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string-literal"><span class="token string">" "</span></span><span class="token punctuation">.</span><span class="token keyword">repeat</span><span class="token punctuation">(</span>indent_level <span class="token operator">*</span> indent_length<span class="token punctuation">)</span>
	<span class="token keyword">var</span> indent_next_string <span class="token punctuation">:</span><span class="token operator">=</span> indent_string <span class="token operator">+</span> <span class="token string-literal"><span class="token string">" "</span></span><span class="token punctuation">.</span><span class="token keyword">repeat</span><span class="token punctuation">(</span>indent_length<span class="token punctuation">)</span>
	<span class="token keyword">var</span> attribute_string <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
	<span class="token keyword">var</span> content_string <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string-literal"><span class="token string">"\n"</span></span> <span class="token operator">+</span> indent_next_string <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">xml_escape</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> not <span class="token keyword">self</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string-literal"><span class="token string">""</span></span>
	<span class="token keyword">var</span> children_string <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>
	<span class="token keyword">var</span> cdata_string <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string-literal"><span class="token string">""</span></span>

	<span class="token keyword">if</span> not <span class="token keyword">self</span><span class="token punctuation">.</span>attributes<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">for</span> attribute_key <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>attributes<span class="token punctuation">:</span>
			<span class="token keyword">var</span> attribute_value <span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>attributes<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>attribute_key<span class="token punctuation">)</span>

			<span class="token keyword">if</span> attribute_value <span class="token keyword">is</span> <span class="token class-name">String</span><span class="token punctuation">:</span>
				attribute_value <span class="token operator">=</span> attribute_value<span class="token punctuation">.</span><span class="token function">xml_escape</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

			attribute_string <span class="token operator">+=</span> ' <span class="token punctuation">{<!-- --></span>key<span class="token punctuation">}</span><span class="token operator">=</span><span class="token string-literal"><span class="token string">"{value}"</span></span>'<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string-literal"><span class="token string">"key"</span></span><span class="token punctuation">:</span> attribute_key<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"value"</span></span><span class="token punctuation">:</span> attribute_value<span class="token punctuation">}</span><span class="token punctuation">)</span>

	<span class="token keyword">for</span> child<span class="token punctuation">:</span> <span class="token class-name">XMLNode</span> <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>children<span class="token punctuation">:</span>
		children_string <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"\n"</span></span> <span class="token operator">+</span> child<span class="token punctuation">.</span><span class="token function">dump_str</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> indent_level <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> indent_length<span class="token punctuation">)</span>

	<span class="token keyword">for</span> cdata_content <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>cdata<span class="token punctuation">:</span>
		cdata_string <span class="token operator">+=</span> <span class="token string-literal"><span class="token string">"\n"</span></span> <span class="token operator">+</span> indent_next_string <span class="token operator">+</span> <span class="token punctuation">(</span>
			<span class="token string-literal"><span class="token string">"&lt;![CDATA[%s]]&gt;"</span></span> <span class="token operator">%</span> cdata_content<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"]]&gt;"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">"]]]]&gt;\n%s&lt;![CDATA[&gt;"</span></span> <span class="token operator">%</span> indent_next_string<span class="token punctuation">)</span>
		<span class="token punctuation">)</span>

	<span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>standalone<span class="token punctuation">:</span>
		<span class="token keyword">return</span> indent_string <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"&lt;"</span></span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">+</span> attribute_string <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"/&gt;"</span></span>
	<span class="token keyword">else</span><span class="token punctuation">:</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>
			indent_string <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"&lt;"</span></span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">+</span> attribute_string <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"&gt;"</span></span> <span class="token operator">+</span>
			content_string <span class="token operator">+</span> cdata_string <span class="token operator">+</span> children_string <span class="token operator">+</span>
			<span class="token string-literal"><span class="token string">"\n"</span></span> <span class="token operator">+</span> indent_string <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"&lt;/"</span></span> <span class="token operator">+</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string-literal"><span class="token string">"&gt;"</span></span>
		<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_465"></a>使用</h3> 
<h4><a id="XML_466"></a>解析XML文件</h4> 
<pre><code class="prism language-swift"><span class="token attribute atrule">@tool</span>
extends <span class="token class-name">EditorScript</span>

<span class="token keyword">func</span> <span class="token function-definition function">_run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> void<span class="token punctuation">:</span>
	<span class="token keyword">var</span> xml_doc<span class="token punctuation">:</span><span class="token class-name">XMLDocument</span> <span class="token operator">=</span> <span class="token constant">XML</span><span class="token punctuation">.</span><span class="token function">parse_file</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"icon.svg"</span></span><span class="token punctuation">)</span>  # 解析<span class="token constant">SVG</span>文件为<span class="token class-name">XMLDocument</span>实例
	<span class="token function">print</span><span class="token punctuation">(</span>xml_doc<span class="token punctuation">)</span>
	pass
</code></pre> 
<p>上面代码中：</p> 
<ul><li>我们使用XML静态函数库的<code>parse_file()</code>静态方法，将Godot项目根目录的<code>icon.svg</code>解析为<code>XMLDocument</code>实例</li><li><code>print(xml_doc)</code>会自动调用<code>XMLDocument</code>内部的<code>_to_string()</code>并打印其返回值</li></ul> 
<p>输出：</p> 
<pre><code class="prism language-swift"><span class="token operator">&lt;</span><span class="token class-name">XMLDocument</span> root<span class="token operator">=&lt;</span><span class="token class-name">XMLNode</span> name<span class="token operator">=</span>svg attributes<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token operator">...</span><span class="token punctuation">}</span> content<span class="token operator">=</span><span class="token string-literal"><span class="token string">""</span></span> cdata<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span> standalone<span class="token operator">=</span><span class="token boolean">false</span> children<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token operator">&gt;&gt;</span>
</code></pre> 
<h4><a id="XML_485"></a>解析XML并转为字典形式</h4> 
<pre><code class="prism language-swift"><span class="token attribute atrule">@tool</span>
extends <span class="token class-name">EditorScript</span>

<span class="token keyword">func</span> <span class="token function-definition function">_run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> void<span class="token punctuation">:</span>
	<span class="token keyword">var</span> xml_doc<span class="token punctuation">:</span><span class="token class-name">XMLDocument</span> <span class="token operator">=</span> <span class="token constant">XML</span><span class="token punctuation">.</span><span class="token function">parse_file</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"icon.svg"</span></span><span class="token punctuation">)</span>  # 解析<span class="token constant">SVG</span>文件为<span class="token class-name">XMLDocument</span>实例
	<span class="token keyword">var</span> root<span class="token punctuation">:</span><span class="token class-name">XMLNode</span> <span class="token operator">=</span> xml_doc<span class="token punctuation">.</span>root          # 获取根节点
	<span class="token keyword">var</span> dict<span class="token punctuation">:</span><span class="token class-name">Dictionary</span> <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">to_dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>     # 转化为字典形式
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>dict<span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"\t"</span></span><span class="token punctuation">)</span> <span class="token punctuation">)</span>        # 以格式化的<span class="token constant">JSON</span>形式打印
</code></pre> 
<p>上面代码中：</p> 
<ul><li>使用<code>XMLNode</code>的<code>to_dict()</code>方法会将当前节点转化为字典，其内部会采用递归形式将其所有子孙节点转化为字典放入对应父节点的<code>children</code>属性中。</li><li><code>XMLDocument</code>用<code>root</code>属性记录了解析后的XML文档根节点，我们只需要对这个根节点调用<code>to_dict()</code>方法，就可以获得整个XML文档的字典形式</li></ul> 
<p>上面代码输出：</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
	<span class="token string-property property">"__cdata__"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token string-property property">"__content__"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
	<span class="token string-property property">"__name__"</span><span class="token operator">:</span> <span class="token string">"svg"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"attrs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string-property property">"height"</span><span class="token operator">:</span> <span class="token string">"128"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"width"</span><span class="token operator">:</span> <span class="token string">"128"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"xmlns"</span><span class="token operator">:</span> <span class="token string">"http://www.w3.org/2000/svg"</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token string-property property">"children"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string-property property">"g"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
			<span class="token string-property property">"__cdata__"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token string-property property">"__content__"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
			<span class="token string-property property">"__name__"</span><span class="token operator">:</span> <span class="token string">"g"</span><span class="token punctuation">,</span>
			<span class="token string-property property">"attrs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
				<span class="token string-property property">"transform"</span><span class="token operator">:</span> <span class="token string">"scale(.101) translate(122 122)"</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string-property property">"children"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
				<span class="token string-property property">"g"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
					<span class="token string-property property">"__cdata__"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
					<span class="token string-property property">"__content__"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
					<span class="token string-property property">"__name__"</span><span class="token operator">:</span> <span class="token string">"g"</span><span class="token punctuation">,</span>
					<span class="token string-property property">"attrs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
						<span class="token string-property property">"fill"</span><span class="token operator">:</span> <span class="token string">"#414042"</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token string-property property">"children"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
						<span class="token string-property property">"circle"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
							<span class="token string-property property">"__cdata__"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
							<span class="token string-property property">"__content__"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
							<span class="token string-property property">"__name__"</span><span class="token operator">:</span> <span class="token string">"circle"</span><span class="token punctuation">,</span>
							<span class="token string-property property">"attrs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
								<span class="token string-property property">"cx"</span><span class="token operator">:</span> <span class="token string">"717"</span><span class="token punctuation">,</span>
								<span class="token string-property property">"cy"</span><span class="token operator">:</span> <span class="token string">"532"</span><span class="token punctuation">,</span>
								<span class="token string-property property">"r"</span><span class="token operator">:</span> <span class="token string">"60"</span>
							<span class="token punctuation">}</span><span class="token punctuation">,</span>
							<span class="token string-property property">"children"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>

							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token string-property property">"rect"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
			<span class="token string-property property">"__cdata__"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token string-property property">"__content__"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
			<span class="token string-property property">"__name__"</span><span class="token operator">:</span> <span class="token string">"rect"</span><span class="token punctuation">,</span>
			<span class="token string-property property">"attrs"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
				<span class="token string-property property">"fill"</span><span class="token operator">:</span> <span class="token string">"#363d52"</span><span class="token punctuation">,</span>
				<span class="token string-property property">"height"</span><span class="token operator">:</span> <span class="token string">"124"</span><span class="token punctuation">,</span>
				<span class="token string-property property">"rx"</span><span class="token operator">:</span> <span class="token string">"14"</span><span class="token punctuation">,</span>
				<span class="token string-property property">"stroke"</span><span class="token operator">:</span> <span class="token string">"#212532"</span><span class="token punctuation">,</span>
				<span class="token string-property property">"stroke-width"</span><span class="token operator">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span>
				<span class="token string-property property">"width"</span><span class="token operator">:</span> <span class="token string">"124"</span><span class="token punctuation">,</span>
				<span class="token string-property property">"x"</span><span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>
				<span class="token string-property property">"y"</span><span class="token operator">:</span> <span class="token string">"2"</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token string-property property">"children"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>

			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>可以看到，每个节点主要结构：</p> 
<ul><li><code>__name__</code>：存储XML节点名称</li><li><code>__content__</code>：存储XML节点内部的文本</li><li><code>__cdata__</code>：存储CDATD</li><li><code>attrs</code>：以字典和键值对形式存储XML节点的属性和值</li><li><code>children</code>以字典形式存储XML节点的子节点</li></ul> 
<h4><a id="XML_574"></a>构造XML文件</h4> 
<p>搞定XML解析和转化之后，我们也可以用代码形式生成XML文件。</p> 
<pre><code class="prism language-swift"><span class="token attribute atrule">@tool</span>
extends <span class="token class-name">EditorScript</span>

<span class="token keyword">func</span> <span class="token function-definition function">_run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> void<span class="token punctuation">:</span>
	<span class="token keyword">var</span> xml_doc<span class="token punctuation">:</span><span class="token operator">=</span> <span class="token class-name">XMLDocument</span><span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	# 根节点svg
	<span class="token keyword">var</span> root <span class="token operator">=</span> <span class="token class-name">XMLNode</span><span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	root<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"svg"</span></span>
	root<span class="token punctuation">.</span>attributes <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string-literal"><span class="token string">"width"</span></span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">,</span>
		<span class="token string-literal"><span class="token string">"height"</span></span><span class="token punctuation">:</span><span class="token number">200</span>
	<span class="token punctuation">}</span>
	# 子节点rect
	<span class="token keyword">var</span> rect <span class="token operator">=</span> <span class="token class-name">XMLNode</span><span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	rect<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"rect"</span></span>
	rect<span class="token punctuation">.</span>attributes <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string-literal"><span class="token string">"width"</span></span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">,</span>
		<span class="token string-literal"><span class="token string">"height"</span></span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">,</span>
		<span class="token string-literal"><span class="token string">"fill"</span></span><span class="token punctuation">:</span><span class="token string-literal"><span class="token string">"red"</span></span>
	<span class="token punctuation">}</span>
	
	root<span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>rect<span class="token punctuation">)</span>    # 添加为根节点的子节点
	xml_doc<span class="token punctuation">.</span>root <span class="token operator">=</span> root           # 设为文档根节点
	
	<span class="token function">print</span><span class="token punctuation">(</span><span class="token constant">XML</span><span class="token punctuation">.</span><span class="token function">dump_str</span><span class="token punctuation">(</span>xml_doc<span class="token punctuation">)</span><span class="token punctuation">)</span>  # 转为文本形式
</code></pre> 
<p>上面的代码中：</p> 
<ul><li>我们利用<code>XMLDocument</code>的<code>new()</code>方法创建了一个<code>XMLDocument</code>实例<code>xml_doc</code>。</li><li>接着我们用<code>XMLNode</code>的<code>new()</code>方法创建根节点<code>root</code>和其子节点<code>rect</code>，并设定相应的属性。</li><li>最后将<code>rect</code>作为子节点添加到<code>root</code>的<code>children</code>中去，再指定<code>xml_doc</code>的根节点<code>root</code>为<code>root</code>。</li><li>最后通过<code>XML</code>函数库的<code>dump_str</code>方法，将<code>xml_doc</code>转为字符串形式并打印。</li></ul> 
<p>打印输出：</p> 
<pre><code class="prism language-swift"><span class="token operator">&lt;</span>svg width<span class="token operator">=</span><span class="token string-literal"><span class="token string">"200"</span></span>height<span class="token operator">=</span><span class="token string-literal"><span class="token string">"200"</span></span><span class="token operator">&gt;&lt;</span>rect width<span class="token operator">=</span><span class="token string-literal"><span class="token string">"200"</span></span>height<span class="token operator">=</span><span class="token string-literal"><span class="token string">"200"</span></span>fill<span class="token operator">=</span><span class="token string-literal"><span class="token string">"red"</span></span><span class="token operator">&gt;&lt;/</span>rect<span class="token operator">&gt;&lt;/</span>svg<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="_613"></a>格式化</h4> 
<p>将<code>dump_str()</code>方法的<code>pretty</code>参数设为<code>true</code>:</p> 
<pre><code class="prism language-swift"><span class="token function">print</span><span class="token punctuation">(</span><span class="token constant">XML</span><span class="token punctuation">.</span><span class="token function">dump_str</span><span class="token punctuation">(</span>xml_doc<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  # 转为文本形式
</code></pre> 
<p>则会进行文档格式化，输出效果：</p> 
<pre><code class="prism language-swift"><span class="token operator">&lt;</span>svg width<span class="token operator">=</span><span class="token string-literal"><span class="token string">"200"</span></span> height<span class="token operator">=</span><span class="token string-literal"><span class="token string">"200"</span></span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>rect width<span class="token operator">=</span><span class="token string-literal"><span class="token string">"200"</span></span> height<span class="token operator">=</span><span class="token string-literal"><span class="token string">"200"</span></span> fill<span class="token operator">=</span><span class="token string-literal"><span class="token string">"red"</span></span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;/</span>rect<span class="token operator">&gt;</span>
<span class="token operator">&lt;/</span>svg<span class="token operator">&gt;</span>
</code></pre> 
<p>可以看到这里默认把<code>&lt;rect&gt;</code>设定为双标签了。我们只需要设定<code>rect</code>的<code>standalone</code>属性等于<code>true</code>就可以了。</p> 
<p>输出：</p> 
<pre><code class="prism language-swift"><span class="token operator">&lt;</span>svg width<span class="token operator">=</span><span class="token string-literal"><span class="token string">"200"</span></span> height<span class="token operator">=</span><span class="token string-literal"><span class="token string">"200"</span></span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>rect width<span class="token operator">=</span><span class="token string-literal"><span class="token string">"200"</span></span> height<span class="token operator">=</span><span class="token string-literal"><span class="token string">"200"</span></span> fill<span class="token operator">=</span><span class="token string-literal"><span class="token string">"red"</span></span><span class="token operator">/&gt;</span>
<span class="token operator">&lt;/</span>svg<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="_633"></a>存储文件</h4> 
<p>要将生成的XML或SVG内容存储为文件，只需要调用XML静态函数库的<code>dump_file()</code>方法就可以了。</p> 
<pre><code class="prism language-swift"><span class="token constant">XML</span><span class="token punctuation">.</span><span class="token function">dump_file</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"test.svg"</span></span><span class="token punctuation">,</span>xml_doc<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span>  # 转为文本形式
</code></pre> 
<p>打开后：<br> <img src="https://images2.imgbox.com/a8/2e/aIWFvBCf_o.png" alt="image.png"></p> 
<p>我们只需要给根节点<code>&lt;svg&gt;</code>标签加上<code>xmlns</code>属性和其固定值<code>http://www.w3.org/2000/svg</code>就可以了。</p> 
<pre><code class="prism language-swift"># 根节点svg
	<span class="token keyword">var</span> root <span class="token operator">=</span> <span class="token class-name">XMLNode</span><span class="token punctuation">.</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	root<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"svg"</span></span>
	root<span class="token punctuation">.</span>attributes <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string-literal"><span class="token string">"width"</span></span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">,</span>
		<span class="token string-literal"><span class="token string">"height"</span></span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">,</span>
		<span class="token string-literal"><span class="token string">"xmlns"</span></span><span class="token punctuation">:</span><span class="token string-literal"><span class="token string">"http://www.w3.org/2000/svg"</span></span>
	<span class="token punctuation">}</span>
</code></pre> 
<p>此时生成的SVG文件就可以正常查看了。<br> <img src="https://images2.imgbox.com/87/31/YlRgKXhm_o.png" alt="image.png"><br> 也可以直接在Godot中使用了：</p> 
<p><img src="https://images2.imgbox.com/c3/df/aHVQZWQW_o.png" alt="image.png"></p> 
<h3><a id="_659"></a>个人心声</h3> 
<p>之所以研究SVG，是因为：</p> 
<ul><li>可以在Godot中作为美术素材使用，本质上是纯文本，而且是参数化和矢量化的</li><li>SVG与Godot内置绘图函数的参数化形式最为接近，理论上SVG可以与绘图函数互转</li><li>可以用函数或代码形式动态生成SVG图形，并赋值给节点</li><li>对于<code>TextureButton</code>或<code>TextureProgress</code>节点，可以参数化生成其所需的图片元素</li><li>可以将碰撞图形、<code>Polygon2D</code>、<code>Line2D</code>、<code>Path2D</code>等的形状和路径信息转为SVG形式存储和修改</li></ul> 
<h3><a id="_667"></a>总结</h3> 
<ul><li>Godot中的<code>XMLParser</code>类只提供了基础的API来解析XML文件，如果需要像<code>ConfigFile</code>或<code>JSON</code>一样容易使用，你就需要自己动手编写一个解析器</li><li>而GodotXML，低级别的可以直接“拿来主义”，用就完事儿，也可以研究研究源码，再其基础上进行改进或二次设计。</li><li>在GodotXML基础上可以进一步编写类或函数库，实现更多功能</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/758aa83424619508e00de145deeb448e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">轨迹优化 | 基于ESDF的共轭梯度优化算法(附ROS C&#43;&#43;/Python仿真)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/246e107da2b7860daaca9a043a18d7ce/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Doris: Multi Catalog 多源数据目录</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>