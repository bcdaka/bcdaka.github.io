<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MySQL--主从复制 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/593d95d1bf196192b0012681907355d9/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="MySQL--主从复制">
  <meta property="og:description" content="前言：本博客仅作记录学习使用，部分图片出自网络，如有侵犯您的权益，请联系删除
一、什么是主从复制 1、定义 主从复制，是用来建立一个和主数据库完全一样的数据库环境，称为从数据库；主数据库一般是准实时的业务数据库。
2、作用 做数据的热备，作为后备数据库，主数据库服务器故障后，可切换到从数据库继续工作，避免数据丢失架构的扩展。业务量越来越大，I/O访问频率过高，单机无法满足，此时做多库的存储，降低磁盘I/O访问的频率,提高单个机器的I/O性能读写分离，使数据库能支撑更大的并发 在从服务器可以执行查询工作（即我们常说的读功能），降低主服务器压力;（主库写，从库读，降压）在从服务器进行备份，避免备份期间影响主服务器服务;（确保数据安全） 二、主从复制原理 实现整个主从复制，需要由slave服务器上的IO进程和Sql进程共同完成
要实现主从复制，首先必须打开Master端的binary log（bin-log）功能，因为MySQL主从复制过程实际上就是Slave从Master端获取相应的二进制日志，然后再在自己slave端完全按照顺序执行日志中所记录的各种操作。
master 负责写 -----A slave relay-log -----B I/O 负责通信读取binlog日志 SQL 负责写数据 其主从复制流程图与步骤如下：
步骤一：主库db的更新事件(update、insert、delete)被写到binlog步骤二：从库发起连接，连接到主库步骤三：此时主库创建一个binlog dump thread线程，把binlog的内容发送到从库步骤四：从库启动之后，创建一个I/O线程，读取主库传过来的binlog内容并写入到relay log.步骤五：从库还会创建一个SQL线程，从relay log里面读取内容，将更新内容写入到slave的db. 面试题：1、主从复制延迟大比较慢原因：
主服务器配置高，从服务器的配置低 并发量大导致主服务器读的慢。从服务器写的慢 网络延迟比较高 从服务器的读写速度慢 从节点过多 面试题：2、从数据库的读的延迟问题了解吗？如何解决？
解决方法： 半同步复制—解决数据丢失的问题 并行复制—-解决从库复制延迟的问题 一、主-从-从架构 10.0.0.2主库---10.0.0.3从库--10.0.0.4从库
1、关闭防火墙 systemctl stop firewalld systemctl disable firewalld 2、设置serve_id （主从库） # 主库2 [root@localhost ~]# vim /etc/my.cnf serve_id=2 log_bin=2 ​ # 从库3 [root@localhost ~]# vim /etc/my.cnf serve_id=3 ​ # 从库4 [root@localhost ~]# vim /etc/my.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-05T16:11:08+08:00">
    <meta property="article:modified_time" content="2024-08-05T16:11:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MySQL--主从复制</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p><em><span style="color:#fe2c24;">前言</span>：本博客仅作记录学习使用，部分图片出自网络，如有侵犯您的权益，请联系删除</em></p> 
</blockquote> 
<h2><img alt="" height="855" src="https://images2.imgbox.com/4c/ef/xcd73nlZ_o.png" width="1200"></h2> 
<h2>一、什么是主从复制</h2> 
<h3>1、定义</h3> 
<p>主从复制，是用来<strong><span style="color:#fe2c24;">建立一个和主数据库完全一样的数据库环境</span>，称为<span style="color:#fe2c24;"><u>从数据库</u></span></strong>；主数据库一般是准实时的业务数据库。</p> 
<h3>2、作用</h3> 
<ul><li><strong><u>做<span style="color:#fe2c24;">数据的热备</span></u></strong>，作为后备数据库，主数据库服务器故障后，可切换到从数据库继续工作，避免数据丢失</li><li><span style="color:#fe2c24;"><strong><u>架构的扩展</u></strong></span>。业务量越来越大，I/O访问频率过高，单机无法满足，此时做多库的存储，降低磁盘I/O访问的频率,提高单个机器的I/O性能</li><li><span style="color:#fe2c24;"><strong><u>读写分离</u></strong></span>，使数据库能支撑更大的并发 
  <ul><li>在从服务器可以<span style="color:#fe2c24;"><strong>执行查询工作</strong></span>（即我们常说的读功能），降低主服务器压力;（主库写，从库读，降压）</li><li>在从服务器进行<span style="color:#fe2c24;"><strong>备份</strong></span>，避免备份期间影响主服务器服务;（确保数据安全）</li></ul></li></ul> 
<h2>二、主从复制原理</h2> 
<p>实现整个主从复制，需要<span style="color:#fe2c24;"><strong>由slave服务器上的IO进程和Sql进程共同完成</strong></span></p> 
<p>要实现主从复制，首先必须打开Master端的<strong>binary log（bin-log）</strong>功能，因为MySQL主从复制过程实际上<u><strong>就是Slave从Master端获取相应的二进制日志，然后再在自己slave端完全按照顺序执行日志中所记录的各种操作</strong></u>。</p> 
<pre><code class="language-Haskell"> master 负责写 -----A 
 slave relay-log -----B 
 I/O 负责通信读取binlog日志 
 SQL 负责写数据 </code></pre> 
<p>其主从复制流程图与步骤如下：</p> 
<p><img alt="" height="454" src="https://images2.imgbox.com/6e/8a/QVyd8Rnc_o.png" width="1047"></p> 
<ul><li>步骤一：主库db的更新事件(update、insert、delete)被写到binlog</li><li>步骤二：从库发起连接，连接到主库</li><li>步骤三：此时主库创建一个binlog dump thread线程，把binlog的内容发送到从库</li><li>步骤四：从库启动之后，创建一个I/O线程，读取主库传过来的binlog内容并写入到relay log.</li><li>步骤五：从库还会创建一个SQL线程，从relay log里面读取内容，将更新内容写入到slave的db.</li></ul> 
<p><strong><em>面试题：1、</em></strong><span style="color:#fe2c24;">主从复制延迟大比较慢原因</span>：</p> 
<pre><code class="language-Haskell"> 主服务器配置高，从服务器的配置低
 并发量大导致主服务器读的慢。从服务器写的慢
 网络延迟比较高
 从服务器的读写速度慢
 从节点过多</code></pre> 
<p><strong><em>面试题：2、</em></strong><span style="color:#fe2c24;">从数据库的读的延迟问题了解吗？如何解决？</span></p> 
<pre><code class="language-Haskell"> 解决方法：
 半同步复制—解决数据丢失的问题
 并行复制—-解决从库复制延迟的问题</code></pre> 
<h2>一、主-从-从架构</h2> 
<p><strong>10.0.0.2主库---10.0.0.3从库--10.0.0.4从库</strong></p> 
<h3>1、关闭防火墙</h3> 
<pre><code class="language-cs"> systemctl stop firewalld
 systemctl disable firewalld</code></pre> 
<h3>2、设置serve_id （主从库）</h3> 
<pre><code class="language-cs"> # 主库2
 [root@localhost ~]# vim /etc/my.cnf
 serve_id=2
 log_bin=2
 ​
 # 从库3
 [root@localhost ~]# vim /etc/my.cnf
 serve_id=3
 ​
 # 从库4
 [root@localhost ~]# vim /etc/my.cnf
 serve_id=4
 ​
 [root@localhost ~]# systemctl restart mysqld</code></pre> 
<h3>3、开启binlog日志，查看binlog日志信息-（主库）</h3> 
<pre><code class="language-cs"> [root@localhost ~]# mysql -u root -p
 mysql&gt; show master status;   # 查看binlog日志
 +----------+----------+--------------+------------------+-------------------+
 | File     | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
 +----------+----------+--------------+------------------+-------------------+
 | 2.000001 |      154 |              |                  |                   |
 +----------+----------+--------------+------------------+-------------------+
 1 row in set (0.00 sec)</code></pre> 
<h3>4、授权 （主库）</h3> 
<pre><code class="language-sql"> # 允许用户名为"user1"，来自10.0.0.*网段的用户使用密码"123"登录到MySQL服务器，并拥有读取二进制日志的权限
 mysql&gt; grant replication slave on *.* to "user1"@"10.0.0.%" identified by "123";
 mysql&gt; flush privileges;        # 刷新权限</code></pre> 
<h3>5、指定主库信息 （从库）</h3> 
<pre><code class="language-sql"> mysql&gt; change master to master_host="10.0.0.2",master_user="user1",master_password="123",master_log_file="2.000001" ,master_log_pos=154;</code></pre> 
<h3>6、启动slave</h3> 
<pre><code class="language-sql"> mysql&gt; start slave;</code></pre> 
<h3>7、查看从库状态</h3> 
<pre><code class="language-sql"> mysql&gt; show slave status\G   查看从库状态
 ...
    Slave_IO_Running: Yes    io线程
    Slave_SQL_Running: Yes   sql 线程</code></pre> 
<h2>二、主-主从-从架构</h2> 
<p><strong>10.0.0.2主库---10.0.0.3主从库--10.0.0.4从库</strong></p> 
<h3>初始化数据库</h3> 
<pre><code class="language-cs"> cd /data/mysql/data
 rm -rf *
 /data/mysql/bin/mysqld --initialize-insecure --user=mysql --basedir=/data/mysql --datadir=/data/mysql/data
 systemctl restart mysqld    </code></pre> 
<h3>1、设置serve_id</h3> 
<pre><code class="language-cs"> # 主库10.0.0.2
 [root@localhost ~]# vim /etc/my/cnf
 ...
 serve_id=2
 log_bin=2
 ​
 # 主从库10.0.0.3
 [root@localhost ~]# vim /etc/my/cnf
 ...
 serve_id=3
 log_bin=3
 log_slave_updates
 ​
 # 从库10.0.0.4
 [root@localhost ~]# vim /etc/my/cnf
 serve_id=4
 ​
 # 都需要重启mysql服务
 [root@localhost ~]# systemctl restart mysqld</code></pre> 
<h3>2、授权与指定主库信息</h3> 
<p>主库10.0.0.2中操作：</p> 
<pre><code class="language-cs"> # 查看主库10.0.0.2的binlog日志
 [root@localhost ~]# mysql -u root -p
 mysql&gt; show master status;   # 查看binlog日志
 +----------+----------+--------------+------------------+-------------------+
 | File     | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
 +----------+----------+--------------+------------------+-------------------+
 | 2.000001 |      154 |              |                  |                   |
 +----------+----------+--------------+------------------+-------------------+
 1 row in set (0.00 sec)
 # 主库10.0.0.2进行授权
 mysql&gt; grant replication slave  on *.* to "user1"@"10.0.0.%" identified by "123";
 mysql&gt; flush privileges;</code></pre> 
<p>主从库10.0.0.3中操作：</p> 
<pre><code class="language-cs"> # 查看主库10.0.0.3的binlog日志
 [root@localhost ~]# mysql -u root -p
 mysql&gt; show master status;   # 查看binlog日志
 +----------+----------+--------------+------------------+-------------------+
 | File     | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
 +----------+----------+--------------+------------------+-------------------+
 | 3.000001 |      300 |              |                  |                   |
 +----------+----------+--------------+------------------+-------------------+
 1 row in set (0.00 sec)
 # 主库10.0.0.3进行授权
 mysql&gt; grant replication slave  on *.* to "user1"@"10.0.0.%" identified by "123";
 mysql&gt; flush privileges;
 mysql&gt; change master to master_host="10.0.0.2",master_user="user1",master_password="123",master_log_file="2.000001" ,master_log_pos=154;
 mysql&gt; start slave;
 mysql&gt; show slave status\G</code></pre> 
<p>从库10.0.0.4中操作：</p> 
<pre><code class="language-cs"> mysql&gt; change master to master_host="10.0.0.2",master_user="user1",master_password="123",master_log_file="3.000001" ,master_log_pos=300;
 mysql&gt; start slave;
 mysql&gt; show slave status\G </code></pre> 
<h2>三、互为主从架构</h2> 
<p>主库10.0.0.2和10.0.0.3互为主从架构</p> 
<h3>1、设置serve_id</h3> 
<pre><code class="language-cs"> # 主从库10.0.0.2
 [root@localhost ~]# vim /etc/my/cnf
 ...
 serve_id=2
 log_bin=2
 log_slave_updates
 ​
 # 主从库10.0.0.3
 [root@localhost ~]# vim /etc/my/cnf
 ...
 serve_id=3
 log_bin=3
 log_slave_updates
 ​
 [root@localhost ~]# systemctl restart mysqld </code></pre> 
<h3>2、授权与指定主库信息</h3> 
<p>主从库10.0.0.2：</p> 
<pre><code class="language-cs"> # 查看主库10.0.0.2的binlog日志
 [root@localhost ~]# mysql -u root -p
 mysql&gt; show master status;   # 查看binlog日志
 +----------+----------+--------------+------------------+-------------------+
 | File     | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
 +----------+----------+--------------+------------------+-------------------+
 | 2.000001 |      154 |              |                  |                   |
 +----------+----------+--------------+------------------+-------------------+
 1 row in set (0.00 sec)
 # 主库10.0.0.2进行授权
 mysql&gt; grant replication slave  on *.* to "user1"@"10.0.0.%" identified by "123";
 mysql&gt; flush privileges;
 mysql&gt; change master to master_host="10.0.0.3",master_user="user1",master_password="123",master_log_file="3.000001" ,master_log_pos=300;
 mysql&gt; start slave;
 mysql&gt; show slave status\G</code></pre> 
<p>主从库10.0.0.3：</p> 
<pre><code class="language-cs"> # 查看主库10.0.0.3的binlog日志
 [root@localhost ~]# mysql -u root -p
 mysql&gt; show master status;   # 查看binlog日志
 +----------+----------+--------------+------------------+-------------------+
 | File     | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
 +----------+----------+--------------+------------------+-------------------+
 | 3.000001 |      300 |              |                  |                   |
 +----------+----------+--------------+------------------+-------------------+
 1 row in set (0.00 sec)
 # 主库10.0.0.3进行授权
 mysql&gt; grant replication slave  on *.* to "user1"@"10.0.0.%" identified by "123";
 mysql&gt; flush privileges;
 mysql&gt; change master to master_host="10.0.0.2",master_user="user1",master_password="123",master_log_file="3.000001" ,master_log_pos=154;
 mysql&gt; start slave;
 mysql&gt; show slave status\G</code></pre> 
<h2>四、问题解决</h2> 
<p><strong>查看uuid</strong>，uuid号需要唯一：</p> 
<pre><code class="language-cs"> cat /data/mysql/data/auto.cnf</code></pre> 
<h2 id="%E8%87%B4%E8%B0%A2">致谢</h2> 
<p>在此，我要对所有为知识共享做出贡献的个人和机构表示最深切的感谢。同时也感谢每一位花时间阅读这篇文章的读者，如果文章中有任何错误，欢迎留言指正。 </p> 
<blockquote> 
 <p><span style="color:#fe2c24;"><em><strong>学习永无止境，让我们共同进步！！</strong></em></span></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1241f92a7fb94e8005f2f4bd13bf55b2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">设计模式中的类关系</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/603885f2dd25e7f6bcb1d34afe6c1f79/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">免费替代Midjourney！FLUX.1使用方法大全，支持ComfyUI</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>