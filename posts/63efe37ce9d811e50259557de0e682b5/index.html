<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Stable Diffusion Web UI的原理与使用 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/63efe37ce9d811e50259557de0e682b5/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Stable Diffusion Web UI的原理与使用">
  <meta property="og:description" content="Stable Diffusion是一套基于Diffusion扩散模型生成技术的图片生成方案，随着技术的不断发展以及工业界对这套工程细节的不断优化，使其终于能在个人电脑上运行，本文将从github下载开始讲一讲如何使用Stable Diffusion Web UI进行AI图像的生成。
1.聊聊Diffusion 1.1 概念简介 StableDiffusion是基于扩散模型的应用，那就先来讲一讲什么是扩散模型。
我们知道在扩散模型出现之前，比较火的是GAN（对抗生成网络），GAN由生成器和判别器组成，两者相互博弈训练，最终产生较理想的输出。
但是GAN也有缺点，首先生成器和判别器不断进化的中间N个步骤完全是黑盒，无法调试。其次还有难以训练、模式坍缩等许多问题。
Diffusion模型并非新技术，而是更像是在另一个技术方向上的不断前进，相比GAN，Diffusion会将生成的每一个步骤都拆解出来进行反复训练。
好比绘制一幅简笔画，GAN是生成器和判别器不断进化，最终绘制完成简笔画。而Diffusion是将绘画的每一步拆解出来不断训练，最后完整的将所有步骤绘制出来：
1.2 讲讲原理 Duffsion是一个在图像加噪去噪过程中进行生成的模型，假设一张完全没有噪点的图像到一张充满噪点无法辨认的图像会经过1000个步骤：
那么在训练阶段，Diffusion模型首先会在这1000个步骤中随机选一步，先加噪，再通过网络去噪，反向传播时用该阶段的原始图片作为Loss。而这个加噪去噪的具体步骤，也并非直接加减，需要通过网络求出噪声变化值再减回去等，这里不做过多讲解。
这个去噪声的操作通过的就是Unet网络，这是一个残差卷积网络，因为结构呈U形所以得名。而我们输入的提示词也会先通过CLIP模型再编码进噪声中。
再后来出现了Latent Diffusion Models，即通过VAE这样的压缩技术，将原图通过VAE网络编码成一张尺寸比较小、包含潜空间数据的图片，再进行扩散处理，最终图像再通过VAE网络解码成原始图片。这项技术大大降低了显存的占用，也为后来的Stable Diffusion打下了基础。
2.Stable Diffusion Web UI 接下来讲讲实用的，关于Stable Diffusion与第三方开源的Web UI仓库。
2.1 Web UI简介 在github上直接查找StableDiffusion可以看到排名最靠前的有3个仓库：
实际上Stable Diffusion 是由 CompVis、Stability AI 和 LAION一起开发的，因此CompVis和Stability-AI的仓库地址理论上都是官方仓库。
而stable diffusion web ui实际上是一个非官方开源项目，但这个才是我么一会要用的仓库，这个仓库真正做到了开箱即用，不需要配置Cuda、不会有奇怪的报错、连基础模型都会帮你自动下载好。
2.2下载与配置 2.2.1 启动Stable Diffusion 首先从AUTOMATIC1111仓库的Stable Diffusion Web UI进行下载，该仓库会自动下载StableDiffusion以及基础模型：
https://github.com/AUTOMATIC1111/stable-diffusion-webui
根据该仓库的教程说明，最后运行webui-user.bat即可。
安装好并且webui-user.bat内的内容下载好后，在ip:127.0.0.1:7860可以打开StableDiffusion界面：
左上角显示的是基础模型。
2.2.2 安装大模型 像SDXL这类算作大模型，像Lora、ControlNet算小模型，小模型需要依赖大模型的版本，大模型版本改变的话小模型就会失效报错。
下载大模型需要去另外2个github仓库查找。
不想折腾，也可以在这里下载大模型：
https://rentry.org/sdmodels
https://civitai.pro/
2.2.3 安装插件 使用Stable Diffusion web ui还可以进行插件的拓展，像较流行的Lora、Control Net这些最早都不是作为SD的插件开发的，而是有正经论文的学术内容，后来才拓展的StableDiffusion插件版本。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-08-30T08:03:04+08:00">
    <meta property="article:modified_time" content="2023-08-30T08:03:04+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Stable Diffusion Web UI的原理与使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>Stable Diffusion是一套基于Diffusion扩散模型生成技术的图片生成方案，随着技术的不断发展以及工业界对这套工程细节的不断优化，使其终于能在个人电脑上运行，本文将从github下载开始讲一讲如何使用Stable Diffusion Web UI进行AI图像的生成。</p> 
<h2><a id="1Diffusion_3"></a>1.聊聊Diffusion</h2> 
<h3><a id="11__5"></a>1.1 概念简介</h3> 
<p>StableDiffusion是基于扩散模型的应用，那就先来讲一讲什么是扩散模型。</p> 
<p>我们知道在扩散模型出现之前，比较火的是GAN（对抗生成网络），GAN由生成器和判别器组成，两者相互博弈训练，最终产生较理想的输出。</p> 
<p>但是GAN也有缺点，首先生成器和判别器不断进化的中间N个步骤完全是黑盒，无法调试。其次还有难以训练、模式坍缩等许多问题。</p> 
<p>Diffusion模型并非新技术，而是更像是在另一个技术方向上的不断前进，相比GAN，Diffusion会将生成的每一个步骤都拆解出来进行反复训练。</p> 
<p>好比绘制一幅简笔画，GAN是生成器和判别器不断进化，最终绘制完成简笔画。而Diffusion是将绘画的每一步拆解出来不断训练，最后完整的将所有步骤绘制出来：<br> <img src="https://images2.imgbox.com/1a/ba/0IRhYHYs_o.jpg" alt="在这里插入图片描述" width="300"></p> 
<h3><a id="12__16"></a>1.2 讲讲原理</h3> 
<p>Duffsion是一个在图像加噪去噪过程中进行生成的模型，假设一张完全没有噪点的图像到一张充满噪点无法辨认的图像会经过1000个步骤：<br> <img src="https://images2.imgbox.com/0f/11/4Am4zd8s_o.png" alt="在这里插入图片描述"></p> 
<p>那么在训练阶段，Diffusion模型首先会在这1000个步骤中随机选一步，先加噪，再通过网络去噪，反向传播时用该阶段的原始图片作为Loss。而这个加噪去噪的具体步骤，也并非直接加减，需要通过网络求出噪声变化值再减回去等，这里不做过多讲解。</p> 
<p>这个去噪声的操作通过的就是Unet网络，这是一个残差卷积网络，因为结构呈U形所以得名。而我们输入的提示词也会先通过CLIP模型再编码进噪声中。</p> 
<p>再后来出现了Latent Diffusion Models，即通过VAE这样的压缩技术，将原图通过VAE网络编码成一张尺寸比较小、包含潜空间数据的图片，再进行扩散处理，最终图像再通过VAE网络解码成原始图片。这项技术大大降低了显存的占用，也为后来的Stable Diffusion打下了基础。</p> 
<h2><a id="2Stable_Diffusion_Web_UI_26"></a>2.Stable Diffusion Web UI</h2> 
<p>接下来讲讲实用的，关于Stable Diffusion与第三方开源的Web UI仓库。</p> 
<h3><a id="21_Web_UI_28"></a>2.1 Web UI简介</h3> 
<p>在github上直接查找StableDiffusion可以看到排名最靠前的有3个仓库：<br> <img src="https://images2.imgbox.com/6f/84/cScP9Wrn_o.png" alt="在这里插入图片描述"><br> 实际上Stable Diffusion 是由 CompVis、Stability AI 和 LAION一起开发的，因此CompVis和Stability-AI的仓库地址理论上都是官方仓库。<br> 而stable diffusion web ui实际上是一个非官方开源项目，但这个才是我么一会要用的仓库，这个仓库真正做到了开箱即用，不需要配置Cuda、不会有奇怪的报错、连基础模型都会帮你自动下载好。</p> 
<h3><a id="22_34"></a>2.2下载与配置</h3> 
<h4><a id="221_Stable_Diffusion_35"></a>2.2.1 启动Stable Diffusion</h4> 
<p>首先从AUTOMATIC1111仓库的Stable Diffusion Web UI进行下载，该仓库会自动下载StableDiffusion以及基础模型：<br> <a href="https://github.com/AUTOMATIC1111/stable-diffusion-webui">https://github.com/AUTOMATIC1111/stable-diffusion-webui</a></p> 
<p>根据该仓库的教程说明，最后运行webui-user.bat即可。<br> <img src="https://images2.imgbox.com/33/90/ZxotTtOB_o.png" alt="在这里插入图片描述"><br> 安装好并且webui-user.bat内的内容下载好后，在ip:127.0.0.1:7860可以打开StableDiffusion界面：<br> <img src="https://images2.imgbox.com/3b/15/GZMWlBE6_o.png" alt="在这里插入图片描述"><br> 左上角显示的是基础模型。</p> 
<h4><a id="222__45"></a>2.2.2 安装大模型</h4> 
<p>像SDXL这类算作大模型，像Lora、ControlNet算小模型，小模型需要依赖大模型的版本，大模型版本改变的话小模型就会失效报错。</p> 
<p>下载大模型需要去另外2个github仓库查找。</p> 
<p>不想折腾，也可以在这里下载大模型：<br> <a href="https://rentry.org/sdmodels" rel="nofollow">https://rentry.org/sdmodels</a><br> <a href="https://civitai.pro/" rel="nofollow">https://civitai.pro/</a></p> 
<h4><a id="223__54"></a>2.2.3 安装插件</h4> 
<p>使用Stable Diffusion web ui还可以进行插件的拓展，像较流行的Lora、Control Net这些最早都不是作为SD的插件开发的，而是有正经论文的学术内容，后来才拓展的StableDiffusion插件版本。</p> 
<p>Control Net1.1全家桶可以在hugging face上下载：<br> <a href="https://huggingface.co/lllyasviel/ControlNet-v1-1/tree/main" rel="nofollow">https://huggingface.co/lllyasviel/ControlNet-v1-1/tree/main</a></p> 
<p>还有最近短视频平台比较火的小和尚，嘴型生成SadTalker插件：<br> <a href="https://github.com/OpenTalker/SadTalker">https://github.com/OpenTalker/SadTalker</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/14969314e571359d6caa4ec3957831b7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【SpringBoot】带你一文彻底搞懂RestController和Controller的关系与区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bc942e2bf85bc175bd5aece7095bc4e2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Error: Could not create the Java Virtual Machine. Error: A fatal exception has occurred. Program wi</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>