<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pytest - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/5a748c120135eca0627c0c3b4985e917/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="pytest">
  <meta property="og:description" content="学习视频 https://www.bilibili.com/video/BV1py4y1t7bJ/?spm_id_from=333.337.search-card.all.click&amp;vd_source=5d1d6a8d64d590dd81191ca4c12bf2f2
pytest插件 pytest-html （生成html格式的测试报告）
pytest-xdist 测试用例分布式执行，多cpu分发
pytest-ordering 用于改变用例执行的顺序
pytest-rerunfailures 用例失败后重跑
allure-pytest 用于生成美观的测试报告
使用规范 1、模块名必须以test_开头或者_test结尾
2、测试必须以Test开头，并且不能有init方法
3、测试方法必须以test开头
运行 指定运行目录： pytest -vs testcase
指定运行方法： pytest -vs testcase/test_interface.py::test_04_func
多线程运行： pytest -vs testcase -n 2
失败重跑： pytest -vs testcase --reruns 2
跳过用例： pytest -vs testcase -k “ao” 只执行包含ao字符串的测试用例
执行顺序： 默认执行顺序从上往下，@pytest.mark.run(order=1) 指定执行顺序
配置运行规则，pytest.ini放在根目录下
[pytest] addopts = -vs --html ./report/report.html # 命令行的参数，用空格分隔 testpaths = ./testcase # 测试用例执行的路径 python_files = test_*.py # 模块名的规则 python_classes = Test* # 配置执行的测试类名 python_functions = test # 配置执行的函数名 markers = smoke: smoke usermanage: usermanage 如果报unicodeDecodeError: ‘gbk’ … 需要把注释删掉，然后用notepad&#43;&#43;将文件编码转为ANSI">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-21T14:52:39+08:00">
    <meta property="article:modified_time" content="2024-05-21T14:52:39+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pytest</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>学习视频</h2> 
<p>https://www.bilibili.com/video/BV1py4y1t7bJ/?spm_id_from=333.337.search-card.all.click&amp;vd_source=5d1d6a8d64d590dd81191ca4c12bf2f2</p> 
<h2><a id="pytest_2"></a>pytest插件</h2> 
<p>pytest-html （生成html格式的测试报告）<br> pytest-xdist 测试用例分布式执行，多cpu分发<br> pytest-ordering 用于改变用例执行的顺序<br> pytest-rerunfailures 用例失败后重跑<br> allure-pytest 用于生成美观的测试报告</p> 
<h2><a id="_9"></a>使用规范</h2> 
<p>1、模块名必须以test_开头或者_test结尾<br> 2、测试必须以Test开头，并且不能有init方法<br> 3、测试方法必须以test开头</p> 
<h2><a id="_14"></a>运行</h2> 
<p>指定运行目录： pytest -vs testcase<br> 指定运行方法： pytest -vs testcase/test_interface.py::test_04_func<br> 多线程运行： pytest -vs testcase -n 2<br> 失败重跑： pytest -vs testcase --reruns 2<br> 跳过用例： pytest -vs testcase -k “ao” 只执行包含ao字符串的测试用例</p> 
<p>执行顺序： 默认执行顺序从上往下，@pytest.mark.run(order=1) 指定执行顺序</p> 
<p>配置运行规则，pytest.ini放在根目录下</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>pytest<span class="token punctuation">]</span>
addopts <span class="token operator">=</span> <span class="token operator">-</span>vs <span class="token operator">-</span><span class="token operator">-</span>html <span class="token punctuation">.</span><span class="token operator">/</span>report<span class="token operator">/</span>report<span class="token punctuation">.</span>html   <span class="token comment"># 命令行的参数，用空格分隔</span>
testpaths <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token operator">/</span>testcase    <span class="token comment"># 测试用例执行的路径</span>
python_files <span class="token operator">=</span> test_<span class="token operator">*</span><span class="token punctuation">.</span>py    <span class="token comment"># 模块名的规则</span>
python_classes <span class="token operator">=</span> Test<span class="token operator">*</span>      <span class="token comment"># 配置执行的测试类名</span>
python_functions <span class="token operator">=</span> test     <span class="token comment"># 配置执行的函数名</span>
markers <span class="token operator">=</span> 
	smoke<span class="token punctuation">:</span> smoke
	usermanage<span class="token punctuation">:</span> usermanage
</code></pre> 
<p>如果报unicodeDecodeError: ‘gbk’ … 需要把注释删掉，然后用notepad++将文件编码转为ANSI</p> 
<p>分组执行：在对应函数上加装饰器@pytest.mark.smoke smoke自定义的，可以随意编写，跟配置文件中一致<br> 执行命令为：`pytest -m “smoke or usermanage” # 运行smoke和usermanage装饰器的函数</p> 
<p>跳过用例：<br> 有条件跳过：@pytest.mark.skip(age&lt;18, reason=“ad”)<br> 无条件跳过：@pytest.mark.skip(reason=“ad”)</p> 
<p>生成报告：加载配置文件addopts中</p> 
<h2><a id="_47"></a>前后置和固件</h2> 
<p>setup() 每条用例执行之前都会执行一遍<br> setup_class() 所有用例执行之前只执行一次，如创建日志对象，创建数据库连接，创建接口的请求对象<br> teardown() 每条用例执行之后都会执行一遍<br> setup_class() 所有用例执行之后只执行一次，如销毁日志对象，销毁数据库连接，销毁接口的请求对象</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">setup</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"aaaa"</span><span class="token punctuation">)</span>	
	<span class="token keyword">def</span> <span class="token function">test_01</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"111"</span><span class="token punctuation">)</span>
	<span class="token keyword">def</span> <span class="token function">test_02</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"333"</span><span class="token punctuation">)</span>
	<span class="token keyword">def</span> <span class="token function">teardown</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"bbbb"</span><span class="token punctuation">)</span>

<span class="token comment"># 执行结果为  aaaa  111 bbbb   aaaa 333 bbbb</span>
</code></pre> 
<p>针对部分用例的前后置：@pytest.fixture(scope=‘fuction’, params=[“”], autouse=Fasle, ids=“”, name=“”)</p> 
<p>参数详解：<br> scope：表示作用域，默认时fuction，可选class，module，package/session<br> params：参数化，支持list，tulp, dict<br> autouse：自动使用，全部方法使用，默认时False<br> ids：当使用params参数化时，给每一个值设置一个变量名，意义不大<br> name：给装饰的方法取别名</p> 
<p>实例：</p> 
<pre><code class="prism language-python"><span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"function"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">my_fixture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"这是前置"</span><span class="token punctuation">)</span>
	 <span class="token keyword">yield</span> 
	 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"这是后置"</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">TestA</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">test_01</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"222"</span><span class="token punctuation">)</span>
	<span class="token keyword">def</span> <span class="token function">test_01</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> my_fixture<span class="token punctuation">)</span><span class="token punctuation">:</span>
	 	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"3333"</span><span class="token punctuation">)</span>
<span class="token comment">## 传参</span>
<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"function"</span> params<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">my_fixture</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
	 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"这是前置"</span><span class="token punctuation">)</span>
	 <span class="token keyword">yield</span> request<span class="token punctuation">.</span>param
	 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"这是后置"</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">TestA</span><span class="token punctuation">:</span>
	<span class="token keyword">def</span> <span class="token function">test_01</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"222"</span><span class="token punctuation">)</span>
	<span class="token comment"># 会被执行两次</span>
	<span class="token keyword">def</span> <span class="token function">test_01</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> my_fixture<span class="token punctuation">)</span><span class="token punctuation">:</span>
	 	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"3333"</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="conftestpypytestfixture__104"></a>通过conftest.py和@pytest.fixture() 实现全局前置应用，如全局登录</h2> 
<p>conftest.py文件时单独存放的一个家具配置文件，名称不能更改。且要与运行的测试用例放到同一层级，不同层级都可以创建一个conftest.py</p> 
<pre><code class="prism language-python"><span class="token comment"># conftest.py</span>
<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>fixture</span><span class="token punctuation">(</span>scope<span class="token operator">=</span><span class="token string">"function"</span> params<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">my_fixture</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
	 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"这是前置"</span><span class="token punctuation">)</span>
	 <span class="token keyword">yield</span> request<span class="token punctuation">.</span>param
	 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"这是后置"</span><span class="token punctuation">)</span>
</code></pre> 
<p>添加好后，同一层级和下层级的测试用例就都可以使用该fixture了</p> 
<h2><a id="_assert_118"></a>断言 assert</h2> 
<p>assert 1==2</p> 
<h2><a id="pytestallure_121"></a>pytest+allure</h2> 
<p>下载: https://github.com/allure-framework/allure2/releases</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>pytest<span class="token punctuation">]</span>
addopts <span class="token operator">=</span> <span class="token operator">-</span>vs <span class="token operator">-</span><span class="token operator">-</span>alluredir <span class="token punctuation">.</span><span class="token operator">/</span>temp   <span class="token comment"># 命令行的参数，用空格分隔</span>
testpaths <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token operator">/</span>testcase    <span class="token comment"># 测试用例执行的路径</span>
python_files <span class="token operator">=</span> test_<span class="token operator">*</span><span class="token punctuation">.</span>py    <span class="token comment"># 模块名的规则</span>
python_classes <span class="token operator">=</span> Test<span class="token operator">*</span>      <span class="token comment"># 配置执行的测试类名</span>
python_functions <span class="token operator">=</span> test     <span class="token comment"># 配置执行的函数名</span>
markers <span class="token operator">=</span> 
	smoke<span class="token punctuation">:</span> smoke
	usermanage<span class="token punctuation">:</span> usermanage
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> pytest

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	pytest<span class="token punctuation">.</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span>
	os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'allure generate ./temp -o ./report --clean'</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_146"></a>数据驱动</h2> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pytest

data_set <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
 
<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>parametrize</span><span class="token punctuation">(</span><span class="token string">"test_input,expected"</span><span class="token punctuation">,</span> data_set<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">test_is_equal</span><span class="token punctuation">(</span>test_input<span class="token punctuation">,</span> expected<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> is_equal<span class="token punctuation">(</span>test_input<span class="token punctuation">,</span> expected<span class="token punctuation">)</span>
</code></pre> 
<p>或者用方法返回参数</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pytest

<span class="token keyword">def</span> <span class="token function">data_set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
 
<span class="token decorator annotation punctuation">@pytest<span class="token punctuation">.</span>mark<span class="token punctuation">.</span>parametrize</span><span class="token punctuation">(</span><span class="token string">"test_input,expected"</span><span class="token punctuation">,</span> data_set<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">test_is_equal</span><span class="token punctuation">(</span>test_input<span class="token punctuation">,</span> expected<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span> is_equal<span class="token punctuation">(</span>test_input<span class="token punctuation">,</span> expected<span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b77865992544a2df3e7682b7cf3d89cb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">大数据ETL工具对比——SeaTunnel、DataX、Sqoop、Flume、Flink CDC、Dlinky、TIS、Chunjun等对比</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c479844c03a2cd65608f9d8c6c92b2f2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">小程序与内嵌webview的数据交互</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>