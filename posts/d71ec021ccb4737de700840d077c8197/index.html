<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring boot微服务分布式框架Rouyi Cloud权限认证 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/d71ec021ccb4737de700840d077c8197/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Spring boot微服务分布式框架Rouyi Cloud权限认证">
  <meta property="og:description" content="🌹作者主页：青花锁 🌹简介：Java领域优质创作者🏆、Java微服务架构公号作者😄
🌹简历模板、学习资料、面试题库、技术互助
🌹文末获取联系方式 📝
往期热门专栏回顾 专栏描述Java项目实战介绍Java组件安装、使用；手写框架等Aws服务器实战Aws Linux服务器上操作nginx、git、JDK、VueJava微服务实战Java 微服务实战，Spring Cloud Netflix套件、Spring Cloud Alibaba套件、Seata、gateway、shadingjdbc等实战操作 Java基础篇Java基础闲聊，已出HashMap、String、StringBuffer等源码分析，JVM分析，持续更新中 Springboot篇从创建Springboot项目，到加载数据库、静态资源、输出RestFul接口、跨越问题解决到统一返回、全局异常处理、Swagger文档 Spring MVC篇从创建Spring MVC项目，到加载数据库、静态资源、输出RestFul接口、跨越问题解决到统一返回 华为云服务器实战华为云Linux服务器上操作nginx、git、JDK、Vue等，以及使用宝塔运维操作添加Html网页、部署Springboot项目/Vue项目等 Java爬虫通过Java&#43;Selenium&#43;GoogleWebDriver 模拟真人网页操作爬取花瓣网图片、bing搜索图片等 Vue实战讲解Vue3的安装、环境配置，基本语法、循环语句、生命周期、路由设置、组件、axios交互、Element-ui的使用等 Spring讲解Spring(Bean)概念、IOC、AOP、集成jdbcTemplate/redis/事务等 Spring boot框架若依RouYi Cloud专栏回顾 专栏导航描述Spring boot框架Rouyi Cloud- -rouyi-ui Node版本过大导致项目启动报错95% emitting CompressionPlugin ERROR Error: error:0308010C:digital envelope routines::unsupportedSpring boot框架Rouyi Cloud- -token源码分析 前言 上一章节讲解了Spring Cloud框架Rouyi Cloud的环境部署安装，以及安装过程中遇到的一些问题（后端问题在Springboot、微服务中都有解决方法，所以重点只提了前端的一些问题）。
今天我们来讲解下整个框架的入口，登录流程之token解析。
系统罗列 今天只展示登录鉴权这一块，我们需要用到的系统模块如下：
用户访问的Web前端系统：rouyi-ui网关系统：rouyi-gateway授权业务系统：rouyi-auth 1、Web前端系统：rouyi-ui 在Idea里打开Terminal（中文版是终端），输入命令：
npm run dev 1.2、访问前端页面 访问前端页面，由于没有登录（token）信息，会直接跳转到登录界面。
这里没有启动后台系统，获取验证码接口失败。
1.3、解析前端登录接口 前端登录接口：login（
http://localhost/dev-api/auth/login）
验证码接口：code（
http://localhost/dev-api/code）
1.3.1、解析地址 http://localhost/dev-api/auth/login
localhost 补全：localhost:80，对应上rouyi-ui的80端口
dev-api/auth/login，我们带上问题继续看下去
1.3.2、配置路径 可以看到rouyi-ui前端系统，为不同环境配置了访问路径前缀。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-07T14:52:16+08:00">
    <meta property="article:modified_time" content="2024-04-07T14:52:16+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring boot微服务分布式框架Rouyi Cloud权限认证</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <center> 
 <p> 🌹作者主页：青花锁 🌹简介：Java领域优质创作者🏆、Java微服务架构公号作者😄</p> 
 <p> 🌹简历模板、学习资料、面试题库、技术互助</p> 
 <p> 🌹文末获取联系方式 📝</p> 
</center> 
<p><img src="https://images2.imgbox.com/bc/5d/imo3mZtn_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="_11"></a>往期热门专栏回顾</h2> 
<table><thead><tr><th align="left">专栏</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">Java项目实战</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12345409.html">介绍Java组件安装、使用；手写框架等</a></td></tr><tr><td align="left">Aws服务器实战</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12492968.html">Aws Linux服务器上操作nginx、git、JDK、Vue</a></td></tr><tr><td align="left">Java微服务实战</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12439818.html">Java 微服务实战，Spring Cloud Netflix套件、Spring Cloud Alibaba套件、Seata、gateway、shadingjdbc等实战操作 </a></td></tr><tr><td align="left">Java基础篇</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12369312.html">Java基础闲聊，已出HashMap、String、StringBuffer等源码分析，JVM分析，持续更新中 </a></td></tr><tr><td align="left">Springboot篇</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12273537.html">从创建Springboot项目，到加载数据库、静态资源、输出RestFul接口、跨越问题解决到统一返回、全局异常处理、Swagger文档 </a></td></tr><tr><td align="left">Spring MVC篇</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12295009.html">从创建Spring MVC项目，到加载数据库、静态资源、输出RestFul接口、跨越问题解决到统一返回 </a></td></tr><tr><td align="left">华为云服务器实战</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12426609.html">华为云Linux服务器上操作nginx、git、JDK、Vue等，以及使用宝塔运维操作添加Html网页、部署Springboot项目/Vue项目等 </a></td></tr><tr><td align="left">Java爬虫</td><td align="left"><a href="https://blog.csdn.net/s445320/category_8863085.html">通过Java+Selenium+GoogleWebDriver 模拟真人网页操作爬取花瓣网图片、bing搜索图片等 </a></td></tr><tr><td align="left">Vue实战</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12278346.html">讲解Vue3的安装、环境配置，基本语法、循环语句、生命周期、路由设置、组件、axios交互、Element-ui的使用等 </a></td></tr><tr><td align="left">Spring</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12283629.html">讲解Spring(Bean)概念、IOC、AOP、集成jdbcTemplate/redis/事务等 </a></td></tr></tbody></table> 
<hr> 
<h2><a id="Spring_bootRouYi_Cloud_27"></a>Spring boot框架若依RouYi Cloud专栏回顾</h2> 
<table><thead><tr><th align="left">专栏</th><th align="left">导航</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">Spring boot框架Rouyi Cloud</td><td align="left">- -</td><td align="left"><a href="https://blog.csdn.net/s445320/article/details/137263809">rouyi-ui Node版本过大导致项目启动报错95% emitting CompressionPlugin ERROR Error: error:0308010C:digital envelope routines::unsupported</a></td></tr><tr><td align="left">Spring boot框架Rouyi Cloud</td><td align="left">- -</td><td align="left"><a href="https://blog.csdn.net/s445320/article/details/137424517">token源码分析</a></td></tr></tbody></table> 
<hr> 
<h2><a id="_35"></a>前言</h2> 
<p>上一章节讲解了Spring Cloud框架Rouyi Cloud的环境部署安装，以及安装过程中遇到的一些问题（后端问题在Springboot、微服务中都有解决方法，所以重点只提了前端的一些问题）。</p> 
<p>今天我们来讲解下整个框架的入口，登录流程之token解析。<br> <img src="https://images2.imgbox.com/da/87/CwUo15S2_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_40"></a>系统罗列</h2> 
<p>今天只展示登录鉴权这一块，我们需要用到的系统模块如下：</p> 
<ul><li>用户访问的Web前端系统：rouyi-ui</li><li>网关系统：rouyi-gateway</li><li>授权业务系统：rouyi-auth</li></ul> 
<hr> 
<h2><a id="1Webrouyiui_48"></a>1、Web前端系统：rouyi-ui</h2> 
<p>在Idea里打开Terminal（中文版是终端），输入命令：</p> 
<pre><code class="prism language-shell"><span class="token function">npm</span> run dev
</code></pre> 
<p><img src="https://images2.imgbox.com/ad/72/EDmtQLO0_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="12_54"></a>1.2、访问前端页面</h3> 
<p>访问前端页面，由于没有登录（token）信息，会直接跳转到登录界面。<br> 这里没有启动后台系统，获取验证码接口失败。<br> <img src="https://images2.imgbox.com/8c/39/7p63D2gr_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="13_58"></a>1.3、解析前端登录接口</h3> 
<p>前端登录接口：login（<br> http://localhost/dev-api/auth/login）<br> 验证码接口：code（<br> http://localhost/dev-api/code）<br> <img src="https://images2.imgbox.com/31/f8/XTBrENDw_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="131_64"></a>1.3.1、解析地址</h4> 
<p>http://localhost/dev-api/auth/login<br> localhost 补全：localhost:80，对应上rouyi-ui的80端口<br> dev-api/auth/login，我们带上问题继续看下去<br> <img src="https://images2.imgbox.com/3a/03/uC0MiZe1_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="132_69"></a>1.3.2、配置路径</h4> 
<p>可以看到rouyi-ui前端系统，为不同环境配置了访问路径前缀。<br> 在dev环境中，对应的地址是：VUE_APP_BASE_API = ‘/dev-api’<br> 那么【1.3.1】的路径，就剩下/auth/login了<br> <img src="https://images2.imgbox.com/52/8c/pBlX1xPM_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2rouyigateway_75"></a>2、网关系统：rouyi-gateway</h2> 
<h3><a id="21nacos_76"></a>2.1、启动nacos</h3> 
<p>启动nacos之后(nacos需要配置数据库并启动），可以看到ruoyi-开头的很多配置项。<br> <img src="https://images2.imgbox.com/8b/d5/uGopUHW7_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/89/ac/ReHueE8d_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/19/33/Qjv3zU0A_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="22rouyigateway_81"></a>2.2、启动rouyi-gateway</h3> 
<p>启动rouyi-gateway，可以看到默认的端口是8080，正好对应上rouyi-ui上配置的默认代理。<br> <img src="https://images2.imgbox.com/f9/1c/beJZIHGF_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="23_84"></a>2.3、路径路由</h3> 
<p>可以在nacos里找到ruoyi-gateway-dev.yml文件，里面有对路由的配置。<br> routes:<br> # 认证中心<br> - id: ruoyi-auth<br> uri: lb://ruoyi-auth – 下面的路径，匹配ruoyi-auth系统<br> predicates:<br> - Path=/auth/** – 匹配前端访问的路径，凡是/auth/开头都匹配上<br> filters:<br> # 验证码处理<br> - CacheRequestFilter<br> - ValidateCodeFilter – 处理验证码<br> <img src="https://images2.imgbox.com/89/d1/FR57VKXg_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/65/35/4yEXlTJ5_o.png" alt="在这里插入图片描述"></p> 
<p>前文【1.3.2】的地址：/auth/login，正好对应ID为ruoyi-auth的路由规则，凡是/auth/开头的地址，都会路由到ruoyi-auth系统。</p> 
<h3><a id="24_101"></a>2.4、代码解析</h3> 
<h4><a id="241_102"></a>2.4.1、获取验证码</h4> 
<p>获取验证码接口：com.ruoyi.gateway.config.RouterFunctionConfiguration.routerFunction<br> 在RouterFunctionConfiguration类上有注解：@Configuration</p> 
<p>生成验证码，并最终转换成图片流输出到页面。<br> <img src="https://images2.imgbox.com/02/35/QF6npAQB_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3e/0f/mUg26O1T_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a2/c3/EwhGLCIq_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="25_111"></a>2.5、返回前端查看验证码</h3> 
<p>rouyi-gateway启动成功了，也看到了验证码的代码就在rouyi-gateway系统里，这时返回网页，可以看到验证码已经显示出来了。<br> <img src="https://images2.imgbox.com/26/e9/em4PAa2D_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="3rouyiauth_117"></a>3、授权业务系统：rouyi-auth</h2> 
<p>授权认证中心也启动成功了，我们是通过网关+nacos微服务访问，所以业务系统的端口号无所谓了。<br> <img src="https://images2.imgbox.com/87/73/btKZSlwx_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="31_121"></a>3.1、查看接口</h3> 
<p>找到类： com.ruoyi.auth.controller.TokenController<br> 里面有4个接口：登录、登出、刷新token、注册<br> <img src="https://images2.imgbox.com/2f/da/TlWYOSS4_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="311_125"></a>3.1.1、登录接口</h4> 
<p>登录接口主要做了2件事：<br> 1、校验用户名、密码是否正确；<br> 2、根据用户信息，创建token，并返回给前端<br> <img src="https://images2.imgbox.com/ec/e3/un0TJbGq_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1a/f0/fH6UBfmV_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="_134"></a>总结</h2> 
<p>其他细节就留给大家去继续探索， token这块我们就讲解到这里。</p> 
<hr> 
<center> 
 <p>资料获取，更多粉丝福利，关注下方公众号获取</p> 
 <p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/5c/b7/zvhRueZL_o.gif"></p> 
</center>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d4e3c04bcb1edc8783712696ccea3eef/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">nginx怎么设置拦截请求</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1557a33d974ea0aec4fc23e874da591b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【实测可用】Sublime Text4 4169 mac/windows 破解注册 20240417 实测可用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>