<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Golang】短链接系统 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9cc881e432596e89ea2693863ba673a1/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【Golang】短链接系统">
  <meta property="og:description" content="https://learnku.com/articles/73964
https://www.cnblogs.com/54chensongxia/p/11673522.html
https://www.cnblogs.com/Java3y/p/11976312.html
https://github.com/SnDragon/go-treasure-chest
经常在牛客上看到有短链接系统的项目
短链接是将原本冗长的URL做一次“包装”，变成一个简洁可读的URL。
为什么使用短链接 节省发送的内容
我们平时发微博或者短信是都是有最大字符限制的。如果你的一个URL太长，一个URL占用的字符数就已经超过了最大限制，根本发不出去。如果你细心观察过银行的信用卡中心给你发过来的活动短信的话，你会发现短信中的URL好多都是以短链接形式发送的。
提升用户体验
还是以上面的URL为列子。这一大串URL非常不美观，给人的感觉就是木马链接，用户可能都不会去点击。相反的，如果转换成http://url.cn/5MMEX3D，就非常易于阅读，看起来整洁干净，提高用户体验和点击率。
便于链接追踪，分析点击来源
通过短链接可以获知大部分用户的来源，和来源渠道的转化率、广告渠道的质量。通过渠道效果对比数据，更合理的进行广告投放和资源配置。
同一个页面不同的链接
每个用户需要推送带参数的唯一链接。
一定程度上保护原始网站链接
我们在玩Facebook，领英等社交时，有些需要分享一些带有我们网站链接的帖子和消息，尤其对于小白来说，如果发的内容次数过多，并且毫无互动可言或者直接被人举报多次，那么你的网址就会被社交平台标记，一旦标记，链接权重就会受影响，后面再投社交广告时就有麻烦了。
短链接生成原理 如http://url.cn/5MMEX3D这个短链接，当我们访问这个链接的时候我们先访问到url.cn对应的服务器，然后根据参数5MMEX3D找出它对应的原始连接，再重定向到这个原始链接上去。
比较著名的短链域名有腾讯的 url.cn，微博的 t.cn 等，也有很多公司提供了免费 / 收费的短链接开放 API
5MMEX3D和原始链接是如何进行映射的？
hash算法不行，这个场景是不能容许哈希碰撞的，一般不建议这么做
发号器（ID自增)-&gt;再使用62进制编码。比如将https://github.com/ZhongFuCheng3y/3y这个长链接看作是10000，然后使用进制转换工具将10000进行62进制编码得到的结果是：2Bi，那么我们就可以得到一个短链接http://url.cn/2Bi。
62进制转换是因为62进制转换后只含数字&#43;小写&#43;大写字母。而64进制转换会含有/,&#43;这样的符号（不符合正常URL的字符）
短链接系统 代码来源于https://learnku.com/articles/73964
https://github.com/SnDragon/go-treasure-chest
使用 Redis 来生成自增 id，并存储映射关系
// Storage 短链服务抽象接口 type Storage interface { Shorten(url string, expSecond int64) (string, error) // 将长链转成短链,并设置过期时间 ShortLinkInfo(sid string) (*entity.UrlDetailInfo, error) // 根据短链id获取详情 UnShorten(sid string) (string, error) // 根据短链id转成原始长链 } // RedisStorage Redis实现短链服务 type RedisStorage struct { redisCli *redis.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-31T14:24:17+08:00">
    <meta property="article:modified_time" content="2024-07-31T14:24:17+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Golang】短链接系统</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-kimbie-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>https://learnku.com/articles/73964<br> https://www.cnblogs.com/54chensongxia/p/11673522.html<br> https://www.cnblogs.com/Java3y/p/11976312.html<br> https://github.com/SnDragon/go-treasure-chest</p> 
</blockquote> 
<p>经常在牛客上看到有短链接系统的项目</p> 
<p>短链接是将原本冗长的URL做一次“包装”，变成一个简洁可读的URL。</p> 
<h2><a id="_10"></a>为什么使用短链接</h2> 
<ul><li> <p>节省发送的内容<br> 我们平时发微博或者短信是都是有最大字符限制的。如果你的一个URL太长，一个URL占用的字符数就已经超过了最大限制，根本发不出去。如果你细心观察过银行的信用卡中心给你发过来的活动短信的话，你会发现短信中的URL好多都是以短链接形式发送的。</p> </li><li> <p>提升用户体验<br> 还是以上面的URL为列子。这一大串URL非常不美观，给人的感觉就是木马链接，用户可能都不会去点击。相反的，如果转换成http://url.cn/5MMEX3D，就非常易于阅读，看起来整洁干净，提高用户体验和点击率。</p> </li><li> <p><strong>便于链接追踪，分析点击来源</strong><br> 通过短链接可以获知大部分用户的来源，和来源渠道的转化率、广告渠道的质量。通过渠道效果对比数据，更合理的进行广告投放和资源配置。</p> </li><li> <p>同一个页面不同的链接<br> 每个用户需要推送带参数的唯一链接。</p> </li><li> <p>一定程度上保护原始网站链接<br> 我们在玩Facebook，领英等社交时，有些需要分享一些带有我们网站链接的帖子和消息，尤其对于小白来说，如果发的内容次数过多，并且毫无互动可言或者直接被人举报多次，那么你的网址就会被社交平台标记，一旦标记，链接权重就会受影响，后面再投社交广告时就有麻烦了。</p> </li></ul> 
<h2><a id="_27"></a>短链接生成原理</h2> 
<p><img src="https://images2.imgbox.com/92/87/zhf3Xhd0_o.png" alt="在这里插入图片描述"></p> 
<p>如http://url.cn/5MMEX3D这个短链接，当我们访问这个链接的时候我们先访问到url.cn对应的服务器，然后根据参数5MMEX3D找出它对应的原始连接，再重定向到这个原始链接上去。</p> 
<p>比较著名的短链域名有腾讯的 url.cn，微博的 t.cn 等，也有很多公司提供了免费 / 收费的短链接开放 API</p> 
<p>5MMEX3D和原始链接是如何进行映射的？</p> 
<ul><li> <p>hash算法不行，这个场景是不能容许哈希碰撞的，一般不建议这么做</p> </li><li> <p><strong>发号器（ID自增)-&gt;再使用62进制编码</strong>。比如将https://github.com/ZhongFuCheng3y/3y这个长链接看作是10000，然后使用进制转换工具将10000进行62进制编码得到的结果是：2Bi，那么我们就可以得到一个短链接http://url.cn/2Bi。<br> 62进制转换是因为62进制转换后只含数字+小写+大写字母。而64进制转换会含有/,+这样的符号（不符合正常URL的字符）</p> </li></ul> 
<h2><a id="_41"></a>短链接系统</h2> 
<p>代码来源于https://learnku.com/articles/73964<br> https://github.com/SnDragon/go-treasure-chest</p> 
<p>使用 Redis 来生成自增 id，并存储映射关系</p> 
<pre><code class="prism language-python"><span class="token operator">//</span> Storage 短链服务抽象接口
<span class="token builtin">type</span> Storage interface <span class="token punctuation">{<!-- --></span>
 Shorten<span class="token punctuation">(</span>url string<span class="token punctuation">,</span> expSecond int64<span class="token punctuation">)</span> <span class="token punctuation">(</span>string<span class="token punctuation">,</span> error<span class="token punctuation">)</span>     <span class="token operator">//</span> 将长链转成短链<span class="token punctuation">,</span>并设置过期时间
 ShortLinkInfo<span class="token punctuation">(</span>sid string<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>entity<span class="token punctuation">.</span>UrlDetailInfo<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token operator">//</span> 根据短链<span class="token builtin">id</span>获取详情
 UnShorten<span class="token punctuation">(</span>sid string<span class="token punctuation">)</span> <span class="token punctuation">(</span>string<span class="token punctuation">,</span> error<span class="token punctuation">)</span>                    <span class="token operator">//</span> 根据短链<span class="token builtin">id</span>转成原始长链
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token operator">//</span> RedisStorage Redis实现短链服务
<span class="token builtin">type</span> RedisStorage struct <span class="token punctuation">{<!-- --></span>
    redisCli <span class="token operator">*</span>redis<span class="token punctuation">.</span>Client
<span class="token punctuation">}</span>

func <span class="token punctuation">(</span>r <span class="token operator">*</span>RedisStorage<span class="token punctuation">)</span> Shorten<span class="token punctuation">(</span>url string<span class="token punctuation">,</span> expSecond int64<span class="token punctuation">)</span> <span class="token punctuation">(</span>string<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token operator">//</span> <span class="token number">1.</span> 获取自增<span class="token builtin">id</span>
  <span class="token builtin">id</span><span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span>redisCli<span class="token punctuation">.</span>Incr<span class="token punctuation">(</span>RedisKeyUrlGlobalId<span class="token punctuation">)</span><span class="token punctuation">.</span>Result<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span>Wrap<span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">"[Shorten] incr global id err"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">//</span> <span class="token number">2.</span> 转成base62<span class="token punctuation">(</span>base64包含`<span class="token operator">+</span>`、`<span class="token operator">/</span>`字符<span class="token punctuation">,</span>对URL不友好<span class="token punctuation">)</span>
  sid <span class="token operator">:=</span> base62<span class="token punctuation">.</span>EncodeInt64<span class="token punctuation">(</span>Offset <span class="token operator">+</span> <span class="token builtin">id</span><span class="token punctuation">)</span>
  <span class="token operator">//</span> <span class="token number">3.</span> 设置短url对应的原始url
  <span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span>redisCli<span class="token punctuation">.</span>Set<span class="token punctuation">(</span>fmt<span class="token punctuation">.</span>Sprintf<span class="token punctuation">(</span>RedisKeyShortUrl<span class="token punctuation">,</span> sid<span class="token punctuation">)</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span>
  time<span class="token punctuation">.</span>Second<span class="token operator">*</span>time<span class="token punctuation">.</span>Duration<span class="token punctuation">(</span>expSecond<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Err<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span>Wrap<span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">"[Shorten] set RedisKeyShortUrl err"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">//</span> <span class="token number">4.</span> 设置详情
  urlDetail <span class="token operator">:=</span> <span class="token operator">&amp;</span>entity<span class="token punctuation">.</span>UrlDetailInfo<span class="token punctuation">{<!-- --></span>
  OriginUrl<span class="token punctuation">:</span> url<span class="token punctuation">,</span>
  CreatedAt<span class="token punctuation">:</span> time<span class="token punctuation">.</span>Now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Unix<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  ExpiredAt<span class="token punctuation">:</span> time<span class="token punctuation">.</span>Now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Unix<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> expSecond<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span>redisCli<span class="token punctuation">.</span>Set<span class="token punctuation">(</span>fmt<span class="token punctuation">.</span>Sprintf<span class="token punctuation">(</span>RedisKeyUrlDetail<span class="token punctuation">,</span> sid<span class="token punctuation">)</span><span class="token punctuation">,</span>
  encoding<span class="token punctuation">.</span>JsonMarshalString<span class="token punctuation">(</span>urlDetail<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Err<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span>Wrap<span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">"[Shorten] set RedisKeyUrlDetail err"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> config<span class="token punctuation">.</span>AppConfig<span class="token punctuation">.</span>BaseUrl <span class="token operator">+</span> sid<span class="token punctuation">,</span> nil
<span class="token punctuation">}</span>

func <span class="token punctuation">(</span>r <span class="token operator">*</span>RedisStorage<span class="token punctuation">)</span> ShortLinkInfo<span class="token punctuation">(</span>sid string<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>entity<span class="token punctuation">.</span>UrlDetailInfo<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token operator">//</span> <span class="token number">1.</span> 获取详情
  data<span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span>redisCli<span class="token punctuation">.</span>Get<span class="token punctuation">(</span>fmt<span class="token punctuation">.</span>Sprintf<span class="token punctuation">(</span>RedisKeyUrlDetail<span class="token punctuation">,</span> sid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Result<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> nil<span class="token punctuation">,</span> errors<span class="token punctuation">.</span>Wrap<span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">"[ShortLinkInfo] get url detail err"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">//</span> <span class="token number">2.</span> 反序列化
  info <span class="token operator">:=</span> <span class="token operator">&amp;</span>entity<span class="token punctuation">.</span>UrlDetailInfo<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> encoding<span class="token punctuation">.</span>JsonUnMarshalString<span class="token punctuation">(</span>data<span class="token punctuation">,</span> info<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> nil<span class="token punctuation">,</span> errors<span class="token punctuation">.</span>Wrapf<span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">"[ShortLinkInfo] JsonUnMarshalString err: %v"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">//</span> <span class="token number">3.</span> 获取计数器
  countRet<span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span>redisCli<span class="token punctuation">.</span>Get<span class="token punctuation">(</span>fmt<span class="token punctuation">.</span>Sprintf<span class="token punctuation">(</span>RedisKeyUrlCounter<span class="token punctuation">,</span> sid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Result<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">==</span> redis<span class="token punctuation">.</span>Nil <span class="token punctuation">{<!-- --></span>
  countRet <span class="token operator">=</span> <span class="token string">"0"</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> nil<span class="token punctuation">,</span> errors<span class="token punctuation">.</span>Wrapf<span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">"[ShortLinkInfo] get RedisKeyUrlCounter err, sid: %v"</span><span class="token punctuation">,</span> sid<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  info<span class="token punctuation">.</span>Counter <span class="token operator">=</span> cast<span class="token punctuation">.</span>ToInt64<span class="token punctuation">(</span>countRet<span class="token punctuation">)</span>
  <span class="token keyword">return</span> info<span class="token punctuation">,</span> nil
<span class="token punctuation">}</span>

func <span class="token punctuation">(</span>r <span class="token operator">*</span>RedisStorage<span class="token punctuation">)</span> UnShorten<span class="token punctuation">(</span>sid string<span class="token punctuation">)</span> <span class="token punctuation">(</span>string<span class="token punctuation">,</span> error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token operator">//</span> <span class="token number">1.</span> 获取对应长链
  val<span class="token punctuation">,</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span>redisCli<span class="token punctuation">.</span>Get<span class="token punctuation">(</span>fmt<span class="token punctuation">.</span>Sprintf<span class="token punctuation">(</span>RedisKeyShortUrl<span class="token punctuation">,</span> sid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Result<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">==</span> redis<span class="token punctuation">.</span>Nil <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>serrors<span class="token punctuation">.</span>StatusError<span class="token punctuation">{<!-- --></span>
  Code<span class="token punctuation">:</span> http<span class="token punctuation">.</span>StatusNotFound<span class="token punctuation">,</span>
  Err<span class="token punctuation">:</span>  fmt<span class="token punctuation">.</span>Errorf<span class="token punctuation">(</span><span class="token string">"unknown url: %v"</span><span class="token punctuation">,</span> sid<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">,</span> errors<span class="token punctuation">.</span>Wrap<span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token string">"get RedisKeyShortUrl err"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token operator">//</span> <span class="token number">2.</span> 访问计数器<span class="token operator">+</span><span class="token number">1</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> r<span class="token punctuation">.</span>redisCli<span class="token punctuation">.</span>Incr<span class="token punctuation">(</span>fmt<span class="token punctuation">.</span>Sprintf<span class="token punctuation">(</span>RedisKeyUrlCounter<span class="token punctuation">,</span> sid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Err<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> nil <span class="token punctuation">{<!-- --></span>
  <span class="token operator">//</span> 只影响统计，不影响主流程，打印错误日志即可
  log<span class="token punctuation">.</span>Printf<span class="token punctuation">(</span><span class="token string">"[UnShorten]Incr RedisKeyUrlCounter err, sid: %v\n"</span><span class="token punctuation">,</span> sid<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> val<span class="token punctuation">,</span> nil
<span class="token punctuation">}</span>
</code></pre> 
<p>假设短链域名为 myurl.cn, 配置 host</p> 
<pre><code class="prism language-python"><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> myurl<span class="token punctuation">.</span>cn
</code></pre> 
<p>修改 configs/shorturl/app.yaml 的配置</p> 
<pre><code class="prism language-python">base_url<span class="token punctuation">:</span> http<span class="token punctuation">:</span><span class="token operator">//</span>myurl<span class="token punctuation">.</span>cn<span class="token operator">/</span>
redis_config<span class="token punctuation">:</span>
 db_host<span class="token punctuation">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> db_port<span class="token punctuation">:</span> <span class="token number">6379</span> db_passwd<span class="token punctuation">:</span> db<span class="token punctuation">:</span> <span class="token number">0</span>
</code></pre> 
<p>进入项目根目录启动服务</p> 
<pre><code class="prism language-python">make run_short_url
go build <span class="token operator">-</span>o build<span class="token operator">/</span>shorturl <span class="token punctuation">.</span><span class="token operator">/</span>cmd<span class="token operator">/</span>shorturl  <span class="token operator">&amp;</span><span class="token operator">&amp;</span> <span class="token punctuation">.</span><span class="token operator">/</span>build<span class="token operator">/</span>shorturl

</code></pre> 
<p>测试</p> 
<pre><code class="prism language-python">curl <span class="token operator">-</span>X POST \
  http<span class="token punctuation">:</span><span class="token operator">//</span>myurl<span class="token punctuation">.</span>cn<span class="token operator">/</span>api<span class="token operator">/</span>shorten \
  <span class="token operator">-</span>H <span class="token string">'cache-control: no-cache'</span> \
  <span class="token operator">-</span>H <span class="token string">'content-type: application/json'</span> \
  <span class="token operator">-</span>d <span class="token string">'{"url":"https://www.baidu.com?name=SnDragon","expire_seconds":100}'</span>


返回
<span class="token punctuation">{<!-- --></span>
    <span class="token string">"code"</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string">"msg"</span><span class="token punctuation">:</span> <span class="token string">"ok"</span><span class="token punctuation">,</span>
    <span class="token string">"short_url"</span><span class="token punctuation">:</span> <span class="token string">"http://myurl.cn/4C99"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>浏览器访问http://myurl.cn/4C99重定向到baidu</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/87259137558fa956b9d7e847aa73b3df/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【数学建模】【优化算法】：【MATLAB】从【一维搜索】到】非线性方程】求解的综合解析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dab0dd8a39163ee12c385e21aeb8f79e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">观潮.银发经济文娱旅游教育全国创始人闭门会【杭州站】成功举办</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>