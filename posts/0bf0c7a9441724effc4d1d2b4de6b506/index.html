<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Faster-Whisper 实时识别电脑语音转文本 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/0bf0c7a9441724effc4d1d2b4de6b506/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Faster-Whisper 实时识别电脑语音转文本">
  <meta property="og:description" content="Faster-Whisper 实时识别电脑语音转文本 前言项目搭建环境安装Faster-Whisper下载模型编写测试代码运行测试代码实时转写脚本实时转写WebSocket服务器模式 参考 前言 以前做的智能对话软件接的Baidu API，想换成本地的，就搭一套Faster-Whisper吧。
下面是B站视频实时转写的截图
项目 搭建环境 所需要的CUDANN已经装好了，如果装的是12.2应该是包含cuBLAS了
没装的，可以从下面链接下载装一下，文末的参考视频中也有讲解
https://github.com/Purfview/whisper-standalone-win/releases/tag/libs
Ancanda的运行环境去Clone一下之前配好的环境，用之前BertVits的即可
安装Faster-Whisper 输入即可安装
pip install faster-whisper 下载模型 https://huggingface.co/Systran/faster-whisper-large-v3
下载完放到代码旁边就可以了
编写测试代码 # local_files_only=True 表示加载本地模型 # model_size_or_path=path 指定加载模型路径 # device=&#34;cuda&#34; 指定使用cuda # compute_type=&#34;int8_float16&#34; 量化为8位 # language=&#34;zh&#34; 指定音频语言 # vad_filter=True 开启vad # vad_parameters=dict(min_silence_duration_ms=1000) 设置vad参数 from faster_whisper import WhisperModel model_size = &#34;large-v3&#34; path = r&#34;D:\Project\Python_Project\FasterWhisper\large-v3&#34; # Run on GPU with FP16 model = WhisperModel(model_size_or_path=path, device=&#34;cuda&#34;, local_files_only=True) # or run on GPU with INT8 # model = WhisperModel(model_size, device=&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-03T20:56:08+08:00">
    <meta property="article:modified_time" content="2024-02-03T20:56:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Faster-Whisper 实时识别电脑语音转文本</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Faster-Whisper 实时识别电脑语音转文本</h4> 
 <ul><li><a href="#_1" rel="nofollow">前言</a></li><li><a href="#_6" rel="nofollow">项目</a></li><li><ul><li><a href="#_7" rel="nofollow">搭建环境</a></li><li><a href="#FasterWhisper_16" rel="nofollow">安装Faster-Whisper</a></li><li><a href="#_21" rel="nofollow">下载模型</a></li><li><a href="#_26" rel="nofollow">编写测试代码</a></li><li><a href="#_59" rel="nofollow">运行测试代码</a></li><li><a href="#_64" rel="nofollow">实时转写脚本</a></li><li><a href="#WebSocket_190" rel="nofollow">实时转写WebSocket服务器模式</a></li></ul> 
  </li><li><a href="#_361" rel="nofollow">参考</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>前言</h2> 
<p>以前做的智能对话软件接的Baidu API，想换成本地的，就搭一套Faster-Whisper吧。<br> 下面是B站视频实时转写的截图<br> <img src="https://images2.imgbox.com/32/7b/oyyCu0cl_o.png" alt="效果图"></p> 
<h2><a id="_6"></a>项目</h2> 
<h3><a id="_7"></a>搭建环境</h3> 
<p>所需要的CUDANN已经装好了，如果装的是12.2应该是包含cuBLAS了<br> 没装的，可以从下面链接下载装一下，文末的参考视频中也有讲解<br> <a href="https://github.com/Purfview/whisper-standalone-win/releases/tag/libs">https://github.com/Purfview/whisper-standalone-win/releases/tag/libs</a></p> 
<p><img src="https://images2.imgbox.com/0c/0f/81n8Ob0r_o.png" alt="配置好的CUDANN"></p> 
<p><code>Ancanda</code>的运行环境去<code>Clone</code>一下之前配好的环境，用之前BertVits的即可</p> 
<h3><a id="FasterWhisper_16"></a>安装Faster-Whisper</h3> 
<p>输入即可安装</p> 
<pre><code>pip install faster-whisper
</code></pre> 
<h3><a id="_21"></a>下载模型</h3> 
<p><a href="https://huggingface.co/Systran/faster-whisper-large-v3" rel="nofollow">https://huggingface.co/Systran/faster-whisper-large-v3</a><br> 下载完放到代码旁边就可以了<br> <img src="https://images2.imgbox.com/d6/e3/1lPTseFh_o.png" alt="模型放代码同文件夹"></p> 
<h3><a id="_26"></a>编写测试代码</h3> 
<p><img src="https://images2.imgbox.com/a5/6e/anNK027r_o.png" alt="模型放这里"></p> 
<pre><code class="prism language-python"><span class="token comment"># local_files_only=True 表示加载本地模型</span>
<span class="token comment"># model_size_or_path=path 指定加载模型路径</span>
<span class="token comment"># device="cuda" 指定使用cuda</span>
<span class="token comment"># compute_type="int8_float16" 量化为8位</span>
<span class="token comment"># language="zh" 指定音频语言</span>
<span class="token comment"># vad_filter=True 开启vad</span>
<span class="token comment"># vad_parameters=dict(min_silence_duration_ms=1000) 设置vad参数</span>
<span class="token keyword">from</span> faster_whisper <span class="token keyword">import</span> WhisperModel

model_size <span class="token operator">=</span> <span class="token string">"large-v3"</span>
path <span class="token operator">=</span> <span class="token string">r"D:\Project\Python_Project\FasterWhisper\large-v3"</span>

<span class="token comment"># Run on GPU with FP16</span>
model <span class="token operator">=</span> WhisperModel<span class="token punctuation">(</span>model_size_or_path<span class="token operator">=</span>path<span class="token punctuation">,</span> device<span class="token operator">=</span><span class="token string">"cuda"</span><span class="token punctuation">,</span> local_files_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
 
<span class="token comment"># or run on GPU with INT8</span>
<span class="token comment"># model = WhisperModel(model_size, device="cuda", compute_type="int8_float16")</span>
<span class="token comment"># or run on CPU with INT8</span>
<span class="token comment"># model = WhisperModel(model_size, device="cpu", compute_type="int8")</span>

segments<span class="token punctuation">,</span> info <span class="token operator">=</span> model<span class="token punctuation">.</span>transcribe<span class="token punctuation">(</span><span class="token string">"audio.wav"</span><span class="token punctuation">,</span> beam_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> language<span class="token operator">=</span><span class="token string">"zh"</span><span class="token punctuation">,</span> vad_filter<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> vad_parameters<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>min_silence_duration_ms<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Detected language '%s' with probability %f"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>info<span class="token punctuation">.</span>language<span class="token punctuation">,</span> info<span class="token punctuation">.</span>language_probability<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> segment <span class="token keyword">in</span> segments<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[%.2fs -&gt; %.2fs] %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>segment<span class="token punctuation">.</span>start<span class="token punctuation">,</span> segment<span class="token punctuation">.</span>end<span class="token punctuation">,</span> segment<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>


</code></pre> 
<h3><a id="_59"></a>运行测试代码</h3> 
<p>找个音频放入文件夹内，输入<code>python main.py</code>即可运行！<br> 可以看到<s>正确</s>（不太正确）的识别出了音频说了什么。<br> <img src="https://images2.imgbox.com/6e/52/HIDvlceW_o.png" alt="运行效果"></p> 
<h3><a id="_64"></a>实时转写脚本</h3> 
<p>新建一个脚本<code>transper.py</code><br> 运行即可</p> 
<blockquote> 
 <p>此处特别感谢开源项目<br> <a href="https://github.com/MyloBishop/transper">https://github.com/MyloBishop/transper</a></p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> time
<span class="token keyword">import</span> wave
<span class="token keyword">import</span> tempfile
<span class="token keyword">import</span> threading

<span class="token keyword">import</span> torch
<span class="token keyword">import</span> pyaudiowpatch <span class="token keyword">as</span> pyaudio
<span class="token keyword">from</span> faster_whisper <span class="token keyword">import</span> WhisperModel <span class="token keyword">as</span> whisper

<span class="token comment"># A bigger audio buffer gives better accuracy</span>
<span class="token comment"># but also increases latency in response.</span>
<span class="token comment"># 表示音频缓冲时间的常量</span>
AUDIO_BUFFER <span class="token operator">=</span> <span class="token number">5</span>

<span class="token comment"># 此函数使用 PyAudio 库录制音频，并将其保存为一个临时的 WAV 文件。</span>
<span class="token comment"># 使用 pyaudio.PyAudio 实例创建一个音频流，通过指定回调函数 callback 来实时写入音频数据到 WAV 文件。</span>
<span class="token comment"># time.sleep(AUDIO_BUFFER) 会阻塞执行，确保录制足够的音频时间。</span>
<span class="token comment"># 最后，函数返回保存的 WAV 文件的文件名。</span>
<span class="token keyword">def</span> <span class="token function">record_audio</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Record audio from output device and save to temporary WAV file."""</span>
    <span class="token keyword">with</span> tempfile<span class="token punctuation">.</span>NamedTemporaryFile<span class="token punctuation">(</span>suffix<span class="token operator">=</span><span class="token string">".wav"</span><span class="token punctuation">,</span> delete<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        filename <span class="token operator">=</span> f<span class="token punctuation">.</span>name
        wave_file <span class="token operator">=</span> wave<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span>
        wave_file<span class="token punctuation">.</span>setnchannels<span class="token punctuation">(</span>device<span class="token punctuation">[</span><span class="token string">"maxInputChannels"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        wave_file<span class="token punctuation">.</span>setsampwidth<span class="token punctuation">(</span>pyaudio<span class="token punctuation">.</span>get_sample_size<span class="token punctuation">(</span>pyaudio<span class="token punctuation">.</span>paInt16<span class="token punctuation">)</span><span class="token punctuation">)</span>
        wave_file<span class="token punctuation">.</span>setframerate<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>device<span class="token punctuation">[</span><span class="token string">"defaultSampleRate"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">def</span> <span class="token function">callback</span><span class="token punctuation">(</span>in_data<span class="token punctuation">,</span> frame_count<span class="token punctuation">,</span> time_info<span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">"""Write frames and return PA flag"""</span>
            wave_file<span class="token punctuation">.</span>writeframes<span class="token punctuation">(</span>in_data<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>in_data<span class="token punctuation">,</span> pyaudio<span class="token punctuation">.</span>paContinue<span class="token punctuation">)</span>

        stream <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>
            <span class="token builtin">format</span><span class="token operator">=</span>pyaudio<span class="token punctuation">.</span>paInt16<span class="token punctuation">,</span>
            channels<span class="token operator">=</span>device<span class="token punctuation">[</span><span class="token string">"maxInputChannels"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            rate<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>device<span class="token punctuation">[</span><span class="token string">"defaultSampleRate"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            frames_per_buffer<span class="token operator">=</span>pyaudio<span class="token punctuation">.</span>get_sample_size<span class="token punctuation">(</span>pyaudio<span class="token punctuation">.</span>paInt16<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token builtin">input</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
            input_device_index<span class="token operator">=</span>device<span class="token punctuation">[</span><span class="token string">"index"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            stream_callback<span class="token operator">=</span>callback<span class="token punctuation">,</span>
        <span class="token punctuation">)</span>

        <span class="token keyword">try</span><span class="token punctuation">:</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>AUDIO_BUFFER<span class="token punctuation">)</span>  <span class="token comment"># Blocking execution while playing</span>
        <span class="token keyword">finally</span><span class="token punctuation">:</span>
            stream<span class="token punctuation">.</span>stop_stream<span class="token punctuation">(</span><span class="token punctuation">)</span>
            stream<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            wave_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># print(f"{filename} saved.")</span>
    <span class="token keyword">return</span> filename

<span class="token comment"># 此函数使用 Whisper 模型对录制的音频进行转录，并输出转录结果。</span>
<span class="token keyword">def</span> <span class="token function">whisper_audio</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Transcribe audio buffer and display."""</span>
    <span class="token comment"># segments, info = model.transcribe(filename, beam_size=5, task="translate", language="zh", vad_filter=True, vad_parameters=dict(min_silence_duration_ms=1000))</span>
    segments<span class="token punctuation">,</span> info <span class="token operator">=</span> model<span class="token punctuation">.</span>transcribe<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> beam_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> language<span class="token operator">=</span><span class="token string">"zh"</span><span class="token punctuation">,</span> vad_filter<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> vad_parameters<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>min_silence_duration_ms<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
    <span class="token comment"># print(f"{filename} removed.")</span>
    <span class="token keyword">for</span> segment <span class="token keyword">in</span> segments<span class="token punctuation">:</span>
        <span class="token comment"># print(f"[{segment.start:.2f} -&gt; {segment.end:.2f}] {segment.text.strip()}")</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[%.2fs -&gt; %.2fs] %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>segment<span class="token punctuation">.</span>start<span class="token punctuation">,</span> segment<span class="token punctuation">.</span>end<span class="token punctuation">,</span> segment<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># main 函数是整个脚本的主控制函数。</span>
<span class="token comment"># 加载 Whisper 模型，选择合适的计算设备（GPU 或 CPU）。</span>
<span class="token comment"># 获取默认的 WASAPI 输出设备信息，并选择默认的扬声器（输出设备）。</span>
<span class="token comment"># 使用 PyAudio 开始录制音频，并通过多线程运行 whisper_audio 函数进行音频转录。</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Load model record audio and transcribe from default output device."""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading model..."</span><span class="token punctuation">)</span>
    device <span class="token operator">=</span> <span class="token string">"cuda"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Using </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>device<span class="token punctuation">}</span></span><span class="token string"> device."</span></span><span class="token punctuation">)</span>
    <span class="token comment"># model = whisper("large-v3", device=device, compute_type="float16")</span>
    model <span class="token operator">=</span> whisper<span class="token punctuation">(</span><span class="token string">"large-v3"</span><span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">,</span> local_files_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Model loaded."</span><span class="token punctuation">)</span>

    <span class="token keyword">with</span> pyaudio<span class="token punctuation">.</span>PyAudio<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pya<span class="token punctuation">:</span>
        <span class="token comment"># Create PyAudio instance via context manager.</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># Get default WASAPI info</span>
            wasapi_info <span class="token operator">=</span> pya<span class="token punctuation">.</span>get_host_api_info_by_type<span class="token punctuation">(</span>pyaudio<span class="token punctuation">.</span>paWASAPI<span class="token punctuation">)</span>
        <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Looks like WASAPI is not available on the system. Exiting..."</span><span class="token punctuation">)</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Get default WASAPI speakers</span>
        default_speakers <span class="token operator">=</span> pya<span class="token punctuation">.</span>get_device_info_by_index<span class="token punctuation">(</span>
            wasapi_info<span class="token punctuation">[</span><span class="token string">"defaultOutputDevice"</span><span class="token punctuation">]</span>
        <span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token keyword">not</span> default_speakers<span class="token punctuation">[</span><span class="token string">"isLoopbackDevice"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> loopback <span class="token keyword">in</span> pya<span class="token punctuation">.</span>get_loopback_device_info_generator<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># Try to find loopback device with same name(and [Loopback suffix]).</span>
                <span class="token comment"># Unfortunately, this is the most adequate way at the moment.</span>
                <span class="token keyword">if</span> default_speakers<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token keyword">in</span> loopback<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    default_speakers <span class="token operator">=</span> loopback
                    <span class="token keyword">break</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>
                    <span class="token triple-quoted-string string">"""
                    Default loopback output device not found.
                    Run `python -m pyaudiowpatch` to check available devices.
                    Exiting...
                    """</span>
                <span class="token punctuation">)</span>
                sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>
            <span class="token string-interpolation"><span class="token string">f"Recording from: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>default_speakers<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>default_speakers<span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">)\n"</span></span>
        <span class="token punctuation">)</span>

        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            filename <span class="token operator">=</span> record_audio<span class="token punctuation">(</span>pya<span class="token punctuation">,</span> default_speakers<span class="token punctuation">)</span>
            thread <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>whisper_audio<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">)</span>
            thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="WebSocket_190"></a>实时转写WebSocket服务器模式</h3> 
<p>在最新<a href="https://bard.google.com/" rel="nofollow">Google Bard</a>的帮助下，从同步多线程单机版变成了异步WebSocket服务器版本，Unity可以链接并监听实时转写的数据了（<s>写这篇文章时是冬季，ChatGPT实测已经开始休眠状态了</s>）</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> asyncio
<span class="token keyword">import</span> os
<span class="token keyword">import</span> wave
<span class="token keyword">import</span> tempfile
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> pyaudiowpatch <span class="token keyword">as</span> pyaudio
<span class="token keyword">from</span> faster_whisper <span class="token keyword">import</span> WhisperModel <span class="token keyword">as</span> whisper
<span class="token keyword">import</span> websockets
<span class="token keyword">import</span> json

<span class="token comment"># Audio buffer time</span>
AUDIO_BUFFER <span class="token operator">=</span> <span class="token number">5</span>

<span class="token comment"># Dictionary to store WebSocket connections</span>
clients <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token comment"># handle client</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">handle_client</span><span class="token punctuation">(</span>websocket<span class="token punctuation">)</span><span class="token punctuation">:</span>
   client_id <span class="token operator">=</span> <span class="token builtin">id</span><span class="token punctuation">(</span>websocket<span class="token punctuation">)</span>  <span class="token comment"># Using the WebSocket object's ID as a unique identifier</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Client connected from </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>websocket<span class="token punctuation">.</span>remote_address<span class="token punctuation">}</span></span><span class="token string"> with ID </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>client_id<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
   clients<span class="token punctuation">[</span>client_id<span class="token punctuation">]</span> <span class="token operator">=</span> websocket
   <span class="token keyword">try</span><span class="token punctuation">:</span>
      <span class="token comment"># print(f"Client connected from {websocket.remote_address}")</span>
      <span class="token comment"># Wait for messages from the client</span>
      <span class="token keyword">async</span> <span class="token keyword">for</span> message <span class="token keyword">in</span> websocket<span class="token punctuation">:</span>
         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Received message from client </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>client_id<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>message<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
         <span class="token comment"># Process the message (you can replace this with your logic)</span>
         response <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"Server received: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>message<span class="token punctuation">}</span></span><span class="token string">"</span></span>
         <span class="token comment"># Send a response back to the client</span>
         <span class="token keyword">await</span> websocket<span class="token punctuation">.</span>send<span class="token punctuation">(</span>response<span class="token punctuation">)</span>
         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Sent response to client </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>client_id<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>response<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

   <span class="token keyword">except</span> websockets<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>ConnectionClosedError<span class="token punctuation">:</span>
      <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Connection with </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>websocket<span class="token punctuation">.</span>remote_address<span class="token punctuation">}</span></span><span class="token string"> closed."</span></span><span class="token punctuation">)</span>
   <span class="token keyword">finally</span><span class="token punctuation">:</span>
      <span class="token comment"># Remove the WebSocket connection when the client disconnects</span>
      <span class="token keyword">del</span> clients<span class="token punctuation">[</span>client_id<span class="token punctuation">]</span>

<span class="token comment"># Send a message to all connected clients</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">send_all_clients</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">if</span> clients<span class="token operator">==</span><span class="token boolean">None</span> <span class="token keyword">or</span> clients<span class="token operator">==</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">:</span> 
      <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"No clients connected."</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>
   <span class="token keyword">for</span> client_id<span class="token punctuation">,</span> websocket <span class="token keyword">in</span> clients<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">try</span><span class="token punctuation">:</span>
         <span class="token keyword">await</span> websocket<span class="token punctuation">.</span>send<span class="token punctuation">(</span>message<span class="token punctuation">)</span>
         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Sent message to client </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>client_id<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>message<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
      <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error sending message to client </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>client_id<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># Send a message to a specific client identified by client_id</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">send_message</span><span class="token punctuation">(</span>client_id<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">if</span> client_id <span class="token keyword">in</span> clients<span class="token punctuation">:</span>
      websocket <span class="token operator">=</span> clients<span class="token punctuation">[</span>client_id<span class="token punctuation">]</span>
      <span class="token keyword">await</span> websocket<span class="token punctuation">.</span>send<span class="token punctuation">(</span>message<span class="token punctuation">)</span>
      <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Sent message to client </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>client_id<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>message<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
   <span class="token keyword">else</span><span class="token punctuation">:</span>
      <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Client with ID </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>client_id<span class="token punctuation">}</span></span><span class="token string"> not found."</span></span><span class="token punctuation">)</span>


<span class="token comment"># Start the server</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main_server</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   server <span class="token operator">=</span> <span class="token keyword">await</span> websockets<span class="token punctuation">.</span>serve<span class="token punctuation">(</span>handle_client<span class="token punctuation">,</span> <span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">8765</span><span class="token punctuation">)</span>
   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"WebSocket server started. Listening on ws://localhost:8765"</span><span class="token punctuation">)</span>

   <span class="token keyword">await</span> server<span class="token punctuation">.</span>wait_closed<span class="token punctuation">(</span><span class="token punctuation">)</span>



<span class="token comment">#This function records audio using the PyAudio library and saves it as a temporary WAV file.</span>
<span class="token comment">#Use pyaudio PyAudio instance creates an audio stream and writes audio data in real-time to a WAV file by specifying the callback function callback.</span>
<span class="token comment">#Due to the use of the asyncio library, it is no longer necessary to use time. sleep() to block execution, but instead to use asyncio. sleep() to wait asynchronously.</span>
<span class="token comment">#Finally, the function returns the file name of the saved WAV file.</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">record_audio</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> device<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Record audio from output device and save to temporary WAV file."""</span>
    <span class="token keyword">with</span> tempfile<span class="token punctuation">.</span>NamedTemporaryFile<span class="token punctuation">(</span>suffix<span class="token operator">=</span><span class="token string">".wav"</span><span class="token punctuation">,</span> delete<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        filename <span class="token operator">=</span> f<span class="token punctuation">.</span>name
        wave_file <span class="token operator">=</span> wave<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span>
        wave_file<span class="token punctuation">.</span>setnchannels<span class="token punctuation">(</span>device<span class="token punctuation">[</span><span class="token string">"maxInputChannels"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        wave_file<span class="token punctuation">.</span>setsampwidth<span class="token punctuation">(</span>pyaudio<span class="token punctuation">.</span>get_sample_size<span class="token punctuation">(</span>pyaudio<span class="token punctuation">.</span>paInt16<span class="token punctuation">)</span><span class="token punctuation">)</span>
        wave_file<span class="token punctuation">.</span>setframerate<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>device<span class="token punctuation">[</span><span class="token string">"defaultSampleRate"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">def</span> <span class="token function">callback</span><span class="token punctuation">(</span>in_data<span class="token punctuation">,</span> frame_count<span class="token punctuation">,</span> time_info<span class="token punctuation">,</span> status<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">"""Write frames and return PA flag"""</span>
            wave_file<span class="token punctuation">.</span>writeframes<span class="token punctuation">(</span>in_data<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>in_data<span class="token punctuation">,</span> pyaudio<span class="token punctuation">.</span>paContinue<span class="token punctuation">)</span>

        stream <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>
            <span class="token builtin">format</span><span class="token operator">=</span>pyaudio<span class="token punctuation">.</span>paInt16<span class="token punctuation">,</span>
            channels<span class="token operator">=</span>device<span class="token punctuation">[</span><span class="token string">"maxInputChannels"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            rate<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>device<span class="token punctuation">[</span><span class="token string">"defaultSampleRate"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            frames_per_buffer<span class="token operator">=</span>pyaudio<span class="token punctuation">.</span>get_sample_size<span class="token punctuation">(</span>pyaudio<span class="token punctuation">.</span>paInt16<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token builtin">input</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
            input_device_index<span class="token operator">=</span>device<span class="token punctuation">[</span><span class="token string">"index"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            stream_callback<span class="token operator">=</span>callback<span class="token punctuation">,</span>
        <span class="token punctuation">)</span>

        <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>AUDIO_BUFFER<span class="token punctuation">)</span>

        stream<span class="token punctuation">.</span>stop_stream<span class="token punctuation">(</span><span class="token punctuation">)</span>
        stream<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        wave_file<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># print(f"{filename} saved.")</span>
    <span class="token keyword">return</span> filename
 
<span class="token comment"># SegmentData class</span>
<span class="token keyword">class</span> <span class="token class-name">SegmentData</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">,</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 实例属性</span>
        self<span class="token punctuation">.</span>start <span class="token operator">=</span> start
        self<span class="token punctuation">.</span>end <span class="token operator">=</span> end
        self<span class="token punctuation">.</span>text <span class="token operator">=</span> text

    <span class="token keyword">def</span> <span class="token function">__dict__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"start"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>start<span class="token punctuation">,</span> <span class="token string">"end"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>end<span class="token punctuation">,</span> <span class="token string">"text"</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>text<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">convert_to_unity_data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 参数 data 为字典列表</span>
    unity_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        segment_data <span class="token operator">=</span> SegmentData<span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token string">"start"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> item<span class="token punctuation">[</span><span class="token string">"end"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> item<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        unity_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>segment_data<span class="token punctuation">)</span>
    <span class="token keyword">return</span> unity_data


<span class="token comment"># This function transcribes the recorded audio using the Whisper model and outputs the transcription result.</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">whisper_audio</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Transcribe audio buffer and display."""</span>
    segments<span class="token punctuation">,</span> info <span class="token operator">=</span> model<span class="token punctuation">.</span>transcribe<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> beam_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> language<span class="token operator">=</span><span class="token string">"zh"</span><span class="token punctuation">,</span> vad_filter<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> vad_parameters<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>min_silence_duration_ms<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
    <span class="token comment"># print(f"{filename} removed.")</span>
    <span class="token keyword">if</span> segments<span class="token punctuation">:</span>
        segments_dict_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"start"</span><span class="token punctuation">:</span> segment<span class="token punctuation">.</span>start<span class="token punctuation">,</span> <span class="token string">"end"</span><span class="token punctuation">:</span> segment<span class="token punctuation">.</span>end<span class="token punctuation">,</span> <span class="token string">"text"</span><span class="token punctuation">:</span> segment<span class="token punctuation">.</span>text<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token keyword">for</span> segment <span class="token keyword">in</span> segments<span class="token punctuation">]</span>
        json_transcriptions<span class="token operator">=</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>segments_dict_list<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Transcription: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>json_transcriptions<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">await</span> send_all_clients<span class="token punctuation">(</span>json_transcriptions<span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error sending message: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>



<span class="token comment"># Start recording audio using PyAudio and concurrently run the whisper_audio function for audio transcription using asyncio.gather.</span>
<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Load model record audio and transcribe from default output device."""</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading model..."</span><span class="token punctuation">)</span>
    device <span class="token operator">=</span> <span class="token string">"cuda"</span> <span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token string">"cpu"</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Using </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>device<span class="token punctuation">}</span></span><span class="token string"> device."</span></span><span class="token punctuation">)</span>
    model <span class="token operator">=</span> whisper<span class="token punctuation">(</span><span class="token string">"large-v3"</span><span class="token punctuation">,</span> device<span class="token operator">=</span>device<span class="token punctuation">,</span> local_files_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>compute_type<span class="token operator">=</span><span class="token string">"int8_float16"</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Model loaded."</span><span class="token punctuation">)</span>

    <span class="token keyword">with</span> pyaudio<span class="token punctuation">.</span>PyAudio<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> pya<span class="token punctuation">:</span>
        <span class="token comment"># Get microphone device information (assuming you want to select the first microphone device)</span>
        microphone_index <span class="token operator">=</span> <span class="token number">0</span>
        microphone_info <span class="token operator">=</span> pya<span class="token punctuation">.</span>get_device_info_by_index<span class="token punctuation">(</span>microphone_index<span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            filename <span class="token operator">=</span> <span class="token keyword">await</span> record_audio<span class="token punctuation">(</span>pya<span class="token punctuation">,</span> microphone_info<span class="token punctuation">)</span>
            <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>whisper_audio<span class="token punctuation">(</span>filename<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">appmain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> main_server<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Gather coroutines here</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>appmain<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Pass the main coroutine to asyncio.run()</span>
</code></pre> 
<h2><a id="_361"></a>参考</h2> 
<p><a href="https://github.com/SYSTRAN/faster-whisper">faster-whisper</a><br> <a href="https://github.com/MyloBishop/transper">MyloBishop/transper</a><br> <a href="https://bard.google.com/" rel="nofollow">Google Bard</a><br> <a href="https://www.bilibili.com/video/BV1594y1P7UV" rel="nofollow">基于faster_whisper的实时语音识别</a><br> <a href="https://www.bilibili.com/video/BV1fQ4y1j7wb" rel="nofollow">基于faster whisper实现实时语音识别项目语音转文本python编程实现</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/95eecafd96a678f34668e2e795e9f9f3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何在 Mac 上重置网络设置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/95055484887e8cb20792530d3ee0d5f9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Mac本地部署大模型体验AIGC能力</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>