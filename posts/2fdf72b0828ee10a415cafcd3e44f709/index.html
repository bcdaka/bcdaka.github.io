<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【机器学习】关联规则挖掘算法 &#43; 三大案例实战 &#43; Apriori算法 &#43; Python代码实现 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/2fdf72b0828ee10a415cafcd3e44f709/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【机器学习】关联规则挖掘算法 &#43; 三大案例实战 &#43; Apriori算法 &#43; Python代码实现">
  <meta property="og:description" content="文章目录 一、关联规则概述1.1 关联规则引入1.2 关联规则相关概念介绍1.2.1 样本、事务、项集、规则1.2.2 支持度、置信度1.2.3 提升度1.2.4 所有指标的公式 二、Python实战关联规则2.1 使用 mlxtend 工具包得出频繁项集与规则2.1.1 安装 mlxtend 工具包2.1.2 引入相关库2.1.3 自定义一份数据集2.1.4 得到频繁项集2.1.5 计算规则2.1.6 挑选有用的规则进行分析 2.2 数据集制作2.3 电影数据集关联分析2.3.1 数据集获取2.3.2 引入相关库2.3.3 读取数据集2.3.4 标准化数据集2.3.5 获取频繁项集2.3.6 计算规则2.3.7 结果分析 三、Apriori 算法3.1 算法介绍3.2 Python代码实现 一、关联规则概述 1.1 关联规则引入 下面用一个故事来引出关联规则：
1.2 关联规则相关概念介绍 1.2.1 样本、事务、项集、规则 关联规则中的数据集结构一般如下所示：
关于项集（多个项组成的集合）：
{ 牛奶 } 是 1-项集{ 牛奶，果冻 } 是 2-项集；{ 啤酒，面包，牛奶 } 是 3-项集 X==&gt;Y含义（规则）：
X和Y是项集X称为规则前项Y称为规则后项 事务：即样本，一个样本称为一个事务。事务仅包含其涉及到的项目，而不包含项目的具体信息
在超级市场的关联规则挖掘问题中事务是顾客一次购物所购买的商品，但事务中并不包括这些商品的具体信息，如商品的数量、价格等 1.2.2 支持度、置信度 支持度(support)：一个项集或者规则在所有事务中出现的频率， σ ( X ) \sigma(\mathrm{X}) σ(X)：表示项集X的支持度计数">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-05-29T23:22:51+08:00">
    <meta property="article:modified_time" content="2023-05-29T23:22:51+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【机器学习】关联规则挖掘算法 &#43; 三大案例实战 &#43; Apriori算法 &#43; Python代码实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_3" rel="nofollow">一、关联规则概述</a></li><li><ul><li><a href="#11__4" rel="nofollow">1.1 关联规则引入</a></li><li><a href="#12__9" rel="nofollow">1.2 关联规则相关概念介绍</a></li><li><ul><li><a href="#121__10" rel="nofollow">1.2.1 样本、事务、项集、规则</a></li><li><a href="#122__28" rel="nofollow">1.2.2 支持度、置信度</a></li><li><a href="#123__60" rel="nofollow">1.2.3 提升度</a></li><li><a href="#124__67" rel="nofollow">1.2.4 所有指标的公式</a></li></ul> 
  </li></ul> 
  </li><li><a href="#Python_73" rel="nofollow">二、Python实战关联规则</a></li><li><ul><li><a href="#21__mlxtend__74" rel="nofollow">2.1 使用 mlxtend 工具包得出频繁项集与规则</a></li><li><ul><li><a href="#211__mlxtend__75" rel="nofollow">2.1.1 安装 mlxtend 工具包</a></li><li><a href="#212__80" rel="nofollow">2.1.2 引入相关库</a></li><li><a href="#213__89" rel="nofollow">2.1.3 自定义一份数据集</a></li><li><a href="#214__106" rel="nofollow">2.1.4 得到频繁项集</a></li><li><a href="#215__114" rel="nofollow">2.1.5 计算规则</a></li><li><a href="#216__124" rel="nofollow">2.1.6 挑选有用的规则进行分析</a></li></ul> 
   </li><li><a href="#22__135" rel="nofollow">2.2 数据集制作</a></li><li><a href="#23__218" rel="nofollow">2.3 电影数据集关联分析</a></li><li><ul><li><a href="#231__219" rel="nofollow">2.3.1 数据集获取</a></li><li><a href="#232__225" rel="nofollow">2.3.2 引入相关库</a></li><li><a href="#233__236" rel="nofollow">2.3.3 读取数据集</a></li><li><a href="#234__246" rel="nofollow">2.3.4 标准化数据集</a></li><li><a href="#235__257" rel="nofollow">2.3.5 获取频繁项集</a></li><li><a href="#236__266" rel="nofollow">2.3.6 计算规则</a></li><li><a href="#237__274" rel="nofollow">2.3.7 结果分析</a></li></ul> 
  </li></ul> 
  </li><li><a href="#Apriori__285" rel="nofollow">三、Apriori 算法</a></li><li><ul><li><a href="#31__286" rel="nofollow">3.1 算法介绍</a></li><li><a href="#32_Python_301" rel="nofollow">3.2 Python代码实现</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_3"></a>一、关联规则概述</h2> 
<h3><a id="11__4"></a>1.1 关联规则引入</h3> 
<blockquote> 
 <p>下面用一个故事来引出关联规则：</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/ea/70/gpaGaY6s_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="12__9"></a>1.2 关联规则相关概念介绍</h3> 
<h4><a id="121__10"></a>1.2.1 样本、事务、项集、规则</h4> 
<blockquote> 
 <p>关联规则中的数据集结构一般如下所示：</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/c6/27/WXnhwSQ6_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>关于项集（多个项组成的集合）：</p> 
 <ul><li>{ 牛奶 } 是 1-项集</li><li>{ 牛奶，果冻 } 是 2-项集；</li><li>{ 啤酒，面包，牛奶 } 是 3-项集</li></ul> 
</blockquote> 
<blockquote> 
 <p>X==&gt;Y含义（规则）：</p> 
 <ul><li>X和Y是项集</li><li>X称为规则前项</li><li>Y称为规则后项</li></ul> 
</blockquote> 
<blockquote> 
 <p>事务：即样本，一个样本称为一个事务。事务仅包含其涉及到的项目，而不包含项目的具体信息</p> 
 <ul><li>在超级市场的关联规则挖掘问题中事务是顾客一次购物所购买的商品，但事务中并不包括这些商品的具体信息，如商品的数量、价格等</li></ul> 
</blockquote> 
<h4><a id="122__28"></a>1.2.2 支持度、置信度</h4> 
<blockquote> 
 <p>支持度(support)：一个项集或者规则在所有事务中出现的频率，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          σ 
         
        
          ( 
         
        
          X 
         
        
          ) 
         
        
       
         \sigma(\mathrm{X}) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">σ</span><span class="mopen">(</span><span class="mord mathrm">X</span><span class="mclose">)</span></span></span></span></span>：表示项集X的支持度计数</p> 
 <ul><li>项集X的支持度：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           s 
          
         
           ( 
          
         
           X 
          
         
           ) 
          
         
           = 
          
         
           σ 
          
         
           ( 
          
         
           X 
          
         
           ) 
          
         
           ÷ 
          
         
           N 
          
         
        
          s(X)=\sigma(\mathrm{X})\div N 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">σ</span><span class="mopen">(</span><span class="mord mathrm">X</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">÷</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.109em;">N</span></span></span></span></span></li><li>规则X==&gt;Y表示物品集X对物品集Y的支持度，也就是物品集X和物品集Y同时出现的概率</li><li>假设某天共有100个顾客到商场买东西，其中30个顾客同时购买了啤酒和尿布，那么上述的关联规则的支持度就是30%</li></ul> 
</blockquote> 
<blockquote> 
 <p>置信度(confidence)：确定Y在包含X的事务中出现的频繁程度。<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          c 
         
        
          ( 
         
        
          X 
         
        
          ⟶ 
         
        
          Y 
         
        
          ) 
         
        
          = 
         
        
          σ 
         
        
          ( 
         
        
          X 
         
        
          ∪ 
         
        
          Y 
         
        
          ) 
         
        
          ÷ 
         
        
          σ 
         
        
          ( 
         
        
          X 
         
        
          ) 
         
        
       
         c(X \longrightarrow Y)=\sigma(X \cup Y) \div \sigma(X) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">c</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">⟶</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.2222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">σ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">∪</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.2222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">÷</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0359em;">σ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mclose">)</span></span></span></span></span></p> 
 <ul><li>条件概率公式：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           P 
          
         
           ( 
          
         
           Y 
          
         
           ∣ 
          
         
           X 
          
         
           ) 
          
         
           = 
          
         
           P 
          
         
           ( 
          
         
           X 
          
         
           Y 
          
         
           ) 
          
         
           ÷ 
          
         
           P 
          
         
           ( 
          
         
           X 
          
         
           ) 
          
         
        
          P(Y|X) = P(XY)\div P(X) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.2222em;">Y</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mord mathnormal" style="margin-right: 0.2222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">÷</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mclose">)</span></span></span></span></span></li><li>置信度反映了关联规则的可信度，即购买了项目集X中的商品的顾客同时也购买了Y中商品的概率</li><li>假设购买薯片的顾客中有50%也购买了可乐，则置信度为50%</li></ul> 
</blockquote> 
<p>下面举一个例子，来更深层次的理解支持度和置信度：</p> 
<p><img src="https://images2.imgbox.com/38/98/O59tqvdc_o.png" alt="在这里插入图片描述"><br> <strong>计算 A==&gt;C 的支持度和置信度</strong>：</p> 
<ul><li>支持度：即同时购买了商品A和C的顾客的比率 = <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          2 
         
        
          ÷ 
         
        
          4 
         
        
          = 
         
        
          50 
         
        
          % 
         
        
       
         2\div4=50\% 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">÷</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">4</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8056em; vertical-align: -0.0556em;"></span><span class="mord">50%</span></span></span></span></span></li><li>置信度：即在购买了商品A的顾客中，购买了商品C的比率 = <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          2 
         
        
          ÷ 
         
        
          3 
         
        
          = 
         
        
          66.7 
         
        
          % 
         
        
       
         2\div3=66.7\% 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">÷</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">3</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8056em; vertical-align: -0.0556em;"></span><span class="mord">66.7%</span></span></span></span></span></li></ul> 
<p><strong>计算 C==&gt;A 的支持度和置信度</strong>：</p> 
<ul><li>支持度：即同时购买了商品C和A的顾客的比率（其实和A==&gt;C的支持度是一样的） = <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          2 
         
        
          ÷ 
         
        
          4 
         
        
          = 
         
        
          50 
         
        
          % 
         
        
       
         2\div4=50\% 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">÷</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">4</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8056em; vertical-align: -0.0556em;"></span><span class="mord">50%</span></span></span></span></span></li><li>置信度：即在购买了商品C的顾客中，购买了商品A的比率 = <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          2 
         
        
          ÷ 
         
        
          2 
         
        
          = 
         
        
          100 
         
        
          % 
         
        
       
         2\div2=100\% 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">÷</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8056em; vertical-align: -0.0556em;"></span><span class="mord">100%</span></span></span></span></span></li></ul> 
<p><strong>我们一般可以用 <code>X==&gt;Y（支持度，置信度）</code>的格式表示规则的支持度和置信度，具体如下所示</strong>：</p> 
<ul><li>A==&gt;C（50%，66.7%）</li><li>C==&gt;A（50%，100%）</li></ul> 
<p>一般地，我们会<strong>定义最小支持度（minsupport）和最小置信度（minconfidence）</strong>，若规则X==&gt;Y的支持度分别大于等于我们定义的最小支持度和最小置信度，则称关联规则X==&gt;Y为<strong>强关联规则</strong>，否则称为<strong>弱关联规则</strong>。我们通常会把注意力放在强关联规则上。</p> 
<h4><a id="123__60"></a>1.2.3 提升度</h4> 
<blockquote> 
 <p>提升度（lift）：物品集A的出现对物品集B的出现概率发生了多大的变化</p> 
 <ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           l 
          
         
           i 
          
         
           f 
          
         
           t 
          
         
           ( 
          
         
           A 
          
         
           = 
          
         
           = 
          
         
           &gt; 
          
         
           B 
          
         
           ) 
          
         
           = 
          
         
           c 
          
         
           o 
          
         
           n 
          
         
           f 
          
         
           i 
          
         
           d 
          
         
           e 
          
         
           n 
          
         
           c 
          
         
           e 
          
         
           ( 
          
         
           A 
          
         
           = 
          
         
           = 
          
         
           &gt; 
          
         
           B 
          
         
           ) 
          
         
           ÷ 
          
         
           s 
          
         
           u 
          
         
           p 
          
         
           p 
          
         
           o 
          
         
           r 
          
         
           t 
          
         
           ( 
          
         
           B 
          
         
           ) 
          
         
           = 
          
         
           P 
          
         
           ( 
          
         
           B 
          
         
           ∣ 
          
         
           A 
          
         
           ) 
          
         
           ÷ 
          
         
           P 
          
         
           ( 
          
         
           B 
          
         
           ) 
          
         
        
          lift(A==&gt;B)=confidence(A==&gt;B)\div support(B)=P(B|A)\div P(B) 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">==&gt;</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0502em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">==&gt;</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0502em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">÷</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">pp</span><span class="mord mathnormal" style="margin-right: 0.0278em;">or</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0502em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0502em;">B</span><span class="mord">∣</span><span class="mord mathnormal">A</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">÷</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.0502em;">B</span><span class="mclose">)</span></span></span></span></span></li><li>假设现在有1000个顾客，其中500人买了茶叶，买茶叶的500人中有450人还买了咖啡。那么可以计算得 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           c 
          
         
           o 
          
         
           n 
          
         
           f 
          
         
           i 
          
         
           d 
          
         
           e 
          
         
           n 
          
         
           c 
          
         
           e 
          
         
           ( 
          
         
           茶叶 
          
         
           = 
          
         
           = 
          
         
           &gt; 
          
         
           咖啡 
          
         
           ) 
          
         
           = 
          
         
           450 
          
         
           ÷ 
          
         
           500 
          
         
           = 
          
         
           90 
          
         
           % 
          
         
        
          confidence(茶叶==&gt;咖啡)=450\div 500=90\% 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord cjk_fallback">茶叶</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">==&gt;</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord cjk_fallback">咖啡</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span class="mord">450</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">÷</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">500</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8056em; vertical-align: -0.0556em;"></span><span class="mord">90%</span></span></span></span></span>，由此，可能会认为喜欢喝茶的人往往喜欢喝咖啡。但是，如果另外没有购买茶叶的500人中也有450人买了咖啡，同样可以算出置信度90%，得到的结论是不爱喝茶的人往往喜欢喝咖啡。这与前面的结论矛盾了，由此看来，实际上顾客喜不喜欢喝咖啡和他喜不喜欢喝茶几乎没有关系，两者是相互独立的。此时，我们就有提升度这一指标来描述这一现象。<br> 在这个例子中，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
         
           l 
          
         
           i 
          
         
           f 
          
         
           t 
          
         
           ( 
          
         
           茶叶 
          
         
           = 
          
         
           = 
          
         
           &gt; 
          
         
           咖啡 
          
         
           ) 
          
         
           = 
          
         
           c 
          
         
           o 
          
         
           n 
          
         
           f 
          
         
           i 
          
         
           d 
          
         
           e 
          
         
           n 
          
         
           c 
          
         
           e 
          
         
           ( 
          
         
           茶叶 
          
         
           = 
          
         
           = 
          
         
           &gt; 
          
         
           咖啡 
          
         
           ) 
          
         
           ÷ 
          
         
           s 
          
         
           u 
          
         
           p 
          
         
           p 
          
         
           o 
          
         
           r 
          
         
           t 
          
         
           ( 
          
         
           咖啡 
          
         
           ) 
          
         
           = 
          
         
           90 
          
         
           % 
          
         
           ÷ 
          
         
           [ 
          
         
           ( 
          
         
           450 
          
         
           + 
          
         
           450 
          
         
           ) 
          
         
           ÷ 
          
         
           1000 
          
         
           ] 
          
         
           = 
          
         
           1 
          
         
        
          lift(茶叶==&gt;咖啡)=confidence(茶叶==&gt;咖啡)\div support(咖啡)=90\%\div [(450+450)\div 1000]=1 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord cjk_fallback">茶叶</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">==&gt;</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord cjk_fallback">咖啡</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ce</span><span class="mopen">(</span><span class="mord cjk_fallback">茶叶</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">==&gt;</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord cjk_fallback">咖啡</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">÷</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">pp</span><span class="mord mathnormal" style="margin-right: 0.0278em;">or</span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord cjk_fallback">咖啡</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.0833em;"></span><span class="mord">90%</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">÷</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[(</span><span class="mord">450</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">450</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">÷</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1000</span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span></li><li>由此可见，提升度弥补了置信度的这一缺憾，如果提升都等于1，那么X与Y独立，X对Y的出现的可能性没有提升作用。提升度越大（lift &gt; 1），则表明X对Y的提升程度越大，也表明X与Y的关联性越强。</li></ul> 
</blockquote> 
<h4><a id="124__67"></a>1.2.4 所有指标的公式</h4> 
<p><img src="https://images2.imgbox.com/98/8a/R0pwLrfp_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="Python_73"></a>二、Python实战关联规则</h2> 
<h3><a id="21__mlxtend__74"></a>2.1 使用 mlxtend 工具包得出频繁项集与规则</h3> 
<h4><a id="211__mlxtend__75"></a>2.1.1 安装 mlxtend 工具包</h4> 
<pre><code class="prism language-python">pip install mlxtend
</code></pre> 
<h4><a id="212__80"></a>2.1.2 引入相关库</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token comment"># 设置pandas输出表格的属性</span>
pd<span class="token punctuation">.</span>options<span class="token punctuation">.</span>display<span class="token punctuation">.</span>max_colwidth<span class="token operator">=</span><span class="token number">100</span>
pd<span class="token punctuation">.</span>options<span class="token punctuation">.</span>display<span class="token punctuation">.</span>width<span class="token operator">=</span><span class="token number">500</span>
<span class="token keyword">from</span> mlxtend<span class="token punctuation">.</span>frequent_patterns <span class="token keyword">import</span> apriori<span class="token punctuation">,</span> association_rules
</code></pre> 
<h4><a id="213__89"></a>2.1.3 自定义一份数据集</h4> 
<pre><code class="prism language-python"><span class="token comment"># 自定义一份数据集</span>
data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'ID'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'Onion'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'Potato'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'Burger'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'Milk'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'Beer'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/52/11/THSP0HtN_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="214__106"></a>2.1.4 得到频繁项集</h4> 
<pre><code class="prism language-python"><span class="token comment"># 利用mlxtend提供的apriori算法函数得到频繁项集，其中设置最小支持度为50%</span>
frequent_item_sets <span class="token operator">=</span> apriori<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Onion'</span><span class="token punctuation">,</span> <span class="token string">'Potato'</span><span class="token punctuation">,</span> <span class="token string">'Burger'</span><span class="token punctuation">,</span> <span class="token string">'Milk'</span><span class="token punctuation">,</span> <span class="token string">'Beer'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> min_support<span class="token operator">=</span><span class="token number">0.50</span><span class="token punctuation">,</span> use_colnames<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>frequent_item_sets<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ee/c8/cAlxJ7mg_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="215__114"></a>2.1.5 计算规则</h4> 
<pre><code class="prism language-python"><span class="token comment"># 计算规则，并设置提升度阈值为 1 （返回的是各个指标的数值，可以按照按兴趣的指标排序观察，但具体解释还得参考实际数据的含义）</span>
rules <span class="token operator">=</span> association_rules<span class="token punctuation">(</span>frequent_item_sets<span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">'lift'</span><span class="token punctuation">,</span> min_threshold<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rules<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8b/c0/1hPxkWnL_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="216__124"></a>2.1.6 挑选有用的规则进行分析</h4> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>rules<span class="token punctuation">[</span><span class="token punctuation">(</span>rules<span class="token punctuation">[</span><span class="token string">'lift'</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">1.125</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>rules<span class="token punctuation">[</span><span class="token string">'confidence'</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5c/39/ehfrA5JH_o.png" alt="在这里插入图片描述"></p> 
<p><strong>通过一些自定义条件，筛选出自己感兴趣的结果。如上，我们可以分析得</strong>：</p> 
<ul><li>（洋葱和马铃薯）（汉堡和马铃薯）可以搭配着来卖</li><li>如果洋葱和汉堡都在顾客的购物篮中，顾客购买马铃薯得可能性也较高，如果他篮子里没有，则可以推荐一下</li></ul> 
<h3><a id="22__135"></a>2.2 数据集制作</h3> 
<p>实际场景中，我们拿到的数据往往如下图所示：</p> 
<p><img src="https://images2.imgbox.com/38/5b/DOnmddh4_o.png" alt="在这里插入图片描述"><br> 也就是说，我们的初始输出往往是每个顾客购买了哪些商品，都是字符串类型的，而并非像我们上一节用到的那种标准格式的。这一节就讲讲怎么讲上面的原始数据转化为我们需要的格式。</p> 
<blockquote> 
 <p>导入相关库</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment"># 设置pandas输出表格的属性</span>
pd<span class="token punctuation">.</span>options<span class="token punctuation">.</span>display<span class="token punctuation">.</span>max_colwidth <span class="token operator">=</span> <span class="token number">100</span>
pd<span class="token punctuation">.</span>options<span class="token punctuation">.</span>display<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">500</span>
<span class="token keyword">from</span> mlxtend<span class="token punctuation">.</span>frequent_patterns <span class="token keyword">import</span> apriori<span class="token punctuation">,</span> association_rules
</code></pre> 
<blockquote> 
 <p>构建原始数据集</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment"># 原始数据集</span>
data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'ID'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'Basket'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token string">'Beer'</span><span class="token punctuation">,</span> <span class="token string">'Diaper'</span><span class="token punctuation">,</span> <span class="token string">'Pretzels'</span><span class="token punctuation">,</span> <span class="token string">'Chips'</span><span class="token punctuation">,</span> <span class="token string">'Aspirin'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">'Diaper'</span><span class="token punctuation">,</span> <span class="token string">'Beer'</span><span class="token punctuation">,</span> <span class="token string">'Chips'</span><span class="token punctuation">,</span> <span class="token string">'Lotion'</span><span class="token punctuation">,</span> <span class="token string">'Juice'</span><span class="token punctuation">,</span> <span class="token string">'BabyFood'</span><span class="token punctuation">,</span> <span class="token string">'Milk'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">'Soda'</span><span class="token punctuation">,</span> <span class="token string">'Chips'</span><span class="token punctuation">,</span> <span class="token string">'Milk'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">'Soup'</span><span class="token punctuation">,</span> <span class="token string">'Beer'</span><span class="token punctuation">,</span> <span class="token string">'Diaper'</span><span class="token punctuation">,</span> <span class="token string">'Milk'</span><span class="token punctuation">,</span> <span class="token string">'IceCream'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">'Soda'</span><span class="token punctuation">,</span> <span class="token string">'Coffee'</span><span class="token punctuation">,</span> <span class="token string">'Milk'</span><span class="token punctuation">,</span> <span class="token string">'Bread'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">'Beer'</span><span class="token punctuation">,</span> <span class="token string">'Chips'</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/55/06/lKuHJXkf_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>处理成标准格式</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment"># 将 Basket 列取出来单独处理，然后再将处理好的数据拼接回去</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" ID列 "</span><span class="token punctuation">.</span>center<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
data_id <span class="token operator">=</span> data<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'Basket'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data_id<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" Basket列 "</span><span class="token punctuation">.</span>center<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
basket <span class="token operator">=</span> data<span class="token punctuation">.</span>Basket
<span class="token keyword">print</span><span class="token punctuation">(</span>basket<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" 将列表转化为字符串的Basket列 "</span><span class="token punctuation">.</span>center<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
basket <span class="token operator">=</span> data<span class="token punctuation">.</span>Basket<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>basket<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" 根据Basket列数据转化为数值型 "</span><span class="token punctuation">.</span>center<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
basket <span class="token operator">=</span> basket<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>basket<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">" 将数值型数据拼接回原数据 "</span><span class="token punctuation">.</span>center<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> data_id<span class="token punctuation">.</span>join<span class="token punctuation">(</span>basket<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/61/ec/iHDbMJUW_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>用标准数据继续关联规则分析的步骤</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment"># 用标准数据继续关联规则分析的步骤</span>
<span class="token comment"># 利用mlxtend提供的apriori算法函数得到频繁项集，其中设置最小支持度为50%</span>
frequent_item_sets <span class="token operator">=</span> apriori<span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'Aspirin'</span><span class="token punctuation">,</span> <span class="token string">'BabyFood'</span><span class="token punctuation">,</span> <span class="token string">'Beer'</span><span class="token punctuation">,</span> <span class="token string">'Bread'</span><span class="token punctuation">,</span> <span class="token string">'Chips'</span><span class="token punctuation">,</span> <span class="token string">'Coffee'</span><span class="token punctuation">,</span> <span class="token string">'Diaper'</span><span class="token punctuation">,</span> <span class="token string">'IceCream'</span><span class="token punctuation">,</span>
                                   <span class="token string">'Juice'</span><span class="token punctuation">,</span> <span class="token string">'Lotion'</span><span class="token punctuation">,</span> <span class="token string">'Milk'</span><span class="token punctuation">,</span> <span class="token string">'Pretzels'</span><span class="token punctuation">,</span> <span class="token string">'Soda'</span><span class="token punctuation">,</span> <span class="token string">'Soup'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> min_support<span class="token operator">=</span><span class="token number">0.50</span><span class="token punctuation">,</span>
                             use_colnames<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>frequent_item_sets<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/83/b7/R2mgOAXa_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>计算规则</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token comment"># 计算规则，并设置提升度阈值为 1 （返回的是各个指标的数值，可以按照按兴趣的指标排序观察，但具体解释还得参考实际数据的含义）</span>
rules <span class="token operator">=</span> association_rules<span class="token punctuation">(</span>frequent_item_sets<span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">'lift'</span><span class="token punctuation">,</span> min_threshold<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rules<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3a/22/pRyj5vgS_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="23__218"></a>2.3 电影数据集关联分析</h3> 
<h4><a id="231__219"></a>2.3.1 数据集获取</h4> 
<blockquote> 
 <p><strong><a href="http://files.grouplens.org/datasets/movielens/" rel="nofollow">数据集链接</a></strong></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/57/54/SJmWxsZu_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ab/46/bP1VHJfx_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="232__225"></a>2.3.2 引入相关库</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment"># 设置pandas输出表格的属性</span>
pd<span class="token punctuation">.</span>options<span class="token punctuation">.</span>display<span class="token punctuation">.</span>max_colwidth <span class="token operator">=</span> <span class="token number">100</span>
pd<span class="token punctuation">.</span>options<span class="token punctuation">.</span>display<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">500</span>
<span class="token keyword">from</span> mlxtend<span class="token punctuation">.</span>frequent_patterns <span class="token keyword">import</span> apriori<span class="token punctuation">,</span> association_rules
</code></pre> 
<h4><a id="233__236"></a>2.3.3 读取数据集</h4> 
<pre><code class="prism language-python"><span class="token comment"># 读取原始数据</span>
movies <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>
    <span class="token string">r'E:\Software\JetBrainsIDEA\PythonIDEA\Projects\CXSJS\Python\机器学习\唐宇迪机器学习\关联规则\data\movies\movies.csv'</span><span class="token punctuation">)</span>
movies<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fb/56/Sxi7Jnda_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="234__246"></a>2.3.4 标准化数据集</h4> 
<pre><code class="prism language-python"><span class="token comment"># 第一步，当然是将原始数据转化为标准格式啦</span>
movies_standard <span class="token operator">=</span> movies<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'genres'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>movies<span class="token punctuation">.</span>genres<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>get_dummies<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
movies_standard<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment"># 一共包含 9742 部电影，一共有20种不同的电影类型（有2列是ID和电影名）</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>movies_standard<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment"># (9742, 22)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b3/ea/czM3ZSEj_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="235__257"></a>2.3.5 获取频繁项集</h4> 
<pre><code class="prism language-python"><span class="token comment"># 利用mlxtend提供的apriori算法函数得到频繁项集，其中设置最小支持度为0.05</span>
movies_standard<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'movieId'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
frequent_item_sets <span class="token operator">=</span> apriori<span class="token punctuation">(</span>movies_standard<span class="token punctuation">,</span> min_support<span class="token operator">=</span><span class="token number">0.05</span><span class="token punctuation">,</span> use_colnames<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>frequent_item_sets<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/4f/43/wIDe1Uoq_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="236__266"></a>2.3.6 计算规则</h4> 
<pre><code class="prism language-python"><span class="token comment"># 计算规则，并设置提升度阈值为 1.25 （返回的是各个指标的数值，可以按照按兴趣的指标排序观察，但具体解释还得参考实际数据的含义）</span>
rules <span class="token operator">=</span> association_rules<span class="token punctuation">(</span>frequent_item_sets<span class="token punctuation">,</span> metric<span class="token operator">=</span><span class="token string">'lift'</span><span class="token punctuation">,</span> min_threshold<span class="token operator">=</span><span class="token number">1.25</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rules<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0d/50/UnJ5VLDw_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="237__274"></a>2.3.7 结果分析</h4> 
<pre><code class="prism language-python"><span class="token comment"># 对lift降序排序，查看lift较大的是哪些规则</span>
rules_sort <span class="token operator">=</span> rules<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>by<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'lift'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>rules_sort<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/35/13/zhESacIl_o.png" alt="在这里插入图片描述"><br> <strong>由上图可知，Adventure（冒险） 和 Action（动作片） 两个类型是最相关的，这和常识相符。</strong></p> 
<hr> 
<h2><a id="Apriori__285"></a>三、Apriori 算法</h2> 
<h3><a id="31__286"></a>3.1 算法介绍</h3> 
<p>假设现在有 4 个项（0、1、2、3），那么需要找出频繁项集的话就需要遍历所有可能的项集，一共15个（如下图所示）</p> 
<p><img src="https://images2.imgbox.com/98/2b/xDxwu6S4_o.png" alt="在这里插入图片描述"><br> 假设现在有 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         n 
        
       
      
        n 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></span> 个项，那么所有可能的项集就有 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          2 
         
        
          n 
         
        
       
         − 
        
       
         1 
        
       
      
        2^n-1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7477em; vertical-align: -0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.6644em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span> 个，显然，当 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         n 
        
       
      
        n 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></span> 较大时，采用暴力遍历的方法寻找频繁项集是不可行的。所以就有人提出了 Apriori 算法来减少遍历的次数。</p> 
<p>首先，我们要知道一个定理，<strong>如果一个项集是非频繁项集，那么它的超集一定也是非频繁的</strong>。这个定理很容易理解，比如项集{2,3}是非频繁的，那么它的一个超集{1,2,3}肯定也是非频繁的，为什么呢？因为{1,2,3}出现的概率肯定小于等于{2,3}出现的概率，如果{2,3}都是非频繁的，那么出现概率更小的{1,2,3}当然也是非频繁的啦！</p> 
<p>Apriori 算法的思想就是，在遍历的时候采用上述定理进行剪枝，从而减少遍历次数。</p> 
<p>如下图所示，采用 Apriori 算法，假设项集{2,3}是非频繁的，那么项集{023}、{123}和{0123}肯定都是非频繁的。所以可以不用遍历它们。</p> 
<p><img src="https://images2.imgbox.com/12/ee/KOgeLCjE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="32_Python_301"></a>3.2 Python代码实现</h3> 
<blockquote> 
 <p>案例：求下图所示数据集的频繁项集并计算规则</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/d1/07/on0ke5V8_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>代码</p> 
</blockquote> 
<pre><code class="prism language-python"><span class="token keyword">import</span> math
<span class="token keyword">import</span> time


<span class="token keyword">def</span> <span class="token function">get_item_set</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    获取项的字典
    :param data: 数据集
    :return: 项的字典
    '''</span>
    item_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> d <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        item_set <span class="token operator">=</span> item_set <span class="token operator">|</span> <span class="token builtin">set</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
    <span class="token keyword">return</span> item_set


<span class="token keyword">def</span> <span class="token function">apriori</span><span class="token punctuation">(</span>item_set<span class="token punctuation">,</span> data<span class="token punctuation">,</span> min_support<span class="token operator">=</span><span class="token number">0.50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    获取频繁项集
    :param item_set: 项的字典
    :param data: 数据集
    :param min_support: 最小支持度，默认为0.50
    :return: None
    '''</span>
    <span class="token comment"># 初始化存储非频繁项集的列表</span>
    infrequent_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># 初始化存储频繁项集的列表</span>
    frequent_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># 初始化存储频繁项集的支持度的列表</span>
    frequent_support_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># 遍历获取 n-项集</span>
    <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>item_set<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        supports <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>frequent_list<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># 计算 1-项集</span>
            <span class="token keyword">for</span> item <span class="token keyword">in</span> item_set<span class="token punctuation">:</span>
                items <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>item<span class="token punctuation">}</span>
                support <span class="token operator">=</span> calc_support<span class="token punctuation">(</span>data<span class="token punctuation">,</span> items<span class="token punctuation">)</span>
                <span class="token comment"># 如果支持度大于等于最小支持度就为频繁项集</span>
                <span class="token keyword">if</span> support <span class="token operator">&gt;=</span> min_support<span class="token punctuation">:</span>
                    c<span class="token punctuation">.</span>append<span class="token punctuation">(</span>items<span class="token punctuation">)</span>
                    supports<span class="token punctuation">.</span>append<span class="token punctuation">(</span>support<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    infrequent_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>items<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 计算 n-项集，n &gt; 1</span>
            <span class="token keyword">for</span> last_items <span class="token keyword">in</span> frequent_list<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> item <span class="token keyword">in</span> item_set<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> item <span class="token operator">&gt;</span> <span class="token builtin">list</span><span class="token punctuation">(</span>last_items<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        items <span class="token operator">=</span> last_items<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        items<span class="token punctuation">.</span>add<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
                        <span class="token comment"># 如果items的子集没有非频繁项集才计算支持度</span>
                        <span class="token keyword">if</span> is_infrequent<span class="token punctuation">(</span>infrequent_list<span class="token punctuation">,</span> items<span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
                            support <span class="token operator">=</span> calc_support<span class="token punctuation">(</span>data<span class="token punctuation">,</span> items<span class="token punctuation">)</span>
                            <span class="token comment"># 如果支持度大于等于最小支持度就为频繁项集</span>
                            <span class="token keyword">if</span> support <span class="token operator">&gt;=</span> min_support<span class="token punctuation">:</span>
                                c<span class="token punctuation">.</span>append<span class="token punctuation">(</span>items<span class="token punctuation">)</span>
                                supports<span class="token punctuation">.</span>append<span class="token punctuation">(</span>support<span class="token punctuation">)</span>
                            <span class="token keyword">else</span><span class="token punctuation">:</span>
                                infrequent_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>items<span class="token punctuation">)</span>
        frequent_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
        frequent_support_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>supports<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>n<span class="token punctuation">}</span></span><span class="token string">-项集: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>c<span class="token punctuation">}</span></span><span class="token string"> , 支持度分别为: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>supports<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> infrequent_list<span class="token punctuation">,</span> frequent_list<span class="token punctuation">,</span> frequent_support_list


<span class="token keyword">def</span> <span class="token function">is_infrequent</span><span class="token punctuation">(</span>infrequent_list<span class="token punctuation">,</span> items<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    判断是否属于非频繁项集的超集
    :param infrequent_list: 非频繁项集列表
    :param items: 项集
    :return: 是否属于非频繁项集的超集
    '''</span>
    <span class="token keyword">for</span> infrequent <span class="token keyword">in</span> infrequent_list<span class="token punctuation">:</span>
        <span class="token keyword">if</span> infrequent<span class="token punctuation">.</span>issubset<span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">return</span> <span class="token boolean">False</span>


<span class="token keyword">def</span> <span class="token function">calc_support</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> items<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    计算 support
    :param data: 数据集
    :param items: 项集
    :return: 计算好的支持度
    '''</span>
    cnt <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> d <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        <span class="token keyword">if</span> items<span class="token punctuation">.</span>issubset<span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span>
            cnt <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> cnt <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">generate_rules</span><span class="token punctuation">(</span>frequent_list<span class="token punctuation">,</span> data<span class="token punctuation">,</span> min_confidence<span class="token operator">=</span><span class="token number">0.60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    根据频繁项集和最小置信度生成规则
    :param frequent_list: 存储频繁项集的列表
    :param data: 数据集
    :param min_confidence: 最小置信度
    :return: 规则
    '''</span>
    rule_key_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    rules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> frequent <span class="token keyword">in</span> frequent_list<span class="token punctuation">:</span>
        <span class="token keyword">for</span> items <span class="token keyword">in</span> frequent<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    front_set_list <span class="token operator">=</span> get_all_combine<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
                    <span class="token keyword">for</span> front_set <span class="token keyword">in</span> front_set_list<span class="token punctuation">:</span>
                        back_set <span class="token operator">=</span> items <span class="token operator">-</span> front_set
                        confidence <span class="token operator">=</span> calc_confidence<span class="token punctuation">(</span>front_set<span class="token punctuation">,</span> items<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
                        <span class="token keyword">if</span> confidence <span class="token operator">&gt;=</span> min_confidence<span class="token punctuation">:</span>
                            rule <span class="token operator">=</span> <span class="token punctuation">(</span>front_set<span class="token punctuation">,</span> back_set<span class="token punctuation">,</span> confidence<span class="token punctuation">)</span>
                            key <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>front_set<span class="token punctuation">}</span></span><span class="token string"> ==&gt; </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>back_set<span class="token punctuation">}</span></span><span class="token string"> , confidence: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>confidence<span class="token punctuation">}</span></span><span class="token string">'</span></span>
                            <span class="token keyword">if</span> key <span class="token keyword">not</span> <span class="token keyword">in</span> rule_key_set<span class="token punctuation">:</span>
                                rule_key_set<span class="token punctuation">.</span>add<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
                                rules<span class="token punctuation">.</span>append<span class="token punctuation">(</span>rule<span class="token punctuation">)</span>
                                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"规则</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">len</span><span class="token punctuation">(</span>rules<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>key<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> rules


<span class="token keyword">def</span> <span class="token function">get_all_combine</span><span class="token punctuation">(</span>data_set<span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    在指定数据集种获取指定长度的所有组合
    :param data_set: 数据集
    :param length: 指定的长度
    :return: 所有符合约束的组合
    '''</span>

    <span class="token keyword">def</span> <span class="token function">dfs</span><span class="token punctuation">(</span>cur_index<span class="token punctuation">,</span> cur_arr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> cur_index <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data_set<span class="token punctuation">)</span><span class="token punctuation">:</span>
            cur_arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data_set<span class="token punctuation">[</span>cur_index<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>cur_arr<span class="token punctuation">)</span> <span class="token operator">==</span> length<span class="token punctuation">:</span>
                combine_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>cur_arr<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>cur_index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data_set<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    dfs<span class="token punctuation">(</span>index<span class="token punctuation">,</span> cur_arr<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    combine_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> start_index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data_set<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        dfs<span class="token punctuation">(</span>start_index<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> combine_list


<span class="token keyword">def</span> <span class="token function">calc_confidence</span><span class="token punctuation">(</span>front_set<span class="token punctuation">,</span> total_set<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    计算规则 X==&gt;Y 的置信度
    :param front_set: X
    :param total_set: X ∪ Y
    :param data: 数据集
    :return: 返回规则 X==&gt;Y 的置信度
    '''</span>
    front_cnt <span class="token operator">=</span> <span class="token number">0</span>
    total_cnt <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> d <span class="token keyword">in</span> data<span class="token punctuation">:</span>
        <span class="token keyword">if</span> front_set<span class="token punctuation">.</span>issubset<span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span>
            front_cnt <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> total_set<span class="token punctuation">.</span>issubset<span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span>
            total_cnt <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> total_cnt <span class="token operator">/</span> front_cnt


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># 记录开始时间</span>
    s <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 数据集</span>
    data <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span>

    <span class="token comment"># 获取项的字典</span>
    item_set <span class="token operator">=</span> get_item_set<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"项的字典:"</span><span class="token punctuation">,</span> item_set<span class="token punctuation">)</span>

    <span class="token comment"># 根据 Apriori算法 获取 n-频繁项集</span>
    infrequent_list<span class="token punctuation">,</span> frequent_list<span class="token punctuation">,</span> frequent_support_list <span class="token operator">=</span> apriori<span class="token punctuation">(</span>item_set<span class="token punctuation">,</span> data<span class="token punctuation">,</span> min_support<span class="token operator">=</span><span class="token number">0.50</span><span class="token punctuation">)</span>

    <span class="token comment"># 生成规则</span>
    rule_set <span class="token operator">=</span> generate_rules<span class="token punctuation">(</span>frequent_list<span class="token punctuation">,</span> data<span class="token punctuation">,</span> min_confidence<span class="token operator">=</span><span class="token number">0.60</span><span class="token punctuation">)</span>

    <span class="token comment"># 输出总用时</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"总用时:"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> s<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"s"</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>运行输出</p> 
</blockquote> 
<pre><code class="prism language-python">项的字典<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span>
<span class="token number">1</span><span class="token operator">-</span>项集<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> 支持度分别为<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">]</span>
<span class="token number">2</span><span class="token operator">-</span>项集<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> 支持度分别为<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.75</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span>
<span class="token number">3</span><span class="token operator">-</span>项集<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> 支持度分别为<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">]</span>
<span class="token number">4</span><span class="token operator">-</span>项集<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> 支持度分别为<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token number">5</span><span class="token operator">-</span>项集<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> 支持度分别为<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
规则<span class="token number">1</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> confidence<span class="token punctuation">:</span> <span class="token number">1.0</span>
规则<span class="token number">2</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> confidence<span class="token punctuation">:</span> <span class="token number">0.6666666666666666</span>
规则<span class="token number">3</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">}</span> <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> confidence<span class="token punctuation">:</span> <span class="token number">0.6666666666666666</span>
规则<span class="token number">4</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> confidence<span class="token punctuation">:</span> <span class="token number">0.6666666666666666</span>
规则<span class="token number">5</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">}</span> <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> confidence<span class="token punctuation">:</span> <span class="token number">1.0</span>
规则<span class="token number">6</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> confidence<span class="token punctuation">:</span> <span class="token number">1.0</span>
规则<span class="token number">7</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> confidence<span class="token punctuation">:</span> <span class="token number">0.6666666666666666</span>
规则<span class="token number">8</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> confidence<span class="token punctuation">:</span> <span class="token number">0.6666666666666666</span>
规则<span class="token number">9</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">}</span> <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> confidence<span class="token punctuation">:</span> <span class="token number">0.6666666666666666</span>
规则<span class="token number">10</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> confidence<span class="token punctuation">:</span> <span class="token number">0.6666666666666666</span>
规则<span class="token number">11</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> confidence<span class="token punctuation">:</span> <span class="token number">0.6666666666666666</span>
规则<span class="token number">12</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span> <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> confidence<span class="token punctuation">:</span> <span class="token number">1.0</span>
规则<span class="token number">13</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span> <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> confidence<span class="token punctuation">:</span> <span class="token number">0.6666666666666666</span>
规则<span class="token number">14</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span> <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token number">2</span><span class="token punctuation">}</span> <span class="token punctuation">,</span> confidence<span class="token punctuation">:</span> <span class="token number">1.0</span>
总用时<span class="token punctuation">:</span> <span class="token number">0.0</span> s
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7cbc538df867164ef02ac96831632872/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">三种用python进行线性/非线性拟合的方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8ce9f64e6a0276bedc5f4e84c1acf057/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Oracle查询表占用空间大小</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>