<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C# 实现改造 GooFlow 流程图插件与数据库应用的结合 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/367629214390e3a24b647af7b7aa7ec7/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="C# 实现改造 GooFlow 流程图插件与数据库应用的结合">
  <meta property="og:description" content="目录
关于 GooFlow
功能需求
范例运行环境
设计数据表
流程项目表
流程项目节点明细表
流程项目节点审批人表
人员信息表
示例代码
流程图主功能
设置审批人信息
运行结果演示
总结
关于 GooFlow GooFlow 一个基于 Jquery/FontAwesome 的流程图/架构图画图插件，本文介绍的是基于JS的一个版本，能够适用于大部分支持H5的浏览器。通过创建画布，我们可以在其上通过工具栏绘制想要绘制的流程图/框/线等，如下图所示：
图中包括操作工具栏（顶部）、绘图工具栏（左侧）和绘制画布区域，左上角显示的是当前流程的名称。 具体的操作我们不再详述，本文将介绍通过改造后的 GooFlow 简化版本，结合数据库满足实际的开发需求。
功能需求 我们需要实现一个审批流程，在关键流程节点可能会添加审批人信息，通过GoolFlow绘制并显示，则更加友好和直观， 基本需要实现如下功能：
1、改造 GooFlow JS 程序，简化绘制工具栏。
2、设计相关数据库数据表保存流程图设计相关信息、节点明细信息等。
3、改造 GooFlow 操作工具栏，满足实际应用。
范例运行环境 操作系统： Windows Server 2019 DataCenter
GooFlow 版本：GooFlow V1 JS 版 数据库：Microsoft SQL Server 2016
.net版本： .netFramework4.7.1 或以上
开发工具：VS2019 C#
设计数据表 流程项目表 cc_flow 表记录项目信息，主要说明见下表：
序号字段名类型说明1ciduniqueidentifier记录唯一标识2flowNamenvarchar(50)流程项目名称3nodeCountint节点总个数4desriptnvarchar(50)项目描述5flowJSONnvarchar(MAX)流程全部 JSON 数据6sys_insusernvarchar(100)创建信息用户名7sys_instimedatetime创建时间8sys_updusernvarchar(100)最后修改信息用户名9sys_updtimedatetime修改时间 创建脚本如下：
CREATE TABLE [dbo].[cc_flow]( [cid] [uniqueidentifier] ROWGUIDCOL NOT NULL, [flowName] [nvarchar](50) NOT NULL, [nodeCount] [int] NULL, [desript] [nvarchar](100) NULL, [flowJSON] [nvarchar](max) NULL, [sys_insuser] [nvarchar](100) NULL, [sys_instime] [datetime] NULL, [sys_upduser] [nvarchar](100) NULL, [sys_updtime] [datetime] NULL, CONSTRAINT [PK_cc_flow] PRIMARY KEY CLUSTERED ( [cid] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY], CONSTRAINT [IX_cc_flow] UNIQUE NONCLUSTERED ( [flowName] ASC )WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY] ) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY] GO ALTER TABLE [dbo].">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-05T07:32:11+08:00">
    <meta property="article:modified_time" content="2024-08-05T07:32:11+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C# 实现改造 GooFlow 流程图插件与数据库应用的结合</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong> </strong></p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E5%85%B3%E4%BA%8E%20GooFlow-toc" style="margin-left:40px;"><a href="#%E5%85%B3%E4%BA%8E%20GooFlow" rel="nofollow">关于 GooFlow</a></p> 
<p id="main-toc-toc" style="margin-left:40px;"><a href="#main-toc" rel="nofollow">功能需求</a></p> 
<p id="Office%20%E6%95%B0%E6%8D%AE%E6%BA%90%E7%9A%84%E4%B8%80%E4%BA%9B%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB-toc" style="margin-left:40px;"><a href="#%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83" rel="nofollow">范例运行环境</a></p> 
<p id="%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE" rel="nofollow">设计数据表</a></p> 
<p id="%E6%B5%81%E7%A8%8B%E9%A1%B9%E7%9B%AE%E8%A1%A8-toc" style="margin-left:120px;"><a href="#%E6%B5%81%E7%A8%8B%E9%A1%B9%E7%9B%AE%E8%A1%A8" rel="nofollow">流程项目表</a></p> 
<p id="%E6%B5%81%E7%A8%8B%E9%A1%B9%E7%9B%AE%E8%8A%82%E7%82%B9%E6%98%8E%E7%BB%86%E8%A1%A8-toc" style="margin-left:120px;"><a href="#%E6%B5%81%E7%A8%8B%E9%A1%B9%E7%9B%AE%E8%8A%82%E7%82%B9%E6%98%8E%E7%BB%86%E8%A1%A8" rel="nofollow">流程项目节点明细表</a></p> 
<p id="%E6%B5%81%E7%A8%8B%E9%A1%B9%E7%9B%AE%E8%8A%82%E7%82%B9%E5%AE%A1%E6%89%B9%E4%BA%BA%E8%A1%A8-toc" style="margin-left:120px;"><a href="#%E6%B5%81%E7%A8%8B%E9%A1%B9%E7%9B%AE%E8%8A%82%E7%82%B9%E5%AE%A1%E6%89%B9%E4%BA%BA%E8%A1%A8" rel="nofollow">流程项目节点审批人表</a></p> 
<p id="%C2%A0%E4%BA%BA%E5%91%98%E4%BF%A1%E6%81%AF%E8%A1%A8-toc" style="margin-left:120px;"><a href="#%C2%A0%E4%BA%BA%E5%91%98%E4%BF%A1%E6%81%AF%E8%A1%A8" rel="nofollow"> 人员信息表</a></p> 
<p id="%E8%AE%BE%E8%AE%A1%E6%83%B3%E6%B3%95-toc" style="margin-left:40px;"><a href="#%E8%AE%BE%E8%AE%A1%E6%83%B3%E6%B3%95" rel="nofollow">示例代码</a></p> 
<p id="%E6%B5%81%E7%A8%8B%E5%9B%BE%E4%B8%BB%E5%8A%9F%E8%83%BD-toc" style="margin-left:120px;"><a href="#%E6%B5%81%E7%A8%8B%E5%9B%BE%E4%B8%BB%E5%8A%9F%E8%83%BD" rel="nofollow">流程图主功能</a></p> 
<p id="%E8%AE%BE%E7%BD%AE%E5%AE%A1%E6%89%B9%E4%BA%BA%E4%BF%A1%E6%81%AF-toc" style="margin-left:120px;"><a href="#%E8%AE%BE%E7%BD%AE%E5%AE%A1%E6%89%B9%E4%BA%BA%E4%BF%A1%E6%81%AF" rel="nofollow">设置审批人信息</a></p> 
<p id="%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA-toc" style="margin-left:120px;"><a href="#%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA" rel="nofollow">运行结果演示</a></p> 
<p id="%E5%9F%BA%E7%A1%80%E4%BB%A3%E7%A0%81-toc" style="margin-left:80px;"></p> 
<p id="%E6%80%BB%E7%BB%93-toc" style="margin-left:40px;"><a href="#%E6%80%BB%E7%BB%93" rel="nofollow">总结</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h3 id="%E5%85%B3%E4%BA%8E%20GooFlow">关于 GooFlow</h3> 
<p>GooFlow 一个基于 Jquery/FontAwesome 的流程图/架构图画图插件，本文介绍的是基于JS的一个版本，能够适用于大部分支持H5的浏览器。通过创建画布，我们可以在其上通过工具栏绘制想要绘制的流程图/框/线等，如下图所示：</p> 
<p><img alt="" height="1013" src="https://images2.imgbox.com/b1/75/6hOns7U0_o.png" width="1200"></p> 
<p>图中包括操作工具栏（顶部）、绘图工具栏（左侧）和绘制画布区域，左上角显示的是当前流程的名称。 具体的操作我们不再详述，本文将介绍通过改造后的 GooFlow 简化版本，结合数据库满足实际的开发需求。</p> 
<p></p> 
<h3 id="main-toc">功能需求</h3> 
<p>我们需要实现一个审批流程，在关键流程节点可能会添加审批人信息，通过GoolFlow绘制并显示，则更加友好和直观， 基本需要实现如下功能：</p> 
<p>1、改造 GooFlow JS 程序，简化绘制工具栏。</p> 
<p>2、设计相关数据库数据表保存流程图设计相关信息、节点明细信息等。</p> 
<p>3、改造 GooFlow 操作工具栏，满足实际应用。</p> 
<h3 id="Office%20%E6%95%B0%E6%8D%AE%E6%BA%90%E7%9A%84%E4%B8%80%E4%BA%9B%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB"></h3> 
<h3 id="%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83">范例运行环境</h3> 
<p>操作系统： Windows Server 2019 DataCenter</p> 
<p>GooFlow 版本：GooFlow V1 JS 版 </p> 
<p>数据库：Microsoft SQL Server 2016</p> 
<p>.net版本： .netFramework4.7.1 或以上</p> 
<p>开发工具：VS2019  C#</p> 
<h3 id="%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE">设计数据表</h3> 
<h5 id="%E6%B5%81%E7%A8%8B%E9%A1%B9%E7%9B%AE%E8%A1%A8">流程项目表</h5> 
<p>cc_flow 表记录项目信息，主要说明见下表：</p> 
<table align="center" border="1" cellpadding="1" cellspacing="1" style="width:650px;"><thead><tr><th style="text-align:center;width:55px;">序号</th><th style="text-align:center;width:152px;">字段名</th><th style="text-align:center;width:112px;">类型</th><th style="text-align:center;width:330px;">说明</th></tr></thead><tbody><tr><th style="text-align:center;width:55px;">1</th><td style="width:152px;">cid</td><td style="width:112px;">uniqueidentifier</td><td style="width:330px;">记录唯一标识</td></tr><tr><th style="text-align:center;width:55px;">2</th><td style="width:152px;">flowName</td><td style="width:112px;">nvarchar(50)</td><td style="width:330px;">流程项目名称</td></tr><tr><th style="text-align:center;width:55px;">3</th><td style="width:152px;">nodeCount</td><td style="width:112px;">int</td><td style="width:330px;">节点总个数</td></tr><tr><th style="text-align:center;width:55px;">4</th><td style="width:152px;">desript</td><td style="width:112px;">nvarchar(50)</td><td style="width:330px;">项目描述</td></tr><tr><th style="text-align:center;width:55px;">5</th><td style="width:152px;">flowJSON</td><td style="width:112px;">nvarchar(MAX)</td><td style="width:330px;">流程全部 JSON 数据</td></tr><tr><th style="text-align:center;width:55px;">6</th><td style="width:152px;">sys_insuser</td><td style="width:112px;">nvarchar(100)</td><td style="width:330px;">创建信息用户名</td></tr><tr><th style="text-align:center;width:55px;">7</th><td style="width:152px;">sys_instime</td><td style="width:112px;">datetime</td><td style="width:330px;">创建时间</td></tr><tr><th style="text-align:center;width:55px;">8</th><td style="width:152px;">sys_upduser</td><td style="width:112px;">nvarchar(100)</td><td style="width:330px;">最后修改信息用户名</td></tr><tr><th style="text-align:center;width:55px;">9</th><td style="width:152px;">sys_updtime</td><td style="width:112px;">datetime</td><td style="width:330px;">修改时间</td></tr></tbody></table> 
<p> 创建脚本如下：</p> 
<div> 
 <pre><code class="language-sql">CREATE TABLE [dbo].[cc_flow](
	[cid] [uniqueidentifier] ROWGUIDCOL  NOT NULL,
	[flowName] [nvarchar](50) NOT NULL,
	[nodeCount] [int] NULL,
	[desript] [nvarchar](100) NULL,
	[flowJSON] [nvarchar](max) NULL,
	[sys_insuser] [nvarchar](100) NULL,
	[sys_instime] [datetime] NULL,
	[sys_upduser] [nvarchar](100) NULL,
	[sys_updtime] [datetime] NULL,
 CONSTRAINT [PK_cc_flow] PRIMARY KEY CLUSTERED 
(
	[cid] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY],
 CONSTRAINT [IX_cc_flow] UNIQUE NONCLUSTERED 
(
	[flowName] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]
GO

ALTER TABLE [dbo].[cc_flow] ADD  CONSTRAINT [DF_cc_flow_cid]  DEFAULT (newid()) FOR [cid]
GO


</code></pre> 
</div> 
<p></p> 
<h5 id="%E6%B5%81%E7%A8%8B%E9%A1%B9%E7%9B%AE%E8%8A%82%E7%82%B9%E6%98%8E%E7%BB%86%E8%A1%A8">流程项目节点明细表</h5> 
<p>cc_flowNodes 表记录了项目绘制节点的所有信息明细情况，主要说明见下表：</p> 
<table align="center" border="1" cellpadding="1" cellspacing="1" style="width:650px;"><thead><tr><th style="text-align:center;width:55px;">序号</th><th style="text-align:center;width:152px;">字段名</th><th style="text-align:center;width:112px;">类型</th><th style="text-align:center;width:330px;">说明</th></tr></thead><tbody><tr><th style="text-align:center;width:55px;">1</th><td style="width:152px;">cid</td><td style="width:112px;">uniqueidentifier</td><td style="width:330px;">记录唯一标识</td></tr><tr><th style="text-align:center;width:55px;">2</th><td style="width:152px;">nodeId</td><td style="width:112px;">nvarchar(50)</td><td style="width:330px;">节点ID</td></tr><tr><th style="text-align:center;width:55px;">3</th><td style="width:152px;">nodeName</td><td style="width:112px;">nvarchar(50)</td><td style="width:330px;">节点流程名称</td></tr><tr><th style="text-align:center;width:55px;">4</th><td style="width:152px;">desript</td><td style="width:112px;">nvarchar(100)</td><td style="width:330px;">节点流程描述</td></tr><tr><th style="text-align:center;width:55px;">5</th><td style="width:152px;">parentNodeId</td><td style="width:112px;">nvarchar(50)</td><td style="width:330px;">父节点ID</td></tr><tr><th style="text-align:center;width:55px;">6</th><td style="width:152px;">projectCid</td><td style="width:112px;">uniqueidentifier</td><td style="width:330px;">流程项目ID，所属的项目唯一标识</td></tr><tr><th style="text-align:center;width:55px;">7</th><td style="width:152px;">sortid</td><td style="width:112px;">int</td><td style="width:330px;">节点排序</td></tr><tr><th style="text-align:center;width:55px;">8</th><td style="width:152px;">sys_insuser</td><td style="width:112px;">nvarchar(100)</td><td style="width:330px;">创建信息用户名</td></tr><tr><th style="text-align:center;width:55px;">9</th><td style="width:152px;">sys_instime</td><td style="width:112px;">datetime</td><td style="width:330px;">创建时间</td></tr><tr><th style="text-align:center;width:55px;">10</th><td style="width:152px;">sys_upduser</td><td style="width:112px;">nvarchar(100)</td><td style="width:330px;">最后修改信息用户名</td></tr><tr><th style="text-align:center;width:55px;">11</th><td style="width:152px;">sys_updtime</td><td style="width:112px;">datetime</td><td style="width:330px;">修改时间</td></tr></tbody></table> 
<p> 创建脚本如下：</p> 
<div> 
 <pre><code class="language-sql">CREATE TABLE [dbo].[cc_flowNodes](
	[cid] [uniqueidentifier] NOT NULL,
	[nodeId] [nvarchar](50) NOT NULL,
	[nodeName] [nvarchar](50) NOT NULL,
	[desript] [nvarchar](100) NULL,
	[parentNodeId] [nvarchar](50) NULL,
	[projectCid] [uniqueidentifier] NOT NULL,
	[sortid] [int] NULL,
	[sys_insuser] [nvarchar](100) NULL,
	[sys_instime] [datetime] NULL,
	[sys_upduser] [nvarchar](100) NULL,
	[sys_updtime] [datetime] NULL
) ON [PRIMARY]
GO

ALTER TABLE [dbo].[cc_flowNodes] ADD  CONSTRAINT [DF_cc_flowNodes_cid]  DEFAULT (newid()) FOR [cid]
GO


</code></pre> 
</div> 
<h5 id="%E6%B5%81%E7%A8%8B%E9%A1%B9%E7%9B%AE%E8%8A%82%E7%82%B9%E5%AE%A1%E6%89%B9%E4%BA%BA%E8%A1%A8">流程项目节点审批人表</h5> 
<p>cc_flowNodeAccounts 表记录了项目关键节点的参与审批人情况，主要说明见下表：</p> 
<table align="center" border="1" cellpadding="1" cellspacing="1" style="width:650px;"><thead><tr><th style="text-align:center;width:55px;">序号</th><th style="text-align:center;width:152px;">字段名</th><th style="text-align:center;width:112px;">类型</th><th style="text-align:center;width:330px;">说明</th></tr></thead><tbody><tr><th style="text-align:center;width:55px;">1</th><td style="width:152px;">cid</td><td style="width:112px;">uniqueidentifier</td><td style="width:330px;">记录唯一标识</td></tr><tr><th style="text-align:center;width:55px;">2</th><td style="width:152px;">nodeId</td><td style="width:112px;">nvarchar(50)</td><td style="width:330px;">节点ID</td></tr><tr><th style="text-align:center;width:55px;">3</th><td style="width:152px;">AccountCid</td><td style="width:112px;">uniqueidentifier</td><td style="width:330px;">所属的人员信息ID</td></tr><tr><th style="text-align:center;width:55px;">4</th><td style="width:152px;">desript</td><td style="width:112px;">nvarchar(100)</td><td style="width:330px;">描述，可以记录诸如姓名相关的一些信息</td></tr><tr><th style="text-align:center;width:55px;">5</th><td style="width:152px;">role</td><td style="width:112px;">nvarchar(50)</td><td style="width:330px;">审批人权限（如决策、抄送）</td></tr><tr><th style="text-align:center;width:55px;">6</th><td style="width:152px;">projectCid</td><td style="width:112px;">uniqueidentifier</td><td style="width:330px;">流程项目ID，所属的项目唯一标识</td></tr><tr><th style="text-align:center;width:55px;">7</th><td style="width:152px;">sys_insuser</td><td style="width:112px;">nvarchar(100)</td><td style="width:330px;">创建信息用户名</td></tr><tr><th style="text-align:center;width:55px;">8</th><td style="width:152px;">sys_instime</td><td style="width:112px;">datetime</td><td style="width:330px;">创建时间</td></tr><tr><th style="text-align:center;width:55px;">9</th><td style="width:152px;">sys_upduser</td><td style="width:112px;">nvarchar(100)</td><td style="width:330px;">最后修改信息用户名</td></tr><tr><th style="text-align:center;width:55px;">10</th><td style="width:152px;">sys_updtime</td><td style="width:112px;">datetime</td><td style="width:330px;">修改时间</td></tr></tbody></table> 
<p> 创建脚本如下：</p> 
<div> 
 <pre><code class="language-sql">
CREATE TABLE [dbo].[cc_flowNodeAccounts](
	[cid] [uniqueidentifier] NOT NULL,
	[projectCid] [uniqueidentifier] NOT NULL,
	[AccountCid] [uniqueidentifier] NOT NULL,
	[descript] [nvarchar](100) NULL,
	[nodeId] [nvarchar](50) NOT NULL,
	[role] [nvarchar](50) NULL,
	[sys_insuser] [nvarchar](100) NULL,
	[sys_instime] [datetime] NULL,
	[sys_upduser] [nvarchar](100) NULL,
	[sys_updtime] [datetime] NULL
) ON [PRIMARY]
GO

ALTER TABLE [dbo].[cc_flowNodeAccounts] ADD  CONSTRAINT [DF_cc_flowNodeBuss_cid]  DEFAULT (newid()) FOR [cid]
GO

</code></pre> 
</div> 
<h5 id="%C2%A0%E4%BA%BA%E5%91%98%E4%BF%A1%E6%81%AF%E8%A1%A8"> 人员信息表</h5> 
<p>accounts 表审批人的基本个人情况，主要说明见下表：</p> 
<table align="center" border="1" cellpadding="1" cellspacing="1" style="width:650px;"><thead><tr><th style="text-align:center;width:55px;">序号</th><th style="text-align:center;width:152px;">字段名</th><th style="text-align:center;width:112px;">类型</th><th style="text-align:center;width:330px;">说明</th></tr></thead><tbody><tr><th style="text-align:center;width:55px;">1</th><td style="width:152px;">cid</td><td style="width:112px;">uniqueidentifier</td><td style="width:330px;">记录唯一标识</td></tr><tr><th style="text-align:center;width:55px;">2</th><td style="width:152px;">name</td><td style="width:112px;">nvarchar(50)</td><td style="width:330px;">姓名</td></tr><tr><th style="text-align:center;width:55px;">3</th><td style="width:152px;">nickName</td><td style="width:112px;">nvarchar(50)</td><td style="width:330px;">昵称</td></tr></tbody></table> 
<p> 创建脚本如下：</p> 
<div> 
 <pre><code class="language-sql">
CREATE TABLE [dbo].[accounts](
	[cid] [uniqueidentifier] ROWGUIDCOL  NOT NULL,
	[name] [nvarchar](50) NULL,
	[nickname] [nvarchar](500) NULL,
 CONSTRAINT [PK_wxmp_accounts] PRIMARY KEY CLUSTERED 
(
	[cid] ASC
)
)
GO

ALTER TABLE [dbo].[accounts] ADD  CONSTRAINT [DF_wxmp_accounts_cid]  DEFAULT (newid()) FOR [cid]
GO</code></pre> 
</div> 
<p></p> 
<p></p> 
<h3 id="%E8%AE%BE%E8%AE%A1%E6%83%B3%E6%B3%95">示例代码</h3> 
<h5 id="%E6%B5%81%E7%A8%8B%E5%9B%BE%E4%B8%BB%E5%8A%9F%E8%83%BD">流程图主功能</h5> 
<p>本示例代码包含后端、前端及 JS 代码，代码如下：</p> 
<div> 
 <pre><code class="language-cs">&lt;%@ Page Language="C#" AutoEventWireup="true" MaintainScrollPositionOnPostback="true"  ValidateRequest="FALSE" %&gt;
&lt;%@ Import Namespace="System.IO" %&gt;
&lt;%@ Import Namespace="System.Data" %&gt;
&lt;%@ Import Namespace="System.Data.SqlClient" %&gt;

&lt;script language="C#" runat="server"&gt;
    public CosysJaneCommonAPI.CODAL dal = new CosysJaneCommonAPI.CODAL();
    public DateTime dt = DateTime.Now;
    void Page_load(Object sender, EventArgs e)
    {
        dal.RunAt = Form;
        if (Page.IsPostBack == true) return;
        dal.ConnKeyString = "JaneConnectionCloud";
        ArrayList paras = new ArrayList();
        paras.Clear();
        paras.Add(new SqlParameter("a", "2"));
        dal.simpledatalist("select cid,flowName from cc_flow order by flowName ", paras, "cid", "flowName",flowlist, true, "", "选择打开已创建流程");

     }

    protected void saveflow_Click(object sender, EventArgs e)
    {
        dal.ConnKeyString = "JaneConnectionCloud";

        ArrayList paras = new ArrayList();
        paras.Clear();
        paras.Add(new SqlParameter("flowname", x_flowname.Text));
        dal.RowsCount = 0;
        dal.ErrorMessage = "";
        dal.ExecDbScripts("insert into cc_flow (flowName) values(@flowname) ", paras);
        if (dal.RowsCount &gt; 0)
        {
            tip.Text = "创建成功！";
            flowpanel.Visible = true;
        }else
        {
            if (dal.ErrorMessage.IndexOf("重复键") != -1)
            {
                dal.RowsCount = 0;
                dal.ErrorMessage = "";
                paras.Clear();
                paras.Add(new SqlParameter("flowname", x_flowname.Text));
                object rv = dal.GetDataSet("select * from  cc_flow where flowname=@flowname ", paras);
                if (dal.RowsCount &gt; 0)
                {
                    DataSet ds = rv as DataSet;
                    DataTable dt = ds.Tables[0];
                    x_cid.Text = dt.Rows[0]["cid"].ToString();
                    x_flowJSON.Text = dt.Rows[0]["flowJSON"].ToString();
                    
                    tip.Text = "打开成功！";
                    flowpanel.Visible = true;
                }
                else
                {
                    tip.Text = dal.ErrorMessage;
                    flowpanel.Visible = false;
                }
            }
            else
            {
                tip.Text = dal.ErrorMessage;
                flowpanel.Visible = false;
            }
        }
    }

    protected void updflow_Click(object sender, EventArgs e)
    {
        dal.ConnKeyString = "JaneConnectionCloud";

        ArrayList paras = new ArrayList();

        Newtonsoft.Json.Linq.JObject jsonObj = Newtonsoft.Json.Linq.JObject.Parse(x_flowJSON.Text);
        string nodelist = "";
        foreach (Newtonsoft.Json.Linq.JProperty jt in  jsonObj["nodes"])
        {
            nodelist+=jt.Name+",";
        }
        string cid = x_cid.Text;

        dal.ConnKeyString = "JaneConnectionCloud";

        paras.Clear();
        paras.Add(new SqlParameter("cid", cid));
        dal.RowsCount = 0;
        dal.ErrorMessage = "";
        dal.ExecDbScripts("delete cc_flowNodes where projectCid=@cid ", paras);

        string[] la = nodelist.Split(',');
        int added = 0;
        for (int i = 0; i &lt; la.GetLength(0); i++)
        {
            if (la[i] != "")
            {
                paras.Clear();
                paras.Add(new SqlParameter("projectCid", cid));
                paras.Add(new SqlParameter("parentNodeId", (i == 0 ? cid : la[i - 1])));
                paras.Add(new SqlParameter("nodeId", la[i]));
                paras.Add(new SqlParameter("nodeName", jsonObj["nodes"][la[i]]["name"].ToString()));
                paras.Add(new SqlParameter("sortid", i + 1));
                dal.RowsCount = 0;
                dal.ErrorMessage = "";
                dal.ExecDbScripts("insert into cc_flowNodes(projectCid,parentNodeId,nodeId,nodeName,sortid) values(@projectCid,@parentNodeId,@nodeId,@nodeName,@sortid) ", paras);
                if (dal.RowsCount &gt; 0)
                {
                    added++;
                }
            }
        }

        
        
        paras.Clear();
        paras.Add(new SqlParameter("cid", x_cid.Text));
        paras.Add(new SqlParameter("flowName",x_flowname.Text));
        paras.Add(new SqlParameter("flowJSON", x_flowJSON.Text));
        dal.RowsCount = 0;
        dal.ErrorMessage = "";
        dal.ExecDbScripts("update cc_flow set flowName=@flowname,flowJSON=@flowJSON where cid=@cid ", paras);
        if (dal.RowsCount &gt; 0)
        {
            tip.Text = "更新成功！";
        }
        else
        {
            tip.Text = dal.ErrorMessage;
        }

    }

    protected void flowlist_SelectedIndexChanged(object sender, EventArgs e)
    {
        if (flowlist.SelectedValue == "")
        {
            return;
        }
        
        dal.ConnKeyString = "JaneConnectionCloud";

        ArrayList paras = new ArrayList();
        dal.RowsCount = 0;
        dal.ErrorMessage = "";
        paras.Clear();
        paras.Add(new SqlParameter("cid",flowlist.SelectedValue));
        object rv = dal.GetDataSet("select * from  cc_flow where cid=@cid ", paras);
        if (dal.RowsCount &gt; 0)
        {
            DataSet ds = rv as DataSet;
            DataTable dt = ds.Tables[0];
            x_cid.Text = dt.Rows[0]["cid"].ToString();
            x_flowname.Text = dt.Rows[0]["flowName"].ToString();
            x_flowJSON.Text = dt.Rows[0]["flowJSON"].ToString();

            tip.Text = "打开成功！";
            flowpanel.Visible = true;
        }
        else
        {
            tip.Text = dal.ErrorMessage;
            flowpanel.Visible = false;
        }

    }
&lt;/script&gt;        

&lt;!DOCTYPE html&gt;
&lt;html lang="cn" &gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;title&gt;&lt;/title&gt;
&lt;link rel="stylesheet" href="dist/GooFlow.min.css?v=10" /&gt;
&lt;link rel="stylesheet" href="fontawesome/css/font-awesome.min.css" /&gt;
&lt;/head&gt;

&lt;script src="dist/jquery.min.js"&gt;&lt;/script&gt;
&lt;script src="dist/GooFlow.js?v=7"&gt;&lt;/script&gt;
&lt;body&gt;
  &lt;form runat="server"&gt;
  &lt;div style=" display:flex"&gt;
  &lt;asp:TextBox ID="x_flowname" placeholder="输入项目名称" runat="server"&gt;&lt;/asp:TextBox&gt;
  &lt;asp:Button ID="saveflow" Text="创建项目" runat="server" onclick="saveflow_Click"&gt;&lt;/asp:Button&gt;
  &lt;asp:Button ID="updflow" Text="更新项目" style=" display:none" runat="server" onclick="updflow_Click" &gt;&lt;/asp:Button&gt;
  &lt;asp:TextBox ID="x_cid" placeholder="cid" style="display:none" ReadOnly="true" runat="server"&gt;&lt;/asp:TextBox&gt;
  &lt;asp:DropDownList ID="flowlist" runat="server" AutoPostBack="true"
          onselectedindexchanged="flowlist_SelectedIndexChanged"&gt;&lt;/asp:DropDownList&gt;
  &lt;/div&gt;
  &lt;div style=" margin:10px; display:flex"&gt;
  &lt;asp:Label ID="tip" Text="这是一些提示信息..." runat="server"&gt;&lt;/asp:Label&gt;
  &lt;/div&gt;
      &lt;iframe id="tframe" width="500" height="400" style=" display:none;z-index:99;position:absolute;" runat="server"&gt;&lt;/iframe&gt;
    &lt;div id="flowpanel" visible="false" runat="server"&gt;
&lt;/div&gt;
    &lt;div&gt;
  &lt;asp:TextBox ID="x_flowJSON" Rows="10" style="display:none"  width="100%" TextMode="MultiLine" runat="server"&gt;&lt;/asp:TextBox&gt;
    &lt;/div&gt;
  &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;script language="javascript" type="text/javascript"&gt;
        var tframe=$('#tframe');
        var curnode=null;
        var flowpanel=null;
        var sortBy = function (filed, rev, primer) {
            rev = (rev) ? -1 : 1;
            return function (a, b) {
                a = a[filed];
                b = b[filed];
                if (primer &amp;&amp; typeof (primer) != 'undefined') {
                    a = primer(a);
                    b = primer(b);
                }else{
			        if(!isNaN(a) &amp;&amp; !isNaN(a)){
				        a = Number(a);
				        b = Number(b);
			        }
		        }
                if (a &lt; b) { return rev * -1; }
                if (a &gt; b) { return rev * 1; }
                return 1;
            }
        };


        $(function(){
            var options={initLabelText:"未命名",toolBtns:["task","chat","state"],toolBtnRemarks:{cursor:"选择指针",direct:"连线",task:"任务结点",chat:"决策结点",state:"状态结点",group:"组织区域框"},headBtns:["save","undo","redo","new","expand"],headBtnRemarks:['保存','撤销','重做','清空画布','结点设置']};
            flowpanel = $('#flowpanel').createGooFlow(options);
            var flowpanelData = {
                areas: {
                    flowpanel_area_17: {
                        color: "yellow",
                        height: 300,
                        left: 40,
                        name: "部门一",
                        top: 30,
                        width: 150,
                    },
                    flowpanel_area_18: {
                        color: "blue",
                        height: 300,
                        left: 200,
                        name: "部门二",
                        top: 30,
                        width: 150,
                    },
                    flowpanel_area_19: {
                        color: "green",
                        height: 300,
                        left: 360,
                        name: "部门三",
                        top: 30,
                        width: 150,
                    },
                    flowpanel_area_20: {
                        color: "red",
                        height: 300,
                        left: 520,
                        name: "部门四",
                        top: 30,
                        width: 150,
                    },
                },
                lines: {
                    flowpanel_line_11: {
                        from: "flowpanel_node_1",
                        marked: false,
                        name: "",
                        to: "flowpanel_node_2",
                        type: "sl",
                    },
                },
                nodes: {
                    flowpanel_node_1: {
                        height: 24,
                        left: 70,
                        name: "节点流程1",
                        top: 66,
                        type: "chat",
                        width: 86,
                        sortid:1,
                        id:"flowpanel_node_1",
                    },
                    flowpanel_node_2: {
                        height: 24,
                        left: 240,
                        name: "节点流程2",
                        top: 132,
                        type: "state",
                        width: 86,
                        sortid:2,
                        id:"flowpanel_node_2",
                    },
                }
            };
            flowpanel.loadData(flowpanelData);

            if($('#x_flowJSON').val()!=""){
                flowpanel.clearData();
                flowpanel.loadData($.parseJSON($('#x_flowJSON').val()));
                alert("加载流程图成功");
            }
            flowpanel.setTitle($('#x_flowname').val());
            $('#flowpanel').css('backgroundColor','silver');
            $('#flowpanel').css('borderColor','silver');
           
            var obj = flowpanel.exportData();

            flowpanel.onExpandClick=function(){
                if(curnode==null) return;
                 var x=(curnode.offset().left+parseInt(curnode.css('width'),10))+'px';
                 var y=curnode.offset().top+'px';
                 tframe.css('left',x);
                 tframe.css('top',y);
                 tframe.attr('src','test_server.aspx?cid='+$('#x_cid').val()+'&amp;nid='+curnode.selector.substring(1));
                 tframe.css('display',(tframe.css('display')=='none'?'':'none'));
                 
            }

            flowpanel.onBtnSaveClick=function(){
                  $('#x_flowJSON').val(JSON.stringify(this.exportData()));
                  $('#updflow').click();
            }
            

            flowpanel.onItemFocus=function(id,type){
                 flowpanel.focusItem(id,false);
                 curnode=$("#"+id);
                 tframe.css('display','none');
            }
       });

&lt;/script&gt;</code></pre> 
</div> 
<h5 id="%E8%AE%BE%E7%BD%AE%E5%AE%A1%E6%89%B9%E4%BA%BA%E4%BF%A1%E6%81%AF">设置审批人信息</h5> 
<p>页面名称为test_server.aspx，在流程图主功能的JS代码部分有体现， 本示例代码包含后端、前端及 JS 代码，代码如下：</p> 
<div> 
 <pre><code class="language-cs">&lt;%@ Page Language="C#" AutoEventWireup="true" enableEventValidation="false" MaintainScrollPositionOnPostback="true"  ValidateRequest="FALSE" %&gt;
&lt;%@ Import Namespace="System.IO" %&gt;
&lt;%@ Import Namespace="System.Data" %&gt;
&lt;%@ Import Namespace="System.Data.SqlClient" %&gt;

&lt;script language="C#" runat="server"&gt;
    public CosysJaneCommonAPI.CODAL dal = new CosysJaneCommonAPI.CODAL();
    public DateTime dt = DateTime.Now;
    void Page_load(Object sender, EventArgs e)
    {
        dal.RunAt = Form;
        if (Page.IsPostBack == true) return;
        ArrayList paras = new ArrayList();
        dal.simpledatalist("select cid,nickname,name from accounts ", null, "cid", "name", sprlist, false, "", "");
        dal.simpledatalist("select cid,'抄送' name from accounts ", null, "cid", "name", spr2list, false, "", "");

        dal.RowsCount = 0;
        dal.ErrorMessage = "";
        string cid = Request.QueryString["cid"];
        string nodeid = Request.QueryString["nid"];
        paras.Clear();
        paras.Add(new SqlParameter("cid", cid));
        paras.Add(new SqlParameter("nodeid", nodeid));
        object rv = dal.GetDataSet("select AccountCid,nodeId,role from cc_flowNodeAccounts where projectCid=@cid and nodeId=@nodeid", paras);
        if (dal.RowsCount &gt; 0)
        {
            DataTable dt = (rv as DataSet).Tables[0];
            for (int i = 0; i &lt; dt.Rows.Count; i++)
            {
                string accountid = dt.Rows[i]["AccountCid"].ToString();
                string role = dt.Rows[i]["role"].ToString();
                ListItem li = sprlist.Items.FindByValue(accountid);
                if (li!=null)
                {
                    li.Selected = true;
                    if(role=="抄送"){
                        spr2list.Items.FindByValue(accountid).Selected = true;
                    }
                }
            }
        }

        
     }

    protected void saveflow_Click(object sender, EventArgs e)
    {
        string cid = Request.QueryString["cid"];
        string nodeid = Request.QueryString["nid"];

        ArrayList paras = new ArrayList();
        paras.Clear();
        paras.Add(new SqlParameter("cid", cid));
        paras.Add(new SqlParameter("nodeid", nodeid));
        dal.RowsCount = 0;
        dal.ErrorMessage = "";
        dal.ExecDbScripts("delete cc_flowNodeAccounts where projectCid=@cid and nodeId=@nodeid", paras);
        for (int i = 0; i &lt; sprlist.Items.Count; i++)
        {
            ListItem li = sprlist.Items[i];
            
            if (li.Selected==true)
            {
                paras.Clear();
                paras.Add(new SqlParameter("projectCid", cid));
                paras.Add(new SqlParameter("AccountCid", li.Value));
                paras.Add(new SqlParameter("nodeid", nodeid));
                paras.Add(new SqlParameter("role", (spr2list.Items[i].Selected==true?"抄送":"决策")  ));
                paras.Add(new SqlParameter("descript", li.Text));
                dal.RowsCount = 0;
                dal.ErrorMessage = "";
                dal.ExecDbScripts("insert into cc_flowNodeAccounts(projectCid,AccountCid,nodeId,role,descript) values(@projectCid,@AccountCid,@nodeid,@role,@descript) ", paras);
                Response.Write(dal.ErrorMessage);
            }
        }
        Alert(Form, "保存数据信息完成！");

    }

    protected void updflow_Click(object sender, EventArgs e)
    {

        ArrayList paras = new ArrayList();
        paras.Clear();
        paras.Add(new SqlParameter("cid", x_cid.Text));

    }

    protected void tooltab_SelectedIndexChanged(object sender, EventArgs e)
    {
        spr.Style["display"] = "none";
        sortnode.Style["display"] = "none";

        if (tooltab.SelectedValue == "0")
        {
            spr.Style["display"] = "";
        }else if (tooltab.SelectedValue == "1")
        {
            sortnode.Style["display"] = "";
        }
    }
    void SortRow(Object sender, EventArgs e)
    {
        Newtonsoft.Json.Linq.JObject jsonObj = Newtonsoft.Json.Linq.JObject.Parse(x_flowJSON.Text);

       
        string cid = Request.QueryString["cid"];


        ArrayList paras = new ArrayList();
        paras.Clear();
        paras.Add(new SqlParameter("cid", cid));
        dal.RowsCount = 0;
        dal.ErrorMessage = "";
        dal.ExecDbScripts("delete cc_flowNodes where projectCid=@cid ", paras);

        string[] la = sortstate1.Text.Split(',');
        int added = 0;
        for (int i = 0; i &lt; la.GetLength(0); i++)
        {
            if (la[i] != "")
            {
                paras.Clear();
                paras.Add(new SqlParameter("projectCid", cid));
                paras.Add(new SqlParameter("parentNodeId",(i==0?cid:la[i-1])) );
                paras.Add(new SqlParameter("nodeId", la[i]));
                paras.Add(new SqlParameter("nodeName", jsonObj["nodes"][la[i]]["name"].ToString()));
                paras.Add(new SqlParameter("sortid", i+1));
                dal.RowsCount = 0;
                dal.ErrorMessage = "";
                dal.ExecDbScripts("insert into cc_flowNodes(projectCid,parentNodeId,nodeId,nodeName,sortid) values(@projectCid,@parentNodeId,@nodeId,@nodeName,@sortid) ", paras);
                if (dal.RowsCount &gt; 0)
                {
                    added++;
                }
            }
        }
        paras.Clear();
        paras.Add(new SqlParameter("cid", cid));
        paras.Add(new SqlParameter("flowJSON", x_flowJSON.Text));
        paras.Add(new SqlParameter("nodeCount", added));
        dal.RowsCount = 0;
        dal.ErrorMessage = "";
        dal.ExecDbScripts("update cc_flow set flowJSON=@flowJSON,nodeCount=@nodeCount where cid=@cid ", paras);
        if (dal.RowsCount &gt; 0)
        {
        }
        else
        {
            Alert(Form, "保存流程数据信息失败！");
            return;
        }
        Alert(Form,"保存排序信息完毕！");
    }
    public void Alert(Control updatePanel, string msg)
    {

        msg = msg.Replace("\r\n", "").Replace("'", "\\'");
        ScriptManager.RegisterClientScriptBlock(updatePanel, this.GetType(), "", "alert('" + msg + "')", true);
    }
&lt;/script&gt;        

&lt;!DOCTYPE html&gt;
&lt;html lang="cn" &gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;title&gt;&lt;/title&gt;
&lt;/head&gt;

&lt;body style=" background-color:Gray"&gt;
  &lt;form runat="server"&gt;
  &lt;div style=" display:flex"&gt;
  &lt;asp:RadioButtonList ID="tooltab" AutoPostBack="true"   Font-Names="微软雅黑" 
          RepeatDirection="Horizontal" runat="server" 
          onselectedindexchanged="tooltab_SelectedIndexChanged" &gt;
          &lt;asp:ListItem Value="0" Text="审批人" Selected="True"&gt;&lt;/asp:ListItem&gt;
          &lt;asp:ListItem Value="1" Text="节点排序" &gt;&lt;/asp:ListItem&gt;

  &lt;/asp:RadioButtonList&gt;
  &lt;/div&gt;
  &lt;asp:Panel ID="spr" runat="server" Visible="true" BackColor="Silver"  &gt;
  &lt;div style=" display:flex"&gt;
      &lt;asp:CheckBoxList ID="sprlist" runat="server" Height="100px" ForeColor="White" Width="134px"&gt;
      &lt;/asp:CheckBoxList&gt;
      &lt;asp:CheckBoxList ID="spr2list" runat="server" Height="100px" BackColor="Gray" ForeColor="Silver" Width="134px"&gt;
      &lt;/asp:CheckBoxList&gt;

  &lt;asp:Button ID="updflow"  Text="更新项目" style=" display:none" runat="server" onclick="updflow_Click" &gt;&lt;/asp:Button&gt;
  &lt;asp:TextBox ID="x_cid" style=" display:none" ReadOnly="true" runat="server"&gt;&lt;/asp:TextBox&gt;
  &lt;/div&gt;
  &lt;div style=" display:flex"&gt;
      &lt;asp:Button ID="saveflow" style=" display:none1" Text="保存审批人" runat="server" onclick="saveflow_Click"&gt;&lt;/asp:Button&gt;
  &lt;/div&gt;
  &lt;/asp:Panel&gt;

  &lt;asp:Panel ID="sortnode" runat="server" Visible="true" style="display:none" BackColor="Silver"&gt;
  &lt;table border="0" width="100%" cellspacing="0" cellpadding="0" id="table1"&gt;
		&lt;tr&gt;
			&lt;td valign="top"&gt;
			&lt;div align="center"&gt;
			&lt;table border="0" width="94%" cellspacing="0" cellpadding="0" id="table2"&gt;
				&lt;tr&gt;
					&lt;td align="left" valign="top"&gt;
					&lt;asp:listbox id="funclist" ondblclick="SetValues(this)" 
                            style="border: 1px outset #6699FF; background-color: #FFFFFF;" Runat="server"
                            Height="328px" Width="405px" Font-Names="微软雅黑"/&gt;&lt;/td&gt;
					&lt;td&gt;
					&lt;p align="center"&gt;
					&lt;input id="moveUp" onclick="moveSelected(document.getElementById('funclist'), false)" type=button style="font-family:微软雅黑;" value="上移"/&gt;&lt;/p&gt;
					&lt;p align="center"&gt;
					&lt;input id="moveDown" onclick="moveSelected(document.getElementById('funclist'), true)" type=button style="font-family:微软雅黑;" value="下移"/&gt;&lt;/p&gt;
					&lt;p  align="center"&gt;&lt;input id="moveDown0" onclick="sortfunc()" type="button" value="保存"  style="font-family:微软雅黑;"/&gt;&lt;/p&gt;&lt;/td&gt;
				&lt;/tr&gt;
			&lt;/table&gt;
			&lt;/div&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
	&lt;/table&gt;
  &lt;/asp:Panel&gt;
&lt;asp:TextBox ID="sortstate"  Text="" style="display:none" Runat=server/&gt;
&lt;asp:TextBox ID="sortstate1"  Text="" style="display:none" Runat="server"/&gt;
&lt;asp:Button ID="sortbtn" Text="sort" OnClick="SortRow" style="display:none" Runat="server"/&gt;
  &lt;asp:TextBox ID="x_flowJSON" Rows="10" style="display:none"  width="100%" TextMode="MultiLine" runat="server"&gt;&lt;/asp:TextBox&gt;

  &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;script language="javascript" type="text/javascript"&gt;
    form = document.forms[0];
    function sortfunc() {
        if (!confirm('您确认保存排序结果吗？')) {
            return;
        }
        form.sortstate1.value = "";
        for (var i = 0; i &lt; form.funclist.length; i++) {
            var _id = form.funclist.options[i].value;
            flowpanel.$nodeData[_id].sortid = i;
            form.sortstate1.value += _id + ",";
        }
        //  return;
        form.sortstate.value = "1";
        var obj = flowpanel.exportData();
        form.x_flowJSON.value = JSON.stringify(obj);
        form.sortbtn.click();
    }
    function AddListBoxOption(obj, _text, _value) {
        newOption = document.createElement("OPTION");
        newOption.text = _text;
        newOption.value = _value;
        obj.options.add(newOption);
    }
    function moveSelected(select, down) {

        if (select.selectedIndex != -1) {
            if (down) {
                if (select.selectedIndex != select.options.length - 1)
                    var i = select.selectedIndex + 1;
                else
                    return;
            }
            else {
                if (select.selectedIndex != 0)
                    var i = select.selectedIndex - 1;
                else
                    return;
            }
            var swapOption = new Object();
            swapOption.text = select.options[select.selectedIndex].text;
            swapOption.value = select.options[select.selectedIndex].value;
            swapOption.selected = select.options[select.selectedIndex].selected;
            //    swapOption.defaultSelected = select.options[select.selectedIndex].defaultSelected;
            for (var property in swapOption)
                select.options[select.selectedIndex][property] = select.options[i][property];
            for (var property in swapOption)
                select.options[i][property] = swapOption[property];
        }
    }
    function jsonSort(array, field, reverse) {
        //数组长度小于2 或 没有指定排序字段 或 不是json格式数据
        if (array.length &lt; 2 || !field || typeof array[0] !== "object") return array;
        //数字类型排序
        if (typeof array[0][field] === "number") {
            array.sort(function (x, y) { return x[field] - y[field] });
        }
        //字符串类型排序
        if (typeof array[0][field] === "string") {
            array.sort(function (x, y) { return x[field].localeCompare(y[field]) });
        }
        //倒序
        if (reverse) {
            array.reverse();
        }
        return array;
    }
    var flowpanel = (window.parent.flowpanel);
    window.onload = function () {
        var obj = flowpanel.exportData();
        form.x_flowJSON.value = JSON.stringify(obj);

        var nodelist = document.getElementById('funclist');
        nodelist.length = 0;
        var sortid = 0;
        var obj2 = new Array();

        for (var i in obj.nodes) {
            flowpanel.$nodeData[i].id = i;
            obj2.push(flowpanel.$nodeData[i]);
        }
        var obj3 = jsonSort(obj2, 'sortid', false);
        for (var j = 0; j &lt; obj3.length;j++ ) {
            flowpanel.$nodeData[obj3[j].id].sortid = sortid;
            AddListBoxOption(nodelist, obj3[j].name, obj3[j].id);
            sortid++;
        }
    }

&lt;/script&gt;</code></pre> 
</div> 
<h5 id="%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C%E6%BC%94%E7%A4%BA">运行结果演示</h5> 
<p>代码正常运行后如下图所示：</p> 
<p><img alt="" height="1167" src="https://images2.imgbox.com/aa/9c/HURVQtFT_o.png" width="1200"></p> 
<h4 id="%E5%9F%BA%E7%A1%80%E4%BB%A3%E7%A0%81"></h4> 
<p>点击某一节点，点击控制栏最后的设置图标，会提供选择审批人的操作界面，如下图所示：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/b5/0e/riJJPj0j_o.png" width="1200"></p> 
<h4 id="%E5%BE%97%E5%88%B0%E6%96%87%E4%BB%B6Byte%5B%5D%E6%95%B0%E6%8D%AE%E6%96%B9%E6%B3%95"></h4> 
<h3 id="%E6%80%BB%E7%BB%93">总结</h3> 
<p>关于 GooFlow 的引用，请下载我的资源：</p> 
<p><a class="link-info" href="https://download.csdn.net/download/michaelline/89601233" title="https://download.csdn.net/download/michaelline/89601233">https://download.csdn.net/download/michaelline/89601233</a></p> 
<p>CosysJaneCommonAPI.CODAL 类的 dal.simpledatalist 方法需要在实际中自行改造，可参考我的文章：</p> 
<p><a class="link-info" href="https://blog.csdn.net/michaelline/article/details/138309618" title="《C# Web控件与数据感应之 ListControl 类》">《C# Web控件与数据感应之 ListControl 类》</a></p> 
<p>CosysJaneCommonAPI.CODAL 类的 dal.GetDataSet 方法需要在实际中自行改造，可参考我的文章：</p> 
<p></p> 
<p>CosysJaneCommonAPI.CODAL 类的 dal.ExecDbScripts 方法需要在实际中自行改造，可参考我的文章：</p> 
<p><a class="link-info" href="https://blog.csdn.net/michaelline/article/details/138282315" title="《C#利用IDbCommand实现通用数据库脚本执行程序》">《C#利用IDbCommand实现通用数据库脚本执行程序》</a></p> 
<p>代码这里仅供大家参考，欢迎大家评论指教！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/70ead8529cf1f80b809b0428c748d710/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【MySQL】库操作，数据类型</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3062b8a06296fe713c0ae14ef1b24946/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JavaEE 第3节 线程安全知识铺垫2</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>