<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>flink车联网项目前篇：数据开发（第66天） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/305f3b83c08d64a1dd53add810666ee1/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="flink车联网项目前篇：数据开发（第66天）">
  <meta property="og:description" content="系列文章目录 03_数据仓库开发
开发规范
1.1 数据库划分规范
1.2 表命名规范
1.3 表字段类型规范开发前准备
3.1 业务系统表
3.2 数据导入
04_维度主题相关表结构
1.1 dim_area - 城市字典表
1.2 dim_car_info - 车辆信息表
1.3 dim_car_vendor - 车队信息表
1.4 dim_date_work_type -节假日期类型表
1.5 dim_driver_info - 司机信息
1.6 dim_user_info -乘客维度信息表设计思路 文章目录 系列文章目录前言03_数据仓库开发1. 开发规范1.1 数据库划分规范1.2 表命名规范1.3 表字段类型规范 3. 开发前准备3.1 业务系统表3.2 数据导入 04_维度主题1. 相关表结构1.1 dim_area - 城市字典表1.2 dim_car_info - 车辆信息表1.3 dim_car_vendor - 车队信息表1.4 dim_date_work_type -节假日期类型表1.5 dim_driver_info - 司机信息1.6 dim_user_info -乘客维度信息表 2. 设计思路 前言 本文为flink车联网项目前期准备：数据仓库开发。由于篇幅过长，后续章节：业务实现
03_数据仓库开发 1.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-16T09:58:24+08:00">
    <meta property="article:modified_time" content="2024-08-16T09:58:24+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">flink车联网项目前篇：数据开发（第66天）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>系列文章目录</h2> 
<p>03_数据仓库开发</p> 
<ol><li>开发规范<br> 1.1 数据库划分规范<br> 1.2 表命名规范<br> 1.3 表字段类型规范</li><li>开发前准备<br> 3.1 业务系统表<br> 3.2 数据导入<br> 04_维度主题</li><li>相关表结构<br> 1.1 dim_area - 城市字典表<br> 1.2 dim_car_info - 车辆信息表<br> 1.3 dim_car_vendor - 车队信息表<br> 1.4 dim_date_work_type -节假日期类型表<br> 1.5 dim_driver_info - 司机信息<br> 1.6 dim_user_info -乘客维度信息表</li><li>设计思路</li></ol> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_0" rel="nofollow">系列文章目录</a></li><li><a href="#_23" rel="nofollow">前言</a></li><li><a href="#03__25" rel="nofollow">03_数据仓库开发</a></li><li><a href="#1_%09_26" rel="nofollow">1. 开发规范</a></li><li><ul><li><a href="#11_%09_27" rel="nofollow">1.1 数据库划分规范</a></li><li><a href="#12_%09_41" rel="nofollow">1.2 表命名规范</a></li><li><a href="#13_%09_58" rel="nofollow">1.3 表字段类型规范</a></li></ul> 
  </li><li><a href="#3_%09_69" rel="nofollow">3. 开发前准备</a></li><li><ul><li><a href="#31_%09_70" rel="nofollow">3.1 业务系统表</a></li><li><a href="#32_%09_74" rel="nofollow">3.2 数据导入</a></li></ul> 
  </li><li><a href="#04__78" rel="nofollow">04_维度主题</a></li><li><a href="#1_%09_80" rel="nofollow">1. 相关表结构</a></li><li><ul><li><a href="#11_%09dim_area___83" rel="nofollow">1.1 dim_area - 城市字典表</a></li><li><a href="#12_%09dim_car_info___86" rel="nofollow">1.2 dim_car_info - 车辆信息表</a></li><li><a href="#13_%09dim_car_vendor___91" rel="nofollow">1.3 dim_car_vendor - 车队信息表</a></li><li><a href="#14_%09dim_date_work_type__94" rel="nofollow">1.4 dim_date_work_type -节假日期类型表</a></li><li><a href="#15_%09dim_driver_info___97" rel="nofollow">1.5 dim_driver_info - 司机信息</a></li><li><a href="#16_%09dim_user_info__102" rel="nofollow">1.6 dim_user_info -乘客维度信息表</a></li></ul> 
  </li><li><a href="#2_%09_105" rel="nofollow">2. 设计思路</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_23"></a>前言</h2> 
<p>本文为flink车联网项目前期准备：数据仓库开发。由于篇幅过长，后续章节：业务实现</p> 
<h2><a id="03__25"></a>03_数据仓库开发</h2> 
<h2><a id="1_%09_26"></a>1. 开发规范</h2> 
<h3><a id="11_%09_27"></a>1.1 数据库划分规范</h3> 
<p>MySQL：dim/order/driver<br> VVP:<br> mysql：用于存放 flink 的 mysql 映射表信息<br> dw：用于存放 flink 的 Kafka 映射表信息<br> redis：用于存放 flink 的 redis 表映射信息<br> starrocks：用于存放 flink 的 starrocks表映射信息<br> Paimon:<br> ods：用于存放 ods 表信息及数据<br> dwd：用于存放 dwd 表信息及数据<br> dws：用于存放 dws 表信息及数据<br> ads：用于存放 ads 表信息及数据<br> dim：用于存放 dim 相关的表信息及数据<br> StarRocks：ads、dws</p> 
<h3><a id="12_%09_41"></a>1.2 表命名规范</h3> 
<p>命名规则：介质_分层_表含义<br>  介质：<br> mysql：mysql 映射表<br> paimon：paimon 表<br> kafka：kafka 映射表<br> mc：maxcompute 表<br> sr：starrocks 映射表<br> redis: redis映射表<br>  分层：<br> ods<br> dwd<br> dws<br> ads<br>  表含义：<br> 示例：order_info_all 订单信息总表</p> 
<h3><a id="13_%09_58"></a>1.3 表字段类型规范</h3> 
<ol><li>数量类型为bigint</li><li>金额类型为decimal，例decimal(20, 2)，表示：20位有效数字，其中小数部分2位</li><li>字符串(名字，描述信息等)类型为string</li><li>日期类型为string<br> 时间类型为datetime</li></ol> 
<ol start="2"><li>开发步骤<br> 因为维表和源表是共用的，所以先开发维表，然后开发源表；<br> 然后开发订单域的订单主题（实时），动态调价主题（实时），推荐上车点主题（离线）；<br> 然后开发司机主题（离线）、乘客主题（离线）、投诉申诉主题（离线）；<br> 最后开发日志流处理。</li></ol> 
<h2><a id="3_%09_69"></a>3. 开发前准备</h2> 
<h3><a id="31_%09_70"></a>3.1 业务系统表</h3> 
<p><img src="https://images2.imgbox.com/b7/9f/sVuqacNF_o.png" alt="在这里插入图片描述"></p> 
<p>我们一共有有23张表，其中dim库6张，order库10张，driver库7张。</p> 
<h3><a id="32_%09_74"></a>3.2 数据导入</h3> 
<p>打开mysql 客户端，运行4、load.sql脚本。<br> source /export/data/mysql/4、load.sql<br> 注意，每次运行这个脚本都会将历史数据更新到前31天的数据。如果需要将数据进行更新，则运行这个脚本即可。</p> 
<h2><a id="04__78"></a>04_维度主题</h2> 
<p>维度主题属于公共域，其实就是开发项目中用到的维度表。</p> 
<h2><a id="1_%09_80"></a>1. 相关表结构</h2> 
<p><img src="https://images2.imgbox.com/cf/ee/EvlfPiwS_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="11_%09dim_area___83"></a>1.1 dim_area - 城市字典表</h3> 
<p><img src="https://images2.imgbox.com/d4/c4/tKsipSBN_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="12_%09dim_car_info___86"></a>1.2 dim_car_info - 车辆信息表</h3> 
<p><img src="https://images2.imgbox.com/c0/40/yqueo0We_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/eb/5f/qYmwuF5a_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="13_%09dim_car_vendor___91"></a>1.3 dim_car_vendor - 车队信息表</h3> 
<p><img src="https://images2.imgbox.com/9e/73/fCTaIfOK_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="14_%09dim_date_work_type__94"></a>1.4 dim_date_work_type -节假日期类型表</h3> 
<p><img src="https://images2.imgbox.com/59/18/CW7ZcLvx_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="15_%09dim_driver_info___97"></a>1.5 dim_driver_info - 司机信息</h3> 
<p><img src="https://images2.imgbox.com/c7/7c/axAtEJ0o_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/9d/7e/N13fc0lq_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="16_%09dim_user_info__102"></a>1.6 dim_user_info -乘客维度信息表</h3> 
<p><img src="https://images2.imgbox.com/b2/b6/szzY2YaX_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2_%09_105"></a>2. 设计思路</h2> 
<p>因为维度表在实时任务和离线任务中都会用到，所以最好使用同一份数据，一方面避免重复开发，降低开发成本，另一方面可以做到数据的一致性。<br> 考虑到维度表的变化相对事实表来说比较缓慢，所以没有必要追求毫秒级更新，做到亚秒级更新即可。所以这里可以采用的技术方案就可以省掉Kafka，直接通过Flink CDC读取mysql数据，然后写入到Paimon表中，因为Paimon表支持增删改查，所以就对应最新的数据。如果维表加工时需要关联，流式读取Paimon表进行双流Join即可，这样就可以做到数据的亚秒级更新。<br> 另外，因为维度是变化的，为了保存这种变化信息，需要将数据进行快照保存，也就是每天将当日的维度信息导入到分区表中，这样在查询历史数据时就可以跟对应日期的数据进行关联，取到正确的数据。当然，如果数据不会变化，则不用同步到MaxCompute，如时间维度表。<br> 因为分区表的使用场景主要是离线关联，为了方便数据的存和取，这里直接使用MaxCompute作为存储介质。<br> <img src="https://images2.imgbox.com/cd/0b/PhirrJFO_o.png" alt="在这里插入图片描述"></p> 
<p>具体表的数据流转图如下：<br> <img src="https://images2.imgbox.com/07/b9/IcM4s8tE_o.png" alt="在这里插入图片描述"></p> 
<p>以dim_area为例展示如下：<br> <img src="https://images2.imgbox.com/f6/12/qUY3moAy_o.png" alt="在这里插入图片描述"></p> 
<p>项目中主要使用阿里云flink自带的catalog来管理flink的元数据，即vvp。对于paimon表，为了方便表的创建和管理，使用单独的paimon catalog，并为了和MaxCompute整合，将元数据保存到MaxCompute中一份。<br> MySQL注册表通过Flink SQL进行关联、转换等操作后插入到Paimon表中；Paimon表整合了MaxCompute，所以在MaxCompute中也可以进行查询；最后为了对维度数据进行快照备份，创建了 MaxCompute 分区表，表名后缀 table_i 。<br> 注意：<br> 表名后缀中 _f 表示全量表，_i 表示增量分区表。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e1fb325e359066e6c84e123a4b63e4bd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">灵办AI免费ChatGPT4人工智能浏览器插件快速便捷(多功能)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e0ebba8969940962ed751ea96659d15e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用flask遇到的问题及解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>