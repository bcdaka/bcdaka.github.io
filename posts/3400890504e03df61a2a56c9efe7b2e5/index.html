<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【C&#43;&#43;练级之路】【Lv.17】【STL】set类和map类的模拟实现 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/3400890504e03df61a2a56c9efe7b2e5/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【C&#43;&#43;练级之路】【Lv.17】【STL】set类和map类的模拟实现">
  <meta property="og:description" content="快乐的流畅：个人主页 个人专栏：《C游记》《数据结构世界》《进击的C&#43;&#43;》 远方有一堆篝火，在为久候之人燃烧！ 文章目录 引言一、红黑树（改造版）1.1 结点1.2 迭代器1.2.1 operator&#43;&#43;1.2.2 operator- - 1.3 本体1.3.1 成员变量1.3.2 begin和end1.3.3 Find1.3.4 Insert 二、set2.1 成员变量与仿函数2.2 begin和end2.3 find2.4 insert 三、map3.1 成员变量与仿函数3.2 begin和end3.3 find3.4 insert3.5 operator[ ] 引言 STL库中的set类和map类，其底层原理都是通过红黑树来实现的。尽管set和map可以各自实现一棵红黑树，但是为了提高代码的复用率，STL库中将红黑树进行了一定的改造，实现以相同的底层实现不同的容器。
一、红黑树（改造版） 1.1 结点 enum Color { RED, BLACK }; template&lt;class T&gt; struct RBTreeNode { RBTreeNode&lt;T&gt;* _left; RBTreeNode&lt;T&gt;* _right; RBTreeNode&lt;T&gt;* _parent; T _data; Color _col; RBTreeNode(const T&amp; data) : _left(nullptr) , _right(nullptr) , _parent(nullptr) , _data(data) , _col(RED) {} }; 细节：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-25T15:38:55+08:00">
    <meta property="article:modified_time" content="2024-07-25T15:38:55+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【C&#43;&#43;练级之路】【Lv.17】【STL】set类和map类的模拟实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><br><img src="https://images2.imgbox.com/47/e8/flW0z7In_o.png" alt=""></p> 
<p><br></p> 
<center> 
 <font color="SteelBlue" size="5"><strong> 快乐的流畅：<a href="https://blog.csdn.net/2301_79188764?spm=1011.2415.3001.5343">个人主页</a></strong></font> 
</center> 
<p></p> 
<p><br></p> 
<center> 
 <font color="DarkGreen"><strong> 个人专栏：<a href="https://blog.csdn.net/2301_79188764/category_12466894.html?spm=1001.2014.3001.5482">《C游记》</a><a href="https://blog.csdn.net/2301_79188764/category_12487455.html?spm=1001.2014.3001.5482">《数据结构世界》</a><a href="https://blog.csdn.net/2301_79188764/category_12516197.html?spm=1001.2014.3001.5482">《进击的C++》</a></strong></font> 
</center> 
<p></p> 
<center> 
 <font color="OrangeRed" size="4"><strong> 远方有一堆篝火，在为久候之人燃烧！</strong></font> 
</center> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_11" rel="nofollow">引言</a></li><li><a href="#_13" rel="nofollow">一、红黑树（改造版）</a></li><li><ul><li><a href="#11__14" rel="nofollow">1.1 结点</a></li><li><a href="#12__43" rel="nofollow">1.2 迭代器</a></li><li><ul><li><a href="#121_operator_88" rel="nofollow">1.2.1 operator++</a></li><li><a href="#122_operator__131" rel="nofollow">1.2.2 operator- -</a></li></ul> 
   </li><li><a href="#13__174" rel="nofollow">1.3 本体</a></li><li><ul><li><a href="#131__175" rel="nofollow">1.3.1 成员变量</a></li><li><a href="#132_beginend_191" rel="nofollow">1.3.2 begin和end</a></li><li><a href="#133_Find_228" rel="nofollow">1.3.3 Find</a></li><li><a href="#134_Insert_262" rel="nofollow">1.3.4 Insert</a></li></ul> 
  </li></ul> 
  </li><li><a href="#set_376" rel="nofollow">二、set</a></li><li><ul><li><a href="#21__377" rel="nofollow">2.1 成员变量与仿函数</a></li><li><a href="#22_beginend_398" rel="nofollow">2.2 begin和end</a></li><li><a href="#23_find_428" rel="nofollow">2.3 find</a></li><li><a href="#24_insert_437" rel="nofollow">2.4 insert</a></li></ul> 
  </li><li><a href="#map_448" rel="nofollow">三、map</a></li><li><ul><li><a href="#31__449" rel="nofollow">3.1 成员变量与仿函数</a></li><li><a href="#32_beginend_470" rel="nofollow">3.2 begin和end</a></li><li><a href="#33_find_508" rel="nofollow">3.3 find</a></li><li><a href="#34_insert_516" rel="nofollow">3.4 insert</a></li><li><a href="#35_operator__525" rel="nofollow">3.5 operator[ ]</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_11"></a>引言</h2> 
<p>STL库中的set类和map类，其底层原理都是<mark>通过红黑树来实现</mark>的。尽管set和map可以各自实现一棵红黑树，但是为了提高代码的复用率，STL库中将红黑树进行了一定的改造，实现<mark>以相同的底层实现不同的容器</mark>。</p> 
<h2><a id="_13"></a>一、红黑树（改造版）</h2> 
<h3><a id="11__14"></a>1.1 结点</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">enum</span> <span class="token class-name">Color</span>
<span class="token punctuation">{<!-- --></span>
	RED<span class="token punctuation">,</span>
	BLACK
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">RBTreeNode</span>
<span class="token punctuation">{<!-- --></span>
	RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> _left<span class="token punctuation">;</span>
	RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> _right<span class="token punctuation">;</span>
	RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> _parent<span class="token punctuation">;</span>
	T _data<span class="token punctuation">;</span>
	Color _col<span class="token punctuation">;</span>

	<span class="token function">RBTreeNode</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> data<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">_left</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_right</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_parent</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_col</span><span class="token punctuation">(</span>RED<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>细节：</p> 
<ul><li>将<mark>数据类型改为T</mark>，因为要同时适用set（存储键值）和map（存储键值对）</li></ul> 
<h3><a id="12__43"></a>1.2 迭代器</h3> 
<p>改造后的红黑树，最重要的功能之一就是<strong>支持双向迭代器</strong>，以最左结点为首，以最右结点为尾。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Ref</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Ptr</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">RBTreeIterator</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> RBTreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> Iterator<span class="token punctuation">;</span>
	<span class="token keyword">typedef</span> RBTreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Ref<span class="token punctuation">,</span> Ptr<span class="token operator">&gt;</span> Self<span class="token punctuation">;</span>
	Node<span class="token operator">*</span> _node<span class="token punctuation">;</span>

	<span class="token function">RBTreeIterator</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> node<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">_node</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

	<span class="token function">RBTreeIterator</span><span class="token punctuation">(</span><span class="token keyword">const</span> Iterator<span class="token operator">&amp;</span> it<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">_node</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>_node<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

	Ref <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> _node<span class="token operator">-&gt;</span>_data<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	Ptr <span class="token keyword">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Self<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> _node <span class="token operator">!=</span> s<span class="token punctuation">.</span>_node<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">==</span><span class="token punctuation">(</span><span class="token keyword">const</span> Self<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> _node <span class="token operator">==</span> s<span class="token punctuation">.</span>_node<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>细节：</p> 
<ol><li>一些基本的迭代器范式操作已经给出，重点的++与- -操作后面详细实现</li><li>迭代器的拷贝构造函数有两个用途： 
  <ul><li>以普通迭代器拷贝出普通迭代器（普通迭代器调用时）</li><li><mark>以普通迭代器拷贝出const迭代器</mark>（const迭代器调用时）</li></ul> </li></ol> 
<h4><a id="121_operator_88"></a>1.2.1 operator++</h4> 
<pre><code class="prism language-cpp">Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_node<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token comment">//右不为空，找右子树的最左结点</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> subLeft <span class="token operator">=</span> _node<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>subLeft<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			subLeft <span class="token operator">=</span> subLeft<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		_node <span class="token operator">=</span> subLeft<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span><span class="token comment">//右为空，向上找孩子是父亲左的那个父亲</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> parent <span class="token operator">=</span> _node<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _node<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_right <span class="token operator">==</span> cur<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cur <span class="token operator">=</span> parent<span class="token punctuation">;</span>
			parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		_node <span class="token operator">=</span> parent<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Self <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Self tmp <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token operator">++</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> tmp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d9/74/C9G5sYEG_o.png" alt=""></p> 
<p>细节：</p> 
<ol><li>前置++的思路： 
  <ul><li>右不为空，找右子树的最左结点</li><li>右为空，向上找孩子是父亲左的那个父亲</li></ul> </li><li>后置++：复用前置++，返回临时对象</li></ol> 
<h4><a id="122_operator__131"></a>1.2.2 operator- -</h4> 
<pre><code class="prism language-cpp">Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_node<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token comment">//左不为空，找左子树的最右结点</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> subRight <span class="token operator">=</span> _node<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>subRight<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			subRight <span class="token operator">=</span> subRight<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		_node <span class="token operator">=</span> subRight<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span><span class="token comment">//左为空，向上找孩子是父亲右的那个父亲</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> parent <span class="token operator">=</span> _node<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _node<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> cur<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cur <span class="token operator">=</span> parent<span class="token punctuation">;</span>
			parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		_node <span class="token operator">=</span> parent<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

Self <span class="token keyword">operator</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Self tmp <span class="token operator">=</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token operator">--</span><span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> tmp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3c/c6/Dlee2JRA_o.png" alt=""></p> 
<p>细节：</p> 
<ol><li>前置- -的思路： 
  <ul><li>左不为空，找左子树的最右结点</li><li>左为空，向上找孩子是父亲右的那个父亲</li></ul> </li><li>后置- -：复用前置- -，返回临时对象</li></ol> 
<h3><a id="13__174"></a>1.3 本体</h3> 
<h4><a id="131__175"></a>1.3.1 成员变量</h4> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KeyOfT</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">RBTree</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">protected</span><span class="token operator">:</span>
	<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
	Node<span class="token operator">*</span> _root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>细节：</p> 
<ol><li>模板参数第一个为K，键值类型（比较时会用到）</li><li>模板参数第二个为T，同时适用set（存储键值）和map（存储键值对）</li><li>模板参数第三个为KeyOfT（<strong>仿函数类型</strong>），用于<mark>获取不同数据T的键值key</mark>来进行比较</li></ol> 
<h4><a id="132_beginend_191"></a>1.3.2 begin和end</h4> 
<pre><code class="prism language-cpp"><span class="token keyword">typedef</span> RBTreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> iterator<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> RBTreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> const_iterator<span class="token punctuation">;</span>

iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

const_iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token function">const_iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

const_iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token function">const_iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>细节：begin返回最左节点的迭代器，end返回空迭代器</p> 
<h4><a id="133_Find_228"></a>1.3.3 Find</h4> 
<pre><code class="prism language-cpp">iterator <span class="token function">Find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	KeyOfT kot<span class="token punctuation">;</span>
	Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">kot</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span> <span class="token operator">&lt;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">kot</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span> <span class="token operator">&gt;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>细节：</p> 
<ol><li>返回迭代器</li><li>运用仿函数进行键值比较</li></ol> 
<h4><a id="134_Insert_262"></a>1.3.4 Insert</h4> 
<pre><code class="prism language-cpp">pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> data<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
		_root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token function">iterator</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	KeyOfT kot<span class="token punctuation">;</span>
	Node<span class="token operator">*</span> parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">kot</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">kot</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">kot</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">kot</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token function">iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	Node<span class="token operator">*</span> newnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cur <span class="token operator">=</span> newnode<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">kot</span><span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">kot</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> cur<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> grandparent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>grandparent<span class="token operator">-&gt;</span>_right <span class="token operator">==</span> parent<span class="token punctuation">)</span><span class="token comment">//uncle在左，parent在右</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandparent<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span><span class="token comment">//uncle为红，变色+向上调整</span>
			<span class="token punctuation">{<!-- --></span>
				parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
				grandparent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

				cur <span class="token operator">=</span> grandparent<span class="token punctuation">;</span>
				parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span><span class="token comment">//uncle为空或为黑，变色+旋转</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_right <span class="token operator">==</span> cur<span class="token punctuation">)</span><span class="token comment">//左单旋</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">RotateL</span><span class="token punctuation">(</span>grandparent<span class="token punctuation">)</span><span class="token punctuation">;</span>
					parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					grandparent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span><span class="token comment">//右左旋</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">RotateR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">RotateL</span><span class="token punctuation">(</span>grandparent<span class="token punctuation">)</span><span class="token punctuation">;</span>
					cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					grandparent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span><span class="token comment">//parent在左，uncle在右</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandparent<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
				grandparent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

				cur <span class="token operator">=</span> grandparent<span class="token punctuation">;</span>
				parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> cur<span class="token punctuation">)</span><span class="token comment">//右单旋</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">RotateR</span><span class="token punctuation">(</span>grandparent<span class="token punctuation">)</span><span class="token punctuation">;</span>
					parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					grandparent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span><span class="token comment">//左右旋</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">RotateL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">RotateR</span><span class="token punctuation">(</span>grandparent<span class="token punctuation">)</span><span class="token punctuation">;</span>
					cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					grandparent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	_root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token function">iterator</span><span class="token punctuation">(</span>newnode<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>细节：</p> 
<ol><li>返回pair，第一个参数为迭代器，第二个参数为布尔值（记录是否插入成功）</li><li>运用仿函数进行键值比较</li></ol> 
<h2><a id="set_376"></a>二、set</h2> 
<h3><a id="21__377"></a>2.1 成员变量与仿函数</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">set</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">struct</span> <span class="token class-name">SetKeyOfT</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">const</span> K<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> key<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
	RBTree<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> SetKeyOfT<span class="token operator">&gt;</span> _t<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>细节：</p> 
<ol><li>set类仿函数，直接返回参数key</li><li>成员变量的第二个模板参数为K，第三个模板参数为SetKeyOfT</li></ol> 
<h3><a id="22_beginend_398"></a>2.2 begin和end</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> SetKeyOfT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_iterator iterator<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> SetKeyOfT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_iterator const_iterator<span class="token punctuation">;</span>

iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

const_iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

const_iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>细节：</p> 
<ol><li>加上typename关键字，编译器才能识别类型</li><li>set中存储的键值key均不允许修改，所以<strong>其普通迭代器和const迭代器均为红黑树的const迭代器</strong></li><li>由于set的普通迭代器也是红黑树的const迭代器，调用普通begin()时，便有<mark>从普通迭代器到const迭代器的转换</mark>，此时之前写的拷贝构造（以普通迭代器拷贝构造const迭代器）便派上用场了。</li></ol> 
<h3><a id="23_find_428"></a>2.3 find</h3> 
<pre><code class="prism language-cpp">iterator <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="24_insert_437"></a>2.4 insert</h3> 
<pre><code class="prism language-cpp">pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>细节：</p> 
<ol><li>插入参数类型为K（键值）</li><li>此时也有<strong>从普通迭代器到const迭代器的转换</strong></li></ol> 
<h2><a id="map_448"></a>三、map</h2> 
<h3><a id="31__449"></a>3.1 成员变量与仿函数</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">map</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">struct</span> <span class="token class-name">MapKeyOfT</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">const</span> K<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
	RBTree<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapKeyOfT<span class="token operator">&gt;</span> _t<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>细节：</p> 
<ol><li>map类仿函数，返回参数pair的first</li><li>成员变量的第二个模板参数为pair，第三个模板参数为MapKeyOfT</li></ol> 
<h3><a id="32_beginend_470"></a>3.2 begin和end</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapKeyOfT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator iterator<span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapKeyOfT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_iterator const_iterator<span class="token punctuation">;</span>

iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

const_iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

const_iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>细节：</p> 
<ol><li>加上typename关键字，编译器才能识别类型</li><li>map同样不允许修改key，故加上const修饰，但是允许修改存储的value，所以普通和const迭代器一一对应</li></ol> 
<hr> 
<p>此时，可能有人会问，那刚刚set不允许修改key，为什么不也直接用const修饰呢？请看以下这段代码：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">typedef</span> RBTreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> const_iterator<span class="token punctuation">;</span>
</code></pre> 
<p>如果变成第二个模板参数T传入const K，那么就会形成两个连续的const，这是不被允许的。所以才想了其他方法来补救。</p> 
<h3><a id="33_find_508"></a>3.3 find</h3> 
<pre><code class="prism language-cpp">iterator <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="34_insert_516"></a>3.4 insert</h3> 
<pre><code class="prism language-cpp">pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>细节：插入参数类型为pair（键值对）</p> 
<h3><a id="35_operator__525"></a>3.5 operator[ ]</h3> 
<p>map最好用的重载运算符[ ]，我们肯定也要实现，平常插入和修改使用[ ]更加方便。</p> 
<pre><code class="prism language-cpp">V<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> ret <span class="token operator">=</span> _t<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token function">make_pair</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token function">V</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> ret<span class="token punctuation">.</span>first<span class="token operator">-&gt;</span>second<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>细节：</p> 
<ol><li>插入成功便是插入，插入失败便是查找+修改</li><li>返回value的引用，可以直接插入或修改</li></ol> 
<br> 
<p><img src="https://images2.imgbox.com/9c/22/QSBEjVdY_o.png" alt="" width="100" height="100"></p> 
<center> 
 <font color="SteelBlue" size="5"><strong> 真诚点赞，手有余香 </strong></font> 
</center> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/78da129953aed4b4c16407e0f9902ec5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">OpenSSL学习笔记及在项目中的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3147f59b2836c5690b0498e5214cd9d4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IEEE-Trans系列：TIV“倒下”，这本1区Top势头正猛，CCF-B类，国人友好，年发文1500！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>