<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MySQL—约束—外键约束中删除和更新行为（基础） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/57c0d56a36d4ee02b332a43e3939eff9/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="MySQL—约束—外键约束中删除和更新行为（基础）">
  <meta property="og:description" content="一、引言 上一个博客讲解并演示给字段加外键约束，以及通过外键来保证数据的一致性和完整性。我们一旦为子表 emp 字段 dept_id 添加外键关联之后，再去删除父表的数据之后，判断当前父表的这条数据是否在子表关联关系。如果存在，则不允许删除。
这里实际上涉及到外键约束当中的删除和更新行为。
二、外键约束（删除和更新行为） （1）主要的行为有以下情况。 注意：
1、NO ACTION：(no action) 和 RESTRICT (restrict：限制)
2、NO ACTION、RESTRICT 外键约束的默认行为
3、CASCADE：(cascade)，这个操作称为级联。如果有，也删除/更新外键在子表中的记录，也就是跟着父表字段值一起修改或删除。
4、SET NULL：如果有，则设置子表中该外键值为 NULL 。也就是断开关联，保证数据的一致性和正确性。
（特别注意前4个）
5、SET DEFAULT：父表变更，如果有外键，则子表将外键设置成一个默认值
（2）接下来展示，如何在创建外键的时候来指定它们的删除以及更新的规则或者是行为。 语法：
注意：
1、前一部分是添加外键的语法。（之前学过）
2、我们只要在之前学的操作语法后面再加上一些东西：
ON UPDATE：（on update 在更新时），然后可以在后面加上要选择的行为:如 CASCADE
ON DELETE：（on delete 在删除时），如上
三、实操 还是用之前建立的两张表：员工表 emp 和 部门表：dept 。
（1）数据准备 CREATE TABLE dept ( id INT AUTO_INCREMENT COMMENT &#39;ID&#39; PRIMARY KEY, name VARCHAR(50) NOT NULL COMMENT &#39;部门名称&#39; ) COMMENT &#39;部门表&#39;; INSERT INTO dept (id, name) VALUES (1,&#39;研发部&#39;),(2,&#39;市场部&#39;),(3,&#39;财务部&#39;),(4,&#39;销售部&#39;),(5,&#39;总经办&#39;); CREATE TABLE emp ( id INT AUTO_INCREMENT COMMENT &#39;ID&#39; PRIMARY KEY, name VARCHAR(50) NOT NULL COMMENT &#39;姓名&#39;, age INT COMMENT &#39;年龄&#39;, job VARCHAR(20) COMMENT &#39;职位&#39;, salary INT COMMENT &#39;薪资&#39;, entrydate DATE COMMENT &#39;入职时间&#39;, managerid INT COMMENT &#39;直属领导ID&#39;, dept_id INT COMMENT &#39;部门ID&#39; ) COMMENT &#39;员工表&#39;; INSERT INTO emp (id, name, age, job, salary, entrydate, managerid, dept_id) VALUES (1,&#39;金庸&#39;,66,&#39;总裁&#39;,20000,&#39;2000-01-01&#39;,null,5), (2,&#39;张无忌&#39;,20,&#39;项目经理&#39;,12500,&#39;2005-12-05&#39;,1,1), (3,&#39;杨逍&#39;,33,&#39;开发&#39;,8400,&#39;2000-11-03&#39;,2,1), (4,&#39;韦小笑&#39;,48,&#39;开发&#39;,11000,&#39;2002-02-05&#39;,2,1), (5,&#39;常遇春&#39;,43,&#39;项目经理&#39;,10500,&#39;2004-09-07&#39;,3,1), (6,&#39;小昭&#39;,19,&#39;程序员鼓励师&#39;,6600,&#39;2004-10-12&#39;,2,1); 部门表：dept">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-04T00:00:08+08:00">
    <meta property="article:modified_time" content="2024-06-04T00:00:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MySQL—约束—外键约束中删除和更新行为（基础）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4><span style="color:#0d0016;">一、引言</span></h4> 
<p><span style="color:#0d0016;">    上一个博客讲解并演示给字段加外键约束，以及通过外键来保证数据的一致性和完整性。我们一旦为子表 emp 字段 dept_id 添加外键关联之后，再去删除父表的数据之后，判断当前父表的这条数据是否在子表关联关系。如果存在，则不允许删除。</span></p> 
<p><span style="color:#0d0016;">这里实际上涉及到外键约束当中的</span><span style="color:#be191c;">删除和更新</span><span style="color:#0d0016;">行为。</span></p> 
<h4 style="background-color:transparent;"><span style="color:#0d0016;">二、外键约束（删除和更新行为）</span></h4> 
<h6 style="background-color:transparent;"><span style="color:#0d0016;">（1）主要的行为有以下情况。</span></h6> 
<p><img alt="" height="505" src="https://images2.imgbox.com/cc/30/YxAlHloy_o.png" width="1200"></p> 
<blockquote> 
 <p><span style="color:#be191c;">注意</span><span style="color:#0d0016;">：</span></p> 
 <p><span style="color:#0d0016;">1、NO ACTION：(no action) 和 RESTRICT (restrict：限制)</span></p> 
 <p><span style="color:#0d0016;">2、NO ACTION、RESTRICT 外键约束的默认行为</span></p> 
 <p><span style="color:#0d0016;">3、CASCADE：(cascade)，这个操作称为级联。如果有，也删除/更新外键在子表中的记录，</span><span style="color:#be191c;">也就是跟着父表字段值一起修改或删除</span><span style="color:#0d0016;">。</span></p> 
 <p><span style="color:#0d0016;">4、SET NULL：如果有，则</span><span style="color:#be191c;">设置子表中该外键值为 </span><span style="color:#0d0016;"><strong>NULL </strong>。也就是断开关联，保证数据的一致性和正确性。</span></p> 
 <p><span style="color:#0d0016;">（</span><span style="color:#be191c;">特别注意前4个</span><span style="color:#0d0016;">）</span></p> 
 <p><span style="color:#0d0016;">5、SET DEFAULT：父表变更，如果有外键，则子表将外键设置成一个默认值</span></p> 
</blockquote> 
<h6 style="background-color:transparent;"><span style="color:#0d0016;">（2）接下来展示，如何在创建外键的时候来指定它们的删除以及更新的规则或者是行为。</span></h6> 
<p><span style="color:#0d0016;">语法：</span></p> 
<p><img alt="" height="90" src="https://images2.imgbox.com/8b/89/L51yknzX_o.png" width="1200"></p> 
<blockquote> 
 <p><span style="color:#be191c;">注意</span><span style="color:#0d0016;">：</span></p> 
 <p><span style="color:#0d0016;">1、前一部分是添加外键的语法。（之前学过）</span></p> 
 <p><span style="color:#0d0016;">2、我们只要在之前学的操作语法后面再加上一些东西：</span></p> 
 <p><span style="color:#0d0016;"><strong>ON UPDATE</strong>：（on update 在更新时），然后可以在后面加上要选择的行为:如 <strong>CASCADE</strong></span></p> 
 <p><span style="color:#0d0016;"><strong>ON DELETE</strong>：（on delete 在删除时），如上</span></p> 
</blockquote> 
<h4><span style="color:#0d0016;">三、实操</span></h4> 
<p><span style="color:#0d0016;">还是用之前建立的两张表：员工表 <strong>emp</strong> 和 部门表：<strong>dept 。</strong></span></p> 
<blockquote> 
 <h6 style="background-color:transparent;"><span style="color:#0d0016;">（1）数据准备</span></h6> 
 <pre><code class="language-sql">CREATE TABLE dept (
    id INT AUTO_INCREMENT COMMENT 'ID' PRIMARY KEY,
    name VARCHAR(50) NOT NULL COMMENT '部门名称'
) COMMENT '部门表';
INSERT INTO dept (id, name) VALUES (1,'研发部'),(2,'市场部'),(3,'财务部'),(4,'销售部'),(5,'总经办');

CREATE TABLE emp (
    id INT AUTO_INCREMENT COMMENT 'ID' PRIMARY KEY,
    name VARCHAR(50) NOT NULL COMMENT '姓名',
    age INT COMMENT '年龄',
    job VARCHAR(20) COMMENT '职位',
    salary INT COMMENT '薪资',
    entrydate DATE COMMENT '入职时间',
    managerid INT COMMENT '直属领导ID',
    dept_id INT COMMENT '部门ID'
) COMMENT '员工表';

INSERT INTO emp (id, name, age, job, salary, entrydate, managerid, dept_id) VALUES (1,'金庸',66,'总裁',20000,'2000-01-01',null,5),
                                                                                   (2,'张无忌',20,'项目经理',12500,'2005-12-05',1,1),
                                                                                   (3,'杨逍',33,'开发',8400,'2000-11-03',2,1),
                                                                                   (4,'韦小笑',48,'开发',11000,'2002-02-05',2,1),
                                                                                   (5,'常遇春',43,'项目经理',10500,'2004-09-07',3,1),
                                                                                   (6,'小昭',19,'程序员鼓励师',6600,'2004-10-12',2,1);</code></pre> 
 <p><span style="color:#0d0016;">部门表：dept</span><img alt="" height="685" src="https://images2.imgbox.com/84/6c/q5ncXSim_o.png" width="1200"></p> 
 <p></p> 
 <p><span style="color:#0d0016;">员工表：emp</span><img alt="" height="717" src="https://images2.imgbox.com/3d/4f/puWkeqMI_o.png" width="1200"></p> 
</blockquote> 
<h6 style="background-color:transparent;"><span style="color:#0d0016;">（2） 开始操作</span></h6> 
<p><span style="color:#0d0016;">当前这两张表还没有任何的外键约束。</span></p> 
<p><span style="color:#0d0016;">接下来给他们建立外键约束，还有要指定它们的删除和更新行为。</span></p> 
<blockquote> 
 <h6 style="background-color:transparent;"><span style="color:#0d0016;">1、首先测试加的是：<strong>CASCADE</strong></span></h6> 
 <pre><code class="language-sql">/* add constraint 外键  括号里代表的外键字段 */
ALTER TABLE emp ADD CONSTRAINT fk_emp_dept_id FOREIGN KEY (dept_id) REFERENCES dept(id) ON UPDATE CASCADE ON DELETE CASCADE;</code></pre> 
 <p><img alt="" height="1200" src="https://images2.imgbox.com/11/35/u0B3yzlG_o.png" width="1200"></p> 
 <p><span style="color:#0d0016;">子表外键字段对应的值全部变成6，也就是因为父表的字段的值的更新。</span></p> 
 <p><img alt="" height="370" src="https://images2.imgbox.com/9b/4f/oHENhqPh_o.png" width="1200"></p> 
 <p></p> 
 <p><span style="color:#be191c;">注意：如果我把父表中的字段值删除了之后，子表中外键的值也会跟着删除！！！</span></p> 
</blockquote> 
<blockquote> 
 <h6 style="background-color:transparent;">2、 其次<span style="color:#0d0016;">测试加的是：<strong>SET NULL</strong></span></h6> 
 <p><span style="color:#0d0016;">在 DataGrip 中删除之前的两张表，再执行之前的SQL语句去重新创建这两张表。</span></p> 
 <pre><code class="language-sql">/* add constraint 外键  括号里代表的外键字段 */
ALTER TABLE emp ADD CONSTRAINT fk_emp_dept_id FOREIGN KEY (dept_id) REFERENCES dept(id) ON UPDATE SET NULL ON DELETE SET NULL;</code></pre> 
 <p><img alt="" height="1200" src="https://images2.imgbox.com/a4/1a/f7jjMtQr_o.png" width="1200"></p> 
 <p><span style="color:#0d0016;">子表外键字段对应的值全部变成null，也就是因为父表字段值的删除。</span></p> 
 <p><img alt="" height="1165" src="https://images2.imgbox.com/25/a2/dRzmbK3I_o.png" width="1200"></p> 
</blockquote> 
<h4 style="background-color:transparent;"><span style="color:#0d0016;">四、其次在工具 DataGrip 可以直接图形界面工具直接操作 </span></h4> 
<h6 style="background-color:transparent;"><span style="color:#0d0016;">1、第一步</span></h6> 
<p><img alt="" height="1111" src="https://images2.imgbox.com/b9/2f/vJnEA1cP_o.png" width="551"></p> 
<h6 style="background-color:transparent;"><span style="color:#0d0016;">2、第二步</span></h6> 
<p><img alt="" height="1191" src="https://images2.imgbox.com/96/6d/4xR2W07H_o.png" width="1182"></p> 
<p><span style="color:#0d0016;"> 到此关于这篇博客的外键约束的学习就结束了。</span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0d5f6f1dc06ff06541d53a5e7102e203/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43;设计模式-外观模式，游戏引擎管理多个子系统，反汇编</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0838232872059c00b0b2282b0b4ae77f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【RPG Maker MV 仿新仙剑 战斗场景UI （十）】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>