<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在Linux系统上使用nmcli命令配置各种网络（有线、无线、vlan、vxlan、路由、网桥等） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/2fdeba33b290608f73455306b60f9879/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="在Linux系统上使用nmcli命令配置各种网络（有线、无线、vlan、vxlan、路由、网桥等）">
  <meta property="og:description" content="前言：原文在我的博客网站中，持续更新数通、系统方面的知识，欢迎来访！
在Linux系统上使用nmcli命令配置各种网络（有线、无线、vlan、vxlan等）https://myweb.myskillstree.cn/123.html
1、更新于2024/5/13，新增Veth Pair配置
2、更新于2024/5/19，修复NetworkManager接管网络配置无效的错误
3、更新于2024/5/20，新增Ubuntu两种版本下NetworkManager接管网络的配置
目录
一、配置NetworkManager接管网络（选）
安装Network-Manager并启动
netplan管理网络的系统
ifupdown管理网络的系统
二、nmcli的相关配置（后置参数均可缩写）
有线网络配置
使用nmcli添加一个网卡并配置静态ip地址
激活/关闭网卡
使用nmcli修改一个网卡的地址
使用nmcli添加一个网卡配置使其获取动态ip地址
使用nmcli将已有的静态网卡配置修改为动态网卡配置
使用nmcli将已有的动态网卡配置修改为静态网卡配置
使用nmcli删除一个网卡配置信息
使用nmcli为一张网卡配置多个ip地址（从地址）
使用nmcli修改网卡设备的连接名称
无线网络配置（需要有无线网卡）
打开/关闭无线网络开关
查看无线网络开关状态：
连接无线网络
扫描可用的无线网络
连接到无线网络
查看连接状态
查看连接的详细信息
开启无线热点（AP模式）
查看当前无线网卡是否支持AP模式：
为无线网卡接口配置地址
安装dhcp服务
进行源地址转换SNAT
开启路由转发
重启DHCP服务和新建WiFi热点
其他设置：
VLAN相关配置
创建vlan
网桥Bridge配置
创建名为br-vxlan的网桥
VXLAN配置
单播模式（点对点）
多播模式（点对多点）
在host1配置，使用多播模式
在host2配置，使用多播模式
互ping测试
VXLAN&#43;网桥网络（Bridge）&#43;组播
host1创建vxlan&#43;bridge&#43;组播网络：
host2创建vxlan&#43;bridge&#43;组播网络：
Veth Pair配置
静态路由相关配置
三、总结
💡💡💡
你是否会遇到在不同的Linux系统中配置网络时，修改的配置文件和语法都不一样的烦恼呢？
各种不同的文件路径和语法，甚至Ubuntu系统中每隔几代网络配置文件就会变换位置和语法，这种情况非常不利于我们日常对系统的维护和管理。
对于这种情况，我们可以使用NetworkManager工具在不同的系统上进行统一语法的配置与管理
现阶段所发行的Linux版本基本都支持NetworkManager工具进行统一管理
如果配置时发生语法错误，该工具将会暂停修改该网络，不会造成配置文件错误而导致的一系列问题
甚至当你将原网络配置文件删除后，只要使用命令创建一个和原先参数一样的网络接口，该配置文件就会自动的重新生成
使用该工具配置的所有网络配置文件会存于/etc/NetworkManager/system-connections/目录下
PS：network-manager接管网络后使用nmcli命令修改网卡的相关配置后都会永久生效（重启网卡后依旧生效）
一、配置NetworkManager接管网络（选） 如果系统默认自带了NetworkManager工具就不用做此步，如果是后期手动安装的就需要配置接管网络
安装Network-Manager并启动 apt install network-manager -y systemctl restart NetworkManager systemctl enable NetworkManager 配置NetworkManager接管网络">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-07T10:24:27+08:00">
    <meta property="article:modified_time" content="2024-06-07T10:24:27+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在Linux系统上使用nmcli命令配置各种网络（有线、无线、vlan、vxlan、路由、网桥等）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>前言：</strong>原文在我的<a href="https://so.csdn.net/so/search?q=%E5%8D%9A%E5%AE%A2%E7%BD%91%E7%AB%99&amp;spm=1001.2101.3001.7020" title="博客网站">博客网站</a>中，持续更新数通、系统方面的知识，欢迎来访！</p> 
<p><a class="link-info has-card" href="https://myweb.myskillstree.cn/123.html" rel="nofollow" title="在Linux系统上使用nmcli命令配置各种网络（有线、无线、vlan、vxlan等）"><span class="link-card-box"><span class="link-title">在Linux系统上使用nmcli命令配置各种网络（有线、无线、vlan、vxlan等）</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/90/de/VuUymrhL_o.png" alt="icon-default.png?t=N7T8">https://myweb.myskillstree.cn/123.html</span></span></a></p> 
<p>        1、更新于2024/5/13，新增Veth Pair配置</p> 
<p>        2、更新于2024/5/19，修复NetworkManager接管网络配置无效的错误</p> 
<p>        3、更新于2024/5/20，新增Ubuntu两种版本下NetworkManager接管网络的配置</p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E9%85%8D%E7%BD%AENetworkManager%E6%8E%A5%E7%AE%A1%E7%BD%91%E7%BB%9C%EF%BC%88%E9%80%89%EF%BC%89-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E9%85%8D%E7%BD%AENetworkManager%E6%8E%A5%E7%AE%A1%E7%BD%91%E7%BB%9C%EF%BC%88%E9%80%89%EF%BC%89" rel="nofollow">一、配置NetworkManager接管网络（选）</a></p> 
<p id="%E5%AE%89%E8%A3%85Network-Manager%E5%B9%B6%E5%90%AF%E5%8A%A8-toc" style="margin-left:40px;"><a href="#%E5%AE%89%E8%A3%85Network-Manager%E5%B9%B6%E5%90%AF%E5%8A%A8" rel="nofollow">安装Network-Manager并启动</a></p> 
<p id="netplan%E7%AE%A1%E7%90%86%E7%BD%91%E7%BB%9C%E7%9A%84%E7%B3%BB%E7%BB%9F-toc" style="margin-left:40px;"><a href="#netplan%E7%AE%A1%E7%90%86%E7%BD%91%E7%BB%9C%E7%9A%84%E7%B3%BB%E7%BB%9F" rel="nofollow">netplan管理网络的系统</a></p> 
<p id="ifupdown%E7%AE%A1%E7%90%86%E7%BD%91%E7%BB%9C%E7%9A%84%E7%B3%BB%E7%BB%9F-toc" style="margin-left:40px;"><a href="#ifupdown%E7%AE%A1%E7%90%86%E7%BD%91%E7%BB%9C%E7%9A%84%E7%B3%BB%E7%BB%9F" rel="nofollow">ifupdown管理网络的系统</a></p> 
<p id="%E4%BA%8C%E3%80%81nmcli%E7%9A%84%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81nmcli%E7%9A%84%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE" rel="nofollow">二、nmcli的相关配置（后置参数均可缩写）</a></p> 
<p id="%E6%9C%89%E7%BA%BF%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#%E6%9C%89%E7%BA%BF%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE" rel="nofollow">有线网络配置</a></p> 
<p id="%E4%BD%BF%E7%94%A8nmcli%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E7%BD%91%E5%8D%A1%E5%B9%B6%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81ip%E5%9C%B0%E5%9D%80-toc" style="margin-left:80px;"><a href="#%E4%BD%BF%E7%94%A8nmcli%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E7%BD%91%E5%8D%A1%E5%B9%B6%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81ip%E5%9C%B0%E5%9D%80" rel="nofollow">使用nmcli添加一个网卡并配置静态ip地址</a></p> 
<p id="%E6%BF%80%E6%B4%BB%2F%E5%85%B3%E9%97%AD%E7%BD%91%E5%8D%A1-toc" style="margin-left:80px;"><a href="#%E6%BF%80%E6%B4%BB%2F%E5%85%B3%E9%97%AD%E7%BD%91%E5%8D%A1" rel="nofollow">激活/关闭网卡</a></p> 
<p id="%E4%BD%BF%E7%94%A8nmcli%E4%BF%AE%E6%94%B9%E4%B8%80%E4%B8%AA%E7%BD%91%E5%8D%A1%E7%9A%84%E5%9C%B0%E5%9D%80-toc" style="margin-left:80px;"><a href="#%E4%BD%BF%E7%94%A8nmcli%E4%BF%AE%E6%94%B9%E4%B8%80%E4%B8%AA%E7%BD%91%E5%8D%A1%E7%9A%84%E5%9C%B0%E5%9D%80" rel="nofollow">使用nmcli修改一个网卡的地址</a></p> 
<p id="%E4%BD%BF%E7%94%A8nmcli%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E4%BD%BF%E5%85%B6%E8%8E%B7%E5%8F%96%E5%8A%A8%E6%80%81ip%E5%9C%B0%E5%9D%80-toc" style="margin-left:80px;"><a href="#%E4%BD%BF%E7%94%A8nmcli%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E4%BD%BF%E5%85%B6%E8%8E%B7%E5%8F%96%E5%8A%A8%E6%80%81ip%E5%9C%B0%E5%9D%80" rel="nofollow">使用nmcli添加一个网卡配置使其获取动态ip地址</a></p> 
<p id="%E4%BD%BF%E7%94%A8nmcli%E5%B0%86%E5%B7%B2%E6%9C%89%E7%9A%84%E9%9D%99%E6%80%81%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E4%BF%AE%E6%94%B9%E4%B8%BA%E5%8A%A8%E6%80%81%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#%E4%BD%BF%E7%94%A8nmcli%E5%B0%86%E5%B7%B2%E6%9C%89%E7%9A%84%E9%9D%99%E6%80%81%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E4%BF%AE%E6%94%B9%E4%B8%BA%E5%8A%A8%E6%80%81%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE" rel="nofollow">使用nmcli将已有的静态网卡配置修改为动态网卡配置</a></p> 
<p id="%E4%BD%BF%E7%94%A8nmcli%E5%B0%86%E5%B7%B2%E6%9C%89%E7%9A%84%E5%8A%A8%E6%80%81%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E4%BF%AE%E6%94%B9%E4%B8%BA%E9%9D%99%E6%80%81%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#%E4%BD%BF%E7%94%A8nmcli%E5%B0%86%E5%B7%B2%E6%9C%89%E7%9A%84%E5%8A%A8%E6%80%81%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E4%BF%AE%E6%94%B9%E4%B8%BA%E9%9D%99%E6%80%81%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE" rel="nofollow">使用nmcli将已有的动态网卡配置修改为静态网卡配置</a></p> 
<p id="%E4%BD%BF%E7%94%A8nmcli%E5%88%A0%E9%99%A4%E4%B8%80%E4%B8%AA%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF-toc" style="margin-left:80px;"><a href="#%E4%BD%BF%E7%94%A8nmcli%E5%88%A0%E9%99%A4%E4%B8%80%E4%B8%AA%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF" rel="nofollow">使用nmcli删除一个网卡配置信息</a></p> 
<p id="%E4%BD%BF%E7%94%A8nmcli%E4%B8%BA%E4%B8%80%E5%BC%A0%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AAip%E5%9C%B0%E5%9D%80-toc" style="margin-left:80px;"><a href="#%E4%BD%BF%E7%94%A8nmcli%E4%B8%BA%E4%B8%80%E5%BC%A0%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AAip%E5%9C%B0%E5%9D%80" rel="nofollow">使用nmcli为一张网卡配置多个ip地址（从地址）</a></p> 
<p id="%E4%BD%BF%E7%94%A8nmcli%E4%BF%AE%E6%94%B9%E7%BD%91%E5%8D%A1%E8%AE%BE%E5%A4%87%E7%9A%84%E8%BF%9E%E6%8E%A5%E5%90%8D%E7%A7%B0-toc" style="margin-left:80px;"><a href="#%E4%BD%BF%E7%94%A8nmcli%E4%BF%AE%E6%94%B9%E7%BD%91%E5%8D%A1%E8%AE%BE%E5%A4%87%E7%9A%84%E8%BF%9E%E6%8E%A5%E5%90%8D%E7%A7%B0" rel="nofollow">使用nmcli修改网卡设备的连接名称</a></p> 
<p id="%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE%EF%BC%88%E9%9C%80%E8%A6%81%E6%9C%89%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1%EF%BC%89-toc" style="margin-left:40px;"><a href="#%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE%EF%BC%88%E9%9C%80%E8%A6%81%E6%9C%89%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1%EF%BC%89" rel="nofollow">无线网络配置（需要有无线网卡）</a></p> 
<p id="%E6%89%93%E5%BC%80%2F%E5%85%B3%E9%97%AD%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E5%BC%80%E5%85%B3-toc" style="margin-left:80px;"><a href="#%E6%89%93%E5%BC%80%2F%E5%85%B3%E9%97%AD%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E5%BC%80%E5%85%B3" rel="nofollow">打开/关闭无线网络开关</a></p> 
<p id="%E6%9F%A5%E7%9C%8B%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E5%BC%80%E5%85%B3%E7%8A%B6%E6%80%81%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E6%9F%A5%E7%9C%8B%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E5%BC%80%E5%85%B3%E7%8A%B6%E6%80%81%EF%BC%9A" rel="nofollow">查看无线网络开关状态：</a></p> 
<p id="%E8%BF%9E%E6%8E%A5%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C-toc" style="margin-left:80px;"><a href="#%E8%BF%9E%E6%8E%A5%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C" rel="nofollow">连接无线网络</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E6%89%AB%E6%8F%8F%E5%8F%AF%E7%94%A8%E7%9A%84%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C-toc" style="margin-left:120px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E6%89%AB%E6%8F%8F%E5%8F%AF%E7%94%A8%E7%9A%84%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C" rel="nofollow">扫描可用的无线网络</a></p> 
<p id="%E8%BF%9E%E6%8E%A5%E5%88%B0%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C-toc" style="margin-left:120px;"><a href="#%E8%BF%9E%E6%8E%A5%E5%88%B0%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C" rel="nofollow">连接到无线网络</a></p> 
<p id="%E6%9F%A5%E7%9C%8B%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81-toc" style="margin-left:120px;"><a href="#%E6%9F%A5%E7%9C%8B%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81" rel="nofollow">查看连接状态</a></p> 
<p id="%E6%9F%A5%E7%9C%8B%E8%BF%9E%E6%8E%A5%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF-toc" style="margin-left:120px;"><a href="#%E6%9F%A5%E7%9C%8B%E8%BF%9E%E6%8E%A5%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF" rel="nofollow">查看连接的详细信息</a></p> 
<p id="%E5%BC%80%E5%90%AF%E6%97%A0%E7%BA%BF%E7%83%AD%E7%82%B9%EF%BC%88AP%E6%A8%A1%E5%BC%8F%EF%BC%89-toc" style="margin-left:80px;"><a href="#%E5%BC%80%E5%90%AF%E6%97%A0%E7%BA%BF%E7%83%AD%E7%82%B9%EF%BC%88AP%E6%A8%A1%E5%BC%8F%EF%BC%89" rel="nofollow">开启无线热点（AP模式）</a></p> 
<p id="%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81AP%E6%A8%A1%E5%BC%8F%EF%BC%9A-toc" style="margin-left:120px;"><a href="#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81AP%E6%A8%A1%E5%BC%8F%EF%BC%9A" rel="nofollow">查看当前无线网卡是否支持AP模式：</a></p> 
<p id="%E4%B8%BA%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1%E6%8E%A5%E5%8F%A3%E9%85%8D%E7%BD%AE%E5%9C%B0%E5%9D%80-toc" style="margin-left:120px;"><a href="#%E4%B8%BA%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1%E6%8E%A5%E5%8F%A3%E9%85%8D%E7%BD%AE%E5%9C%B0%E5%9D%80" rel="nofollow">为无线网卡接口配置地址</a></p> 
<p id="%E5%AE%89%E8%A3%85dhcp%E6%9C%8D%E5%8A%A1-toc" style="margin-left:120px;"><a href="#%E5%AE%89%E8%A3%85dhcp%E6%9C%8D%E5%8A%A1" rel="nofollow">安装dhcp服务</a></p> 
<p id="%E8%BF%9B%E8%A1%8C%E6%BA%90%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2SNAT-toc" style="margin-left:120px;"><a href="#%E8%BF%9B%E8%A1%8C%E6%BA%90%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2SNAT" rel="nofollow">进行源地址转换SNAT</a></p> 
<p id="%E5%BC%80%E5%90%AF%E8%B7%AF%E7%94%B1%E8%BD%AC%E5%8F%91-toc" style="margin-left:120px;"><a href="#%E5%BC%80%E5%90%AF%E8%B7%AF%E7%94%B1%E8%BD%AC%E5%8F%91" rel="nofollow">开启路由转发</a></p> 
<p id="%E9%87%8D%E5%90%AFDHCP%E6%9C%8D%E5%8A%A1%E5%92%8C%E6%96%B0%E5%BB%BAWiFi%E7%83%AD%E7%82%B9-toc" style="margin-left:120px;"><a href="#%E9%87%8D%E5%90%AFDHCP%E6%9C%8D%E5%8A%A1%E5%92%8C%E6%96%B0%E5%BB%BAWiFi%E7%83%AD%E7%82%B9" rel="nofollow">重启DHCP服务和新建WiFi热点</a></p> 
<p id="%E5%85%B6%E4%BB%96%E8%AE%BE%E7%BD%AE%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E5%85%B6%E4%BB%96%E8%AE%BE%E7%BD%AE%EF%BC%9A" rel="nofollow">其他设置：</a></p> 
<p id="VLAN%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#VLAN%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE" rel="nofollow">VLAN相关配置</a></p> 
<p id="%E5%88%9B%E5%BB%BAvlan-toc" style="margin-left:80px;"><a href="#%E5%88%9B%E5%BB%BAvlan" rel="nofollow">创建vlan</a></p> 
<p id="%E7%BD%91%E6%A1%A5Bridge%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#%E7%BD%91%E6%A1%A5Bridge%E9%85%8D%E7%BD%AE" rel="nofollow">网桥Bridge配置</a></p> 
<p id="%E5%88%9B%E5%BB%BA%E5%90%8D%E4%B8%BAbr-vxlan%E7%9A%84%E7%BD%91%E6%A1%A5-toc" style="margin-left:80px;"><a href="#%E5%88%9B%E5%BB%BA%E5%90%8D%E4%B8%BAbr-vxlan%E7%9A%84%E7%BD%91%E6%A1%A5" rel="nofollow">创建名为br-vxlan的网桥</a></p> 
<p id="VXLAN%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#VXLAN%E9%85%8D%E7%BD%AE" rel="nofollow">VXLAN配置</a></p> 
<p id="%E5%8D%95%E6%92%AD%E6%A8%A1%E5%BC%8F%EF%BC%88%E7%82%B9%E5%AF%B9%E7%82%B9%EF%BC%89-toc" style="margin-left:80px;"><a href="#%E5%8D%95%E6%92%AD%E6%A8%A1%E5%BC%8F%EF%BC%88%E7%82%B9%E5%AF%B9%E7%82%B9%EF%BC%89" rel="nofollow">单播模式（点对点）</a></p> 
<p id="%E5%A4%9A%E6%92%AD%E6%A8%A1%E5%BC%8F%EF%BC%88%E7%82%B9%E5%AF%B9%E5%A4%9A%E7%82%B9%EF%BC%89-toc" style="margin-left:80px;"><a href="#%E5%A4%9A%E6%92%AD%E6%A8%A1%E5%BC%8F%EF%BC%88%E7%82%B9%E5%AF%B9%E5%A4%9A%E7%82%B9%EF%BC%89" rel="nofollow">多播模式（点对多点）</a></p> 
<p id="%E5%9C%A8host1%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%A4%9A%E6%92%AD%E6%A8%A1%E5%BC%8F-toc" style="margin-left:120px;"><a href="#%E5%9C%A8host1%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%A4%9A%E6%92%AD%E6%A8%A1%E5%BC%8F" rel="nofollow">在host1配置，使用多播模式</a></p> 
<p id="%E5%9C%A8host2%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%A4%9A%E6%92%AD%E6%A8%A1%E5%BC%8F-toc" style="margin-left:120px;"><a href="#%E5%9C%A8host2%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%A4%9A%E6%92%AD%E6%A8%A1%E5%BC%8F" rel="nofollow">在host2配置，使用多播模式</a></p> 
<p id="%E4%BA%92ping%E6%B5%8B%E8%AF%95-toc" style="margin-left:120px;"><a href="#%E4%BA%92ping%E6%B5%8B%E8%AF%95" rel="nofollow">互ping测试</a></p> 
<p id="VXLAN%2B%E7%BD%91%E6%A1%A5%E7%BD%91%E7%BB%9C%EF%BC%88Bridge%EF%BC%89%2B%E7%BB%84%E6%92%AD-toc" style="margin-left:80px;"><a href="#VXLAN%2B%E7%BD%91%E6%A1%A5%E7%BD%91%E7%BB%9C%EF%BC%88Bridge%EF%BC%89%2B%E7%BB%84%E6%92%AD" rel="nofollow">VXLAN+网桥网络（Bridge）+组播</a></p> 
<p id="host1%E5%88%9B%E5%BB%BAvxlan%2Bbridge%2B%E7%BB%84%E6%92%AD%E7%BD%91%E7%BB%9C%EF%BC%9A-toc" style="margin-left:120px;"><a href="#host1%E5%88%9B%E5%BB%BAvxlan%2Bbridge%2B%E7%BB%84%E6%92%AD%E7%BD%91%E7%BB%9C%EF%BC%9A" rel="nofollow">host1创建vxlan+bridge+组播网络：</a></p> 
<p id="host2%E5%88%9B%E5%BB%BAvxlan%2Bbridge%2B%E7%BB%84%E6%92%AD%E7%BD%91%E7%BB%9C%EF%BC%9A-toc" style="margin-left:120px;"><a href="#host2%E5%88%9B%E5%BB%BAvxlan%2Bbridge%2B%E7%BB%84%E6%92%AD%E7%BD%91%E7%BB%9C%EF%BC%9A" rel="nofollow">host2创建vxlan+bridge+组播网络：</a></p> 
<p id="Veth%20Pair%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#Veth%20Pair%E9%85%8D%E7%BD%AE" rel="nofollow">Veth Pair配置</a></p> 
<p id="%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE" rel="nofollow">静态路由相关配置</a></p> 
<p id="%E4%B8%89%E3%80%81%E6%80%BB%E7%BB%93-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E6%80%BB%E7%BB%93" rel="nofollow">三、总结</a></p> 
<hr id="hr-toc"> 
<p></p> 
<blockquote> 
 <p> 💡💡💡</p> 
 <p>    你是否会遇到在不同的Linux系统中配置网络时，修改的配置文件和语法都不一样的烦恼呢？</p> 
 <p>    各种不同的文件路径和语法，甚至Ubuntu系统中每隔几代网络配置文件就会变换位置和语法，这种情况非常不利于我们日常对系统的维护和管理。</p> 
 <p>    对于这种情况，我们可以使用NetworkManager工具在不同的系统上进行统一语法的配置与管理</p> 
 <p>    现阶段所发行的Linux版本基本都支持NetworkManager工具进行统一管理</p> 
 <p>    如果配置时发生语法错误，该工具将会暂停修改该网络，不会造成配置文件错误而导致的一系列问题</p> 
 <p>    甚至当你将原网络配置文件删除后，只要使用命令创建一个和原先参数一样的网络接口，该配置文件就会自动的重新生成</p> 
 <p>    使用该工具配置的所有网络配置文件会存于/etc/NetworkManager/system-connections/目录下</p> 
 <p>    PS：network-manager接管网络后使用nmcli命令修改网卡的相关配置后都会永久生效（重启网卡后依旧生效）</p> 
</blockquote> 
<h2 id="%E4%B8%80%E3%80%81%E9%85%8D%E7%BD%AENetworkManager%E6%8E%A5%E7%AE%A1%E7%BD%91%E7%BB%9C%EF%BC%88%E9%80%89%EF%BC%89">一、配置NetworkManager接管网络（选）</h2> 
<p>如果系统默认自带了NetworkManager工具就不用做此步，如果是后期手动安装的就需要配置接管网络</p> 
<h3 id="%E5%AE%89%E8%A3%85Network-Manager%E5%B9%B6%E5%90%AF%E5%8A%A8">安装Network-Manager并启动</h3> 
<pre><code class="language-bash">apt install network-manager -y
systemctl restart NetworkManager
systemctl enable NetworkManager</code></pre> 
<p>配置NetworkManager接管网络</p> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli net &lt;on/off&gt;</code></pre> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli net on</code></pre> 
<h3 id="netplan%E7%AE%A1%E7%90%86%E7%BD%91%E7%BB%9C%E7%9A%84%E7%B3%BB%E7%BB%9F">netplan管理网络的系统</h3> 
<p>如果是netplan管理网络的系统（如ubuntu22.04）需要在netplan中指定NetworkManager接管网络：</p> 
<pre><code class="language-bash">vim /etc/netplan/00-installer-config.yaml         # 每个系统的文件名都不一样，我这里叫00-installer-config.yaml 
# 在version下添加,注意开头对齐: 
renderer: NetworkManager
保存退出</code></pre> 
<p><img alt="" height="169" src="https://images2.imgbox.com/8d/18/2FRwpo5Z_o.png" width="329"></p> 
<p>使配置应用到系统中</p> 
<pre><code class="language-bash">netplan apply</code></pre> 
<h3 id="ifupdown%E7%AE%A1%E7%90%86%E7%BD%91%E7%BB%9C%E7%9A%84%E7%B3%BB%E7%BB%9F">ifupdown管理网络的系统</h3> 
<p>如果是ifupdown管理网络的系统（如<span style="color:#ed7976;"><strong><span style="background-color:#d7d8d9;">eve-ng</span></strong></span>或Ubuntu18.04）需要：</p> 
<p>        1、在NetworkManager配置中指定ifupdown也可管理网络，这样如果系统原先存在有网络连接，在NetworkManager接管后原网络连接依旧存在不改变：</p> 
<pre><code class="language-bash">vim /etc/NetworkManager/NetworkManager.conf
修改以下内容：
managed=true
保存退出</code></pre> 
<p><img alt="" height="126" src="https://images2.imgbox.com/32/66/YlbF4hr3_o.png" width="301"></p> 
<p>        2、创建.yaml文件并修改（如果原先存在有后缀为.yaml的文件，直接修改即可，没有的话再创建）</p> 
<pre><code class="language-bash">vim /etc/netplan/interface.yaml
添加以下内容：
network:
    version: 2
    renderer: NetworkManager
保存退出</code></pre> 
<p>        3、暂时关闭系统网络服务后使得netplan配置在系统生效并重启NetworkManager服务</p> 
<pre><code class="language-bash">systemctl stop systemd-networkd
netplan apply
systemctl restart NetworkManager
systemctl restart systemd-networkd</code></pre> 
<p>此时已经可以通过<span style="color:#ed7976;"><strong><span style="background-color:#d7d8d9;">nmcli</span></strong></span>管理网络了</p> 
<p>        使用<strong><span style="color:#ed7976;"><span style="background-color:#d7d8d9;">nmcli -p device</span></span></strong>查看设备状态  </p> 
<pre><code class="language-bash">nmcli -p device
============
  设备状态
============
DEVICE  TYPE      STATE   CONNECTION 
--------------------------------------------------
ens32   ethernet  已连接  有线连接 1 
lo      loopback  未托管  --         </code></pre> 
<h2 id="%E4%BA%8C%E3%80%81nmcli%E7%9A%84%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE">二、nmcli的相关配置（后置参数均可缩写）</h2> 
<h3 id="%E6%9C%89%E7%BA%BF%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE">有线网络配置</h3> 
<h4 id="%E4%BD%BF%E7%94%A8nmcli%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E7%BD%91%E5%8D%A1%E5%B9%B6%E9%85%8D%E7%BD%AE%E9%9D%99%E6%80%81ip%E5%9C%B0%E5%9D%80">使用nmcli添加一个网卡并配置静态ip地址</h4> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli con add con-name &lt;连接名&gt; ifname &lt;网卡名&gt; type &lt;连接类型&gt; ipv4.method manual ipv4.addresses &lt;ipv4地址&gt; ipv4.gateway &lt;ipv4网关地址&gt; ipv4.dns &lt;ipv4 dns服务器&gt;</code></pre> 
<p>       <strong><span style="color:#ed7976;"><span style="background-color:#d7d8d9;"> 注意：</span></span></strong>如果想要添加两个dns地址应该用双引号" "将两个地址包起来，表示两个地址都是DNS地址</p> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli con add con-name test ifname ens32 type ethernet ipv4.method manual ipv4.addresses 192.168.10.10/24 ipv4.gateway 192.168.10.2 ipv4.dns 192.168.10.2
 连接 "test" (3ceeec8a-d92c-42dd-ae10-2f5478eda991) 已成功添加</code></pre> 
<p>        此时静态地址就配置完成了,如果不进行指定则NetworkManager默认会在接口创建的时候自动开启该接口，当然我们也可以指定某个接口的打开和关闭状态</p> 
<h4 id="%E6%BF%80%E6%B4%BB%2F%E5%85%B3%E9%97%AD%E7%BD%91%E5%8D%A1">激活/关闭网卡</h4> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli con {up/down} &lt;连接名&gt;</code></pre> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli con up test 
 连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/2）</code></pre> 
<p>        查看网卡信息</p> 
<pre><code class="language-bash">nmcli con show
NAME        UUID                                  TYPE      DEVICE 
test        3ceeec8a-d92c-42dd-ae10-2f5478eda991  ethernet  ens32  
有线连接 1   b640bf63-ac94-3547-be75-8fac06083304  ethernet  --    </code></pre> 
<p><img alt="" height="653" src="https://images2.imgbox.com/59/5f/HmVRnkcn_o.png" width="1200"></p> 
<h4 id="%E4%BD%BF%E7%94%A8nmcli%E4%BF%AE%E6%94%B9%E4%B8%80%E4%B8%AA%E7%BD%91%E5%8D%A1%E7%9A%84%E5%9C%B0%E5%9D%80">使用nmcli修改一个网卡的地址</h4> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli con modify &lt;连接名&gt; ipv4.method manual ipv4.addresses &lt;新的ipv4地址&gt; ipv4.gateway &lt;新的ipv4网关地址&gt; ipv4.dns &lt;dns服务器&gt;</code></pre> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli con modify ens33 ipv4.method manual ipv4.addresses 192.168.10.20/24 ipv4.gateway 192.168.10.2 ipv4.dns 192.168.10.2</code></pre> 
<p>        刷新网卡并查看信息</p> 
<pre><code class="language-bash">nmcli con up test
ip add</code></pre> 
<p><img alt="" height="662" src="https://images2.imgbox.com/85/de/XKltEAfr_o.png" width="1200"></p> 
<h4 id="%E4%BD%BF%E7%94%A8nmcli%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E4%BD%BF%E5%85%B6%E8%8E%B7%E5%8F%96%E5%8A%A8%E6%80%81ip%E5%9C%B0%E5%9D%80">使用nmcli添加一个网卡配置使其获取动态ip地址</h4> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli con add con-name &lt;连接名&gt; ifname &lt;网卡名&gt; type &lt;连接类型&gt; ipv4.method auto</code></pre> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli con add con-name test ifname ens32 type ethernet ipv4.method auto
nmcli con up test                        # 激活网卡</code></pre> 
<h4 id="%E4%BD%BF%E7%94%A8nmcli%E5%B0%86%E5%B7%B2%E6%9C%89%E7%9A%84%E9%9D%99%E6%80%81%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E4%BF%AE%E6%94%B9%E4%B8%BA%E5%8A%A8%E6%80%81%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE">使用nmcli将已有的静态网卡配置修改为动态网卡配置</h4> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli con modify &lt;连接名&gt; ipv4.method auto</code></pre> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli con modify test ipv4.method auto
nmcli con up test</code></pre> 
<p>        然后需要将静态地址删除，否则使用ip add查看时会有两个地址出现</p> 
<pre><code class="language-bash">nmcli connection modify test ipv4.addresses "" ipv4.gateway ""  ipv4.dns ""       # 将test的静态地址设置为空，也就不存在了，只剩下了动态地址</code></pre> 
<p>        PS：需要先获取到dhcp地址才能删除原静态配置，否则会提示"ipv4.method=manual 不允许这个属性为空"</p> 
<p>        当然，如果觉得麻烦，也可以将原静态连接删除后直接添加新的动态地址配置，如下：</p> 
<pre><code class="language-bash">nmcli con del test
nmcli con add con-name test ifname ens32 type ethernet ipv4.method auto</code></pre> 
<h4 id="%E4%BD%BF%E7%94%A8nmcli%E5%B0%86%E5%B7%B2%E6%9C%89%E7%9A%84%E5%8A%A8%E6%80%81%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E4%BF%AE%E6%94%B9%E4%B8%BA%E9%9D%99%E6%80%81%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE">使用nmcli将已有的动态网卡配置修改为静态网卡配置</h4> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli con modify &lt;连接名&gt; ipv4.method manual ipv4.address &lt;IP地址/子网掩码&gt; ipv4.gateway &lt;网关&gt; ipv4.dns &lt;dns地址&gt;</code></pre> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli con modify test ipv4.method manual ipv4.address 192.168.10.20/24 ipv4.gateway 192.168.10.2 ipv4.dns 192.168.10.2
nmcli con up test</code></pre> 
<h4 id="%E4%BD%BF%E7%94%A8nmcli%E5%88%A0%E9%99%A4%E4%B8%80%E4%B8%AA%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF">使用nmcli删除一个网卡配置信息</h4> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli con del &lt;连接名&gt; </code></pre> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli con del test
 成功删除连接 "test" (3ceeec8a-d92c-42dd-ae10-2f5478eda991)</code></pre> 
<p>        查看网卡信息</p> 
<pre><code class="language-bash">nmcli con show
NAME        UUID                                  TYPE      DEVICE 
有线连接 1  b640bf63-ac94-3547-be75-8fac06083304  ethernet  ens32 </code></pre> 
<h4 id="%E4%BD%BF%E7%94%A8nmcli%E4%B8%BA%E4%B8%80%E5%BC%A0%E7%BD%91%E5%8D%A1%E9%85%8D%E7%BD%AE%E5%A4%9A%E4%B8%AAip%E5%9C%B0%E5%9D%80">使用nmcli为一张网卡配置多个ip地址（从地址）</h4> 
<p>        首先需要先创建一个连接使其获得静态或动态ip地址才能在此基础上增加地址，这里不再讲述配置静态或动态地址的命令，直接进行增加地址的配置</p> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli con modify &lt;连接名&gt; +ipv4.address &lt;ipv4地址&gt; ipv4.gateway &lt;网关&gt; ipv4.dns &lt;dns地址&gt;</code></pre> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli con modify ens32 +ipv4.address 192.168.10.160/24 ipv4.gateway 192.168.10.254 ipv4.dns 114.114.114.114
nmcli con up ens32</code></pre> 
<h4 id="%E4%BD%BF%E7%94%A8nmcli%E4%BF%AE%E6%94%B9%E7%BD%91%E5%8D%A1%E8%AE%BE%E5%A4%87%E7%9A%84%E8%BF%9E%E6%8E%A5%E5%90%8D%E7%A7%B0">使用nmcli修改网卡设备的连接名称</h4> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli con modify &lt;原连接名或UUID值&gt; connection.id &lt;新连接名&gt;</code></pre> 
<p>        示例：</p> 
<p>        先查看网卡设备的各项信息</p> 
<pre><code class="language-bash">nmcli con show
NAME        UUID                                  TYPE      DEVICE 

有线连接 1   b640bf63-ac94-3547-be75-8fac06083304  ethernet  ens32   </code></pre> 
<p>        修改网卡设备的连接名称为ens32</p> 
<pre><code class="language-bash">nmcli con modify b640bf63-ac94-3547-be75-8fac06083304 connection.id ens32</code></pre> 
<p>        再次查看网卡设备的各项信息，可以发现NAME这一栏的名称被修改了</p> 
<pre><code class="language-bash">nmcli con show
NAME        UUID                                  TYPE      DEVICE 

ens32       b640bf63-ac94-3547-be75-8fac06083304  ethernet  ens32   </code></pre> 
<h3 id="%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE%EF%BC%88%E9%9C%80%E8%A6%81%E6%9C%89%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1%EF%BC%89">无线网络配置（需要有无线网卡）</h3> 
<h4 id="%E6%89%93%E5%BC%80%2F%E5%85%B3%E9%97%AD%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E5%BC%80%E5%85%B3">打开/关闭无线网络开关</h4> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli radio all &lt;on/off&gt;</code></pre> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli radio all on</code></pre> 
<h4 id="%E6%9F%A5%E7%9C%8B%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C%E5%BC%80%E5%85%B3%E7%8A%B6%E6%80%81%EF%BC%9A">查看无线网络开关状态：</h4> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli radio &lt;all--默认&gt;</code></pre> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli radio 
  WIFI-HW  WIFI    WWAN-HW  WWAN   
  已启用   已启用  已启用   已启用 </code></pre> 
<h4 id="%E8%BF%9E%E6%8E%A5%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C">连接无线网络</h4> 
<h5 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E6%89%AB%E6%8F%8F%E5%8F%AF%E7%94%A8%E7%9A%84%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C">扫描可用的无线网络</h5> 
<pre><code class="language-bash">nmcli device wifi list</code></pre> 
<p>        这个命令会列出所有可用的无线网络及其详细信息。</p> 
<h5 id="%E8%BF%9E%E6%8E%A5%E5%88%B0%E6%97%A0%E7%BA%BF%E7%BD%91%E7%BB%9C">连接到无线网络</h5> 
<p>        如果您知道无线网络的 SSID（网络名称）和密码，可以直接连接：</p> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli dev wifi connect &lt;SSID&gt; password &lt;network-password&gt;</code></pre> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli device wifi con 李李密制十三香 password MySkillstree
  设备 "wlx0013ef6f25bd" 成功以 "c2d01c8d-47e5-41ee-8a3c-171aaddf53a8" 激活。</code></pre> 
<p>        如果您知道无线网络的 SSID（网络名称）但不想显示密码，可以加入-a 或 --ask参数，此参数会询问缺少的参数</p> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli -a device wifi con &lt;SSID&gt;</code></pre> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli -a device wifi con 李李密制十三香
  密码： ••••••••••••
  设备 "wlx0013ef6f25bd" 成功以 "afc44524-ba51-452b-ae51-21f2cd2b2f6f" 激活。</code></pre> 
<h5 id="%E6%9F%A5%E7%9C%8B%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81"><strong>查看连接状态</strong></h5> 
<p>        连接尝试后，您可以检查连接状态：</p> 
<pre><code class="language-bash">nmcli connection show
  NAME            UUID                                   TYPE      DEVICE          
  李李密制十三香   afc44524-ba51-452b-ae51-21f2cd2b2f6f   wifi      wlx0013ef6f25bd</code></pre> 
<h5 id="%E6%9F%A5%E7%9C%8B%E8%BF%9E%E6%8E%A5%E7%9A%84%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF">查看连接的详细信息</h5> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli connection show &lt;connetcion-name&gt;</code></pre> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli connection show  李李密制十三香</code></pre> 
<p> <img alt="" height="1094" src="https://images2.imgbox.com/fe/7e/gEjOypPY_o.png" width="1200"></p> 
<h4 id="%E5%BC%80%E5%90%AF%E6%97%A0%E7%BA%BF%E7%83%AD%E7%82%B9%EF%BC%88AP%E6%A8%A1%E5%BC%8F%EF%BC%89">开启无线热点（AP模式）</h4> 
<h5 id="%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81AP%E6%A8%A1%E5%BC%8F%EF%BC%9A">查看当前无线网卡是否支持AP模式：</h5> 
<p>安装iw命令</p> 
<pre><code class="language-bash">apt install iw -y</code></pre> 
<p>使用iw命令查看当前无线网卡是否支持AP模式</p> 
<pre><code class="language-bash">iw list
或
# iw list | grep -A 20 "Supported interface modes:" | grep -B 10 "Band 1:"</code></pre> 
<p>        查找到<span style="color:#ed7976;"><strong><span style="background-color:#d7d8d9;">Supported interface modes:</span></strong></span>字段下是否有<span style="color:#ed7976;"><strong><span style="background-color:#d7d8d9;">AP</span></strong></span>字样，有则代表该无线网卡支持AP模式</p> 
<p>添加无线网络并关闭自动连接</p> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli con add con-name &lt;连接名&gt; ifname &lt;网卡名&gt; type wifi 802-11-wireless.ssid &lt;SSID&gt; 802-11-wireless-security.key-mgmt &lt;wpa-psk/wpa-eap/ieee8021x/none&gt; 802-11-wireless-security.psk &lt;预共享密钥&gt; autoconnect &lt;on/off&gt;</code></pre> 
<p>        wpa-psk：这是使用预共享密钥（PSK）的WPA（Wi-Fi Protected Access）安全模式。这种模式要求所有客户端都使用相同的密码进行身份验证，是家庭和小型企业网络中常用的安全方式。wpa-psk后加psk参数和预共享密钥</p> 
<p>        wpa-eap：这是使用扩展认证协议（EAP）的WPA安全模式。结合WPA的安全性和802.1X的认证机制，通常用于需要更高安全性的场景，如企业网络。wpa-eap后可加的参数有：802-1x.eap、802-1x.phase2-auth、802-11-wireless-security.psk、802-1x.cert-path/802-1x.private-key-path、用户名和密码等</p> 
<p>        ieee8021x：这是使用802.1X认证协议的安全模式。在这种模式下，客户端需要通过认证服务器（如RADIUS服务器）进行身份验证。ieee8021x后可加的参数有：认证方法（如：802-1x.eap）、证书和私钥（如：EAP-TLS）、认证服务器（如：RADIUS服务器）、用户身份和密码（802-1x.identity指定用户名和802-1x.password指定密码）等</p> 
<p>        none：这表示不使用密钥管理，即无线网络不使用加密或身份验证。这种方式非常不安全，不建议在公共或未受保护的环境中使用</p> 
<p>        示例：</p> 
<p>        使用wpa-psk模式创建一个最常用的无线网络连接安全模式，我这里的无线网卡设备名为：wlx0013ef6f25bd</p> 
<pre><code class="language-bash">nmcli con add con-name MySkillstree ifname wlx0013ef6f25bd type wifi 802-11-wireless.ssid MySkillstree  802-11-wireless.mode ap 802-11-wireless-security.key-mgmt wpa-psk 802-11-wireless-security.psk a1234567 autoconnect no
  连接 "MySkillstree" (7f0c422d-644e-4c98-b615-8eac99304139) 已成功添加。</code></pre> 
<p>        以上配置命令过长和繁琐，可以简写为以下命令：</p> 
<pre><code class="language-bash">nmcli con add con-name MySkillstree ifname wlx0013ef6f25bd type wifi ssid MySkillstree mode ap wifi-sec.key-mgmt wpa-psk wifi-sec.psk a1234567 autoconnect no
  连接 "MySkillstree" (7f0c422d-644e-4c98-b615-8eac99304139) 已成功添加。</code></pre> 
<p>其中：</p> 
<p>        802-11-wireless.ssid 可缩写为 ssid</p> 
<p>        802-11-wireless.mode ap 可缩写为 mode ap</p> 
<p>        802-11-wireless-security 可缩写为 wifi-sec</p> 
<p>当然如果就只使用wpa-psk模式创建简单的个人热点，也可以使用device参数进行快速创建</p> 
<pre><code class="language-bash">nmcli device wifi hotspot con-name MySkillstree ifname wlx0013ef6f25bd ssid MySkillstree password a1234567
  设备 "wlan0" 成功以 "1facecb6-bf75-461a-b847-b63911bb3f61" 激活。
  提示："nmcli dev wifi show-password" 显示 Wi-Fi 名称和密码。</code></pre> 
<h5 id="%E4%B8%BA%E6%97%A0%E7%BA%BF%E7%BD%91%E5%8D%A1%E6%8E%A5%E5%8F%A3%E9%85%8D%E7%BD%AE%E5%9C%B0%E5%9D%80" style="background-color:transparent;">为无线网卡接口配置地址</h5> 
<pre><code class="language-bash">nmcli con modify MySkillstree ipv4.method manual ipv4.address 10.0.0.1/24</code></pre> 
<h5 id="%E5%AE%89%E8%A3%85dhcp%E6%9C%8D%E5%8A%A1">安装dhcp服务</h5> 
<p>        用于下发无线热点和管理连接到热点的设备的 DNS 和 DHCP(ubuntu、kali中为isc-dhcp-server，在centos中为dhcpd)</p> 
<pre><code class="language-bash">apt install isc-dhcp-server
vim /etc/dhcp/dhcpd.conf
修改以下内容：
subnet 10.0.0.0 netmask 255.255.255.0 {
  range 10.0.0.2 10.0.0.100; 
  option domain-name-servers 114.114.114.114;
  option subnet-mask 255.255.255.0;
  option routers 10.0.0.1; 
  option broadcast-address 10.0.0.255;
}
保存退出</code></pre> 
<p>        指定dhcp服务下发地址的物理接口（当系统中存在多个网卡设备，不做会报错）</p> 
<pre><code class="language-bash">vim /etc/default/isc-dhcp-server
修改以下内容：
INTERFACESv4="wlx0013ef6f25bd"
保存退出</code></pre> 
<h5 id="%E8%BF%9B%E8%A1%8C%E6%BA%90%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2SNAT">进行源地址转换SNAT</h5> 
<p>        网关默认是不知道我们自己创建的这个ip地址的，只有使用地址转换技术NAT将无线网卡上的收到的地址转换成我们连接公网的地址才能正常访问互联网</p> 
<pre><code class="language-bash">iptables -t nat -A POSTROUTING -s 10.0.0.0/24 -o ens32 -j MASQUERADE</code></pre> 
<p>        查看SNAT转换列表</p> 
<pre><code class="language-bash">iptables -t nat -nvL POSTROUTING
 Chain POSTROUTING (policy ACCEPT 0 packets, 0 bytes)
 pkts   bytes  target     prot opt  in     out      source               destination         
   0     0    MASQUERADE   0    --  *      ens32    10.0.0.0/24          0.0.0.0/0</code></pre> 
<h5 id="%E5%BC%80%E5%90%AF%E8%B7%AF%E7%94%B1%E8%BD%AC%E5%8F%91">开启路由转发</h5> 
<p>        Linux系统默认不转发路由，只有开启路由转发后才会转发其他网卡接受到的数据包</p> 
<pre><code class="language-bash">echo "net.ipv4.ip_forward = 1" &gt;&gt; /etc/sysctl.conf</code></pre> 
<h5 id="%E9%87%8D%E5%90%AFDHCP%E6%9C%8D%E5%8A%A1%E5%92%8C%E6%96%B0%E5%BB%BAWiFi%E7%83%AD%E7%82%B9">重启DHCP服务和新建WiFi热点</h5> 
<pre><code class="language-bash">systemctl restart isc-dhcp-server
nmcli con up MySkillstree</code></pre> 
<p>此时通过手机连接到热点后可以正确获取地址和上网</p> 
<p><img alt="" class="left" height="537" src="https://images2.imgbox.com/5d/0a/uvg73bCH_o.png" width="248"><img alt="" height="545" src="https://images2.imgbox.com/01/e1/TpgiffYj_o.png" width="252"></p> 
<p>这里还有一点要注意：</p> 
<p>        如果是外接的usb无线网卡到虚拟机内，有可能会导致驱动和内核不匹配，即使无线网卡支持AP模式也能正常连接WiFi，但是在开启个人热点时依旧会报错802.1x认证超时</p> 
<p>        当然以上情况会有但是不常见，但还是建议开启个人热点的话还是在自带wifi模块的Linux物理机上进行比较好</p> 
<h4 id="%E5%85%B6%E4%BB%96%E8%AE%BE%E7%BD%AE%EF%BC%9A">其他设置：</h4> 
<p>        对于其他设置如：动静态地址，修改连接名称，删除连接等均与有线网络设置一样，这里就不在讲述</p> 
<h3 id="VLAN%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE">VLAN相关配置</h3> 
<h4 id="%E5%88%9B%E5%BB%BAvlan">创建vlan</h4> 
<p>        创建一个vlan100接口并将物理网卡ens32绑定到vlan100中，这里的vlan是虚拟设备常被用做子接口配置，同样bond和team类型的网络接口也可以被配置为子接口</p> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli con add con-name &lt;连接名称&gt; ifname &lt;接口名称&gt; type vlan id &lt;vlan-id&gt; dev &lt;网卡设备&gt; ipv4.method manual ipv4.address &lt;ipv4地址&gt; ipv4.gateway &lt;网关&gt; ipv4.dns &lt;dns地址&gt;</code></pre> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli con add con-name vlan100 ifname vlan100 type vlan id 100 dev ens32 ipv4.method manual ipv4.address 192.168.100.100/24 ipv4.gateway 192.168.100.254 ipv4.dns 114.114.114.114</code></pre> 
<p><img alt="" height="942" src="https://images2.imgbox.com/0d/10/P0Pu5PKd_o.png" width="1200"></p> 
<h3 id="%E7%BD%91%E6%A1%A5Bridge%E9%85%8D%E7%BD%AE">网桥Bridge配置</h3> 
<p>        bridge 是内核提供的虚拟以太网桥，原理上类似于物理交换机，工作在第二层，可以将多个以太网接口连接在一起，使它们成为一个逻辑上的以太网段。这样，在同一个网桥上的设备可以直接通信，就像它们连接在同一个物理以太网上一样，同样也可以配置生成树（STP）协议</p> 
<p>        要注意的是，绑定为bridge上的成员接口都无法配置地址且可以和bridge共用一个地址，如果要配置地址进行通信，可以配置子接口进行通信</p> 
<h4 id="%E5%88%9B%E5%BB%BA%E5%90%8D%E4%B8%BAbr-vxlan%E7%9A%84%E7%BD%91%E6%A1%A5">创建名为br-vxlan的网桥</h4> 
<p>创建一个名为br-vxlan的网桥且不设置ip地址</p> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli con add con-name &lt;连接名&gt; ifname &lt;接口名&gt; type bridge ipv4.method disabled ipv6.method disabled</code></pre> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli con add con-name br0 ifname br0 type bridge ipv4.method disabled ipv6.method disabled</code></pre> 
<h3 id="VXLAN%E9%85%8D%E7%BD%AE">VXLAN配置</h3> 
<p>        VXLAN可将二层报文用四层协议进行封装，即在四层网络的基础上构建一个虚拟的二层网络进行二层通信，包括广播</p> 
<p><strong>注意！！！</strong></p> 
<p>        1、请事先关闭或放行防火墙和SELinux等</p> 
<p>        2、以下实验如果是两个ubuntu虚拟机且其中一个是克隆，配置VXLAN时当接口名称（ifname）一样时可能会出现两个vxlan接口的MAC地址一样的情况。</p> 
<p>        正常来讲Mac地址是唯一的，但是可能因为是vmware的小bug吧，导致罕见的Mac地址会冲突</p> 
<p>        此时可以更改接口名称（ifname）为其他的，只要VNI也就是vxlan的id值一样就不影响，或者使用工具将某一vxlan接口的mac地址修改但这种方法通常关机后会恢复</p> 
<p>        这种情况下使用wireshark抓包只能抓到对放发来的arp报文，但是没有arp回应报文，因为双方的mac地址一样，会被误以为是自己发的，就不会发送arp回复报文。</p> 
<h4 id="%E5%8D%95%E6%92%AD%E6%A8%A1%E5%BC%8F%EF%BC%88%E7%82%B9%E5%AF%B9%E7%82%B9%EF%BC%89">单播模式（点对点）</h4> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli con add con-name &lt;连接名&gt; ifname &lt;接口名&gt; type vxlan id &lt;vni&gt; local &lt;本地地址&gt; remote &lt;对端地址&gt; destination-port &lt;UDP端口，默认为4789&gt; dev &lt;设备名&gt; ipv4.method manual ipv4.address &lt;ipv4地址&gt; ipv4.gateway &lt;网关&gt; ipv4.dns &lt;dns地址&gt;</code></pre> 
<p>        示例：</p> 
<p>        创建名为 vxlan100 的 vxlan 接口，指定其 vni、对端 ip、目的 udp 端口和本设备上承载 vxlan 流量的物理接口</p> 
<pre><code class="language-bash">nmcli con add con-name vxlan100 ifname vxlan100 type vxlan id 100 local 192.168.10.100 remote 192.168.10.200 destination-port 4789 dev ens32 ipv4.method manual ipv4.address 172.16.0.1/24 ipv4.gateway 172.16.0.254
nmcli con up vxlan100 </code></pre> 
<p>        查看 vxlan0 的详细信息</p> 
<pre><code class="language-bash">ip -d link show vxlan100</code></pre> 
<p><img alt="" height="302" src="https://images2.imgbox.com/f1/17/BtyVZr5a_o.png" width="1200"></p> 
<p>        查看系统路由表会发现多了172.16.1.0/24网段的路由表</p> 
<pre><code class="language-bash">route -n
内核 IP 路由表
目标            网关            子网掩码        标志  跃点    引用     使用 接口
0.0.0.0         192.168.10.2    0.0.0.0         UG    100    0        0 ens32
0.0.0.0         172.16.0.254    0.0.0.0         UG    20500  0        0 vxlan100
169.254.0.0     0.0.0.0         255.255.0.0     U     1000   0        0 ens32
172.16.0.0      0.0.0.0         255.255.255.0   U     500    0        0 vxlan100
192.168.10.0    0.0.0.0         255.255.255.0   U     100    0        0 ens32</code></pre> 
<p>        查看vxlan的fdb表（转发表）</p> 
<pre><code class="language-bash">bridge fdb show dev vxlan100
    00:00:00:00:00:00 dst 192.168.10.200 via ens32 self permanent</code></pre> 
<p>        这个表项的意思是，默认的VTEP对端地址为 192.168.10.200。换句话说，原始报文经过vxlan0后，会被内核加上VXLAN头部，而外部UDP头部的目的IP地址为192.168.10.200（源VTEP封包过程）</p> 
<p>        <strong>此时对端设备也配置vxlan100</strong></p> 
<p>        保证VNI也是100，dstport也是4789，并<strong>修改VTEP的local和remote IP地址的值</strong></p> 
<pre><code class="language-bash">nmcli con add con-name vxlan100 ifname vxlan100 type vxlan id 100 local 192.168.10.200 remote 192.168.10.100 destination-port 4789 dev ens32 ipv4.method manual ipv4.address 172.16.0.2/24 ipv4.gateway 172.16.0.254
nmcli con up vxlan100</code></pre> 
<p>        ping测试</p> 
<pre><code class="language-bash">ping 172.16.0.2 -I 172.16.0.1</code></pre> 
<p><img alt="" height="451" src="https://images2.imgbox.com/83/0d/C9N2lt8X_o.png" width="1200"></p> 
<h4 id="%E5%A4%9A%E6%92%AD%E6%A8%A1%E5%BC%8F%EF%BC%88%E7%82%B9%E5%AF%B9%E5%A4%9A%E7%82%B9%EF%BC%89">多播模式（点对多点）</h4> 
<p>        要组成同一个VXLAN网络，VTEP必须能够感知到彼此的存在，多播组本身的功能就是把网络中的某个节点组成一个虚拟的组，所以VXLAN最初想到用多播来实现也是很自然的。</p> 
<p>        注意，如果VXLAN要使用多播，那么底层网络结构需要支持多播功能</p> 
<p>        本实验与前面的实验比较相似，只不过主机之间不是点对点的连接，而是通过多播组成一个虚拟的整体。</p> 
<h5 id="%E5%9C%A8host1%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%A4%9A%E6%92%AD%E6%A8%A1%E5%BC%8F"><strong>在host1配置，使用多播模式</strong></h5> 
<p>        此时参数remote应指定相同的多播地址（范围： 224.0.0.0~239.255.255.255）</p> 
<pre><code class="language-bash">nmcli con add con-name vxlan101 ifname vxlan101 type vxlan id 101 local 192.168.10.100 remote 239.1.1.1 destination-port 4789 dev ens32 ipv4.method manual ipv4.address 172.17.0.1/24 ipv4.gateway 172.17.0.254
nmcli con up vxlan101</code></pre> 
<h5 id="%E5%9C%A8host2%E9%85%8D%E7%BD%AE%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%A4%9A%E6%92%AD%E6%A8%A1%E5%BC%8F"><strong>在host2配置，使用多播模式</strong></h5> 
<p>        此时参数remote应指定相同的多播地址（范围： 224.0.0.0~239.255.255.255）</p> 
<pre><code class="language-bash">nmcli con add con-name vxlan101 ifname vxlan101 type vxlan id 101 local 192.168.10.200 remote 239.1.1.1 destination-port 4789 dev ens32 ipv4.method manual ipv4.address 172.17.0.2/24 ipv4.gateway 172.17.0.254
nmcli con up vxlan101</code></pre> 
<h5 id="%E4%BA%92ping%E6%B5%8B%E8%AF%95">互ping测试</h5> 
<p><img alt="" height="451" src="https://images2.imgbox.com/e0/0f/nMuEWTu9_o.png" width="1200"></p> 
<h4 id="VXLAN%2B%E7%BD%91%E6%A1%A5%E7%BD%91%E7%BB%9C%EF%BC%88Bridge%EF%BC%89%2B%E7%BB%84%E6%92%AD">VXLAN+网桥网络（Bridge）+组播</h4> 
<p>        上述的点对点 VXLAN 网络通信双方只有一个 VTEP，且只有一个通信实体，而在实际生产中（主要是云服务器），每台物理机上都有几十台甚至上百台虚拟机或容器需要通信，因此需要一种机制将这些通信实体组织起来，再通过隧道口 VTEP 转发出去。</p> 
<p>        方案其实也很常见，Linux Bridge 就可以将多块虚拟网卡连接起来，因此可以选择使用 Bridge 将多个虚拟机或容器放到同一个 VXLAN 网络中。和上面的模式相比，这里只是多了一个 Bridge，用来连接不同 network namespace （网络名称空间）中的 veth pair，同时 VXLAN 网卡也需要连接到该 Bridge</p> 
<p> <span style="color:#ed7976;"><strong><span style="background-color:#d7d8d9;"> 其实说大白话就是：</span></strong></span></p> 
<ul><li>点对点的是设备-1和设备-2的虚拟二层通信；</li><li>多播是多个设备之间的虚拟二层通信；</li><li>而VXLN+Bridge则多用于多设备内都开了很多虚拟机，这些虚拟机跨物理机之间的虚拟二层通信的云计算场景</li></ul> 
<p>题目：</p> 
<ul><li>在两台物理设备上创建网络命名空间ns0和ns1，veth pair</li><li>新建vxlan隧道，网桥名称为 br-vxlan,网桥的出口为vxlan103，id为103</li><li>设备-1的vxlan隧道地址为172.18.0.1/24，设备-2的vxlan隧道地址为172.18.0.2/24.</li><li>新建网桥bridge，将vxlan网络和veth pair绑定到bridge上</li><li>测试不同设备中命名空间内网络的二层联通性。</li></ul> 
<p><span style="color:#ed7976;"><strong><span style="background-color:#d7d8d9;">注意！！!</span></strong></span></p> 
<p>        以下实验如果是在两台ubuntu虚拟机上做的，且一台为克隆，最好将vxlan，bridge，veth pair的ifname修改，否则可能会有mac地址冲突的情况发生，会导致实验结果不通</p> 
<h5 id="host1%E5%88%9B%E5%BB%BAvxlan%2Bbridge%2B%E7%BB%84%E6%92%AD%E7%BD%91%E7%BB%9C%EF%BC%9A">host1创建vxlan+bridge+组播网络：</h5> 
<pre><code class="language-bash"># 创建vxlan网络，如果ipv6.method disabled不可用，也可以将disabled换成ignore，主要是为了让其不获取地址
nmcli con add con-name vxlan102 ifname vxlan102 type vxlan id 102 local 192.168.10.100 remote 239.1.1.1 destination-port 4789 dev ens32 ipv4.method disabled ipv6.method disabled
# 然后创建网桥 br0，把 VXLAN 网卡 vxlan102 绑定到上面，如果ipv6.method disabled不可用，也可以将disabled换成ignore，主要是为了让其不获取地址
nmcli con add con-name br0 ifname br0 type bridge ipv4.method disabled ipv6.method disabled
nmcli con modify vxlan102 master br0
# 刷新vxlan102
nmcli con up vxlan102
# 下面创建一对veth pair（veth0和veth1）
ip link add veth0 type veth peer name veth1
# 把veth pair一端veth0绑定到网桥
ip link set veth0 master br0
ip link set veth0 up
# 创建命名空间
ip netns add ns0
# 把veth pair一端veth1放到命名空间
ip link set dev veth1 netns ns0
# 给veth1设置ip
ip netns exec ns0 ip addr add 172.18.0.1/24 dev veth1
# 把veth1 和 lo up
ip netns exec ns0 ip link set lo up
ip netns exec ns0 ip link set veth1 up
# 查看 ns0 的网卡信息
ip netns exec ns0 ip add</code></pre> 
<h5 id="host2%E5%88%9B%E5%BB%BAvxlan%2Bbridge%2B%E7%BB%84%E6%92%AD%E7%BD%91%E7%BB%9C%EF%BC%9A">host2创建vxlan+bridge+组播网络：</h5> 
<pre><code class="language-bash"># 创建vxlan网络，如果ipv6.method disabled不可用，也可以将disabled换成ignore，主要是为了让其不获取地址
nmcli con add con-name vxlan102 ifname vxlan102 type vxlan id 102 local 192.168.10.200 remote 239.1.1.1 destination-port 4789 dev ens32 ipv4.method disabled ipv6.method disabled
# 然后创建网桥 br0，把 VXLAN 网卡 vxlan102 绑定到上面，如果ipv6.method disabled不可用，也可以将disabled换成ignore，主要是为了让其不获取地址
nmcli con add con-name br0 ifname br0 type bridge ipv4.method disabled ipv6.method disabled
nmcli con modify vxlan102 master br0
# 刷新vxlan102
nmcli con up vxlan102
# 下面创建一对veth pair（veth0和veth1）
ip link add veth0 type veth peer name veth1
# 把veth pair一端veth0绑定到网桥
ip link set veth0 master br0
ip link set veth0 up
# 创建命名空间
ip netns add ns1
# 把veth pair一端veth1放到命名空间
ip link set dev veth1 netns ns1
# 给veth1设置ip
ip netns exec ns1 ip addr add 172.18.0.2/24 dev veth1
# 把veth1 和 lo up
ip netns exec ns1 ip link set lo up
ip netns exec ns1 ip link set veth1 up
# 查看 ns1 的网卡信息
ip netns exec ns1 ip add</code></pre> 
<p>        互ping测试，隧道建立需要一定时间，可以耐心等一会</p> 
<p><img alt="" height="910" src="https://images2.imgbox.com/05/24/0ywpXMgi_o.png" width="1200"></p> 
<h3 id="Veth%20Pair%E9%85%8D%E7%BD%AE">Veth Pair配置</h3> 
<p>        Veth Pair是成对的虚拟网卡，使用ip命令可以创建但是在重启系统后就会失效，而nmcli命令创建的所有连接在重启系统后都还会生效</p> 
<p>        在centos7/8中并不支持使用nmcli命令配置，而在新版的ubuntu和kali中是支持的，预计在以后的发行版中也是会支持的</p> 
<p>添加一对Veth网卡</p> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli con add con-name &lt;连接名&gt; ifname &lt;网卡名&gt; type veth peer &lt;对端网卡名&gt;</code></pre> 
<p>        示例：</p> 
<p>        注意配置时需要配置一对</p> 
<pre><code class="language-bash">nmcli con add con-name veth0 ifname veth0 type veth peer veth1 
nmcli con add con-name veth1 ifname veth1 type veth peer veth0</code></pre> 
<p>        此时veth会默认关闭，可以通过添加之前内容中添加静态地址的方式添加相应的网卡配置后开启</p> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli con modify veth0 ipv4.method manual ipv4.address 192.168.10.10/24 nmcli con up veth0</code></pre> 
<p>        注意：</p> 
<p>        在Ubuntu上配置veth后，关机重启，该对veth中的一个会因为某种原因(暂时还不知道)无法连接，此时需要重启NetworkManager服务后重新打开该对veth网卡</p> 
<pre><code class="language-bash">systemctl restart NetworkManager 
nmcli con up veth0 
nmcli con up veth1</code></pre> 
<h3 id="%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE">静态路由相关配置</h3> 
<p>添加静态路由和优先级</p> 
<p>        语法：</p> 
<pre><code class="language-bash">nmcli con modify &lt;连接名&gt; ipv4.routes "&lt;目标网段/子网掩码&gt; &lt;下一跳&gt;"
或
nmcli con modify &lt;连接名&gt; ipv4.routes "&lt;目标网段/子网掩码&gt; &lt;下一跳&gt; &lt;优先级&gt;"
nmcli con up &lt;连接名&gt;</code></pre> 
<p>        示例：</p> 
<pre><code class="language-bash">nmcli con modify ens32 ipv4.routes "10.0.0.0/24 192.168.10.2 99"
nmcli con up ens32</code></pre> 
<p>        查看系统路由表</p> 
<pre><code>route -n</code></pre> 
<p>        删除静态路由</p> 
<p>        语法：</p> 
<pre><code>nmcli con modify &lt;连接名&gt; -ipv4.routes "&lt;目标网段/子网掩码&gt; &lt;下一跳&gt;"
nmcli con up &lt;连接名&gt;</code></pre> 
<p>        示例：</p> 
<pre><code>nmcli con modify ens32 -ipv4.routes "10.0.0.0/24 192.168.10.2"
nmcli con up ens32</code></pre> 
<p><strong>注意：</strong></p> 
<p>        1、在命令中如果未设置优先级则默认为100，默认路由的值不一定，有的为100有的为20100；</p> 
<p>        2、优先级越小越优先，如：100 &gt; 110</p> 
<p>        3、由网关生成的默认路由的优先级无法更改</p> 
<p>        4、删除静态路由无需添加优先级选项</p> 
<h2 id="%E4%B8%89%E3%80%81%E6%80%BB%E7%BB%93">三、总结</h2> 
<p>        本文所有内容都由我亲自试验并总结，如果有朋友转载，请标明出处</p> 
<p>        毕竟网上对于NetworkManager工具的各种解释都过于片面，也没有一个比较全面的示例，所以在本文上我还是耗费了很多的精力和时间的</p> 
<p>        这其中当属无线网络的AP模式开启和两个ubuntu系统配置Vxlan上最耗费时间</p> 
<p>        因为是虚拟机，会遇到各种各样的不适配或者其他bug，都需要一样找出问题来</p> 
<p>        目前这里暂时只展现这些最常用的配置示例，目的是为了让大家在以后面对各式各样的Linux系统时能够更便捷的进行统一的网络配置</p> 
<p>        当然后期也会逐渐对本文进行补充和更改，感谢支持！！！</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ce9d2a44e8885e49876230b64ba4741c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Python】文件处理的魔法之旅</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b10ef4f7acfd8babc185d76a23a17a1f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">mysql之如何获知版本</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>