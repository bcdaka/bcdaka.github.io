<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C语言详解（预编译） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9fe6c69ae9bfd2b2673e4c541ff25e76/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="C语言详解（预编译）">
  <meta property="og:description" content="Hi~！这里是奋斗的小羊，很荣幸您能阅读我的文章，诚请评论指点，欢迎欢迎 ~~
💥💥个人主页：奋斗的小羊
💥💥所属专栏：C语言
🚀本系列文章为个人学习笔记，在这里撰写成文一为巩固知识，二为展示我的学习过程及理解。文笔、排版拙劣，望见谅。
目录 前言1、预定义符号2、#define定义常量和标识符3、#define定义宏4、带有副作用的宏参数5、宏替换的规则6、宏和函数的对比7、#和##7.1 #运算符7.2 ##运算符 8、命名的约定9、#undef10、命令行定义11、条件编译12、头文件的包含12.1 头文件被包含的方式12.1.1 本地文件包含12.1.2 库文件包含 12.2 嵌套文件的包含 总结 前言 本篇文章将详细介绍编译过程中预编译的具体细节
在C语言的学习中部分人可能会忽视这一部分的学习，因为像VS这样相对强大的集成开发环境，我们在写好代码后只需要开始执行即可，所以部分人认为这一部分不值得我们花费时间去学习
其实不然，学习C语言预编译过程可以帮助我们更深入地了解C语言的编译过程和语法特性，提高代码编写的效率和质量，以及拓展编程技能
1、预定义符号 C语言设置了一些预定义符号，可以直接使用，预定义符号也是在预编译阶段处理的
__FILE__：正在编译的源文件的文件名__LINE__：文件当前的行号__DATE__：文件被编译的日期__TIME__：文件被编译的时间__STDC__：如果编译器遵循 ANSI C，其值为1，否则未定义 例如：
2、#define定义常量和标识符 #define定义的常量和标识符在预编译阶段完成替换
基本语法：
#define name stuff 特别的，为了区分普通常量这个name我们一般用大写形式
比如：
#define MAX 10000 #define REG register #define后面的代码理论上讲只能写一行，但是如果后面的代码过长，我们可以使用&#39;\&#39;来实现换行，相当于转义转义字符&#39;\&#39;转义了转义字符&#39;\n&#39;
#define DEBUG_PRINT printf(&#34;file:%s\tline:%d\t\ date:%s\ttime:%s\n,\ __FILE__,__LINE__,\ __DATE__,__TIME__) 值得注意的是，行末最好不要加;，在某些场景下是没什么问题，但是在大多数情况下是有语法错误的，所以我们要养成良好的编程习惯，行末不加;
3、#define定义宏 #define机制包括了一个规定，允许把参数替换到文本中，这种实现通常称为宏（macro）或定义宏（define macro）
基本语法：
#define name(parament_list) stuff 其中parament-list（参数列表）是一个由逗号隔开的符号表，它们可能出现在stuff中
注意： 参数列表的左括号必须与name紧邻，如果两者之间有任何空白存在，参数列表就会被解释为stuff的一部分
举例：输入一个数，输出它的平方数
#include &lt;stdio.h&gt; #define SQUARE(x) x*x int main() { int n = 0; scanf(&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-14T09:21:06+08:00">
    <meta property="article:modified_time" content="2024-06-14T09:21:06+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C语言详解（预编译）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p><em><strong>Hi~！这里是奋斗的小羊，很荣幸您能阅读我的文章，诚请评论指点，欢迎欢迎 ~~</strong></em><br> <strong>💥💥个人主页：<a href="https://blog.csdn.net/2301_78843337?type=blog">奋斗的小羊</a><br> 💥💥所属专栏：<a href="https://blog.csdn.net/2301_78843337/category_12630603.html">C语言</a></strong><br> <img src="https://images2.imgbox.com/36/5c/7ViDULA2_o.gif" alt=""></p> 
</blockquote> 
<blockquote> 
 <p><em><strong>🚀本系列文章为个人学习笔记，在这里撰写成文一为巩固知识，二为展示我的学习过程及理解。文笔、排版拙劣，望见谅。</strong></em></p> 
</blockquote> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_12" rel="nofollow">前言</a></li><li><ul><li><a href="#1_17" rel="nofollow">1、预定义符号</a></li><li><a href="#2define_29" rel="nofollow">2、#define定义常量和标识符</a></li><li><a href="#3define_51" rel="nofollow">3、#define定义宏</a></li><li><a href="#4_138" rel="nofollow">4、带有副作用的宏参数</a></li><li><a href="#5_205" rel="nofollow">5、宏替换的规则</a></li><li><a href="#6_252" rel="nofollow">6、宏和函数的对比</a></li><li><a href="#7_295" rel="nofollow">7、#和##</a></li><li><ul><li><a href="#71__296" rel="nofollow">7.1 #运算符</a></li><li><a href="#72__347" rel="nofollow">7.2 ##运算符</a></li></ul> 
   </li><li><a href="#8_383" rel="nofollow">8、命名的约定</a></li><li><a href="#9undef_389" rel="nofollow">9、#undef</a></li><li><a href="#10_407" rel="nofollow">10、命令行定义</a></li><li><a href="#11_418" rel="nofollow">11、条件编译</a></li><li><a href="#12_501" rel="nofollow">12、头文件的包含</a></li><li><ul><li><a href="#121__502" rel="nofollow">12.1 头文件被包含的方式</a></li><li><ul><li><a href="#1211__503" rel="nofollow">12.1.1 本地文件包含</a></li><li><a href="#1212__511" rel="nofollow">12.1.2 库文件包含</a></li></ul> 
    </li><li><a href="#122__522" rel="nofollow">12.2 嵌套文件的包含</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_556" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<p><img src="https://images2.imgbox.com/e5/d0/Sk9JObHS_o.gif" alt=""></p> 
<h2><a id="_12"></a>前言</h2> 
<p>本篇文章将详细介绍编译过程中<strong>预编译</strong>的具体细节<br> 在C语言的学习中部分人可能会忽视这一部分的学习，因为像VS这样相对强大的集成开发环境，我们在写好代码后只需要开始执行即可，所以部分人认为这一部分不值得我们花费时间去学习<br> 其实不然，学习C语言预编译过程可以帮助我们更深入地了解C语言的编译过程和语法特性，提高代码编写的效率和质量，以及拓展编程技能</p> 
<hr> 
<h3><a id="1_17"></a>1、预定义符号</h3> 
<p>C语言设置了一些预定义符号，可以直接使用，预定义符号也是在预编译阶段处理的</p> 
<ul><li><code>__FILE__</code>：正在编译的源文件的文件名</li><li><code>__LINE__</code>：文件当前的行号</li><li><code>__DATE__</code>：文件被编译的日期</li><li><code>__TIME__</code>：文件被编译的时间</li><li><code>__STDC__</code>：如果编译器遵循 ANSI C，其值为1，否则未定义</li></ul> 
<p>例如：</p> 
<p><img src="https://images2.imgbox.com/20/78/UqILfiEG_o.png" alt="在这里插入图片描述" height="250"></p> 
<hr> 
<h3><a id="2define_29"></a>2、#define定义常量和标识符</h3> 
<p><strong><code>#define</code>定义的常量和标识符在预编译阶段完成替换</strong></p> 
<p>基本语法：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">name</span> <span class="token expression">stuff</span></span>
</code></pre> 
<p>特别的，为了区分普通常量这个<code>name</code>我们一般用大写形式<br> 比如：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAX</span> <span class="token expression"><span class="token number">10000</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">REG</span> <span class="token expression"><span class="token keyword">register</span></span></span>
</code></pre> 
<p><code>#define</code>后面的代码理论上讲只能写一行，但是如果后面的代码过长，我们可以使用<code>'\'</code>来实现换行，相当于转义转义字符<code>'\'</code>转义了转义字符<code>'\n'</code></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DEBUG_PRINT</span> <span class="token expression"><span class="token function">printf</span><span class="token punctuation">(</span>"file<span class="token operator">:</span><span class="token operator">%</span>s\tline<span class="token operator">:</span><span class="token operator">%</span>d\t</span><span class="token punctuation">\</span>
							<span class="token expression">date<span class="token operator">:</span><span class="token operator">%</span>s\ttime<span class="token operator">:</span><span class="token operator">%</span>s\n<span class="token punctuation">,</span></span><span class="token punctuation">\</span>
							<span class="token expression"><span class="token constant">__FILE__</span><span class="token punctuation">,</span><span class="token constant">__LINE__</span><span class="token punctuation">,</span></span><span class="token punctuation">\</span>
							<span class="token expression"><span class="token constant">__DATE__</span><span class="token punctuation">,</span><span class="token constant">__TIME__</span><span class="token punctuation">)</span></span></span>
</code></pre> 
<p>值得注意的是，行末最好不要加<code>;</code>，在某些场景下是没什么问题，但是在大多数情况下是有语法错误的，所以我们要养成良好的编程习惯，<strong>行末不加<code>;</code></strong></p> 
<hr> 
<h3><a id="3define_51"></a>3、#define定义宏</h3> 
<p><code>#define</code>机制包括了一个规定，允许把参数替换到文本中，这种实现通常称为宏（macro）或定义宏（define macro）<br> 基本语法：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">name</span><span class="token expression"><span class="token punctuation">(</span>parament_list<span class="token punctuation">)</span> stuff</span></span>
</code></pre> 
<p>其中<code>parament-list</code>（参数列表）是一个由逗号隔开的符号表，它们可能出现在<code>stuff</code>中</p> 
<blockquote> 
 <p><strong>注意：</strong> 参数列表的左括号必须与<code>name</code>紧邻，如果两者之间有任何空白存在，参数列表就会被解释为<code>stuff</code>的一部分</p> 
</blockquote> 
<p>举例：输入一个数，输出它的平方数</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SQUARE</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> x<span class="token operator">*</span>x</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">SQUARE</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/33/28/BWHeB36a_o.png" alt="在这里插入图片描述" height="250"></p> 
<p>上面的代码看似没有什么问题，但当我们想计算<code>n+1</code>的平方数时，就会出现问题：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SQUARE</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> x<span class="token operator">*</span>x</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">SQUARE</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0d/aa/1VaSR8fu_o.png" alt="在这里插入图片描述" height="250"></p> 
<p>这是为什么呢？</p> 
<blockquote> 
 <p><strong>原因就是带参数的宏在替换的时候括号内的表达式是不做任何计算的</strong></p> 
</blockquote> 
<p>也就是说，上面替换后的形式是：<code>5 + 1 * 5 + 1</code>，为了解决这个问题，我们可以在定义宏的时候给<code>x</code>加上括号：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SQUARE</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span></span>
</code></pre> 
<p>这样替换后的结果就变成了：<code>(5 + 1)*(5 + 1)</code>，但是这样给单独的参数加括号的形式在某些场景下还是存在问题，比如：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SQUARE</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token function">SQUARE</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c9/ba/pHmwU0T2_o.png" alt="在这里插入图片描述" height="200"></p> 
<p>那为了解决这个问题，我们可以（x）+（x）整体加上括号：<code>((x) + (x))</code></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SQUARE</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token function">SQUARE</span><span class="token punctuation">(</span>n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/20/88/O90LgFOQ_o.png" alt="在这里插入图片描述" height="200"></p> 
<blockquote> 
 <p><strong>所以，在写宏的时候一定不要吝啬括号</strong></p> 
</blockquote> 
<hr> 
<h3><a id="4_138"></a>4、带有副作用的宏参数</h3> 
<p>当宏参数在宏的定义中出现超过一次的时候，如果参数带有副作用，那么你在使用这个宏的时候就可能出现危险，导致不可预测的后果，<strong>副作用就是表达式求值的时候出现的永久性效果</strong><br> 例如：</p> 
<blockquote> 
 <ul><li><strong>x + 1; //不带副作用</strong></li><li><strong>x++; //带有副作用</strong></li></ul> 
</blockquote> 
<p>上面两个表达式的值是相同的，但是第一个表达式<code>x</code>的本身没有发生改变，而第二个表达式<code>x</code><strong>本身发现了改变，这就是副作用</strong></p> 
<p>例如：使用宏实现求两个数的较大值</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">MAX</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">MAX</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/39/d2/GdlioYtb_o.png" alt="在这里插入图片描述" height="200"></p> 
<p>上面代码中宏参数在宏定义中出现了两次，我们使用<code>MAX(a, b);</code>时没什么问题，但当我们使用<code>MAX(a++, b++);</code>时问题就会出现：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">MAX</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">MAX</span><span class="token punctuation">(</span>a<span class="token operator">++</span><span class="token punctuation">,</span> b<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a = %d, b = %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/23/ae/WJBEJEkP_o.png" alt="在这里插入图片描述" height="300"></p> 
<p>可以发现a和b的值会发生改变，就是表达式求值的时候出现了永久性效果。</p> 
<p><strong>与函数对比：</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">MAX</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a = %d, b = %d\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> y <span class="token operator">?</span> x <span class="token operator">:</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">MAX</span><span class="token punctuation">(</span>a<span class="token operator">++</span><span class="token punctuation">,</span> b<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5e/b2/dM2YdMwS_o.png" alt="请添加图片描述" height="250"></p> 
<p>从上面的代码中可以看出来，带参数的宏替换和函数传参是非常相似的，但是它们的传参是有本质区别的。<br> 带参数的宏替换是直接将参数做<strong>整体替换</strong>，替换过后的表达式是：<code>((a++)&gt;(b++)?(a++):(b++))</code>；而函数参过后的表达式是：<code>(a &gt; b ? a : b)</code>。</p> 
<hr> 
<h3><a id="5_205"></a>5、宏替换的规则</h3> 
<p>在程序中扩展<code>#define</code>定义符号和宏时，需要涉及几个步骤。</p> 
<blockquote> 
 <ul><li>在调用宏时，首先对参数进行检查，看看是否包含任何由<code>#define</code>定义的符号，如果有，它们首先被替换</li><li>替换文本随后被插入到程序中原来文本的位置，对于宏，参数名被他们的值所替换</li><li>最后，再次对结果文件进行扫描，看看是否包含任何由<code>#define</code>定义的符号，如果有，重复上述步骤</li></ul> 
</blockquote> 
<p>例如：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">M</span> <span class="token expression"><span class="token number">10</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">N</span> <span class="token expression">M <span class="token operator">+</span> <span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">MAX</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> ret <span class="token operator">=</span> <span class="token function">MAX</span><span class="token punctuation">(</span>M<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>MAX(M, N)</code>首先被替换成：<code>((10)&gt;(M + 2)?(10):(M + 2))</code><br> 然后<code>((10)&gt;(M + 2)?(10):(M + 2))</code>再被替换成：<code>((10)&gt;(10 + 2)?(10):(10 + 2))</code></p> 
<p><strong>注意：</strong></p> 
<blockquote> 
 <ul><li><strong>宏参数和<code>#define</code>定义中可以出现其他<code>#define</code>定义的符号，但宏不能实现递归</strong></li></ul> 
</blockquote> 
<p>比如：<code>#define N M + 2</code>这个是可以的，但<code>#define N N + 2</code>是不行的。</p> 
<blockquote> 
 <ul><li>当预处理器搜索<code>#define</code>定义的符号时，字符串常量的内容并不被搜索</li></ul> 
</blockquote> 
<p>比如：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">M</span> <span class="token expression"><span class="token number">10</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">N</span> <span class="token expression">M <span class="token operator">+</span> <span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">MAX</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"MAX(M, N)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2f/31/aluvmR7A_o.png" alt="请添加图片描述" height="200"></p> 
<p>可以看到宏<code>MAX(M, N)</code>并没有展开。</p> 
<hr> 
<h3><a id="6_252"></a>6、宏和函数的对比</h3> 
<blockquote> 
 <p><em><strong>宏通常被应用于执行简单的运算。</strong></em></p> 
</blockquote> 
<p>比如在两个数中找较大数，用宏实现更有优势：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">MAX</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
</code></pre> 
<p>那为什么不用函数呢？原因有二：</p> 
<ol><li>用于调用函数和从函数返回的代码可能比实际执行这个小型计算工作需要的时间更多，函数调用还需要一些入栈出栈的过程，所以<strong>宏比函数在程序的规模和速度方面更胜一筹</strong>。</li><li>更为重要的是函数的参数必须声明为特定的类型，所以函数只能在类型合适的表达式上使用。但宏可以使用于整型、长整型、浮点型等可以用于<code>&gt;</code>来比较的类型，<strong>宏参数是无关类型的</strong>。</li></ol> 
<p><strong>但是和函数相比宏还是有劣势的：</strong></p> 
<ol><li>每次使用宏的时候，一份宏定义的代码将插入到程序中，除非宏比较短，否则可能大幅度增加程序的长度</li><li>宏是不能调试的</li><li>宏由于无关类型，也就不够严谨，所以宏定义是不够安全的</li><li>宏可能会带来运算符优先级的问题，导致程序容易出错</li></ol> 
<p>宏有时候能做到函数做不到的事，比如：宏的参数可以出现类型，但是函数不行</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">MALLOC</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">,</span> type<span class="token punctuation">)</span> <span class="token punctuation">(</span>type<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>n <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//int* p = (int*)malloc(10 * sizeof(int));</span>
	<span class="token keyword">int</span><span class="token operator">*</span> p <span class="token operator">=</span> <span class="token function">MALLOC</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//int *p = (int*)malloc(10 * sizeof(int));</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>宏和函数的对比</strong>:</p> 
<table><thead><tr><th>属性</th><th><code>#define</code>定义宏</th><th>函数</th></tr></thead><tbody><tr><td><strong>代码长度</strong></td><td>每次使用时，宏代码都会被插入到程序中，除了非常小的宏之外，程序的长度会大幅度增长</td><td>函数代码只出现于一个地方，每次使用这个函数时，都调用那个地方的同一份代码</td></tr><tr><td><strong>执行速度</strong></td><td>更快</td><td>存在函数的调用和返回的额外开销，所以相对慢一些</td></tr><tr><td><strong>操作符优先级</strong></td><td>宏参数的求值是在所有周围表达式的上下文环境里，除非加上括号，否则邻近操作符的优先级可能会产生不可预料的结果，所以建议宏在书写的时候多写括号</td><td>函数参数只在函数调用的时候求值一次，它的结果值传递给函数，表达式的求值结果更容易预测</td></tr><tr><td><strong>带有副作用的参数</strong></td><td>参数可能被替换到宏体中的多个位置，如果宏的参数被多次计算，带有副作用的参数求值可能会产生不可预测的结果</td><td>函数参数只在传参的时候求值一次，结果更容易控制</td></tr><tr><td><strong>参数类型</strong></td><td>宏的参数与类型无关，只要对参数的操作是合法的，它就可以使用任何参数类型</td><td>函数的参数是与类型有关的，如果参数的类型不同，就需要不同的函数，即使他们执行的任务是相同的</td></tr><tr><td><strong>调试</strong></td><td>宏是不方便调试的</td><td>函数是可以逐语句调试的</td></tr><tr><td><strong>递归</strong></td><td>宏是不能递归的</td><td>函数是可以递归的</td></tr></tbody></table> 
<hr> 
<h3><a id="7_295"></a>7、#和##</h3> 
<h4><a id="71__296"></a>7.1 #运算符</h4> 
<p><code>#</code>运算符将宏的一个参数转换为字符串字面量，它仅允许出现在带参数的宏的替换列表中<br> <code>#</code>运算符所执行的操作可以理解为“<strong>字符串化</strong>”<br> 比如：当我们有一个变量<code>int a = 10;</code>的时候，我们想打印出：<code>the value of a is 10.</code><br> 下面是常规写法：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"the value of a is %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果我们想把打印的这条代码通过宏替换来实现，该怎么做呢？</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PRINT</span><span class="token expression"><span class="token punctuation">(</span>format<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span></span><span class="token string">"the value of n is "</span><span class="token expression">format</span><span class="token string">"\n"</span><span class="token expression"><span class="token punctuation">,</span> n<span class="token punctuation">)</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token function">PRINT</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//printf("the value of n is ""%d""\n", a);</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果写成上面这种代码很明显并没有解决问题，因为如果我们将<code>n</code>写成<code>%d</code>时并不能打印出<code>a</code>，而只能打印出a的值，那为了能打印出<code>a</code>本身的字面量，我们就可以使用<code>#</code>操作符<br> 如下：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PRINT</span><span class="token expression"><span class="token punctuation">(</span>format<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span></span><span class="token string">"the value of "</span><span class="token directive-hash">#</span><span class="token directive keyword">n</span><span class="token string">" is "</span><span class="token expression">format</span><span class="token string">"\n"</span><span class="token expression"><span class="token punctuation">,</span> n<span class="token punctuation">)</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token function">PRINT</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//printf("the value of "a" is ""%d""\n", a);</span>
	<span class="token keyword">double</span> b <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span>
	<span class="token function">PRINT</span><span class="token punctuation">(</span><span class="token string">"%lf"</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//printf("the value of "b" is ""%lf""\n", b);</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2f/7c/hGi3lckG_o.png" alt="请添加图片描述" height="200"></p> 
<p>所以我们说：<code>#</code>运算符所执行的操作可以理解为“<strong>字符串化</strong>”，上面的代码中是将a和b字符串化了。</p> 
<blockquote> 
 <p><strong><code>当n = a的时候，#n 就相当于“a”</code></strong></p> 
</blockquote> 
<hr> 
<h4><a id="72__347"></a>7.2 ##运算符</h4> 
<p><strong><code>##</code>可以把位于它两边的符号合成一个符号</strong>，它允许宏定义从分离的文本片段创建标识符。<code>##</code>被称为记号粘合<br> 这样的连接必须产生一个<strong>合法的标识符</strong>，否则其结果就是未定义的。</p> 
<p>比如现在有这么一个问题：当我们写一个函数来求两个数的较大值的时候，不同的类型我们就需要写不同的函数，这样写太繁琐了，我们可以使用宏来简化这件事:</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">GENERIC</span><span class="token expression"><span class="token punctuation">(</span>type<span class="token punctuation">)</span> </span><span class="token punctuation">\</span>
<span class="token expression">type type</span><span class="token punctuation">##</span><span class="token expression"><span class="token function">_max</span><span class="token punctuation">(</span>type x<span class="token punctuation">,</span> type y<span class="token punctuation">)</span></span><span class="token punctuation">\</span>
<span class="token expression"><span class="token punctuation">{<!-- --></span></span><span class="token punctuation">\</span>
	<span class="token expression"><span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">\</span>
<span class="token expression"><span class="token punctuation">}</span></span></span>

<span class="token function">GENERIC</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token comment">//int int_max(int x, int y)</span>
<span class="token comment">//{<!-- --></span>
<span class="token comment">//	return ((x) &gt; (y) ? (x) : (y));</span>
<span class="token comment">//}</span>

<span class="token function">GENERIC</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>
<span class="token comment">//double double_max(double x, double y)</span>
<span class="token comment">//{<!-- --></span>
<span class="token comment">//	return ((x) &gt; (y) ? (x) : (y));</span>
<span class="token comment">//}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> <span class="token function">int_max</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%lf\n"</span><span class="token punctuation">,</span> <span class="token function">double_max</span><span class="token punctuation">(</span><span class="token number">3.14</span><span class="token punctuation">,</span> <span class="token number">6.28</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9a/ce/mGuBHjHy_o.png" alt="请添加图片描述" height="250"></p> 
<p>上面的代码中我们利用宏替换来实现创建不同类型的函数，<code>type##_max</code>中的<code>##</code>操作符将<code>type</code>和<code>_max</code>连接成了一个新的标识符</p> 
<hr> 
<h3><a id="8_383"></a>8、命名的约定</h3> 
<p>一般来讲函数和宏的使用语法很相似，所以语言本身没法帮我们区分二者，我们平时的习惯是：</p> 
<ul><li>把宏名全部大写</li><li>函数名不要全部大写或不大写</li></ul> 
<hr> 
<h3><a id="9undef_389"></a>9、#undef</h3> 
<blockquote> 
 <p><strong><code>#undef</code>这条指令用于移除一个宏定义</strong></p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">M</span> <span class="token expression"><span class="token number">10</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> M<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">M</span></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> M<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/05/95/NXgIGSXS_o.png" alt="请添加图片描述" height="150"></p> 
<blockquote> 
 <p><strong>如果现存的一个宏名需要被重新定义，那么它的旧名字首先需要被移除</strong></p> 
</blockquote> 
<hr> 
<h3><a id="10_407"></a>10、命令行定义</h3> 
<p>许多C编译器提供了一种能力，允许在命令行中定义符号，用于启动编译过程。<br> 例如：当我们根据同一个源文件想要编译出一个程序的不同版本的时候，这个特性有点用处。（假定某个程序中声明了一个一定长度的数组，如果机器内存有限，我们需要一个很小的数组，但是另外一个机器内存大些，我们需要一个较大的数组）</p> 
<p>编译指令：</p> 
<pre><code class="prism language-c"><span class="token comment">//linux  环境演示</span>
gcc <span class="token operator">-</span>D ARRAY_SIZE<span class="token operator">=</span><span class="token number">10</span> programe<span class="token punctuation">.</span>c
</code></pre> 
<hr> 
<h3><a id="11_418"></a>11、条件编译</h3> 
<p><strong>满足条件，就参与编译；不满足条件，就不参与编译</strong><br> 在编译一个程序的时候我们如果要将一条语句（一组语句）编译或者放弃是很方便的，因为我们有条件编译指令：</p> 
<pre><code class="prism language-c"><span class="token number">1.</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span>   <span class="token expression">常量表达式   </span><span class="token comment">//常量表达式由预处理器求值</span></span>
<span class="token comment">//...</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

如：
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_DEBUG_</span> <span class="token expression"><span class="token number">1</span></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">_DEBUG_</span></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-c"><span class="token number">2.</span>多个分支的条件编译
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span>   <span class="token expression">常量表达式</span></span>
<span class="token comment">//...</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span>   <span class="token expression">常量表达式</span></span>
<span class="token comment">//...</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
<span class="token comment">//...</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

如：
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">M</span> <span class="token expression"><span class="token number">1</span></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">M <span class="token operator">==</span> <span class="token number">1</span></span></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression">M <span class="token operator">==</span> <span class="token number">2</span></span></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token operator">:</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-c"><span class="token number">3.</span>判断是否被定义
<span class="token comment">//如果定义了</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>symbol<span class="token punctuation">)</span>或</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">symbol</span></span>

如：
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">M</span> <span class="token expression"><span class="token number">2</span></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">M</span></span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//如果没定义</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token operator">!</span><span class="token function">defined</span><span class="token punctuation">(</span>symbol<span class="token punctuation">)</span>或</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">symbol</span></span>
</code></pre> 
<pre><code class="prism language-c"><span class="token number">4.</span>嵌套指令
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">OS_UNIX</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">OPTION1</span></span>
		<span class="token function">unix_version_option1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">OPTION2</span></span>
		<span class="token function">unix_version_option2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>OS_MSDOS<span class="token punctuation">)</span></span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">OPTION2</span></span>
		<span class="token function">msdos_version_option2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
	
</code></pre> 
<blockquote> 
 <p><strong>条件编译通常用于跨平台性代码的编译</strong></p> 
</blockquote> 
<hr> 
<h3><a id="12_501"></a>12、头文件的包含</h3> 
<h4><a id="121__502"></a>12.1 头文件被包含的方式</h4> 
<h5><a id="1211__503"></a>12.1.1 本地文件包含</h5> 
<blockquote> 
 <p>一般指自己创建的头文件</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"filename.h"</span></span>
</code></pre> 
<p><strong>查找策略：</strong><br> 先在源文件所在目录下查找，如果该头文件未找到，编译器就像查找库函数头文件一样在标准位置查找头文件，如果找不到就提示编译错误。</p> 
<hr> 
<h5><a id="1212__511"></a>12.1.2 库文件包含</h5> 
<blockquote> 
 <p>一般指标准库中头文件的包含</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;filename.h&gt;</span></span>
</code></pre> 
<p><strong>查找策略：</strong><br> 直接去标准路径下去查找，如果找不到就提示编译错误。<br> 那这样是不是就说明，对库文件也可以使用<code>" "</code>的形式包含呢？<br> 答案是可以的。但是这样查找的效率比较低，也不容易区分是库文件还是本地文件</p> 
<hr> 
<h4><a id="122__522"></a>12.2 嵌套文件的包含</h4> 
<p>我们已经知道，<code>#include</code>指令可以使另外一个文件被编译，就像它实际出现于<code>#include</code>指令的地方一样。<br> 这种替换的方式很简单：预编译器先删除这条指令，并用被包含文件的内容替换<br> 一个头文件被包含几次，就会被实际编译几次，如果重复包含，编译的压力就比较大</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"test.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"test.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"test.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"test.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"test.h"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果像上面这样写，<code>test.h</code>文件的内容就会被拷贝5份，如果<code>test.h</code>文件比较大，这样预处理后代码量会剧增。<br> 如果工程比较大，有公共使用的文件，被大家都能用，又不做任何的处理，那么后果会不堪设想。<br> <strong>为了解决头文件被重复引入的问题，就要用到条件编译</strong><br> 我们在每个头文件的开头这样写：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__FILENAME_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__FILENAME_H__</span></span>

<span class="token comment">//...</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> 
<p>或者</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
</code></pre> 
<p>就可以避免头文件的重复引入。</p> 
<hr> 
<h2><a id="_556"></a>总结</h2> 
<blockquote> 
 <ul><li>预编译是C语言编译过程的第一阶段，在预编译阶段可以对源代码进行预处理，如宏定义、头文件包含等。通过学习预编译过程，可以更全面地理解C语言代码的编译过程。</li><li>预编译指令能够简化代码结构、提高代码的重用性和可维护性。学习预编译过程可以帮助程序员更好地利用预编译指令优化代码结构，提高代码的质量。</li><li>条件编译是预编译指令中的重要功能，可以根据不同条件编译不同的代码。通过学习预编译过程，可以了解如何使用条件编译来实现跨平台编译，提高代码的可移植性。</li></ul> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/93f293c00a5ffc5d79a1be8929504eaa/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">监控易监测对象及指标之：全面监控MongoDB 5数据库</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/724662a31e7f869bfb40954d02dbe04b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MySQL如何执行.sql 文件：详细教学指南</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>