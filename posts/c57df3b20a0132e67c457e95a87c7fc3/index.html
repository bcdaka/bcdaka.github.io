<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 平台编解码——软解、硬解对比 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/c57df3b20a0132e67c457e95a87c7fc3/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Android 平台编解码——软解、硬解对比">
  <meta property="og:description" content="关键词：Android，音视频编解码，软解码，硬解码，MediaPlayer，MediaCodec
文章目录 前言
一、概念解释 1. 概念：
2. 优缺点对比：
3. 播放器示例：
二、Android 硬解组件
1. MediaPlayer
2. MediaCodec
3. MediaCodec 的函数调用流程
总结
前言 提示：本文只做相关概念总体上的介绍和解释，不做深入讨论。
一、概念解释 1. 概念： 硬解，即硬件解码：硬件解码是图形芯片厂商提出的用 GPU 资源解码视频流的方案；
软解，即软件解码：相对于硬件解码，传统的软件解码是用 CPU 承担解码工作。
2. 优缺点对比： 对比优点缺点硬解 效率高、
功耗低、
热功耗低
a）缺乏有力的支持（包括滤镜、字幕）、局限性较大、设置较为复杂；
b）需要硬件有硬件解码模块、相关的驱动配合、合适的播放软件以及对播放软件的正确设置，缺一不可。否则无法开启硬件解码功能。
软解具备普遍适应性主要靠算法解码，很耗费CPU性能、耗电。 3. 播放器示例： 3.1 硬解播放器
最简单的播放器组件 —— VideoView VideoView 基于 MediaPlayer 实现，其基本等价于 MediaPalyer &#43; Surface 的组合。通常原生的 Android 系统，其 MediaPlayer 本身对于视频编解码协议支持比较有限。而 MediaPlayer 内部实现主要通过 MediaExtractor &#43; MediaCodec 的组合实现。
Google 的 ExoPlayer ExoPlayer 基于 MediaCodec 实现。而 MediaCodec 则具备很高的拓展性，支持的协议较多，可以根据流媒体的协议和设备硬件本身来自定义硬件解码。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-06T17:22:21+08:00">
    <meta property="article:modified_time" content="2024-06-06T17:22:21+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 平台编解码——软解、硬解对比</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p><strong>关键词：</strong>Android，音视频编解码，软解码，硬解码，MediaPlayer，MediaCodec</p> 
</blockquote> 
<p></p> 
<div> 
 <h4 id="%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95">文章目录</h4> 
</div> 
<p id="%E5%89%8D%E8%A8%80-toc" style="margin-left:40px;"><a href="#%E5%89%8D%E8%A8%80" rel="nofollow">前言</a></p> 
<p id="%E4%B8%80%E3%80%81%E6%A6%82%E5%BF%B5%E8%A7%A3%E9%87%8A%C2%A0-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81%E6%A6%82%E5%BF%B5%E8%A7%A3%E9%87%8A%C2%A0" rel="nofollow">一、概念解释 </a></p> 
<p id="1.%20%E6%A6%82%E5%BF%B5%EF%BC%9A-toc" style="margin-left:80px;"><a href="#1.%20%E6%A6%82%E5%BF%B5%EF%BC%9A" rel="nofollow">1. 概念：</a></p> 
<p id="2.%20%E4%BC%98%E7%BC%BA%E7%82%B9%E5%AF%B9%E6%AF%94%EF%BC%9A-toc" style="margin-left:80px;"><a href="#2.%20%E4%BC%98%E7%BC%BA%E7%82%B9%E5%AF%B9%E6%AF%94%EF%BC%9A" rel="nofollow">2. 优缺点对比：</a></p> 
<p id="3.%20%E6%92%AD%E6%94%BE%E5%99%A8%E7%A4%BA%E4%BE%8B%EF%BC%9A-toc" style="margin-left:80px;"><a href="#3.%20%E6%92%AD%E6%94%BE%E5%99%A8%E7%A4%BA%E4%BE%8B%EF%BC%9A" rel="nofollow">3. 播放器示例：</a></p> 
<p id="%E4%BA%8C%E3%80%81Android%20%E7%A1%AC%E8%A7%A3%E7%BB%84%E4%BB%B6-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81Android%20%E7%A1%AC%E8%A7%A3%E7%BB%84%E4%BB%B6" rel="nofollow">二、Android 硬解组件</a></p> 
<p id="1.%C2%A0MediaPlayer-toc" style="margin-left:80px;"><a href="#1.%C2%A0MediaPlayer" rel="nofollow">1. MediaPlayer</a></p> 
<p id="2.%C2%A0MediaCodec-toc" style="margin-left:80px;"><a href="#2.%C2%A0MediaCodec" rel="nofollow">2. MediaCodec</a></p> 
<p id="3.%20MediaCodec%20%E7%9A%84%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B-toc" style="margin-left:80px;"><a href="#3.%20MediaCodec%20%E7%9A%84%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B" rel="nofollow">3. MediaCodec 的函数调用流程</a></p> 
<p id="%E6%80%BB%E7%BB%93-toc" style="margin-left:0px;"><a href="#%E6%80%BB%E7%BB%93" rel="nofollow">        </a><a href="#%E6%80%BB%E7%BB%93" rel="nofollow">总结</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h3 id="%E5%89%8D%E8%A8%80"><a id="_7"></a>前言</h3> 
<p><strong><code><span style="background-color:#fef2f0;">提示：本文只做相关概念总体上的介绍和解释，不做深入讨论</span></code><span style="background-color:#fef2f0;">。</span></strong></p> 
<hr> 
<h3 id="%E4%B8%80%E3%80%81%E6%A6%82%E5%BF%B5%E8%A7%A3%E9%87%8A%C2%A0"><strong>一、概念解释 </strong></h3> 
<h4 id="1.%20%E6%A6%82%E5%BF%B5%EF%BC%9A">1. 概念：</h4> 
<p>硬解，即硬件解码：硬件解码是图形芯片厂商提出的用 <strong>GPU</strong> 资源解码视频流的方案；</p> 
<p>软解，即软件解码：相对于硬件解码，传统的软件解码是用 <strong>CPU</strong> 承担解码工作。</p> 
<h4 id="2.%20%E4%BC%98%E7%BC%BA%E7%82%B9%E5%AF%B9%E6%AF%94%EF%BC%9A">2. 优缺点对比：</h4> 
<table border="2" cellpadding="1" cellspacing="1" style="width:559px;"><tbody><tr><td style="width:75px;"><strong>对比</strong></td><td style="width:133px;"><span style="color:#fe2c24;"><strong>优点</strong></span></td><td style="width:345px;"><span style="color:#1a439c;"><strong>缺点</strong></span></td></tr><tr><td style="width:75px;"><strong>硬解</strong></td><td style="width:133px;"> <p>效率高、</p> <p>功耗低、</p> <p>热功耗低</p> </td><td style="width:345px;"> <p>a）缺乏有力的支持（包括滤镜、字幕）、局限性较大、设置较为复杂；</p> <p>b）需要硬件有硬件解码模块、相关的驱动配合、合适的播放软件以及对播放软件的正确设置，缺一不可。否则无法开启硬件解码功能。</p> </td></tr><tr><td style="width:75px;"><strong>软解</strong></td><td style="width:133px;">具备普遍适应性</td><td style="width:345px;">主要靠算法解码，很耗费CPU性能、耗电。</td></tr></tbody></table> 
<p></p> 
<h4 id="3.%20%E6%92%AD%E6%94%BE%E5%99%A8%E7%A4%BA%E4%BE%8B%EF%BC%9A">3. 播放器示例：</h4> 
<p><strong>3.1 硬解播放器</strong></p> 
<ul><li> <strong>最简单的播放器组件 —— VideoView</strong></li></ul> 
<p>VideoView 基于 MediaPlayer 实现，其基本等价于 MediaPalyer + Surface 的组合。通常原生的 Android 系统，其 MediaPlayer 本身对于视频编解码协议支持比较有限。而 MediaPlayer 内部实现主要通过 MediaExtractor + MediaCodec 的组合实现。</p> 
<ul><li><strong>Google 的 <a href="http://google.github.io/ExoPlayer/guide.html" rel="nofollow" title="ExoPlayer">ExoPlayer</a></strong></li></ul> 
<p>ExoPlayer 基于 MediaCodec 实现。而 MediaCodec 则具备很高的拓展性，支持的协议较多，可以根据流媒体的协议和设备硬件本身来自定义硬件解码。</p> 
<p><strong>3.2 软解播放器</strong></p> 
<ul><li><strong>FFmpeg 播放器框架：<a href="https://ffmpeg.org/" rel="nofollow" title="FFmpeg">FFmpeg</a></strong></li></ul> 
<p>FFmpeg 是一个全平台的，非常强大的软解播放器框架。正是因为 MediaPlayer 支持的媒体格式有限。为了能够播放更多的媒体，许多开发人员使用了 FFmpeg 软件解码器来开发播放器。</p> 
<p>对应在 Android 平台的移植，可以参考优秀的博客教程：<a href="http://blog.csdn.net/leixiaohua1020" title="雷霄骅(leixiaohua1020)的专栏">雷霄骅(leixiaohua1020)的专栏</a></p> 
<ul><li><strong>Bilibili 播放器：<a href="https://github.com/Bilibili/ijkplayer" title="ijkplayer">ijkplayer</a></strong></li></ul> 
<p>是Bilibili 公司 基于 FFmpeg 的开发的一款开源的的播放器。</p> 
<hr> 
<h3 id="%E4%BA%8C%E3%80%81Android%20%E7%A1%AC%E8%A7%A3%E7%BB%84%E4%BB%B6">二、Android 硬解组件</h3> 
<p>通过上面的介绍可知，无论是 MediaPlayer 还是 MediaCodec，都属于 Android 的硬解（Hardware Codec）。下面简单介绍一下相关的示例。</p> 
<h4 id="1.%C2%A0MediaPlayer"><strong>1. MediaPlayer </strong></h4> 
<p>Android 自 API level 1 以来都包含的播放器是 MediaPlayer。开发者能够简单、方便的上手使用它播放音频和视频。播放器如果只是播放音频，可以直接使用 MediaPlayer，如果播放视频，通常使用 MediaPlayer + Surface的组合( 当然，也可以直接使用 VideoView )。</p> 
<p>Android平台，实现一个最简单的，使用 VideoView （内部实现基本等价于 MediaPalyer + Surface 的组合）开发的播放器，代码示例：</p> 
<pre><code class="language-java">public class MainActivity extends AppCompatActivity implements View.OnClickListener {

    private VideoView videoView;
    private Button btn_start;
    private Button btn_pause;
    private Button btn_stop;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        bindViews();
    }
    
    private void bindViews() {
        videoView = (VideoView) findViewById(R.id.videoView);
        btn_start = (Button) findViewById(R.id.btn_start);
        btn_pause = (Button) findViewById(R.id.btn_pause);
        btn_stop = (Button) findViewById(R.id.btn_stop);

        btn_start.setOnClickListener(this);
        btn_pause.setOnClickListener(this);
        btn_stop.setOnClickListener(this);
        
        // 方式一：根据设备上的视频文件路径播放
        if (Environment.getExternalStorageState().
                    equals(Environment.MEDIA_MOUNTED)) {
            videoView.setVideoPath(Environment.
                    getExternalStorageDirectory() + "/lesson.mp4");
        }

        // 方式二：读取放在 app 安装文件的 raw 目录的视频文件
        //videoView.setVideoURI(Uri.parse(
        //        "android.resource://com.jay.videoviewdemo/" + R.raw.lesson));

        videoView.setMediaController(new MediaController(this));
    }

    @Override
    public void onClick(View v) {
        switch (v.getId()) {
            case R.id.btn_start:
                videoView.start();
                break;
            case R.id.btn_pause:
                videoView.pause();
                break;
            case R.id.btn_stop:
                videoView.stopPlayback();
                break;
        }
    }
}
</code></pre> 
<h4 id="2.%C2%A0MediaCodec"><strong>2. MediaCodec</strong></h4> 
<p>在 Android 的 Jelly Bean 版本，发布了 Android.media.MediaCodec API。该 API 使用与 OpenMAX（媒体行业中的著名标准）相同的原理和架构设计，有效地从纯粹的高级媒体播放器转换到低级编码器／解码器。</p> 
<p>由于 MediaCodec 是使用 Java API 编写的，因此它允许接口访问底层系统编解码器，无论是硬件编解码器，还是结合音频编解码器，都是高度优化的软件编解码器。使用MediaCodec能获得合理性能优化并节省电量。</p> 
<h4 id="3.%20MediaCodec%20%E7%9A%84%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B"><strong>3. MediaCodec 的函数调用流程</strong></h4> 
<p>调用流程设计的非常简单，参照下图。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/88/0c/07wjNxsX_o.png"></p> 
<p>配置完成后，开发人员使用 dequeueInputBuffer 获取硬件缓冲区ID。</p> 
<p>将解码原始缓冲区复制到输入队列后，使用 queueInputBuffer 使硬件编解码器执行解码功能。</p> 
<p>开发人员使用 dequeueOutputBuffer 获取解码缓冲区，然后使用 releaseOutputBuffer 释放硬件缓冲区，输出渲染到屏幕。   </p> 
<p> 有关详细代码，请参阅 Android 源码</p> 
<p><a href="https://cs.android.com/android/platform/superproject/main" rel="nofollow" title="https://cs.android.com/android/platform/superproject/main">https://cs.android.com/android/platform/superproject/main</a></p> 
<p>cts/tests/tests/media/decoder/src/android/media/decoder/cts/DecoderTest.java</p> 
<p>此示例代码使用 MediaExtractor 作为媒体格式解析器。</p> 
<p>开发人员需要使用 MediaFormat.createVideoFormat 来创建视频格式（如果使用 MediaExtractor，则使用 getTrackFormat 来获取格式）。</p> 
<p>一些解码器（例如：H.264）需要额外的配置信息。可以使用 MediaFormat 或者 刷新帧 添加此信息。例如： H.264刷新帧是IDR帧，在该帧的报头中包括附加配置信息。创建 H.264视频格式示例代码：</p> 
<div> 
 <pre><code class="language-java">videoformat = MediaFormat.createVideoFormat(“video/avc”, width,height);

videoformat.setByteBuffer("csd-0", extra configure data);</code></pre> 
</div> 
<h2><a id="_19"></a></h2> 
<hr> 
<h2 id="%E6%80%BB%E7%BB%93"><a id="_45"></a>总结</h2> 
<p>提示：这里对文章进行总结：<br> 例如：以上就是今天要讲的内容，本文仅仅简单介绍了pandas的使用，而pandas提供了大量能使我们快速便捷地处理数据的函数和方法。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c26906b5626ccb7c24659dfd3d78281a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">xstream运用，JAVA对象转xml，xml转JAVA对象</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dca76347162a81efd2e6b985c011544a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Centos7安装Zookeeper</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>