<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C# Web控件与数据感应之数据返写 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f07e75b442f92a3a9b25c415e1069c61/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="C# Web控件与数据感应之数据返写">
  <meta property="og:description" content="目录
关于数据返写
准备视图
范例运行环境
ControlInducingFieldName 方法
设计与实现
如何根据 ID 查找控件
FindControlEx 方法
调用示例 小结
关于数据返写 数据感应也即数据捆绑，是一种动态的，Web控件与数据源之间的交互，数据返写 ，是指将查询出来的数据，通过可显示数据的UI控件进行数据输出，如查询详情页，见下图：
如图其中放置了一些标签（Label）控件用于查询输出，比如单位名称、项目名称、被测评人、总得分、手机号或账户等信息。
本文将介绍如何中通过 C# 实现查询并返写数据到服务器UI控件上。
准备视图 我们在 MS SQL Server 创建视图 v_es_project_persons（考试人员详情视图），其结构如下表：
序号字段名类型说明1ciduniqueidentifier项目唯一标识2wxmpciduniqueidentifier人员唯一标识3ProjectNamenvarchar项目名称4pubstatenvarchar项目发布状态5personsint项目允许考试人数上限6namenvarchar姓名7mobilenvarchar手机8scorenumeric考试成绩 执行定位项目及人员的查询SQL语句，如下：
​ select wxmpcid,ProjectName,pubstate,persons,name,mobile,score from v_es_project_persons where cid=&#39;960105b0-42b6-413a-a87a-f5fa338b2f2c&#39; and wxmpcid=&#39;21f4c424-a1df-4161-be1b-ce441e058be6&#39; 最后我们将数据填充到 DataReader ,并生成对应的二维数组。
范例运行环境 操作系统： Windows Server 2019 DataCenter
数据库：Microsoft SQL Server 2016
.net版本： .netFramework4.0 或以上
开发工具：VS2019 C#
ControlInducingFieldName 方法 设计与实现 ControlInducingFieldName 方法主要是通过 object[,] 二维对象数组数据源进行提取并根据字段名与控件ID进行匹配，查找匹配成功则根据控件的数据呈现属性进行赋值，其参数设置见下表：
序号参数名类型说明1HasTitlebool数据集是否包含列名，如果包含则数据输出从第2行开始2VerticalQueryModebool垂直字典查询模式，数据集第1列为要查找的ID值，第2列为要输出的值 GetReaderData 方法可以访问数据库数据表进行查询结果的提取，并转化为 object[,] 二维数组，具体实现请参考我的文章：《C# Web控件与数据感应之 填充 HtmlTable》中的GetReaderData 方法实现代码。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-24T14:27:13+08:00">
    <meta property="article:modified_time" content="2024-06-24T14:27:13+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C# Web控件与数据感应之数据返写</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E5%85%B3%E4%BA%8E%C2%A0HtmlTable-toc" style="margin-left:40px;"><a href="#%E5%85%B3%E4%BA%8E%C2%A0HtmlTable" rel="nofollow">关于数据返写</a></p> 
<p id="%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE%E6%BA%90-toc" style="margin-left:40px;"><a href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE%E6%BA%90" rel="nofollow">准备视图</a></p> 
<p id="%E8%8C%83%E4%BE%8B%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83-toc" style="margin-left:40px;"><a href="#%E8%8C%83%E4%BE%8B%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83" rel="nofollow">范例运行环境</a></p> 
<p id="%E6%96%B9%E6%B3%95%E8%AE%BE%E8%AE%A1-toc" style="margin-left:40px;"><a href="#%E6%96%B9%E6%B3%95%E8%AE%BE%E8%AE%A1" rel="nofollow">ControlInducingFieldName 方法</a></p> 
<p id="%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E5%91%88%E7%8E%B0-toc" style="margin-left:80px;"><a href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E5%91%88%E7%8E%B0" rel="nofollow">设计与实现</a></p> 
<p id="%E6%A8%A1%E6%9D%BF%E6%A0%B7%E4%BE%8B%E8%BE%93%E5%87%BA-toc" style="margin-left:80px;"><a href="#%E6%A8%A1%E6%9D%BF%E6%A0%B7%E4%BE%8B%E8%BE%93%E5%87%BA" rel="nofollow">如何根据 ID 查找控件</a></p> 
<p id="Automatic%20%E6%A8%A1%E5%BC%8F%E5%A1%AB%E5%85%85-toc" style="margin-left:120px;"><a href="#Automatic%20%E6%A8%A1%E5%BC%8F%E5%A1%AB%E5%85%85" rel="nofollow">FindControlEx 方法</a></p> 
<p id="%E8%B0%83%E7%94%A8%E7%A4%BA%E4%BE%8B%C2%A0-toc" style="margin-left:80px;"><a href="#%E8%B0%83%E7%94%A8%E7%A4%BA%E4%BE%8B%C2%A0" rel="nofollow">调用示例 </a></p> 
<p id="%E5%B0%8F%E7%BB%93-toc" style="margin-left:40px;"><a href="#%E5%B0%8F%E7%BB%93" rel="nofollow">小结</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h3 id="%E5%85%B3%E4%BA%8E%C2%A0HtmlTable">关于数据返写</h3> 
<p>数据感应也即数据捆绑，是一种动态的，Web控件与数据源之间的交互，数据返写 ，是指将查询出来的数据，通过可显示数据的UI控件进行数据输出，如查询详情页，见下图：</p> 
<p><img alt="" height="1053" src="https://images2.imgbox.com/4a/b0/g7rdFiC9_o.png" width="1200"></p> 
<p>如图其中放置了一些标签（Label）控件用于查询输出，比如单位名称、项目名称、被测评人、总得分、手机号或账户等信息。</p> 
<p>本文将介绍如何中通过 C# 实现查询并返写数据到服务器UI控件上。</p> 
<h4 id="%E4%B8%80%E4%BA%9B%E5%8C%BA%E5%88%AB"></h4> 
<h3 id="%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE%E6%BA%90">准备视图</h3> 
<p>我们在 MS SQL Server 创建视图 v_es_project_persons（考试人员详情视图），其结构如下表：</p> 
<table align="center" border="1" cellpadding="1" cellspacing="1"><thead><tr><th style="text-align:center;">序号</th><th style="text-align:center;width:150px;">字段名</th><th style="text-align:center;width:206px;">类型</th><th style="text-align:center;width:239px;">说明</th></tr></thead><tbody><tr><th style="text-align:center;">1</th><td style="width:150px;">cid</td><td style="width:206px;">uniqueidentifier</td><td style="width:239px;">项目唯一标识</td></tr><tr><th style="text-align:center;">2</th><td style="width:150px;">wxmpcid</td><td style="width:206px;">uniqueidentifier</td><td style="width:239px;">人员唯一标识</td></tr><tr><th style="text-align:center;">3</th><td style="width:150px;">ProjectName</td><td style="width:206px;">nvarchar</td><td style="width:239px;">项目名称</td></tr><tr><th style="text-align:center;">4</th><td style="width:150px;">pubstate</td><td style="width:206px;">nvarchar</td><td style="width:239px;">项目发布状态</td></tr><tr><th style="text-align:center;">5</th><td style="width:150px;">persons</td><td style="width:206px;">int</td><td style="width:239px;">项目允许考试人数上限</td></tr><tr><th style="text-align:center;">6</th><td style="width:150px;">name</td><td style="width:206px;">nvarchar</td><td style="width:239px;">姓名</td></tr><tr><th style="text-align:center;">7</th><td style="width:150px;">mobile</td><td style="width:206px;">nvarchar</td><td style="width:239px;">手机</td></tr><tr><th style="text-align:center;">8</th><td style="width:150px;">score</td><td style="width:206px;">numeric</td><td style="width:239px;">考试成绩</td></tr></tbody></table> 
<p>执行定位项目及人员的查询SQL语句，如下：</p> 
<h3 id="%E2%80%8B%E7%BC%96%E8%BE%91">​</h3> 
<pre><code class="language-sql">select wxmpcid,ProjectName,pubstate,persons,name,mobile,score 
from v_es_project_persons 
where cid='960105b0-42b6-413a-a87a-f5fa338b2f2c' and wxmpcid='21f4c424-a1df-4161-be1b-ce441e058be6'</code></pre> 
<p>最后我们将数据填充到 DataReader ,并生成对应的二维数组。</p> 
<h3></h3> 
<h3 id="%E8%8C%83%E4%BE%8B%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83">范例运行环境</h3> 
<p>操作系统： Windows Server 2019 DataCenter</p> 
<p>数据库：Microsoft SQL Server 2016</p> 
<p>.net版本： .netFramework4.0 或以上</p> 
<p>开发工具：VS2019  C#</p> 
<h3 id="%E6%96%B9%E6%B3%95%E8%AE%BE%E8%AE%A1">ControlInducingFieldName 方法</h3> 
<h4 id="%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E5%91%88%E7%8E%B0">设计与实现</h4> 
<p>ControlInducingFieldName 方法主要是通过 object[,] 二维对象数组数据源进行提取并根据字段名与控件ID进行匹配，查找匹配成功则根据控件的数据呈现属性进行赋值，其参数设置见下表：</p> 
<table align="center" border="1" cellpadding="1" cellspacing="1"><thead><tr><th style="text-align:center;">序号</th><th style="text-align:center;">参数名</th><th style="text-align:center;">类型</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><th style="text-align:center;">1</th><td>HasTitle</td><td>bool</td><td>数据集是否包含列名，如果包含则数据输出从第2行开始</td></tr><tr><th style="text-align:center;">2</th><td>VerticalQueryMode</td><td>bool</td><td>垂直字典查询模式，数据集第1列为要查找的ID值，第2列为要输出的值</td></tr></tbody></table> 
<p>GetReaderData 方法可以访问数据库数据表进行查询结果的提取，并转化为 object[,] 二维数组，具体实现请参考我的文章：<a href="https://blog.csdn.net/michaelline/article/details/139467013" title="《C# Web控件与数据感应之 填充 HtmlTable》">《C# Web控件与数据感应之 填充 HtmlTable》</a>中的GetReaderData 方法实现代码。</p> 
<p><strong>ControlInducingFieldName</strong> 方法实现代码如下：</p> 
<pre><code class="language-cs">ArrayList paras=new ArrayList();
string refSql="";
System.Data.CommandType ct=System.Data.CommandType.Text;


public void ControlInducingFieldName(bool HasTitle,bool VerticalQueryMode)
{
   object[,] ReaderData = GetReaderData("SqlServer","您的连接串",refSql,paras,HasTitle,ct);

                if (ReaderData == null) return;
                for (int i =(HasTitle==true?1:0); i &lt; ReaderData.GetLength(0); i++)
                {
                    for (int j = (VerticalQueryMode==false?0:1); j &lt; ReaderData.GetLength(1); j++)
                    {
                        string _fieldname = "";
                        Control ctl = new Control();
                        if (VerticalQueryMode == false)
                        {
                            _fieldname = ReaderData[0, j].ToString();
                            ctl=FindControlEx(_fieldname + (i == 1 ? "" : i.ToString()));
                        }
                        else
                        {
                            _fieldname = ReaderData[i, 0].ToString();
                            ctl = FindControlEx(_fieldname);
                        }
                        if (ctl != null )
                        {

                            if (ctl.GetType() == typeof(Label))
                            {
                                ((Label)ctl).Text = ReaderData[i, j].ToString();

                            }
                            else if (ctl.GetType() == typeof(Literal))
                            {
                                ((Literal)ctl).Text = ReaderData[i, j].ToString();
                            }
                            else if (ctl.GetType() == typeof(TextBox))
                            {
                                ((TextBox)ctl).Text =  ReaderData[i, j].ToString();
                            }
                            else if (ctl.GetType() == typeof(DropDownList))
                            {
                                ((DropDownList)ctl).SelectedValue = ReaderData[i, j].ToString();
                            }
                            else if (ctl.GetType() == typeof(HyperLink))
                            {
                                ((HyperLink)ctl).NavigateUrl = ReaderData[i, j].ToString();
                            }
                            else if (ctl.GetType() == typeof(HtmlLink))
                            {
                                ((HtmlLink)ctl).Href = ReaderData[i, j].ToString();
                            }
                            else if (ctl.GetType().ToString().IndexOf("System.Web.UI.HtmlControls") == 0)
                            {

                                string[] styles = ReaderData[i, j].ToString().Split(';');
                                for (int s = 0; s &lt; styles.Length; s++)
                                {
                                    string[] style = styles[s].Split(':');
                                    if (style.Length &gt; 1)
                                    {
                                        string _key = style[0];
                                        string _value = style[1];
                                        ((HtmlControl)ctl).Style[_key] = _value;
                                        if (_key.ToLower().Trim() == "visible" &amp;&amp; _value.ToLower().Trim() == "false")
                                        {
                                            ((HtmlControl)ctl).Visible = false;
                                        }
                                        else if (_key.ToLower().Trim() == "visible" &amp;&amp; _value.ToLower().Trim() == "true")
                                        {
                                            ((HtmlControl)ctl).Visible = true;
                                        }

                                    }
                                }
                            }//ctl set
                        }//if ctl not null 
                    }
                }
}//control inducing fieldname</code></pre> 
<h4 id="%E6%A8%A1%E6%9D%BF%E6%A0%B7%E4%BE%8B%E8%BE%93%E5%87%BA">如何根据 ID 查找控件</h4> 
<p>FindControlEx 实现了对 FindControl 方法的扩充，如果查找不成功可试图查找是否有母版页，如果存在，则根据母版页模式继续查找。</p> 
<h5 id="Automatic%20%E6%A8%A1%E5%BC%8F%E5%A1%AB%E5%85%85">FindControlEx 方法</h5> 
<p>FindControlEx 通过传递要查找的服务器容器控件和ID参数，以返回查找到的控件，代码如下：</p> 
<p></p> 
<pre><code class="language-html">public Control  FindControlEx(Control FindPage,string ID)
{
      Control ctl=FindPage.FindControl(ID);
      if (ctl == null &amp;&amp; FindPage.Page.Master != null)
      {
          ctl=FindPage.Page.Master.FindControl(ID);
      }
      return ctl ;
}</code></pre> 
<p></p> 
<h4 id="%E8%B0%83%E7%94%A8%E7%A4%BA%E4%BE%8B%C2%A0">调用示例 </h4> 
<p>客户端 UI 设计代码如下，控件的ID与字段名输出保持一致即可：</p> 
<pre><code class="language-html">&lt;h2&gt;
    &lt;asp:Label ID="fnamelabel" runat="server" Text="查看个人详情"&gt;&lt;/asp:Label&gt;
&lt;/h2&gt;
        &lt;div style="display: flex;"&gt;
            &lt;div class="query-box"&gt;
                &lt;label&gt;项目名称:&lt;/label&gt;
                &lt;asp:Label ID="ProjectName" Text="" Font-Bold="true" runat="server" /&gt;(人数上限：&lt;asp:Label
                    ID="persons" Text="" runat="server" /&gt;人)
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div style="display: flex;"&gt;
            &lt;div class="query-box"&gt;
                &lt;label&gt;被测评人:&lt;/label&gt;
                &lt;asp:Label ID="name" Text="" Font-Bold="true" runat="server" /&gt;
            &lt;/div&gt;
            &lt;div class="query-box" style=" margin-left :10px;"&gt;
                &lt;label&gt;总得分:&lt;/label&gt;
                &lt;asp:Label ID="score" Text="" Font-Bold="true" runat="server" /&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div style="display: flex;"&gt;
            &lt;div class="query-box"&gt;
                &lt;label&gt;手机号或账户:&lt;/label&gt;
                &lt;asp:Label ID="mobile" Text="" Font-Bold="true" runat="server" /&gt;
            &lt;/div&gt;
        &lt;/div&gt;
</code></pre> 
<p>服务端示例代码如下（假设传递项目唯一标识和人员唯一标识参数）：</p> 
<pre><code class="language-cs">ArrayList paras = new ArrayList();
string refSQL = "select wxmpcid,ProjectName,pubstate,persons,name,mobile,score 
from v_es_project_persons where cid=@cid and wxmpcid=@wxmpcid";

paras.Clear();
paras.Add(new SqlParameter("cid", Request.QueryString["cid"]));
paras.Add(new SqlParameter("wxmpcid", Request.QueryString["wxmpcid"]));

System.Data.CommandType ct=System.Data.CommandType.Text;


ControlInducingFieldName(true,true);




</code></pre> 
<p>  </p> 
<h3 id="%E5%B0%8F%E7%BB%93">小结</h3> 
<p>ControlInducingFieldName 方法目前可支持如下控件返写：</p> 
<p>（1）Label 控件的 Text 属性</p> 
<p>（2）Literal 控件的 Text 属性</p> 
<p>（3）TextBox 控件的 Text 属性</p> 
<p>（4）DropDownList 控件的 Text 属性</p> 
<p>（5）HyperLink 控件的 NavigateUrl 属性</p> 
<p>（6）HtmlLink 控件的 Href 属性</p> 
<p>另外对于 HtmlControls ，如果值为 "visible:true" 或 "visible:false"，则可以对控件进行 Visible 的设置，这是根据项目实际的一些需要进行的功能实现。以上就是关于控件数据返写的介绍，我们可以根据自己的实际需要进行改造和控件识别的扩充，本示例代码仅供您参考。 </p> 
<p>感谢您的阅读，希望本文能够对您有所帮助。</p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/399d6f11420096487e20657eeebf2c11/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">AI工具——Hedra：上传音频&#43;照片，一键创作口型匹配视频～</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ba73c3b406f4ef21dad49bf5c7034229/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">alibaba easyexcel 导出excel使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>