<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据仓库ETL - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/1161cda6b1c51264dfe1c6412c236b16/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="数据仓库ETL">
  <meta property="og:description" content="小白的数据仓库学习笔记 2024/5/20 18:25
文章目录 ETLdim打开创建项目（选这个，这个是做etl的）建立元数据的连接同样的，建立与数据仓库的连接新建ssis包序列容器全量etl增量etl建立sql任务双击打开，设置连接、内容 双击数据流任务OLE DB源、数据转换、OLE DB目标成功再做两个 两个表列的数据类型不一致factsql任务左侧分支做全量右侧做增量运行测试 做另外一个 ETL 数据抽取、转换、加载
dim 打开 创建项目（选这个，这个是做etl的） 把元数据etl到数据仓库里面
建立元数据的连接 同样的，建立与数据仓库的连接 新建ssis包 分成两个脚本，一个维度、一个事实
这里做的是dim维度的，应该再dim.disx里面做，我这里选错窗口了
序列容器 如果不创建，整个页面就是容器，一次只能做一个
全量etl 把整张表的数据一下子整过去
删除数据（避免重复）etl 增量etl 一天一天的，没过一天抽一次，每天多一点
建立sql任务 双击打开，设置连接、内容 双击数据流任务 OLE DB源、数据转换、OLE DB目标 确定数据源，清洗转换
这里易错，sql命令写的是从数据源查询过来的
成功 再做两个 同样的，再做两个全量
两个表列的数据类型不一致 然后修改列的数据类型并保存
先全量，后增量
为什么先全量，后增量？
在你数据分析之前，已经产生了大量的数据
fact sql任务 左侧分支做全量 双击线
等于0的时候走左侧
把CreateDate转成varcher类型，再转成int类型
select [FrameNo] ,[SaleShop] ,datekey ,[SalePrice] ,[FactoryPrice] ,[SaleType] from( SELECT [FrameNo] ,[SaleShop] ,convert(int,convert(varchar,[CreateDate],112)) datekey ,[SalePrice] ,[FactoryPrice] ,[SaleType] FROM [jtxy_source].[dbo].[tbl_EXE_SaleCar])a where a.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-20T18:37:38+08:00">
    <meta property="article:modified_time" content="2024-05-20T18:37:38+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据仓库ETL</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>小白的数据仓库学习笔记 2024/5/20 18:25</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#ETL_4" rel="nofollow">ETL</a></li><li><a href="#dim_12" rel="nofollow">dim</a></li><li><ul><li><a href="#_18" rel="nofollow">打开</a></li><li><a href="#etl_27" rel="nofollow">创建项目（选这个，这个是做etl的）</a></li><li><a href="#_43" rel="nofollow">建立元数据的连接</a></li><li><a href="#_51" rel="nofollow">同样的，建立与数据仓库的连接</a></li><li><a href="#ssis_59" rel="nofollow">新建ssis包</a></li><li><a href="#_73" rel="nofollow">序列容器</a></li><li><a href="#etl_86" rel="nofollow">全量etl</a></li><li><a href="#etl_97" rel="nofollow">增量etl</a></li><li><a href="#sql_103" rel="nofollow">建立sql任务</a></li><li><ul><li><a href="#_114" rel="nofollow">双击打开，设置连接、内容</a></li></ul> 
    </li><li><a href="#_124" rel="nofollow">双击数据流任务</a></li><li><a href="#OLE_DBOLE_DB_133" rel="nofollow">OLE DB源、数据转换、OLE DB目标</a></li><li><a href="#_168" rel="nofollow">成功</a></li><li><a href="#_179" rel="nofollow">再做两个</a></li></ul> 
   </li><li><a href="#_192" rel="nofollow">两个表列的数据类型不一致</a></li><li><a href="#fact_216" rel="nofollow">fact</a></li><li><ul><li><a href="#sql_220" rel="nofollow">sql任务</a></li><li><a href="#_236" rel="nofollow">左侧分支做全量</a></li><li><a href="#_290" rel="nofollow">右侧做增量</a></li><li><a href="#_311" rel="nofollow">运行测试</a></li></ul> 
   </li><li><a href="#_331" rel="nofollow">做另外一个</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="ETL_4"></a>ETL</h3> 
<p>数据抽取、转换、加载</p> 
<h3><a id="dim_12"></a>dim</h3> 
<h4><a id="_18"></a>打开</h4> 
<p><img src="https://images2.imgbox.com/91/82/bCqGP7R9_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="etl_27"></a>创建项目（选这个，这个是做etl的）</h4> 
<p><img src="https://images2.imgbox.com/50/38/tGi5sCAP_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/c5/f4/ezyxOjCv_o.png" alt="在这里插入图片描述"></p> 
<p>把元数据etl到数据仓库里面</p> 
<h4><a id="_43"></a>建立元数据的连接</h4> 
<p><img src="https://images2.imgbox.com/ab/24/qS2HWaiH_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_51"></a>同样的，建立与数据仓库的连接</h4> 
<p><img src="https://images2.imgbox.com/23/40/maXsyDWC_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="ssis_59"></a>新建ssis包</h4> 
<p>分成两个脚本，一个维度、一个事实</p> 
<p><img src="https://images2.imgbox.com/81/25/o0MGzrUT_o.png" alt="在这里插入图片描述"></p> 
<p>这里做的是dim维度的，应该再dim.disx里面做，我这里选错窗口了</p> 
<h4><a id="_73"></a>序列容器</h4> 
<p>如果不创建，整个页面就是容器，一次只能做一个</p> 
<p><img src="https://images2.imgbox.com/51/16/8a7sQDBN_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="etl_86"></a>全量etl</h4> 
<p>把整张表的数据一下子整过去</p> 
<ol><li>删除数据（避免重复）</li><li>etl</li></ol> 
<h4><a id="etl_97"></a>增量etl</h4> 
<p>一天一天的，没过一天抽一次，每天多一点</p> 
<h4><a id="sql_103"></a>建立sql任务</h4> 
<p><img src="https://images2.imgbox.com/ba/67/Ha5pMZRw_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_114"></a>双击打开，设置连接、内容</h5> 
<p><img src="https://images2.imgbox.com/24/3c/RAJld7z2_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_124"></a>双击数据流任务</h4> 
<p><img src="https://images2.imgbox.com/e0/79/LwvLzkBB_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="OLE_DBOLE_DB_133"></a>OLE DB源、数据转换、OLE DB目标</h4> 
<p><img src="https://images2.imgbox.com/8d/dd/RSkB5XXj_o.png" alt="在这里插入图片描述"></p> 
<p>确定数据源，清洗转换</p> 
<p>这里易错，sql命令写的是从数据源查询过来的</p> 
<p><img src="https://images2.imgbox.com/4d/91/LUP8g7hv_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/77/a5/rDDfhJVr_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/e3/57/98CxrbaP_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/4e/f0/kuGa2rOB_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_168"></a>成功</h4> 
<p><img src="https://images2.imgbox.com/7a/01/yA6VGfty_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_179"></a>再做两个</h4> 
<p>同样的，再做两个全量</p> 
<p><img src="https://images2.imgbox.com/64/ec/wQ94Nkbh_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_192"></a>两个表列的数据类型不一致</h3> 
<p><img src="https://images2.imgbox.com/d5/96/lejThu4e_o.png" alt="在这里插入图片描述"></p> 
<p>然后修改列的数据类型并保存</p> 
<p>先全量，后增量</p> 
<p>为什么先全量，后增量？</p> 
<p>在你数据分析之前，已经产生了大量的数据</p> 
<h3><a id="fact_216"></a>fact</h3> 
<h4><a id="sql_220"></a>sql任务</h4> 
<p><img src="https://images2.imgbox.com/fe/38/ZCwZGxDy_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/59/a9/wDo02jgi_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_236"></a>左侧分支做全量</h4> 
<p>双击线</p> 
<p>等于0的时候走左侧</p> 
<p><img src="https://images2.imgbox.com/ee/c4/AHl71w2l_o.png" alt="在这里插入图片描述"></p> 
<p>把CreateDate转成varcher类型，再转成int类型</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> 
<span class="token punctuation">[</span>FrameNo<span class="token punctuation">]</span>
 <span class="token punctuation">,</span><span class="token punctuation">[</span>SaleShop<span class="token punctuation">]</span>
 <span class="token punctuation">,</span>datekey
 <span class="token punctuation">,</span><span class="token punctuation">[</span>SalePrice<span class="token punctuation">]</span>
 <span class="token punctuation">,</span><span class="token punctuation">[</span>FactoryPrice<span class="token punctuation">]</span>
 <span class="token punctuation">,</span><span class="token punctuation">[</span>SaleType<span class="token punctuation">]</span>
<span class="token keyword">from</span><span class="token punctuation">(</span>
<span class="token keyword">SELECT</span> <span class="token punctuation">[</span>FrameNo<span class="token punctuation">]</span>
 <span class="token punctuation">,</span><span class="token punctuation">[</span>SaleShop<span class="token punctuation">]</span>
 <span class="token punctuation">,</span><span class="token keyword">convert</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">convert</span><span class="token punctuation">(</span><span class="token keyword">varchar</span><span class="token punctuation">,</span><span class="token punctuation">[</span>CreateDate<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">112</span><span class="token punctuation">)</span><span class="token punctuation">)</span> datekey 
 <span class="token punctuation">,</span><span class="token punctuation">[</span>SalePrice<span class="token punctuation">]</span>
 <span class="token punctuation">,</span><span class="token punctuation">[</span>FactoryPrice<span class="token punctuation">]</span>
 <span class="token punctuation">,</span><span class="token punctuation">[</span>SaleType<span class="token punctuation">]</span>
  <span class="token keyword">FROM</span> <span class="token punctuation">[</span>jtxy_source<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>tbl_EXE_SaleCar<span class="token punctuation">]</span><span class="token punctuation">)</span>a
  <span class="token keyword">where</span> a<span class="token punctuation">.</span>datekey<span class="token operator">&lt;=</span><span class="token number">20110814</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/70/12/CUwQvwsb_o.png" alt="在这里插入图片描述"></p> 
<p>数据转换、连接、映射</p> 
<p>这里SaleType是中文，要转一下</p> 
<p><img src="https://images2.imgbox.com/da/87/UPUcwPnT_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_290"></a>右侧做增量</h4> 
<p>双击线</p> 
<p><img src="https://images2.imgbox.com/83/02/QHOXN9FT_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/52/d9/dfQuk7pM_o.png" alt="在这里插入图片描述"></p> 
<p>数据转换和目标和左侧一致</p> 
<h4><a id="_311"></a>运行测试</h4> 
<p>第一次</p> 
<p><img src="https://images2.imgbox.com/fb/c5/KujDkz6i_o.png" alt="在这里插入图片描述"></p> 
<p>第二次</p> 
<p><img src="https://images2.imgbox.com/7d/7d/C4qrIKX9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_331"></a>做另外一个</h3> 
<p>同样的</p> 
<p>创建序列容器，和上面的基本一致</p> 
<p><img src="https://images2.imgbox.com/29/d0/17yeBymA_o.png" alt="在这里插入图片描述"></p> 
<p>这个就可以，因为datekey再order by时已经存在</p> 
<pre><code class="prism language-sql"> <span class="token keyword">SELECT</span> 
<span class="token keyword">distinct</span><span class="token punctuation">(</span><span class="token keyword">convert</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">convert</span><span class="token punctuation">(</span><span class="token keyword">varchar</span><span class="token punctuation">,</span><span class="token punctuation">[</span>SubmitTime<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">112</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> datekey

  <span class="token keyword">FROM</span> <span class="token punctuation">[</span>jtxy_source<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>tbl_EXE_TargetData<span class="token punctuation">]</span> <span class="token keyword">order</span> <span class="token keyword">by</span> datekey
</code></pre> 
<blockquote> 
 <p>这个就不对，因为执行where时datakey还不存在，所以报错</p> 
 <p>SELECT [TargetValue]<br> ,[TargetRange]<br> ,TargetData<br> ,convert(int,convert(varchar,[SubmitTime],112)) datekey<br> ,[TargetFor]<br> ,[TargetShop]<br> FROM [jtxy_source].[dbo].[tbl_EXE_TargetData]<br> where datekey&lt;=20110809</p> 
</blockquote> 
<p>​ OLE DB源</p> 
<p><img src="https://images2.imgbox.com/b9/d7/jV7POEIB_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span>
<span class="token punctuation">[</span>TargetValue<span class="token punctuation">]</span>
<span class="token punctuation">,</span><span class="token punctuation">[</span>TargetRange<span class="token punctuation">]</span>
<span class="token punctuation">,</span>TargetData
<span class="token punctuation">,</span>datekey
<span class="token punctuation">,</span><span class="token punctuation">[</span>TargetFor<span class="token punctuation">]</span>
<span class="token punctuation">,</span><span class="token punctuation">[</span>TargetShop<span class="token punctuation">]</span>
<span class="token keyword">from</span>

<span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token punctuation">[</span>TargetValue<span class="token punctuation">]</span>
<span class="token punctuation">,</span><span class="token punctuation">[</span>TargetRange<span class="token punctuation">]</span>
<span class="token punctuation">,</span>TargetData
<span class="token punctuation">,</span><span class="token keyword">convert</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">convert</span><span class="token punctuation">(</span><span class="token keyword">varchar</span><span class="token punctuation">,</span><span class="token punctuation">[</span>SubmitTime<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">112</span><span class="token punctuation">)</span><span class="token punctuation">)</span> datekey
<span class="token punctuation">,</span><span class="token punctuation">[</span>TargetFor<span class="token punctuation">]</span>
<span class="token punctuation">,</span><span class="token punctuation">[</span>TargetShop<span class="token punctuation">]</span>
  <span class="token keyword">FROM</span> <span class="token punctuation">[</span>jtxy_source<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>tbl_EXE_TargetData<span class="token punctuation">]</span><span class="token punctuation">)</span>a
  <span class="token keyword">where</span> a<span class="token punctuation">.</span>datekey<span class="token operator">&lt;=</span><span class="token number">20110809</span>
</code></pre> 
<p>因为没有中文，这里就不需要转了</p> 
<p>直接到目标</p> 
<p><img src="https://images2.imgbox.com/9a/a1/KYlqxgDj_o.png" alt="在这里插入图片描述"></p> 
<p>右侧增量</p> 
<p><img src="https://images2.imgbox.com/7f/7b/nlYfFQEP_o.png" alt="在这里插入图片描述"></p> 
<p>运行测试</p> 
<p>第一次</p> 
<p><img src="https://images2.imgbox.com/96/69/MSa033H2_o.png" alt="在这里插入图片描述"></p> 
<p>第二次</p> 
<p><img src="https://images2.imgbox.com/9f/c4/6bu6GNoR_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eb0d5c0707ebbf5f8b82d304f3fca1f6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">保姆级微信 AI 机器人教程：如何打造私人和群聊助手</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b162e3765ee8ec3304edf7b16e41e51a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Mysql知识总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>