<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python 学习之 request 库的基本使用 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/07183cb2a9bcc074dc0b261e8ffeb6cb/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="python 学习之 request 库的基本使用">
  <meta property="og:description" content="目录
1、基本请求
2、代理设置
3、设置请求参数
4、设置请求头
5、文件的写入与读取
6、遍历请求 txt 内的所有 url
7、其他补充
1、基本请求 测试代码：
import requests re = requests.get(&#34;http://www.baidu.com&#34;) print(re.status_code) print(re.text) 个人理解：
使用 requests 库我们肯定需要先导入它，使用 import 导入；
re 为我们自定义的一个参数，用来接收请求返回的信息，在 python 中点表示调用的意思，我们这里就调用了 requests 库中的 get() 方法，括号内为请求的URL，使用单引号或者双引号包裹；
最后使用 print 函数输出响应结果，也是通过点进行调用；
status_code 为响应状态码，text 返回的是网页源码（str类型）。
运行结果：
常用的调用方法：
re. text # 返回的是unicode 型的数据，一般是在网页的header中定义的编码形式
re.content # 返回的是bytes，二级制型的数据
如果想要提取文本就用 text ，如果想要提取图片、文件，就用 content
re.url # 获取请求的 url
re.status_code # 获取响应的状态码
re.headers # 获取响应头
re.request.headers # 获取请求头
re.cookies # 获取 cookie">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-24T13:37:53+08:00">
    <meta property="article:modified_time" content="2024-01-24T13:37:53+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python 学习之 request 库的基本使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="1%E3%80%81%E5%9F%BA%E6%9C%AC%E8%AF%B7%E6%B1%82-toc" style="margin-left:0px;"><a href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E8%AF%B7%E6%B1%82" rel="nofollow">1、基本请求</a></p> 
<p id="2%E3%80%81%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE-toc" style="margin-left:0px;"><a href="#2%E3%80%81%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE" rel="nofollow">2、代理设置</a></p> 
<p id="3%E3%80%81%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0-toc" style="margin-left:0px;"><a href="#3%E3%80%81%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0" rel="nofollow">3、设置请求参数</a></p> 
<p id="4%E3%80%81%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E5%A4%B4-toc" style="margin-left:0px;"><a href="#4%E3%80%81%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E5%A4%B4" rel="nofollow">4、设置请求头</a></p> 
<p id="5%E3%80%81%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%99%E5%85%A5%E4%B8%8E%E8%AF%BB%E5%8F%96-toc" style="margin-left:0px;"><a href="#5%E3%80%81%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%99%E5%85%A5%E4%B8%8E%E8%AF%BB%E5%8F%96" rel="nofollow">5、文件的写入与读取</a></p> 
<p id="6%E3%80%81%E9%81%8D%E5%8E%86%E8%AF%B7%E6%B1%82%20txt%20%E5%86%85%E7%9A%84%E6%89%80%E6%9C%89%20url-toc" style="margin-left:0px;"><a href="#6%E3%80%81%E9%81%8D%E5%8E%86%E8%AF%B7%E6%B1%82%20txt%20%E5%86%85%E7%9A%84%E6%89%80%E6%9C%89%20url" rel="nofollow">6、遍历请求 txt 内的所有 url</a></p> 
<p id="7%E3%80%81%E5%85%B6%E4%BB%96%E8%A1%A5%E5%85%85-toc" style="margin-left:0px;"><a href="#7%E3%80%81%E5%85%B6%E4%BB%96%E8%A1%A5%E5%85%85" rel="nofollow">7、其他补充</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="1%E3%80%81%E5%9F%BA%E6%9C%AC%E8%AF%B7%E6%B1%82">1、基本请求</h2> 
<p>测试代码：</p> 
<pre><code class="language-python">import requests

re = requests.get("http://www.baidu.com")
print(re.status_code)
print(re.text)</code></pre> 
<p>个人理解：</p> 
<p>使用 requests 库我们肯定需要先导入它，使用 import 导入；</p> 
<p>re 为我们自定义的一个参数，用来接收请求返回的信息，在 python 中点表示调用的意思，我们这里就调用了 requests 库中的 get() 方法，括号内为请求的URL，使用单引号或者双引号包裹；</p> 
<p>最后使用 print 函数输出响应结果，也是通过点进行调用；</p> 
<p>status_code 为响应状态码，text 返回的是网页源码（str类型）。</p> 
<p>运行结果：</p> 
<p><img alt="" height="795" src="https://images2.imgbox.com/9e/99/5lJY4XtP_o.png" width="1200"></p> 
<p>常用的调用方法：</p> 
<blockquote> 
 <p>re. text    # 返回的是unicode 型的数据，一般是在网页的header中定义的编码形式</p> 
 <p>re.content    # 返回的是bytes，二级制型的数据</p> 
 <p>如果想要提取文本就用 text ，如果想要提取图片、文件，就用 content</p> 
 <p></p> 
 <p>re.url   # 获取请求的 url</p> 
 <p>re.status_code   # 获取响应的状态码</p> 
 <p>re.headers   # 获取响应头</p> 
 <p>re.request.headers   # 获取请求头</p> 
 <p>re.cookies   # 获取 cookie</p> 
 <p>re.history   # 获取请求历史</p> 
</blockquote> 
<h2 id="2%E3%80%81%E4%BB%A3%E7%90%86%E8%AE%BE%E7%BD%AE">2、代理设置</h2> 
<p>测试代码：</p> 
<pre><code class="language-python">import requests

proxies = {
    'http': "http://127.0.0.1:8080",
    'https': "http://127.0.0.1:8080"
}

re = requests.get("http://www.baidu.com", proxies=proxies)
print(re.url)
print(re.status_code)
print(re.text)</code></pre> 
<p>个人理解：</p> 
<p>就是加入一个 proxies ，字典的数据类型，内容为键值对的形式，分别为 http 和https 协议设置代理，我这里是转发到本地的 8080 端口，再使用 burpsuite 进行抓包拦截。</p> 
<p>注意在请求中加上 proxies=proxies 即可。</p> 
<p>运行结果：</p> 
<p>burpsuite 成功抓包</p> 
<p><img alt="" height="695" src="https://images2.imgbox.com/65/e8/fuzEbOKk_o.png" width="1023"></p> 
<p>放包之后观察 pycharm 结果回显</p> 
<p>代理转发请求成功</p> 
<p><img alt="" height="488" src="https://images2.imgbox.com/0f/9b/Y6dGYKbH_o.png" width="1200"></p> 
<h2 id="3%E3%80%81%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0">3、设置请求参数</h2> 
<p>最常用的有两种情况：get 和 post 请求</p> 
<p>测试代码（以 get 请求为例）：</p> 
<pre><code class="language-python">import requests

proxies = {
    'http': "http://127.0.0.1:8080",
    'https': "http://127.0.0.1:8080"
}

payload = {
    'myon': "hello!",
    'test': 123456
}

re = requests.get("http://www.baidu.com", proxies=proxies, params=payload)
print(re.url)
print(re.status_code)
print(re.text)</code></pre> 
<p>个人理解：</p> 
<p>同代理设置一样，新增一个请求的 payload ，也是字典键值对的形式；</p> 
<p>注意不同键值对之间使用逗号隔开，否则会报错；</p> 
<p>请求中加上 params=payload 即可。</p> 
<p>特别说明：</p> 
<p>对于 get 请求，我们使用 params；</p> 
<p>对于 post 请求，我们使用 data，即：</p> 
<pre><code class="language-python">payload = {
    'myon': "hello!",
    'test': 123456
}

re = requests.post("http://www.baidu.com", proxies=proxies, data=payload)</code></pre> 
<p>抓包结果：</p> 
<p>get 请求</p> 
<p><img alt="" height="688" src="https://images2.imgbox.com/88/ae/kCOloCqw_o.png" width="1044"></p> 
<p>post 请求</p> 
<p><img alt="" height="881" src="https://images2.imgbox.com/f9/1e/YrtDfHJE_o.png" width="1200"></p> 
<h2 id="4%E3%80%81%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E5%A4%B4">4、设置请求头</h2> 
<p>测试代码（以 post 请求为例）：</p> 
<pre><code class="language-python">import requests

proxies = {
    'http': "http://127.0.0.1:8080",
    'https': "http://127.0.0.1:8080"
}

payload = {
    'myon': "hello!",
    'test': 123456
}

headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36 Edg/120.0.0.0',
    'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6',
    'test': 'hello Myon!'
}

re = requests.post("http://www.baidu.com", proxies=proxies, data=payload, headers=headers)
print(re.url)
print(re.status_code)
print(re.text)
</code></pre> 
<p>个人理解：</p> 
<p>新增请求的 headers ，也是字典键值对的形式，这里设置了三个请求头；</p> 
<p>同理需要在请求中加上 headers=headers 。</p> 
<p>使用 burpsuite 抓包看看：</p> 
<p><img alt="" height="787" src="https://images2.imgbox.com/cf/63/7EiFqglX_o.png" width="1200"></p> 
<p>这里如果直接运行会报错：</p> 
<p><img alt="" height="843" src="https://images2.imgbox.com/d7/b5/eYdXGzar_o.png" width="1200"></p> 
<p>这个错误是由于 SSL 证书验证失败引起的</p> 
<p>我们需要在请求中增加 verify=False </p> 
<p>即：</p> 
<pre><code class="language-python">re = requests.post("http://www.baidu.com", proxies=proxies, data=payload, headers=headers, verify=False)</code></pre> 
<p>运行结果：</p> 
<p>因为这里 payload 我们是随便添加的所以找不到</p> 
<p><img alt="" height="852" src="https://images2.imgbox.com/fb/e0/4FfStDTP_o.png" width="1200"></p> 
<p><img alt="" height="534" src="https://images2.imgbox.com/35/9c/98L2pJKT_o.png" width="1200"></p> 
<h2 id="5%E3%80%81%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%99%E5%85%A5%E4%B8%8E%E8%AF%BB%E5%8F%96">5、文件的写入与读取</h2> 
<p>写入文件：</p> 
<p>比如我们想将百度的图标下载下来</p> 
<p>我们前面说过，这种图片类是二进制文件，因此使用 content</p> 
<p><img alt="" height="663" src="https://images2.imgbox.com/4f/04/UjU0kPrc_o.png" width="1200"></p> 
<p>测试代码：</p> 
<pre><code class="language-python">import requests

re = requests.get("https://www.baidu.com/favicon.ico")

with open('save.ico', 'wb') as f:
    f.write(re.content)</code></pre> 
<p>个人理解：</p> 
<p>'wb' 表示二进制写入，save.ico 为保存的文件名，如果当前目录下没这个文件名则会新建；</p> 
<p>将这个文件作为 f （可自定义名字），调用 write() 方法写入请求返回的数据。</p> 
<p>运行结果：</p> 
<p><img alt="" height="438" src="https://images2.imgbox.com/4c/c7/hJ4olflE_o.png" width="1050"></p> 
<p>在同一目录下找到 save.ico 即我们下载的文件</p> 
<p><img alt="" height="432" src="https://images2.imgbox.com/c9/16/BLWgDRaD_o.png" width="891"></p> 
<p>如果我们想写入的是文本，则使用 text 和文本写入模式（'w'）</p> 
<p>即：</p> 
<pre><code class="language-python">with open('save.txt', 'w') as f:
    f.write(re.text)</code></pre> 
<p>补充说明：</p> 
<p>如果返回的内容不是 str 类型，可以使用 str() 方法进行类型转换，比如</p> 
<pre><code class="language-python">    f.write(str(re.status_code))</code></pre> 
<p>读取文件：</p> 
<p>测试代码：</p> 
<pre><code class="language-python">import requests

with open('ip.txt', 'r') as file:
    for i in file:
        print(i.strip())</code></pre> 
<p>个人理解：</p> 
<p>其中 ip.txt 是一个本地存在的文件，'r' 表示以只读方式打开，并赋给 file（可自定义名字）；</p> 
<p>使用 for 循环，遍历 file ； </p> 
<p>使用 print() 函数输出结果，strip() 用于去除行尾的换行符和空白字符。</p> 
<p>运行结果：</p> 
<p>这里其实还不用引入 requests 库，但是后面就会需要了</p> 
<p><img alt="" height="474" src="https://images2.imgbox.com/30/00/8FOqXKpo_o.png" width="1084"></p> 
<h2 id="6%E3%80%81%E9%81%8D%E5%8E%86%E8%AF%B7%E6%B1%82%20txt%20%E5%86%85%E7%9A%84%E6%89%80%E6%9C%89%20url">6、遍历请求 txt 内的所有 url</h2> 
<p>测试代码：</p> 
<pre><code class="language-python">import requests

with open('url.txt', 'r') as urls:
    for i in urls:
        url = i.strip()
        try:
            re = requests.get(url)
            print(f"请求URL为:{url}, 响应状态码为:{re.status_code}")
        except Exception as e:
            print(f"请求出错:{url},{e}")</code></pre> 
<p>在本地准备一个 url.txt </p> 
<p>前三个为可正常访问的网站，最后一个为错误的地址</p> 
<p><img alt="" height="214" src="https://images2.imgbox.com/50/3d/HpQMRjZm_o.png" width="482"></p> 
<p>说明：</p> 
<p><strong>f 是 f-string 的语法，是一种用于字符串格式化的快捷方式；</strong></p> 
<p><strong>在 f-string 中，可以直接嵌入变量和表达式，而不需要使用传统的字符串格式化方法；</strong></p> 
<p><strong>{} 内放的是表达式，可以是变量、常量、表达式等；</strong></p> 
<p><strong>这部分被称为花括号或占位符，用于在字符串中表示将在运行时被替换的值。</strong></p> 
<p>基本的 try 和 except 结构：</p> 
<pre><code class="language-python">try:
    # 你的代码块
    # 可能会引发异常的代码
except SomeExceptionType as e:
    # 处理异常的代码
    # e 是异常对象，包含有关异常的信息
</code></pre> 
<p>这里使用 requests.RequestException 更好，即：</p> 
<pre><code class="language-python">        except requests.RequestException as e:</code></pre> 
<p>运行结果：</p> 
<p><img alt="" height="648" src="https://images2.imgbox.com/85/40/qJD0U5we_o.png" width="1200"></p> 
<h2 id="7%E3%80%81%E5%85%B6%E4%BB%96%E8%A1%A5%E5%85%85">7、其他补充</h2> 
<p>在请求中我们还可以设置超时时间，使用 timeout 指定</p> 
<p>即：</p> 
<p>向百度发出请求，如果 3 秒内没有得到响应，则抛出错误</p> 
<pre><code class="language-python">re = requests.post("http://www.baidu.com", timeout=3)</code></pre> 
<blockquote> 
 <p>请求分为两个阶段：连接（connect）和读取（read）<br> # 如果给 timeout 参数指定一个数值，则超时时间是这两个阶段的总和<br> # 可以传入一个元组，分别指定连接超时时间和读取超时时间</p> 
</blockquote> 
<p>即：</p> 
<pre><code class="language-python">re = requests.post("http://www.baidu.com", timeout=(2,10))</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6aae4f5ce851a0bb7d155f5b7bfec66f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python中的递归详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1932f0740a5a62324bab99fbffb58581/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python pip更换清华源镜像</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>