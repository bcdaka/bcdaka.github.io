<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【香橙派AiPro】基于VGG16的火灾检测模型预测 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/d455dbf41d0f3157da7746b81c98fb30/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【香橙派AiPro】基于VGG16的火灾检测模型预测">
  <meta property="og:description" content="目录 引言开发板介绍开发板使用准备工作工具文档 拨码开关镜像烧录连接开发板下载MobaXterm网线-SSH连接开发板设置WIFI连接WIFI-SSH连接开发板确定开发板IP方法 Vnc可视化WindowsiPad 开发工具安装 散热风扇基于VGG16的火灾检测模型预测数据集准备目录结构代码操作 安装宝塔训练中的开发板表现负载方面散热方面 最后 引言 终于收到一款心仪已久的板子了，收到货后来不及吃灰就赶紧测试了，不得不说性价比很高，真不愧是Orange Pi AI Pro，对比其他板子性价比绝对第一！
开发板介绍 Orange Pi AI Pro开发板是一款香橙派和华为联合精心打造的高性能AI开发板，搭载了昇腾AI处理器，可实现图像、视频等多种数据分析处理
OrangePi AIpro(8-12T)采用昇腾AI技术路线，具体为4核64位处理器&#43;AI处理器，集成图形处理器，支持8-12TOPS AI算力，拥有8GB/16GB LPDDR4X，可以外接32GB/64GB/128GB/256GB eMMC模块，支持双4K高清输出。
Orange Pi AIpro引用了相当丰富的接口，包括两个HDMI输出、GPIO接口、Type-C电源接口、支持SATA/NVMe SSD 2280的M.2插槽、TF插槽、千兆网口、两个USB3.0、一个USB Type-C 3.0、一个Micro USB（串口打印调试功能）、两个MIPI摄像头、一个MIPI屏等，预留电池接口，可广泛适用于AI边缘计算、深度视觉学习及视频流AI分析、视频图像分析、自然语言处理、智能小车、机械臂、人工智能、无人机、云计算、AR/VR、智能安防、智能家居等领域，覆盖 AIoT各个行业。 Orange Pi AIpro支持Ubuntu、openEuler操作系统，满足大多数AI算法原型验证、推理应用开发的需求。
接口详情图
开发板使用 准备工作 工具文档 官方工具：点我下载
用户手册：点我下载
ubuntu镜像：点我下载
本次用到：读卡器、网线
拨码开关 开发板支持从TF卡、eMMC和SSD（支持NVMeSSD和 SATASSD）启动。具体从哪个设备启动是由开发板背面的两个拨码（BOOT1和BOOT2）开关来控制的。
默认是通过TF卡启动的
体验评价：香橙派 AI Pro开发板通过其丰富的内置 API 和完善的文档支持，确实简化了开发流程并提高了易用性。这些特点使开发者能够更快速地进行应用程序的开发和调试，同时保证了开发过程的高效性和可靠性
镜像烧录 开发板出厂时，Sd卡已经有一个系统了，博主通电后发现SD卡上的小灯已亮了起来，官方原话给的是：
此绿灯由GPIO4_19控制其亮灭，可以作为SATA硬盘的指示灯或者其他需要的用途。目前发布的Linux系统默认在DTS中将其点亮。当看到此灯点亮后，至少可以说明Linux内核已经启动了。
由于没有读卡器，博主还未烧录过系统，不过很简单，可以参考这里
基于WindowsPC将Linux镜像烧写到TF卡的方法-11页
连接开发板 官方文档写明可通过多种方式连接开发板，这里使用了网线进行连接，连接后如下图所示：
下载MobaXterm 可以去官方提供的工具包里面下载，也可以 快速下载
网线-SSH连接开发板 网线连接这种方式，适合还未连接WIFI的板子 以及 没有显示屏的同学，将网线和开发板网口以及电脑连接后，可以通过共享网络使电脑为板子分配IP地址
查找到ip地址后，打开MobaXterm进行SSH连接
账号密码rootMind@123HwHiAiUserMind@123 输入账号和密码登录，注意：Linux密码是不显示的，输入完成回车即可">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-17T16:58:11+08:00">
    <meta property="article:modified_time" content="2024-07-17T16:58:11+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【香橙派AiPro】基于VGG16的火灾检测模型预测</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-kimbie-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/06/b1/ig6q9mPG_o.png" alt="在这里插入图片描述"></p> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_5" rel="nofollow">引言</a></li><li><a href="#_13" rel="nofollow">开发板介绍</a></li><li><a href="#_25" rel="nofollow">开发板使用</a></li><li><ul><li><a href="#_26" rel="nofollow">准备工作</a></li><li><ul><li><a href="#_27" rel="nofollow">工具文档</a></li></ul> 
   </li><li><a href="#_47" rel="nofollow">拨码开关</a></li><li><a href="#_58" rel="nofollow">镜像烧录</a></li><li><a href="#_67" rel="nofollow">连接开发板</a></li><li><ul><li><a href="#MobaXterm_71" rel="nofollow">下载MobaXterm</a></li><li><a href="#SSH_79" rel="nofollow">网线-SSH连接开发板</a></li><li><a href="#WIFI_110" rel="nofollow">设置WIFI连接</a></li><li><a href="#WIFISSH_121" rel="nofollow">WIFI-SSH连接开发板</a></li><li><ul><li><a href="#IP_168" rel="nofollow">确定开发板IP方法</a></li></ul> 
   </li></ul> 
   </li><li><a href="#Vnc_174" rel="nofollow">Vnc可视化</a></li><li><ul><li><a href="#Windows_175" rel="nofollow">Windows</a></li><li><a href="#iPad_193" rel="nofollow">iPad</a></li></ul> 
   </li><li><a href="#_202" rel="nofollow">开发工具安装</a></li></ul> 
  </li><li><a href="#_247" rel="nofollow">散热风扇</a></li><li><a href="#VGG16_288" rel="nofollow">基于VGG16的火灾检测模型预测</a></li><li><ul><li><a href="#_292" rel="nofollow">数据集准备</a></li><li><a href="#_300" rel="nofollow">目录结构</a></li><li><a href="#_317" rel="nofollow">代码</a></li><li><a href="#_396" rel="nofollow">操作</a></li></ul> 
  </li><li><a href="#_571" rel="nofollow">安装宝塔</a></li><li><ul><li><a href="#_631" rel="nofollow">训练中的开发板表现</a></li><li><ul><li><a href="#_632" rel="nofollow">负载方面</a></li><li><a href="#_636" rel="nofollow">散热方面</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_639" rel="nofollow">最后</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_5"></a>引言</h2> 
<p>终于收到一款心仪已久的板子了，收到货后来不及吃灰就赶紧测试了，不得不说性价比很高，真不愧是Orange Pi AI Pro，对比其他板子性价比绝对第一！</p> 
<p><img src="https://images2.imgbox.com/c3/df/PMTq90xU_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_13"></a>开发板介绍</h2> 
<p>Orange Pi AI Pro开发板是一款香橙派和华为联合精心打造的高性能AI开发板，搭载了昇腾AI处理器，可实现图像、视频等多种数据分析处理</p> 
<p>OrangePi AIpro(8-12T)采用昇腾AI技术路线，具体为4核64位处理器+AI处理器，集成图形处理器，支持8-12TOPS AI算力，拥有8GB/16GB LPDDR4X，可以外接32GB/64GB/128GB/256GB eMMC模块，支持双4K高清输出。</p> 
<p>Orange Pi AIpro引用了相当丰富的接口，包括两个HDMI输出、GPIO接口、Type-C电源接口、支持SATA/NVMe SSD 2280的M.2插槽、TF插槽、千兆网口、两个USB3.0、一个USB Type-C 3.0、一个Micro USB（串口打印调试功能）、两个MIPI摄像头、一个MIPI屏等，预留电池接口，可广泛适用于AI边缘计算、深度视觉学习及视频流AI分析、视频图像分析、自然语言处理、智能小车、机械臂、人工智能、无人机、云计算、AR/VR、智能安防、智能家居等领域，覆盖 AIoT各个行业。 Orange Pi AIpro支持Ubuntu、openEuler操作系统，满足大多数AI算法原型验证、推理应用开发的需求。</p> 
<p><strong>接口详情图</strong><br> <img src="https://images2.imgbox.com/3e/b9/dTRE7hYl_o.jpg" alt="在这里插入图片描述"></p> 
<h2><a id="_25"></a>开发板使用</h2> 
<h3><a id="_26"></a>准备工作</h3> 
<h4><a id="_27"></a>工具文档</h4> 
<p>官方工具：<a href="https://pan.baidu.com/share/init?surl=Jho73pw91r5GJD2KijY45Q&amp;pwd=3xuz" rel="nofollow">点我下载</a></p> 
<p>用户手册：<a href="https://pan.baidu.com/s/1clOIklNzsHSigsrZzeWWMA?pwd=va56#list/path=/" rel="nofollow">点我下载</a></p> 
<p>ubuntu镜像：<a href="https://pan.baidu.com/share/init?surl=csbugZiKsuL_NHCOmyi1BA&amp;pwd=ma6z" rel="nofollow">点我下载</a></p> 
<p><strong>本次用到：读卡器、网线</strong></p> 
<p><img src="https://images2.imgbox.com/73/8f/QCwjDa2J_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1e/e5/JueflMUR_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/0c/14/mGIHilmx_o.png" alt="在这里插入图片描述" width="200" height="200"></p> 
<h3><a id="_47"></a>拨码开关</h3> 
<p>开发板支持从<code>TF卡、eMMC和SSD</code>（支持NVMeSSD和 SATASSD）启动。具体从哪个设备启动是由开发板背面的两个拨码（BOOT1和BOOT2）开关来控制的。</p> 
<p><img src="https://images2.imgbox.com/2d/13/gLWBJ200_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/49/8b/ryG2S6hn_o.png" alt="在这里插入图片描述"><br> 默认是通过TF卡启动的</p> 
<p><code>体验评价：香橙派 AI Pro开发板通过其丰富的内置 API 和完善的文档支持，确实简化了开发流程并提高了易用性。这些特点使开发者能够更快速地进行应用程序的开发和调试，同时保证了开发过程的高效性和可靠性</code></p> 
<h3><a id="_58"></a>镜像烧录</h3> 
<p>开发板出厂时，Sd卡已经有一个系统了，博主通电后发现SD卡上的小灯已亮了起来，官方原话给的是：</p> 
<blockquote> 
 <p>此绿灯由GPIO4_19控制其亮灭，可以作为SATA硬盘的指示灯或者其他需要的用途。目前发布的Linux系统默认在DTS中将其点亮。当看到此灯点亮后，<strong>至少可以说明Linux内核已经启动了。</strong></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/80/5a/IQcVpYxa_o.png" alt="在这里插入图片描述"></p> 
<p>由于没有读卡器，博主还未烧录过系统，不过很简单，可以参考这里<br> <a href="https://pan.baidu.com/s/1clOIklNzsHSigsrZzeWWMA?pwd=va56#list/path=/" rel="nofollow">基于WindowsPC将Linux镜像烧写到TF卡的方法-11页</a></p> 
<h3><a id="_67"></a>连接开发板</h3> 
<p>官方文档写明可通过多种方式连接开发板，这里使用了网线进行连接，连接后如下图所示：</p> 
<p><img src="https://images2.imgbox.com/cf/34/og5l8rXh_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="MobaXterm_71"></a>下载MobaXterm</h4> 
<p>可以去官方提供的工具包里面下载，也可以 <a href="https://www.singdown.com/win/2172/717178717.html" rel="nofollow">快速下载</a></p> 
<p><img src="https://images2.imgbox.com/27/ca/Dq0jmRD6_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="SSH_79"></a>网线-SSH连接开发板</h4> 
<p>网线连接这种方式，适合还未连接WIFI的板子 以及 没有显示屏的同学，将网线和开发板网口以及电脑连接后，可以通过共享网络使电脑为板子分配IP地址</p> 
<p><img src="https://images2.imgbox.com/b4/0d/3c5I9U0z_o.png" alt="在这里插入图片描述"></p> 
<p>查找到ip地址后，打开MobaXterm进行SSH连接<br> <img src="https://images2.imgbox.com/f3/7d/yg6gFJy5_o.png" alt="在这里插入图片描述"></p> 
<table><thead><tr><th>账号</th><th>密码</th></tr></thead><tbody><tr><td>root</td><td>Mind@123</td></tr><tr><td>HwHiAiUser</td><td>Mind@123</td></tr></tbody></table> 
<p>输入账号和密码登录，<strong>注意：<code>Linux密码是不显示的，输入完成回车即可</code></strong></p> 
<p><img src="https://images2.imgbox.com/99/fb/iYKzV7RX_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"> 使用USB串口调试注意：
一定要确保USB数据线是否是能传输数据的，一般都是只能充电不能传输数据，可能插入后没有反应
</code></pre> 
<h4><a id="WIFI_110"></a>设置WIFI连接</h4> 
<p>开发板带有WIFI模块，我们可以将开发板连接到家用路由器网络，这样就可以不需要网线连接了</p> 
<p><img src="https://images2.imgbox.com/e6/38/PNlWhP2o_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="WIFISSH_121"></a>WIFI-SSH连接开发板</h4> 
<p><strong>通过nmcli命令连接WIFI</strong><br> 我们用的是网线连接开发板，使用SSH登录到了开发板，在终端界面输入</p> 
<pre><code class="prism language-bash">nmcli dev wifi
</code></pre> 
<p><img src="https://images2.imgbox.com/56/f2/N2JHwzaG_o.png" alt="在这里插入图片描述"></p> 
<p>连接WIFI</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> nmcli dev wifi connect <span class="token string">'Cloud'</span> password <span class="token string">'13988266448'</span>


</code></pre> 
<p><img src="https://images2.imgbox.com/fa/65/MKKShC4p_o.png" alt="在这里插入图片描述"></p> 
<p><strong>通过图形化方式连接WIFI</strong></p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> nmtui
</code></pre> 
<p><img src="https://images2.imgbox.com/24/e9/kc4HP4v7_o.png" alt="在这里插入图片描述"></p> 
<p>选择Activateaconnect后回车，选中后输入密码即可连接</p> 
<p><img src="https://images2.imgbox.com/c6/b1/AnXUJK0h_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="IP_168"></a>确定开发板IP方法</h5> 
<p>目前可以将IP设置为静态，不让他自动分配，但是我认为，可以通过查看路由器上面的用户确定<br> <img src="https://images2.imgbox.com/ea/64/GmtZD3Fa_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Vnc_174"></a>Vnc可视化</h3> 
<h4><a id="Windows_175"></a>Windows</h4> 
<p>在windows上显示图形化桌面又没有屏幕和连接线，可以通过MobaXterm的vnc连接</p> 
<p><img src="https://images2.imgbox.com/f1/5b/KGkWR9kk_o.png" alt="在这里插入图片描述"></p> 
<p>弹出的窗口输入密码即可登录到系统</p> 
<p><img src="https://images2.imgbox.com/e6/97/KWjbzzPz_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="iPad_193"></a>iPad</h4> 
<p>和开发板保持相同局域网内，下载软件RVNC Viewer<br> <img src="https://images2.imgbox.com/56/2e/pM5NWWEt_o.png" alt="在这里插入图片描述"></p> 
<table><thead><tr><th>IP</th><th>端口</th></tr></thead><tbody><tr><td>192.168.x.x</td><td>5901</td></tr></tbody></table> 
<h3><a id="_202"></a>开发工具安装</h3> 
<p>下载pycharm社区版</p> 
<p><img src="https://images2.imgbox.com/00/10/kExrm1yI_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/f3/03/RcLgonD8_o.png" alt="在这里插入图片描述"></p> 
<p>找到文件所在位置解压，输入解压命令</p> 
<pre><code class="prism language-bash"><span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> pycharm-community-2024.1.4-aarch64.tar.gz
</code></pre> 
<p><img src="https://images2.imgbox.com/f5/75/LSQ5Ngyr_o.png" alt="在这里插入图片描述"></p> 
<p>运行pycharm<br> <img src="https://images2.imgbox.com/d5/45/UM1jAGfa_o.png" alt="在这里插入图片描述"></p> 
<p>创建快捷方式，之后可以在左上角开发菜单栏中找到</p> 
<p><img src="https://images2.imgbox.com/d3/18/swptMRLJ_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/1d/cd/82oAaX59_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/e6/97/QoHLS56e_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_247"></a>散热风扇</h2> 
<p>使用的过程中发现板子很烫手，于是我设置了自定义转速</p> 
<p><strong>查询风扇当前模式命令</strong></p> 
<blockquote> 
 <p>sudo npu-smi info -t pwm-mode</p> 
</blockquote> 
<p><strong>查询当前风扇转速</strong></p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> npu-smi info <span class="token parameter variable">-t</span> pwm-duty-ratio
</code></pre> 
<p><strong>设置为手动模式并调整转速，0手动1自动</strong></p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> npu-smi <span class="token builtin class-name">set</span> <span class="token parameter variable">-t</span> pwm-mode <span class="token parameter variable">-d</span> <span class="token number">0</span>
</code></pre> 
<p>取值范围0-100</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> npu-smi <span class="token builtin class-name">set</span> <span class="token parameter variable">-t</span> pwm-duty-ratio <span class="token parameter variable">-d</span> <span class="token number">30</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/49/bb/q5jFKezf_o.png" alt="在这里插入图片描述"></p> 
<p>推荐设置30</p> 
<h2><a id="VGG16_288"></a>基于VGG16的火灾检测模型预测</h2> 
<p>前面的基本配置搞定了，我们使用模型加载本地数据集并对其进行预处理，然后使用预训练的 VGG16 模型，并添加自定义的全连接层进行火灾检测。<br> 最后，代码会在本地训练模型，并保存模型到本地文件系统，通过已训练的模型进行测试识别。</p> 
<h3><a id="_292"></a>数据集准备</h3> 
<p>yolov5火灾检测数据集，共2000多张图片，标注fire，<a href="https://aistudio.baidu.com/datasetdetail/204173" rel="nofollow">点我下载</a></p> 
<p><img src="https://images2.imgbox.com/01/b3/HxKRNt0p_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_300"></a>目录结构</h3> 
<pre><code class="prism language-bash">dataset/
 validation/
  fire/
    image1.jpg
    image2.jpg
    <span class="token punctuation">..</span>.
 train/
  no_fire/
  
    image1.jpg
    image2.jpg
    <span class="token punctuation">..</span>.

</code></pre> 
<h3><a id="_317"></a>代码</h3> 
<p>创建一个名为main.py的Python脚本，内容如下：</p> 
<pre><code class="prism language-bash"><span class="token function">import</span> tensorflow as tf
from tensorflow.keras.preprocessing.image <span class="token function">import</span> ImageDataGenerator
from tensorflow.keras.applications <span class="token function">import</span> VGG16
from tensorflow.keras.layers <span class="token function">import</span> Dense, Flatten
from tensorflow.keras.models <span class="token function">import</span> Model
<span class="token function">import</span> os

<span class="token comment"># 数据预处理</span>
train_dir <span class="token operator">=</span> <span class="token string">'dataset/train'</span>
validation_dir <span class="token operator">=</span> <span class="token string">'dataset/validation'</span>

train_datagen <span class="token operator">=</span> ImageDataGenerator<span class="token punctuation">(</span>
    <span class="token assign-left variable">rescale</span><span class="token operator">=</span><span class="token number">1</span>./255,
    <span class="token assign-left variable">rotation_range</span><span class="token operator">=</span><span class="token number">20</span>,
    <span class="token assign-left variable">width_shift_range</span><span class="token operator">=</span><span class="token number">0.2</span>,
    <span class="token assign-left variable">height_shift_range</span><span class="token operator">=</span><span class="token number">0.2</span>,
    <span class="token assign-left variable">shear_range</span><span class="token operator">=</span><span class="token number">0.2</span>,
    <span class="token assign-left variable">zoom_range</span><span class="token operator">=</span><span class="token number">0.2</span>,
    <span class="token assign-left variable">horizontal_flip</span><span class="token operator">=</span>True,
    <span class="token assign-left variable">fill_mode</span><span class="token operator">=</span><span class="token string">'nearest'</span>
<span class="token punctuation">)</span>

test_datagen <span class="token operator">=</span> ImageDataGenerator<span class="token punctuation">(</span>rescale<span class="token operator">=</span><span class="token number">1</span>./255<span class="token punctuation">)</span>

train_generator <span class="token operator">=</span> train_datagen.flow_from_directory<span class="token punctuation">(</span>
    train_dir,
    <span class="token assign-left variable">target_size</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">150</span>, <span class="token number">150</span><span class="token punctuation">)</span>,
    <span class="token assign-left variable">batch_size</span><span class="token operator">=</span><span class="token number">32</span>,
    <span class="token assign-left variable">class_mode</span><span class="token operator">=</span><span class="token string">'binary'</span>
<span class="token punctuation">)</span>

validation_generator <span class="token operator">=</span> test_datagen.flow_from_directory<span class="token punctuation">(</span>
    validation_dir,
    <span class="token assign-left variable">target_size</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">150</span>, <span class="token number">150</span><span class="token punctuation">)</span>,
    <span class="token assign-left variable">batch_size</span><span class="token operator">=</span><span class="token number">32</span>,
    <span class="token assign-left variable">class_mode</span><span class="token operator">=</span><span class="token string">'binary'</span>
<span class="token punctuation">)</span>

<span class="token comment"># 使用预训练的VGG16模型</span>
base_model <span class="token operator">=</span> VGG16<span class="token punctuation">(</span>weights<span class="token operator">=</span><span class="token string">'imagenet'</span>, <span class="token assign-left variable">include_top</span><span class="token operator">=</span>False, <span class="token assign-left variable">input_shape</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">150</span>, <span class="token number">150</span>, <span class="token number">3</span><span class="token punctuation">))</span>

<span class="token comment"># 添加自定义顶层</span>
x <span class="token operator">=</span> base_model.output
x <span class="token operator">=</span> Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
x <span class="token operator">=</span> Dense<span class="token punctuation">(</span><span class="token number">128</span>, <span class="token assign-left variable">activation</span><span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
predictions <span class="token operator">=</span> Dense<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token assign-left variable">activation</span><span class="token operator">=</span><span class="token string">'sigmoid'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>

model <span class="token operator">=</span> Model<span class="token punctuation">(</span>inputs<span class="token operator">=</span>base_model.input, <span class="token assign-left variable">outputs</span><span class="token operator">=</span>predictions<span class="token punctuation">)</span>

<span class="token comment"># 冻结VGG16的卷积层</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">layer</span> <span class="token keyword">in</span> base_model.layers:
    layer.trainable <span class="token operator">=</span> False

<span class="token comment"># 编译模型</span>
model.compile<span class="token punctuation">(</span>optimizer<span class="token operator">=</span><span class="token string">'adam'</span>, <span class="token assign-left variable">loss</span><span class="token operator">=</span><span class="token string">'binary_crossentropy'</span>, <span class="token assign-left variable">metrics</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 训练模型</span>
model.fit<span class="token punctuation">(</span>
    train_generator,
    <span class="token assign-left variable">steps_per_epoch</span><span class="token operator">=</span>train_generator.samples // train_generator.batch_size,
    <span class="token assign-left variable">validation_data</span><span class="token operator">=</span>validation_generator,
    <span class="token assign-left variable">validation_steps</span><span class="token operator">=</span>validation_generator.samples // validation_generator.batch_size,
    <span class="token assign-left variable">epochs</span><span class="token operator">=</span><span class="token number">10</span>
<span class="token punctuation">)</span>

<span class="token comment"># 保存模型</span>
model.save<span class="token punctuation">(</span><span class="token string">'fire_detection_model.h5'</span><span class="token punctuation">)</span>

<span class="token comment"># 评估模型</span>
loss, accuracy <span class="token operator">=</span> model.evaluate<span class="token punctuation">(</span>validation_generator<span class="token punctuation">)</span>
print<span class="token punctuation">(</span>f<span class="token string">"Validation Accuracy: {accuracy*100:.2f}%"</span><span class="token punctuation">)</span>

</code></pre> 
<h3><a id="_396"></a>操作</h3> 
<p>SSH连接到开发板进行项目上传</p> 
<p><img src="https://images2.imgbox.com/19/fa/jgA4mxCD_o.png" alt="在这里插入图片描述"></p> 
<p>等待上传完成（有点漫长…）</p> 
<p><img src="https://images2.imgbox.com/99/9f/lSuKpC6p_o.png" alt="在这里插入图片描述"></p> 
<p><strong>安装必要库</strong><br> 在Orange Pi AI Pro上安装所需的库</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> python3-pip
pip3 <span class="token function">install</span> numpy pandas tensorflow keras opencv-python
</code></pre> 
<p>安装模块中</p> 
<p><img src="https://images2.imgbox.com/d5/6f/hxItV3Eq_o.png" alt="在这里插入图片描述"></p> 
<p>错误的话，更新下pip</p> 
<pre><code class="prism language-bash"> pip <span class="token function">install</span> <span class="token parameter variable">--upgrade</span> pip
</code></pre> 
<p><img src="https://images2.imgbox.com/b8/d2/agL6lQBs_o.png" alt="在这里插入图片描述"></p> 
<p>继续报错：</p> 
<pre><code class="prism language-bash"><span class="token punctuation">(</span>venv<span class="token punctuation">)</span> <span class="token punctuation">(</span>.venv<span class="token punctuation">)</span> pip3 <span class="token function">install</span> tensorflow
      running build_ext
      Loading library to get build settings and version: libhdf5.so
      error: Unable to load dependency HDF5, <span class="token function">make</span> sure HDF5 is installed properly
      Library <span class="token function">dirs</span> checked: <span class="token punctuation">[</span><span class="token punctuation">]</span>
      error: libhdf5.so: cannot <span class="token function">open</span> shared object file: No such <span class="token function">file</span> or directory
      <span class="token punctuation">[</span>end of output<span class="token punctuation">]</span>
  
  note: This error originates from a subprocess, and is likely not a problem with pip.
  ERROR: Failed building wheel <span class="token keyword">for</span> h5py
Failed to build h5py
ERROR: ERROR: Failed to build installable wheels <span class="token keyword">for</span> some pyproject.toml based projects <span class="token punctuation">(</span>h5py<span class="token punctuation">)</span>
<span class="token punctuation">(</span>venv<span class="token punctuation">)</span> <span class="token punctuation">(</span>.venv<span class="token punctuation">)</span> 

</code></pre> 
<blockquote> 
 <p>Orange Pi AI Pro默认Python环境3.9.9 更新pip后直接安装tensorflow当到h5py时候报错，尝试先安装h5py再安装tensorflow，版本号如下：<br> pip install h5py<mark>3.8.0<br> pip install tensorflow</mark>2.11.0</p> 
</blockquote> 
<pre><code class="prism language-bash">/root/Desktop/project/.venv/bin/python /root/Desktop/project/main.py 
RuntimeError: module compiled against API version 0x10 but this version of numpy is 0xf
RuntimeError: module compiled against API version 0x10 but this version of numpy is 0xf
ImportError: numpy.core._multiarray_umath failed to <span class="token function">import</span>
ImportError: numpy.core.umath failed to <span class="token function">import</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:
  File <span class="token string">"/root/Desktop/project/main.py"</span>, line <span class="token number">1</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
    <span class="token function">import</span> tensorflow as tf
  File <span class="token string">"/usr/local/lib64/python3.9/site-packages/tensorflow/__init__.py"</span>, line <span class="token number">37</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
   packages/tensorflow/python/framework/dtypes.py", line <span class="token number">34</span>, <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
    _np_bfloat16 <span class="token operator">=</span> _pywrap_bfloat16.TF_bfloat16_type<span class="token punctuation">(</span><span class="token punctuation">)</span>
TypeError: Unable to convert <span class="token keyword">function</span> <span class="token builtin class-name">return</span> value to a Python type<span class="token operator">!</span> The signature was
	<span class="token punctuation">(</span><span class="token punctuation">)</span> -<span class="token operator">&gt;</span> handle

</code></pre> 
<blockquote> 
 <p>这个错误表明 TensorFlow 在导入过程中与 NumPy 版本之间存在不兼容的问题。这通常是由于 TensorFlow 和 NumPy 版本之间的API不匹配引起的。</p> 
</blockquote> 
<p>可以尝试tensorflow==2.4.0</p> 
<p><img src="https://images2.imgbox.com/52/a7/nBC3VtzO_o.png" alt="在这里插入图片描述"></p> 
<p>安装成功后运行即可</p> 
<pre><code class="prism language-bash">Found <span class="token number">100</span> images belonging to <span class="token number">2</span> classes.
Found <span class="token number">100</span> images belonging to <span class="token number">2</span> classes.
<span class="token number">2024</span>-07-16 <span class="token number">16</span>:57:17.388409: I tensorflow/core/platform/cpu_feature_guard.cc:193<span class="token punctuation">]</span> This TensorFlow binary is optimized with oneAPI Deep Neural Network Library <span class="token punctuation">(</span>oneDNN<span class="token punctuation">)</span> to use the following CPU instructions <span class="token keyword">in</span> performance-critical operations:  AVX
To <span class="token builtin class-name">enable</span> them <span class="token keyword">in</span> other operations, rebuild TensorFlow with the appropriate compiler flags.
<span class="token number">3</span>/3 <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> - 42s 20s/step - loss: <span class="token number">1.3637</span> - accuracy: <span class="token number">0.4265</span> - val_loss: <span class="token number">0.9231</span> - val_accuracy: <span class="token number">0.4531</span>
<span class="token number">4</span>/4 <span class="token punctuation">[</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token punctuation">]</span> - 30s 7s/step - loss: <span class="token number">0.8841</span> - accuracy: <span class="token number">0.5000</span>
Validation Accuracy: <span class="token number">70</span>%
</code></pre> 
<p><img src="https://images2.imgbox.com/99/db/1ccUrg5Y_o.png" alt="在这里插入图片描述"></p> 
<p>查看模型文件</p> 
<p><img src="https://images2.imgbox.com/d6/ed/aEkwfYQ3_o.png" alt="在这里插入图片描述"></p> 
<p><strong>使用模型文件进行预测</strong></p> 
<p>待检测图片</p> 
<p><img src="https://images2.imgbox.com/dc/0e/i7p8gUUV_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token function">import</span> tensorflow as tf
from tensorflow.keras.preprocessing <span class="token function">import</span> image
<span class="token function">import</span> numpy as np

<span class="token comment"># 加载已保存的模型</span>
model <span class="token operator">=</span> tf.keras.models.load_model<span class="token punctuation">(</span><span class="token string">'fire_detection_model.h5'</span><span class="token punctuation">)</span>

<span class="token comment"># 预处理单张图片的函数</span>
def preprocess_image<span class="token punctuation">(</span>img_path, <span class="token assign-left variable">target_size</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">150</span>, <span class="token number">150</span><span class="token punctuation">))</span>:
    img <span class="token operator">=</span> image.load_img<span class="token punctuation">(</span>img_path, <span class="token assign-left variable">target_size</span><span class="token operator">=</span>target_size<span class="token punctuation">)</span>  <span class="token comment"># 加载图片并调整大小</span>
    img_array <span class="token operator">=</span> image.img_to_array<span class="token punctuation">(</span>img<span class="token punctuation">)</span>  <span class="token comment"># 将图片转换为数组</span>
    img_array <span class="token operator">=</span> np.expand_dims<span class="token punctuation">(</span>img_array, <span class="token assign-left variable">axis</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 增加一个维度</span>
    img_array /<span class="token operator">=</span> <span class="token number">255.0</span>  <span class="token comment"># 归一化</span>
    <span class="token builtin class-name">return</span> img_array

<span class="token comment"># 图片路径</span>
img_path <span class="token operator">=</span> <span class="token string">'path_to_your_image.jpg'</span>

<span class="token comment"># 预处理图片</span>
img_array <span class="token operator">=</span> preprocess_image<span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>

<span class="token comment"># 进行预测</span>
prediction <span class="token operator">=</span> model.predict<span class="token punctuation">(</span>img_array<span class="token punctuation">)</span>

<span class="token comment"># 输出预测结果</span>
<span class="token keyword">if</span> prediction<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0.5</span>:
    print<span class="token punctuation">(</span>f<span class="token string">"The image at {img_path} is predicted to be a fire with a probability of {prediction[0][0]*100:.2f}%."</span><span class="token punctuation">)</span>
else:
    print<span class="token punctuation">(</span>f<span class="token string">"The image at {img_path} is predicted to be non-fire with a probability of {(1-prediction[0][0])*100:.2f}%."</span><span class="token punctuation">)</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/66/30/GAtmk4xo_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>0bb3c0c6-744d-4b31-be3f-d0cdbc844de1.jpg处的图像被预测为非火灾，概率为86.67%。</p> 
</blockquote> 
<p>如果训练数据继续增加会提高识别正确率</p> 
<p><code>体验评价：Orange Pi AI Pro提供的内置工具以及模块，对于机器学习模型的开发和训练提供了便捷的环境。这些工具支持常见的深度学习框架，并且可以利用板载的NPU进行加速，有效提高了模型训练和推理的效率</code></p> 
<h2><a id="_571"></a>安装宝塔</h2> 
<p>Orange Pi AI Pro 还可以搭建服务器，挂载个人网站或者脚本，我们部署宝塔在开发板里面</p> 
<p>Ubuntu/Deepin安装脚本</p> 
<pre><code class="prism language-bash"><span class="token function">wget</span> <span class="token parameter variable">-O</span> install.sh https://download.bt.cn/install/install-ubuntu_6.0.sh <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> <span class="token function">bash</span> install.sh ed8484bec
</code></pre> 
<p><img src="https://images2.imgbox.com/ba/b2/GrtTFoJC_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/4e/c6/dOvENzCW_o.png" alt="在这里插入图片描述"></p> 
<p>上传项目到文件夹</p> 
<p><img src="https://images2.imgbox.com/d9/5a/GZV3W34p_o.png" alt="在这里插入图片描述"></p> 
<p>安装python3.7</p> 
<p><img src="https://images2.imgbox.com/aa/74/VFM7RrOP_o.png" alt="在这里插入图片描述"></p> 
<p>新建项目</p> 
<p><img src="https://images2.imgbox.com/3f/19/hALpN75j_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/fc/a3/qmZKbD3i_o.png" alt="在这里插入图片描述"></p> 
<p>安装模块</p> 
<table><thead><tr><th>模块名</th><th>版本</th></tr></thead><tbody><tr><td>tensorflow</td><td>2.11.0</td></tr></tbody></table> 
<p>运行项目</p> 
<p><img src="https://images2.imgbox.com/81/0d/wWxFrywd_o.png" alt="在这里插入图片描述"></p> 
<p><code>体验评价：安装宝塔进行测试显示出了Orange Pi AI Pro在部署和管理网络应用时的灵活性和可扩展性。宝塔能够简化服务器的管理和配置，对于需要快速搭建和测试网络应用的场景非常有用。</code></p> 
<h3><a id="_631"></a>训练中的开发板表现</h3> 
<h4><a id="_632"></a>负载方面</h4> 
<p>在测试时，我深刻感受到了开发板在应对复杂计算任务时的表现。首先，从负载管理的角度来看，VGG16作为一个相对深层的卷积神经网络，其对计算资源的需求不言而喻。令人欣慰的是，这款开发板凭借其强大的处理器和多核架构设计，展现出了出色的负载处理能力。即便是在连续进行高清图片流中的火灾特征提取与分类时，CPU的利用率始终保持在合理范围内，没有出现明显的卡顿或延迟现象，确保了火灾检测的实时性与准确性。</p> 
<h4><a id="_636"></a>散热方面</h4> 
<p>该开发板定位就是Ai路线，在高速计算中会产生热量很正常，在散热方面，接入风扇后，开发板可自动根据自身温度调整转速，长时间高负载运行下，机身温度虽有上升，但得益于其精良的散热设计与高效的热传导材料，热量得以迅速分散并排出，避免了因过热而导致的性能下降或系统不稳定。<br> 我注意到，即便是在封闭或较为温暖的环境中测试，开发板的温度控制依然保持在安全阈值以下，这一点对于需要持续稳定运行的工业级或安防级应用尤为重要。</p> 
<h2><a id="_639"></a>最后</h2> 
<p>经过测试体验，我对这款开发板在火灾检测应用中的表现深感满意。<br> 它不仅在技术上满足了高性能计算的需求，更在用户体验上给了我很多惊喜。特别是在面对高负载和长时间运行考验时，开发板展现出的稳定性与可靠性，让我对其在实际应用场景中的表现充满信心。</p> 
<p>此外，其优秀的散热设计也让我感受到了设计者对细节的关注与追求，这种对产品质量的坚持，无疑为用户提供了更加安心和可靠的使用体验。<br> Orange Pi AI Pro在处理能力、专注AI应用和扩展性方面表现突出，适合于需要更高性能和复杂计算的应用。对比树莓派则以其成本效益、广泛的社区支持和适用于教育等广泛场景的特点而获得广泛认可。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d99835c8517c8bf2746665c2984473dc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Apache Paimon 在蚂蚁的应用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/427cc081c46aa624ed3d9ff5b9c77119/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">leetcode145. 二叉树的后序遍历，递归法&#43;迭代法，全过程图解&#43;步步解析，一点点教会你迭代法后序遍历</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>