<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>踩坑：Unity导出WebGL发布到手机上竖屏时强制显示横屏 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/4d426204bb02efcad17413d459103d4f/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="踩坑：Unity导出WebGL发布到手机上竖屏时强制显示横屏">
  <meta property="og:description" content="具体的适配问题 公司的项目需要将游戏导出WebGL 发布到Web平台 本以为是个很简单的事情 谁知道却被个横竖屏适配搞的头晕 毕竟只有大学浅浅的学了下HTML这门语言 出来工作后基本上都是在跟C# Lua打交道 言归正传 看看具体问题吧
游戏如果从横屏进入 基本上不会有什么适配问题
但是现在人大多数手机都是开着 锁定屏幕方向 这就导致大部分人其实是以竖屏进入游戏的
像这样：
这样显然是不符合用户体验的 要用户先把屏幕锁定关了 在旋转成横屏 这一操作在游戏引流里都可以直接劝退一波用户了
解决方案 理论方案 理论上解决很简单 只需在index里进入时判断手机方向并监听手机旋转事件
&lt;script&gt; var orientation = window.orientation; if(orientation == 180 || orientation == 0 || orientation == -180){ //竖屏 }else{ //横屏 orientation = 90 或者 orientation = -90 } window.onorientationchange = function () { //监听手机旋转事件 if(orientation == 180 || orientation == 0 || orientation == -180){ //竖屏 旋转-90度 }else{ //横屏 旋转90度 } }; &lt;/script&gt; 改变">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-05T15:21:11+08:00">
    <meta property="article:modified_time" content="2024-06-05T15:21:11+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">踩坑：Unity导出WebGL发布到手机上竖屏时强制显示横屏</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3></h3> 
<h3>具体的适配问题</h3> 
<p>公司的项目需要将游戏导出WebGL 发布到Web平台 本以为是个很简单的事情 谁知道却被个横竖屏适配搞的头晕 毕竟只有大学浅浅的学了下HTML这门语言 出来工作后基本上都是在跟C# Lua打交道 言归正传 看看具体问题吧</p> 
<p>游戏如果从横屏进入 基本上不会有什么适配问题</p> 
<p class="img-center"><img alt="" height="346" src="https://images2.imgbox.com/66/89/qz2UCnee_o.png" width="636"></p> 
<p>但是现在人大多数手机都是开着 锁定屏幕方向 这就导致大部分人其实是以竖屏进入游戏的</p> 
<p>像这样：</p> 
<p class="img-center"><img alt="" height="921" src="https://images2.imgbox.com/ec/3e/yq6rMgaS_o.png" width="648"></p> 
<p>这样显然是不符合用户体验的 要用户先把屏幕锁定关了 在旋转成横屏 这一操作在游戏引流里都可以直接劝退一波用户了</p> 
<h3>解决方案</h3> 
<h4>理论方案</h4> 
<p>理论上解决很简单 只需在index里进入时判断手机方向并监听手机旋转事件</p> 
<pre><code class="language-html">&lt;script&gt;
    var orientation = window.orientation;
    if(orientation == 180 || orientation == 0 || orientation == -180){
        //竖屏
    }else{
        //横屏 orientation = 90 或者 orientation = -90 
    }

    window.onorientationchange = function () {
        //监听手机旋转事件
        if(orientation == 180 || orientation == 0 || orientation == -180){
            //竖屏 旋转-90度
        }else{
            //横屏 旋转90度
        }
    };
&lt;/script&gt;</code></pre> 
<p>改变</p> 
<pre><code class="language-html">&lt;canvas id="unity-canvas"&gt;&lt;/canvas&gt;</code></pre> 
<p>或者其他嵌套unity-container的标签通过CSS的旋转属性旋转90度就搞定了</p> 
<pre><code class="language-css">transform: rotate(90deg)</code></pre> 
<p>但是实际上并没有那么快乐 经过你不断的努力调整标签终于实现了你就会发现</p> 
<p><img alt="" height="924" src="https://images2.imgbox.com/cb/4e/uPrtU181_o.png" width="651"></p> 
<p>先不说比例问题 最致命的问题是 旋转后 按钮的碰撞监听并没有旋转 按钮的实际监听范围还是红框 这一下子就犯了难 研究许久后发现需要使用HTML中的&lt;iframe&gt;标签来解决</p> 
<pre><code class="language-html">&lt;iframe src="game.html"&gt;&lt;/iframe&gt;</code></pre> 
<h4>实际解决</h4> 
<p>新建一个新的index.html  将原本的index重命名为game 通过iframe标签引入到新的index里面</p> 
<p>同时在新的index里面监听手机旋转事件 通过添加删除类来旋转页面</p> 
<p>代码如下</p> 
<pre><code class="language-html">&lt;style&gt;
    .landscape-screen{
	    transform-origin: top left;
	    transform: rotate(90deg) translateY(-100%)
    }
&lt;/style&gt;
&lt;iframe id="Frame" style="Frame"  src="game.html"&gt;&lt;/iframe&gt;
&lt;script&gt;
    var orientation = window.orientation;
			
	//开始时调用
	var Frame = document.getElementById("Frame");
	if(orientation == 180 || orientation == 0 || orientation == -180){
		//注意竖屏时要把 iframe的宽设置为当前窗口的高度 高设置为当前窗口的宽度
		Frame.height = window.innerWidth;
		Frame.width = window.innerHeight;
				
		//通过css样式旋转90度
		Frame.classList.add("landscape-screen");
	}else{
		//横屏时则正常
		Frame.height = window.innerHeight;
		Frame.width = window.innerWidth;
				
		//通过移除类去掉css样式
		Frame.classList.remove("landscape-screen");
	}
			
	//监听手机旋转事件 根据旋转状态设置旋转的css样式
	window.onorientationchange = function () {
        if(orientation == 180 || orientation == 0 || orientation == -180){
			Frame.classList.add("landscape-screen");
		}else{
			Frame.classList.remove("landscape-screen");
		}
     };
&lt;/script&gt;</code></pre> 
<p> 而我们的game.html(原本U3D导出的index.html) 只需要做好全屏适配即可</p> 
<p>运行效果如下</p> 
<p>竖屏进入→转横屏</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/9c/48/zUVS1JIE_o.gif"></p> 
<p>横屏进入→转竖屏</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/20/5c/NVXRZJoe_o.gif"></p> 
<p>至此适配方案结束</p> 
<h3>演示DEMO链接</h3> 
<p><a href="https://github.com/Wyleee/UnityWebGLMobileAdapter" title="GitHub - Wyleee/UnityWebGLMobileAdapter: 演示Unity导出的WebGL项目在手机上的横竖屏适配">GitHub - Wyleee/UnityWebGLMobileAdapter: 演示Unity导出的WebGL项目在手机上的横竖屏适配</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a39eb477a958ba19dd583d2f9a2fa4a9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Windows下使用netty的SelfSignedCertificate进行SSL加密通信</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bc1e2964e874f6eb626b0d8c9c294c7b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">实战：Zig 编写高性能 Web 服务（2）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>