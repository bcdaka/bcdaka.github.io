<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MySQL报错：sql_mode=only_full_group_by解决方法 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/033888b0622bcc7ef1cb195c60ba0d1e/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="MySQL报错：sql_mode=only_full_group_by解决方法">
  <meta property="og:description" content="Linux环境 ubuntu 22.04 MySQL是8.0.35版本
问题描述 Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column &#39;auth_system.t_class_temp_config.id&#39; which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by
问题分析 这个错误是由于 MySQL 数据库的 SQL 模式中启用了 only_full_group_by，它要求在使用 GROUP BY 语句时，SELECT 中的字段必须要么包含在 GROUP BY 子句中，要么是聚合函数的参数。在查询中，SELECT 中的字段不符合这个规则，导致了错误的出现。
因为在MySQL 5.7后，MySQL默认开启了SQL_MODE严格模式，对数据进行严格校验。如果代码中含有group by聚合操作，那么select中的列，除了使用聚合函数之外的，如max()、min()等，都必须出现在group by中。
举例说明：
错误示范：
select Chengdu,Shanghai from city group by Chengdu
正确示范：
select Chengdu,Shanghai from city group by Chengdu,Shanghai">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-22T14:39:46+08:00">
    <meta property="article:modified_time" content="2024-02-22T14:39:46+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MySQL报错：sql_mode=only_full_group_by解决方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>Linux环境</h3> 
<p>ubuntu 22.04 MySQL是8.0.35版本</p> 
<h3>问题描述</h3> 
<p>Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column 'auth_system.t_class_temp_config.id' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with <span style="color:#fe2c24;">sql_mode=only_full_group_by</span></p> 
<h3>问题分析</h3> 
<p>这个错误是由于 MySQL 数据库的 SQL 模式中启用了 <code>only_full_group_by</code>，它要求在使用 GROUP BY 语句时，SELECT 中的字段必须要么包含在 GROUP BY 子句中，要么是聚合函数的参数。在查询中，SELECT 中的字段不符合这个规则，导致了错误的出现。</p> 
<p>因为在MySQL 5.7后，MySQL默认开启了SQL_MODE<a href="https://so.csdn.net/so/search?q=%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F&amp;spm=1001.2101.3001.7020" title="严格模式">严格模式</a>，对数据进行严格校验。如果代码中含有group by聚合操作，那么select中的列，除了使用聚合函数之外的，如max()、min()等，都必须出现在group by中。</p> 
<p>举例说明：</p> 
<p>错误示范：</p> 
<p>select Chengdu,Shanghai from city group by Chengdu</p> 
<p>正确示范：</p> 
<p>select Chengdu,Shanghai from city group by Chengdu,Shanghai</p> 
<h3>解决方法</h3> 
<h4>方案一：更改数据库配置</h4> 
<h5>1.在Linux环境先登录MySQL</h5> 
<h5>2.在MySQL中输入如下命令进行查看</h5> 
<pre><code class="hljs">select @@global.sql_mode;</code></pre> 
<p><img alt="" height="232" src="https://images2.imgbox.com/73/69/WJzMIWJT_o.png" width="830"></p> 
<p>可以发现MySQL的sql_mode是开启了ONLY_FULL_GROUP_NY。</p> 
<p><span style="color:#ff9900;">说明：解释sql_mode的含义</span></p> 
<p style="margin-left:.0001pt;text-align:justify;">（1）ONLY_FULL_GROUP_NY</p> 
<p style="margin-left:.0001pt;text-align:justify;">        含义：启用这个模式后，MySQL 在执行 GROUP BY 操作时，要求 SELECT 语句中的列必须是 GROUP BY 子句中的分组列或者包含在聚合函数中。换句话说，要求 SELECT 中的非聚合列必须在 GROUP BY 子句中出现。</p> 
<p style="margin-left:.0001pt;text-align:justify;">        作用：这个模式的作用是增强 SQL 查询语句的严格性，避免因数据未正确分组而导致结果不确定性的情况发生。通过强制要求所有非聚合列都在 GROUP BY 子句中列出，确保了查询结果的准确性和一致性</p> 
<p style="margin-left:.0001pt;text-align:justify;">（2）STRICT_TRANS_TABLES</p> 
<p style="margin-left:.0001pt;text-align:justify;">        含义：当启用这个模式时，MySQL 会对事务中的数据插入和更新进行严格的类型检查，确保数据的准确性和完整性。</p> 
<p style="margin-left:.0001pt;text-align:justify;">        作用：在插入或更新数据时，如果发生类型不匹配或者值超出范围等问题，将会产生错误，确保了数据的一致性。</p> 
<p style="margin-left:.0001pt;text-align:justify;">（3）NO_ZERO_IN_DATE</p> 
<p style="margin-left:.0001pt;text-align:justify;">        含义：禁止在日期中使用 '0000-00-00' 或 '0000-00-00 00:00:00' 这样的值。</p> 
<p style="margin-left:.0001pt;text-align:justify;">        作用：当启用这个模式时，MySQL 会禁止插入或更新日期字段为零值，以避免不合法的日期值的存储。</p> 
<p style="margin-left:.0001pt;text-align:justify;">（4）NO_ZERO_DATE</p> 
<p style="margin-left:.0001pt;text-align:justify;">        含义：禁止在日期中使用 '0000-00-00' 这样的值。</p> 
<p style="margin-left:.0001pt;text-align:justify;">        作用：与 NO_ZERO_IN_DATE 类似，这个模式也是为了避免不合法的日期值的存储。</p> 
<p style="margin-left:.0001pt;text-align:justify;">（5）ERROR_FOR_DIVISION_BY_ZERO</p> 
<p style="margin-left:.0001pt;text-align:justify;">         含义：当启用这个模式时，MySQL 在发生除零错误时将产生一个错误，而不是返回 NULL 或者一个警告。</p> 
<p style="margin-left:.0001pt;text-align:justify;">         作用：这个模式确保了在执行除法操作时，避免了由于除零而导致的意外结果，提高了数据计算的准确性。</p> 
<p style="margin-left:.0001pt;text-align:justify;">（6）NO_ENGINE_SUBSTITUTION</p> 
<p style="margin-left:.0001pt;text-align:justify;">         含义：如果指定的存储引擎不可用，将不会自动替换为默认的存储引擎。</p> 
<p style="margin-left:.0001pt;text-align:justify;">         作用：这个模式要求所指定的存储引擎必须可用，如果不可用，则会产生错误，确保了使用正确的存储引擎。</p> 
<ol><li> </li></ol> 
<h5>3.重新设置sql_mode</h5> 
<p>即把ONLY_FULL_GROUP_NY.去除，其他不变即可。</p> 
<pre><code>SET GLOBAL sql_mode='STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';</code></pre> 
<p>这个方案有个缺点就是重启数据库之后，配置会失效。</p> 
<h4>方案二：更改数据库配置（永久生效）</h4> 
<p>找到MySQL安装时的配置文件my.cnf，在mysqld下添加如下配置即可。</p> 
<pre><code class="hljs">sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION</code></pre> 
<p><img alt="" height="384" src="https://images2.imgbox.com/04/a6/OLrpNZww_o.png" width="1200"></p> 
<p>保存并退出。重启MySQL即可生效。</p> 
<p>验证</p> 
<p><img alt="" height="232" src="https://images2.imgbox.com/45/43/KgieySVN_o.png" width="830"></p> 
<h4> 方案三：调整sql语句</h4> 
<p>根据您的实际需求，可以修改查询语句，确保 SELECT 中的字段要么包含在 GROUP BY 子句中，要么作为聚合函数的参数。例如：</p> 
<p>SELECT id, MAX(column_name) FROM your_table GROUP BY id;</p> 
<h4>方案四:临时表</h4> 
<p>在子查询中使用临时表，以避免直接在主查询中使用 GROUP BY。这种方法可能需要对查询进行重新设计，但可以绕过 <code>only_full_group_by</code> 的限制。</p> 
<p>参考：<a href="https://blog.csdn.net/qq118640594X/article/details/128024350?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=MySQL%E7%A6%81%E7%94%A8sqlmode=only_full_group&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~sobaiduweb~default-0-128024350.nonecase&amp;spm=1018.2226.3001.4450" title="MySQL报错：sql_mode=only_full_group_by 4种解决方法含举例，轻松解决ONLY_FULL_GROUP_BY的报错问题-CSDN博客">MySQL报错：sql_mode=only_full_group_by 4种解决方法含举例，轻松解决ONLY_FULL_GROUP_BY的报错问题-CSDN博客</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e440d7ca797d9317d0bc0dc97ec5ab8b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Java】上传图片至阿里云oss服务器,文件上传以及图片base64上传</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/afdf20eccd7966debf9872dcf39956c7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【java集成onlyoffice实现多人在线编辑的介绍和代码实现】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>