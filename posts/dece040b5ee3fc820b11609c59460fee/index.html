<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>spdlog一个非常好用的C&#43;&#43;日志库(八): 自定义格式化符号 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/dece040b5ee3fc820b11609c59460fee/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="spdlog一个非常好用的C&#43;&#43;日志库(八): 自定义格式化符号">
  <meta property="og:description" content="目录
1.前言
2.使用set_pattern(..)自定义格式符号
3.格式化标记符(Pattern flags)
4.对齐方式
5.扩展spdlog自定义格式
6.字符串格式化
1.前言 每个记录器的接收器sink都有一个格式化器，用于将消息格式化到其目的地。
spdlog的默认日志记录格式为： [2014-10-31 23:46:59.678] [my_loggername] [info] Some message 有两种方法可以自定义记录器的格式：
1）设置模式字符串（推荐）：
set_pattern(pattern_string); 2) 实现实现格式化程序接口和调用的自定义格式化程序：
set_formatter(std::make_unique&lt;my_custom_formater&gt;()); 2.使用set_pattern(..)自定义格式符号 格式可以全局应用于所有注册的记录器 loggers：
spdlog::set_pattern(&#34;*** [%H:%M:%S %z] [thread %t] %v ***&#34;); 或者用于特定的记录器 loggers：
some_logger-&gt;set_pattern(&#34;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; %H:%M:%S %z %v &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#34;); 或者用于特定sink对象：
some_logger-&gt;sinks()[0]-&gt;set_pattern(&#34;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; %H:%M:%S %z %v &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#34;); some_logger-&gt;sinks()[1]-&gt;set_pattern(&#34;..&#34;); 3.格式化标记符(Pattern flags) 格式化标记符以%flag的形式出现，类似于strftime函数。以下是一些常用的模式标志及其含义：
标记含义例子%v 要记录的实际文本
&#34;some user text&#34;%t 线程ID
&#34;1232&#34;%P 进程ID
&#34;3456&#34;%n logger的名称
&#34;some logger name&#34;%l 消息的日志级别（如&#34;debug&#34;、&#34;info&#34;等）
&#34;debug&#34;, &#34;info&#34;, etc%L 消息的简短日志级别（如&#34;D&#34;、&#34;I&#34;等）
&#34;D&#34;, &#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-14T22:46:58+08:00">
    <meta property="article:modified_time" content="2024-07-14T22:46:58+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">spdlog一个非常好用的C&#43;&#43;日志库(八): 自定义格式化符号</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="main-toc-toc" style="margin-left:0px;"><a href="#main-toc" rel="nofollow">1.前言</a></p> 
<p id="2.%E4%BD%BF%E7%94%A8set_pattern(..)%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%BC%E5%BC%8F%E7%AC%A6%E5%8F%B7-toc" style="margin-left:0px;"><a href="#2.%E4%BD%BF%E7%94%A8set_pattern%28..%29%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%BC%E5%BC%8F%E7%AC%A6%E5%8F%B7" rel="nofollow">2.使用set_pattern(..)自定义格式符号</a></p> 
<p id="3.%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%A0%87%E8%AE%B0%E7%AC%A6(Pattern%20flags)-toc" style="margin-left:0px;"><a href="#3.%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%A0%87%E8%AE%B0%E7%AC%A6%28Pattern%20flags%29" rel="nofollow">3.格式化标记符(Pattern flags)</a></p> 
<p id="4.%E5%AF%B9%E9%BD%90%E6%96%B9%E5%BC%8F-toc" style="margin-left:0px;"><a href="#4.%E5%AF%B9%E9%BD%90%E6%96%B9%E5%BC%8F" rel="nofollow">4.对齐方式</a></p> 
<p id="5.%E6%89%A9%E5%B1%95spdlog%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%BC%E5%BC%8F-toc" style="margin-left:0px;"><a href="#5.%E6%89%A9%E5%B1%95spdlog%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%BC%E5%BC%8F" rel="nofollow">5.扩展spdlog自定义格式</a></p> 
<p id="6.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96-toc" style="margin-left:0px;"><a href="#6.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96" rel="nofollow">6.字符串格式化</a></p> 
<hr id="hr-toc"> 
<h2>1.前言</h2> 
<p>        每个记录器的接收器sink都有一个格式化器，用于将消息格式化到其目的地。</p> 
<p>        spdlog的默认日志记录格式为：  </p> 
<pre><code class="language-cpp">  [2014-10-31 23:46:59.678]  [my_loggername]  [info]  Some message</code></pre> 
<p>        有两种方法可以自定义记录器的格式：</p> 
<p>         1）设置模式字符串（推荐）：</p> 
<pre><code class="language-cpp">     set_pattern(pattern_string);</code></pre> 
<p>         2)  实现实现格式化程序接口和调用的自定义格式化程序：</p> 
<pre><code class="language-cpp">     set_formatter(std::make_unique&lt;my_custom_formater&gt;());</code></pre> 
<h2 id="2.%E4%BD%BF%E7%94%A8set_pattern(..)%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%BC%E5%BC%8F%E7%AC%A6%E5%8F%B7">2.使用set_pattern(..)自定义格式符号</h2> 
<p>格式可以全局应用于所有注册的记录器 loggers：</p> 
<pre><code class="language-cpp">spdlog::set_pattern("*** [%H:%M:%S %z] [thread %t] %v ***");</code></pre> 
<p>或者用于特定的记录器 loggers：</p> 
<pre><code class="language-cpp">some_logger-&gt;set_pattern("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; %H:%M:%S %z %v &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;");</code></pre> 
<p>或者用于特定sink对象：</p> 
<pre><code class="language-cpp">some_logger-&gt;sinks()[0]-&gt;set_pattern("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; %H:%M:%S %z %v &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;");
some_logger-&gt;sinks()[1]-&gt;set_pattern("..");</code></pre> 
<h2 id="3.%E6%A0%BC%E5%BC%8F%E5%8C%96%E6%A0%87%E8%AE%B0%E7%AC%A6(Pattern%20flags)">3.格式化标记符(Pattern flags)</h2> 
<p style="margin-left:.0001pt;text-align:justify;"> 格式化标记符以%flag的形式出现，类似于strftime函数。以下是一些常用的模式标志及其含义：</p> 
<table align="center" border="1" cellpadding="1" cellspacing="1" style="width:630px;"><thead><tr><th>标记</th><th>含义</th><th>例子</th></tr></thead><tbody><tr><td>%v</td><td> <p style="margin-left:.0001pt;text-align:justify;">要记录的实际文本</p> </td><td>"some user text"</td></tr><tr><td>%t</td><td> <p style="margin-left:.0001pt;text-align:justify;">线程ID</p> </td><td>"1232"</td></tr><tr><td>%P</td><td> <p style="margin-left:.0001pt;text-align:justify;">进程ID</p> </td><td>"3456"</td></tr><tr><td>%n</td><td> <p style="margin-left:.0001pt;text-align:justify;">logger的名称</p> </td><td>"some logger name"</td></tr><tr><td>%l</td><td> <p style="margin-left:.0001pt;text-align:justify;">消息的日志级别（如"debug"、"info"等）</p> </td><td>"debug", "info", etc</td></tr><tr><td>%L</td><td> <p style="margin-left:.0001pt;text-align:justify;">消息的简短日志级别（如"D"、"I"等）</p> </td><td>"D", "I", etc</td></tr><tr><td>%a</td><td> <p style="margin-left:.0001pt;text-align:justify;">星期几的缩写</p> </td><td>"Thu"</td></tr><tr><td>%A</td><td> <p style="margin-left:.0001pt;text-align:justify;">星期几的全称</p> </td><td>"Thursday"</td></tr><tr><td>%b</td><td> <p style="margin-left:.0001pt;text-align:justify;">月份的缩写</p> </td><td>"Aug"</td></tr><tr><td>%B</td><td> <p style="margin-left:.0001pt;text-align:justify;">月份的全称</p> </td><td>"August"</td></tr><tr><td>%c</td><td> <p style="margin-left:.0001pt;text-align:justify;">日期和时间的表示</p> </td><td>"Thu Aug 23 15:35:46 2014"</td></tr><tr><td>%C</td><td> <p style="margin-left:.0001pt;text-align:justify;">年份的两位表示</p> </td><td>"14"</td></tr><tr><td>%Y</td><td> <p style="margin-left:.0001pt;text-align:justify;">年份的四位数表示</p> </td><td>"2014"</td></tr><tr><td>%D 或  %x</td><td> <p style="margin-left:.0001pt;text-align:justify;">短日期格式（MM/DD/YY）</p> </td><td>"08/23/14"</td></tr><tr><td>%m</td><td> <p style="margin-left:.0001pt;text-align:justify;">月</p> </td><td>"11"</td></tr><tr><td>%d</td><td> <p style="margin-left:.0001pt;text-align:justify;">日</p> </td><td>"29"</td></tr><tr><td>%H</td><td> <p style="margin-left:.0001pt;text-align:justify;">24小时制的小时数</p> </td><td>"23"</td></tr><tr><td>%I</td><td> <p style="margin-left:.0001pt;text-align:justify;">12小时制的小时数</p> </td><td>"11"</td></tr><tr><td>%M</td><td> <p style="margin-left:.0001pt;text-align:justify;">分钟</p> </td><td>"59"</td></tr><tr><td>%S</td><td> <p style="margin-left:.0001pt;text-align:justify;">秒</p> </td><td>"58"</td></tr><tr><td>%e</td><td> <p style="margin-left:.0001pt;text-align:justify;">毫秒</p> </td><td>"678"</td></tr><tr><td>%f</td><td> <p style="margin-left:.0001pt;text-align:justify;">微秒</p> </td><td>"056789"</td></tr><tr><td>%F</td><td> <p style="margin-left:.0001pt;text-align:justify;">纳秒</p> </td><td>"256789123"</td></tr><tr><td>%p</td><td> <p style="margin-left:.0001pt;text-align:justify;">AM/PM</p> </td><td>"AM"</td></tr><tr><td>%r</td><td>时间表示法</td><td>"02:55:02 PM"</td></tr><tr><td>%R</td><td>时间表示法</td><td>"23:55"</td></tr><tr><td>%T 或 %X</td><td>时间表示法</td><td>"23:55:59"</td></tr><tr><td>%z</td><td>ISO 8601与UTC的时区偏移量（[+/-]HH:MM）</td><td>"+02:00"</td></tr><tr><td>%E</td><td>自纪元以来的秒数</td><td>"1528834770"</td></tr><tr><td>%%</td><td>%符号</td><td>"%"</td></tr><tr><td>%+</td><td>spdlog默认的格式</td><td>"[2014-10-31 23:46:59.678] [mylogger] [info] Some message"</td></tr><tr><td>%^</td><td> <p style="margin-left:.0001pt;text-align:justify;">开始颜色范围</p> </td><td>"[mylogger] [info(green)] Some message"</td></tr><tr><td>%$</td><td> <p style="margin-left:.0001pt;text-align:justify;">结束颜色范围</p> </td><td>[+++] Some message</td></tr><tr><td>%@</td><td>源文件和行号</td><td>/some/dir/my_file.cpp:123</td></tr><tr><td>%s</td><td>源文件(不带路径)</td><td>my_file.cpp</td></tr><tr><td>%g</td><td>源文件(带路径)</td><td>/some/dir/my_file.cpp</td></tr><tr><td>%#</td><td>行号</td><td>123</td></tr><tr><td>%!</td><td>函数名</td><td>my_func</td></tr><tr><td>%o</td><td>自上一条消息以来的运行时间（以毫秒为单位）</td><td>456</td></tr><tr><td>%i</td><td>自上一条消息以来的运行时间（以微秒为单位）</td><td>456</td></tr><tr><td>%u</td><td>自上一条消息以来的运行时间（以纳秒为单位）</td><td>11456</td></tr><tr><td>%O</td><td>自上一条消息以来的运行时间（以秒为单位）</td><td>4</td></tr></tbody></table> 
<p><strong>注意：如果你需要使用源代码定位相关的符号 <code>%s</code>, <code>%g</code>, <code>%#</code>, <code>%!，那你必须定义下面的宏：</code></strong></p> 
<pre><code class="language-cpp">#define SPDLOG_ACTIVE_LEVEL SPDLOG_LEVEL_TRACE</code></pre> 
<p>（根据需要更改日志级别）并使用以下宏：</p> 
<pre><code class="language-cpp">SPDLOG_LOGGER_TRACE(some_logger, "trace message");
SPDLOG_LOGGER_DEBUG(some_logger, "debug message");
SPDLOG_LOGGER_INFO(some_logger, "info message");
SPDLOG_LOGGER_WARN(some_logger, "warn message");
SPDLOG_LOGGER_ERROR(some_logger, "error message");
SPDLOG_LOGGER_CRITICAL(some_logger, "critical message");</code></pre> 
<p>打开SPDLOG_LOGGER_INFO、SPDLOG_LOGGER_CALL的宏定义：</p> 
<pre><code class="language-cpp">#    define SPDLOG_LOGGER_INFO(logger, ...) SPDLOG_LOGGER_CALL(logger, spdlog::level::info, __VA_ARGS__)
#    define SPDLOG_INFO(...) SPDLOG_LOGGER_INFO(spdlog::default_logger_raw(), __VA_ARGS__)

#define SPDLOG_LOGGER_CALL(logger, level, ...) (logger)-&gt;log(spdlog::source_loc{__FILE__, __LINE__, SPDLOG_FUNCTION}, level, __VA_ARGS__)</code></pre> 
<p>明白了把，SPDLOG_LOGGER_CALL宏把spdlog::source_loc{__FILE__, __LINE__, SPDLOG_FUNCTION}  传进去了，所以能打印源代码的位置和函数名了。</p> 
<h2 id="4.%E5%AF%B9%E9%BD%90%E6%96%B9%E5%BC%8F" style="background-color:transparent;">4.对齐方式</h2> 
<p>每个符号标志可以通过预先设置宽度数字（最多64）来对齐。<br> 使用 "-"（左对齐）或 "="（居中对齐）控制对齐边：</p> 
<table align="center" border="1" cellpadding="1" cellspacing="1" style="width:640px;"><thead><tr><th>对齐</th><th>含义</th><th>例子</th><th>结果</th></tr></thead><tbody><tr><td>%&lt;width&gt;&lt;flag&gt;</td><td>右对齐</td><td>%8l</td><td>"    info"</td></tr><tr><td>%-&lt;width&gt;&lt;flag&gt;</td><td>左对齐</td><td>%-8l</td><td>"info    "</td></tr><tr><td>%=&lt;width&gt;&lt;flag&gt;</td><td>中间对齐</td><td>%=8l</td><td>"  info  "</td></tr></tbody></table> 
<p>可选添加！如果结果的大小超过指定的宽度，则截断该结果：</p> 
<table align="center" border="1" cellpadding="1" cellspacing="1" style="width:640px;"><thead><tr><th>对齐</th><th style="width:185px;">含义</th><th style="width:127px;">例子</th><th>结果</th></tr></thead><tbody><tr><td>%&lt;width&gt;!&lt;flag&gt;</td><td style="width:185px;">右对齐或截断</td><td style="width:127px;">%3!l</td><td>"inf"</td></tr><tr><td>%-&lt;width&gt;!&lt;flag&gt;</td><td style="width:185px;">左对齐或截断</td><td style="width:127px;">%-2!l</td><td>"in"</td></tr><tr><td>%=&lt;width&gt;!&lt;flag&gt;</td><td style="width:185px;">中间对齐或截断</td><td style="width:127px;">%=1!l</td><td>"i"</td></tr></tbody></table> 
<h2 id="5.%E6%89%A9%E5%B1%95spdlog%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%BC%E5%BC%8F">5.扩展spdlog自定义格式</h2> 
<p style="margin-left:.0001pt;text-align:justify;">        在spdlog中，扩展自定义标志允许您根据自己的需求定义新的日志格式标志。这通过继承custom_flag_formatter类并实现其clone()和format(...)抽象方法来完成。以下是如何在spdlog中扩展自定义标志的详细步骤：</p> 
<p style="margin-left:.0001pt;text-align:justify;">        步骤 1: 继承 custom_flag_formatter 类</p> 
<p style="margin-left:.0001pt;text-align:justify;">        首先，您需要创建一个继承自spdlog::custom_flag_formatter的类。在这个类中，您将定义您的新标志的逻辑。</p> 
<p style="margin-left:.0001pt;text-align:justify;">        步骤 2: 实现 clone() 方法</p> 
<p style="margin-left:.0001pt;text-align:justify;">        clone()方法需要返回一个当前对象的深拷贝。这是因为在spdlog中，每个接收器（sink）都会获得格式化器的一个新副本，以确保线程安全和避免潜在的竞态条件。</p> 
<p style="margin-left:.0001pt;text-align:justify;">        步骤 3: 实现 format(...) 方法</p> 
<p style="margin-left:.0001pt;text-align:justify;">        format(...)方法定义了当遇到您的自定义标记时，应该如何格式化日志消息。这个方法接收日志消息、时间戳和一个缓冲区，您需要将格式化后的文本追加到这个缓冲区中。</p> 
<p>        以下是一个示例，展示了如何添加一个名为%*的新自定义标志，该标志将向日志消息中添加自定义文本。</p> 
<pre><code class="language-cpp">#include "spdlog/pattern_formatter.h"
class my_formatter_flag : public spdlog::custom_flag_formatter
{
public:
    void format(const spdlog::details::log_msg &amp;, const std::tm &amp;, spdlog::memory_buf_t &amp;dest) override
    {
        std::string some_txt = "custom-flag";
        dest.append(some_txt.data(), some_txt.data() + some_txt.size());
    }

    std::unique_ptr&lt;custom_flag_formatter&gt; clone() const override
    {
        return spdlog::details::make_unique&lt;my_formatter_flag&gt;();
    }
};

void custom_flags_example()
{    
    auto formatter = std::make_unique&lt;spdlog::pattern_formatter&gt;();
    formatter-&gt;add_flag&lt;my_formatter_flag&gt;('*').set_pattern("[%n] [%*] [%^%l%$] %v");
    spdlog::set_formatter(std::move(formatter));
}</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">        请注意，上述示例中的(...)方法只是简单地添加了一段静态文本到日志消息中。根据您的具体需求，您可以在这个方法中添加更复杂的逻辑来格式化日志消息。</p> 
<h2 id="6.%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F%E5%8C%96" style="margin-left:.0001pt;text-align:justify;">6.字符串格式化</h2> 
<p>spdlog中字符串格式化使用fmt（<a class="link-info" href="https://github.com/fmtlib/fmt" title="https://github.com/fmtlib/fmt">https://github.com/fmtlib/fmt</a>）库。</p> 
<p>格式化方式：{ [arg_id] [: (format_spec | chrono_format_spec)] }</p> 
<p>arg_id：参数标识；</p> 
<p>        忽略（为空时），依次对应每一个参数；<br>         索引（数字，从0开始），引用第几个索引；<br>         名称，命名参数；<br> format_spec：参数格式化方式（类型、对齐、填充等）</p> 
<p>        format_spec ::=  [[fill]align][sign]["#"]["0"][width]["." precision]["L"][type]<br>         fill                  ::=  &lt;a character other than '{' or '}'&gt;<br>         align              ::=  "&lt;" | "&gt;" | "^" // 左、右、居中对齐<br>         sign               ::=  "+" | "-" | " "<br>         width             ::=  integer | {[arg_id]} // 宽度：数字或指定的参数<br>         precision       ::=  integer | {[arg_id]} // 精度：数字或指定的参数<br>         type               ::=  "a" | "A" | "b" | "B" | "c" | "d" | "e" | "E" | "f" | "F" <br>                                     | "g" | "G" | "o" | "p" | "s" | "x" | "X"</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>fmt源码地址</strong>：<a href="https://github.com/fmtlib/fmt" title="GitHub - fmtlib/fmt: A modern formatting library">GitHub - fmtlib/fmt: A modern formatting library</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4b5fe88ea9230ac8940c7ba8593b9eef/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">链表的回文结构（链表的中间节点&#43;反转链表）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d341fb26febe3d8cf3ad038ef092169c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">@google/model-viewer 导入 改纹理 （http-serve）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>