<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>深入分析 Android ContentProvider (三) - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9baa11f92e190cf1f0b6cf5a7959aac6/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="深入分析 Android ContentProvider (三)">
  <meta property="og:description" content="文章目录 深入分析 Android ContentProvider (三)ContentProvider 的高级使用和性能优化1. 高级使用场景1.1. 数据分页加载示例：分页加载 1.2. 使用 Loader 实现异步加载示例：使用 CursorLoader 加载数据 1.3. ContentProvider 与权限管理示例：配置权限 2. 性能优化策略2.1. 缓存机制示例：使用 LruCache 进行缓存 2.2. 批量操作示例：批量插入数据 2.3. 使用异步操作示例：使用 AsyncTask 进行异步查询 2.4. 索引优化示例：创建索引 3. 总结 深入分析 Android ContentProvider (三) ContentProvider 的高级使用和性能优化 在实际应用中，合理使用 ContentProvider 并进行性能优化是确保应用高效运行的关键。以下内容将介绍一些高级使用场景和性能优化策略。
1. 高级使用场景 1.1. 数据分页加载 对于大量数据的查询，可以通过分页加载提高效率。分页加载常用于列表视图中，以避免一次性加载所有数据导致的性能问题。
示例：分页加载 在 query 方法中实现分页加载：
@Override public Cursor query(@NonNull Uri uri, @Nullable String[] projection, @Nullable String selection, @Nullable String[] selectionArgs, @Nullable String sortOrder) { int limit = 20; // 每页加载的数据量 int offset = 0; // 偏移量 String limitClause = &#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-23T09:47:43+08:00">
    <meta property="article:modified_time" content="2024-07-23T09:47:43+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">深入分析 Android ContentProvider (三)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_Android_ContentProvider__1" rel="nofollow">深入分析 Android ContentProvider (三)</a></li><li><a href="#ContentProvider__2" rel="nofollow">ContentProvider 的高级使用和性能优化</a></li><li><ul><li><a href="#1__6" rel="nofollow">1. 高级使用场景</a></li><li><ul><li><a href="#11__8" rel="nofollow">1.1. 数据分页加载</a></li><li><ul><li><a href="#_12" rel="nofollow">示例：分页加载</a></li></ul> 
     </li><li><a href="#12__Loader__56" rel="nofollow">1.2. 使用 Loader 实现异步加载</a></li><li><ul><li><a href="#_CursorLoader__60" rel="nofollow">示例：使用 CursorLoader 加载数据</a></li></ul> 
     </li><li><a href="#13_ContentProvider__95" rel="nofollow">1.3. ContentProvider 与权限管理</a></li><li><ul><li><a href="#_99" rel="nofollow">示例：配置权限</a></li></ul> 
    </li></ul> 
    </li><li><a href="#2__120" rel="nofollow">2. 性能优化策略</a></li><li><ul><li><a href="#21__122" rel="nofollow">2.1. 缓存机制</a></li><li><ul><li><a href="#_LruCache__126" rel="nofollow">示例：使用 LruCache 进行缓存</a></li></ul> 
     </li><li><a href="#22__148" rel="nofollow">2.2. 批量操作</a></li><li><ul><li><a href="#_152" rel="nofollow">示例：批量插入数据</a></li></ul> 
     </li><li><a href="#23__170" rel="nofollow">2.3. 使用异步操作</a></li><li><ul><li><a href="#_AsyncTask__174" rel="nofollow">示例：使用 AsyncTask 进行异步查询</a></li></ul> 
     </li><li><a href="#24__191" rel="nofollow">2.4. 索引优化</a></li><li><ul><li><a href="#_195" rel="nofollow">示例：创建索引</a></li></ul> 
    </li></ul> 
    </li><li><a href="#3__212" rel="nofollow">3. 总结</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_Android_ContentProvider__1"></a>深入分析 Android ContentProvider (三)</h3> 
<h3><a id="ContentProvider__2"></a>ContentProvider 的高级使用和性能优化</h3> 
<p>在实际应用中，合理使用 ContentProvider 并进行性能优化是确保应用高效运行的关键。以下内容将介绍一些高级使用场景和性能优化策略。</p> 
<h4><a id="1__6"></a>1. 高级使用场景</h4> 
<h5><a id="11__8"></a>1.1. 数据分页加载</h5> 
<p>对于大量数据的查询，可以通过分页加载提高效率。分页加载常用于列表视图中，以避免一次性加载所有数据导致的性能问题。</p> 
<h6><a id="_12"></a>示例：分页加载</h6> 
<p>在 <code>query</code> 方法中实现分页加载：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Cursor</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Uri</span> uri<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> projection<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> selection<span class="token punctuation">,</span>
                    <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> selectionArgs<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> sortOrder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> limit <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// 每页加载的数据量</span>
    <span class="token keyword">int</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 偏移量</span>
    <span class="token class-name">String</span> limitClause <span class="token operator">=</span> <span class="token string">" LIMIT "</span> <span class="token operator">+</span> limit <span class="token operator">+</span> <span class="token string">" OFFSET "</span> <span class="token operator">+</span> offset<span class="token punctuation">;</span>
    
    <span class="token class-name">Cursor</span> cursor<span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>uriMatcher<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token constant">EXAMPLES</span><span class="token operator">:</span>
            cursor <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">DatabaseHelper</span><span class="token punctuation">.</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> projection<span class="token punctuation">,</span> selection<span class="token punctuation">,</span> selectionArgs<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> sortOrder <span class="token operator">+</span> limitClause<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token constant">EXAMPLE_ID</span><span class="token operator">:</span>
            cursor <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">DatabaseHelper</span><span class="token punctuation">.</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> projection<span class="token punctuation">,</span> <span class="token class-name">DatabaseHelper</span><span class="token punctuation">.</span><span class="token constant">COLUMN_ID</span> <span class="token operator">+</span> <span class="token string">"=?"</span><span class="token punctuation">,</span>
                    <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">ContentUris</span><span class="token punctuation">.</span><span class="token function">parseId</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> sortOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Unknown URI: "</span> <span class="token operator">+</span> uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    cursor<span class="token punctuation">.</span><span class="token function">setNotificationUri</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> cursor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在调用端实现分页查询：</p> 
<pre><code class="prism language-java"><span class="token class-name">Uri</span> uri <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"content://com.example.provider/example"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> sortOrder <span class="token operator">=</span> <span class="token string">"name ASC LIMIT 20 OFFSET 0"</span><span class="token punctuation">;</span> <span class="token comment">// 加载第一页数据</span>
<span class="token class-name">Cursor</span> cursor <span class="token operator">=</span> <span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> sortOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>cursor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">moveToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 处理数据</span>
    <span class="token punctuation">}</span>
    cursor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="12__Loader__56"></a>1.2. 使用 Loader 实现异步加载</h5> 
<p>使用 <code>Loader</code> 可以在异步线程中加载数据，避免在主线程中进行耗时操作，从而保持 UI 的流畅性。<code>CursorLoader</code> 是一个常用的 Loader，用于 ContentProvider 的异步查询。</p> 
<h6><a id="_CursorLoader__60"></a>示例：使用 CursorLoader 加载数据</h6> 
<p>实现一个 <code>LoaderManager.LoaderCallbacks&lt;Cursor&gt;</code> 接口：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token keyword">implements</span> <span class="token class-name">LoaderManager<span class="token punctuation">.</span>LoaderCallbacks</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cursor</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">LOADER_ID</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_example<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">getSupportLoaderManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">initLoader</span><span class="token punctuation">(</span><span class="token constant">LOADER_ID</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@NonNull</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Loader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cursor</span><span class="token punctuation">&gt;</span></span> <span class="token function">onCreateLoader</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Uri</span> uri <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"content://com.example.provider/example"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CursorLoader</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> uri<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"name ASC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLoadFinished</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Loader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cursor</span><span class="token punctuation">&gt;</span></span> loader<span class="token punctuation">,</span> <span class="token class-name">Cursor</span> data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理加载完成的数据</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLoaderReset</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Loader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Cursor</span><span class="token punctuation">&gt;</span></span> loader<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 清理资源</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="13_ContentProvider__95"></a>1.3. ContentProvider 与权限管理</h5> 
<p>在一些安全性要求较高的场景下，合理配置 ContentProvider 的权限是非常重要的。通过权限声明和 URI 权限授予，可以确保数据访问的安全性。</p> 
<h6><a id="_99"></a>示例：配置权限</h6> 
<p>在 <code>AndroidManifest.xml</code> 中声明权限，并为 ContentProvider 设置权限：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.provider.READ<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">android:</span>protectionLevel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>signature<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.provider.WRITE<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">android:</span>protectionLevel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>signature<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>provider</span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.ExampleProvider<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>authorities</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.provider<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>readPermission</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.provider.READ<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>writePermission</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.provider.WRITE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>在代码中授予 URI 权限：</p> 
<pre><code class="prism language-java"><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">takePersistableUriPermission</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_GRANT_READ_URI_PERMISSION</span> <span class="token operator">|</span> <span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_GRANT_WRITE_URI_PERMISSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="2__120"></a>2. 性能优化策略</h4> 
<h5><a id="21__122"></a>2.1. 缓存机制</h5> 
<p>通过缓存机制，可以减少对数据库的频繁访问，提高数据查询的效率。可以使用内存缓存或磁盘缓存来存储常用数据。</p> 
<h6><a id="_LruCache__126"></a>示例：使用 LruCache 进行缓存</h6> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token class-name">LruCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Bitmap</span><span class="token punctuation">&gt;</span></span> mMemoryCache<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> maxMemory <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> cacheSize <span class="token operator">=</span> maxMemory <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">;</span>
    mMemoryCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LruCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>cacheSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addBitmapToMemoryCache</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Bitmap</span> bitmap<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getBitmapFromMemCache</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mMemoryCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> bitmap<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">Bitmap</span> <span class="token function">getBitmapFromMemCache</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> mMemoryCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="22__148"></a>2.2. 批量操作</h5> 
<p>在对数据进行插入、更新或删除时，使用批量操作可以减少数据库的锁定次数，提高操作效率。</p> 
<h6><a id="_152"></a>示例：批量插入数据</h6> 
<pre><code class="prism language-java"><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ContentProviderOperation</span><span class="token punctuation">&gt;</span></span> operations <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ContentValues</span> values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Example "</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    operations<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">ContentProviderOperation</span><span class="token punctuation">.</span><span class="token function">newInsert</span><span class="token punctuation">(</span><span class="token constant">CONTENT_URI</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">withValues</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">applyBatch</span><span class="token punctuation">(</span><span class="token string">"com.example.provider"</span><span class="token punctuation">,</span> operations<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RemoteException</span> <span class="token operator">|</span> <span class="token class-name">OperationApplicationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="23__170"></a>2.3. 使用异步操作</h5> 
<p>避免在主线程中进行数据库操作，使用 <code>AsyncTask</code>、<code>Loader</code> 或 <code>RxJava</code> 等异步框架进行数据操作，确保 UI 的流畅性。</p> 
<h6><a id="_AsyncTask__174"></a>示例：使用 AsyncTask 进行异步查询</h6> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">QueryTask</span> <span class="token keyword">extends</span> <span class="token class-name">AsyncTask</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">,</span> <span class="token class-name">Void</span><span class="token punctuation">,</span> <span class="token class-name">Cursor</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Cursor</span> <span class="token function">doInBackground</span><span class="token punctuation">(</span><span class="token class-name">Void</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> voids<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Uri</span> uri <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"content://com.example.provider/example"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"name ASC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onPostExecute</span><span class="token punctuation">(</span><span class="token class-name">Cursor</span> cursor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理查询结果</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="24__191"></a>2.4. 索引优化</h5> 
<p>为频繁查询的字段创建索引，可以显著提高查询效率。可以在创建表时添加索引，或者在表创建后使用 SQL 语句添加索引。</p> 
<h6><a id="_195"></a>示例：创建索引</h6> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TABLE_CREATE</span> <span class="token operator">=</span>
        <span class="token string">"CREATE TABLE "</span> <span class="token operator">+</span> <span class="token constant">TABLE_NAME</span> <span class="token operator">+</span> <span class="token string">" ("</span> <span class="token operator">+</span>
        <span class="token constant">COLUMN_ID</span> <span class="token operator">+</span> <span class="token string">" INTEGER PRIMARY KEY AUTOINCREMENT, "</span> <span class="token operator">+</span>
        <span class="token constant">COLUMN_NAME</span> <span class="token operator">+</span> <span class="token string">" TEXT);"</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">INDEX_CREATE</span> <span class="token operator">=</span>
        <span class="token string">"CREATE INDEX index_name ON "</span> <span class="token operator">+</span> <span class="token constant">TABLE_NAME</span> <span class="token operator">+</span> <span class="token string">" ("</span> <span class="token operator">+</span> <span class="token constant">COLUMN_NAME</span> <span class="token operator">+</span> <span class="token string">");"</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">SQLiteDatabase</span> db<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span><span class="token constant">TABLE_CREATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span><span class="token constant">INDEX_CREATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="3__212"></a>3. 总结</h4> 
<p>通过上述高级使用场景和性能优化策略，可以更好地利用 ContentProvider 提供的数据共享和跨进程通信功能，构建高效、可靠的 Android 应用。在实际开发中，根据具体需求合理设计和优化 ContentProvider，可以大幅提升应用的性能和用户体验。</p> 
<table><tbody><tr><td bgcolor="#FF0066"> <font size="5" color="#ffffff" face="宋体"> <b> 欢迎点赞|关注|收藏|评论，您的肯定是我创作的动力 </b> </font> </td></tr></tbody></table> 
<font size="20"> </font> 
<p><img src="https://images2.imgbox.com/79/1a/Ogg9Vsm7_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6aa8f6ee0c78e344a80a6561a88ba02a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于海康威视&#43;WPF&#43;MVVM实时取图代码整理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d35278afc7f16bf47b8a768fe1172e5c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">DeepMind CEO：AI可以发现室温超导；Llama 3.1算对9.9＞9.11 | AI头条</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>