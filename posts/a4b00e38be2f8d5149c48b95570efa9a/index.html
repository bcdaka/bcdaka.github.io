<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>springboot整合xxl-job - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/a4b00e38be2f8d5149c48b95570efa9a/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="springboot整合xxl-job">
  <meta property="og:description" content="文章目录 前言一、xxl-job是什么？二、使用步骤1.下载源码,并部署好2.模仿xxl-job-executor-sample-springboot 自己建立一个服务1 引入xxl-job核心依赖2 创建服务,配置yml3 创建一个配置类,用于读取上述配置,并配置好handel信息4 创建一个执行器的任务类,用于执行真正的业务逻辑5 启动该服务6 在调度中心中,添加该执行器7 根据执行器,添加任务,执行真正的业务逻辑8 我们都配置了什么 总结 前言 单机模式中的定时任务很简单,一般使用@EnableScheduling 就可以了,但是在集群中,这个简单的定时任务就不行了,会有问题;
例如我要在半夜12点执行一个任务,发送一条短信给一个用户,但是当为集群的时候,这种简单的任务,在多个节点上,都会执行,那么就会造成任务的重复执行,每个用户都接受到了多条相同的短信,这种错误还好,但是当涉及到计算等问题的时候,这种错误就是致命的,而且当没有集群经验的时候,这种问题在单机情况下还是正常,集群就会出现大问题!!!
一、xxl-job是什么？ 大神徐雪里开源的定时任务框架;
官方文档: 文档
源码地址: 服务端源码,客户端示例
大体使用步骤: 引用我的上一篇文章 传送门
二、使用步骤 上一篇文章主要是讲了如何测试xxl-job,那么实际项目中,如何使用呢?
1.下载源码,并部署好 就是这个地址: 服务端源码,客户端示例
由于xxl-job的思想是 调度中心负责调度任务,然后有执行器负责接受调度的信息,然后根据调度,执行任务中的具体逻辑
将 xl-job-admin 启动起来,操作xl-job-admin这个文件夹下的配置文件即可:
创建数据库执行sql文件修改yml配置启动这个服务访问,http://127.0.0.1:8080/xxl-job-admin/
并登录 admin/123456
看到此说明已经成功; 2.模仿xxl-job-executor-sample-springboot 自己建立一个服务 我们想要自己搞一个任务执行器,也就是要弄一个这样的服务
1 引入xxl-job核心依赖 &lt;dependency&gt; &lt;groupId&gt;com.xuxueli&lt;/groupId&gt; &lt;artifactId&gt;xxl-job-core&lt;/artifactId&gt; &lt;version&gt;2.3.1&lt;/version&gt; &lt;/dependency&gt; 2 创建服务,配置yml xxl: job: accessToken: default_token admin: # 调度中心服务地址 addresses: http://127.0.0.1:8080/xxl-job-admin executor: address: &#39;&#39; # 必须唯一 执行器名称 appname: jobhandel ip: &#39;&#39; logpath: /data/applogs/xxl-job/jobhandler logretentiondays: 30 # 执行器回调端口,用于接受调度消息 port: 9998 3 创建一个配置类,用于读取上述配置,并配置好handel信息 直接粘贴示例源码">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-27T17:14:55+08:00">
    <meta property="article:modified_time" content="2023-12-27T17:14:55+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">springboot整合xxl-job</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_5" rel="nofollow">前言</a></li><li><a href="#xxljob_10" rel="nofollow">一、xxl-job是什么？</a></li><li><a href="#_15" rel="nofollow">二、使用步骤</a></li><li><ul><li><a href="#1_17" rel="nofollow">1.下载源码,并部署好</a></li><li><a href="#2xxljobexecutorsamplespringboot__30" rel="nofollow">2.模仿xxl-job-executor-sample-springboot 自己建立一个服务</a></li><li><ul><li><a href="#1_xxljob_33" rel="nofollow">1 引入xxl-job核心依赖</a></li><li><a href="#2_yml_41" rel="nofollow">2 创建服务,配置yml</a></li><li><a href="#3_handel_60" rel="nofollow">3 创建一个配置类,用于读取上述配置,并配置好handel信息</a></li><li><a href="#4__134" rel="nofollow">4 创建一个执行器的任务类,用于执行真正的业务逻辑</a></li><li><a href="#5__163" rel="nofollow">5 启动该服务</a></li><li><a href="#6__166" rel="nofollow">6 在调度中心中,添加该执行器</a></li><li><a href="#7__176" rel="nofollow">7 根据执行器,添加任务,执行真正的业务逻辑</a></li><li><a href="#8__184" rel="nofollow">8 我们都配置了什么</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_194" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_5"></a>前言</h2> 
<p>单机模式中的定时任务很简单,一般使用@EnableScheduling 就可以了,但是在集群中,这个简单的定时任务就不行了,会有问题;<br> 例如我要在半夜12点执行一个任务,发送一条短信给一个用户,但是当为集群的时候,这种简单的任务,在多个节点上,都会执行,那么就会造成任务的重复执行,每个用户都接受到了多条相同的短信,这种错误还好,但是当涉及到计算等问题的时候,这种错误就是致命的,而且当没有集群经验的时候,这种问题在单机情况下还是正常,集群就会出现大问题!!!</p> 
<hr> 
<h2><a id="xxljob_10"></a>一、xxl-job是什么？</h2> 
<p>大神徐雪里开源的定时任务框架;<br> 官方文档: <a href="https://www.xuxueli.com/xxl-job/" rel="nofollow">文档</a><br> 源码地址: <a href="https://gitee.com/xuxueli0323/xxl-job" rel="nofollow">服务端源码,客户端示例</a><br> 大体使用步骤: 引用我的上一篇文章 <a href="https://blog.csdn.net/qq_32419139/article/details/124270042">传送门</a></p> 
<h2><a id="_15"></a>二、使用步骤</h2> 
<p>上一篇文章主要是讲了如何测试xxl-job,那么实际项目中,如何使用呢?</p> 
<h3><a id="1_17"></a>1.下载源码,并部署好</h3> 
<p>就是这个地址: <a href="https://gitee.com/xuxueli0323/xxl-job" rel="nofollow">服务端源码,客户端示例</a><br> <code>由于xxl-job的思想是 调度中心负责调度任务,然后有执行器负责接受调度的信息,然后根据调度,执行任务中的具体逻辑</code></p> 
<p>将 xl-job-admin 启动起来,操作xl-job-admin这个文件夹下的配置文件即可:</p> 
<ol><li>创建数据库</li><li>执行sql文件</li><li>修改yml配置</li><li>启动这个服务</li><li>访问,<code>http://127.0.0.1:8080/xxl-job-admin/</code><br> 并登录 admin/123456<br> <img src="https://images2.imgbox.com/a3/58/AtXBWhaY_o.png" alt="登录界面"><br> 看到此说明已经成功;</li></ol> 
<h3><a id="2xxljobexecutorsamplespringboot__30"></a>2.模仿xxl-job-executor-sample-springboot 自己建立一个服务</h3> 
<p>我们想要自己搞一个任务执行器,也就是要弄一个这样的服务</p> 
<h4><a id="1_xxljob_33"></a>1 引入xxl-job核心依赖</h4> 
<pre><code>   &lt;dependency&gt;
            &lt;groupId&gt;com.xuxueli&lt;/groupId&gt;
            &lt;artifactId&gt;xxl-job-core&lt;/artifactId&gt;
            &lt;version&gt;2.3.1&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre> 
<h4><a id="2_yml_41"></a>2 创建服务,配置yml</h4> 
<pre><code>xxl:
  job:
    accessToken: default_token
    admin:
      # 调度中心服务地址
      addresses: http://127.0.0.1:8080/xxl-job-admin
    executor:
      address: ''
      # 必须唯一 执行器名称
      appname: jobhandel
      ip: ''
      logpath: /data/applogs/xxl-job/jobhandler
      logretentiondays: 30
      # 执行器回调端口,用于接受调度消息
      port: 9998
</code></pre> 
<p><img src="https://images2.imgbox.com/56/85/0kjRqaX0_o.png" alt="yml配置"></p> 
<h4><a id="3_handel_60"></a>3 创建一个配置类,用于读取上述配置,并配置好handel信息</h4> 
<p>直接粘贴示例源码</p> 
<pre><code>/**
 * xxl-job config
 *
 * @author xuxueli 2017-04-28
 */
@Configuration
public class XxlJobConfig {
    private Logger logger = LoggerFactory.getLogger(XxlJobConfig.class);

    @Value("${xxl.job.admin.addresses}")
    private String adminAddresses;

    @Value("${xxl.job.accessToken}")
    private String accessToken;

    @Value("${xxl.job.executor.appname}")
    private String appname;

    @Value("${xxl.job.executor.address}")
    private String address;

    @Value("${xxl.job.executor.ip}")
    private String ip;

    @Value("${xxl.job.executor.port}")
    private int port;

    @Value("${xxl.job.executor.logpath}")
    private String logPath;

    @Value("${xxl.job.executor.logretentiondays}")
    private int logRetentionDays;


    @Bean
    public XxlJobSpringExecutor xxlJobExecutor() {
        logger.info("&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job config init.");
        XxlJobSpringExecutor xxlJobSpringExecutor = new XxlJobSpringExecutor();
        xxlJobSpringExecutor.setAdminAddresses(adminAddresses);
        xxlJobSpringExecutor.setAppname(appname);
        xxlJobSpringExecutor.setAddress(address);
        xxlJobSpringExecutor.setIp(IpUtil.getIp());
        xxlJobSpringExecutor.setPort(port);
        xxlJobSpringExecutor.setAccessToken(accessToken);
        xxlJobSpringExecutor.setLogPath(logPath);
        xxlJobSpringExecutor.setLogRetentionDays(logRetentionDays);

        return xxlJobSpringExecutor;
    }

    /**
     * 针对多网卡、容器内部署等情况，可借助 "spring-cloud-commons" 提供的 "InetUtils" 组件灵活定制注册IP；
     *
     *      1、引入依赖：
     *          &lt;dependency&gt;
     *             &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
     *             &lt;artifactId&gt;spring-cloud-commons&lt;/artifactId&gt;
     *             &lt;version&gt;${version}&lt;/version&gt;
     *         &lt;/dependency&gt;
     *
     *      2、配置文件，或者容器启动变量
     *          spring.cloud.inetutils.preferred-networks: 'xxx.xxx.xxx.'
     *
     *      3、获取IP
     *          String ip_ = inetUtils.findFirstNonLoopbackHostInfo().getIpAddress();
     */


}

</code></pre> 
<h4><a id="4__134"></a>4 创建一个执行器的任务类,用于执行真正的业务逻辑</h4> 
<p>其实完全仿照的就是 com.xxl.job.executor.service.jobhandler.SampleXxlJob类</p> 
<pre><code>@Component
public class AssetsTask {

    /**
     * XxlJob开发示例（Bean模式）
     *
     * 开发步骤：
     *      1、任务开发：在Spring Bean实例中，开发Job方法；
     *      2、注解配置：为Job方法添加注解 "@XxlJob(value="自定义jobhandler名称", init = "JobHandler初始化方法", destroy = "JobHandler销毁方法")"，注解value值对应的是调度中心新建任务的JobHandler属性的值。
     *      3、执行日志：需要通过 "XxlJobHelper.log" 打印执行日志；
     *      4、任务结果：默认任务结果为 "成功" 状态，不需要主动设置；如有诉求，比如设置任务结果为失败，可以通过 "XxlJobHelper.handleFail/handleSuccess" 自主设置任务结果；
     *
     * @author xuxueli 2019-12-11 21:52:51
     */
    private static Logger logger = LoggerFactory.getLogger(AssetsTask.class);

    /**
     * 1、简单任务示例（Bean模式）
     */
    @XxlJob("testJobHandler")
    public void demoJobHandler() throws Exception {
        XxlJobHelper.log("XXL-JOB, Hello World.");
        System.out.println("XXL-JOB, Hello World." + DateUtil.now());
    }
}
</code></pre> 
<h4><a id="5__163"></a>5 启动该服务</h4> 
<p>出现此日志,说明服务启动成功,且与xxl-job调度中心通信成功<br> <img src="https://images2.imgbox.com/5c/78/prErA0p9_o.png" alt="客户端启动成功"></p> 
<h4><a id="6__166"></a>6 在调度中心中,添加该执行器</h4> 
<ol><li>在调度中心中,选择&gt;&gt;&gt;执行器管理,选择&gt;&gt;&gt;新增</li><li>appname 对应好即可<br> <img src="https://images2.imgbox.com/0d/c4/YyCOIs9C_o.png" alt="添加执行器"></li><li>确认后,执行器已被添加<br> <img src="https://images2.imgbox.com/2c/9a/mopTPfsF_o.png" alt="执行器"></li><li>重启执行器服务, online 将在线<br> <img src="https://images2.imgbox.com/95/81/ofwAVCXv_o.png" alt="已经上线"><br> 至此,执行器添加完毕</li></ol> 
<h4><a id="7__176"></a>7 根据执行器,添加任务,执行真正的业务逻辑</h4> 
<ol><li>在调度中心中,选择&gt;&gt;&gt;任务管理, 选择&gt;&gt;&gt;新增<br> <img src="https://images2.imgbox.com/53/c5/Iu49Imxz_o.png" alt="填写信息"></li><li>其中JobHandler 对应的是具体任务类中 @XxlJob() 注解中填写的名称</li><li>运行模式 选择bean ,因为我们这里就是springbean 的方式,注入的要执行的任务</li><li>其他信息正常填写就行</li><li>我这里选择的cron 是一秒一次</li></ol> 
<h4><a id="8__184"></a>8 我们都配置了什么</h4> 
<ol><li>执行器: jobhandel (yml配置的appname)</li><li>具体任务: testJobHandler (具体任务执行类中的@XxlJob 注解中的值)</li><li>开始执行吧~~<br> <img src="https://images2.imgbox.com/85/07/s1FwJt1D_o.png" alt="执行任务"><br> xxl-job执行日志以及控制台打印信息<br> <img src="https://images2.imgbox.com/4c/8c/kWwJTO4F_o.png" alt="日志"></li></ol> 
<hr> 
<h2><a id="_194"></a>总结</h2> 
<p>至此,我们完成了xxl-job服务端的配置启动,xxl-job客户端的配置,以及执行器/任务的添加,然后就完成了定时任务的灵活调度,随时启停,更改定时任务调度,以及解决多实例中任务重复执行的问题;<br> 实际项目中:</p> 
<ol><li>我们应该是单独启动一个xxl-job的服务端,作为一个独立的服务</li><li>然后在项目中集成好xxl-job-core 的核心依赖,然后进行具体任务的编码</li><li>最后通过调度中心配置,执行具体的任务逻辑</li></ol> 
<p>当然xxl-job还有一个GLUE(Java)模式,我感觉在实际项目中,应用场景应该不多,相当于脱离了数据库的执行,感觉用不上,这里不做赘述了;</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5e61276aa34dfbdd18ec3ac1d2fa6f2d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何3分钟在 Windows 11 上启用 Copilot</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4d572eab1cce42d88d89cb59952eb418/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">若依报500异常，只有前端没有后端</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>