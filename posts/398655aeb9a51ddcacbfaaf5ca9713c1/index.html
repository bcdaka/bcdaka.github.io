<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ã€è®¾è®¡æ¨¡å¼ã€‘JAVA Design Patternsâ€”â€”Observerï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰ - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/398655aeb9a51ddcacbfaaf5ca9713c1/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="ã€è®¾è®¡æ¨¡å¼ã€‘JAVA Design Patternsâ€”â€”Observerï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰">
  <meta property="og:description" content="ğŸ”ç›®çš„ å®šä¹‰ä¸€ç§ä¸€å¯¹å¤šçš„å¯¹è±¡ä¾èµ–å…³ç³»è¿™æ ·å½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜çŠ¶æ€æ—¶ï¼Œæ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡éƒ½å°†è‡ªåŠ¨é€šçŸ¥æˆ–æ›´æ–°ã€‚
ğŸ”è§£é‡Š çœŸå®ä¸–ç•Œä¾‹å­ åœ¨é¥è¿œçš„åœŸåœ°ä¸Šç”Ÿæ´»ç€éœæ¯”ç‰¹äººå’Œå…½äººçš„ç§æ—ã€‚ä»–ä»¬éƒ½æ˜¯æˆ·å¤–ç”Ÿæ´»çš„äººæ‰€ä»¥ä»–ä»¬å¯†åˆ‡å…³æ³¨å¤©æ°”çš„å˜åŒ–ã€‚å¯ä»¥è¯´ä»–ä»¬ä¸æ–­åœ°å…³æ³¨ç€å¤©æ°”ã€‚
é€šä¿—æè¿° æ³¨å†Œæˆä¸ºä¸€ä¸ªè§‚å¯Ÿè€…ä»¥æ¥æ”¶å¯¹è±¡çŠ¶æ€çš„æ”¹å˜ã€‚
ç»´åŸºç™¾ç§‘ è§‚å¯Ÿè€…æ¨¡å¼æ˜¯è¿™æ ·çš„ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼šå®ƒæœ‰ä¸€ä¸ªè¢«ç§°ä¸ºä¸»é¢˜çš„å¯¹è±¡ï¼Œç»´æŠ¤ç€ä¸€ä¸ªæ‰€æœ‰ä¾èµ–äºå®ƒçš„ä¾èµ–è€…æ¸…å•ï¼Œä¹Ÿå°±æ˜¯è§‚å¯Ÿè€…æ¸…å•ï¼Œå½“ä¸»é¢˜çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¸»é¢˜é€šå¸¸ä¼šè°ƒç”¨è§‚å¯Ÿè€…çš„æ–¹æ³•æ¥è‡ªåŠ¨é€šçŸ¥è§‚å¯Ÿè€…ä»¬ã€‚
ç¼–ç¨‹ç¤ºä¾‹ é¦–å…ˆåˆ›å»ºå¤©æ°”è§‚å¯Ÿè€…çš„æ¥å£ä»¥åŠæˆ‘ä»¬çš„ç§æ—ï¼Œå…½äººå’Œéœæ¯”ç‰¹äººã€‚
public interface WeatherObserver { void update(WeatherType currentWeather); } @Slf4j public class Orcs implements WeatherObserver { @Override public void update(WeatherType currentWeather) { LOGGER.info(&#34;The orcs are facing &#34; &#43; currentWeather.getDescription() &#43; &#34; weather now&#34;); } } @Slf4j public class Hobbits implements WeatherObserver { @Override public void update(WeatherType currentWeather) { switch (currentWeather) { LOGGER.info(&#34;The hobbits are facing &#34; &#43; currentWeather.getDescription() &#43; &#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-04T10:12:06+08:00">
    <meta property="article:modified_time" content="2024-06-04T10:12:06+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ã€è®¾è®¡æ¨¡å¼ã€‘JAVA Design Patternsâ€”â€”Observerï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>ğŸ”ç›®çš„</h3> 
<hr> 
<blockquote> 
 <p>å®šä¹‰ä¸€ç§ä¸€å¯¹å¤šçš„å¯¹è±¡ä¾èµ–å…³ç³»è¿™æ ·å½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜çŠ¶æ€æ—¶ï¼Œæ‰€æœ‰ä¾èµ–å®ƒçš„å¯¹è±¡éƒ½å°†è‡ªåŠ¨é€šçŸ¥æˆ–æ›´æ–°ã€‚</p> 
</blockquote> 
<h3 style="background-color:transparent;">ğŸ”è§£é‡Š</h3> 
<hr> 
<h4>çœŸå®ä¸–ç•Œä¾‹å­</h4> 
<blockquote> 
 <p>åœ¨é¥è¿œçš„åœŸåœ°ä¸Šç”Ÿæ´»ç€éœæ¯”ç‰¹äººå’Œå…½äººçš„ç§æ—ã€‚ä»–ä»¬éƒ½æ˜¯æˆ·å¤–ç”Ÿæ´»çš„äººæ‰€ä»¥ä»–ä»¬å¯†åˆ‡å…³æ³¨å¤©æ°”çš„å˜åŒ–ã€‚å¯ä»¥è¯´ä»–ä»¬ä¸æ–­åœ°å…³æ³¨ç€å¤©æ°”ã€‚</p> 
</blockquote> 
<h4>é€šä¿—æè¿°</h4> 
<blockquote> 
 <p>æ³¨å†Œæˆä¸ºä¸€ä¸ªè§‚å¯Ÿè€…ä»¥æ¥æ”¶å¯¹è±¡çŠ¶æ€çš„æ”¹å˜ã€‚</p> 
</blockquote> 
<h4>ç»´åŸºç™¾ç§‘</h4> 
<blockquote> 
 <p>è§‚å¯Ÿè€…æ¨¡å¼æ˜¯è¿™æ ·çš„ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼šå®ƒæœ‰ä¸€ä¸ªè¢«ç§°ä¸ºä¸»é¢˜çš„å¯¹è±¡ï¼Œç»´æŠ¤ç€ä¸€ä¸ªæ‰€æœ‰ä¾èµ–äºå®ƒçš„ä¾èµ–è€…æ¸…å•ï¼Œä¹Ÿå°±æ˜¯è§‚å¯Ÿè€…æ¸…å•ï¼Œå½“ä¸»é¢˜çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¸»é¢˜é€šå¸¸ä¼šè°ƒç”¨è§‚å¯Ÿè€…çš„æ–¹æ³•æ¥è‡ªåŠ¨é€šçŸ¥è§‚å¯Ÿè€…ä»¬ã€‚</p> 
</blockquote> 
<h4>ç¼–ç¨‹ç¤ºä¾‹</h4> 
<p>é¦–å…ˆåˆ›å»ºå¤©æ°”è§‚å¯Ÿè€…çš„æ¥å£ä»¥åŠæˆ‘ä»¬çš„ç§æ—ï¼Œå…½äººå’Œéœæ¯”ç‰¹äººã€‚</p> 
<pre><code class="language-java">public interface WeatherObserver {

  void update(WeatherType currentWeather);
}

@Slf4j
public class Orcs implements WeatherObserver {

  @Override
  public void update(WeatherType currentWeather) {
    LOGGER.info("The orcs are facing " + currentWeather.getDescription() + " weather now");
  }
}

@Slf4j
public class Hobbits implements WeatherObserver {

  @Override
  public void update(WeatherType currentWeather) {
    switch (currentWeather) {
      LOGGER.info("The hobbits are facing " + currentWeather.getDescription() + " weather now");
  }
}</code></pre> 
<p>åˆ›å»ºä¸€ä¸ªåŠ¨æ€å˜åŒ–çš„å¤©æ°”ï¼š</p> 
<pre><code class="language-java">@Slf4j
public class Weather {

  private WeatherType currentWeather;
  private final List&lt;WeatherObserver&gt; observers;

  public Weather() {
    observers = new ArrayList&lt;&gt;();
    currentWeather = WeatherType.SUNNY;
  }

  public void addObserver(WeatherObserver obs) {
    observers.add(obs);
  }

  public void removeObserver(WeatherObserver obs) {
    observers.remove(obs);
  }

  /**
   * Makes time pass for weather.
   */
  public void timePasses() {
    var enumValues = WeatherType.values();
    currentWeather = enumValues[(currentWeather.ordinal() + 1) % enumValues.length];
    LOGGER.info("The weather changed to {}.", currentWeather);
    notifyObservers();
  }

  private void notifyObservers() {
    for (var obs : observers) {
      obs.update(currentWeather);
    }
  }
}</code></pre> 
<p>æ‰§è¡Œç¤ºä¾‹ï¼š</p> 
<pre><code class="language-java">    var weather = new Weather();
    weather.addObserver(new Orcs());
    weather.addObserver(new Hobbits());

    weather.timePasses();
    // The weather changed to rainy.
    // The orcs are facing rainy weather now
    // The hobbits are facing rainy weather now
    weather.timePasses();
    // The weather changed to windy.
    // The orcs are facing windy weather now
    // The hobbits are facing windy weather now
    weather.timePasses();
    // The weather changed to cold.
    // The orcs are facing cold weather now
    // The hobbits are facing cold weather now
    weather.timePasses();
    // The weather changed to sunny.
    // The orcs are facing sunny weather now
    // The hobbits are facing sunny weather now</code></pre> 
<h3 style="background-color:transparent;">ğŸ”ç±»å›¾</h3> 
<hr> 
<p class="img-center"><img alt="" height="489" src="https://images2.imgbox.com/4b/49/axGWvTU2_o.png" width="522"></p> 
<blockquote> 
</blockquote> 
<h3 style="background-color:transparent;">ğŸ”æ‰©å±•å»¶ä¼¸Â </h3> 
<h4 id="articleContentId">è§‚å¯Ÿè€…æ¨¡å¼åœ¨kafka client consumerä¸­çš„ä½¿ç”¨:</h4> 
<h5><strong>å¤§è‡´é€»è¾‘</strong>ï¼š</h5> 
<blockquote> 
 <p>consumeræƒ³è¦æ¶ˆè´¹kafka brokerä¸­çš„æ•°æ®éœ€è¦å‘é€requestï¼Œrequestå‘é€çš„ç»“æœç”¨RequestFutureæ¥è¡¨ç¤ºï¼ŒRequestFutureä¸­åŒ…å«RequestFutureListenerï¼Œå½“requestå¤„ç†å®ŒæˆåRequestFutureListenerçš„ç›¸å…³æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚RequestFutureCompletionHandlerç”¨æ¥å¤„ç†RequestFutureã€ClientResponseè¿˜æœ‰RuntimeExceptionã€‚</p> 
</blockquote> 
<h5>ä¾èµ–å…³ç³»ï¼š</h5> 
<blockquote> 
 <p>RequestFutureListenerä¸ºè§‚å¯Ÿè€…ï¼ŒonSuccesså’ŒonFailæ–¹æ³•ç›¸å½“äºä¹‹å‰çš„updateæ–¹æ³•ï¼›RequestFutureä¸ºè¢«è§‚å¯Ÿè€…ï¼ŒaddListenerç›¸å½“äºattachæ–¹æ³•ï¼ŒfireSuccesså’ŒfireFailureæ–¹æ³•ç›¸å½“äºnotifyæ–¹æ³•ã€‚</p> 
</blockquote> 
<h5><strong>RequestFutureListeneréƒ¨åˆ†ä»£ç ï¼š</strong></h5> 
<pre><code class="language-java">public interface RequestFutureListener&lt;T&gt; {

    void onSuccess(T value);

    void onFailure(RuntimeException e);
}
</code></pre> 
<h5><strong>RequestFutureéƒ¨åˆ†ä»£ç ï¼š</strong>Â </h5> 
<pre><code class="language-java">public class RequestFuture&lt;T&gt; implements ConsumerNetworkClient.PollCondition {

    private static final Object INCOMPLETE_SENTINEL = new Object();
    private final AtomicReference&lt;Object&gt; result = new AtomicReference&lt;&gt;(INCOMPLETE_SENTINEL);
    private final ConcurrentLinkedQueue&lt;RequestFutureListener&lt;T&gt;&gt; listeners = new ConcurrentLinkedQueue&lt;&gt;();
    private final CountDownLatch completedLatch = new CountDownLatch(1);

    public void complete(T value) {
        try {
            if (value instanceof RuntimeException)
                throw new IllegalArgumentException("The argument to complete can not be an instance of RuntimeException");

            if (!result.compareAndSet(INCOMPLETE_SENTINEL, value))
                throw new IllegalStateException("Invalid attempt to complete a request future which is already complete");
            fireSuccess();
        } finally {
            completedLatch.countDown();
        }
    }
//éå†listenerå¹¶è°ƒç”¨å…¶successæ—¶çš„æ–¹æ³•
    private void fireSuccess() {
        T value = value();
        while (true) {
            RequestFutureListener&lt;T&gt; listener = listeners.poll();
            if (listener == null)
                break;
            listener.onSuccess(value);
        }
    }
//éå†listenerå¹¶è°ƒç”¨å…¶failæ—¶çš„æ–¹æ³•
    private void fireFailure() {
        RuntimeException exception = exception();
        while (true) {
            RequestFutureListener&lt;T&gt; listener = listeners.poll();
            if (listener == null)
                break;
            listener.onFailure(exception);
        }
    }
    //å¢åŠ listener
    public void addListener(RequestFutureListener&lt;T&gt; listener) {
        this.listeners.add(listener);
        if (failed())
            fireFailure();
        else if (succeeded())
            fireSuccess();
    }
</code></pre> 
<h3>ğŸ”é€‚ç”¨åœºæ™¯</h3> 
<hr> 
<p>åœ¨ä¸‹é¢ä»»ä½•ä¸€ç§æƒ…å†µä¸‹éƒ½å¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼</p> 
<blockquote> 
 <ul><li>å½“æŠ½è±¡å…·æœ‰ä¸¤ä¸ªæ–¹é¢æ—¶ï¼Œä¸€ä¸ªæ–¹é¢ä¾èµ–äºå¦ä¸€ä¸ªæ–¹é¢ã€‚å°†è¿™äº›æ–¹é¢å°è£…åœ¨å•ç‹¬çš„å¯¹è±¡ä¸­ï¼Œå¯ä»¥ä½¿ä½ åˆ†åˆ«è¿›è¡Œæ›´æ”¹å’Œé‡ç”¨</li><li>å½“ä¸€ä¸ªå¯¹è±¡çš„æ”¹å˜çš„åŒæ—¶éœ€è¦æ”¹å˜å…¶ä»–å¯¹è±¡ï¼ŒåŒæ—¶ä½ åˆä¸çŸ¥é“æœ‰å¤šå°‘å¯¹è±¡éœ€è¦æ”¹å˜æ—¶</li><li>å½“ä¸€ä¸ªå¯¹è±¡å¯ä»¥é€šçŸ¥å…¶ä»–å¯¹è±¡è€Œæ— éœ€å‡è®¾è¿™äº›å¯¹è±¡æ˜¯è°æ—¶ã€‚æ¢å¥è¯è¯´ï¼Œä½ ä¸æƒ³è®©è¿™äº›å¯¹è±¡ç´§è€¦åˆã€‚</li></ul> 
</blockquote> 
<h3>ğŸ”Ending</h3> 
<hr> 
<p>è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œä½¿å¾—å½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°ã€‚</p> 
<p>åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œé€šå¸¸åŒ…å«ä»¥ä¸‹å‡ ä¸ªè§’è‰²ï¼š</p> 
<blockquote> 
 <ol><li>ä¸»é¢˜ï¼ˆSubjectï¼‰ï¼šè¢«è§‚å¯Ÿçš„å¯¹è±¡ï¼Œå®ƒä¼šç»´æŠ¤ä¸€ç»„è§‚å¯Ÿè€…å¯¹è±¡ï¼Œå¹¶åœ¨è‡ªèº«çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥è§‚å¯Ÿè€…ã€‚</li><li>è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ï¼šè§‚å¯Ÿä¸»é¢˜å¯¹è±¡çš„çŠ¶æ€å˜åŒ–ï¼Œå¹¶æ ¹æ®å˜åŒ–åšå‡ºç›¸åº”çš„åŠ¨ä½œã€‚</li><li>å…·ä½“ä¸»é¢˜ï¼ˆConcreteSubjectï¼‰ï¼šå®ç°äº†ä¸»é¢˜æ¥å£çš„å…·ä½“å¯¹è±¡ï¼Œè´Ÿè´£ç»´æŠ¤è§‚å¯Ÿè€…åˆ—è¡¨ï¼Œå¹¶åœ¨è‡ªèº«çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥è§‚å¯Ÿè€…ã€‚</li><li>å…·ä½“è§‚å¯Ÿè€…ï¼ˆConcreteObserverï¼‰ï¼šå®ç°äº†è§‚å¯Ÿè€…æ¥å£çš„å…·ä½“å¯¹è±¡ï¼Œè´Ÿè´£æ¥æ”¶ä¸»é¢˜å¯¹è±¡çš„é€šçŸ¥ï¼Œå¹¶æ ¹æ®é€šçŸ¥æ›´æ–°è‡ªèº«çŠ¶æ€ã€‚</li></ol> 
</blockquote> 
<hr> 
<p>å¸Œæœ›æœ¬æ–‡èƒ½å¤Ÿå¸®åŠ©è¯»è€…æ›´æ·±å…¥åœ°ç†è§£è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå¹¶åœ¨å®é™…é¡¹ç›®ä¸­å‘æŒ¥å…¶ä¼˜åŠ¿ã€‚è°¢è°¢é˜…è¯»ï¼</p> 
<hr> 
<p>å¸Œæœ›è¿™ä»½åšå®¢è‰ç¨¿èƒ½å¤Ÿå¸®åŠ©åˆ°ä½ ã€‚å¦‚æœæœ‰å…¶ä»–éœ€è¦ä¿®æ”¹æˆ–æ·»åŠ çš„åœ°æ–¹ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/3f/35/CV3mApmG_o.gif"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/280b2b82c58e78cd1784955b37b7cae2/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">æ­ç§˜å¤§æ•°æ®æ—¶ä»£çš„æ•°æ®åº“å­˜å‚¨å¼•æ“ï¼šå…³ç³»å‹ã€NoSQLä¸NewSQLå¦‚ä½•é€‰æ‹©ï¼Ÿ</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e55c146689fd69a874ec410ba4a23e72/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">å¾®è½¯å°†äº 2024 ä¸‹åŠå¹´å¼€å§‹æ·˜æ±° VBScript</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>