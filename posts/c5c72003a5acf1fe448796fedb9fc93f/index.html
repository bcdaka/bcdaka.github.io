<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>安卓开发- 安卓13 Launcher3 主页布局修改 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/c5c72003a5acf1fe448796fedb9fc93f/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="安卓开发- 安卓13 Launcher3 主页布局修改">
  <meta property="og:description" content="修改主页布局 概述 ​ 在 Android 操作系统中，Launcher （主页应用）是用户与设备交互的核心界面之一，它负责显示应用程序列表、提供快捷方式、管理小部件等功能。其中，Launcher3 是 Android 系统默认的启动器应用程序，我们可以通过修改Launcher3的源码，来改变主页应用的样式和布局。下面将结合源码，分析如何修改Launcher3主页的相关样式和布局。
布局构成 ​ Launcher3最核心的类是一个Launcher.java（可以看作是Launcher中的MainActivity），基本上所有操作(包括UI的定制)都集中在这个Activity上。在Launcher.java 中，通过setContentView()设置的布局参数是R.layout.launcher，对应的是launcher.xml文件，它定义了启动器界面的整体结构和组件的位置，我们看下这个布局文件里的内容：
&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt; &lt;com.android.launcher3.LauncherRootView xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34; xmlns:launcher=&#34;http://schemas.android.com/apk/res-auto&#34; android:id=&#34;@&#43;id/launcher&#34; android:layout_width=&#34;match_parent&#34; android:layout_height=&#34;match_parent&#34; android:fitsSystemWindows=&#34;true&#34;&gt; &lt;com.android.launcher3.dragndrop.DragLayer android:id=&#34;@&#43;id/drag_layer&#34; android:layout_width=&#34;match_parent&#34; android:layout_height=&#34;match_parent&#34; android:clipChildren=&#34;false&#34; android:clipToPadding=&#34;false&#34; android:importantForAccessibility=&#34;no&#34;&gt; &lt;com.android.launcher3.views.AccessibilityActionsView android:layout_width=&#34;match_parent&#34; android:layout_height=&#34;match_parent&#34; android:contentDescription=&#34;@string/home_screen&#34; /&gt; &lt;!-- The workspace contains 5 screens of cells --&gt; &lt;!-- DO NOT CHANGE THE ID --&gt; &lt;com.android.launcher3.Workspace android:id=&#34;@&#43;id/workspace&#34; android:layout_width=&#34;match_parent&#34; android:layout_height=&#34;match_parent&#34; android:layout_gravity=&#34;center&#34; android:theme=&#34;@style/HomeScreenElementTheme&#34; launcher:pageIndicator=&#34;@&#43;id/page_indicator&#34; /&gt; &lt;!-- DO NOT CHANGE THE ID --&gt; &lt;include android:id=&#34;@&#43;id/hotseat&#34; layout=&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-12T11:32:06+08:00">
    <meta property="article:modified_time" content="2024-08-12T11:32:06+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">安卓开发- 安卓13 Launcher3 主页布局修改</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>修改主页布局</h3> 
<h4><a id="_2"></a>概述</h4> 
<p>​ 在 Android 操作系统中，Launcher （主页应用）是用户与设备交互的核心界面之一，它负责<strong>显示应用程序列表、提供快捷方式、管理小部件</strong>等功能。其中，Launcher3 是 Android 系统<strong>默认的启动器</strong>应用程序，我们可以通过修改Launcher3的源码，来改变主页应用的样式和布局。下面将结合源码，分析如何修改Launcher3主页的相关样式和布局。</p> 
<h4><a id="_8"></a>布局构成</h4> 
<p>​ Launcher3最核心的类是一个<strong>Launcher.java</strong>（可以看作是Launcher中的MainActivity），基本上所有操作(包括UI的定制)都集中在这个Activity上。在Launcher.java 中，通过setContentView()设置的布局参数是R.layout.launcher，对应的是launcher.xml文件，它定义了启动器界面的整体结构和组件的位置，我们看下这个布局文件里的内容：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.android.launcher3.LauncherRootView</span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>launcher</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/launcher<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>fitsSystemWindows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.android.launcher3.dragndrop.DragLayer</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/drag_layer<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>clipChildren</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>clipToPadding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>importantForAccessibility</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>no<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.android.launcher3.views.AccessibilityActionsView</span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>contentDescription</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/home_screen<span class="token punctuation">"</span></span>
            <span class="token punctuation">/&gt;</span></span>

        <span class="token comment">&lt;!-- The workspace contains 5 screens of cells --&gt;</span>
        <span class="token comment">&lt;!-- DO NOT CHANGE THE ID --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.android.launcher3.Workspace</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/workspace<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/HomeScreenElementTheme<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>pageIndicator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/page_indicator<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token comment">&lt;!-- DO NOT CHANGE THE ID --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/hotseat<span class="token punctuation">"</span></span>
            <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@layout/hotseat<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token comment">&lt;!-- Keep these behind the workspace so that they are not visible when
         we go into AllApps --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.android.launcher3.pageindicators.WorkspacePageIndicator</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/page_indicator<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@dimen/workspace_page_indicator_height<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bottom|center_horizontal<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/HomeScreenElementTheme<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/drop_target_bar<span class="token punctuation">"</span></span>
            <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@layout/drop_target_bar<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.android.launcher3.views.ScrimView</span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/scrim_view<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@android:color/transparent<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/apps_view<span class="token punctuation">"</span></span>
            <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@layout/all_apps<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span>
            <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/overview_panel<span class="token punctuation">"</span></span>
            <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@layout/overview_panel<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>com.android.launcher3.dragndrop.DragLayer</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>com.android.launcher3.LauncherRootView</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>​ 由上面内容可以看到，Launcher3，父布局是一个自定义的LauncherRootView，在这个LauncherRootView中只有一个子布局DragLayer，在DragLayer中放置了Workspace、Hotseat、WorkspacePageIndicator等内容。这里我们先看下Launcher3主页的构造图，以便我们了解各个子布局的相关内容：</p> 
<p><img src="https://images2.imgbox.com/cb/ff/WFEhSYfC_o.png" alt="在这里插入图片描述"></p> 
<ul><li>Launcher3布局的最外面是一个自定义的View：<strong>LauncherRootView</strong>，它是继承自<strong>FrameLayout</strong>；LauncherRootView里面只有一个叫<strong>DragLayer</strong>的ViewGroup，它同样继承自FrameLayout，主要功能就是<strong>处理拖拽事件</strong>，当你在拖拽一个图标的时候，就相当于是一个view放到了DragLayer里面，这个view会跟随你的手在屏幕上移动。</li><li>屏幕上可以左右滑动的整个页面叫做<strong>Workspace</strong>，Workspace的父类是<strong>PagedView</strong>，PagedViewk用来处理左右滑动。</li><li>Workspace里面可能含有多个页面（屏），多个页面存在时，可以左右滑动来切换页面；可以滑动的单独一屏就是一个<strong>CellLayout</strong>，CellLayout负责自己页面图标和小部件的显示和整齐摆放。</li><li>在左右滑动屏幕切换页面时 屏幕最下方会出现的指示器<strong>PageIndicator</strong>（一般是几个小圆点，这里图示中被隐藏了），告诉你桌面有几屏，当前在哪一屏上（圆点会高亮）。</li><li>在Workspace中，向上滑动屏幕可以唤出所有应用列表（抽屉样式），向下滑动可以唤出状态栏和通知栏。</li><li>在CellLayout中可以放置<strong>组件</strong>、<strong>应用</strong>、<strong>包含应用的文件夹</strong>等。如上图中顶部的搜索框就是谷歌提供的原生搜索框（其实它并不算一个组件，而是一个特殊元素），屏幕靠下方的左右两边分别是应用文件夹和单个应用图标。当<strong>长按</strong>CellLayout上的组件、应用、文件夹或者空白地方的时候，会出现一个MENU菜单，可以对组件或应用进行配置，或者添加组件等。当长按组件、应用或文件夹，并拖动到屏幕上方时，屏幕上方会显示一个DropTargetBar区域，里面有“移除”按钮，可以对组件进行移除，对app进行卸载等操作。</li><li>底部有五个固定不动的图标所在的区域叫做Hotseat，用来放置比较常用的应用，比如拨号，短信，相机等。</li><li>底部右侧有三个白色按钮的区域是导航栏。导航栏可以在所有页面中常显，用于全局控制（返回、回到主页、最近应用）。</li></ul> 
<p>这里简单展示下几个控件的布局代码：</p> 
<p>hotseat.xml</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.android.launcher3.Hotseat</span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>launcher</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/hotseat<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/HomeScreenElementTheme<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>importantForAccessibility</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>no<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>preferKeepClear</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">launcher:</span>containerType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hotseat<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>all_apps.xml</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.android.launcher3.allapps.LauncherAllAppsContainerView</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/apps_view<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>clipChildren</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>clipToPadding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>focusable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>saveEnabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>drop_target_bar.xml</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.android.launcher3.DropTargetBar</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@dimen/dynamic_grid_drop_target_size<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center_horizontal|top<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>focusable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>alpha</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/HomeScreenElementTheme<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>visibility</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>invisible<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- Delete target --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.android.launcher3.DeleteDropTarget</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/delete_target_text<span class="token punctuation">"</span></span>
        <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css">@style/DropTargetButton</span><span class="token punctuation">"</span></span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/remove_drop_target_label<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!-- Uninstall target --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.android.launcher3.SecondaryDropTarget</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/uninstall_target_text<span class="token punctuation">"</span></span>
        <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css">@style/DropTargetButton</span><span class="token punctuation">"</span></span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/uninstall_drop_target_label<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>com.android.launcher3.DropTargetBar</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>上面这三个控件都是直接include在Launcher.xml的布局中的，其他子布局也是以类似于自定义View的形式被添加到Launcher.xml中的，比如workspace：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.android.launcher3.Workspace</span>
    <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/workspace<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>center<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/HomeScreenElementTheme<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">launcher:</span>pageIndicator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/page_indicator<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>Workspace.java是在Launcher的onCreate()阶段被创建并添加到主页里面的：</p> 
<pre><code class="prism language-java"><span class="token comment">// Launcher3/src/com/android/launcher3/Launcher.java</span>

<span class="token annotation punctuation">@Thunk</span>
<span class="token class-name">Workspace</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> mWorkspace<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Thunk</span>
<span class="token class-name">DragLayer</span> mDragLayer<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@TargetApi</span><span class="token punctuation">(</span><span class="token class-name">Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>S</span><span class="token punctuation">)</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>

    <span class="token function">setupViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">setupViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">inflateRootView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>launcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mDragLayer <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>drag_layer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mFocusHandler <span class="token operator">=</span> mDragLayer<span class="token punctuation">.</span><span class="token function">getFocusIndicatorHelper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 绑定workspace</span>
    mWorkspace <span class="token operator">=</span> mDragLayer<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>workspace<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// workspace做一些初始化的工作</span>
    mWorkspace<span class="token punctuation">.</span><span class="token function">initParentViews</span><span class="token punctuation">(</span>mDragLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mOverviewPanel <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>overview_panel<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mHotseat <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>hotseat<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mHotseat<span class="token punctuation">.</span><span class="token function">setWorkspace</span><span class="token punctuation">(</span>mWorkspace<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mDragLayer<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span>mDragController<span class="token punctuation">,</span> mWorkspace<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mWorkspace<span class="token punctuation">.</span><span class="token function">setup</span><span class="token punctuation">(</span>mDragController<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mWorkspace<span class="token punctuation">.</span><span class="token function">lockWallpaperToDefaultPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mWorkspace<span class="token punctuation">.</span><span class="token function">bindAndInitFirstWorkspaceScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mDragController<span class="token punctuation">.</span><span class="token function">addDragListener</span><span class="token punctuation">(</span>mWorkspace<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>​ 各子布局的添加和加载就不展开介绍了，这里先介绍一个Launcher3很重要的内容：<strong>DeviceProfile.java和device_profiles.xml</strong>：</p> 
<h4><a id="DeviceProfile_219"></a>DeviceProfile</h4> 
<p>​ <code>DeviceProfile.java</code>包含了多个用于描述设备配置的属性，例如<code>mNumColumns</code>(列数)、<code>mNumRows</code>(行数)、<code>mHotseatHeight</code>(Dock的高度)、<code>mIconSizePx</code>(图标大小)等，这些属性用于确定Launcher的布局和各个组件的位置。<code>DeviceProfile</code>在<code>Launcher</code>启动时被创建，并根据设备的实际配置(device_profiles.xml)进行初始化。</p> 
<ul><li>初始化过程中会根据设备的屏幕尺寸、方向等因素计算出各种关键属性。</li><li>当设备的配置发生变化时（例如旋转屏幕），<code>DeviceProfile</code>会被更新以反映新的配置。</li><li>更新过程中会重新计算关键属性，并通知Launcher的各个组件进行相应的调整。</li></ul> 
<p>​ <code>device_profiles.xml</code>是一个XML配置文件，位于Launcher3项目的<code>res/xml</code>目录下。它定义了一系列设备配置，每种配置对应着不同的屏幕尺寸、方向和密度等信息，这一系列配置用于在不同设备上适配Launcher。这样可以确保Launcher在不同设备上都能够良好地显示和运行。<br> ​ 当Launcher启动时，它会被DeviceProfile.java动态加载，并根据当前设备的实际配置找到最合适的预设配置，这些预设配置【<code>mNumColumns</code>(列数)、<code>mNumRows</code>(行数)、<code>mIconSizePx</code>(图标大小)等】用于<strong>初始化<code>DeviceProfile</code>对象</strong>。【各属性的介绍放到下一小节中了】</p> 
<p>下面简单介绍下DeviceProfile.java和device_profiles.xml的加载流程：</p> 
<pre><code class="prism language-java"><span class="token comment">// Launcher3/src/com/android/launcher3/Launcher.java</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@TargetApi</span><span class="token punctuation">(</span><span class="token class-name">Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>S</span><span class="token punctuation">)</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ...</span>
	<span class="token class-name">LauncherAppState</span> app <span class="token operator">=</span> <span class="token class-name">LauncherAppState</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 通过LauncherAppState的getInvariantDeviceProfile方法获取InvariantDeviceProfile对象</span>
    <span class="token class-name">InvariantDeviceProfile</span> idp <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">getInvariantDeviceProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 在initDeviceProfile方法里获取DeviceProfile对象</span>
    <span class="token function">initDeviceProfile</span><span class="token punctuation">(</span>idp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * Returns {@code true} if a new DeviceProfile is initialized, and {@code false} otherwise.
 */</span>
<span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">initDeviceProfile</span><span class="token punctuation">(</span><span class="token class-name">InvariantDeviceProfile</span> idp<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 获取DeviceProfile，这里DeviceProfile对象来源是InvariantDeviceProfile.getDeviceProfile()</span>
    <span class="token class-name">DeviceProfile</span> deviceProfile <span class="token operator">=</span> idp<span class="token punctuation">.</span><span class="token function">getDeviceProfile</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mDeviceProfile <span class="token operator">==</span> deviceProfile<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    mDeviceProfile <span class="token operator">=</span> deviceProfile<span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>​ 在Launcher.java的onCreate()方法中，先调用LauncherAppState.getInvariantDeviceProfile()方法获取一个InvariantDeviceProfile对象，然后在initDeviceProfile()方法中，通过InvariantDeviceProfile对象的getDeviceProfile()方法获取到DeviceProfile对象。跟进到LauncherAppState中看下：</p> 
<pre><code class="prism language-java"><span class="token comment">// Launcher3/src/com/android/launcher3/LauncherAppState.java</span>

<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">InvariantDeviceProfile</span> mInvariantDeviceProfile<span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token class-name">LauncherAppState</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 调用两个参数的构造方法</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token class-name">LauncherFiles</span><span class="token punctuation">.</span><span class="token constant">APP_ICONS_DB</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token class-name">Launcher</span><span class="token punctuation">.</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">"LauncherAppState initiated"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">LauncherAppState</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> iconCacheFileName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    mContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
    <span class="token comment">// 获取mInvariantDeviceProfile对象</span>
    mInvariantDeviceProfile <span class="token operator">=</span> <span class="token class-name">InvariantDeviceProfile</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">InvariantDeviceProfile</span> <span class="token function">getInvariantDeviceProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     <span class="token comment">// 返回InvariantDeviceProfile对象</span>
    <span class="token keyword">return</span> mInvariantDeviceProfile<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>​ 由上面代码可以看出，InvariantDeviceProfile对象是在LauncherAppState的构造方法中创建的，并通过getInvariantDeviceProfile()方法返回一个InvariantDeviceProfile对象。继续跟进到InvariantDeviceProfile.java中：</p> 
<pre><code class="prism language-java"><span class="token comment">// Launcher3/src/com/android/launcher3/InvariantDeviceProfile.java</span>

<span class="token comment">// 这里的 INSTANCE可以理解为获取自身的单例对象</span>
<span class="token comment">// MainThreadInitializedObject是一个用于定义在主线程上启动的单例的实用工具类</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">MainThreadInitializedObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">InvariantDeviceProfile</span><span class="token punctuation">&gt;</span></span> <span class="token constant">INSTANCE</span> <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">MainThreadInitializedObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">InvariantDeviceProfile</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@TargetApi</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">InvariantDeviceProfile</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> gridName <span class="token operator">=</span> <span class="token function">getCurrentGridName</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment">// 调用initGrid()方法</span>
    <span class="token class-name">String</span> newGridName <span class="token operator">=</span> <span class="token function">initGrid</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> gridName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">initGrid</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">String</span> gridName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Info</span> displayInfo <span class="token operator">=</span> <span class="token class-name">DisplayController</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@DeviceType</span> <span class="token keyword">int</span> deviceType <span class="token operator">=</span> <span class="token function">getDeviceType</span><span class="token punctuation">(</span>displayInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 调用getPredefinedDeviceProfiles方法加载device_profiles.xml文件</span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DisplayOption</span><span class="token punctuation">&gt;</span></span> allOptions <span class="token operator">=</span>
            <span class="token function">getPredefinedDeviceProfiles</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> gridName<span class="token punctuation">,</span> deviceType<span class="token punctuation">,</span>
                    <span class="token class-name">RestoreDbTask</span><span class="token punctuation">.</span><span class="token function">isPending</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 把device_profiles.xml文件中的配置信息记录到displayOption中</span>
    <span class="token class-name">DisplayOption</span> displayOption <span class="token operator">=</span>
            <span class="token function">invDistWeightedInterpolate</span><span class="token punctuation">(</span>displayInfo<span class="token punctuation">,</span> allOptions<span class="token punctuation">,</span> deviceType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 调用四个参数的initGrid()方法</span>
    <span class="token function">initGrid</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> displayInfo<span class="token punctuation">,</span> displayOption<span class="token punctuation">,</span> deviceType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> displayOption<span class="token punctuation">.</span>grid<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DisplayOption</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPredefinedDeviceProfiles</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span>
        <span class="token class-name">String</span> gridName<span class="token punctuation">,</span> <span class="token annotation punctuation">@DeviceType</span> <span class="token keyword">int</span> deviceType<span class="token punctuation">,</span> <span class="token keyword">boolean</span> allowDisabledGrid<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DisplayOption</span><span class="token punctuation">&gt;</span></span> profiles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 加载device_profiles.xml文件</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">XmlResourceParser</span> parser <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getXml</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>xml<span class="token punctuation">.</span>device_profiles<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> depth <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">getDepth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> <span class="token operator">|</span> <span class="token class-name">XmlPullParserException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initGrid</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Info</span> displayInfo<span class="token punctuation">,</span> <span class="token class-name">DisplayOption</span> displayOption<span class="token punctuation">,</span> <span class="token annotation punctuation">@DeviceType</span> <span class="token keyword">int</span> deviceType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">DisplayMetrics</span> metrics <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取displayOption里面配置信息（实际上就是device_profiles.xml中读取的信息）</span>
    <span class="token class-name">GridOption</span> closestProfile <span class="token operator">=</span> displayOption<span class="token punctuation">.</span>grid<span class="token punctuation">;</span>
    numRows <span class="token operator">=</span> closestProfile<span class="token punctuation">.</span>numRows<span class="token punctuation">;</span>
    numColumns <span class="token operator">=</span> closestProfile<span class="token punctuation">.</span>numColumns<span class="token punctuation">;</span>
    numSearchContainerColumns <span class="token operator">=</span> closestProfile<span class="token punctuation">.</span>numSearchContainerColumns<span class="token punctuation">;</span>
    <span class="token comment">// ...</span>

    <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DeviceProfile</span><span class="token punctuation">&gt;</span></span> localSupportedProfiles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    defaultWallpaperSize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span>displayInfo<span class="token punctuation">.</span>currentSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SparseArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DotRenderer</span><span class="token punctuation">&gt;</span></span> dotRendererCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SparseArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">WindowBounds</span> bounds <span class="token operator">:</span> displayInfo<span class="token punctuation">.</span>supportedBounds<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 通过DeviceProfile.Build()方法创建DeviceProfile对象</span>
        localSupportedProfiles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DeviceProfile<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> displayInfo<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setIsMultiDisplay</span><span class="token punctuation">(</span>deviceType <span class="token operator">==</span> <span class="token constant">TYPE_MULTI_DISPLAY</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setWindowBounds</span><span class="token punctuation">(</span>bounds<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setDotRendererCache</span><span class="token punctuation">(</span>dotRendererCache<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 把DeviceProfile列表存到supportedProfiles中，supportedProfiles是一个类型为List&lt;DeviceProfile&gt;的列表</span>
    <span class="token comment">// 这里创建了DeviceProfile列表，是因为DeviceProfile中有多个不同的配置，一套配置可以视为一个DeviceProfile对象</span>
    supportedProfiles <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">unmodifiableList</span><span class="token punctuation">(</span>localSupportedProfiles<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>​ 在InvariantDeviceProfile.java的构造方法中，调用了initGrid(context, gridName)方法，然后在initGrid()方法中调用getPredefinedDeviceProfiles()方法去加载device_profiles.xml配置文件，随后又调用了四个参数的initGrid()方法创建DeviceProfile对象列表，并把它赋值给supportedProfiles，supportedProfiles是一个类型为List&lt;DeviceProfile&gt;的列表。</p> 
<p>​ 在Launcher.java中是是通过idp.getDeviceProfile(this)来获取DeviceProfile对象的，我们看下InvariantDeviceProfile的getDeviceProfile()方法：</p> 
<pre><code class="prism language-java"><span class="token comment">// Launcher3/src/com/android/launcher3/InvariantDeviceProfile.java</span>

<span class="token keyword">public</span> <span class="token class-name">DeviceProfile</span> <span class="token function">getDeviceProfile</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Resources</span> res <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Configuration</span> config <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">float</span> screenWidth <span class="token operator">=</span> config<span class="token punctuation">.</span>screenWidthDp <span class="token operator">*</span> res<span class="token punctuation">.</span><span class="token function">getDisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>density<span class="token punctuation">;</span>
    <span class="token keyword">float</span> screenHeight <span class="token operator">=</span> config<span class="token punctuation">.</span>screenHeightDp <span class="token operator">*</span> res<span class="token punctuation">.</span><span class="token function">getDisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>density<span class="token punctuation">;</span>
    <span class="token keyword">int</span> rotation <span class="token operator">=</span> <span class="token class-name">WindowManagerProxy</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRotation</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>

    <span class="token comment">// 根据屏幕的宽高等信息，获取最适合的DeviceProfile配置文件</span>
    <span class="token keyword">return</span> <span class="token function">getBestMatch</span><span class="token punctuation">(</span>screenWidth<span class="token punctuation">,</span> screenHeight<span class="token punctuation">,</span> rotation<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 返回与所提供的屏幕配置相匹配的设备配置文件
 */</span>
<span class="token keyword">public</span> <span class="token class-name">DeviceProfile</span> <span class="token function">getBestMatch</span><span class="token punctuation">(</span><span class="token keyword">float</span> screenWidth<span class="token punctuation">,</span> <span class="token keyword">float</span> screenHeight<span class="token punctuation">,</span> <span class="token keyword">int</span> rotation<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">DeviceProfile</span> bestMatch <span class="token operator">=</span> supportedProfiles<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">float</span> minDiff <span class="token operator">=</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">;</span>
    <span class="token comment">// 遍历supportedProfiles列表，找出最匹配的配置文件。这里的supportedProfiles就是前面保存的DeviceProfile列表</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">DeviceProfile</span> profile <span class="token operator">:</span> supportedProfiles<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">float</span> diff <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>profile<span class="token punctuation">.</span>widthPx <span class="token operator">-</span> screenWidth<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>profile<span class="token punctuation">.</span>heightPx <span class="token operator">-</span> screenHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>diff <span class="token operator">&lt;</span> minDiff<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            minDiff <span class="token operator">=</span> diff<span class="token punctuation">;</span>
            bestMatch <span class="token operator">=</span> profile<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>diff <span class="token operator">==</span> minDiff <span class="token operator">&amp;&amp;</span> profile<span class="token punctuation">.</span>rotationHint <span class="token operator">==</span> rotation<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            bestMatch <span class="token operator">=</span> profile<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bestMatch<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>​ 所以执行到这里，Launcher.java中就可以拿到与当前屏幕最匹配的DeviceProfile配置了，通过这个DeviceProfile配置，可以去调整桌面的布局和组件，如下：</p> 
<pre><code class="prism language-java"><span class="token comment">// Launcher3/src/com/android/launcher3/Launcher.java</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">finishBindingItems</span><span class="token punctuation">(</span><span class="token class-name">IntSet</span> pagesBoundFirst<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Object</span> traceToken <span class="token operator">=</span> <span class="token class-name">TraceHelper</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">.</span><span class="token function">beginSection</span><span class="token punctuation">(</span><span class="token string">"finishBindingItems"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mWorkspace<span class="token punctuation">.</span><span class="token function">restoreInstanceStateForRemainingPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// ...</span>

    <span class="token comment">// 获取mDeviceProfile配置信息里面的numFolderColumns和numFolderRows去做计算</span>
    <span class="token function">getViewCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCacheSize</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>folder_application<span class="token punctuation">,</span>
            mDeviceProfile<span class="token punctuation">.</span>inv<span class="token punctuation">.</span>numFolderColumns <span class="token operator">*</span> mDeviceProfile<span class="token punctuation">.</span>inv<span class="token punctuation">.</span>numFolderRows<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getViewCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCacheSize</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>folder_page<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">TraceHelper</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">.</span><span class="token function">endSection</span><span class="token punctuation">(</span>traceToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mWorkspace<span class="token punctuation">.</span><span class="token function">removeExtraEmptyScreen</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>其实不只是Launcher.java，在其他的类里面也会调用去做一些UI上的处理，比如Workspace.java中更新格子的Padding：</p> 
<pre><code class="prism language-java"><span class="token comment">// Launcher3/src/com/android/launcher3/Workspace.java</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updateCellLayoutPadding</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 获取配置信息里面的cellLayoutPaddingPx</span>
    <span class="token class-name">Rect</span> padding <span class="token operator">=</span> mLauncher<span class="token punctuation">.</span><span class="token function">getDeviceProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cellLayoutPaddingPx<span class="token punctuation">;</span>
    mWorkspaceScreens<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">setPadding</span><span class="token punctuation">(</span>padding<span class="token punctuation">.</span>left<span class="token punctuation">,</span> padding<span class="token punctuation">.</span>top<span class="token punctuation">,</span> padding<span class="token punctuation">.</span>right<span class="token punctuation">,</span> padding<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>​ 到这里DeviceProfile的加载分析流程就结束了，如上面示例所说，在Launcher3中，DeviceProfile.java和device_profiles.xml是两个非常重要的文件，它们对Launcher3主页布局是至关重要的，想要修改Launcher3主页的布局，可以从这个方面入手。</p> 
<h4><a id="_441"></a>主页布局修改</h4> 
<p>​ 上面的内容简单介绍了DeviceProfile的功能和加载流程，下面来分析，如何修改主页布局，还是沿着上面的思路，从DeviceProfile配置文件入手。</p> 
<p>​ Launcher3启动的时候，会加载 <strong>Launcher3\res\xml\device_profiles.xml</strong> 文件中预设的布局，内容如下：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profiles</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>launcher</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>grid-option</span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3_by_3<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numRows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numFolderRows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numFolderColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numHotseatIcons</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>dbFile</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>launcher_3_by_3.db<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>defaultLayoutId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@xml/default_workspace_3x3<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>deviceCategory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>phone<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
        
        <span class="token comment">&lt;!--省略多个display-option子标签内容--&gt;</span>
        
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>grid-option</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>grid-option</span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4_by_4<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numRows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numFolderRows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numFolderColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numHotseatIcons</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numExtendedHotseatIcons</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>dbFile</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>launcher_4_by_4.db<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>inlineNavButtonsEndSpacing</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@dimen/taskbar_button_margin_split<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>defaultLayoutId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@xml/default_workspace_4x4<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>deviceCategory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>phone|multi_display<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
        
        <span class="token comment">&lt;!--省略多个display-option子标签内容--&gt;</span>
            
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>grid-option</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>grid-option</span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5_by_5<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numRows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numFolderRows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numFolderColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numHotseatIcons</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numExtendedHotseatIcons</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>dbFile</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>launcher.db<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>inlineNavButtonsEndSpacing</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@dimen/taskbar_button_margin_split<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>defaultLayoutId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@xml/default_workspace_5x5<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>deviceCategory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>phone|multi_display<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
        
        <span class="token comment">&lt;!--省略多个display-option子标签内容--&gt;</span>
        
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>grid-option</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>grid-option</span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6_by_5<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numRows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>7<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numSearchContainerColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numFolderRows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numFolderColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numHotseatIcons</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>hotseatColumnSpanLandscape</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numAllAppsColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>isScalable</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>inlineNavButtonsEndSpacing</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@dimen/taskbar_button_margin_6_5<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>devicePaddingId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@xml/paddings_6x5<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>dbFile</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>launcher_6_by_5.db<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>defaultLayoutId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@xml/default_workspace_6x5<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>deviceCategory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>tablet<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>display-option</span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Tablet<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>minWidthDps</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>900<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>minHeightDps</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>820<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>minCellHeight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>minCellWidth</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>102<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>minCellHeightLandscape</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>104<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>minCellWidthLandscape</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>iconImageSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>60<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>iconTextSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>14<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>borderSpaceHorizontal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>borderSpaceVertical</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>64<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>borderSpaceLandscapeHorizontal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>64<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>borderSpaceLandscapeVertical</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>horizontalMargin</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>54<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>horizontalMarginLandscape</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>120<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>allAppsCellWidth</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>96<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>allAppsCellHeight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>142<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>allAppsCellWidthLandscape</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>126<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>allAppsCellHeightLandscape</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>126<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>allAppsIconSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>60<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>allAppsIconTextSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>14<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>allAppsBorderSpaceHorizontal</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>allAppsBorderSpaceVertical</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>allAppsBorderSpaceLandscape</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>16<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>hotseatBarBottomSpace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>30<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>hotseatBarBottomSpaceLandscape</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>40<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>canBeDefault</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>grid-option</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profiles</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>​ 这个文件配置代码是用于定义Google Launcher在不同设备和显示模式下的布局参数，特别是针对具有特定屏幕尺寸和平板电脑类设备的布局。该文件里定义了4个不同的布局类型，分别是3x3、4x4、5x5、6x5，上面有讲到，在调用InvariantDeviceProfile的getDeviceProfile()方法时，设备会根据当前屏幕的尺寸来加载相应的布局配置。</p> 
<p>​ 那我们在开发时如何确定设备加载哪个布局呢？可以在桌面长按应用图标，然后拖动一下，观察在x和y方向上可以移动多少个格子，这样就可以确定自己的设备加载的是哪一个布局类型了。一般平板（或者移动大屏等）设备会加载6*5的布局，现在较新的手机也可以支持5x5甚至6x5的布局了。</p> 
<p>​ device_profiles.xml文件中的<code>&lt;grid-option&gt;</code>标签包含了各种属性，用于定制Launcher界面的外观和行为。布局里面具体的属性说明如下：</p> 
<ul><li><code>launcher:name="6_by_5"</code>: 定义了布局的名称，这里是“6_by_5”，代表的是6行5列的基本布局结构，但实际上后续可以通过launcher:numRows、launcher:numColumns属性设置为其他的布局。因为项目需要，我这里对6 * 5的布局做了改动，改成了 7 * 6的布局。</li><li><code>launcher:numRows="6"</code> 和 <code>launcher:numColumns="7"</code>: 指定了主屏幕上行数和列数。</li><li><code>launcher:numSearchContainerColumns="5"</code>: 搜索栏容器的列数。</li><li><code>launcher:numFolderRows="3"</code> 和 <code>launcher:numFolderColumns="4"</code>: 文件夹中的行数和列数。</li><li><code>launcher:numHotseatIcons="0"</code>: Hotseat（快速启动栏）中的图标数量，在这里设置为0，意味着不显示Hotseat。</li><li><code>launcher:hotseatColumnSpanLandscape="2"</code>: 在横屏模式下，Hotseat占据的列数。</li><li><code>launcher:numAllAppsColumns="6"</code>: 所有应用列表中的列数。</li><li><code>launcher:isScalable="true"</code>: 表示是否可以缩放布局。</li><li><code>launcher:inlineNavButtonsEndSpacing</code> 和 <code>launcher:devicePaddingId</code>: 分别定义了内联导航按钮的结束间距和设备的填充空间ID。</li><li><code>launcher:dbFile</code> 和 <code>launcher:defaultLayoutId</code>: 数据库文件名和默认布局ID，用于存储和恢复布局状态。</li><li><code>launcher:deviceCategory="tablet"</code>: 设备类别，这里是平板电脑。</li></ul> 
<p>接下来的 <code>&lt;display-option&gt;</code> 标签提供了更多细节：</p> 
<ul><li><code>launcher:minWidthDps="900"</code> 和 <code>launcher:minHeightDps="820"</code>: 最小宽度和高度（以密度无关像素dp为单位），用于确定此布局适用于哪种屏幕尺寸。</li><li><code>launcher:minCellHeight</code> 和 <code>launcher:minCellWidth</code>: 单个单元格的最小高度和宽度。</li><li>后面的属性，如 <code>launcher:iconImageSize</code>、<code>launcher:iconTextSize</code> 等，分别定义了图标、文本、边框空间等元素的尺寸和间距。</li><li><code>launcher:horizontalMargin</code> 和 <code>launcher:horizontalMarginLandscape</code>: 水平方向上的外边距，在竖屏和横屏模式下可能不同。</li><li><code>launcher:hotseatBarBottomSpace</code> 和 <code>launcher:hotseatBarBottomSpaceLandscape</code>: Hotseat在竖屏和横屏模式下的底部间距。</li><li><code>launcher:canBeDefault="true"</code>: 表示此布局选项可以作为默认布局。</li></ul> 
<p>​ 这里我们重点关注下<strong>defaultLayoutId</strong>这个属性：在上面的配置文件中，6x5布局的defaultLayoutId=“@xml/default_workspace_6x5”，即指定了default_workspace_6x5.xml文件作为6x5样式的布局资源文件。</p> 
<p>​ default_workspace_MxN.xml这是用于定义用户桌面快捷方式（Favorites）配置的一个资源文件，代表主页布局是<strong>M行N列</strong>，我们可以在里面定义显示在使用这个布局情况下，worksapce中的各个控件，如下面给出了显示一个Hotseat应用的示例：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorites</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>launcher</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto/com.android.launcher3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 配置一个Hotseat应用--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resolve</span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>container</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-101<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name"><span class="token namespace">launcher:</span>uri</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#Intent;action=android.intent.action.MAIN;category=android.intent.category.APP_EMAIL;end<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name"><span class="token namespace">launcher:</span>uri</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mailto:<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resolve</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 其他配置 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>favorites</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>​ 文件由<code>&lt;favorites&gt;</code>标签括起来，里面可以包含一个或多个<code>&lt;resolve&gt;</code>标签，每个<code>&lt;resolve&gt;</code>标签都定义了一组快捷方式项，这些快捷方式可以直接链接到特定的应用或者执行特定的操作（如打开邮件客户端、日历、图库等）。&lt;resolve&gt;的子标签表示快捷方式项的类型，快捷方式项必须放在&lt;resolve&gt;标签内才生效。&lt;resolve&gt;支持的子标签如下：</p> 
<pre><code class="prism language-groovy">favorite <span class="token comment">//应用程序快捷方式</span>
widget   <span class="token comment">//桌面控件（小组件）</span>
shortcut <span class="token comment">//链接，如网址、本地磁盘路径等</span>
search   <span class="token comment">//搜索框（谷歌搜索框）</span>
clock    <span class="token comment">//桌面上的钟表Widget</span>
folder   <span class="token comment">//桌面文件夹（如谷歌应用的文件夹）</span>
</code></pre> 
<p>​ 同时<code>&lt;resolve&gt;</code>标签或其子标签通过<code>launcher:XXX</code>来设定快捷方式项的位置等信息，这些属性可以写在<code>&lt;resolve&gt;</code>标签或其子标签中，支持的属性如下：</p> 
<pre><code class="prism language-groovy"><span class="token comment">// resolve标签支持的属性</span>
launcher<span class="token punctuation">:</span>title  <span class="token comment">// 图标下面的文字，目前只支持引用，不能直接书写字符串;</span>
launcher<span class="token punctuation">:</span>icon   <span class="token comment">// 图标引用（适用于应用快捷方式）;</span>
launcher<span class="token punctuation">:</span>uri    <span class="token comment">// 链接地址，链接网址用的，使用shortcut标签就可以定义一个超链接，打开某个网址，文件等。</span>
launcher<span class="token punctuation">:</span>packageName   <span class="token comment">// 应用程序的包名;</span>
launcher<span class="token punctuation">:</span>className     <span class="token comment">// 应用程序的启动类名（要写全路径）;</span>
launcher<span class="token punctuation">:</span>screen        <span class="token comment">// 图标所在的屏幕编号，0表示第一页</span>
launcher<span class="token punctuation">:</span>x   <span class="token comment">// 应用图标所处x位置（从左到右，从0开始），（-1是默认值：第一行或者第一列）</span>
launcher<span class="token punctuation">:</span>y   <span class="token comment">// 应用图标所处y位置（从上往下，从0开始）</span>
launcher<span class="token punctuation">:</span>container   <span class="token comment">// 定义一个快捷方式（Favorite）或桌面项目应该放置在哪个容器中；-101表示HotSeat、-100表示DeskTop、0表示默认的桌面容器、其他正整数表示App shortcut</span>
launcher<span class="token punctuation">:</span>spanX  <span class="token comment">//在x方向上所占格数</span>
launcher<span class="token punctuation">:</span>spanY  <span class="token comment">//在y方向上所占格数</span>
</code></pre> 
<p>这里特别说明下<code>launcher:uri</code>属性：uri 定义了控件点击时的链接操作，通常以<code>#Intent;...;end</code>的格式编写，指定了一系列操作（如打开某个应用的主界面）或数据类型（如打开图库应用或浏览特定网站）。</p> 
<pre><code class="prism language-java"><span class="token comment">// 下面列举几个常用launcher:uri的写法：</span>
 
跳转到网页<span class="token operator">:</span> <span class="token string">"http://www.google.com"</span>
跳转到设置的辅助功能<span class="token operator">:</span><span class="token string">"#Intent;action=android.settings.ACCESSIBILITY_SETTINGS;end"</span>
打开音乐文件<span class="token operator">:</span><span class="token string">"file:///mnt/sdcard/song.mp3#Intent;action=android.intent.action.VIEW;type=audio/mp3;end"</span>
指定应用程序打开音乐文件<span class="token operator">:</span><span class="token string">"file:///mnt/sdcard/song.mp3#Intent;action=android.intent.action.VIEW;type=audio/mp3;component=com.android.music/.MusicBrowserActivity;end"</span>

<span class="token comment">// 指定应用程序打开音乐文件，在Java中对应的操作如下</span>
<span class="token class-name">Intent</span> it <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_VIEW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Uri</span> uri <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">fromFile</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"/mnt/sdcard/song.mp3"</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
it<span class="token punctuation">.</span><span class="token function">setDataAndType</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> “audio<span class="token operator">/</span>mp3”<span class="token punctuation">)</span><span class="token punctuation">;</span>
it<span class="token punctuation">.</span><span class="token function">setClassName</span><span class="token punctuation">(</span>“com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>music”<span class="token punctuation">,</span> “<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>music<span class="token punctuation">.</span></span>MusicBrowserActivity</span>”<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> lancher_uri <span class="token operator">=</span> it<span class="token punctuation">.</span><span class="token function">toUri</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>常用几种桌面控件的示例：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorites</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>launcher</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto/com.android.launcher3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!--定义一个HotSeat--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resolve</span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>container</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-101<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name"><span class="token namespace">launcher:</span>uri</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#Intent;action=android.intent.action.MAIN;category=android.intent.category.APP_EMAIL;end<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name"><span class="token namespace">launcher:</span>uri</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mailto:<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resolve</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!--定义一个时钟小组件--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resolve</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appwidget</span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>spanX</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>spanY</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.deskclock<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.alarmclock.DigitalAppWidgetProvider<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resolve</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!--定义一个谷歌搜索框--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resolve</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>search</span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>spanX</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>spanY</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.googlequicksearchbox<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.googlequicksearchbox.SearchWidgetProvider<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resolve</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!--定义一个文件夹，里面包含三个应用--&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resolve</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>folder</span> 
            <span class="token attr-name"><span class="token namespace">launcher:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/google_folder_title<span class="token punctuation">"</span></span> 
            <span class="token attr-name"><span class="token namespace">launcher:</span>screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> 
            <span class="token attr-name"><span class="token namespace">launcher:</span>x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span>
                <span class="token attr-name"><span class="token namespace">launcher:</span>packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.googlequicksearchbox<span class="token punctuation">"</span></span> 
                <span class="token attr-name"><span class="token namespace">launcher:</span>className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.googlequicksearchbox.SearchActivity<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> 
                <span class="token attr-name"><span class="token namespace">launcher:</span>packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.chrome<span class="token punctuation">"</span></span> 
                <span class="token attr-name"><span class="token namespace">launcher:</span>className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.apps.chrome.Main<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> 
                <span class="token attr-name"><span class="token namespace">launcher:</span>packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.gm<span class="token punctuation">"</span></span>
                <span class="token attr-name"><span class="token namespace">launcher:</span>className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.gm.ConversationListActivityGmail<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>folder</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resolve</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!--定义一个普通应用程序快捷方式--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resolve</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.vending<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.vending.AssetBrowserActivity<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resolve</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!--定义一个shortcut链接--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resolve</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>shortcut</span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/google<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/google<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>uri</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.baidu.com<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resolve</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>favorites</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><strong>注意</strong>：这些属性并不都是resolve标签支持的，大多数的属性可以写在resolve标签中，也可以写在子标签中，但是对于uri、packageName、className等几个特殊的属性，只能写在对应的子标签内。</p> 
<p>除了上面的方式，还可以使用GMS中的配置文件来处理（前提是项目是有<strong>嵌入GMS框架</strong>）。在google_gms包下的配置文件<strong>release\vendor\partner_gms\apps\GmsSampleIntegration\res_dhs_full\xml\partner_default_layout.xml</strong>（下面是我项目中改的示例）：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token comment">&lt;!-- Copyright (C) 2017 Google Inc. All Rights Reserved. --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorites</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--定义应用文件夹--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>folder</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/google_folder_title<span class="token punctuation">"</span></span> <span class="token attr-name">screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.googlequicksearchbox<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.googlequicksearchbox.SearchActivity<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.chrome<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.apps.chrome.Main<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.gm<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.gm.ConversationListActivityGmail<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.apps.maps<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.maps.MapsActivity<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.youtube<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.youtube.app.honeycomb.Shell$HomeActivity<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.apps.docs<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.apps.docs.app.NewMainProxyActivity<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.apps.youtube.music<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.apps.youtube.music.activities.MusicActivity<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.videos<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.videos.GoogleTvEntryPoint<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.apps.tachyon<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.apps.tachyon.MainActivity<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.apps.photos<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.apps.photos.home.HomeActivity<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>folder</span><span class="token punctuation">&gt;</span></span>
  
    <span class="token comment">&lt;!--添加应用--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.vending<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.vending.AssetBrowserActivity<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

	<span class="token comment">&lt;!--添加组件--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appwidget</span> <span class="token attr-name">screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.deskclock<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.alarmclock.DigitalAppWidgetProvider<span class="token punctuation">"</span></span> <span class="token attr-name">spanX</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span> <span class="token attr-name">spanY</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    
	<span class="token comment">&lt;!-- Hotseat (We use the screen as the position of the item in the hotseat) --&gt;</span>
    <span class="token comment">&lt;!-- 定义桌面的hotSeat显示的应用，本项目中已经设定不显示HotSeat，所以下面的代码设置也不起作用 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">container</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-101<span class="token punctuation">"</span></span> <span class="token attr-name">screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.dialer<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.dialer.extensions.GoogleDialtactsActivity<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">container</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-101<span class="token punctuation">"</span></span> <span class="token attr-name">screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.apps.messaging<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.apps.messaging.ui.ConversationListActivity<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">container</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-101<span class="token punctuation">"</span></span> <span class="token attr-name">screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.settings<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.settings.Settings<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">container</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-101<span class="token punctuation">"</span></span> <span class="token attr-name">screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.deskclock<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.deskclock.DeskClock<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">container</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-101<span class="token punctuation">"</span></span> <span class="token attr-name">screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.calendar<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.calendar.event.LaunchInfoActivity<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">container</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-101<span class="token punctuation">"</span></span> <span class="token attr-name">screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.contacts<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.contacts.activities.PeopleActivity<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">container</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-101<span class="token punctuation">"</span></span> <span class="token attr-name">screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.camera2<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.camera.CameraLauncher<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>favorites</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>上面文件有几个属性参数解析一下：</p> 
<ul><li>folder标签表示文件夹；</li><li>favorite标签表示应用；</li><li>appwidget表示组件；</li><li>container表示放置的位置或区域，-101表示hotseat；-100代表是desktop；container=正数，则代表App shortcut；</li><li>screen表示位于第几页屏幕，0表示第一页；</li><li>x表示x轴方向的位置（从左到右，从0开始）；</li><li>y表示y轴方向的位置（从上往下，从0开始）；</li><li>packageName表示应用或组件的包名；</li><li>className表示应用或组件对应的Activity或AppWidgetProvider；</li><li>spanX表示x轴方向占用的格子数；</li><li>spanY表示y轴方向占用的格子数</li></ul> 
<p>在partner_default_layout.xml中改动效果如下：</p> 
<p><img src="https://images2.imgbox.com/ca/a5/9RVnesJK_o.png" alt="在这里插入图片描述"></p> 
<p><mark>注意</mark>：如果你修改了布局文件，但是重新编译后运行模拟器，发现桌面应用并没有改变，有可能是launcher3的database没有更新，因为这些布局文件的内容，在launcher第一次开机启动时会创建database并保存数据到其中，后续有使用直接从db读取，而不用重复读布局文件</p> 
<pre><code class="prism language-shell"><span class="token comment"># 恢复默认布局</span>
adb root
adb shell <span class="token function">rm</span> /data/data/com.android.launcher3/databases/launcher.db
<span class="token comment"># 实测我这里使用的是6x5布局，所以db文件是：launcher_6_by_5.db</span>
<span class="token comment"># 重启模拟器即可生效</span>
</code></pre> 
<h4><a id="_799"></a><strong>修改谷歌搜索框</strong></h4> 
<p>​ 如果要修改搜索框占用格子的宽度，可以在<strong>Launcher3\res\xml\device_profiles.xml</strong>文件里面，对应的尺寸布局中修改<strong>numSearchContainerColumns</strong>的值：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profiles</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>launcher</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>grid-option</span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6_by_5<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numRows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>7<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numSearchContainerColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span>
        <span class="token attr-name">...</span><span class="token punctuation">/&gt;</span></span>
/&gt;
</code></pre> 
<p>我在6x5的布局（实际上是后7x6）中将谷歌搜索框的宽度改成了5，即在x轴方向上，占用五个格子。</p> 
<p>接下来是修改谷歌搜索框的位置：在<strong>workspace.java</strong>的<strong>bindAndInitFirstWorkspaceScreen</strong>()方法中:</p> 
<pre><code class="prism language-java"><span class="token comment">// Launcher3/src/com/android/launcher3/Workspace.java</span>
<span class="token comment">/**
 * Initializes and binds the first page
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bindAndInitFirstWorkspaceScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">FeatureFlags</span><span class="token punctuation">.</span><span class="token constant">QSB_ON_FIRST_SCREEN</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Add the first page</span>
    <span class="token class-name">CellLayout</span> firstPage <span class="token operator">=</span> <span class="token function">insertNewWorkspaceScreen</span><span class="token punctuation">(</span><span class="token class-name">Workspace</span><span class="token punctuation">.</span><span class="token constant">FIRST_SCREEN_ID</span><span class="token punctuation">,</span> <span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Always add a first page pinned widget on the first screen.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mFirstPagePinnedItem <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mFirstPagePinnedItem <span class="token operator">=</span> <span class="token class-name">LayoutInflater</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>search_container_workspace<span class="token punctuation">,</span> firstPage<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 先获取device_profiles.xml中定义的numSearchContainerColumns值</span>
    <span class="token keyword">int</span> cellHSpan <span class="token operator">=</span> mLauncher<span class="token punctuation">.</span><span class="token function">getDeviceProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>inv<span class="token punctuation">.</span>numSearchContainerColumns<span class="token punctuation">;</span>
    <span class="token comment">// 在这里修改搜索框的位置，五个参数分别代表：x坐标、y坐标，占用宽度、占用高度、屏幕id</span>
    <span class="token comment">// 所以这里效果是：在第一个CellLayout的第二列第三行（xy都是从0开始算的）添加谷歌搜索框，宽度为5个格子，高度为1个格子</span>
    <span class="token class-name">CellLayoutLayoutParams</span> lp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CellLayoutLayoutParams</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> cellHSpan<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token constant">FIRST_SCREEN_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    lp<span class="token punctuation">.</span>canReorder <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">// 将谷歌搜索框添加到布局中，最后一个参数是代表是否可移动的意思</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>firstPage<span class="token punctuation">.</span><span class="token function">addViewToCellLayout</span><span class="token punctuation">(</span>
            mFirstPagePinnedItem<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>search_container_workspace<span class="token punctuation">,</span> lp<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">"Failed to add to item at (0, 0) to CellLayout"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mFirstPagePinnedItem <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>另外：还要在LoaderCursor.java的<strong>checkItemPlacement(</strong>)方法中修改搜索框对位置的占用效果：</p> 
<pre><code class="prism language-java"><span class="token comment">// Launcher3/src/com/android/launcher3/model/LoaderCursor.java</span>
<span class="token comment">/**
 * check &amp; update map of what's occupied; used to discard overlapping/invalid items
 */</span>
<span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">checkItemPlacement</span><span class="token punctuation">(</span><span class="token class-name">ItemInfo</span> item<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> containerIndex <span class="token operator">=</span> item<span class="token punctuation">.</span>screenId<span class="token punctuation">;</span>
	<span class="token comment">// ...</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>occupied<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>screenId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">GridOccupancy</span> screen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GridOccupancy</span><span class="token punctuation">(</span>countX <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> countY <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>screenId <span class="token operator">==</span> <span class="token class-name">Workspace</span><span class="token punctuation">.</span><span class="token constant">FIRST_SCREEN_ID</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">FeatureFlags</span><span class="token punctuation">.</span><span class="token constant">QSB_ON_FIRST_SCREEN</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">int</span> spanX <span class="token operator">=</span> mIDP<span class="token punctuation">.</span>numSearchContainerColumns<span class="token punctuation">;</span>
            <span class="token keyword">int</span> spanY <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token comment">// 这里需要跟WorkSpace.java中设置的搜索框位置保持一致</span>
            screen<span class="token punctuation">.</span><span class="token function">markCells</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> spanX<span class="token punctuation">,</span> spanY<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        occupied<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>screenId<span class="token punctuation">,</span> screen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">final</span> <span class="token class-name">GridOccupancy</span> occupancy <span class="token operator">=</span> occupied<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>screenId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Check if any workspace icons overlap with each other</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>occupancy<span class="token punctuation">.</span><span class="token function">isRegionVacant</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>cellX<span class="token punctuation">,</span> item<span class="token punctuation">.</span>cellY<span class="token punctuation">,</span> item<span class="token punctuation">.</span>spanX<span class="token punctuation">,</span> item<span class="token punctuation">.</span>spanY<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        occupancy<span class="token punctuation">.</span><span class="token function">markCells</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">"Error loading shortcut "</span> <span class="token operator">+</span> item
                <span class="token operator">+</span> <span class="token string">" into cell ("</span> <span class="token operator">+</span> containerIndex <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>screenId <span class="token operator">+</span> <span class="token string">":"</span>
                <span class="token operator">+</span> item<span class="token punctuation">.</span>cellX <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>cellX <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>spanX <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>spanY
                <span class="token operator">+</span> <span class="token string">") already occupied"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>​ 如果只修改WorkSpace、而没有修改LoaderCursor中的代码，那么搜索框原本的布局(默认位置是x=0，y=0)占用效果会一直存在，导致后面一些应用或者组件无法放置在首页的首行位置。</p> 
<p><mark>注意</mark>：Workspace.java的bindAndInitFirstWorkspaceScreen方法不仅是设定谷歌搜索框位置的关键代码，也是控制了<strong>谷歌搜索框是否显示</strong>，如果不需要显示谷歌搜索框，可以将上面代码注释：</p> 
<pre><code class="prism language-java"><span class="token comment">// Launcher3/src/com/android/launcher3/Workspace.java</span>
<span class="token comment">/**
 * Initializes and binds the first page
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bindAndInitFirstWorkspaceScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">FeatureFlags</span><span class="token punctuation">.</span><span class="token constant">QSB_ON_FIRST_SCREEN</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 注意要保留这一行，否则会报错</span>
    <span class="token class-name">CellLayout</span> firstPage <span class="token operator">=</span> <span class="token function">insertNewWorkspaceScreen</span><span class="token punctuation">(</span><span class="token class-name">Workspace</span><span class="token punctuation">.</span><span class="token constant">FIRST_SCREEN_ID</span><span class="token punctuation">,</span> <span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token comment">//        if (mFirstPagePinnedItem == null) {<!-- --></span>
<span class="token comment">//            mFirstPagePinnedItem = LayoutInflater.from(getContext())</span>
<span class="token comment">//                    .inflate(R.layout.search_container_workspace, firstPage, false);</span>
<span class="token comment">//        }</span>
<span class="token comment">//</span>
<span class="token comment">//        int cellHSpan = mLauncher.getDeviceProfile().inv.numSearchContainerColumns;</span>
<span class="token comment">//        CellLayoutLayoutParams lp = new CellLayoutLayoutParams(1, 2, cellHSpan, 1, FIRST_SCREEN_ID);</span>
<span class="token comment">//        lp.canReorder = false;</span>
<span class="token comment">//        if (!firstPage.addViewToCellLayout(</span>
<span class="token comment">//                mFirstPagePinnedItem, 0, R.id.search_container_workspace, lp, true)) {<!-- --></span>
<span class="token comment">//            Log.e(TAG, "Failed to add to item at (0, 0) to CellLayout");</span>
<span class="token comment">//            mFirstPagePinnedItem = null;</span>
<span class="token comment">//        }</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>除了通过Java文件配置谷歌搜索框之外，也可以通过XML文件来配置谷歌搜索框，主要是在<strong>default_workspace.xml</strong>或<strong>partner_default_layout.xml</strong>中进行配置。如果项目有配置GMS框架，那么会读取partner_default_layout.xml文件中的配置，否则会读取default_workspace.xml的配置。</p> 
<p>先在<strong>device_profiles.xml</strong>文件里面定义桌面的行列数：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profiles</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>launcher</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>grid-option</span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6_by_5<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numRows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>7<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numSearchContainerColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span>
        <span class="token attr-name">...</span><span class="token punctuation">/&gt;</span></span>
/&gt;
</code></pre> 
<p>​ 这里定义的app分布布局是六行七列。然后根据系统是否会读取partner_default_layout.xml布局文件来决定修改的位置：</p> 
<p><mark>注意</mark>：使用xml配置时，需要先将Java代码中配置谷歌搜索框的代码（Workspace.java和LoaderCursor.java）注释掉，避免相互影响。</p> 
<pre><code class="prism language-java"><span class="token comment">// Launcher3/src/com/android/launcher3/Workspace.java</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bindAndInitFirstWorkspaceScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">FeatureFlags</span><span class="token punctuation">.</span><span class="token constant">QSB_ON_FIRST_SCREEN</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 注意要保留这一行，否则会报错</span>
    <span class="token class-name">CellLayout</span> firstPage <span class="token operator">=</span> <span class="token function">insertNewWorkspaceScreen</span><span class="token punctuation">(</span><span class="token class-name">Workspace</span><span class="token punctuation">.</span><span class="token constant">FIRST_SCREEN_ID</span><span class="token punctuation">,</span> <span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token comment">//        if (mFirstPagePinnedItem == null) {<!-- --></span>
<span class="token comment">//            mFirstPagePinnedItem = LayoutInflater.from(getContext())</span>
<span class="token comment">//                    .inflate(R.layout.search_container_workspace, firstPage, false);</span>
<span class="token comment">//        }</span>
<span class="token comment">//</span>
<span class="token comment">//        int cellHSpan = mLauncher.getDeviceProfile().inv.numSearchContainerColumns;</span>
<span class="token comment">//        CellLayoutLayoutParams lp = new CellLayoutLayoutParams(1, 2, cellHSpan, 1, FIRST_SCREEN_ID);</span>
<span class="token comment">//        lp.canReorder = false;</span>
<span class="token comment">//        if (!firstPage.addViewToCellLayout(</span>
<span class="token comment">//                mFirstPagePinnedItem, 0, R.id.search_container_workspace, lp, true)) {<!-- --></span>
<span class="token comment">//            Log.e(TAG, "Failed to add to item at (0, 0) to CellLayout");</span>
<span class="token comment">//            mFirstPagePinnedItem = null;</span>
<span class="token comment">//        }</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token comment">// Launcher3/src/com/android/launcher3/model/LoaderCursor.java</span>
<span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">checkItemPlacement</span><span class="token punctuation">(</span><span class="token class-name">ItemInfo</span> item<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> containerIndex <span class="token operator">=</span> item<span class="token punctuation">.</span>screenId<span class="token punctuation">;</span>
	<span class="token comment">// ...</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>occupied<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>screenId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">GridOccupancy</span> screen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GridOccupancy</span><span class="token punctuation">(</span>countX <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> countY <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 注释下面if中的内容</span>
<span class="token comment">//            if (item.screenId == Workspace.FIRST_SCREEN_ID &amp;&amp; FeatureFlags.QSB_ON_FIRST_SCREEN) {<!-- --></span>
<span class="token comment">//                // Mark the first X columns (X is width of the search container) in the first row as</span>
<span class="token comment">//                // occupied (if the feature is enabled) in order to account for the search</span>
<span class="token comment">//                // container.</span>
<span class="token comment">//                int spanX = mIDP.numSearchContainerColumns;</span>
<span class="token comment">//                int spanY = 1;</span>
<span class="token comment">//                screen.markCells(1, 2, spanX, spanY, true);</span>
<span class="token comment">//            }</span>
        occupied<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>screenId<span class="token punctuation">,</span> screen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">final</span> <span class="token class-name">GridOccupancy</span> occupancy <span class="token operator">=</span> occupied<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>screenId<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Check if any workspace icons overlap with each other</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>occupancy<span class="token punctuation">.</span><span class="token function">isRegionVacant</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>cellX<span class="token punctuation">,</span> item<span class="token punctuation">.</span>cellY<span class="token punctuation">,</span> item<span class="token punctuation">.</span>spanX<span class="token punctuation">,</span> item<span class="token punctuation">.</span>spanY<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        occupancy<span class="token punctuation">.</span><span class="token function">markCells</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">"Error loading shortcut "</span> <span class="token operator">+</span> item
                <span class="token operator">+</span> <span class="token string">" into cell ("</span> <span class="token operator">+</span> containerIndex <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>screenId <span class="token operator">+</span> <span class="token string">":"</span>
                <span class="token operator">+</span> item<span class="token punctuation">.</span>cellX <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>cellX <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>spanX <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> item<span class="token punctuation">.</span>spanY
                <span class="token operator">+</span> <span class="token string">") already occupied"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>（1）如果适配了GMS框架并读取partner_default_layout.xml布局文件，则在google_gms包下的<strong>release\vendor\partner_gms\apps\GmsSampleIntegration\res_dhs_full\xml\partner_default_layout.xml</strong>里面定义应用的包名和类型以及位置信息,例如</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token comment">&lt;!-- Copyright (C) 2017 Google Inc. All Rights Reserved. --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorites</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--其他配置--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appwidget</span> <span class="token attr-name">screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.googlequicksearchbox<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.alarmclock.DigitalAppWidgetProvider<span class="token punctuation">"</span></span> <span class="token attr-name">spanX</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span> <span class="token attr-name">spanY</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>favorites</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>（2）如果不读取partner_default_layout.xml布局文件，则在对应的default_workspace_MxN.xml里面修改应用的位置（MN分别代表行列数）：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorites</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>launcher</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto/com.android.launcher3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--其他配置--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resolve</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>search</span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>spanX</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>spanY</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.googlequicksearchbox<span class="token punctuation">"</span></span>
            <span class="token attr-name"><span class="token namespace">launcher:</span>className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.googlequicksearchbox.SearchWidgetProvider<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resolve</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>favorites</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>通过XML配置出来的效果和在Java代码中配置的一样，这里就不贴图了。</p> 
<h4><a id="_1039"></a>修改主页应用、组件</h4> 
<p>​ 和谷歌搜索框的改动一样，也是先在<strong>device_profiles.xml</strong>文件里面定义桌面的行列数：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profiles</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>launcher</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>grid-option</span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6_by_5<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numRows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>7<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>numSearchContainerColumns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span>
        <span class="token attr-name">...</span><span class="token punctuation">/&gt;</span></span>
/&gt;
</code></pre> 
<p>​ 这里定义的app分布布局是六行七列。然后根据系统是否会读取partner_default_layout.xml布局文件来决定修改的位置：</p> 
<p>（1）如果读取partner_default_layout.xml布局文件，则在partner_default_layout.xml里面定义应用的包名和类型以及位置信息,例如</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span> <span class="token attr-name">screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span> <span class="token attr-name">packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.vending<span class="token punctuation">"</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.vending.AssetBrowserActivity<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token comment">&lt;!--表示在screen=“0”（第一屏）的第3列格子，第4行格子添加谷歌商店app。--&gt;</span>
</code></pre> 
<p>（2）如果不读取partner_default_layout.xml布局文件，则在对应的default_workspace_MxN.xml里面修改应用的位置（MN分别代表行列数）：</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--定义一个普通应用程序快捷方式--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resolve</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>favorite</span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>screen</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>packageName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.vending<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">launcher:</span>className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.android.vending.AssetBrowserActivity<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resolve</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>由于个人能力有限，上面的分析和讲解难免有错漏之处，欢迎各位批评指正；欢迎大家相互交流学习，一起进步，共勉！！！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c176845377607b31628795132557a3c5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mysql8.3.0排序导致分页数据错乱</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3fa343c34c4c535b8fe72c8148a0657b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java中nginx负载均衡配置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>