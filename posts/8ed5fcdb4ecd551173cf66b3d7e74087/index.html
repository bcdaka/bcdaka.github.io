<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>微信小程序之使用上拉加载实现图片懒加载 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/8ed5fcdb4ecd551173cf66b3d7e74087/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="微信小程序之使用上拉加载实现图片懒加载">
  <meta property="og:description" content="在微信小程序中，有2个事件，相信大家都很熟悉
下拉重新加载
上拉加载更多
事件是这么个事件，至于事件触发后干嘛，那就看代码了
首先要在对应得地方xxxxpage.json打开这个
&#34;onReachBottomDistance&#34;: 100 至于这个值100还是多少要看你的实际情况，为了不让用户看到默认的框框啥的，应该是设置大一些！
xxxpage.js中
onReachBottom(){ //组件的class=&#34;lazyimage&#34; var child =this.selectComponent(&#39;.lazyimage&#39;); if(child){ child.onScrollIndex();//告知懒加载组件，触发了上拉触底事件 }else{ console.log(this); } } 然后就是我们的组件代码了 比如命名为lazyimage
lazyimage.js
// components/goodsParse/goodsParse.js Component({ /** * 组件的属性列表 */ properties: { parseData: { type: Array, value: [] }, param: { type: String }, scrollindex:{ type:Number, value:0, default:0 }, lazyload:{ type:Boolean, value:false } }, /** * 组件的初始数据 */ data: { imageCount: 0, imagedatas:[], loadcount:0, current_load_height:0,//本次渲染的图片的总高度 如果本次渲染的总高度不足1500 则会再次渲染per_load_count current_loaded_ok:false,//本次是否渲染完成 per_load_min_height:1500,//每次至少渲染多少高度 per_load_count:3//每次渲染的张数，如果渲染的总高度不足，会继续渲染 }, /** * 组件的方法列表 */ methods: { handleImgtap() { }, onImageLoad(e) { this.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-10T18:53:50+08:00">
    <meta property="article:modified_time" content="2024-07-10T18:53:50+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">微信小程序之使用上拉加载实现图片懒加载</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在微信小程序中，有2个事件，相信大家都很熟悉<br> 下拉重新加载<br> 上拉加载更多<br> 事件是这么个事件，至于事件触发后干嘛，那就看代码了<br> 首先要在对应得地方xxxxpage.json打开这个</p> 
<pre><code class="prism language-javascript">  <span class="token string-property property">"onReachBottomDistance"</span><span class="token operator">:</span> <span class="token number">100</span>
</code></pre> 
<p>至于这个值100还是多少要看你的实际情况，为了不让用户看到默认的框框啥的，应该是设置大一些！<br> xxxpage.js中</p> 
<pre><code class="prism language-javascript">  <span class="token function">onReachBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token comment">//组件的class="lazyimage"</span>
    <span class="token keyword">var</span> child <span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">selectComponent</span><span class="token punctuation">(</span><span class="token string">'.lazyimage'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      child<span class="token punctuation">.</span><span class="token function">onScrollIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//告知懒加载组件，触发了上拉触底事件</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> 
<p>然后就是我们的组件代码了 比如命名为lazyimage<br> lazyimage.js</p> 
<pre><code class="prism language-javascript"><span class="token comment">// components/goodsParse/goodsParse.js</span>
<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>

  <span class="token comment">/**
   * 组件的属性列表
   */</span>
  <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">parseData</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Array<span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">param</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> String
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">scrollindex</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">type</span><span class="token operator">:</span>Number<span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span><span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">lazyload</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">type</span><span class="token operator">:</span>Boolean<span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token boolean">false</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 组件的初始数据
   */</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">imageCount</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">imagedatas</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">loadcount</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token literal-property property">current_load_height</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//本次渲染的图片的总高度 如果本次渲染的总高度不足1500 则会再次渲染per_load_count</span>
    <span class="token literal-property property">current_loaded_ok</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token comment">//本次是否渲染完成</span>
    <span class="token literal-property property">per_load_min_height</span><span class="token operator">:</span><span class="token number">1500</span><span class="token punctuation">,</span><span class="token comment">//每次至少渲染多少高度</span>
    <span class="token literal-property property">per_load_count</span><span class="token operator">:</span><span class="token number">3</span><span class="token comment">//每次渲染的张数，如果渲染的总高度不足，会继续渲染</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/**
   * 组件的方法列表
   */</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">handleImgtap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onImageLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageCount <span class="token operator">++</span>
      <span class="token comment">//又不用渲染UI 所以下面的代码没必要</span>
      <span class="token comment">// this.setData({<!-- --></span>
      <span class="token comment">//   imageCount: this.data.imageCount</span>
      <span class="token comment">// })</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          <span class="token comment">//本张图片渲染的高度</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>current_load_height<span class="token operator">+=</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>lazyload<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token comment">//本次懒加载的图片已经加载完成了</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageCount <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loadcount<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>current_loaded_ok<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">triggerEvent</span><span class="token punctuation">(</span><span class="token string">'onImageLoad'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageCount<span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token comment">//未完待续 如果还可以继续加载，如果刚刚加载的总高度小于屏幕的总高度，则继续贪婪加载</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>current_load_height<span class="token operator">&lt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>per_load_min_height<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
           <span class="token comment">//本次渲染的高度太小了，看看是否可以继续渲染，再次渲染3张</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadNext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>per_load_count<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//非懒加载</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageCount <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imagedatas<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">triggerEvent</span><span class="token punctuation">(</span><span class="token string">'onImageLoad'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>


      <span class="token comment">//如果渲染不够，还可以继续渲染</span>
      <span class="token comment">// console.log(e);//可以通过e来计算本次加载是否足够，不够的话补足剩余的数量</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">loadNext</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loadcount<span class="token operator">&lt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imagedatas<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//渲染接下来的N个？</span>
        <span class="token keyword">var</span> _max <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imagedatas<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loadcount<span class="token operator">&lt;</span><span class="token punctuation">(</span>_max<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>current_load_height<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
          <span class="token keyword">var</span> _temptop <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loadcount<span class="token operator">+</span>num<span class="token punctuation">,</span><span class="token punctuation">(</span>_max<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// console.log('loadcount',this.data.loadcount,'images',this.data.imagedatas.length,'temp',_temptop);</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>_temptop<span class="token operator">&gt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loadcount<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> _new_array<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> _datas <span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imagedatas<span class="token punctuation">;</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> k<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loadcount<span class="token punctuation">;</span>k<span class="token operator">&lt;</span>_temptop<span class="token punctuation">;</span>k<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
              <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imagedatas<span class="token punctuation">.</span>length<span class="token operator">&gt;</span>k<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                _new_array<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
                  <span class="token punctuation">{<!-- --></span>
                    <span class="token literal-property property">vkey</span><span class="token operator">:</span><span class="token string">'imagedatas['</span><span class="token operator">+</span>k<span class="token operator">+</span><span class="token string">'].src'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">src</span><span class="token operator">:</span>_datas<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>presrc
                  <span class="token punctuation">}</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>_new_array<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
              <span class="token keyword">var</span> _obj<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
              <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> ii <span class="token keyword">of</span> _new_array<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                _obj<span class="token punctuation">[</span>ii<span class="token punctuation">.</span>vkey<span class="token punctuation">]</span><span class="token operator">=</span>ii<span class="token punctuation">.</span>src
              <span class="token punctuation">}</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>_obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
              <span class="token comment">// console.log('set new images src!');</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loadcount <span class="token operator">=</span> _temptop<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onScrollIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token comment">//这个函数是给外部调用的，一般发生在上拉触底(要基于实际去设定这个高度值)的时候</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imagedatas<span class="token punctuation">.</span>length <span class="token operator">==</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loadcount<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// console.log('已经全部完成渲染，无法继续执行更多的懒加载');</span>
        <span class="token comment">//已经全部懒加载完成，不需要继续加载了</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>current_loaded_ok<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// console.log('上一次的渲染未完成··· ·· ·');</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// console.log('parent`s scroll-view scroll to lower!');</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageCount<span class="token operator">&lt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loadcount<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// console.log('之前加载的图片还未完全加载完成');</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadNext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>per_load_count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">requireLoadAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token comment">//父级页面要求加载全部</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loadcount <span class="token operator">!=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imagedatas<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> _n <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imagedatas<span class="token punctuation">.</span>length<span class="token operator">-</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loadcount<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_n<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>current_loaded_ok<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// console.log('上一次的渲染未完成··· ·· ·');</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// console.log('parent`s scroll-view scroll to lower!');</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageCount<span class="token operator">&lt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loadcount<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">// console.log('之前加载的图片还未完全加载完成');</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadNext</span><span class="token punctuation">(</span>_n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">attached</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// console.log('load goods-parse attached!');</span>
    <span class="token keyword">var</span> _lazyload<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>lazyload<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>parseData<span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>parseData<span class="token punctuation">.</span>length<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token keyword">var</span> _imgarray<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> _i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> img <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>parseData<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        _i <span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>_i<span class="token operator">&lt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>per_load_count <span class="token operator">||</span> <span class="token operator">!</span>_lazyload<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        _imgarray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">src</span><span class="token operator">:</span>img<span class="token punctuation">,</span>
          <span class="token literal-property property">presrc</span><span class="token operator">:</span>img
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        _imgarray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">src</span><span class="token operator">:</span><span class="token keyword">null</span><span class="token punctuation">,</span>
          <span class="token literal-property property">presrc</span><span class="token operator">:</span>img
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loadcount <span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>per_load_count<span class="token punctuation">;</span><span class="token comment">//当前有渲染的序号</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">imagedatas</span><span class="token operator">:</span>_imgarray
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_imgarray<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>对应的lazyimage.wxml代码如下(这个看你的实际情况修改)</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parse_box<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>u-padding-top-10<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">font-size</span><span class="token punctuation">:</span>0px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{<!-- -->{parseData}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{<!-- -->{imagedatas}}<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for-item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>for-index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>block</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{<!-- -->{item.src}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>parse_image<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>{<!-- -->{item.src}}<span class="token punctuation">"</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>widthFix<span class="token punctuation">"</span></span> <span class="token attr-name">bindload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onImageLoad<span class="token punctuation">"</span></span> <span class="token attr-name">binderror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onImageLoad<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>block</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>至于样式就不贴了！<br> 这个组件适用于单图横向100vw的模式，比如商品的图片列表纵向显示<br> 关键点在于<br> 图片数据是parseData<br> 比如:<br> [“https://xxx.jpg”,“https://xxx.jpg”]<br> 转化成imagedatas<br> 比如<br> [{<!-- --><br> presrc:“”,<br> src:null<br> }]<br> 除了一开始的数量设置src为对应的图片地址，后面的都是设置null<br> 然后在上拉触底事件触发的时候，再把后面的图片对象设置src=presrc！</p> 
<p>然后就是高度的判断，有可能比如你配置每次加载3张图，如果这三张图的高度不够一屏，那体验上用户就能看到图片还在加载了！<br> 所以代码上做了一个贪婪模式，就是图片load后，去计算本次加载的总高度，是否满足，不够的话再多懒加载一次！<br> 看函数代码</p> 
<pre><code class="prism language-javascript"> <span class="token function">onImageLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageCount <span class="token operator">++</span>
      <span class="token comment">//又不用渲染UI 所以下面的代码没必要</span>
      <span class="token comment">// this.setData({<!-- --></span>
      <span class="token comment">//   imageCount: this.data.imageCount</span>
      <span class="token comment">// })</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          <span class="token comment">//本张图片渲染的高度</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>current_load_height<span class="token operator">+=</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>lazyload<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token comment">//本次懒加载的图片已经加载完成了</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageCount <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>loadcount<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>current_loaded_ok<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">triggerEvent</span><span class="token punctuation">(</span><span class="token string">'onImageLoad'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageCount<span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token comment">//未完待续 如果还可以继续加载，如果刚刚加载的总高度小于屏幕的总高度，则继续贪婪加载</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>current_load_height<span class="token operator">&lt;</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>per_load_min_height<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
           <span class="token comment">//本次渲染的高度太小了，看看是否可以继续渲染，再次渲染3张</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadNext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>per_load_count<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//非懒加载</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageCount <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imagedatas<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">triggerEvent</span><span class="token punctuation">(</span><span class="token string">'onImageLoad'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>imageCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>


      <span class="token comment">//如果渲染不够，还可以继续渲染</span>
      <span class="token comment">// console.log(e);//可以通过e来计算本次加载是否足够，不够的话补足剩余的数量</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a20f412b76c2a52191a7468f0eb468c3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">掌握Perl的文件系统钩子：深度集成的艺术</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5afc0b436b6137399063d56bfd96a2d0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【从零开始实现stm32无刷电机FOC】【理论】【3/6 位置、速度、电流控制】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>