<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>M0G3507完美移植江科大软件IIC MPU6050 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/d82e24942b064d698e5b663861766337/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="M0G3507完美移植江科大软件IIC MPU6050">
  <meta property="og:description" content="经过两天两夜的查阅文献资料、整理学习，成功的把江科大的软件IIC读写MPU6050移植到MSPM0G3507，亲测有效！！包的，为了让大家直观地感受下，先上图。记得点个赞哦！
学过江科大的STM32的小伙伴是不是觉得这个画面非常熟悉，在这里我选的是满量程为16g，且陀螺仪水平放置，根据Z轴的读数可以计算出当地的重力加速度值，计算公式为读数（X/2^15）*16，即1963/32768*16=0.96。
思路讲解 1.软硬件型号
选择CCS theia进行M0G3507的开发，显示屏为0.96寸4引脚OLED显示屏，陀螺仪选择常见的MPU6050,GY-521模块。
2.软件IIC时序模拟
//IIC写SDA引脚 void MyI2C_W_SDA(uint8_t BitValue) { SDA_ON(); if(BitValue) DL_GPIO_setPins(GPIO_sda_PORT, GPIO_sda_PIN_0_PIN); else DL_GPIO_clearPins(GPIO_sda_PORT, GPIO_sda_PIN_0_PIN); Delay_us(8);	//延时8us，防止时序频率超过要求 } //IIC写SCL引脚 void MyI2C_W_SCL(uint8_t BitValue) { if(BitValue) DL_GPIO_setPins(GPIO_scl_PORT, GPIO_scl_PIN_1_PIN); else DL_GPIO_clearPins(GPIO_scl_PORT, GPIO_scl_PIN_1_PIN); Delay_us(8);	//延时8us，防止时序频率超过要求 } //IIC开始 void MyI2C_Start(void) { SDA_OUT(); MyI2C_W_SDA(1);	//释放SDA，确保SDA为高电平 MyI2C_W_SCL(1);	//释放SCL，确保SCL为高电平 MyI2C_W_SDA(0);	//在SCL高电平期间，拉低SDA，产生起始信号 MyI2C_W_SCL(0);	//起始后拉低SCL，为了占用总线，方便总线时序的拼接 } 3.IIC发送一个字节数据
void MyI2C_SendByte(uint8_t Byte) { SDA_ON(); uint8_t i; for (i = 0; i &lt; 8; i &#43;&#43;)	//循环8次，主机依次发送数据的每一位 { MyI2C_W_SDA(Byte &amp; (0x80 &gt;&gt; i));	//使用掩码的方式取出Byte的指定一位数据并写入到SDA线 MyI2C_W_SCL(1);	//释放SCL，从机在SCL高电平期间读取SDA MyI2C_W_SCL(0);	//拉低SCL，主机开始发送下一位数据 } } 4.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-12T23:17:20+08:00">
    <meta property="article:modified_time" content="2024-07-12T23:17:20+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">M0G3507完美移植江科大软件IIC MPU6050</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>经过两天两夜的查阅文献资料、整理学习，成功的把江科大的软件IIC读写MPU6050移植到MSPM0G3507，亲测有效！！包的，为了让大家直观地感受下，先上图。记得点个赞哦！</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/41/46/g5neR0kL_o.jpg"></p> 
<p>学过江科大的STM32的小伙伴是不是觉得这个画面非常熟悉，在这里我选的是满量程为16g，且陀螺仪水平放置，根据Z轴的读数可以计算出当地的重力加速度值，计算公式为读数（X/2^15）*16，即1963/32768*16=0.96。</p> 
<h4>思路讲解</h4> 
<p><strong>1.软硬件型号</strong></p> 
<p>选择CCS theia进行M0G3507的开发，显示屏为0.96寸4引脚OLED显示屏，陀螺仪选择常见的MPU6050,GY-521模块。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/12/c9/XmVMjjUK_o.jpg"></p> 
<p><strong> 2.软件IIC时序模拟</strong></p> 
<pre><code class="language-cpp">//IIC写SDA引脚
void MyI2C_W_SDA(uint8_t BitValue)
{
    SDA_ON();
    if(BitValue)
        DL_GPIO_setPins(GPIO_sda_PORT, GPIO_sda_PIN_0_PIN);
    else
        DL_GPIO_clearPins(GPIO_sda_PORT, GPIO_sda_PIN_0_PIN);
	Delay_us(8);					//延时8us，防止时序频率超过要求
}
//IIC写SCL引脚
void MyI2C_W_SCL(uint8_t BitValue)
{
    if(BitValue)
        DL_GPIO_setPins(GPIO_scl_PORT, GPIO_scl_PIN_1_PIN);
    else
        DL_GPIO_clearPins(GPIO_scl_PORT, GPIO_scl_PIN_1_PIN);
	Delay_us(8);	//延时8us，防止时序频率超过要求
}

//IIC开始
void MyI2C_Start(void)
{
    SDA_OUT();
	MyI2C_W_SDA(1);				//释放SDA，确保SDA为高电平
	MyI2C_W_SCL(1);				//释放SCL，确保SCL为高电平
	MyI2C_W_SDA(0);				//在SCL高电平期间，拉低SDA，产生起始信号
	MyI2C_W_SCL(0);				//起始后拉低SCL，为了占用总线，方便总线时序的拼接
}</code></pre> 
<p><strong> 3.IIC发送一个字节数据</strong></p> 
<pre><code class="language-cpp">void MyI2C_SendByte(uint8_t Byte)
{
    SDA_ON();
	uint8_t i;
	for (i = 0; i &lt; 8; i ++)				//循环8次，主机依次发送数据的每一位
	{
		MyI2C_W_SDA(Byte &amp; (0x80 &gt;&gt; i));	//使用掩码的方式取出Byte的指定一位数据并写入到SDA线
		MyI2C_W_SCL(1);						//释放SCL，从机在SCL高电平期间读取SDA
		MyI2C_W_SCL(0);						//拉低SCL，主机开始发送下一位数据
	}
}</code></pre> 
<h5>4.IIC接收一个字节的数据</h5> 
<pre><code class="language-cpp">uint8_t MyI2C_ReceiveByte(void)
{
    SDA_ON();
	uint8_t i, Byte = 0x00;	//定义接收的数据，并赋初值0x00
	MyI2C_W_SDA(1);			//接收前，主机先确保释放SDA，避免干扰从机的数据发送
	for (i = 0; i &lt; 8; i ++)	//循环8次，主机依次接收数据的每一位
	{
        SDA_OFF();
		MyI2C_W_SCL(1);						//释放SCL，主机机在SCL高电平期间读取SDA
		if (MyI2C_R_SDA() == 1){Byte |= (0x80 &gt;&gt; i);}	//读取SDA数据，并存储到Byte变量
	//当SDA为1时，置变量指定位为1，当SDA为0时，不做处理，指定位为默认的初值0
		MyI2C_W_SCL(0);						//拉低SCL，从机在SCL低电平期间写入SDA
	}
	return Byte;							//返回接收到的一个字节数据
}</code></pre> 
<h5>5.IIC发送应答位</h5> 
<pre><code class="language-cpp">void MyI2C_SendAck(uint8_t AckBit)
{
    SDA_ON();
	MyI2C_W_SDA(AckBit);					//主机把应答位数据放到SDA线
	MyI2C_W_SCL(1);							//释放SCL，从机在SCL高电平期间，读取应答位
	MyI2C_W_SCL(0);							//拉低SCL，开始下一个时序模块
}</code></pre> 
<h5><strong>6.IIC接收应答位</strong></h5> 
<pre><code class="language-cpp">uint8_t MyI2C_ReceiveAck(void)
{
    SDA_ON();
	uint8_t AckBit;							
	MyI2C_W_SDA(1);			//接收前，主机先确保释放SDA，避免干扰从机的数据发送
	MyI2C_W_SCL(1);			//释放SCL，主机机在SCL高电平期间读取SDA
    SDA_OFF();
	AckBit = MyI2C_R_SDA();			
	MyI2C_W_SCL(0);				//拉低SCL，开始下一个时序模块
	return AckBit;				//返回定义应答位变量
}</code></pre> 
<h5>7.MPU6050写数据</h5> 
<pre><code class="language-cpp">void MPU6050_WriteReg(uint8_t RegAddress, uint8_t Data)
{
	MyI2C_Start();						//I2C起始
	MyI2C_SendByte(MPU6050_ADDRESS);	//发送从机地址(0xD0)，读写位为0，表示即将写入
	MyI2C_ReceiveAck();					//接收应答
	MyI2C_SendByte(RegAddress);			//发送寄存器地址
	MyI2C_ReceiveAck();					//接收应答
	MyI2C_SendByte(Data);				//发送要写入寄存器的数据
	MyI2C_ReceiveAck();					//接收应答
	MyI2C_Stop();						//I2C终止
}</code></pre> 
<h5>8.MPU6050读数据</h5> 
<pre><code class="language-cpp">uint8_t MPU6050_ReadReg(uint8_t RegAddress)
{
	uint8_t Data;
	  
	MyI2C_Start();						//I2C起始
	MyI2C_SendByte(MPU6050_ADDRESS);	//发送从机地址，读写位为0，表示即将写入
	MyI2C_ReceiveAck();					//接收应答
	MyI2C_SendByte(RegAddress);			//发送寄存器地址
	MyI2C_ReceiveAck();					//接收应答
	
	MyI2C_Start();						//I2C重复起始
	MyI2C_SendByte(MPU6050_ADDRESS | 0x01);	//发送从机地址，读写位为1，表示即将读取
	MyI2C_ReceiveAck();					//接收应答
	Data = MyI2C_ReceiveByte();			//接收指定寄存器的数据
	MyI2C_SendAck(1);					//发送应答，给从机非应答，终止从机的数据输出
	MyI2C_Stop();						//I2C终止
	
	return Data;
}</code></pre> 
<h5>9.main.c</h5> 
<pre><code class="language-cpp">#include "ti_msp_dl_config.h"
#include "oled.h"
#include "mpu6050.h"
#include "ti/driverlib/dl_gpio.h"
int16_t AX,AY,AZ,GX,GY,GZ;
int main(void)
{
    SYSCFG_DL_init();
    OLED_Init();
    OLED_CLS();
    MPU6050_Init();
    //MPU6050_WriteReg(0x19,0x00);
    while (1)
    {
        MPU6050_GetData(&amp;AX,&amp;AY,&amp;AZ,&amp;GX,&amp;GY,&amp;GZ);
        OLED_ShowString(2,1,"AX:");
		OLED_ShowSignedNum(2,4,AX,4);

        OLED_ShowString(3,1,"AY:");
		OLED_ShowSignedNum(3,4,AY,4);

        OLED_ShowString(4,1,"AZ:");
		OLED_ShowSignedNum(4,4,AZ,4);

        OLED_ShowString(2,9,"GX:");
		OLED_ShowSignedNum(2,12,AX,4);

        OLED_ShowString(3,9,"GY:");
		OLED_ShowSignedNum(3,12,GY,4);

        OLED_ShowString(4,9,"GZ:");
		OLED_ShowSignedNum(4,12,GZ,4);


    }
}
</code></pre> 
<h5>10.总结</h5> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/18/a0/TfAVTOuy_o.png"></p> 
<p>        在syscfg中配置好MPU6050的SDA和SCL引脚，通过软件模拟IIC时序，对MPU6050进行读写操作。作为嵌入式的小伙伴们，都知道MPU6050的重要性，它可以用于飞行控制和姿态稳定，提供的角速度和加速度数据对于无人机的稳定飞行至关重要，能够帮助无人机实现精确的姿态调整和位置控制，在智能小车中，MPU6050可用于检测机器人的姿态和运动状态，帮助机器人实现自主导航和避障。</p> 
<p>        现在比较成功的案例是嘉立创的1306系列的开发板，但是讲解资料少，羞涩难懂，小编这个成功地将江科大讲解的MPU6050移植到M0G3507，视频讲解细致，函数形式和参数通俗易懂，包会的！！需要完整的MPU6050代码可以留言哦，然后可以搭配自己的OLED进行结果的展示，这是小编花了两天多的时间才成功移植，成功地读取到了陀螺仪的六轴数据，接下来就可以进行姿态解算继续完成M0G3507的项目啦！</p> 
<table border="1" cellpadding="1" cellspacing="1" style="width:500px;"><tbody><tr><td style="text-align:center;">MPU6050引脚</td><td style="text-align:center;">M0G3507引脚</td></tr><tr><td style="text-align:center;">GND</td><td style="text-align:center;">GND</td></tr><tr><td style="text-align:center;">SCL</td><td style="text-align:center;">PA9</td></tr><tr><td style="text-align:center;">SDA</td><td style="text-align:center;">PA8</td></tr><tr><td style="text-align:center;">VCC</td><td style="text-align:center;">VCC</td></tr></tbody></table> 
<p>参考资料:<a href="https://www.bilibili.com/video/BV1th411z7sn/" rel="nofollow" title="STM32入门教程-2023版 细致讲解 中文字幕_哔哩哔哩_bilibili">STM32入门教程-2023版 细致讲解 中文字幕_哔哩哔哩_bilibili</a></p> 
<p><a class="link-info" href="https://pan.baidu.com/s/1Ily5YvQrQusHd-tjfEHTBQ?pwd=dogs" rel="nofollow" title="百度网盘，无需密码，配合自己的OLED">百度网盘，无需密码，配合自己的OLED</a></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/46afaebb1bc0bc42ef9f43e22a0437f6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">AI绘画系统课程：从基础入门到商业应用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/84b4dab80b739da686b1b4f475774e4c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">昇思MindSpore学习总结十五 ——基于Mindspore 实现BERT对话情绪识别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>