<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【密码学】使用mkcert安装CA、自签名ssl证书，配置nginx的https 证书笔记 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/a4a0653fbbea08487332e5d14e8cd0e0/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【密码学】使用mkcert安装CA、自签名ssl证书，配置nginx的https 证书笔记">
  <meta property="og:description" content="文章目录 证书（CA证书，服务端证书，客户端证书）1 安装CA1.1 下载mkcert1.2 mkcert安装和配置根证书1.3设备安装根证书 2 自签名ssl证书2.1 CA 证书过程:2.2 自签名流程2.3签发证书2.4给已有的证书请求（.csr）签发证书参考文献 3 配置nginx的https3.1 查看NGINX是否安装SSL模块3.2 配置config文件 证书（CA证书，服务端证书，客户端证书） 1 安装CA CA(Certificate Authority，证书授权)是由认证机构服务者签发，是数字签名的技术基础保障，也是网上实体身份的证明，能够证明某一实体的身份及其公钥的合法性，证明该实体与公钥二者之间的匹配关系。
在电子商务系统中，所有实体的证书都是由证书授权中心即CA中心颁发并签名的。一个完整的、安全的电子商务系统必须建立一个完整的、合理的CA体系。CA体系由证书审批部门和证书操作部门组成。
1.1 下载mkcert mkcert 工具
https://gitee.com/stonedst/mkcert
$ mkcert -install Created a new local CA 💥 The local CA is now installed in the system trust store! ⚡️ The local CA is now installed in the Firefox trust store (requires browser restart)! 🦊 1.2 mkcert安装和配置根证书 首先到github下载mkcert工具，下面我以windows平台作为演示
在cmd中cd到mkcert所在的目录运行下面的命令
.\mkcert.exe -install
这条命令会创建一组根证书和私钥，根证书会被安装到系统中。输入下面的命令就可以查看到ca证书存放的位置。其中“rootCA.pem“就是根证书，有些系统比如windows可能不会认rootCA.pem可以把他改成rootCA.crt。将他发送给需要安装的自定义证书的设备，安装好之后自签名证书就不会显示不安全了。另外rootCA-key.pem是根证书的私钥文件，不可公开需要妥善保管。
.\mkcert.exe -CAROOT 1.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-20T16:14:00+08:00">
    <meta property="article:modified_time" content="2023-12-20T16:14:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【密码学】使用mkcert安装CA、自签名ssl证书，配置nginx的https 证书笔记</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#CA_1" rel="nofollow">证书（CA证书，服务端证书，客户端证书）</a></li><li><a href="#1__CA_3" rel="nofollow">1 安装CA</a></li><li><ul><li><a href="#11_mkcert_9" rel="nofollow">1.1 下载mkcert</a></li><li><a href="#12_mkcert_19" rel="nofollow">1.2 mkcert安装和配置根证书</a></li><li><a href="#13_33" rel="nofollow">1.3设备安装根证书</a></li></ul> 
  </li><li><a href="#2_ssl_54" rel="nofollow">2 自签名ssl证书</a></li><li><ul><li><a href="#21_CA__64" rel="nofollow">2.1 CA 证书过程:</a></li><li><a href="#22__68" rel="nofollow">2.2 自签名流程</a></li><li><a href="#23_75" rel="nofollow">2.3签发证书</a></li><li><a href="#24csr_97" rel="nofollow">2.4给已有的证书请求（.csr）签发证书</a></li><li><a href="#_112" rel="nofollow">参考文献</a></li></ul> 
  </li><li><a href="#3_nginxhttps_117" rel="nofollow">3 配置nginx的https</a></li><li><ul><li><a href="#31_NGINXSSL_118" rel="nofollow">3.1 查看NGINX是否安装SSL模块</a></li><li><a href="#32_config_122" rel="nofollow">3.2 配置config文件</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="CA_1"></a>证书（CA证书，服务端证书，客户端证书）</h2> 
<h2><a id="1__CA_3"></a>1 安装CA</h2> 
<p>CA(Certificate Authority，证书授权)是由认证机构服务者签发，是数字签名的技术基础保障，也是网上实体身份的证明，能够证明某一实体的身份及其公钥的合法性，证明该实体与公钥二者之间的匹配关系。</p> 
<p>在电子商务系统中，所有实体的证书都是由证书授权中心即CA中心颁发并签名的。一个完整的、安全的电子商务系统必须建立一个完整的、合理的CA体系。CA体系由证书审批部门和证书操作部门组成。</p> 
<h3><a id="11_mkcert_9"></a>1.1 下载mkcert</h3> 
<p>mkcert 工具<br> https://gitee.com/stonedst/mkcert</p> 
<pre><code>$ mkcert -install
Created a new local CA 💥
The local CA is now installed in the system trust store! ⚡️
The local CA is now installed in the Firefox trust store (requires browser restart)! 🦊
</code></pre> 
<h3><a id="12_mkcert_19"></a>1.2 mkcert安装和配置根证书</h3> 
<p>首先到github下载mkcert工具，下面我以windows平台作为演示</p> 
<p>在cmd中cd到mkcert所在的目录运行下面的命令</p> 
<blockquote> 
 <p>.\mkcert.exe -install</p> 
</blockquote> 
<p>这条命令会创建一组根证书和私钥，根证书会被安装到系统中。输入下面的命令就可以查看到ca证书存放的位置。其中“rootCA.pem“就是根证书，有些系统比如windows可能不会认rootCA.pem可以把他改成rootCA.crt。将他发送给需要安装的自定义证书的设备，安装好之后自签名证书就不会显示不安全了。另外rootCA-key.pem是根证书的私钥文件，不可公开需要妥善保管。</p> 
<pre><code>.\mkcert.exe -CAROOT
</code></pre> 
<h3><a id="13_33"></a>1.3设备安装根证书</h3> 
<p>1.windows</p> 
<p>直接打开rootCA.crt,并将证书安装到受信任的根证书</p> 
<p>2.安卓</p> 
<p>直接在文件管理器安装rootCA.crt</p> 
<p>3.macos</p> 
<p>直接在文件管理器安装rootCA.crt，然后打开钥匙串-系统找到mkcert开头的证书，双击打开。设置为下图的模式就可以了。</p> 
<p>[<img src="https://images2.imgbox.com/5c/39/S83hCE3e_o.png" alt="使用mkcert免费给群晖创建十年期自签ssl证书"></p> 
<p>4.ios</p> 
<p>ios要先安装ca证书，然后在“设置”——“通用”——“描述文件和设备管理”——验证刚才安装的ca证书。然后在“通用”——“关于本机”——“证书信任设置”信任刚才的ca证书</p> 
<p>mkcert签发自签名证书的教程就已经结束了，rootCA.crt可以保存在一些容易获取到的地方，比如网盘上，这样去到新的地方就可以安装根证书确保访问安全了。而且根证书本身就是公开的，不需担心安全性问题，确保不被篡改就行了。</p> 
<h2><a id="2_ssl_54"></a>2 自签名ssl证书</h2> 
<p>SSL证书一般有如下方法获取：SSL服务商购买、免费SSL服务商通过HTTP验证/API验证、自签SSL证书。</p> 
<p>如果进行自签SSL证书，首先要有一个CA根证书，然后用CA根证书来签发用户证书。</p> 
<p>用户进行证书申请：一般先生成一个私钥，然后用私钥生成证书请求(证书请求里应含有公钥信息)，再利用证书服务器的CA 根证书来签发证书。</p> 
<p>自签可以生成任意域名或IP的SSL证书，只不过是不信任的，需要自行将该CA加入信任。</p> 
<h3><a id="21_CA__64"></a>2.1 CA 证书过程:</h3> 
<blockquote> 
 <p>生成CA私钥（.key）–&gt;生成CA证书请求（.csr）–&gt;自签名得到根证书（.crt）（CA给自已颁发的证书）</p> 
</blockquote> 
<h3><a id="22__68"></a>2.2 自签名流程</h3> 
<blockquote> 
 <p>生成服务端key（.key）–&gt;生成服务端请求文件（.csr）–&gt;生成服务端证书,使用CA根证书签发（.crt）–&gt;生成pem格式证书–&gt;生成p12格式证书</p> 
</blockquote> 
<p>自签SSL一般需要使用openssl命令步骤比较繁琐，今天我们借助mkcert工具来一键生成SSL证书并且信任该CA。</p> 
<h3><a id="23_75"></a>2.3签发证书</h3> 
<p>mkcert签发证书非常的简单，用下列的命令就可以给“192.168.100.100”签发一个ssl证书</p> 
<pre><code>.\mkcert.exe 192.168.100.100
</code></pre> 
<p>当然也可以给域名签发一个ssl证书，比如给*.home.com这个泛解析域名签发ssl证书</p> 
<pre><code>.\mkcert.exe *.home.com
</code></pre> 
<p>也可以给多个域名多个ip签发ssl证书，比如我给*.home.com, *.nas.com, *.Router.com, 192.168.100.100, 10.10.100.100。等三个域名，2个ip签发在同一张ssl证书中。</p> 
<pre><code>.\mkcert.exe *.home.com *.router.com *.nas.com 192.168.100.100 10.10.100.100

.\mkcert.exe *.abiuni.com *.techco.club   8.139.98.150 8.219.252.173
</code></pre> 
<h3><a id="24csr_97"></a>2.4给已有的证书请求（.csr）签发证书</h3> 
<p>如果已有请求文件csr文件和私钥，然后用csr文件给mkcert签发的ssl证书才能使用。<a href="https://post.smzdm.com/p/aeveozgm/pic_4/" rel="nofollow"><img src="https://images2.imgbox.com/65/27/mZmROnOa_o.png" alt="使用mkcert免费给群晖创建十年期自签ssl证书"></a></p> 
<p>把证书下载好后，将server.csr复制到mkcert所在的目录执行下面的命令，就可以根据csr文件签发出ssl证书。</p> 
<pre><code>.\mkcert.exe -csr server.csr
</code></pre> 
<p>将生成的证书和里面的server.key（私钥）一起设置配置好证书的使用就可以了。</p> 
<h3><a id="_112"></a>参考文献</h3> 
<p>https://post.smzdm.com/p/aeveozgm/<br> https://zhuanlan.zhihu.com/p/636932873<br> https://blog.csdn.net/Amorbcbc/article/details/131646799</p> 
<h2><a id="3_nginxhttps_117"></a>3 配置nginx的https</h2> 
<h3><a id="31_NGINXSSL_118"></a>3.1 查看NGINX是否安装SSL模块</h3> 
<p>./nginx -V # 注意，是大写的V，如果有ssl_module那就说明有，没有就自行安装</p> 
<h3><a id="32_config_122"></a>3.2 配置config文件</h3> 
<pre><code>    server {
        listen 443;
        server_name 8.138.98.150;
        ssl on;
        ssl_certificate  /usr/share/nginx/html/card/com.pem;
        ssl_certificate_key /usr/share/nginx/html/card/com.key;

        location / {
           root   /usr/share/nginx/html;
           index  index.html index.htm index.php;
        }

    }
</code></pre> 
<p>重启nginx</p> 
<pre><code class="prism language-c">service nginx reload
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/837048f2be9385f0cf28f1b91db0f7f7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何解决idea创建版本时只有Java21和Java17选项</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0fd8e72a8ca0beb8451e26ded6532a7f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Hadoop集群中如何通过web访问HDFS（以及上传下载测试）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>