<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[Spring] MyBatis操作数据库(基础) - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9b2c7b0a790e3afa463addaaa1c65342/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="[Spring] MyBatis操作数据库(基础)">
  <meta property="og:description" content="🌸个人主页:https://blog.csdn.net/2301_80050796?spm=1000.2115.3001.5343
🏵️热门专栏:
🧊 Java基本语法(97平均质量分)https://blog.csdn.net/2301_80050796/category_12615970.html?spm=1001.2014.3001.5482
🍕 Collection与数据结构 (92平均质量分)https://blog.csdn.net/2301_80050796/category_12621348.html?spm=1001.2014.3001.5482
🧀线程与网络(96平均质量分) https://blog.csdn.net/2301_80050796/category_12643370.html?spm=1001.2014.3001.5482
🍭MySql数据库(93平均质量分)https://blog.csdn.net/2301_80050796/category_12629890.html?spm=1001.2014.3001.5482
🍬算法(97平均质量分)https://blog.csdn.net/2301_80050796/category_12676091.html?spm=1001.2014.3001.5482
🍃 Spring(97平均质量分)https://blog.csdn.net/2301_80050796/category_12724152.html?spm=1001.2014.3001.5482
感谢点赞与关注~~~
目录 1.什么是MyBatis2. MyBatis入门2.1 创建项目引入依赖2.2 准备数据与相关实体类2.3 配置数据库相关信息2.4 编写Mapper2.5 编写测试代码 2. MyBatis基础操作2.1 MyBatis打印日志2.2 参数传递2.3 增(insert)2.4 删(Delete)2.5 改(Update)2.6 查(select)3.6.1 起别名3.6.2 结果映射2.6.3 开启驼峰命名与蛇形命名转换(推荐做法) 3. MyBatis XML配置文件3.1 配置连接字符串和MyBatis3.2 持久层代码3.2.1 添加mapper接口3.2.2 添加UserInfoXMLMapper.xml3.2.3 单元测试 3.3 增删改查操作3.3.1 增(Insert)3.3.2 删(Delete)3.3.3 改(Update)3.3.4 查(select) 4. 其他查询操作4.1 多表查询(联合查询)4.1.1 准备数据,创建对应的实体类4.1.2 查询数据 4.2 #{} 和 ${}4.2.1 使用4.2.2 #{} 和 ${}的区别(高频面试题) 4.3 排序功能4.4 like查询 1.什么是MyBatis 在前面,我们学习过JDBC编程对数据库的操作,不过JDBC对于数据库的操作在步骤上过于麻烦,所以我们在Spring中引入了MyBatis.
MyBatis是一款优秀的持久层框架,用于简化JDBC的开发.
那么持久层是什么意思呢?持久层指的就是持久化操作的层,通常指的是数据库的访问层,通常用来操作数据库.
简单来说MyBatis是更简单完成程序和数据库交互的框架，也就是更简单的操作和读取数据库工具. 2. MyBatis入门 MyBatis操作数据库的步骤:">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-25T23:30:46+08:00">
    <meta property="article:modified_time" content="2024-07-25T23:30:46+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[Spring] MyBatis操作数据库(基础)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>🌸个人主页:<a href="https://blog.csdn.net/2301_80050796?spm=1000.2115.3001.5343">https://blog.csdn.net/2301_80050796?spm=1000.2115.3001.5343</a><br> 🏵️热门专栏:<br> 🧊 Java基本语法(97平均质量分)<a href="https://blog.csdn.net/2301_80050796/category_12615970.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12615970.html?spm=1001.2014.3001.5482</a><br> 🍕 Collection与数据结构 (92平均质量分)<a href="https://blog.csdn.net/2301_80050796/category_12621348.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12621348.html?spm=1001.2014.3001.5482</a><br> 🧀线程与网络(96平均质量分) <a href="https://blog.csdn.net/2301_80050796/category_12643370.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12643370.html?spm=1001.2014.3001.5482</a><br> 🍭MySql数据库(93平均质量分)<a href="https://blog.csdn.net/2301_80050796/category_12629890.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12629890.html?spm=1001.2014.3001.5482</a><br> 🍬算法(97平均质量分)<a href="https://blog.csdn.net/2301_80050796/category_12676091.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12676091.html?spm=1001.2014.3001.5482</a><br> 🍃 Spring(97平均质量分)<a href="https://blog.csdn.net/2301_80050796/category_12724152.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12724152.html?spm=1001.2014.3001.5482</a><br> 感谢点赞与关注~~~<br> <img src="https://images2.imgbox.com/53/e3/amR6afn3_o.jpg" alt="在这里插入图片描述"></p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#1MyBatis_13" rel="nofollow">1.什么是MyBatis</a></li><li><a href="#2_MyBatis_19" rel="nofollow">2. MyBatis入门</a></li><li><ul><li><a href="#21__26" rel="nofollow">2.1 创建项目引入依赖</a></li><li><a href="#22__45" rel="nofollow">2.2 准备数据与相关实体类</a></li><li><a href="#23__100" rel="nofollow">2.3 配置数据库相关信息</a></li><li><a href="#24_Mapper_113" rel="nofollow">2.4 编写Mapper</a></li><li><a href="#25__133" rel="nofollow">2.5 编写测试代码</a></li></ul> 
  </li><li><a href="#2_MyBatis_162" rel="nofollow">2. MyBatis基础操作</a></li><li><ul><li><a href="#21_MyBatis_163" rel="nofollow">2.1 MyBatis打印日志</a></li><li><a href="#22__173" rel="nofollow">2.2 参数传递</a></li><li><a href="#23_insert_240" rel="nofollow">2.3 增(insert)</a></li><li><a href="#24_Delete_295" rel="nofollow">2.4 删(Delete)</a></li><li><a href="#25_Update_311" rel="nofollow">2.5 改(Update)</a></li><li><a href="#26_select_331" rel="nofollow">2.6 查(select)</a></li><li><ul><li><a href="#361__339" rel="nofollow">3.6.1 起别名</a></li><li><a href="#362__349" rel="nofollow">3.6.2 结果映射</a></li><li><a href="#263__390" rel="nofollow">2.6.3 开启驼峰命名与蛇形命名转换(推荐做法)</a></li></ul> 
  </li></ul> 
  </li><li><a href="#3_MyBatis_XML_410" rel="nofollow">3. MyBatis XML配置文件</a></li><li><ul><li><a href="#31_MyBatis_417" rel="nofollow">3.1 配置连接字符串和MyBatis</a></li><li><a href="#32__433" rel="nofollow">3.2 持久层代码</a></li><li><ul><li><a href="#321_mapper_438" rel="nofollow">3.2.1 添加mapper接口</a></li><li><a href="#322_UserInfoXMLMapperxml_453" rel="nofollow">3.2.2 添加UserInfoXMLMapper.xml</a></li><li><a href="#323__479" rel="nofollow">3.2.3 单元测试</a></li></ul> 
   </li><li><a href="#33__493" rel="nofollow">3.3 增删改查操作</a></li><li><ul><li><a href="#331_Insert_494" rel="nofollow">3.3.1 增(Insert)</a></li><li><a href="#332_Delete_536" rel="nofollow">3.3.2 删(Delete)</a></li><li><a href="#333_Update_537" rel="nofollow">3.3.3 改(Update)</a></li><li><a href="#334_select_539" rel="nofollow">3.3.4 查(select)</a></li></ul> 
  </li></ul> 
  </li><li><a href="#4__573" rel="nofollow">4. 其他查询操作</a></li><li><ul><li><a href="#41__574" rel="nofollow">4.1 多表查询(联合查询)</a></li><li><ul><li><a href="#411__577" rel="nofollow">4.1.1 准备数据,创建对应的实体类</a></li><li><a href="#412__616" rel="nofollow">4.1.2 查询数据</a></li></ul> 
   </li><li><a href="#42____681" rel="nofollow">4.2 #{} 和 ${}</a></li><li><ul><li><a href="#421__683" rel="nofollow">4.2.1 使用</a></li><li><a href="#422____731" rel="nofollow">4.2.2 #{} 和 ${}的区别(高频面试题)</a></li></ul> 
   </li><li><a href="#43__753" rel="nofollow">4.3 排序功能</a></li><li><a href="#44_like_772" rel="nofollow">4.4 like查询</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1MyBatis_13"></a>1.什么是MyBatis</h2> 
<p>在前面,我们学习过JDBC编程对数据库的操作,不过JDBC对于数据库的操作在步骤上过于麻烦,所以我们在Spring中引入了MyBatis.</p> 
<ul><li>MyBatis是一款优秀的<mark>持久层框架,用于简化JDBC的开发</mark>.<br> 那么持久层是什么意思呢?持久层指的就是持久化操作的层,<strong>通常指的是数据库的访问层,通常用来操作数据库</strong>.<br> <img src="https://images2.imgbox.com/cc/db/e1Xi9BdQ_o.png" alt="在这里插入图片描述"><br> 简单来说MyBatis是更简单完成程序和数据库交互的框架，也就是更简单的操作和读取数据库工具.</li></ul> 
<h2><a id="2_MyBatis_19"></a>2. MyBatis入门</h2> 
<p>MyBatis操作数据库的步骤:</p> 
<ol><li>创建项目,引入依赖</li><li>准备数据与实体类</li><li>配置数据库相关信息,包括数据库URL,账号和密码</li><li>编写Mapper(持久层代码),包括接口interface与sql语句.</li><li>生成测试代码,对编写的接口进行测试.</li></ol> 
<h3><a id="21__26"></a>2.1 创建项目引入依赖</h3> 
<ul><li>创建SpringBoot工程,并<mark>导入MyBatis的起步依赖和MySQL的驱动包</mark>.把MyBatis Framework和MySQL driver这两个选项都勾选上.<br> <img src="https://images2.imgbox.com/b7/11/TSjsPF74_o.png" alt="在这里插入图片描述"></li><li>创建项目之后,我们就可以发现,项目的pom文件中自动导入了两个选项的依赖项.</li></ul> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>如果我们在创建工程的时候忘记勾选了这两个选项,也可以通过右键点击生成,选择edit starter自动创建依赖.<br> <img src="https://images2.imgbox.com/17/7d/YhZ4e5Aq_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="22__45"></a>2.2 准备数据与相关实体类</h3> 
<ul><li>创建用户表,并创建对应的实体类User.</li></ul> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建数据库 </span>
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> mybatis_test<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> mybatis_test <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4<span class="token punctuation">;</span>
<span class="token comment">-- 使⽤数据数据 </span>
<span class="token keyword">USE</span> mybatis_test<span class="token punctuation">;</span>
<span class="token comment">-- 创建表[用户表] </span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> userinfo<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>userinfo<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
 <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token punctuation">(</span> <span class="token number">11</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">127</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">127</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>age<span class="token punctuation">`</span></span> <span class="token keyword">TINYINT</span> <span class="token punctuation">(</span> <span class="token number">4</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>gender<span class="token punctuation">`</span></span> <span class="token keyword">TINYINT</span> <span class="token punctuation">(</span> <span class="token number">4</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'1-男 2-⼥ 0-默认'</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>phone<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">15</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>delete_flag<span class="token punctuation">`</span></span> <span class="token keyword">TINYINT</span> <span class="token punctuation">(</span> <span class="token number">4</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span> <span class="token keyword">COMMENT</span> <span class="token string">'0-正常, 1-删除'</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token punctuation">)</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4<span class="token punctuation">;</span> 
<span class="token comment">-- 添加用户信息 </span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mybatis_test<span class="token punctuation">.</span>userinfo <span class="token punctuation">(</span> username<span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span><span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> phone <span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'18612340001'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mybatis_test<span class="token punctuation">.</span>userinfo <span class="token punctuation">(</span> username<span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span><span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> phone <span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span> <span class="token string">'zhangsan'</span><span class="token punctuation">,</span> <span class="token string">'zhangsan'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'18612340002'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mybatis_test<span class="token punctuation">.</span>userinfo <span class="token punctuation">(</span> username<span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span><span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> phone <span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span> <span class="token string">'lisi'</span><span class="token punctuation">,</span> <span class="token string">'lisi'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'18612340003'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mybatis_test<span class="token punctuation">.</span>userinfo <span class="token punctuation">(</span> username<span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span><span class="token punctuation">,</span> age<span class="token punctuation">,</span> gender<span class="token punctuation">,</span> phone <span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span> <span class="token string">'wangwu'</span><span class="token punctuation">,</span> <span class="token string">'wangwu'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'18612340004'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a5/35/gds5XM37_o.png" alt="在这里插入图片描述"></p> 
<ul><li>创建对应的实体类,UserInfo,其中实体类的属性名和表中的字段名一一对应.</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jrj<span class="token punctuation">.</span>mybatis</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> gender<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> phone<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> deleteFlag<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="23__100"></a>2.3 配置数据库相关信息</h3> 
<p>MyBatis中要连接数据库需要数据库相关参数的配置,包括数据库URL,用户名,密码,MySQL驱动类.这些配置信息<strong>均在配置文件中完成</strong>.用于连接对应的数据库.下面我们以yml文件为例:</p> 
<pre><code class="prism language-yml"><span class="token comment"># 数据库连接配置 </span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
	  <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/mybatis_test<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL=false</span>
	  <span class="token key atrule">username</span><span class="token punctuation">:</span> root
	  <span class="token key atrule">password</span><span class="token punctuation">:</span> root
	  <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
</code></pre> 
<p>其中,mybatis_test就对应的是数据库的名字.<br> [注意] 如果password是纯数字的话,<mark>需要在数字的的外围用单引号括起来</mark>.</p> 
<h3><a id="24_Mapper_113"></a>2.4 编写Mapper</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jrj<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>jrj<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span></span><span class="token class-name">UserInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Mapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Select</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserInfoMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAllUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>@Mapper</code>注解: 表示的是MyBatis中的Mapper接口,<mark>在程序运行的时候,这个接口会交给IoC容器管理</mark>.<br> <code>@Select</code>注解: 表示的是sql语句是一个select查询语句,<strong>也就是注解方法具体实现的内容</strong>.<br> 需要注意的一点是,<strong>像这样返回多条数据的接口,一定要用List来接收</strong>.</p> 
<h3><a id="25__133"></a>2.5 编写测试代码</h3> 
<p>如何生成测试代码:</p> 
<ul><li>在想要测试的接口中点击右键,点击生成.<br> <img src="https://images2.imgbox.com/71/71/4FhpqLbt_o.png" alt="在这里插入图片描述"></li><li>点击测试<br> <img src="https://images2.imgbox.com/7f/2e/60Ajkfk5_o.png" alt="在这里插入图片描述"></li><li>选择想要测试的方法<br> <img src="https://images2.imgbox.com/c4/e9/9656FCcr_o.png" alt="在这里插入图片描述"></li><li>测试类会在src目录中的test目录下自动生成.<br> <img src="https://images2.imgbox.com/63/2d/DpADrlK7_o.png" alt="在这里插入图片描述"></li><li>之后在对应的方法中编写测试代码.</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">UserInfoMapperTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserInfoMapper</span> userInfoMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">selectAllUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> userInfoMapper<span class="token punctuation">.</span><span class="token function">selectAllUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">UserInfo</span> userInfo<span class="token operator">:</span>list<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol><li><code>@SpringBootTest</code>注解:会在测试类运行的时候,自动加载Spring环境,</li><li><code>@Autowired</code>进行DI注入之后,我们便可以使用对应的类调用对应的方法进行测试.</li><li><code>@Test</code>注解表示该方法是测试方法, <mark>加上该注解后会在运行测试方法的时候在控制台上显示测试方法的运行结果</mark>.</li></ol> 
<h2><a id="2_MyBatis_162"></a>2. MyBatis基础操作</h2> 
<h3><a id="21_MyBatis_163"></a>2.1 MyBatis打印日志</h3> 
<p>在Mybatis当中我们可以借助日志,查看到sql语句的执行、执行传递的参数以及执行结果,<strong>在配置文件</strong>中进行配置即可.下面是yml配置文件的格式:</p> 
<pre><code class="prism language-yml"><span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span> <span class="token comment"># 配置打印 MyBatis⽇志 </span>
  	<span class="token key atrule">log-impl</span><span class="token punctuation">:</span> org.apache.ibatis.logging.stdout.StdOutImpl
</code></pre> 
<p>重新运行程序,我们可以看到<mark>sql语句的内容,以及传递的参数类型和执行结果</mark>.</p> 
<p><img src="https://images2.imgbox.com/5e/19/JF3GjHUT_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="22__173"></a>2.2 参数传递</h3> 
<p>现在我们需要查找id=4的用户,对应的sql是select * from userinfo where id=4.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * form userinfo where id = 4"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">selectUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>但是这样的话,就只能查询到id为4用户的数据,所以我们不建议把sql语句这样写死.需要变为动态的数值.<br> 解决办法就是在selectUser方法中添加一个参数(id),<mark>将方法中的参数传递给sql语句.使用<code>#{}</code>的方式在sql语句中获取方法中的参数</mark>.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where id = #{id}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">selectUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">void</span> <span class="token function">selectUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfoMapper<span class="token punctuation">.</span><span class="token function">selectUser</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行测试代码:<br> <img src="https://images2.imgbox.com/4b/04/HkVbXYui_o.png" alt="在这里插入图片描述"><br> <mark>如果mapper接口方法中的形式参数只有一个,<code>#{}</code>里面的属性名可以随便写.因为参数和属性名都只有一个</mark>,只能是一一对应的关系.如果参数有多个,属性名和参数名就必须保持一致,或者使用param1,param2…按照顺序对应.</p> 
<ul><li>按照名字对应</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where username = #{name} and id = #{id}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">selectUser2</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">selectUser2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfoMapper<span class="token punctuation">.</span><span class="token function">selectUser2</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试结果:<br> <img src="https://images2.imgbox.com/86/12/ocCwRAhg_o.png" alt="在这里插入图片描述"></p> 
<ul><li>按照参数顺序对应</li></ul> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where username = #{param1} and id = #{param2}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">selectUser3</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">selectUser3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfoMapper<span class="token punctuation">.</span><span class="token function">selectUser3</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>测试结果:<br> <img src="https://images2.imgbox.com/dc/c2/bnRRwtM7_o.png" alt="在这里插入图片描述"></p> 
<p>也可以通过<code>@Param</code>注解,设置参数的别名,如果使用<code>@Param</code>设置别名,<mark>注解中的别名必须和sql中的属性名保持一致</mark>.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where id = #{ID}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">selectUser4</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"ID"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">selectUser4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfoMapper<span class="token punctuation">.</span><span class="token function">selectUser4</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行结果:<br> <img src="https://images2.imgbox.com/48/6e/7F67CH1t_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="23_insert_240"></a>2.3 增(insert)</h3> 
<p>sql语句:<br> <code>insert into userinfo (username, `password`, age, gender, phone) values ("zhaoliu","zhaoliu",19,1,"18700001234")</code><br> 把sql中的常量换为动态的参数.<br> Mapper接口:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"insert into userinfo (id,username,password,age,gender,phone) values ("</span> <span class="token operator">+</span>
        <span class="token string">"#{id},#{username},#{password},#{age},#{gender},#{phone})"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">insertUser1</span><span class="token punctuation">(</span><span class="token class-name">UserInfo</span> userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里我们<mark>可以直接使用UserInfo对象的属性来获取参数</mark>.由于Insert返回的是改变数据库的行数,所以接口的返回值是Integer.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">insertUser1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"wangwu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"12345"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setPhone</span><span class="token punctuation">(</span><span class="token string">"13334768907"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfoMapper<span class="token punctuation">.</span><span class="token function">insertUser1</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行结果:<br> <img src="https://images2.imgbox.com/57/bd/SllZlLr2_o.png" alt="在这里插入图片描述"><br> 查看数据库:id为5的数据插入成功.<br> <img src="https://images2.imgbox.com/41/5e/3C5dCS08_o.png" alt="在这里插入图片描述"><br> 接下来我们来设置<code>@Param</code>属性,<mark>那么<code>#{}</code>就需要用参数.属性的方式来获取</mark>.</p> 
<ul><li>返回主键<br> Insert语句默认返回的是受影响的行数,但是有些情况下,数据插入之后,还需要有后续的关联操作,需要获取到新插入的数据的id.<mark>如果想要拿到自增id,需要在Mapper接口的方法上添加⼀个Options的注解</mark>.</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Options</span><span class="token punctuation">(</span>useGeneratedKeys <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>keyProperty <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"insert into userinfo (id,username,password,age,gender,phone) values ("</span> <span class="token operator">+</span>
        <span class="token string">"#{id},#{username},#{password},#{age},#{gender},#{phone})"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">insertUser2</span><span class="token punctuation">(</span><span class="token class-name">UserInfo</span> userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>其中useGeneratedKeys表示的是是自增?keyProperty表示的是哪个字段自增?</strong></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">insertUser2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"zhaoliu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"1234566"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setPhone</span><span class="token punctuation">(</span><span class="token string">"13334098738"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"change col "</span> <span class="token operator">+</span> userInfoMapper<span class="token punctuation">.</span><span class="token function">insertUser2</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"id = "</span> <span class="token operator">+</span> userInfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试运行:<br> <img src="https://images2.imgbox.com/4b/c8/kLJ1WbMo_o.png" alt="在这里插入图片描述"><br> 我们看到影响的行数是1,自增的id为7.下面我们观察数据库:<br> <img src="https://images2.imgbox.com/d9/52/SCTJCWrg_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="24_Delete_295"></a>2.4 删(Delete)</h3> 
<p>sql语句:<br> <code>delete from userinfo where id=6</code>.<br> 把sql语句中的常量替换为动态参数.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Delete</span><span class="token punctuation">(</span><span class="token string">"delete from userinfo where id = #{id}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">deleteUser1</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">deleteUser1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfoMapper<span class="token punctuation">.</span><span class="token function">deleteUser1</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>查看数据库,我们看到id=6的数据被删除掉了.<br> <img src="https://images2.imgbox.com/7e/97/qla9QNtL_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="25_Update_311"></a>2.5 改(Update)</h3> 
<p>sql语句:<br> <code>update userinfo set username="zhaoliu" where id=5</code><br> 把SQL中的常量替换为动态的参数<br> Mapper接口:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token string">"update userinfo set username = #{username} where id = #{id}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">UserInfo</span> userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userInfo<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userInfo<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"tianqi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfoMapper<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>测试运行:我们看到数据库中id为5的名字被改成了tianqi.<br> <img src="https://images2.imgbox.com/79/8a/jQZCXacb_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="26_select_331"></a>2.6 查(select)</h3> 
<p>我们在上面查询的时候,发现有几个字段是没有赋值的.<strong>只有Java对象属性和数据库字段⼀模⼀样时,才会进行赋值</strong>.<br> <img src="https://images2.imgbox.com/e4/24/4r31kXjM_o.png" alt="在这里插入图片描述"><br> 在我们查询所有数据的时候,我们发现,对象的创建时间,更新时间,删除逻辑数字都是null.<br> <strong>原因</strong>:<br> 当自动映射查询结果的时候,MyBatis会获取结果中<strong>返回的列名并在Java类中查找相同名字的属性(忽略大小写)</strong> .这意味着如果发现了ID列和id属性，MyBatis会将列ID的值赋给id属性.但是我们的创建时间,更新时间,删除逻辑数字,<em>在数据库中是蛇形结构的名字,而在Java类中是小驼峰的格式</em>.<br> <img src="https://images2.imgbox.com/56/25/NFaTzFhh_o.png" alt="在这里插入图片描述"><br> 下面是解决办法:</p> 
<h4><a id="361__339"></a>3.6.1 起别名</h4> 
<p>在sql语句中,给列名起别名,<strong>保持别名和实体类属性名一样</strong>.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select id, username, `password`, age, gender, phone, "</span> <span class="token operator">+</span>
        <span class="token string">"delete_flag as deleteFlag,"</span> <span class="token operator">+</span>
        <span class="token string">"create_time as createTime, update_time as updateTime from userinfo"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAllUser2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>当sql语句太长的时候,我们可以使用+进行拼接.</p> 
<h4><a id="362__349"></a>3.6.2 结果映射</h4> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Results</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column <span class="token operator">=</span> <span class="token string">"delete_flag"</span><span class="token punctuation">,</span>property <span class="token operator">=</span> <span class="token string">"deleteFlag"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column <span class="token operator">=</span> <span class="token string">"create_time"</span><span class="token punctuation">,</span>property <span class="token operator">=</span> <span class="token string">"createTime"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column <span class="token operator">=</span> <span class="token string">"update_time"</span><span class="token punctuation">,</span>property <span class="token operator">=</span> <span class="token string">"updateTime"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAllUser3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>@Results</code>注解中可以用大括号括起多个<code>@Result</code>映射,<mark><code>@Result</code>前面的参数是表的字段名,后面是Java类的属性</mark>.也就是字段与属性的映射关系.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">selectAllUser3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> userInfoMapper<span class="token punctuation">.</span><span class="token function">selectAllUser3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">UserInfo</span> userInfo<span class="token operator">:</span>list<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行测试:<br> <img src="https://images2.imgbox.com/67/1c/0wvKe2di_o.png" alt="在这里插入图片描述"><br> 我们看到,后面的几个属性被显示了出来.<br> 如果其他sql也想复用这一组映射,可以给这一组<code>@Results</code>映射自定义一个名称. 之后在想要复用这个sql映射的地方使用<code>@ResultMap(映射名称)</code>来复用映射.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Results</span><span class="token punctuation">(</span>id <span class="token operator">=</span> <span class="token string">"resultMap1"</span><span class="token punctuation">,</span>value <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
         <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column <span class="token operator">=</span> <span class="token string">"delete_flag"</span><span class="token punctuation">,</span>property <span class="token operator">=</span> <span class="token string">"deleteFlag"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column <span class="token operator">=</span> <span class="token string">"create_time"</span><span class="token punctuation">,</span>property <span class="token operator">=</span> <span class="token string">"createTime"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>column <span class="token operator">=</span> <span class="token string">"update_time"</span><span class="token punctuation">,</span>property <span class="token operator">=</span> <span class="token string">"updateTime"</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo"</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAllUser3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token annotation punctuation">@ResultMap</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"resultMap1"</span><span class="token punctuation">)</span>
 <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where id = #{id}"</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">selectUser5</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>@ResultMap</code>注解中的value的值和上面映射的id名字一样.方可复用.</p> 
<h4><a id="263__390"></a>2.6.3 开启驼峰命名与蛇形命名转换(推荐做法)</h4> 
<p>通常数据库列<em>使用蛇形命名法进行命名(下划线分割各个单词),而Java属性⼀般遵循驼峰命名法约定</em>.<br> 为了在这两种命名方式之间启用自动映射，需要将<code>mapUnderscoreToCamelCase</code>设置为true.我们需要在配置文件中配置.</p> 
<pre><code class="prism language-yml"><span class="token key atrule">mybatis</span><span class="token punctuation">:</span> 
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
   <span class="token key atrule">map-underscore-to-camel-case</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#配置驼峰⾃动转换 </span>
</code></pre> 
<p>转换规则:abc_xyz=&gt;abcXyz<mark>蛇形转换为小驼峰格式</mark>.<br> Java代码不做任何处理:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAllUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>我们看到原来没有赋值上的属性被赋值了.<br> <img src="https://images2.imgbox.com/b6/ab/xIi3P5Up_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>mysql表的设计规范:<br> 自增id,创建日期,更新日期,这几个字段即使业务没有需求,也必须有.</p> 
</blockquote> 
<h2><a id="3_MyBatis_XML_410"></a>3. MyBatis XML配置文件</h2> 
<p>MyBatis的开发方式从大方向上分为两种,除了我们上面展示的使用注解的方式,我们还可以通过xml配置文件来开发.</p> 
<blockquote> 
 <p>使⽤Mybatis的注解方式，主要是来完成⼀些简单的增删改查功能.如果需要实现复杂的SQL功能，建议使用XML来配置映射语句，也就是将SQL语句写在XML配置文件中.</p> 
</blockquote> 
<p>这种开发方式大致分为两步:</p> 
<ol><li>配置数据库连接字符串和MyBatis.</li><li>写持久层代码</li></ol> 
<h3><a id="31_MyBatis_417"></a>3.1 配置连接字符串和MyBatis</h3> 
<p>此步骤需要进行两项设置,<mark>数据库连接字符串设置和指定MyBatis的XML文件</mark>.</p> 
<pre><code class="prism language-yml"><span class="token comment"># 数据库连接配置 </span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/mybatis_test<span class="token punctuation">?</span>
    characterEncoding=utf8<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
<span class="token comment"># 配置 mybatis xml 的⽂件路径，在 resources/mapper 创建所有表的 xml ⽂件 </span>
<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">**Mapper.xml</span>
</code></pre> 
<p><code>mapper-locations</code>中的value值,<code>classpath</code>表示的是项目中的resource目录.<code>mapper</code>表示的是一个自定义目录.一般我们使用xml操作数据库的代码都会单独放在一个mapper目录中,之后<code>**Mapper.xml</code>表示的是以这个结尾的xml文件就是操作数据库的xml文件.</p> 
<h3><a id="32__433"></a>3.2 持久层代码</h3> 
<p>持久层代码分为两部分:</p> 
<ol><li>方法定义: Interface</li><li>方法实现: xxx.xml<br> <img src="https://images2.imgbox.com/4d/50/lZdhee0C_o.png" alt="在这里插入图片描述"></li></ol> 
<h4><a id="321_mapper_438"></a>3.2.1 添加mapper接口</h4> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jrj<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>jrj<span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span></span><span class="token class-name">UserInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Mapper</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserInfoXMLMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAllUser1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="322_UserInfoXMLMapperxml_453"></a>3.2.2 添加UserInfoXMLMapper.xml</h4> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>
        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.jrj.mybatis.mapper.UserInfoXMLMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>mapper标签中加的是<mark>带有<code>@Mapper</code>注解接口的路径</mark>,即想要通过MyBatis操作数据库的Mapper接口.<br> 查询所有用户的具体实现:</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>
        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.jrj.mybatis.mapper.UserInfoXMLMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectAllUser1<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.jrj.mybatis.UserInfo<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        select * from userinfo
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><mark>其中select标签中,<code>id="selectAllUser1"</code>代表的是Mapper中的方法名. <code>resultType="com.jrj.mybatis.UserInfo"</code>代表的是sql查询之后返回的类型,也就是我们开头定义的实体类,只有select类型的语句会有返回值的类型</mark>.<strong>注意,是sql查询之后返回的类型,不是接口返回值的类型</strong>,sql查询之后返回的是UserInfo类,而接口返回的是List类型.<br> 标签中间写的是sql语句.<br> 我们可以安装一个插件,叫做MyBatisX,这个插件可以自动帮助我们生成xml标签.我们是需要写sql语句即可.</p> 
<blockquote> 
 <p>注意,在我们的方法名中如果有select,Insert这样的关键字的时候,插件会自动根据名字自动生成标签类型.如果没有,需要在生成的时候进行选择.<br> <img src="https://images2.imgbox.com/86/a2/hgixEDpE_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h4><a id="323__479"></a>3.2.3 单元测试</h4> 
<p>测试代码如下:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">selectAllUser1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> userInfoXMLMapper<span class="token punctuation">.</span><span class="token function">selectAllUser1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">UserInfo</span> userInfo<span class="token operator">:</span> list<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>测试结果:<br> <img src="https://images2.imgbox.com/8d/ec/ofrVg49u_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="33__493"></a>3.3 增删改查操作</h3> 
<h4><a id="331_Insert_494"></a>3.3.1 增(Insert)</h4> 
<p>UserInfoMapper接口:</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token class-name">UserInfo</span> userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>xml:</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insertUser<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    insert into userinfo (id,username,password,age,gender,phone) values (#{id},#{username},#{password},#{age},#{gender},#{phone})
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>测试代码:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"zhubajie"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setAge</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"6666666"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setGender</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setPhone</span><span class="token punctuation">(</span><span class="token string">"487362849326"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfoXMLMapper<span class="token punctuation">.</span><span class="token function">insertUser</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行结果:<br> <img src="https://images2.imgbox.com/53/e3/dbWmsYzn_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/9a/1a/bky79Uwg_o.png" alt="在这里插入图片描述"><br> 与注解实现类似,要是在形参的前面加上<code>@Param</code>注解的话,在sql语句中的<code>#{}</code>就必须使用<strong>对象名.属性名</strong>来访问.<br> Mapper接口:</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"userinfo"</span><span class="token punctuation">)</span> <span class="token class-name">UserInfo</span> userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>xml:</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insertUser<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
   insert into userinfo (id,username,password,age,gender,phone) values (#{userinfo.id},#{userinfo.username},#{userinfo.password},#{userinfo.age},#{userinfo.gender},#{userinfo.phone})
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="332_Delete_536"></a>3.3.2 删(Delete)</h4> 
<h4><a id="333_Update_537"></a>3.3.3 改(Update)</h4> 
<p>删和改和上面的增是相同的道理,这里我们不再赘述.</p> 
<h4><a id="334_select_539"></a>3.3.4 查(select)</h4> 
<p>同样,使用xml进行查询的时候,同样也存在sql字段名和类属性对应不上的问题.<br> xml:</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectAllUser1<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.jrj.mybatis.UserInfo<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select * from userinfo
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>Mapper接口:</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectAllUser1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>运行结果:<br> <img src="https://images2.imgbox.com/a5/f9/w1US6k2R_o.png" alt="在这里插入图片描述"><br> 我们看到一些字段名仍然没有被赋值.<br> 解决办法与注解类似:</p> 
<ol><li>起别名</li><li>结果映射</li><li>开启驼峰与蛇形转换.<br> 1,3 与注解一样,不再赘述.下面我们来看一下结果映射法如何解决字段与属性映射以及主键问题.<br> xml:</li></ol> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Map<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.jrj.mybatis.UserInfo<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>delete_flag<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deleteFlag<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>create_time<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>createTime<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>update<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateTime<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>result</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectAllUser1<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.jrj.mybatis.UserInfo<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Map<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select * from userinfo
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>解释:<br> <img src="https://images2.imgbox.com/42/f1/kZmQGvkX_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4__573"></a>4. 其他查询操作</h2> 
<h3><a id="41__574"></a>4.1 多表查询(联合查询)</h3> 
<p>多表查询和单表查询类似,只不过就是sql不同而已,具体sql可参考:<br> <a href="https://lilesily12385.blog.csdn.net/article/details/137519405" rel="nofollow">https://lilesily12385.blog.csdn.net/article/details/137519405</a></p> 
<h4><a id="411__577"></a>4.1.1 准备数据,创建对应的实体类</h4> 
<p>上面建了⼀张用户表,我们再来建⼀张文章表,进行多表关联查询.<br> <strong>文章表的uid,对应用户表的id</strong>.</p> 
<ul><li>准备数据</li></ul> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建⽂章表 </span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> articleinfo<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> articleinfo <span class="token punctuation">(</span>
 id <span class="token keyword">INT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
 title <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">100</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 content <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 uid <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 delete_flag <span class="token keyword">TINYINT</span> <span class="token punctuation">(</span> <span class="token number">4</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span> <span class="token keyword">COMMENT</span> <span class="token string">'0-正常, 1-删除'</span><span class="token punctuation">,</span>
 create_time <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 update_time <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">charset</span> <span class="token string">'utf8mb4'</span><span class="token punctuation">;</span>
<span class="token comment">-- 插⼊测试数据 </span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> articleinfo <span class="token punctuation">(</span> title<span class="token punctuation">,</span> content<span class="token punctuation">,</span> uid <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> <span class="token string">'Java'</span><span class="token punctuation">,</span> <span class="token string">'Java正⽂'</span><span class="token punctuation">,</span> <span class="token number">1</span> 
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>创建对应model</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jrj<span class="token punctuation">.</span>mybatis</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleInfo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> uid<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> deleteFlag<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="412__616"></a>4.1.2 查询数据</h4> 
<p>需求,根据uid查询作者的名称等相关信息.<br> sql:</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span>
 ta<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
 ta<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
 ta<span class="token punctuation">.</span>content<span class="token punctuation">,</span>
 ta<span class="token punctuation">.</span>uid<span class="token punctuation">,</span>
 tb<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
 tb<span class="token punctuation">.</span>age<span class="token punctuation">,</span>
 tb<span class="token punctuation">.</span>gender 
<span class="token keyword">FROM</span>
 articleinfo ta
 <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> userinfo tb <span class="token keyword">ON</span> ta<span class="token punctuation">.</span>uid <span class="token operator">=</span> tb<span class="token punctuation">.</span>id 
<span class="token keyword">WHERE</span>
 ta<span class="token punctuation">.</span>id <span class="token operator">=</span><span class="token number">1</span>
</code></pre> 
<p>补充实体类:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleInfo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> uid<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> deleteFlag<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> gender<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>接口定义:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ArticleInfoMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select "</span> <span class="token operator">+</span>
<span class="token string">"articleinfo.id,articleinfo.title,articleinfo.content,articleinfo.uid,articleinfo.delete_flag,articleinfo.create_time,articleinfo.update_time,userinfo.username,userinfo.age,userinfo.gender "</span> <span class="token operator">+</span>
            <span class="token string">"from "</span> <span class="token operator">+</span>
            <span class="token string">"articleinfo left join userinfo "</span> <span class="token operator">+</span>
            <span class="token string">"on articleinfo.uid = userinfo.id "</span> <span class="token operator">+</span>
            <span class="token string">"where userinfo.id = #{id}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">ArticleInfo</span> <span class="token function">selectArticle</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试代码:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">ArticleInfoMapperTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">ArticleInfoMapper</span> articleInfoMapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">selectArticle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>articleInfoMapper<span class="token punctuation">.</span><span class="token function">selectArticle</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行结果:<br> <img src="https://images2.imgbox.com/d6/33/PSO4eHzX_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>一般情况下,我们不会轻易使用联合查询,因为它是一种慢查询,会影响集群的性能.我们一般会把联合查询的sql拆分成多个单表查询.<br> 当然有些情况下可以使用多表查询,这些情况对于性能要求都比较小:比如内部员工使用的系统,B端项目(平台的商家端).</p> 
</blockquote> 
<h3><a id="42____681"></a>4.2 #{} 和 ${}</h3> 
<p>在MyBatis中,参数赋值的方法不仅仅只有<code>#{}</code>,而且还有<code>${}</code>,下面我们来看一下二者的区别.</p> 
<h4><a id="421__683"></a>4.2.1 使用</h4> 
<ol><li>先看Integer类型的参数</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where id = #{id}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">selectUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>观察日志:<br> <img src="https://images2.imgbox.com/11/0a/xApfg0Bz_o.png" alt="在这里插入图片描述"><br> 我们发现,通过次接口输出的sql语句是:<br> <code>select * form userinfo where id = ?</code><br> 我们输⼊的参数并没有在后面拼接，<mark>id的值是使用? 进行占位.这种SQL我们称之为"预编译SQL"</mark>.预编译sql我们在mysql中的JDBC编程中有提到过.<mark>就是把参数的值直接赋给了前面的id</mark>.<br> 把<code>#{}</code>替换为<code>${}</code>之后再次观察打印日志:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where id = ${id}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">selectUser</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b9/e5/uCR49V0z_o.png" alt="在这里插入图片描述"><br> 我们看到,参数直接拼接到了sql语句中.<br> 2. 接下来就是String类型的参数</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where username = #{name}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">selectUser6</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>观察打印日志:<br> <img src="https://images2.imgbox.com/8d/31/7nly6JMi_o.png" alt="在这里插入图片描述"><br> 把<code>#{}</code>换为<code>${}</code>再观察打印日志.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where username = ${name}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">selectUser6</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>观察日志:<br> <img src="https://images2.imgbox.com/1a/dc/fKepK3Rq_o.png" alt="在这里插入图片描述"><br> 我们发现,这次的结果依然是把参数直接拼接在了sql中,<mark>但是字符串作为参数的时候需要添加引号 ‘’ ,使<br> ⽤ <code>${} </code>不会拼接引号</mark> ‘’ ,导致程序报错.<br> 我们修改代码:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where username = '${name}'"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">selectUser6</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>再次运行,正常返回:<br> <img src="https://images2.imgbox.com/45/8c/MVz0i3OP_o.png" alt="在这里插入图片描述"><br> 从上面两个例子可以总结:<br> <mark>#{} 使用的是预编译SQL,通过?占位的方式,提前对SQL进行编译,然后把参数赋值到SQL语句中.#{} 会根据参数类型,自动拼接引号’’ .${} 会直接进行字符替换,直接把参数拼接到sql中,⼀起对SQL进行编译.如果参数为字符串,需要加上引号 ‘’</mark> .</p> 
<h4><a id="422____731"></a>4.2.2 #{} 和 ${}的区别(高频面试题)</h4> 
<p><strong>#{}和${}的区别就是预编译SQL和即时SQL的区别.</strong></p> 
<ol><li><code>#{}</code>相对于<code>${}</code>性能更高.<br> 预编译SQL，<mark>编译⼀次之后会将编译后的SQL语句缓存起来，后面再次执行这条语句时，不会再次编译</mark>(只是输⼊的参数不同),省去了解析优化等过程,以此来提高效率.</li><li><code>#{}</code>更安全(防止sql注入)<br> SQL注⼊：<em>是通过操作输⼊的数据来修改事先定义好的SQL语句的本意</em>，以达到执行代码对服务器进行攻击的方法.由于没有对用户输入进行充分检查，而SQL⼜是拼接而成，在用户输⼊参数时，在参数中添加⼀些SQL关键字，达到改变SQL运⾏结果的目的，也可以完成恶意攻击.<br> 我们下面来举一个sql注入的例子:sql注入代码： ’ or 1='1</li></ol> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where username = '${name}'"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">selectUser6</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>sql注入后:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">selectUser6</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfoMapper<span class="token punctuation">.</span><span class="token function">selectUser6</span><span class="token punctuation">(</span><span class="token string">"' or 1='1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行结果:<br> <img src="https://images2.imgbox.com/72/80/GBqrrcew_o.png" alt="在这里插入图片描述"><br> sql就返回所有用户的信息.并不是我们想要的信息.<mark>所以我们尽量使用<code>#{}</code>的方式</mark>.</p> 
<h3><a id="43__753"></a>4.3 排序功能</h3> 
<p>即使<code>${}</code>会有sql注入的风险.有些情况下,<code>${}</code>还是有他自己的作用.比如对数据进行排序.<br> Mapper实现:把数据根据id降序排名.</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo order by id ${sort}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectUser7</span><span class="token punctuation">(</span><span class="token class-name">String</span> sort<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">selectUser7</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfoMapper<span class="token punctuation">.</span><span class="token function">selectUser7</span><span class="token punctuation">(</span><span class="token string">"desc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>返回了正确的结果;<br> <img src="https://images2.imgbox.com/27/87/q8ydvpEq_o.png" alt="在这里插入图片描述"><br> ==如果把<span class="katex--inline">KaTeX parse error: Expected 'EOF', got '#' at position 3: 改成#̲,就会自动对字符串加上``' …</span>{}``.</p> 
<h3><a id="44_like_772"></a>4.4 like查询</h3> 
<p>like使用<code>#{}</code>会报错.会给字符串加上单引号.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where username like '%#{name}%'"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">selectUser8</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">selectUser8</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfoMapper<span class="token punctuation">.</span><span class="token function">selectUser8</span><span class="token punctuation">(</span><span class="token string">"dmi"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/50/1f/FKuarXOy_o.png" alt="在这里插入图片描述"><br> 虽然使用<code>${}</code>会成功,但是存在sql注入问题,不可以直接使用.<mark>所以我们通过sql中的一个函数concat()来处理</mark>,<strong>它是一个字符串拼接函数</strong>.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from userinfo where username like concat('%',#{name},'%')"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">selectUser8</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>运行成功:<br> <img src="https://images2.imgbox.com/8f/fd/DocRzu1n_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/04982abd284f415086e6081cdac08061/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2024华为数通HCIP-datacom最新题库（H12-831变题更新⑦）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/375243dc869d0e04bf9f7af653394298/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【人工智能】AI绘画：科技与艺术交汇的新时代</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>