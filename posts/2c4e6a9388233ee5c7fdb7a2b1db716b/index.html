<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>sql — 窗口函数 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/2c4e6a9388233ee5c7fdb7a2b1db716b/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="sql — 窗口函数">
  <meta property="og:description" content="1. 基本介绍 1.1 窗口函数介绍 窗口函数是SQL中的一种强大工具，用于在查询结果中进行分析和计算。
与常规聚合函数不同，窗口函数可以在不影响查询结果集的情况下，对结果集中的每一行应用函数，生成额外的信息，例如排名、累计和等。这些函数可以根据定义的窗口范围动态地计算值，而不是像常规聚合函数那样对整个数据集进行计算。
窗口函数通常与OVER子句一起使用，OVER子句定义了窗口的范围，可以指定分区、排序规则等。
1.2 窗口函数分类 窗口函数可以分为排序窗口函数和统计窗口函数两大类。
排序窗口函数主要用于对数据进行排序和排名，包括row_number、rank、dense_rank、percent_rank、ntile；
统计窗口函数则用于进行统计计算，包括count、sum、avg、min、max、first_value、last_value、lag、lead、cume_dist。
2. 样例数据 2.1 样例数据SQL CREATE TABLE Sales ( id INT, region VARCHAR(50), amount DECIMAL(10, 2)); INSERT INTO Sales (id, region, amount) VALUES(1, &#39;North&#39;, 1000.50),(2, &#39;North&#39;, 1500.75),(3, &#39;South&#39;, 800.25),(4, &#39;West&#39;, 1200.00),(5, &#39;East&#39;, 2000.30); 3.各个窗口函数介绍 3.1 row_number（）窗口函数 row_number函数为结果集中的每一行分配一个唯一的整数，按照指定的排序顺序进行排列。
SELECT id, region, amount, ROW_NUMBER() OVER (ORDER BY amount DESC) AS row_numFROM Sales; 3.2 rank （）窗口函数 rank函数为结果集中的每一行分配一个排名，如果有相同数值，则会跳过相同排名并继续递增。（不连续排名）
rank()函数的结果是：1, 2, 3, 3, 5, 6。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-25T14:08:20+08:00">
    <meta property="article:modified_time" content="2024-04-25T14:08:20+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">sql — 窗口函数</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><strong>1. 基本介绍</strong></h2> 
<h3><strong>1.1 窗口函数介绍</strong></h3> 
<p>窗口函数是SQL中的一种强大工具，用于在查询结果中进行分析和计算。</p> 
<p>与常规聚合函数不同，窗口函数可以在不影响查询结果集的情况下，对结果集中的每一行应用函数，生成额外的信息，例如排名、累计和等。这些函数可以<strong>根据定义的窗口范围动态地计算值，而不是像常规聚合函数那样对整个数据集进行计算。</strong></p> 
<p><strong>窗口函数通常与OVER子句一起使用，OVER子句定义了窗口的范围，可以指定分区、排序规则等。</strong></p> 
<h3><strong>1.2 窗口函数分类</strong></h3> 
<p>窗口函数可以分为<strong>排序窗口函数</strong>和<strong>统计窗口函数</strong>两大类。</p> 
<p>排序窗口函数主要用于对数据进行排序和排名，包括row_number、rank、dense_rank、percent_rank、ntile；</p> 
<p>统计窗口函数则用于进行统计计算，包括count、sum、avg、min、max、first_value、last_value、lag、lead、cume_dist。</p> 
<h2><strong>2. 样例数据</strong></h2> 
<h3><strong>2.1 样例数据SQL</strong></h3> 
<pre><code>CREATE TABLE Sales (</code><code>    id INT,</code><code>    region VARCHAR(50),</code><code>    amount DECIMAL(10, 2)</code><code>);</code>
<code>INSERT INTO Sales (id, region, amount) VALUES</code><code>(1, 'North', 1000.50),</code><code>(2, 'North', 1500.75),</code><code>(3, 'South', 800.25),</code><code>(4, 'West', 1200.00),</code><code>(5, 'East', 2000.30);</code>
</pre> 
<h2><strong>3.各个窗口函数介绍</strong></h2> 
<h3><span style="color:#ff9900;"><strong>3.1 row_number</strong></span><strong>（）</strong><span style="color:#ff9900;"><strong>窗口函数</strong></span></h3> 
<p>row_number函数为结果集中的<strong>每一行分配一个唯一的整数</strong>，按照指定的排序顺序进行排列。</p> 
<pre><code>SELECT id, region, amount,<strong> ROW_NUMBER() OVER (ORDER BY amount DESC)</strong> AS row_num</code><code>FROM Sales;</code></pre> 
<p></p> 
<p class="img-center"><img alt="图片" height="307" src="https://images2.imgbox.com/4b/ac/hELKuFrz_o.png" width="926"></p> 
<h3 style="background-color:transparent;"><span style="color:#ff9900;"><strong>3.2 rank </strong></span><strong>（）</strong><span style="color:#ff9900;"><strong>窗口函数</strong></span></h3> 
<p>rank函数为结果集中的<strong>每一行分配一个排名，如果有相同数值，则会跳过相同排名并继续递增</strong>。<strong>（不连续排名）</strong></p> 
<p>rank()函数的结果是：1, 2,<strong> 3, 3, 5,</strong> 6。</p> 
<pre><code>SELECT id, region, amount, <strong>RANK() OVER (ORDER BY amount DESC) </strong>AS rank</code><code>FROM Sales;</code></pre> 
<p></p> 
<p class="img-center"><img alt="图片" height="306" src="https://images2.imgbox.com/97/2c/AtMF49cj_o.png" width="920"></p> 
<h4><strong>分区</strong></h4> 
<p><code>RANK() OVER (PARTITION BY column ORDER BY column) AS rank_column</code></p> 
<ul><li><code>PARTITION BY</code> 子句用于指定分区列，根据该列的值将数据分成不同的分区。</li><li><code>ORDER BY</code> 子句用于指定排序列，根据该列的值对每个分区内的行进行排序。</li></ul> 
<h3><span style="color:#ff9900;"><strong>3.3 dense_rank</strong></span><strong>（）</strong><span style="color:#ff9900;"><strong>窗口函数</strong></span></h3> 
<p><br> dense_rank函数为结果集中的<strong>每一行分配一个排名，</strong>与rank函数类似，但是在遇到相同数值时，<strong>dense_rank不会跳过相同排名，而是连续分配相同的排名</strong>。<strong>(连续排名）</strong></p> 
<p>dense_rank()函数的结果是：1, 2,<strong> 3, 3, 4,</strong> 5</p> 
<pre><code>SELECT id, region, amount, <strong>DENSE_RANK() OVER (ORDER BY amount DESC)</strong> AS dense_rank</code><code>FROM Sales;</code></pre> 
<p></p> 
<p class="img-center"><img alt="图片" height="306" src="https://images2.imgbox.com/d6/2c/arxpEIX0_o.png" width="921"></p> 
<p></p> 
<h3><strong><span style="color:#ff9900;">3.4 percent_rank</span>（）</strong><span style="color:#ff9900;"><strong>窗口函数</strong></span></h3> 
<p>percent_rank函数<strong>计算每一行在排序结果中的相对排名，返回一个介于0和1之间的小数值，用来表示行在排序结果中的相对位置。</strong></p> 
<pre><code>SELECT id, region, amount, <strong>PERCENT_RANK() OVER (ORDER BY amount DESC) </strong>AS percent_rank</code><code>FROM Sales;</code></pre> 
<p></p> 
<p class="img-center"><img alt="图片" height="310" src="https://images2.imgbox.com/b8/08/zwPlv3FV_o.png" width="921"></p> 
<p></p> 
<h3><span style="color:#ff9900;">3.5 ntile（n）窗口函数</span></h3> 
<p>ntile函数<strong>将结果集分割成指定数量的桶，并为每个桶分配一个编号，确保每个桶中的行数量尽可能均匀。</strong></p> 
<p></p> 
<pre><code>SELECT id, region, amount, <strong>NTILE(2) OVER (ORDER BY amount DESC) </strong>AS ntile</code><code>FROM Sales;</code></pre> 
<p></p> 
<p class="img-center"><img alt="图片" height="310" src="https://images2.imgbox.com/f8/c0/C6lrqEcT_o.png" width="921"></p> 
<p></p> 
<h3><strong>3.6 count</strong><code>(*)</code><strong>窗口函数</strong></h3> 
<p> count函数计算结果集中行的数量，可以结合分组函数使用，用于统计分组内的行数。</p> 
<pre><code>SELECT id, region, amount,<strong> COUNT(*) OVER (PARTITION BY region)</strong> AS region_count</code><code>FROM Sales;</code></pre> 
<p></p> 
<p class="img-center"><img alt="图片" height="308" src="https://images2.imgbox.com/4e/9f/Gtt7dNXU_o.png" width="920"></p> 
<p></p> 
<h3><span style="color:#ff9900;">3.7 sum( ) 窗口函数</span></h3> 
<p>sum函数计算指定列的总和，并将结果添加到每一行。</p> 
<pre><code>SELECT id, region, amount, <strong>SUM(amount) OVER () AS </strong>total_sales</code><code>FROM Sales;</code></pre> 
<p></p> 
<p class="img-center"><img alt="图片" height="306" src="https://images2.imgbox.com/4f/9f/zJhMiwII_o.png" width="921"></p> 
<p></p> 
<h3><span style="color:#ff9900;"><strong>3.8 min() 窗口函数</strong></span></h3> 
<p>min函数计算指定列的最小值，并将结果添加到每一行。</p> 
<pre><code>SELECT id, region, amount, MIN(amount) OVER () AS min_amount</code><code>FROM Sales;</code></pre> 
<p></p> 
<p class="img-center"><img alt="图片" height="308" src="https://images2.imgbox.com/b8/4f/C9LG4qza_o.png" width="922"></p> 
<p></p> 
<h3><strong>3.9 max() 窗口函数</strong></h3> 
<p>max函数计算指定列的最大值，并将结果添加到每一行。</p> 
<pre><code>SELECT id, region, amount, <strong>MAX(amount) OVER () </strong>AS max_amount</code><code>FROM Sales;</code></pre> 
<p></p> 
<p class="img-center"><img alt="图片" height="303" src="https://images2.imgbox.com/7f/4f/4sxOufVJ_o.png" width="916"></p> 
<p></p> 
<h3><strong>3.10 avg () 窗口函数</strong></h3> 
<p>avg函数计算指定列的平均值，并将结果添加到每一行。</p> 
<pre><code>SELECT id, region, amount, <strong>AVG(amount) OVER () </strong>AS avg_amount</code><code>FROM Sales;</code></pre> 
<p></p> 
<p class="img-center"><img alt="图片" height="306" src="https://images2.imgbox.com/14/55/pyENU9Az_o.png" width="917"></p> 
<h2><strong>3.11 first_value () 窗口函数</strong></h2> 
<p>first_value() 函数返回分组内的第一个值，并将其添加到每一行。</p> 
<pre><code>SELECT id, region, amount, FIRST_VALUE(amount) OVER (PARTITION BY region ORDER BY id) AS first_amount</code><code>FROM Sales;</code></pre> 
<p></p> 
<p class="img-center"><img alt="图片" height="307" src="https://images2.imgbox.com/8f/bd/YbYLzeZ8_o.png" width="913"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bdcfbe98401aedfb0a7f4d646d47793b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ai绘画软件有哪些？九款创新绘画软件赋予青春新表达</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ed3af5128d117b34171a2ed253a37821/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Mac 利用Homebrew安装JDK</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>