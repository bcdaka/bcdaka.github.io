<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringBoot中整合RabbitMQ（测试&#43;部署上线 最完整） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f9390d301325c196940e5b6063d5e587/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="SpringBoot中整合RabbitMQ（测试&#43;部署上线 最完整）">
  <meta property="og:description" content="目录
一、RabbitMQ安装
二、启动RabbitMQ
三、编写Java代码\
1、引入依赖
2、配置yml
3、配置消息转换器
4、编写接收方接收消息
5、编写发送方发送消息
6、小程序验证
三、宝塔中安装RabbitMQ
1、下载erlang
（1）查看rabbitmq的版本
（2）查找erlang兼容版本
（3）安装RPM包
2、前往宝塔面板
3、安装RabbitMQ
四、docker中安装rabbitmq
1、安装docker
2、配置docker镜像加速
3、拉取RabbitMQ镜像
4、运行RabbitMQ
5、查看镜像和容器
6、开放客户端服务
7、登录RabbitMQ客户端
8、创建虚拟主机
五、部署项目验证
六、拓展使用
一、RabbitMQ安装 由于在测试环境中，我们现在虚拟机上基于docker安装mq
docker run \ -e RABBITMQ_DEFAULT_USER=quick \ -e RABBITMQ_DEFAULT_PASS=123 \ -v mq-plugins:/plugins \ --name mq \ --hostname mq \ -p 15672:15672 \ -p 5672:5672 \ --network your-net\ -d \ rabbitmq:3.8-management 在docker环境上运行改指令
前两个是登录的用户名密码
network是连接的网络，如果用默认网络的话就不需要写
最后一个是版本，这个是目前测试的版本
二、启动RabbitMQ 由于目前是测试阶段，这里我使用之前学习的时候的版本。
创建新用户后重新登陆，然后创建一个单独的 Virtual Hosts （虚拟主机）来进行隔离。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-20T00:23:11+08:00">
    <meta property="article:modified_time" content="2024-08-20T00:23:11+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringBoot中整合RabbitMQ（测试&#43;部署上线 最完整）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:40px;"></p> 
<p id="%E4%B8%80%E3%80%81RabbitMQ%E5%AE%89%E8%A3%85-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81RabbitMQ%E5%AE%89%E8%A3%85" rel="nofollow">一、RabbitMQ安装</a></p> 
<p id="%E4%BA%8C%E3%80%81%E5%90%AF%E5%8A%A8RabbitMQ-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81%E5%90%AF%E5%8A%A8RabbitMQ" rel="nofollow">二、启动RabbitMQ</a></p> 
<p id="%E4%B8%89%E3%80%81%E7%BC%96%E5%86%99Java%E4%BB%A3%E7%A0%81%5C-toc" style="margin-left:40px;"><a href="#%E4%B8%89%E3%80%81%E7%BC%96%E5%86%99Java%E4%BB%A3%E7%A0%81%5C" rel="nofollow">三、编写Java代码\</a></p> 
<p id="1%E3%80%81%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96-toc" style="margin-left:120px;"><a href="#1%E3%80%81%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96" rel="nofollow">1、引入依赖</a></p> 
<p id="2%E3%80%81%E9%85%8D%E7%BD%AEyml-toc" style="margin-left:120px;"><a href="#2%E3%80%81%E9%85%8D%E7%BD%AEyml" rel="nofollow">2、配置yml</a></p> 
<p id="3%E3%80%81%E9%85%8D%E7%BD%AE%E6%B6%88%E6%81%AF%E8%BD%AC%E6%8D%A2%E5%99%A8-toc" style="margin-left:120px;"><a href="#3%E3%80%81%E9%85%8D%E7%BD%AE%E6%B6%88%E6%81%AF%E8%BD%AC%E6%8D%A2%E5%99%A8" rel="nofollow">3、配置消息转换器</a></p> 
<p id="4%E3%80%81%E7%BC%96%E5%86%99%E6%8E%A5%E6%94%B6%E6%96%B9%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF-toc" style="margin-left:120px;"><a href="#4%E3%80%81%E7%BC%96%E5%86%99%E6%8E%A5%E6%94%B6%E6%96%B9%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF" rel="nofollow">4、编写接收方接收消息</a></p> 
<p id="5%E3%80%81%E7%BC%96%E5%86%99%E5%8F%91%E9%80%81%E6%96%B9%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF-toc" style="margin-left:120px;"><a href="#5%E3%80%81%E7%BC%96%E5%86%99%E5%8F%91%E9%80%81%E6%96%B9%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF" rel="nofollow">5、编写发送方发送消息</a></p> 
<p id="6%E3%80%81%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%AA%8C%E8%AF%81-toc" style="margin-left:120px;"><a href="#6%E3%80%81%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%AA%8C%E8%AF%81" rel="nofollow">6、小程序验证</a></p> 
<p id="%E4%B8%89%E3%80%81%E5%AE%9D%E5%A1%94%E4%B8%AD%E5%AE%89%E8%A3%85RabbitMQ-toc" style="margin-left:40px;"><a href="#%E4%B8%89%E3%80%81%E5%AE%9D%E5%A1%94%E4%B8%AD%E5%AE%89%E8%A3%85RabbitMQ" rel="nofollow">三、宝塔中安装RabbitMQ</a></p> 
<p id="1%E3%80%81%E4%B8%8B%E8%BD%BDerlang-toc" style="margin-left:120px;"><a href="#1%E3%80%81%E4%B8%8B%E8%BD%BDerlang" rel="nofollow">1、下载erlang</a></p> 
<p id="%EF%BC%881%EF%BC%89%E6%9F%A5%E7%9C%8Brabbitmq%E7%9A%84%E7%89%88%E6%9C%AC-toc" style="margin-left:160px;"><a href="#%EF%BC%881%EF%BC%89%E6%9F%A5%E7%9C%8Brabbitmq%E7%9A%84%E7%89%88%E6%9C%AC" rel="nofollow">（1）查看rabbitmq的版本</a></p> 
<p id="%EF%BC%882%EF%BC%89%E6%9F%A5%E6%89%BEerlang%E5%85%BC%E5%AE%B9%E7%89%88%E6%9C%AC-toc" style="margin-left:160px;"><a href="#%EF%BC%882%EF%BC%89%E6%9F%A5%E6%89%BEerlang%E5%85%BC%E5%AE%B9%E7%89%88%E6%9C%AC" rel="nofollow">（2）查找erlang兼容版本</a></p> 
<p id="%EF%BC%883%EF%BC%89%E5%AE%89%E8%A3%85RPM%E5%8C%85-toc" style="margin-left:160px;"><a href="#%EF%BC%883%EF%BC%89%E5%AE%89%E8%A3%85RPM%E5%8C%85" rel="nofollow">（3）安装RPM包</a></p> 
<p id="2%E3%80%81%E5%89%8D%E5%BE%80%E5%AE%9D%E5%A1%94%E9%9D%A2%E6%9D%BF-toc" style="margin-left:120px;"><a href="#2%E3%80%81%E5%89%8D%E5%BE%80%E5%AE%9D%E5%A1%94%E9%9D%A2%E6%9D%BF" rel="nofollow">2、前往宝塔面板</a></p> 
<p id="3%E3%80%81%E5%AE%89%E8%A3%85RabbitMQ-toc" style="margin-left:120px;"><a href="#3%E3%80%81%E5%AE%89%E8%A3%85RabbitMQ" rel="nofollow">3、安装RabbitMQ</a></p> 
<p id="%E5%9B%9B%E3%80%81docker%E4%B8%AD%E5%AE%89%E8%A3%85rabbitmq-toc" style="margin-left:40px;"><a href="#%E5%9B%9B%E3%80%81docker%E4%B8%AD%E5%AE%89%E8%A3%85rabbitmq" rel="nofollow">四、docker中安装rabbitmq</a></p> 
<p id="1%E3%80%81%E5%AE%89%E8%A3%85docker-toc" style="margin-left:120px;"><a href="#1%E3%80%81%E5%AE%89%E8%A3%85docker" rel="nofollow">1、安装docker</a></p> 
<p id="2%E3%80%81%E9%85%8D%E7%BD%AEdocker%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F-toc" style="margin-left:120px;"><a href="#2%E3%80%81%E9%85%8D%E7%BD%AEdocker%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F" rel="nofollow">2、配置docker镜像加速</a></p> 
<p id="3%E3%80%81%E6%8B%89%E5%8F%96RabbitMQ%E9%95%9C%E5%83%8F-toc" style="margin-left:120px;"><a href="#3%E3%80%81%E6%8B%89%E5%8F%96RabbitMQ%E9%95%9C%E5%83%8F" rel="nofollow">3、拉取RabbitMQ镜像</a></p> 
<p id="4%E3%80%81%E8%BF%90%E8%A1%8CRabbitMQ-toc" style="margin-left:120px;"><a href="#4%E3%80%81%E8%BF%90%E8%A1%8CRabbitMQ" rel="nofollow">4、运行RabbitMQ</a></p> 
<p id="5%E3%80%81%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F%E5%92%8C%E5%AE%B9%E5%99%A8-toc" style="margin-left:120px;"><a href="#5%E3%80%81%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F%E5%92%8C%E5%AE%B9%E5%99%A8" rel="nofollow">5、查看镜像和容器</a></p> 
<p id="6%E3%80%81%E5%BC%80%E6%94%BE%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%8D%E5%8A%A1-toc" style="margin-left:120px;"><a href="#6%E3%80%81%E5%BC%80%E6%94%BE%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%8D%E5%8A%A1" rel="nofollow">6、开放客户端服务</a></p> 
<p id="7%E3%80%81%E7%99%BB%E5%BD%95RabbitMQ%E5%AE%A2%E6%88%B7%E7%AB%AF-toc" style="margin-left:120px;"><a href="#7%E3%80%81%E7%99%BB%E5%BD%95RabbitMQ%E5%AE%A2%E6%88%B7%E7%AB%AF" rel="nofollow">7、登录RabbitMQ客户端</a></p> 
<p id="8%E3%80%81%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA-toc" style="margin-left:120px;"><a href="#8%E3%80%81%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA" rel="nofollow">8、创建虚拟主机</a></p> 
<p id="%E4%BA%94%E3%80%81%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE%E9%AA%8C%E8%AF%81-toc" style="margin-left:40px;"><a href="#%E4%BA%94%E3%80%81%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE%E9%AA%8C%E8%AF%81" rel="nofollow">五、部署项目验证</a></p> 
<p id="%E5%85%AD%E3%80%81%E6%8B%93%E5%B1%95%E4%BD%BF%E7%94%A8-toc" style="margin-left:40px;"><a href="#%E5%85%AD%E3%80%81%E6%8B%93%E5%B1%95%E4%BD%BF%E7%94%A8" rel="nofollow">六、拓展使用</a></p> 
<hr id="hr-toc"> 
<h3 id="%E4%B8%80%E3%80%81RabbitMQ%E5%AE%89%E8%A3%85" style="background-color:transparent;">一、RabbitMQ安装</h3> 
<p>由于在测试环境中，我们现在虚拟机上基于docker安装mq</p> 
<pre><code>docker run \
 -e RABBITMQ_DEFAULT_USER=quick \
 -e RABBITMQ_DEFAULT_PASS=123 \
 -v mq-plugins:/plugins \
 --name mq \
 --hostname mq \
 -p 15672:15672 \
 -p 5672:5672 \
 --network your-net\
 -d \
 rabbitmq:3.8-management</code></pre> 
<blockquote> 
 <p>在docker环境上运行改指令</p> 
 <p>前两个是登录的用户名密码</p> 
 <p>network是连接的网络，如果用默认网络的话就不需要写</p> 
 <p>最后一个是版本，这个是目前测试的版本</p> 
</blockquote> 
<h3 id="%E4%BA%8C%E3%80%81%E5%90%AF%E5%8A%A8RabbitMQ">二、启动RabbitMQ</h3> 
<p><img alt="" height="428" src="https://images2.imgbox.com/4a/a0/OmBfm8Um_o.png" width="1200"></p> 
<p>由于目前是测试阶段，这里我使用之前学习的时候的版本。</p> 
<p><img alt="" height="986" src="https://images2.imgbox.com/c4/a2/cUy2VePT_o.png" width="1200"></p> 
<p><img alt="" height="985" src="https://images2.imgbox.com/cd/7a/Qq8EZwM7_o.png" width="1200"></p> 
<p>创建新用户后重新登陆，然后创建一个单独的 <em><strong>Virtual Hosts （虚拟主机）</strong></em>来进行隔离。</p> 
<p><img alt="" height="1001" src="https://images2.imgbox.com/19/02/pLnmtVZn_o.png" width="1200"></p> 
<h3 id="%E4%B8%89%E3%80%81%E7%BC%96%E5%86%99Java%E4%BB%A3%E7%A0%81%5C">三、编写Java代码\</h3> 
<h5 id="1%E3%80%81%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96">1、引入依赖</h5> 
<pre><code class="language-XML">        &lt;!--rabbitmq--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre> 
<h5 id="2%E3%80%81%E9%85%8D%E7%BD%AEyml">2、配置yml</h5> 
<pre><code class="language-XML">spring:
  rabbitmq:
    host: ${quick.rabbitmq.host}
    port: ${quick.rabbitmq.port} # 端口
    virtual-host: ${quick.rabbitmq.virtual-host} # 虚拟主机
    username: ${quick.rabbitmq.username} # 用户名
    password: ${quick.rabbitmq.password} # 密码</code></pre> 
<pre><code class="language-XML">quick:
  rabbitmq:
    host: 192.168.75.101 #服务器ip地址（此处为虚拟机地址）
    port: 5672 # 端口
    virtual-host: /xxx # 虚拟主机
    username: xxx # 用户名
    password: xxx # 密码
    listener:
      simple:
        acknowledge-mode: auto # 自动ack
        retry:
          enabled: true # 开启消费者失败重试
          initial-interval: 1000ms # 初识的失败等待时长为1秒
          multiplier: 1 # 失败的等待时长倍数，下次等待时长 = multiplier * last-interval
          max-attempts: 3 # 最大重试次数
          stateless: false # true无状态；false有状态。如果业务中包含事务，这里改为false
    publisher-confirm-type: CORRELATED # 交换机的确认
    publisher-returns: true # 队列的确认</code></pre> 
<p></p> 
<h5 id="3%E3%80%81%E9%85%8D%E7%BD%AE%E6%B6%88%E6%81%AF%E8%BD%AC%E6%8D%A2%E5%99%A8">3、配置消息转换器</h5> 
<pre><code class="language-java">/**
 * 配置消息转换器
 */
@Configuration
@ConditionalOnClass(RabbitTemplate.class) //有RabbitTemplate依赖才会生效，否则不生效
public class MqConfig {
    @Bean
    public MessageConverter messageConverter(){
        //使用json序列化发送消息
        return new Jackson2JsonMessageConverter();
    }
}
</code></pre> 
<h5 id="4%E3%80%81%E7%BC%96%E5%86%99%E6%8E%A5%E6%94%B6%E6%96%B9%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF">4、编写接收方接收消息</h5> 
<p><img alt="" height="991" src="https://images2.imgbox.com/7c/2a/o7KzNcGz_o.png" width="1200"></p> 
<pre><code class="language-java">/**
 * 接收消息
 */
@Component
@RequiredArgsConstructor
public class StoreListener {

    private final IStoreService storeService;

    @RabbitListener(bindings = @QueueBinding(
            value = @Queue(name = "store.addFavorite.success.queue", durable = "true"), // 队列 起名规则（服务名+业务名+成功+队列），durable持久化
            exchange = @Exchange(name = "addFavorite.direct"), // 交换机名称，交换机默认类型就行direct，所以不用配置direct
            key = "addFavorite.success" // 绑定的key
    ))
    public void listenAddFavoriteCountsSuccess(Long storeId){
        storeService.updateStoreFavoriteUsersCountAdd1(storeId);
    }

}</code></pre> 
<blockquote> 
 <p>虽然代码里面也已经解释了，但是下面也再解释一下：</p> 
 <p></p> 
 <pre>value：是队列信息。起名规则（服务名+业务名+成功+队列），durable表示持久化</pre> 
 <pre>exchange：是交换机名称。起名规则是（业务名+direct），和发送方一致</pre> 
 <pre>key：绑定的key。起名规则是（业务名+success），表示成功的key，和发送方一致</pre> 
 <p>起名规则是个人而定</p> 
</blockquote> 
<p></p> 
<h5 id="5%E3%80%81%E7%BC%96%E5%86%99%E5%8F%91%E9%80%81%E6%96%B9%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF">5、编写发送方发送消息</h5> 
<p><img alt="" height="849" src="https://images2.imgbox.com/0d/24/piXCSQjO_o.png" width="1200"></p> 
<pre><code class="language-java">@Transactional
    @Override
    public void add(Long storeId) {

        Favorite favorite = Favorite.builder()
                .storeId(storeId)
                .userId(BaseContext.getCurrentId()).build();
        Favorite one = Db.getOne(favorite);
        if (one!=null){
            throw new FavoriteException(MessageConstant.COLLECTION_BE_REPEAT);
        }
        // 更新收藏表
        favoriteMapper.insert(favorite);
        // 更新商品表,收藏数+1
        //storeService.updateStoreFavoriteUsersCountAdd1(storeId);
        // 发送消息 (交换机+绑定的key和发送的消息)
        try {
            rabbitTemplate.convertAndSend("addFavorite.direct","addFavorite.success",storeId);
        } catch (Exception e) {
            log.error("发送添加收藏消息失败，店铺id：{}",storeService,e);
        }

    }</code></pre> 
<blockquote> 
 <p>虽然代码里面也已经解释了，但是下面也再解释一下：</p> 
 <p></p> 
 <pre>"addFavorite.direct"：是交换机名称，和接收方一致</pre> 
 <pre>"addFavorite.success"：是绑定的key，和接收方一致</pre> 
 <pre>storeId：是发送的信息</pre> 
</blockquote> 
<p></p> 
<h5 id="6%E3%80%81%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%AA%8C%E8%AF%81">6、小程序验证</h5> 
<p>点击收藏。</p> 
<p><img alt="" height="937" src="https://images2.imgbox.com/31/b5/4d9v2PXr_o.png" width="688"></p> 
<p><img alt="" height="679" src="https://images2.imgbox.com/71/64/Cv6ZLhd4_o.png" width="662"></p> 
<p>在RabbitMQ的界面中队列也有一条消息出现，说明mq实现异步通讯成功。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/f3/9a/WiBZ9hpb_o.png" width="1200"></p> 
<p>该案例是收藏商品后完成收藏表插入语句后，还要去商品表更新商品表，更新该商品的被收藏数加一，但是如果同步通讯的话，响应会有延迟，可能会对性能造成一定影响，但是通过异步通讯,不需要实时响应，就会对性能有一定的优化。</p> 
<p></p> 
<h3 id="%E4%B8%89%E3%80%81%E5%AE%9D%E5%A1%94%E4%B8%AD%E5%AE%89%E8%A3%85RabbitMQ">三、宝塔中安装RabbitMQ</h3> 
<h5 id="1%E3%80%81%E4%B8%8B%E8%BD%BDerlang">1、下载erlang</h5> 
<blockquote> 
 <p>RabbitMQ服务端是由并发式语言Erlang编写的，所以安装RabbitMQ的之前需要安装Erlang，保证所需要的环境。</p> 
</blockquote> 
<p>安装之前注意版本兼容问题：<a href="https://www.rabbitmq.com/docs/which-erlang" rel="nofollow" title="Erlang Version Requirements | RabbitMQ">Erlang Version Requirements | RabbitMQ</a></p> 
<p>安装erlang地址：<a href="https://www.erlang-solutions.com/downloads/#" rel="nofollow" title="https://www.erlang-solutions.com/downloads/#">https://www.erlang-solutions.com/downloads/#</a></p> 
<h6 id="%EF%BC%881%EF%BC%89%E6%9F%A5%E7%9C%8Brabbitmq%E7%9A%84%E7%89%88%E6%9C%AC">（1）查看rabbitmq的版本</h6> 
<p>先去宝塔查看rabbitmq的版本：</p> 
<p><img alt="" height="947" src="https://images2.imgbox.com/ca/14/B67ZW2Fr_o.png" width="1200"></p> 
<h6 id="%EF%BC%882%EF%BC%89%E6%9F%A5%E6%89%BEerlang%E5%85%BC%E5%AE%B9%E7%89%88%E6%9C%AC">（2）查找erlang兼容版本</h6> 
<p>然后去找到版本兼容的erlang版本：<a href="https://www.rabbitmq.com/docs/which-erlang" rel="nofollow" title="Erlang Version Requirements | RabbitMQ">Erlang Version Requirements | RabbitMQ</a></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/9e/c7/4RakiaXC_o.png" width="1200"></p> 
<h6 id="%EF%BC%883%EF%BC%89%E5%AE%89%E8%A3%85RPM%E5%8C%85">（3）安装RPM包</h6> 
<p>去下载：<a href="https://www.erlang-solutions.com/downloads/#" rel="nofollow" title="https://www.erlang-solutions.com/downloads/#">https://www.erlang-solutions.com/downloads/#</a></p> 
<p> <img alt="" height="1200" src="https://images2.imgbox.com/9a/21/k51Je6Te_o.png" width="1200"></p> 
<p><img alt="" height="875" src="https://images2.imgbox.com/06/af/SOAjOzvK_o.png" width="1200"></p> 
<p>下载后拿到rpm文件：</p> 
<p><img alt="" height="140" src="https://images2.imgbox.com/82/b6/flkJdhM2_o.png" width="1053"></p> 
<blockquote> 
 <p>注意：这里没有下载的版本，下载需要与自己的版本一致，如果发现启动不了RabbitMQ，请看后面的启动RabbitMQ。</p> 
 <p></p> 
 <p>注意！注意！注意！</p> 
</blockquote> 
<h5 id="2%E3%80%81%E5%89%8D%E5%BE%80%E5%AE%9D%E5%A1%94%E9%9D%A2%E6%9D%BF">2、前往宝塔面板</h5> 
<p>进入tmp目录，将之前的rpm包放进去。</p> 
<p><img alt="" height="1155" src="https://images2.imgbox.com/c5/64/zdMcJaNR_o.png" width="1200"></p> 
<p><img alt="" height="900" src="https://images2.imgbox.com/f2/41/TSdKwP7j_o.png" width="1200"></p> 
<h5 id="3%E3%80%81%E5%AE%89%E8%A3%85RabbitMQ">3、安装RabbitMQ</h5> 
<p>在软件商店中安装RabbitMQ</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/2c/b6/MHnqBvoH_o.png" width="1200"></p> 
<p>出现问题：</p> 
<p><img alt="" height="951" src="https://images2.imgbox.com/43/92/ZWFDecF7_o.png" width="1109"></p> 
<p><img alt="" height="923" src="https://images2.imgbox.com/22/a5/KfLntBLR_o.png" width="1095"></p> 
<p>看到报错日志，我又去下载报错日志里面的版本。</p> 
<blockquote> 
 <p>再次去：<a href="https://www.erlang-solutions.com/downloads/#" rel="nofollow" title="https://www.erlang-solutions.com/downloads/#">https://www.erlang-solutions.com/downloads/#</a></p> 
 <p>我是centos7，所以下载该版本。那边有点不人性化，我尝试了几次才下载到自己的版本。</p> 
</blockquote> 
<p><img alt="" height="821" src="https://images2.imgbox.com/95/92/u8UTkGs7_o.png" width="1200"></p> 
<p>将之前的哪个rmp文件删掉，再将刚刚下载的rpm文件重命名再次放入tmp目录中</p> 
<p><img alt="" height="744" src="https://images2.imgbox.com/01/97/fJRt4CXm_o.png" width="1200"></p> 
<blockquote> 
 <p>上面我重命名错了，只记得修改后面，下面是再次修改后的结果。</p> 
</blockquote> 
<p><img alt="" height="1034" src="https://images2.imgbox.com/7b/bc/y0fjkdRQ_o.png" width="1200"></p> 
<p>卸载rabbitmq，然后再重新安装一次。</p> 
<blockquote> 
 <p>还是出现报错：</p> 
</blockquote> 
<p><img alt="" height="224" src="https://images2.imgbox.com/c1/4a/sDWzq1yn_o.png" width="1141"></p> 
<p><img alt="" height="939" src="https://images2.imgbox.com/1e/29/Jg4CPIuY_o.png" width="1120"></p> 
<p>出现了这个报错，很莫名其妙，然后我就去用docker安装，有解决办法的可以评论一下。</p> 
<blockquote> 
 <p>在其他教程到这一步已经可以了，可以参考下面两篇博客：</p> 
 <p><a href="https://blog.csdn.net/xiaoqiang812/article/details/140799241" title="宝塔面板安装RabbitMQ（已解决）_宝塔安装rabbitmq-CSDN博客">宝塔面板安装RabbitMQ（已解决）_宝塔安装rabbitmq-CSDN博客</a></p> 
 <p><a href="https://blog.csdn.net/hj1043/article/details/140070902?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-5-140070902-blog-137695944.235%5Ev43%5Epc_blog_bottom_relevance_base7&amp;spm=1001.2101.3001.4242.4&amp;utm_relevant_index=8" title="宝塔安装rabbitMQ实战-CSDN博客">宝塔安装rabbitMQ实战-CSDN博客</a></p> 
</blockquote> 
<h3 id="%E5%9B%9B%E3%80%81docker%E4%B8%AD%E5%AE%89%E8%A3%85rabbitmq">四、docker中安装rabbitmq</h3> 
<h5 id="1%E3%80%81%E5%AE%89%E8%A3%85docker">1、安装docker</h5> 
<h5 id="2%E3%80%81%E9%85%8D%E7%BD%AEdocker%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F">2、配置docker镜像加速</h5> 
<pre><code class="language-XML"># 创建目录
mkdir -p /etc/docker

# 复制内容，注意把其中的镜像加速地址改成你自己的
tee /etc/docker/daemon.json &lt;&lt;-'EOF'
{
    "registry-mirrors": [
        "http://hub-mirror.c.163.com",
        "https://mirrors.tuna.tsinghua.edu.cn",
        "http://mirrors.sohu.com",
        "https://ustc-edu-cn.mirror.aliyuncs.com",
        "https://ccr.ccs.tencentyun.com",
        "https://docker.m.daocloud.io",
        "https://docker.awsl9527.cn"
    ]
}
EOF

# 重新加载配置
systemctl daemon-reload

# 重启Docker
systemctl restart docker</code></pre> 
<h5 id="3%E3%80%81%E6%8B%89%E5%8F%96RabbitMQ%E9%95%9C%E5%83%8F">3、拉取RabbitMQ镜像</h5> 
<pre><code class="language-XML">docker pull rabbitmq
</code></pre> 
<p><img alt="" height="980" src="https://images2.imgbox.com/55/d5/EhHUyMMd_o.png" width="887"></p> 
<h5 id="4%E3%80%81%E8%BF%90%E8%A1%8CRabbitMQ">4、运行RabbitMQ</h5> 
<pre><code class="language-XML">docker run \
 -e RABBITMQ_DEFAULT_USER=quick \
 -e RABBITMQ_DEFAULT_PASS=quick \
 -v mq-plugins:/plugins \
 --name mq \
 --hostname mq \
 -p 15672:15672 \
 -p 5672:5672 \
 -d \
 rabbitmq</code></pre> 
<p><img alt="" height="736" src="https://images2.imgbox.com/eb/b3/cXsgzUwv_o.png" width="1200"></p> 
<h5 id="5%E3%80%81%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F%E5%92%8C%E5%AE%B9%E5%99%A8">5、查看镜像和容器</h5> 
<pre><code class="language-XML">docker images
docker ps</code></pre> 
<p><img alt="" height="230" src="https://images2.imgbox.com/5a/7d/SfyjUKbF_o.png" width="1200"></p> 
<p>到这里已经是成功在docker中装好mq容器了</p> 
<p>但是在我访问http://主机ip:15672的时候却无法访问，即使我开放了服务器的安全组。后来猜到应该是客户端服务可能是没开启，在之前宝塔软件里面好像有看过这个东西。</p> 
<p><img alt="" height="773" src="https://images2.imgbox.com/a8/66/8P6yH0IA_o.png" width="1200"></p> 
<p><img alt="" height="1051" src="https://images2.imgbox.com/ed/32/eqsmWaGZ_o.png" width="1200"></p> 
<h5 id="6%E3%80%81%E5%BC%80%E6%94%BE%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9C%8D%E5%8A%A1">6、开放客户端服务</h5> 
<p>在mq容器中打开终端</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/35/e4/9Ju1NTN4_o.png" width="1200"></p> 
<p>列出所有可用的插件：</p> 
<pre><code class="language-XML">rabbitmq-plugins list
</code></pre> 
<p>找到rabbitmq_management：</p> 
<p><img alt="" height="854" src="https://images2.imgbox.com/6c/4b/5RSstS3i_o.png" width="1200"></p> 
<p>开启rabbitmq_management：</p> 
<pre><code class="language-XML">rabbitmq-plugins enable rabbitmq_management</code></pre> 
<p><img alt="" height="879" src="https://images2.imgbox.com/60/cb/oFnd4xhv_o.png" width="1200"></p> 
<p>然后再访问客户端，成功访问：</p> 
<p><img alt="" height="277" src="https://images2.imgbox.com/95/f1/xKyx4vFy_o.png" width="1110"></p> 
<h5 id="7%E3%80%81%E7%99%BB%E5%BD%95RabbitMQ%E5%AE%A2%E6%88%B7%E7%AB%AF">7、登录RabbitMQ客户端</h5> 
<p><img alt="" height="1029" src="https://images2.imgbox.com/6b/9d/OXxHTs2F_o.png" width="1200"></p> 
<p>这里显示有些特性标志未开启，我们可以去开启那些标志。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/db/73/wZzNP6Lz_o.png" width="1200"></p> 
<p>参考博客：<a href="https://blog.csdn.net/weixin_66081834/article/details/136841480" title="Docker RabbitMQ安装_all stable feature flags must be enabled after com-CSDN博客">Docker RabbitMQ安装_all stable feature flags must be enabled after com-CSDN博客</a></p> 
<h5 id="8%E3%80%81%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA">8、创建虚拟主机</h5> 
<p>创建一个单独的虚拟主机来进行隔离，这里可以参考前面在虚拟机上的操作。</p> 
<h3 id="%E4%BA%94%E3%80%81%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE%E9%AA%8C%E8%AF%81">五、部署项目验证</h3> 
<p>参考我之前的博客：<a href="https://blog.csdn.net/qq_73440769/article/details/139926666?spm=1001.2014.3001.5501" title="记录部署项目《庆自提》完整流程-CSDN博客">记录部署项目《庆自提》完整流程-CSDN博客</a></p> 
<p></p> 
<p>修改yml配置文件，修改下面的消息：</p> 
<pre><code class="language-XML">  rabbitmq:
    host: ${quick.rabbitmq.host}
    port: ${quick.rabbitmq.port} # 端口
    virtual-host: ${quick.rabbitmq.virtual-host} # 虚拟主机
    username: ${quick.rabbitmq.username} # 用户名
    password: ${quick.rabbitmq.password} # 密码</code></pre> 
<p>在已经上线的小程序测试~~</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/e4/85/2QPCn0sg_o.png" width="661"></p> 
<p><img alt="" height="219" src="https://images2.imgbox.com/be/56/tbkVLthC_o.png" width="1200"></p> 
<p>目前只有一个人收藏，现在去测试一下。</p> 
<p><img alt="" height="1175" src="https://images2.imgbox.com/fd/7c/ejMOI32y_o.png" width="609"></p> 
<p><img alt="" height="1176" src="https://images2.imgbox.com/fb/55/nnSyx0kd_o.png" width="616"></p> 
<p>收藏成功，去看一下数据库，查看是否更新。</p> 
<p><img alt="" height="209" src="https://images2.imgbox.com/93/ea/yA13zWsV_o.png" width="1200"></p> 
<p>去查看mq客户端：</p> 
<p><img alt="" height="700" src="https://images2.imgbox.com/c6/47/Eh2qFuqn_o.png" width="1200"></p> 
<p><img alt="" height="1117" src="https://images2.imgbox.com/c0/24/LTsgiWjx_o.png" width="1200"></p> 
<p>成功更新，说明使用RabbitMQ实现异步通讯成功。</p> 
<p></p> 
<h3 id="%E5%85%AD%E3%80%81%E6%8B%93%E5%B1%95%E4%BD%BF%E7%94%A8">六、拓展使用</h3> 
<blockquote> 
 <p>关于一些拓展使用可以参考以下这些博客：</p> 
 <p><a href="https://blog.csdn.net/qq_73440769/article/details/141176299?spm=1001.2014.3001.5501" title="RabbitMQ实现多线程处理接收消息-CSDN博客">RabbitMQ实现多线程处理接收消息-CSDN博客</a></p> 
</blockquote> 
<p></p> 
<blockquote> 
 <p>在配置mq过程中遇到许许多多的bug和问题，改了很久很久，如果里面有哪些不足的欢迎指正和建议！！！</p> 
</blockquote> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8a9372e61d9e6df56305682a26e7a325/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">产品经理-​​实习中的自我迭代(41)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/557d8b11fc0bff4882206930bf76e549/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何引入CSS</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>