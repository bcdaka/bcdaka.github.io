<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Web Components（web组件） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/4c6f4b34190a0b49823ad0ab1748796f/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Web Components（web组件）">
  <meta property="og:description" content="文章目录 web Components的概念和使用使用自定义元素自定义元素类型实现自定义元素注册自定义元素自定义元素的回调函数使用自定义元素添加自定义元素的属性变化自定义元素示例 使用影子Dom影子Dom的原理示意图创建一个影子Domjs隔离css隔离影子Dom和自定义元素补充： 影子根ShadowRoot的相关属性和方法 使用html模板template标签实现自定义元素slots插槽实现自定义元素补充：插槽slot身上的属性和方法 Web Component即web组件，允许创建可重用的定制元素（它们的功能封装在你的代码之外）。就是 组件的功能。 web Components的概念和使用 web Components 可以创建封装了指定功能的定制元素，创建完成之后你可以在任何你喜欢的地方重用。
webComponents的三大组成部分：
自定义元素：定义元素及其行为影子Dom：将封装的“影子”DOM 树附加到元素并控制其关联的功能。使用这种方式保持元素的功能私有，不用担心与文档的其他部分发生冲突。html 模板：&lt;template&gt; 和 &lt;slot&gt; 元素可以作为标记模板 使用自定义元素 自定义元素即由 Web 开发人员自行定义 HTML 元素，扩展浏览器中可用的元素集。
自定义元素类型 有两种类型：
自定义内置元素：继承自标准的 HTML 元素：例如 HTMLImageElement 或 HTMLParagraphElement。它们的实现定义了标准元素的行为。无需从头开始实现行为。独立自定义元素：继承自 HTML 元素基类 HTMLElement。必须从头开始实现它们的行为。 实现自定义元素 自定义元素作为一个类来实现。
在类的构造函数中：
可以设置初始状态和默认值，注册事件监听器，创建一个影子根（shadow root）；
不应检查元素的属性或子元素，也不应添加新的属性或子元素
自定义内置元素实现格式 class WordCount extends HTMLParagraphElement { constructor() { super(); } // 此处编写元素功能 } 独立自定义元素实现格式 class PopupInfo extends HTMLElement { constructor() { super(); } // 此处编写元素功能 } 注册自定义元素 Window.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-30T00:15:45+08:00">
    <meta property="article:modified_time" content="2024-03-30T00:15:45+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Web Components（web组件）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#web_Components_3" rel="nofollow">web Components的概念和使用</a></li><li><ul><li><a href="#_10" rel="nofollow">使用自定义元素</a></li><li><ul><li><a href="#_12" rel="nofollow">自定义元素类型</a></li><li><a href="#_18" rel="nofollow">实现自定义元素</a></li><li><a href="#_44" rel="nofollow">注册自定义元素</a></li><li><a href="#_54" rel="nofollow">自定义元素的回调函数</a></li><li><a href="#_78" rel="nofollow">使用自定义元素</a></li><li><a href="#_93" rel="nofollow">添加自定义元素的属性变化</a></li><li><a href="#_119" rel="nofollow">自定义元素示例</a></li></ul> 
   </li><li><a href="#Dom_314" rel="nofollow">使用影子Dom</a></li><li><ul><li><a href="#Dom_317" rel="nofollow">影子Dom的原理示意图</a></li><li><a href="#Dom_329" rel="nofollow">创建一个影子Dom</a></li><li><a href="#js_355" rel="nofollow">js隔离</a></li><li><a href="#css_385" rel="nofollow">css隔离</a></li><li><a href="#Dom_443" rel="nofollow">影子Dom和自定义元素</a></li><li><a href="#__ShadowRoot_487" rel="nofollow">补充： 影子根ShadowRoot的相关属性和方法</a></li></ul> 
   </li><li><a href="#html_496" rel="nofollow">使用html模板</a></li><li><ul><li><a href="#template_499" rel="nofollow">template标签实现自定义元素</a></li><li><a href="#slots_551" rel="nofollow">slots插槽实现自定义元素</a></li><li><a href="#slot_617" rel="nofollow">补充：插槽slot身上的属性和方法</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<br> Web Component即web组件，允许创建可重用的定制元素（它们的功能封装在你的代码之外）。就是 
<code>组件</code>的功能。 
<p></p> 
<h2><a id="web_Components_3"></a>web Components的概念和使用</h2> 
<p>web Components 可以创建封装了指定功能的定制元素，创建完成之后你可以在任何你喜欢的地方重用。<br> webComponents的三大组成部分：</p> 
<ul><li>自定义元素：定义元素及其行为</li><li>影子Dom：将封装的“影子”DOM 树附加到元素并控制其关联的功能。使用这种方式保持元素的功能私有，不用担心与文档的其他部分发生冲突。</li><li>html 模板：<code>&lt;template&gt;</code> 和 <code>&lt;slot&gt;</code> 元素可以作为标记模板</li></ul> 
<h3><a id="_10"></a>使用自定义元素</h3> 
<p>自定义元素即由 Web 开发人员自行定义 HTML 元素，扩展浏览器中可用的元素集。</p> 
<h4><a id="_12"></a>自定义元素类型</h4> 
<p>有两种类型：</p> 
<ul><li>自定义内置元素：继承自<code>标准的 HTML 元素</code>：例如 <code>HTMLImageElement 或 HTMLParagraphElement</code>。它们的实现定义了标准元素的行为。无需从头开始实现行为。</li><li>独立自定义元素：继承自 <code>HTML 元素基类 HTMLElement</code>。必须从头开始实现它们的行为。</li></ul> 
<h4><a id="_18"></a>实现自定义元素</h4> 
<p>自定义元素作为一个<code>类</code>来实现。</p> 
<p>在类的构造函数中：<br> 可以设置初始状态和默认值，注册事件监听器，创建一个影子根（shadow root）；<br> 不应检查元素的属性或子元素，也不应添加新的属性或子元素</p> 
<ul><li>自定义内置元素实现格式</li></ul> 
<pre><code class="prism language-javascript"><span class="token keyword">class</span> <span class="token class-name">WordCount</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLParagraphElement</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 此处编写元素功能</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>独立自定义元素实现格式</li></ul> 
<pre><code class="prism language-javascript"><span class="token keyword">class</span> <span class="token class-name">PopupInfo</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 此处编写元素功能</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_44"></a>注册自定义元素</h4> 
<p><code>Window.customElements.define(name,constructor,options)</code> 方法。</p> 
<ul><li>name：自定义元素名称</li><li>constructor：自定义元素类</li><li>options：仅对于自定义内置元素，这是一个包含<code>单个属性 extends 的对象</code>，该属性表示要扩展的内置元素。</li></ul> 
<pre><code class="prism language-javascript">customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"word-count"</span><span class="token punctuation">,</span> WordCount<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token string">"p"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"popup-info"</span><span class="token punctuation">,</span> PopupInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_54"></a>自定义元素的回调函数</h4> 
<p>自定义元素生命周期回调包括：</p> 
<ul><li><code>connectedCallback()</code>：每当元素添加到文档中时调用。规范建议开发人员尽可能在此回调中实现自定义元素的设定，而不是在构造函数中实现。</li><li><code>disconnectedCallback()</code>：每当元素从文档中移除时调用。</li><li><code>adoptedCallback()</code>：每当元素被移动到新文档中时调用。</li><li><code>attributeChangedCallback()</code>：在属性更改、添加、移除或替换时调用。</li></ul> 
<p>配置方式，和构造函数同级：</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 为这个元素创建类</span>
<span class="token keyword">class</span> <span class="token class-name">MyCustomElement</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">static</span> observedAttributes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"color"</span><span class="token punctuation">,</span> <span class="token string">"size"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 必须首先调用 super 方法</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"自定义元素添加至页面。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 注册自定义元素</span>
customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"my-custom-element"</span><span class="token punctuation">,</span> MyCustomElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_78"></a>使用自定义元素</h4> 
<ul><li>自定义内置元素的使用<br> 要使用自定义内置元素，请使用内置元素，但将自定义名称作为 is 属性的值：</li></ul> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>word-count<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ul><li>独立自定义元素的使用<br> 使用独立自定义元素，就像使用内置的 HTML 元素一样，使用自定义名称即可：</li></ul> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>popup-info</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 元素的内容 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>popup-info</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="_93"></a>添加自定义元素的属性变化</h4> 
<p>元素的属性修改之后元素也应该响应相应的变化，所以我们需要实现自定义元素的属性变化。<br> 实现自定义元素的属性变化需要在自定义类中添加如下两个内容：</p> 
<ul><li>添加一个名为<code>observedAttributes</code>的静态属性，它是一个数组，里面包含的是标签需要变更通知的所有的属性名称。</li><li>添加<code>attributeChangedCallback()</code> 生命周期回调函数，实现属性变更的相关操作。<br> 回调接受三个参数：发生变化的属性的名称、属性的旧值、属性的新值.<br> attributeChangedCallback() 在元素的首次声明解析时也会被调用。</li></ul> 
<p>eg：</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 为这个元素创建类</span>
<span class="token keyword">class</span> <span class="token class-name">MyCustomElement</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">static</span> observedAttributes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"size"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">attributeChangedCallback</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> oldValue<span class="token punctuation">,</span> newValue</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">属性 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 已由 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>oldValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 变更为 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>newValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">。</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"my-custom-element"</span><span class="token punctuation">,</span> MyCustomElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_119"></a>自定义元素示例</h4> 
<ul><li>定义独立自定义元素</li></ul> 
<p>定义元素js代码</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 为当这个元素创建一个类</span>
<span class="token keyword">class</span> <span class="token class-name">PopupInfo</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 必须首先调用 super 方法</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 创建影子根</span>
    <span class="token keyword">const</span> shadow <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">"open"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建几个 span</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"wrapper"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> icon <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    icon<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"icon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    icon<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"tabindex"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> info <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    info<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"info"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 获取属性内容然后将其放入 info 这个 span 内</span>
    <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"data-text"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    info<span class="token punctuation">.</span>textContent <span class="token operator">=</span> text<span class="token punctuation">;</span>

    <span class="token comment">// 插入图标</span>
    <span class="token keyword">let</span> imgUrl<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      imgUrl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
      imgUrl <span class="token operator">=</span> <span class="token string">"img/default.png"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> imgUrl<span class="token punctuation">;</span>
    icon<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建一些 CSS 应用于影子 DOM</span>
    <span class="token keyword">const</span> style <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"style"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>style<span class="token punctuation">.</span>isConnected<span class="token punctuation">)</span><span class="token punctuation">;</span>

    style<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      .wrapper {
        position: relative;
      }

      .info {
        font-size: 0.8rem;
        width: 200px;
        display: inline-block;
        border: 1px solid black;
        padding: 10px;
        background: white;
        border-radius: 10px;
        opacity: 0;
        transition: 0.6s all;
        position: absolute;
        top: 20px;
        left: 10px;
        z-index: 3;
      }

      img {
        width: 1.2rem;
      }

      .icon:hover + .info, .icon:focus + .info {
        opacity: 1;
      }
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

    <span class="token comment">// 将创建好的元素附加到影子 DOM 上</span>
    shadow<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>style<span class="token punctuation">.</span>isConnected<span class="token punctuation">)</span><span class="token punctuation">;</span>
    shadow<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>icon<span class="token punctuation">)</span><span class="token punctuation">;</span>
    wrapper<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 注册自定义元素</span>
customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"popup-info"</span><span class="token punctuation">,</span> PopupInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>在html中使用</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>popup-info</span>
  <span class="token attr-name">img</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>图片icon地址<span class="token punctuation">"</span></span>
  <span class="token attr-name">data-text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>悬浮显示的文字内容<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>popup-info</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>效果：<br> <img src="https://images2.imgbox.com/9d/b1/YMwyFXDv_o.png" alt="在这里插入图片描述"></p> 
<ul><li>定义自定义内置元素<br> 目标：扩展内置的 <code>&lt;ul&gt;</code> 元素，以支持展开和折叠列表项。<br> 定义js代码：</li></ul> 
<pre><code class="prism language-javascript"><span class="token comment">// 为这个元素创建类</span>
<span class="token keyword">class</span> <span class="token class-name">ExpandingList</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLUListElement</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 必须首先调用 super 方法</span>
    <span class="token comment">// super() 的返回值是对当前元素的引用</span>
    self <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 获取当前自定义 ul 元素的 ul 和 li 子元素</span>
    <span class="token comment">// 包含 ul 的 li 元素可以成为容器</span>
    <span class="token keyword">const</span> uls <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> lis <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"li"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 隐藏所有子 ul</span>
    <span class="token comment">// 当用户点击更高级别的容器时，这些列表就会显示出来</span>
    uls<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ul</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      ul<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"none"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 仔细观察每个在 ul 中的 li 元素</span>
    lis<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">li</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 如果这个 li 有一个 ul 作为子元素，则对其进行装饰并添加一个点击处理程序</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>li<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"ul"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 添加一个属性，以便通过样式使用</span>
        <span class="token comment">// 来显示打开或关闭的图标</span>
        li<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"closed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将 li 元素的文本包裹在一个新的 span 元素中</span>
        <span class="token comment">// 这样我们就可以将样式和事件处理程序分配给 span</span>
        <span class="token keyword">const</span> childText <span class="token operator">=</span> li<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> newSpan <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 从 li 复制文本到 span，设置光标样式</span>
        newSpan<span class="token punctuation">.</span>textContent <span class="token operator">=</span> childText<span class="token punctuation">.</span>textContent<span class="token punctuation">;</span>
        newSpan<span class="token punctuation">.</span>style<span class="token punctuation">.</span>cursor <span class="token operator">=</span> <span class="token string">"pointer"</span><span class="token punctuation">;</span>

        <span class="token comment">// 为这个 span 添加事件处理程序</span>
        newSpan<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// span 的下一个兄弟元素应该是 ul</span>
          <span class="token keyword">const</span> nextul <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>nextElementSibling<span class="token punctuation">;</span>

          <span class="token comment">// 切换可见状态并更新 ul 的 class 属性</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>nextul<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">==</span> <span class="token string">"block"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            nextul<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"none"</span><span class="token punctuation">;</span>
            nextul<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"closed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            nextul<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">"block"</span><span class="token punctuation">;</span>
            nextul<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"class"</span><span class="token punctuation">,</span> <span class="token string">"open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加 span 并从 li 中移除纯文本节点</span>
        childText<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>newSpan<span class="token punctuation">,</span> childText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        childText<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>childText<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//注册元素</span>
customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"expanding-list"</span><span class="token punctuation">,</span> ExpandingList<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token string">"ul"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>html使用：</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>ul is<span class="token operator">=</span><span class="token string">"expanding-list"</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>
        列表<span class="token number">1</span>
        <span class="token operator">&lt;</span>ul is<span class="token operator">=</span><span class="token string">"expanding-list"</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>
            列表<span class="token number">1</span>的第一级子列表<span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span>
            <span class="token operator">&lt;</span>ul is<span class="token operator">=</span><span class="token string">"expanding-list"</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>
                列表<span class="token number">1</span>的第二级子列表<span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span>
                <span class="token operator">&lt;</span>ul is<span class="token operator">=</span><span class="token string">"expanding-list"</span><span class="token operator">&gt;</span>
                  <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>列表<span class="token number">1</span>的第三级子列表<span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
                  <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>列表<span class="token number">1</span>的第三级子列表<span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>列表<span class="token number">1</span>的第二级子列表<span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>
            列表<span class="token number">1</span>的第一级子列表<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span>
            <span class="token operator">&lt;</span>ul is<span class="token operator">=</span><span class="token string">"expanding-list"</span><span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>列表<span class="token number">1</span>的第二级子列表<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
              <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>列表<span class="token number">1</span>的第二级子列表<span class="token number">1</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>列表<span class="token number">2</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
</code></pre> 
<p>效果：<br> <img src="https://images2.imgbox.com/74/1f/oZ09qK45_o.gif" alt="在这里插入图片描述"></p> 
<h3><a id="Dom_314"></a>使用影子Dom</h3> 
<p>影子DOM的作用：保护我们的自定义元素，防止因为在页面的js代码中修改自定义元素的实现而意外地破坏我们的自定义元素。<br> 不设置影子Dom的时候我们自定义的元素就是赤裸裸的放在页面的Dom节点中，谁想修改就可以直接获取元素进行修改，这样很可能破坏我们的自定义元素。而使用影子Dom就可以将我们的自定义元素在页面的Dom中”隐藏“，从而达到保护的效果</p> 
<h4><a id="Dom_317"></a>影子Dom的原理示意图</h4> 
<p>影子 DOM 允许将<code>隐藏的 DOM 树</code>附加到<code>常规 DOM 树中的元素</code>上——这个影子 DOM 始于一个影子根，在其之下你可以用与普通 DOM 相同的方式附加任何元素。</p> 
<p><img src="https://images2.imgbox.com/3e/4d/7D4OMpmt_o.png" alt="在这里插入图片描述"><br> 其中隐藏的dom树是不能通过<code>document.querySelectorAll</code>获取的，需要使用<code>shadowRoot.querySelectorAll</code>获取，同时我们可以设置开关来控制是否能够通过<code>shadowRoot.querySelectorAll</code>获取到元素（mode参数的设置），从而外界无法随意获取改变元素的效果。<br> 如果我们将自定义的元素放置在隐藏的dom树中就可以实现保护的效果。我们需要通过<code>影子Dom</code>将自定义的元素放置在隐藏的dom树。</p> 
<p><strong>几个概念</strong>：</p> 
<ul><li>影子宿主（Shadow host）: 影子 DOM 附加到的常规 DOM 节点。</li><li>影子树（Shadow tree）: 影子 DOM 内部的 DOM 树。</li><li>影子边界（Shadow boundary）: 影子 DOM 终止，常规 DOM 开始的地方。</li><li>影子根（Shadow root）: 影子树的根节点。</li></ul> 
<h4><a id="Dom_329"></a>创建一个影子Dom</h4> 
<p>我们先不讨论自定义元素的情况，先理解普通元素在隐藏dom树的情况。<br> 创建影子Dom的语法：<code>影子宿主.attachShadow({ mode: "open" })</code></p> 
<p><font color="#e79d9d" face="华文新魏" size="4">mode参数的作用：</font><br> 当 mode 设置为 <code>"open"</code> 时，页面中的 JavaScript 可以通过影子宿主的 <code>shadowRoot</code> 属性访问影子 DOM 的内部。<br> 当 mode 设置为 <code>"closed"</code> 时，页面中的 JavaScript 不能访问影子 DOM 的内部。</p> 
<ul><li>下例中将id为host的元素设置为影子宿主创建影子Dom：</li></ul> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>host<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>I'm not in the shadow DOM<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">const</span> host <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">"#host"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> shadow <span class="token operator">=</span> host<span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">"open"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> span <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	span<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">"I'm in the shadow DOM"</span><span class="token punctuation">;</span>
	<span class="token comment">//添加为影子dom节点</span>
	shadow<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>span<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/74/db/gI0T0rBl_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="js_355"></a>js隔离</h4> 
<p>影子Dom和标准Dom使用js获取节点的方式是不一样的，即js获取隔离。</p> 
<ul><li>使用<code>document</code>获取元素是不会获取到影子dom上的节点的。<br> 添加如下js代码</li></ul> 
<pre><code class="prism language-javascript"> <span class="token keyword">const</span> spans <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> span <span class="token keyword">of</span> spans<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    span<span class="token punctuation">.</span>textContent <span class="token operator">=</span> span<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> 
<p>效果是只有标准Dom中的span元素变成大写：<br> <img src="https://images2.imgbox.com/02/a1/ptUHdtT5_o.png" alt="在这里插入图片描述"></p> 
<ul><li>使用<code>shadowRoot</code>可以获取到影子Dom上的节点<br> 语法：<code>影子宿主.shadowRoot.获取元素节点的方法()</code><br> 添加如下js代码</li></ul> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> spans <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>host<span class="token punctuation">.</span>shadowRoot<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> span <span class="token keyword">of</span> spans<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   span<span class="token punctuation">.</span>textContent <span class="token operator">=</span> span<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>效果是只有影子Dom中的span元素变成大写：<br> <img src="https://images2.imgbox.com/c9/c2/U6V5VY8r_o.png" alt="在这里插入图片描述"></p> 
<ul><li>阻止js获取影子Dom上的节点<br> 创建影子Dom的时候只需要设置<code>{mode: "closed"}</code>就可以，此时<code>shadowRoot</code>返回null。</li></ul> 
<h4><a id="css_385"></a>css隔离</h4> 
<p>页面中的style样式对影子Dom中的节点是不起作用的。</p> 
<ul><li>页面中设置如下样式：</li></ul> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">span</span> <span class="token punctuation">{<!-- --></span>
      <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span>173<span class="token punctuation">,</span> 77<span class="token punctuation">,</span> 77<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token property">border</span><span class="token punctuation">:</span> 1px solid black<span class="token punctuation">;</span>
      <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
      <span class="token property">background</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
      <span class="token property">padding</span><span class="token punctuation">:</span> 2px 5px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>效果：<br> <img src="https://images2.imgbox.com/ed/ca/2J9KRMmJ_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>可以使用编程式或声明式的方法为影子Dom添加样式</p> 
  <ul><li>编程式：通过构建一个 <code>CSSStyleSheet</code> 对象并将其附加到影子根。<br> 创建一个空的 <code>CSSStyleSheet</code> 对象<br> 使用 <code>CSSStyleSheet.replace()</code> 或 <code>CSSStyleSheet.replaceSync()</code>设置其内容<br> 通过将其赋给 <code>ShadowRoot.adoptedStyleSheets</code>来添加到影子根</li></ul> <pre><code class="prism language-javascript"><span class="token keyword">const</span> sheet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CSSStyleSheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sheet<span class="token punctuation">.</span><span class="token function">replaceSync</span><span class="token punctuation">(</span><span class="token string">"span { color: red; border: 2px dotted black;}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
shadow<span class="token punctuation">.</span>adoptedStyleSheets <span class="token operator">=</span> <span class="token punctuation">[</span>sheet<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
  <ul><li>声明式<br> 将一个影子Dom的 <code>&lt;style&gt;</code> 样式包含在 <code>&lt;template&gt;</code> 元素中添加到页面上。<br> 然后将该 <code>&lt;template&gt;</code> 元素添加到影子Dom上。</li></ul> <pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-element<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
	    <span class="token selector">span</span> <span class="token punctuation">{<!-- --></span>
	      <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
	      <span class="token property">border</span><span class="token punctuation">:</span> 2px dotted black<span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">const</span> template <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"my-element"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    shadow<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li></ul> 
<p>效果：<br> <img src="https://images2.imgbox.com/31/c2/dBEbHXK1_o.png" alt="在这里插入图片描述"></p> 
<p>就像页面样式就像不会影响影子 DOM 中的元素一样，影子 DOM 样式也不会影响页面中其它元素的样式。</p> 
<h4><a id="Dom_443"></a>影子Dom和自定义元素</h4> 
<p>自定义元素结合使用影子Dom的优点：</p> 
<ul><li>保护自定义元素不被破坏</li><li>为自定义元素提供自己的样式空间</li></ul> 
<p>通常自定义元素本身是一个影子宿主，该元素在其根节点下创建多个元素以供元素的内部实现。</p> 
<p>案例：创建一个绘制圆形的元素</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filled-circle</span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#d46b6b<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filled-circle</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">class</span> <span class="token class-name">FilledCircle</span> <span class="token keyword">extends</span> <span class="token class-name">HTMLElement</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">connectedCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 创建一个影子根</span>
      <span class="token comment">// 自定义元素自身是影子宿主</span>
      <span class="token keyword">const</span> shadow <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">"open"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 创建内部实现</span>
      <span class="token keyword">const</span> svg <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElementNS</span><span class="token punctuation">(</span>
        <span class="token string">"http://www.w3.org/2000/svg"</span><span class="token punctuation">,</span>
        <span class="token string">"svg"</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> circle <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElementNS</span><span class="token punctuation">(</span>
        <span class="token string">"http://www.w3.org/2000/svg"</span><span class="token punctuation">,</span>
        <span class="token string">"circle"</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      circle<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"cx"</span><span class="token punctuation">,</span> <span class="token string">"50"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      circle<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"cy"</span><span class="token punctuation">,</span> <span class="token string">"50"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      circle<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"r"</span><span class="token punctuation">,</span> <span class="token string">"50"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      circle<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"fill"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"color"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      svg<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>circle<span class="token punctuation">)</span><span class="token punctuation">;</span>

      shadow<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>svg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"filled-circle"</span><span class="token punctuation">,</span> FilledCircle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/31/be/VDHtw6PU_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="__ShadowRoot_487"></a>补充： 影子根ShadowRoot的相关属性和方法</h4> 
<p>ShadowRoot的携带很多属性和方法，可以参见<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/ShadowRoot" rel="nofollow">https://developer.mozilla.org/zh-CN/docs/Web/API/ShadowRoot</a></p> 
<ul><li>host： <code>ShadowRoot.host</code>，只读属性，返回对 ShadowRoot 所附加到的 DOM 元素的引用</li><li>mode： <code>ShadowRoot.mode</code>，只读属性，返回其模式打开或关闭。</li><li>activeElement ： <code>Shadow.activeElement </code>只读属性，返回影子树中具有焦点的元素</li></ul> 
<p>等。</p> 
<h3><a id="html_496"></a>使用html模板</h3> 
<p>之前我们定义自定义元素的时候都是在js中编写对应的元素标签，这样写无疑是比较麻烦的，我们希望可以直接在html模板中编写对应的标签和样式，然后自定义组件直接用html模板中的标签定义自己的元素。<br> 常见的使用方法有<code> &lt;template&gt;</code> 和 <code>&lt;slot&gt; </code>元素</p> 
<h4><a id="template_499"></a>template标签实现自定义元素</h4> 
<p>利用template标签不在页面中展示的效果实现自定义元素。</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-paragraph<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>My paragraph<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>上面的代码不会展示在你的页面中，除非使用 JavaScript 获取它，然后添加到 DOM 中，如下面的代码：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> template <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"my-paragraph"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> templateContent <span class="token operator">=</span> template<span class="token punctuation">.</span>content<span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>templateContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>因为template标签中的内容不会展示，自定义元素的时候就可以直接获取template标签中的内容使用，使用js将template标签的内容作为元素展示，并且不会影响其他内容的展示。</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-paragraph<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
	    <span class="token selector">p</span> <span class="token punctuation">{<!-- --></span>
	      <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
	      <span class="token property">background-color</span><span class="token punctuation">:</span> #666<span class="token punctuation">;</span>
	      <span class="token property">padding</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
	  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>My paragraph<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-paragraph</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-paragraph</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span>
	  <span class="token string">"my-paragraph"</span><span class="token punctuation">,</span>
	  <span class="token keyword">class</span> <span class="token class-name">extends</span> HTMLElement <span class="token punctuation">{<!-- --></span>
	    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	      <span class="token comment">//   编写元素内容，这里采取将元素内容编写在html总然后直接获取插入的方法</span>
	      <span class="token keyword">let</span> template <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"my-paragraph"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	      <span class="token keyword">let</span> templateContent <span class="token operator">=</span> template<span class="token punctuation">.</span>content<span class="token punctuation">;</span>
	
	      <span class="token comment">// 创建一个影子根</span>
	      <span class="token keyword">const</span> shadowRoot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">"open"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	      <span class="token comment">// 使用 Node.cloneNode() 方法添加了模板的拷贝到阴影的根结点上</span>
	      shadowRoot<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>templateContent<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	  <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>关键点是使用 <code>Node.cloneNode()</code> 方法添加了模板的拷贝到阴影的根结点上。<br> 效果：<br> <img src="https://images2.imgbox.com/2d/13/vPIhPNOJ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="slots_551"></a>slots插槽实现自定义元素</h4> 
<p>slots插槽由其<code>name</code>属性标识，并且允许你在模板中定义<code>占位符</code>，当在标记中使用该元素时，该占位符可以填充所需的任何 HTML 标记片段。</p> 
<ul><li>占位：</li></ul> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-text<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>My default text<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ul><li>在标记中使用该元素</li></ul> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-paragraph</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-text<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Let's have some different text!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-paragraph</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><code>Let's have some different text!</code>会替换<code>My default text</code>显示。</p> 
<ul><li>自定义标签使用slot插槽：<br> 定义标签的时候slots插槽也需要依赖template标签实现，在template标签中使用slot插槽：</li></ul> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-paragraph<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">p</span> <span class="token punctuation">{<!-- --></span>
          <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
          <span class="token property">background-color</span><span class="token punctuation">:</span> #666<span class="token punctuation">;</span>
          <span class="token property">padding</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-text<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>My default text<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-paragraph</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-paragraph</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-paragraph</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-text<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Let's have some different text!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-paragraph</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>my-paragraph</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>my-text<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Let's have some different text!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>In a list!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>my-paragraph</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    customElements<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span>
      <span class="token string">"my-paragraph"</span><span class="token punctuation">,</span>
      <span class="token keyword">class</span> <span class="token class-name">extends</span> HTMLElement <span class="token punctuation">{<!-- --></span>
        <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">//   编写元素内容，这里采取将元素内容编写在html总然后直接获取插入的方法</span>
          <span class="token keyword">let</span> template <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"my-paragraph"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> templateContent <span class="token operator">=</span> template<span class="token punctuation">.</span>content<span class="token punctuation">;</span>

          <span class="token comment">// 创建一个影子根</span>
          <span class="token keyword">const</span> shadowRoot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attachShadow</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">"open"</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// 添加自定义元素到影子根</span>
          shadowRoot<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>templateContent<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>效果：<br> <img src="https://images2.imgbox.com/52/d2/35kAJ6l8_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="slot_617"></a>补充：插槽slot身上的属性和方法</h4> 
<p>详细参见： <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLSlotElement" rel="nofollow">https://developer.mozilla.org/en-US/docs/Web/API/HTMLSlotElement</a><br> 属性：</p> 
<ul><li>name：插槽的名字</li></ul> 
<p>方法：</p> 
<ul><li>assign()：将插槽的手动分配节点设置为一组有序的插槽表。</li><li>assignedElements()：返回分配给该槽（而不是其他节点）的元素序列。</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5559e333a60a1d1b10e798e8a507c5e2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">uniapp-打包IOS的APP流程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/63883a9be396d6b6eb8896bee20253a1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Kafka学习之：mac 上安装 kafka</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>