<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何在 VPS 上安装 Express（Node.js 框架）并设置 Socket.io - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/58a78756456ef60cf25d752059a50b56/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="如何在 VPS 上安装 Express（Node.js 框架）并设置 Socket.io">
  <meta property="og:description" content="前些天发现了一个巨牛的人工智能学习网站，通俗易懂，风趣幽默，忍不住分享一下给大家。点击跳转到网站。
本文将学到什么 如何使用 Node Version Manager（NVM）安装 NodeJS 0.10.16如何安装 NodeJS 的 Express web 应用程序框架如何设置一个简单的 Express 项目如何在 Express 中设置 socket.io实时向客户端发送简单消息如何使用客户端 JavaScript 监听消息 步骤 1：设置 NodeJS 注意：如果您已经知道已安装了 NodeJS v0.10.16，则可以跳过此步骤
Node Version Manager（NVM）是一个帮助在 Linux 机器上安装各种 NodeJS 版本的工具。为了使用 NVM，请确保已安装 git 和 curl。
使用 SSH 连接到您的 VPS（droplet）。
如果您尚未安装这些软件，请使用系统的软件包管理器进行安装。例如，在 Ubuntu 或 Debian 上，您可以运行：
``` sudo apt-get install curl git ``` 现在，您需要运行 NVM 安装脚本：
curl https://raw.github.com/creationix/nvm/master/install.sh | sh 重要：您现在必须注销并使用 SSH 重新连接到您的服务器。
通过在终端中输入 nvm 来测试 nvm 命令是否有效。如果没有收到 command not found 错误，则已正确设置了 NVM。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-09T00:45:00+08:00">
    <meta property="article:modified_time" content="2024-08-09T00:45:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何在 VPS 上安装 Express（Node.js 框架）并设置 Socket.io</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>前些天发现了一个巨牛的<a href="https://www.captainbed.cn/rubys" rel="nofollow">人工智能学习网站</a>，通俗易懂，风趣幽默，忍不住分享一下给大家。<a href="https://www.captainbed.cn/rubys" rel="nofollow">点击跳转到网站</a>。</p> 
<h4><a id="_2"></a>本文将学到什么</h4> 
<hr> 
<ul><li>如何使用 Node Version Manager（NVM）安装 NodeJS 0.10.16</li><li>如何安装 NodeJS 的 Express web 应用程序框架</li><li>如何设置一个简单的 Express 项目</li><li>如何在 Express 中设置 socket.io</li><li>实时向客户端发送简单消息</li><li>如何使用客户端 JavaScript 监听消息</li></ul> 
<h3><a id="_1_NodeJS_11"></a>步骤 1：设置 NodeJS</h3> 
<hr> 
<p><em>注意：如果您已经知道已安装了 NodeJS v0.10.16，则可以跳过此步骤</em></p> 
<p>Node Version Manager（NVM）是一个帮助在 Linux 机器上安装各种 NodeJS 版本的工具。为了使用 NVM，请确保已安装 <code>git</code> 和 <code>curl</code>。</p> 
<p>使用 SSH 连接到您的 VPS（droplet）。</p> 
<p>如果您尚未安装这些软件，请使用系统的软件包管理器进行安装。例如，在 Ubuntu 或 Debian 上，您可以运行：</p> 
<pre><code>```
sudo apt-get install curl git
```
</code></pre> 
<p>现在，您需要运行 NVM 安装脚本：</p> 
<pre><code>curl https://raw.github.com/creationix/nvm/master/install.sh | sh
</code></pre> 
<p><strong>重要：您现在必须注销并使用 SSH 重新连接到您的服务器。</strong></p> 
<p>通过在终端中输入 <code>nvm</code> 来测试 <code>nvm</code> 命令是否有效。如果没有收到 <code>command not found</code> 错误，则已正确设置了 NVM。</p> 
<p>要安装最新版本的 Node（本文撰写时为 0.10.16），只需输入：</p> 
<pre><code>nvm install 0.10.16
</code></pre> 
<p>然后等待安装完成。如果安装成功，您应该会看到输出：<code>Now using node v0.10.16</code>。</p> 
<p>在终端中输入 <code>node -v</code> 来确保您正在使用指定的版本。您应该会得到输出：<code>v0.10.16</code>。</p> 
<h3><a id="_2_Express_42"></a>步骤 2：设置 Express</h3> 
<hr> 
<p>Express 是 Node 的 Web 应用程序框架。它简洁灵活。要开始使用 Express，您需要使用 NPM 安装该模块。只需简单地输入：</p> 
<pre><code>npm install -g express
</code></pre> 
<p>这将安装 Express 命令行工具，该工具将帮助创建一个基本的 Web 应用程序。安装 Express 后，请按照以下步骤创建一个空的 Express 项目：</p> 
<pre><code>mkdir socketio-test

cd socketio-test

express

npm install
</code></pre> 
<p>这些命令将在我们刚创建的目录中创建一个空的 Express 项目 <code>socketio-test</code>。然后运行 <code>npm install</code> 来获取运行应用程序所需的所有依赖项。要测试空应用程序，请运行 <code>node app</code>，然后在浏览器中导航至 http://yourDropletIp-or-domainName:3000。您应该会收到一个简单的欢迎消息，内容为：“Welcome to Express”。</p> 
<p>如果您看到欢迎消息，则表示您已经准备好并运行了一个基本的 Express 应用程序！</p> 
<p>在继续之前，请确保使用 Ctrl+C 键盘命令关闭您的 VPS。</p> 
<h3><a id="_3_Socketio__Express__65"></a>步骤 3：将 Socket.io 安装到您的 Express 应用程序中</h3> 
<hr> 
<p>首先，简要介绍一下 Socket.io 是什么。Socket.io 是一个实时的 JavaScript 库。简而言之，它是一个 WebSocket API，根据浏览器的能力确定要建立的正确连接类型，无论是 AJAX 长轮询、Flash，甚至只是普通的 WebSocket。</p> 
<p>那么，如何开始使用它呢？首先，您需要一个 Socket.io 服务器。我们已经准备好并等待的 Express 服务器，我们只需要添加上 socket 库。为此，我们需要将其添加到 <code>package.json</code> 文件中。</p> 
<p>您的初始文件可能看起来像这样：</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"application-name"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"0.0.1"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"start"</span><span class="token operator">:</span> <span class="token string">"node app.js"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"express"</span><span class="token operator">:</span> <span class="token string">"3.3.5"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"jade"</span><span class="token operator">:</span> <span class="token string">"*"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>现在在 “dependencies” 区域添加一个新字段：</p> 
<pre><code>"socket.io": "latest",
</code></pre> 
<p>您的最终文件应该看起来像这样：</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"application-name"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"0.0.1"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"start"</span><span class="token operator">:</span> <span class="token string">"node app.js"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"socket.io"</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"express"</span><span class="token operator">:</span> <span class="token string">"3.3.5"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"jade"</span><span class="token operator">:</span> <span class="token string">"*"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>现在再次运行 <code>npm install</code> 来安装 socket 库。</p> 
<h3><a id="_4__113"></a>第 4 部分：服务器代码</h3> 
<hr> 
<p>现在我们已经设置好所有的依赖项，可以开始编写代码了！打开 Express 应用程序文件夹中的 <code>app.js</code> 文件。在其中，您会看到一堆自动生成的代码，删除所有这些代码，然后使用以下示例代码：</p> 
<pre><code class="prism language-javascript"><span class="token comment">/**
 * Module dependencies.
 */</span>
 
<span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
  <span class="token punctuation">,</span> routes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./routes'</span><span class="token punctuation">)</span>
  <span class="token punctuation">,</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> io <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'socket.io'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this tells socket.io to use our express server</span>
 
app<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'views'</span><span class="token punctuation">,</span> __dirname <span class="token operator">+</span> <span class="token string">'/views'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'view engine'</span><span class="token punctuation">,</span> <span class="token string">'jade'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">favicon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">logger</span><span class="token punctuation">(</span><span class="token string">'dev'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">methodOverride</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
app<span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span><span class="token string">'development'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">errorHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> routes<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Express server listening on port 3000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这个示例文件只是重新组织了自动生成的代码，并添加了 <code>var io = require('socket.io').listen(server);</code> 这一行，告诉 socket.io 监听并使用我们的 Express 服务器。如果运行您的 node 应用程序，您应该会看到输出：<code>info - socket.io started</code>。</p> 
<p>现在我们如何将消息传输给用户呢？</p> 
<p>在您的 <code>app.js</code> 文件中，在最后一行下面添加以下行：</p> 
<pre><code class="prism language-javascript">io<span class="token punctuation">.</span>sockets<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'A new user connected!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'The world is round, there is no up or down.'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这将在新用户连接到服务器时发送一个新的 socket 消息。现在我们只需要一种方法来在客户端与 VPS 进行交互。</p> 
<h3><a id="_167"></a>第五部分：客户端代码</h3> 
<hr> 
<p>进入 Express 应用程序中的 <code>public/javascripts</code> 文件夹，添加一个名为 <code>client.js</code> 的新文件，并将以下代码放入其中：</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 连接到 socket 服务器</span>
<span class="token keyword">var</span> socket <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// 如果从 socket 服务器接收到 "info" 事件，则在控制台打印接收到的数据</span>
socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'info'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这段代码很简单，但它演示了使用 Socket.io 可以做什么。现在我们只需要将脚本包含到我们的主页面中。</p> 
<p>进入 Express 应用程序中的 <code>views</code> 文件夹，打开 <code>layout.jade</code> 文件。Express 不使用普通的 HTML 来渲染页面，它使用一个名为 Jade 的模板引擎。（有关 Jade 的更多信息可以在这里找到）Jade 相对于普通的 HTML 更简单、更清晰。要添加我们的客户端脚本并添加 Socket.io 客户端库，我们只需要在 <code>link(rel='stylesheet', href='/stylesheets/style.css')</code> 下方添加以下两行代码：</p> 
<pre><code>script(type='text/javascript', src="/socket.io/socket.io.js")
script(type='text/javascript', src='javascripts/client.js')
</code></pre> 
<p>确保它们在相同的缩进级别上，并且不要混合使用制表符和空格。这将导致 Jade 抛出错误。</p> 
<p>切换回到 socketio-test 目录：</p> 
<pre><code>cd socketio-test
</code></pre> 
<p>保存布局文件，并再次使用 <code>node app</code> 启动 Express 应用程序。</p> 
<h3><a id="_201"></a>第六部分：测试</h3> 
<hr> 
<p>现在再次在浏览器中导航到 http://yourDropletIp-or-domainName:3000，并打开开发者工具控制台。您应该在日志中看到类似以下内容：</p> 
<pre><code>Object {msg: "The world is round, there is no up or down."}
</code></pre> 
<p>这是一条实时从 VPS 直接发送到客户端的消息。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/496a4c2fe26c172e254851c4024ddf1c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[Qt][信号与槽][下]详细讲解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/18f2f5f8eb053e9387612006d043b100/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C 循环</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>