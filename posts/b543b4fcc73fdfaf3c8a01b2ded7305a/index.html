<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>web应用程序配置服务端口，采用Nginx作反向代理时，访问网页出现404的问题解决的分析过程和解决方法 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/b543b4fcc73fdfaf3c8a01b2ded7305a/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="web应用程序配置服务端口，采用Nginx作反向代理时，访问网页出现404的问题解决的分析过程和解决方法">
  <meta property="og:description" content="目录
一、问题描述
1、背景
2、问题详细描述
二、问题分析
1、错误的多个可能因素
2、原因分析
三、问题解决
1、 查看原来的nginx反向代理
（1）分析nginx配置
（2）nginx的重定向跳转
2、修改nginx反向代理
四、结果验证
1、刷新前
2、刷新后
一、问题描述 1、背景 由于业务需要，需要再客户现场部署一套人脸系统，该系统原本使用8800端口作为网页访问端口，并通过该端口与监听在1212和3001端口的后端API进行交互。然而，由于客户方面因其他业务关系无法开放8800端口，转而提供了7200端口作为替代。
鉴于直接修改网页访问端口存在困难，我们采用了在nginx上设置反向代理的解决方案。通过配置nginx，使其监听7200端口，并将来自该端口的请求转发至原本由8800端口负责的API服务（即1212和3001端口上的API及其参数）。
这样，我们就实现了在不改变后端API配置的情况下，通过7200端口进行网页访问的功能。以下是相关的配置图：
2、问题详细描述 根据前面的设想，我们在完成配置之后，可以直接通过7200端口来访问网页，实现顺利登录并且页面加载正常。实际操作界面如下图所示：
然而，进行其他功能操作、或者使用CTRL&#43;R刷新该页面后，无法正常加载并返回404错误。如下图所示。
经过多次测试，每次登录都会正常加载，但是刷新后都会出现该错误。
二、问题分析 1、错误的多个可能因素 404 Not Found错误是一个HTTP状态码，它表明客户端（如浏览器）尝试访问的服务器资源不存在。针对这个错误，我们可以从以下几个方面来分析和排查原因：
（1）资源确实不存在：首先，应检查请求的URL是否正确，以及服务器上是否确实存在该资源（文件或目录）。
（2）配置错误：其次，需要审查服务器配置，确保没有配置错误导致资源无法被正确路由或处理。
（3）权限问题：虽然nginx以高权限启动，但文件系统权限、SELinux或AppArmor等安全模块可能仍然会阻止nginx访问某些文件。
（4）代理配置问题：当使用nginx作为反向代理时，特别需要注意代理配置是否正确。比如，从8800端口代理到本地的7200端口时，需要确保代理规则涵盖了所有必要的路径，并且重定向规则也配置正确。
2、原因分析 结合实际情况，我们可以排除以下可能性：
（1）文件或目录不存在以及配置错误的情况，因为如果是这些问题，那么即便能够登录，用户也将无法访问任何资源，这与问题描述不符。
（2）权限问题也被排除，因为nginx是以高权限账号启动的。
因此，最有可能的原因是代理配置问题。为了验证这一假设，我们需要检查nginx的配置文件，特别是与代理和重定向相关的部分，以确保所有规则都已正确设置。
通过这一步的审查，就可以找到导致404 Not Found错误的具体原因，并采取相应的措施进行修复。
三、问题解决 1、 查看原来的nginx反向代理 （1）分析nginx配置 进入nginx的配置目录下，使用命令：
vi nginx.conf
可以查看nginx的配置，原来的配置如下：
由上面可以看出，Nginx配置中缺少了重定向跳转的设置。这导致用户通过反向代理访问网页时，Nginx无法正确地将请求重定向到相应的资源，由此可能引发404错误。
（2）nginx的重定向跳转 重定向跳转是Nginx服务器提供的一项功能，它允许管理员配置服务器，以便在客户端访问特定URL时，自动将其请求重定向到另一个URL。这一重定向过程实际上涉及URL的重写，它主要通过Nginx配置文件中的重写指令来实现，确保客户端能够无缝地访问到预期的资源。
2、修改nginx反向代理 接下来就是在nginx配置中增加nginx的重定向跳转，非常简单，就在nginx.conf里增加
try_files $uri $uri/ /index.html;
这个语句即可，如下图所示：
这个语句主要用于处理静态文件和目录的访问请求。它按照预设的顺序尝试查找指定的文件或目录，一旦找到就立即返回相应的资源。在这个过程中，$uri 变量被用来存储用户请求的 URL 路径部分。
由于我目前尚未设置特定的 URI 路径，系统无法直接根据请求的 URL 路径找到对应的文件或目录。因此，在无法找到匹配项的情况下，系统会默认执行一个 fallback 操作，即返回当前路径下的 index.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-20T23:47:10+08:00">
    <meta property="article:modified_time" content="2024-06-20T23:47:10+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">web应用程序配置服务端口，采用Nginx作反向代理时，访问网页出现404的问题解决的分析过程和解决方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0" rel="nofollow">一、问题描述</a></p> 
<p id="1%E3%80%81%E8%83%8C%E6%99%AF-toc" style="margin-left:40px;"><a href="#1%E3%80%81%E8%83%8C%E6%99%AF" rel="nofollow">1、背景</a></p> 
<p id="2%E3%80%81%E9%97%AE%E9%A2%98%E8%AF%A6%E7%BB%86%E6%8F%8F%E8%BF%B0-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E9%97%AE%E9%A2%98%E8%AF%A6%E7%BB%86%E6%8F%8F%E8%BF%B0" rel="nofollow">2、问题详细描述</a></p> 
<p id="%E4%BA%8C%E3%80%81%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90" rel="nofollow">二、问题分析</a></p> 
<p id="1%E3%80%81%E9%94%99%E8%AF%AF%E7%9A%84%E5%A4%9A%E4%B8%AA%E5%8F%AF%E8%83%BD%E5%9B%A0%E7%B4%A0-toc" style="margin-left:40px;"><a href="#1%E3%80%81%E9%94%99%E8%AF%AF%E7%9A%84%E5%A4%9A%E4%B8%AA%E5%8F%AF%E8%83%BD%E5%9B%A0%E7%B4%A0" rel="nofollow">1、错误的多个可能因素</a></p> 
<p id="2%E3%80%81%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90" rel="nofollow">2、原因分析</a></p> 
<p id="%E4%B8%89%E3%80%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3" rel="nofollow">三、问题解决</a></p> 
<p id="1%E3%80%81%20%E6%9F%A5%E7%9C%8B%E5%8E%9F%E6%9D%A5%E7%9A%84nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86-toc" style="margin-left:40px;"><a href="#1%E3%80%81%20%E6%9F%A5%E7%9C%8B%E5%8E%9F%E6%9D%A5%E7%9A%84nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86" rel="nofollow">1、 查看原来的nginx反向代理</a></p> 
<p id="%EF%BC%881%EF%BC%89%E5%88%86%E6%9E%90nginx%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#%EF%BC%881%EF%BC%89%E5%88%86%E6%9E%90nginx%E9%85%8D%E7%BD%AE" rel="nofollow">（1）分析nginx配置</a></p> 
<p id="%EF%BC%882%EF%BC%89nginx%E7%9A%84%E9%87%8D%E5%AE%9A%E5%90%91%E8%B7%B3%E8%BD%AC-toc" style="margin-left:80px;"><a href="#%EF%BC%882%EF%BC%89nginx%E7%9A%84%E9%87%8D%E5%AE%9A%E5%90%91%E8%B7%B3%E8%BD%AC" rel="nofollow">（2）nginx的重定向跳转</a></p> 
<p id="2%E3%80%81%E4%BF%AE%E6%94%B9nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E4%BF%AE%E6%94%B9nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86" rel="nofollow">2、修改nginx反向代理</a></p> 
<p id="%E5%9B%9B%E3%80%81%E7%BB%93%E6%9E%9C%E9%AA%8C%E8%AF%81-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E7%BB%93%E6%9E%9C%E9%AA%8C%E8%AF%81" rel="nofollow">四、结果验证</a></p> 
<p id="1%E3%80%81%E5%88%B7%E6%96%B0%E5%89%8D-toc" style="margin-left:40px;"><a href="#1%E3%80%81%E5%88%B7%E6%96%B0%E5%89%8D" rel="nofollow">1、刷新前</a></p> 
<p id="2%E3%80%81%E5%88%B7%E6%96%B0%E5%90%8E-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E5%88%B7%E6%96%B0%E5%90%8E" rel="nofollow">2、刷新后</a></p> 
<hr id="hr-toc"> 
<p></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h2 id="%E4%B8%80%E3%80%81%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0" style="background-color:transparent;margin-left:0px;text-align:justify;">一、问题描述</h2> 
<h3 id="1%E3%80%81%E8%83%8C%E6%99%AF" style="background-color:transparent;margin-left:0px;text-align:justify;">1、背景</h3> 
<p style="margin-left:0;text-align:justify;">        由于业务需要，需要再客户现场部署一套人脸系统，该系统原本使用8800端口作为网页访问端口，并通过该端口与监听在1212和3001端口的后端API进行交互。然而，由于客户方面因其他业务关系无法开放8800端口，转而提供了7200端口作为替代。</p> 
<p style="margin-left:0;text-align:justify;">        鉴于直接修改网页访问端口存在困难，我们采用了在nginx上设置反向代理的解决方案。通过配置nginx，使其监听7200端口，并将来自该端口的请求转发至原本由8800端口负责的API服务（即1212和3001端口上的API及其参数）。</p> 
<p style="margin-left:0;text-align:justify;">        这样，我们就实现了在不改变后端API配置的情况下，通过7200端口进行网页访问的功能。以下是相关的配置图：</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="959" src="https://images2.imgbox.com/e5/2c/hNJRfy1Q_o.png" width="864"></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h3 id="2%E3%80%81%E9%97%AE%E9%A2%98%E8%AF%A6%E7%BB%86%E6%8F%8F%E8%BF%B0" style="background-color:transparent;margin-left:0px;text-align:justify;">2、问题详细描述</h3> 
<p style="margin-left:0;text-align:justify;">        根据前面的设想，我们在完成配置之后，可以直接通过7200端口来访问网页，实现顺利登录并且页面加载正常。实际操作界面如下图所示：</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="268" src="https://images2.imgbox.com/f8/71/66sA4QuW_o.png" width="865"></p> 
<p style="margin-left:0;text-align:justify;">        然而，进行其他功能操作、或者使用CTRL+R刷新该页面后，无法正常加载并返回404错误。如下图所示。</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="347" src="https://images2.imgbox.com/3a/a8/zGxQzGQq_o.png" width="865"></p> 
<p style="margin-left:0;text-align:justify;">        经过多次测试，每次登录都会正常加载，但是刷新后都会出现该错误。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h2 id="%E4%BA%8C%E3%80%81%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90" style="margin-left:0px;text-align:justify;">二、问题分析</h2> 
<h3 id="1%E3%80%81%E9%94%99%E8%AF%AF%E7%9A%84%E5%A4%9A%E4%B8%AA%E5%8F%AF%E8%83%BD%E5%9B%A0%E7%B4%A0" style="background-color:transparent;margin-left:0px;text-align:justify;"><br> 1、错误的多个可能因素</h3> 
<p style="margin-left:0;text-align:justify;">        404 Not Found错误是一个HTTP状态码，它表明客户端（如浏览器）尝试访问的服务器资源不存在。针对这个错误，我们可以从以下几个方面来分析和排查原因：</p> 
<p style="margin-left:0;text-align:justify;">        （1）资源确实不存在：首先，应检查请求的URL是否正确，以及服务器上是否确实存在该资源（文件或目录）。</p> 
<p style="margin-left:0;text-align:justify;">        （2）配置错误：其次，需要审查服务器配置，确保没有配置错误导致资源无法被正确路由或处理。</p> 
<p style="margin-left:0;text-align:justify;">        （3）权限问题：虽然nginx以高权限启动，但文件系统权限、SELinux或AppArmor等安全模块可能仍然会阻止nginx访问某些文件。</p> 
<p style="margin-left:0;text-align:justify;">        （4）代理配置问题：当使用nginx作为反向代理时，特别需要注意代理配置是否正确。比如，从8800端口代理到本地的7200端口时，需要确保代理规则涵盖了所有必要的路径，并且重定向规则也配置正确。</p> 
<h3 id="2%E3%80%81%E5%8E%9F%E5%9B%A0%E5%88%86%E6%9E%90" style="background-color:transparent;margin-left:0px;text-align:justify;">2、原因分析</h3> 
<p style="margin-left:0;text-align:justify;">        结合实际情况，我们可以排除以下可能性：</p> 
<p style="margin-left:0;text-align:justify;">        （1）文件或目录不存在以及配置错误的情况，因为如果是这些问题，那么即便能够登录，用户也将无法访问任何资源，这与问题描述不符。</p> 
<p style="margin-left:0;text-align:justify;">        （2）权限问题也被排除，因为nginx是以高权限账号启动的。</p> 
<p style="margin-left:0;text-align:justify;">        因此，最有可能的原因是代理配置问题。为了验证这一假设，我们需要检查nginx的配置文件，特别是与代理和重定向相关的部分，以确保所有规则都已正确设置。</p> 
<p style="margin-left:0;text-align:justify;">        通过这一步的审查，就可以找到导致404 Not Found错误的具体原因，并采取相应的措施进行修复。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h2 id="%E4%B8%89%E3%80%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3" style="margin-left:0px;text-align:justify;">三、问题解决</h2> 
<h3 id="1%E3%80%81%20%E6%9F%A5%E7%9C%8B%E5%8E%9F%E6%9D%A5%E7%9A%84nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86" style="margin-left:0px;text-align:justify;"><br> 1、 查看原来的nginx反向代理</h3> 
<h4 id="%EF%BC%881%EF%BC%89%E5%88%86%E6%9E%90nginx%E9%85%8D%E7%BD%AE" style="background-color:transparent;margin-left:0px;text-align:justify;">（1）分析nginx配置</h4> 
<p style="margin-left:0;text-align:justify;">        进入nginx的配置目录下，使用命令：</p> 
<blockquote> 
 <p style="margin-left:0;text-align:justify;">        vi nginx.conf</p> 
</blockquote> 
<p style="margin-left:0;text-align:justify;">        可以查看nginx的配置，原来的配置如下：</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="959" src="https://images2.imgbox.com/de/54/gm9StfZe_o.png" width="864"></p> 
<p style="margin-left:0;text-align:justify;">        由上面可以看出，Nginx配置中缺少了重定向跳转的设置。这导致用户通过反向代理访问网页时，Nginx无法正确地将请求重定向到相应的资源，由此可能引发404错误。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h4 id="%EF%BC%882%EF%BC%89nginx%E7%9A%84%E9%87%8D%E5%AE%9A%E5%90%91%E8%B7%B3%E8%BD%AC" style="background-color:transparent;margin-left:0px;text-align:justify;">（2）nginx的重定向跳转</h4> 
<p style="margin-left:0;text-align:justify;">        重定向跳转是Nginx服务器提供的一项功能，它允许管理员配置服务器，以便在客户端访问特定URL时，自动将其请求重定向到另一个URL。这一重定向过程实际上涉及URL的重写，它主要通过Nginx配置文件中的重写指令来实现，确保客户端能够无缝地访问到预期的资源。</p> 
<h3 id="2%E3%80%81%E4%BF%AE%E6%94%B9nginx%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86" style="margin-left:0px;text-align:justify;">2、修改nginx反向代理</h3> 
<p style="margin-left:0;text-align:justify;">        接下来就是在nginx配置中增加nginx的重定向跳转，非常简单，就在nginx.conf里增加</p> 
<blockquote> 
 <p style="margin-left:0;text-align:justify;">                try_files $uri $uri/ /index.html;</p> 
</blockquote> 
<p style="margin-left:0;text-align:justify;">        这个语句即可，如下图所示：</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="982" src="https://images2.imgbox.com/5c/51/tEvptGUH_o.png" width="864"></p> 
<p style="margin-left:0;text-align:justify;">        这个语句主要用于处理静态文件和目录的访问请求。它按照预设的顺序尝试查找指定的文件或目录，一旦找到就立即返回相应的资源。在这个过程中，$uri 变量被用来存储用户请求的 URL 路径部分。</p> 
<p style="margin-left:0;text-align:justify;">        由于我目前尚未设置特定的 URI 路径，系统无法直接根据请求的 URL 路径找到对应的文件或目录。因此，在无法找到匹配项的情况下，系统会默认执行一个 fallback 操作，即返回当前路径下的 index.html 文件。这样的设计旨在确保当页面刷新或资源无法直接访问时，用户仍然能够看到一个有效的页面（即 index.html），从而避免显示 "404 Not Found" 错误页面。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h2 id="%E5%9B%9B%E3%80%81%E7%BB%93%E6%9E%9C%E9%AA%8C%E8%AF%81" style="text-align:justify;">四、结果验证</h2> 
<p style="margin-left:0;text-align:justify;">        在配置文件中加入重定向跳转语句后，保存配置并重启后，刷新后再也没有404错误了，如下图所示。所有网页，无论是刷新前还是刷新后都能正常返回。</p> 
<h3 id="1%E3%80%81%E5%88%B7%E6%96%B0%E5%89%8D" style="margin-left:0px;text-align:justify;">1、刷新前</h3> 
<p style="margin-left:0;text-align:justify;">        页面刷新前的界面，如下图：</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="285" src="https://images2.imgbox.com/10/f2/8T0GAZua_o.png" width="864"></p> 
<h3 id="2%E3%80%81%E5%88%B7%E6%96%B0%E5%90%8E" style="background-color:transparent;margin-left:0px;text-align:justify;">2、刷新后</h3> 
<p style="margin-left:0;text-align:justify;">        页面多次刷新后的界面，如下图：</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="316" src="https://images2.imgbox.com/21/5b/DFfwv6N8_o.png" width="864"></p> 
<p style="margin-left:0;text-align:justify;">        问题得到解决。</p> 
<hr> 
<p>文章正下方可以看到我的联系方式：鼠标“点击” 下面的 “<a href="http://www.vidisit.cn/" rel="nofollow" title="威迪斯特">威迪斯特</a>-就是video system<strong> </strong><strong>微信名片</strong>”字样，就会出现<strong>我的二维码，欢迎沟通探讨。</strong></p> 
<hr> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eccb49ef90b50afbc2240da00fadd233/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Zabbix 监控 Kubernetes 集群</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6205d07765ab2b7267bbb8300f512b9c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">React的列表和Key</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>