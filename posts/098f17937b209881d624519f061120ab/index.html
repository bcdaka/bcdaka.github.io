<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>RustDesk 搭建 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/098f17937b209881d624519f061120ab/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="RustDesk 搭建">
  <meta property="og:description" content="Web、API 部署教程：https://www.52pojie.cn/thread-1708319-1-1.html
RustDesk 服务端下载：https://github.com/rustdesk/rustdesk-server/releases
RustDesk 客户端下载：https://github.com/rustdesk/rustdesk/releases/tag/1.2.3-2
RustDesk 官方部署教程：https://rustdesk.com/docs/zh-cn/
1：RustDesk 概览 1.1：项目简介 RustDesk 它是一个远程控制开源项目，该项目支持自己搭建服务器。
RustDesk 默认提供免费公共中继服务，但 RustDesk 的中继服务器在海外，所以延迟非常明显，所以可以自己搭建服务器。
1.2：工作原理 RustDesk 会先用 TCP 21116 信令服务 NAT 打洞，如果打洞成功，直接 P2P 直连，RustDesk 不参与中继。
RustDesk 如果没有打洞成功，则走 TCP 21117 中继服务，延迟、画质取决于中继服务器的带宽。
hbbs 监听端口hbbr 监听端口21115(tcp)：用作 NAT 类型测试21117(tcp)：中继服务21116(tcp)：NAT 打洞与连接服务21119(tcp)：支持 Web 客户端21118(tcp)：支持 Web 客户端21116(udp)：ID 注册与心跳服务 2：部署 RustDesk 服务 我的服务器是 CentOS7.6 64位，所以下载 rustdesk-server-linux-amd64.zip，用 unzip 解压后执行 hbbr(ID)、hbbs(中继)。
请注意 TCP 21115-21119 和 1 个 UDP 21116 都要在安全组放行，如果有宝塔，宝塔的防火墙也要放行。
unzip rustdesk-server-linux-amd64.zip mv amd64 rustdesk_server cd rustdesk_server # 启动ID注册服务，后台运行 # -k _ 用于强制被控端输入Key，因为默认情况下只需要主控端输入Key就能连接 .">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-08T22:26:00+08:00">
    <meta property="article:modified_time" content="2024-06-08T22:26:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">RustDesk 搭建</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown" style="font-size: 16px;"> 
 <p>Web、API 部署教程：<a href="https://www.52pojie.cn/thread-1708319-1-1.html" rel="noopener noopener noreferrer" target="_blank">https://www.52pojie.cn/thread-1708319-1-1.html</a></p> 
 <p>RustDesk 服务端下载：<a href="https://github.com/rustdesk/rustdesk-server/releases" target="_blank" rel="noopener noopener noreferrer">https://github.com/rustdesk/rustdesk-server/releases</a></p> 
 <p>RustDesk 客户端下载：<a href="https://github.com/rustdesk/rustdesk/releases/tag/1.2.3-2" target="_blank" rel="noopener noopener noreferrer">https://github.com/rustdesk/rustdesk/releases/tag/1.2.3-2</a></p> 
 <p>RustDesk 官方部署教程：<a href="https://rustdesk.com/docs/zh-cn/" rel="noopener noopener noreferrer" target="_blank">https://rustdesk.com/docs/zh-cn/</a></p> 
 <hr> 
 <h3 id="1rustdesk-概览">1：RustDesk 概览</h3> 
 <h4 id="11项目简介">1.1：项目简介</h4> 
 <p>RustDesk 它是一个远程控制开源项目，该项目支持自己搭建服务器。</p> 
 <p>RustDesk 默认提供免费公共中继服务，但 RustDesk 的中继服务器在海外，所以延迟非常明显，所以可以自己搭建服务器。</p> 
 <h4 id="12工作原理">1.2：工作原理</h4> 
 <p>RustDesk 会先用 TCP 21116 信令服务 NAT 打洞，如果打洞成功，直接 P2P 直连，RustDesk 不参与中继。</p> 
 <p>RustDesk 如果没有打洞成功，则走 TCP 21117 中继服务，延迟、画质取决于中继服务器的带宽。</p> 
 <table><thead><tr><th>hbbs 监听端口</th><th>hbbr 监听端口</th></tr></thead><tbody><tr><td>21115(tcp)：用作 NAT 类型测试</td><td>21117(tcp)：中继服务</td></tr><tr><td>21116(tcp)：NAT 打洞与连接服务</td><td>21119(tcp)：支持 Web 客户端</td></tr><tr><td>21118(tcp)：支持 Web 客户端</td><td></td></tr><tr><td>21116(udp)：ID 注册与心跳服务</td><td></td></tr></tbody></table> 
 <h3 id="2部署-rustdesk-服务">2：部署 RustDesk 服务</h3> 
 <p>我的服务器是 CentOS7.6 64位，所以下载 <a href="https://github.com/rustdesk/rustdesk-server/releases/download/1.1.11-1/rustdesk-server-linux-amd64.zip" target="_blank" rel="noopener noopener noreferrer">rustdesk-server-linux-amd64.zip</a>，用 unzip 解压后执行 <code>hbbr(ID)</code>、<code>hbbs(中继)</code>。</p> 
 <p>请注意 TCP 21115-21119 和 1 个 UDP 21116 都要在安全组放行，如果有宝塔，宝塔的防火墙也要放行。</p> 
 <pre class="has"><code class="language-shell">unzip rustdesk-server-linux-amd64.zip
mv amd64 rustdesk_server
cd rustdesk_server
# 启动ID注册服务，后台运行
# -k _ 用于强制被控端输入Key，因为默认情况下只需要主控端输入Key就能连接
./hbbs -k _ &amp;
# 启动中继服务，后台运行
# 启动后生成公私密钥对(id_edxxxx，id_edxxxx.pub)
./hbbr -k _ &amp;</code></pre> 
 <h3 id="3部署客户端">3：部署客户端</h3> 
 <h4 id="31win-客户端">3.1：Win 客户端</h4> 
 <p>由于我是 Win 环境，所以下载 <a href="https://github.com/rustdesk/rustdesk/releases/download/1.2.3-2/rustdesk-1.2.3-2-x86_64.exe" target="_blank" rel="noopener noopener noreferrer">rustdesk-1.2.3-2-x86_64.exe</a>，打开后是非安装版本，也可作为主控和被控端，但可能会有一些限制，最好用安装一下。</p> 
 <p><img src="https://images2.imgbox.com/41/64/tl6A0gvg_o.png" alt="" style="outline: none;"></p> 
 <p><strong>示例：</strong> <code>笔记本</code> 和 <code>无影云电脑</code> 都安装了 RustDesk for Win 客户端，并且 ID/中继服务器 均配置完成。笔记本获取无影电脑的 ID 值和密码，连接成功。</p> 
 <p><img src="https://images2.imgbox.com/b5/1f/1X6Un5bn_o.png" alt="" style="outline: none;"></p> 
 <p><img src="https://images2.imgbox.com/e6/ce/tlUHz4rV_o.png" alt="" style="outline: none;"></p> 
 <h4 id="32web-客户端">3.2：Web 客户端</h4> 
 <p>Web 客户端有静态源码，官方教程中也说只有 RustDesk Server Pro 才有 Web 远控，GitHub 项目中也没有给 Web 客户端的资源，但网上却有<a href="https://v5star.lanzouv.com/iq43T0f8rgsf?pwd=52pj#52pj" rel="noopener noopener noreferrer" target="_blank">下载</a>，我猜是有人从 Pro 版本扒出来源码修改了一点点😅。</p> 
 <hr> 
 <p>0x01：宝塔创建一个站点，用于存放 Web 静态文件。</p> 
 <p><img src="https://images2.imgbox.com/dc/80/urvwzcY9_o.png" alt="" style="outline: none;"></p> 
 <p>0x02：将 web-client 文件夹里的文件全部剪切到根目录中，并修改所有者和用户组为 www。</p> 
 <pre class="has"><code class="language-shell">mv web-client/* wwwroot/
chown -R www:www wwwroot/*</code></pre> 
 <p>0x03：浏览器访问 Web 远控端，同样也要输入 ID服务器 和 Key。</p> 
 <blockquote> 
  <p>如果服务器上行带框小，访问会比较慢</p> 
 </blockquote> 
 <p><img src="https://images2.imgbox.com/73/45/W2iSRN4T_o.png" alt="" style="outline: none;"></p> 
 <p>0x04：Web 远控输入无影云主机ID，输入密码后成功连接。</p> 
 <blockquote> 
  <p>服务器上行带宽太小会导致延迟、画质过差</p> 
 </blockquote> 
 <p><img src="https://images2.imgbox.com/a6/59/8EAg6RNs_o.png" alt="" style="outline: none;"></p> 
 <h4 id="33其它-客户端">3.3：其它 客户端</h4> 
 <p><em><u>RustDesk 还支持 Linux(Debian系列没问题，虽然也提供了RadHat系列的rpm包，但好像有问题)、Mac、Android 等客户端，等有这方面的需求在搞。</u></em></p> 
 <h3 id="4部署优化">4：部署优化</h3> 
 <h4 id="41web-远控加载慢">4.1：Web 远控加载慢</h4> 
 <p>Web 远控慢是因为 canvaskit.wasm 太大了，足足 6MB 多，如果你服务器上行带宽很大，其实可以忽略。</p> 
 <p>优化：canvaskit.js 访问的 canvaskit.wasm，可以将访问地址换成网上免费的 <a href="https://www.bootcdn.cn/canvaskit-wasm" rel="noopener noopener noreferrer" target="_blank">插件CDN服务</a>。</p> 
 <pre class="has"><code class="language-shell">cd canvaskit@0.33.0/
vim canvaskit.js
# 搜索 canvaskit.wasm，将后面的 if(!Ab()){var Cb=Bb;Bb=t.locateFile?t.locateFile(Cb,Ca):Ca+Cb} 删除
# 将 Bb 变量修改为 CDN 加速链接，这样节省了带宽又加速了访问
# (如果CDN的带宽还没你服务器带宽大，就别搞这个)
var Bb;Bb="https://cdn.bootcdn.net/ajax/libs/canvaskit-wasm/0.33.0/canvaskit.wasm";</code></pre> 
 <p><img src="https://images2.imgbox.com/3b/95/FU63ipT4_o.png" alt="" style="outline: none;"></p> 
 <h4 id="42systemd-管理">4.2：Systemd 管理</h4> 
 <p>0x01：创建 service 文件，WorkingDirectory 工作目录一定要指定，否则密钥对不会创建 。</p> 
 <pre class="has"><code class="language-shell">cat &gt; /etc/systemd/system/hbbr.service &lt;&lt; EOF
[Unit]
Description=RustDesk Hbbs
After=network.target

[Service]
User=root
Type=simple
WorkingDirectory=/taosec/remote_control/rustdesk_server
ExecStart=/taosec/remote_control/rustdesk_server/hbbr
ExecStop=/bin/kill -TERM $MAINPID

[Install]
WantedBy=multi-user.target
EOF

cat &gt; /etc/systemd/system/hbbs.service &lt;&lt; EOF
[Unit]
Description=RustDesk Hbbs
After=network.target

[Service]
User=root
Type=simple
WorkingDirectory=/taosec/remote_control/rustdesk_server
ExecStart=/taosec/remote_control/rustdesk_server/hbbs
ExecStop=/bin/kill -TERM $MAINPID

[Install]
WantedBy=multi-user.target
EOF</code></pre> 
 <p>0x02：启动 hbbr 和 hbbs 并开机自启动。</p> 
 <pre class="has"><code class="language-shell">systemctl start hbbr
systemctl start hbbs
systemctl enable hbbr
systemctl enable hbbs</code></pre> 
 <h4 id="43api-服务器">4.3：Api 服务器</h4> 
 <p>Api 服务器 (登录、注册、记录等作用) 好像也是 Pro 版本才有，但网上有很多大佬自己开发了 Api 服务器，我在网上查了一下，甚至测试了 1 套，虽然登录没问题，将远程记录放到地址簿中，数据库确实有数据，但重新登录后，却无法获取地址簿的数据，可能是版本更新的原因吧，那套源码是 23 年的，还有一套不错的 Api 项目，可惜只支持 Win。</p> 
 <p>我看了一眼 Api 服务器的PHP版本的源代码，很简单，几乎是套娃，我也懒得搞了，没这需求，搞得我也累。</p> 
 <h3 id="5docker-部署">5：Docker 部署</h3> 
 <pre class="has"><code class="language-shell"># host是与宿主机共享网络，-r是指定中继服务器IP(端口可选)，由于我们是 host 模式，所以 ip 填宿主机的就可以
docker run --restart=always --name hbbs  -v /opt/rustdesk/hbbs/root:/root -td --net=host rustdesk/rustdesk-server  hbbs  -r 10.0.0.11 -k 123456

docker run  --restart=always --name hbbr -v /opt/rustdesk/hbbr/root:/root -td --net=host rustdesk/rustdesk-server hbbr</code></pre> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b87eff97f00a174d04b2c70bc627404b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">EntitiesSample_6. Reparenting</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ed2d726604a8b33588a95b7ec0c943cd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">从零手写实现 nginx-12-keepalive HTTP 持久连接或连接复用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>