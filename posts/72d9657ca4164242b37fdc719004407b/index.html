<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ä½¿ç”¨Keepalivedå®ç°åŒæœºçƒ­å¤‡(è™šæ‹Ÿæ¼‚ç§»IPåœ°å€)è¯¦ç»†ä»‹ç» - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/72d9657ca4164242b37fdc719004407b/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="ä½¿ç”¨Keepalivedå®ç°åŒæœºçƒ­å¤‡(è™šæ‹Ÿæ¼‚ç§»IPåœ°å€)è¯¦ç»†ä»‹ç»">
  <meta property="og:description" content="ğŸ¡ä½œè€…ä¸»é¡µï¼šç‚¹å‡»ï¼Â ğŸ§LinuxåŸºç¡€çŸ¥è¯†(åˆå­¦)ï¼šç‚¹å‡»ï¼
ğŸ§Linuxé«˜çº§ç®¡ç†é˜²æŠ¤å’Œç¾¤é›†ä¸“æ ï¼šç‚¹å‡»ï¼
ğŸ”Linuxä¸­firewalldé˜²ç«å¢™ï¼šç‚¹å‡»ï¼
â°ï¸åˆ›ä½œæ—¶é—´ï¼š2024å¹´7æœˆ15æ—¥14ç‚¹40åˆ†
ğŸ€„ï¸æ–‡ç« è´¨é‡ï¼š95åˆ†
ç›®å½•
â€”â€”å‰è¨€â€”â€”
Keepalived ç®€ä»‹
å·¥ä½œåŸç†
ä¸»æœåŠ¡å™¨
å¤‡æœåŠ¡å™¨
è™šæ‹Ÿ(æ¼‚ç§»)åœ°å€æµ‹è¯•
â€”â€”å‰è¨€â€”â€” ä»¥ä¸‹å†…å®¹å…¨æ˜¯é‡ç‚¹ è¯·ä»”ç»†é˜…è¯»
ä»¥ä¸‹å†…å®¹å…¨æ˜¯é‡ç‚¹ è¯·ä»”ç»†é˜…è¯»
Keepalived æ˜¯ä¸€ä¸ªç”¨äºå®ç°é«˜å¯ç”¨æ€§ã€‚å®ƒä¸»è¦ç”¨äºç¡®ä¿æœåŠ¡çš„è¿ç»­æ€§ï¼Œé˜²æ­¢å•ç‚¹æ•…éšœï¼Œé€šå¸¸åº”ç”¨äºè´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»åœºæ™¯ã€‚
Keepalived ç®€ä»‹ Keepalived æ˜¯ä¸€ä¸ªåŸºäº VRRPï¼ˆè™šæ‹Ÿè·¯ç”±å†—ä½™åè®®ï¼‰åè®®çš„è½¯ä»¶å®ç°ã€‚
å®ƒå¯ä»¥ç®¡ç† LVSï¼ˆLinux Virtual Serverï¼‰é›†ç¾¤ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥å•ç‹¬ç”¨äºå®ç°æœåŠ¡çš„é«˜å¯ç”¨ã€‚
Keepalived é€šè¿‡é…ç½®è™šæ‹Ÿ IP åœ°å€ï¼ˆVIPï¼‰æ¥å®ç°æœåŠ¡çš„æ•…éšœè½¬ç§»ã€‚
å®ƒèƒ½å¤Ÿç›‘æ§æœåŠ¡å™¨å’ŒæœåŠ¡çš„çŠ¶æ€ï¼Œåœ¨å‘ç”Ÿæ•…éšœæ—¶è‡ªåŠ¨è¿›è¡Œåˆ‡æ¢ã€‚
ç‰¹åˆ«é€‚åˆéœ€è¦å¿«é€Ÿæ•…éšœè½¬ç§»å’Œè´Ÿè½½å‡è¡¡çš„ç½‘ç»œç¯å¢ƒ
å·¥ä½œåŸç† VRRPåè®®
Keepalivedä½¿ç”¨VRRPï¼ˆè™šæ‹Ÿè·¯ç”±å†—ä½™åè®®ï¼‰æ¥å®ç°é«˜å¯ç”¨æ€§ã€‚
å¤šå°æœåŠ¡å™¨ç»„æˆä¸€ä¸ªVRRPç»„ï¼Œå…±äº«ä¸€ä¸ªè™šæ‹ŸIPåœ°å€ã€‚
ä¸€å°æœåŠ¡å™¨ä½œä¸ºä¸»æœåŠ¡å™¨ï¼Œå…¶ä»–ä¸ºå¤‡ç”¨æœåŠ¡å™¨ã€‚
ä¸»æœåŠ¡å™¨å®šæœŸå‘é€VRRPé€šå‘ŠåŒ…ï¼Œå¦‚æœå¤‡ç”¨æœåŠ¡å™¨åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°é€šå‘Šï¼Œå°±ä¼šæ¥ç®¡è™šæ‹ŸIPã€‚
2.å¥åº·æ£€æŸ¥
Keepalivedå®šæœŸæ£€æŸ¥æœ¬åœ°å’Œè¿œç¨‹æœåŠ¡çš„å¥åº·çŠ¶æ€ã€‚
æ”¯æŒå¤šç§æ£€æŸ¥æ–¹å¼ï¼Œå¦‚TCPã€HTTPã€SSLç­‰ã€‚
å¦‚æœæ£€æµ‹åˆ°æœåŠ¡ä¸å¯ç”¨ï¼Œä¼šè§¦å‘æ•…éšœè½¬ç§»ã€‚
3.è´Ÿè½½å‡è¡¡ï¼š
å½“ä¸LVSï¼ˆLinux Virtual Serverï¼‰ç»“åˆä½¿ç”¨æ—¶ï¼ŒKeepalivedå¯ä»¥ç®¡ç†LVSçš„é…ç½®ã€‚
æ”¯æŒå¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œå¦‚è½®è¯¢ã€åŠ æƒè½®è¯¢ã€æœ€å°‘è¿æ¥ç­‰ã€‚
4.é…ç½®ç®¡ç†
é€šè¿‡é…ç½®æ–‡ä»¶å®šä¹‰VRRPå®ä¾‹ã€è™šæ‹ŸIPã€å¥åº·æ£€æŸ¥ç­‰å‚æ•°ã€‚
æ”¯æŒåŠ¨æ€é…ç½®æ›´æ–°ï¼Œæ— éœ€é‡å¯æœåŠ¡ã€‚
5.æ•…éšœè½¬ç§»
å½“ä¸»æœåŠ¡å™¨å¤±æ•ˆæ—¶ï¼Œå¤‡ç”¨æœåŠ¡å™¨ä¼šè‡ªåŠ¨æ¥ç®¡è™šæ‹ŸIPã€‚
è½¬ç§»è¿‡ç¨‹å¿«é€Ÿï¼Œé€šå¸¸åœ¨å‡ ç§’å†…å®Œæˆï¼Œå¯¹ç”¨æˆ·å‡ ä¹æ— æ„ŸçŸ¥ã€‚
è¿‡è¿™äº›æœºåˆ¶ï¼ŒKeepalivedèƒ½å¤Ÿæœ‰æ•ˆåœ°æä¾›é«˜å¯ç”¨æ€§å’Œè´Ÿè½½å‡è¡¡æœåŠ¡ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚
å®éªŒç¯å¢ƒ
ä¸» 192.168.192.100Â è™šæ‹Ÿæ¼‚ç§»åœ°å€ 192.168.192.200
å¤‡ 192.168.192.111Â è™šæ‹Ÿæ¼‚ç§»åœ°å€ 192.168.192.200
ä¸»æœåŠ¡å™¨ å®‰è£…æ‰€éœ€ç»„ä»¶ yum -y install gcc openssl-devel libnfnetlink-devel libnl libnl3-devel yum install -y keepalived ipvsadm ç¼–è¾‘é…ç½®æ–‡ä»¶">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-15T23:00:24+08:00">
    <meta property="article:modified_time" content="2024-07-15T23:00:24+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ä½¿ç”¨Keepalivedå®ç°åŒæœºçƒ­å¤‡(è™šæ‹Ÿæ¼‚ç§»IPåœ°å€)è¯¦ç»†ä»‹ç»</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="text-align:center;">Â <img alt="" height="80" src="https://images2.imgbox.com/da/d5/QWojLUJN_o.gif" width="640"></p> 
<p style="text-align:center;"><strong>ğŸ¡ä½œè€…ä¸»é¡µï¼š<strong><a href="https://blog.csdn.net/jxjdhdnd?type=blog" title="ç‚¹å‡»ï¼">ç‚¹å‡»ï¼</a></strong>Â </strong></p> 
<p style="text-align:center;"><strong>ğŸ§LinuxåŸºç¡€çŸ¥è¯†(åˆå­¦)ï¼š<a href="http://t.csdnimg.cn/vHbWu" rel="nofollow" title="ç‚¹å‡»ï¼">ç‚¹å‡»ï¼</a></strong></p> 
<p style="text-align:center;"><strong>ğŸ§Linuxé«˜çº§ç®¡ç†é˜²æŠ¤å’Œç¾¤é›†ä¸“æ ï¼š<strong><a href="https://blog.csdn.net/jxjdhdnd/category_12688607.html" title="ç‚¹å‡»ï¼">ç‚¹å‡»ï¼</a></strong></strong></p> 
<p style="text-align:center;"><strong>ğŸ”Linuxä¸­firewalldé˜²ç«å¢™ï¼š<a href="http://t.csdnimg.cn/wFpET" rel="nofollow" title="ç‚¹å‡»ï¼">ç‚¹å‡»ï¼</a></strong></p> 
<p style="text-align:center;"><strong>â°ï¸åˆ›ä½œæ—¶é—´ï¼š2024å¹´7æœˆ15æ—¥14ç‚¹40åˆ†</strong></p> 
<p style="text-align:center;"><strong>ğŸ€„ï¸æ–‡ç« è´¨é‡ï¼š95åˆ†</strong></p> 
<p style="text-align:center;"><img alt="" height="80" src="https://images2.imgbox.com/e1/3b/AybCByLm_o.gif" width="640"></p> 
<hr> 
<p id="main-toc"><strong>ç›®å½•</strong></p> 
<p id="%E2%80%94%E2%80%94%E5%89%8D%E8%A8%80%E2%80%94%E2%80%94-toc" style="margin-left:40px;"><a href="#%E2%80%94%E2%80%94%E5%89%8D%E8%A8%80%E2%80%94%E2%80%94" rel="nofollow">â€”â€”å‰è¨€â€”â€”</a></p> 
<p id="Keepalived%20%E7%AE%80%E4%BB%8B-toc" style="margin-left:40px;"><a href="#Keepalived%20%E7%AE%80%E4%BB%8B" rel="nofollow">Keepalived ç®€ä»‹</a></p> 
<p id="%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-toc" style="margin-left:40px;"><a href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" rel="nofollow">å·¥ä½œåŸç†</a></p> 
<p id="%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8-toc" style="margin-left:40px;"><a href="#%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8" rel="nofollow">ä¸»æœåŠ¡å™¨</a></p> 
<p id="%E5%A4%87%E6%9C%8D%E5%8A%A1%E5%99%A8-toc" style="margin-left:40px;"><a href="#%E5%A4%87%E6%9C%8D%E5%8A%A1%E5%99%A8" rel="nofollow">å¤‡æœåŠ¡å™¨</a></p> 
<p id="%E8%99%9A%E6%8B%9F(%E6%BC%82%E7%A7%BB)%E5%9C%B0%E5%9D%80%E6%B5%8B%E8%AF%95-toc" style="margin-left:40px;"><a href="#%E8%99%9A%E6%8B%9F%28%E6%BC%82%E7%A7%BB%29%E5%9C%B0%E5%9D%80%E6%B5%8B%E8%AF%95" rel="nofollow">è™šæ‹Ÿ(æ¼‚ç§»)åœ°å€æµ‹è¯•</a></p> 
<hr> 
<h3 id="%E2%80%94%E2%80%94%E5%89%8D%E8%A8%80%E2%80%94%E2%80%94" style="background-color:transparent;text-align:center;">â€”â€”å‰è¨€â€”â€”</h3> 
<p style="text-align:center;"><span style="color:#fe2c24;"><strong>ä»¥ä¸‹å†…å®¹å…¨æ˜¯é‡ç‚¹ è¯·ä»”ç»†é˜…è¯»</strong></span></p> 
<p style="text-align:center;"><span style="color:#fe2c24;"><strong>ä»¥ä¸‹å†…å®¹å…¨æ˜¯é‡ç‚¹ è¯·ä»”ç»†é˜…è¯»</strong></span></p> 
<p>Keepalived æ˜¯ä¸€ä¸ªç”¨äºå®ç°é«˜å¯ç”¨æ€§ã€‚å®ƒä¸»è¦ç”¨äºç¡®ä¿æœåŠ¡çš„è¿ç»­æ€§ï¼Œé˜²æ­¢å•ç‚¹æ•…éšœï¼Œé€šå¸¸åº”ç”¨äºè´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»åœºæ™¯ã€‚</p> 
<h3 id="Keepalived%20%E7%AE%80%E4%BB%8B">Keepalived ç®€ä»‹</h3> 
<ol><li> <p><span style="color:#fe2c24;"><strong>Keepalived æ˜¯ä¸€ä¸ªåŸºäº VRRPï¼ˆè™šæ‹Ÿè·¯ç”±å†—ä½™åè®®ï¼‰åè®®çš„è½¯ä»¶å®ç°ã€‚</strong></span></p> </li><li> <p><span style="color:#fe2c24;"><strong>å®ƒå¯ä»¥ç®¡ç† LVSï¼ˆLinux Virtual Serverï¼‰é›†ç¾¤ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥å•ç‹¬ç”¨äºå®ç°æœåŠ¡çš„é«˜å¯ç”¨ã€‚</strong></span></p> </li><li> <p><span style="color:#fe2c24;"><strong>Keepalived é€šè¿‡é…ç½®è™šæ‹Ÿ IP åœ°å€ï¼ˆVIPï¼‰æ¥å®ç°æœåŠ¡çš„æ•…éšœè½¬ç§»ã€‚</strong></span></p> </li><li> <p><span style="color:#fe2c24;"><strong>å®ƒèƒ½å¤Ÿç›‘æ§æœåŠ¡å™¨å’ŒæœåŠ¡çš„çŠ¶æ€ï¼Œåœ¨å‘ç”Ÿæ•…éšœæ—¶è‡ªåŠ¨è¿›è¡Œåˆ‡æ¢ã€‚</strong></span></p> </li></ol> 
<p><span style="color:#fe2c24;"><strong>ç‰¹åˆ«é€‚åˆéœ€è¦å¿«é€Ÿæ•…éšœè½¬ç§»å’Œè´Ÿè½½å‡è¡¡çš„ç½‘ç»œç¯å¢ƒ</strong></span></p> 
<p></p> 
<h3 id="%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">å·¥ä½œåŸç†</h3> 
<ol><li> <p><span style="color:#fe2c24;"><strong>VRRPåè®®</strong></span></p> <p>Keepalivedä½¿ç”¨VRRPï¼ˆè™šæ‹Ÿè·¯ç”±å†—ä½™åè®®ï¼‰æ¥å®ç°é«˜å¯ç”¨æ€§ã€‚</p> <p>å¤šå°æœåŠ¡å™¨ç»„æˆä¸€ä¸ªVRRPç»„ï¼Œå…±äº«ä¸€ä¸ªè™šæ‹ŸIPåœ°å€ã€‚</p> <p>ä¸€å°æœåŠ¡å™¨ä½œä¸ºä¸»æœåŠ¡å™¨ï¼Œå…¶ä»–ä¸ºå¤‡ç”¨æœåŠ¡å™¨ã€‚</p> <p>ä¸»æœåŠ¡å™¨å®šæœŸå‘é€VRRPé€šå‘ŠåŒ…ï¼Œå¦‚æœå¤‡ç”¨æœåŠ¡å™¨åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°é€šå‘Šï¼Œå°±ä¼šæ¥ç®¡è™šæ‹ŸIPã€‚</p> </li></ol> 
<p>2.<span style="color:#fe2c24;"><strong>å¥åº·æ£€æŸ¥</strong></span></p> 
<p>Keepalivedå®šæœŸæ£€æŸ¥æœ¬åœ°å’Œè¿œç¨‹æœåŠ¡çš„å¥åº·çŠ¶æ€ã€‚</p> 
<p>æ”¯æŒå¤šç§æ£€æŸ¥æ–¹å¼ï¼Œå¦‚TCPã€HTTPã€SSLç­‰ã€‚</p> 
<p>å¦‚æœæ£€æµ‹åˆ°æœåŠ¡ä¸å¯ç”¨ï¼Œä¼šè§¦å‘æ•…éšœè½¬ç§»ã€‚</p> 
<p>3.<span style="color:#fe2c24;"><strong>è´Ÿè½½å‡è¡¡</strong></span>ï¼š</p> 
<p>å½“ä¸LVSï¼ˆLinux Virtual Serverï¼‰ç»“åˆä½¿ç”¨æ—¶ï¼ŒKeepalivedå¯ä»¥ç®¡ç†LVSçš„é…ç½®ã€‚</p> 
<p>æ”¯æŒå¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œå¦‚è½®è¯¢ã€åŠ æƒè½®è¯¢ã€æœ€å°‘è¿æ¥ç­‰ã€‚</p> 
<p>4<span style="color:#fe2c24;">.<strong>é…ç½®ç®¡ç†</strong></span></p> 
<p>é€šè¿‡é…ç½®æ–‡ä»¶å®šä¹‰VRRPå®ä¾‹ã€è™šæ‹ŸIPã€å¥åº·æ£€æŸ¥ç­‰å‚æ•°ã€‚</p> 
<p>æ”¯æŒåŠ¨æ€é…ç½®æ›´æ–°ï¼Œæ— éœ€é‡å¯æœåŠ¡ã€‚</p> 
<p>5.<span style="color:#fe2c24;"><strong>æ•…éšœè½¬ç§»</strong></span></p> 
<p>å½“ä¸»æœåŠ¡å™¨å¤±æ•ˆæ—¶ï¼Œå¤‡ç”¨æœåŠ¡å™¨ä¼šè‡ªåŠ¨æ¥ç®¡è™šæ‹ŸIPã€‚</p> 
<p>è½¬ç§»è¿‡ç¨‹å¿«é€Ÿï¼Œé€šå¸¸åœ¨å‡ ç§’å†…å®Œæˆï¼Œå¯¹ç”¨æˆ·å‡ ä¹æ— æ„ŸçŸ¥ã€‚</p> 
<p>è¿‡è¿™äº›æœºåˆ¶ï¼ŒKeepalivedèƒ½å¤Ÿæœ‰æ•ˆåœ°æä¾›é«˜å¯ç”¨æ€§å’Œè´Ÿè½½å‡è¡¡æœåŠ¡ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</p> 
<p></p> 
<p>å®éªŒç¯å¢ƒ</p> 
<p><img alt="" height="511" src="https://images2.imgbox.com/36/7c/SeJurPlY_o.png" width="896"></p> 
<p></p> 
<blockquote> 
 <p>ä¸» 192.168.192.100Â Â  Â è™šæ‹Ÿæ¼‚ç§»åœ°å€ <strong>192.168.192.200</strong></p> 
 <p>å¤‡ 192.168.192.111Â  Â  Â è™šæ‹Ÿæ¼‚ç§»åœ°å€<strong> 192.168.192.200</strong></p> 
 <p></p> 
</blockquote> 
<p></p> 
<h3 id="%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8">ä¸»æœåŠ¡å™¨</h3> 
<pre><code>
å®‰è£…æ‰€éœ€ç»„ä»¶
yum -y install gcc openssl-devel libnfnetlink-devel libnl libnl3-devel

yum install -y keepalived ipvsadm
</code></pre> 
<p>ç¼–è¾‘é…ç½®æ–‡ä»¶</p> 
<p><span style="color:#fe2c24;"><strong>ä»¥ä¸‹é…ç½®éƒ½æ˜¯é‡ç‚¹ å¤§å®¶å¯ä»¥ä¸€ä¸€æ¯”å¯¹</strong></span></p> 
<pre><code class="language-javascript">vim /etc/keepalived/keepalived.conf</code></pre> 
<pre><code>! Configuration File for keepalived

global_defs {
   notification_email {
     acassen@firewall.loc
     failover@firewall.loc
     sysadmin@firewall.loc
   }
   ! è®¾ç½®é€šçŸ¥é‚®ä»¶çš„æ¥æ”¶åœ°å€
   notification_email_from Alexandre.Cassen@firewall.loc  ! è®¾ç½®é€šçŸ¥é‚®ä»¶çš„å‘é€åœ°å€
   smtp_server 192.168.200.1  ! è®¾ç½®SMTPæœåŠ¡å™¨åœ°å€
   smtp_connect_timeout 30  ! è®¾ç½®SMTPè¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
   router_id R1  ! è®¾ç½®è·¯ç”±å™¨æ ‡è¯†

}

vrrp_instance VI_1 {
    state MASTER  ! è®¾ç½®åˆå§‹çŠ¶æ€ä¸ºä¸»èŠ‚ç‚¹
    interface ens33  ! è®¾ç½®VRRPå®ä¾‹ç»‘å®šçš„ç½‘ç»œæ¥å£
    virtual_router_id 2  ! è®¾ç½®è™šæ‹Ÿè·¯ç”±å™¨ID
    priority 100  ! è®¾ç½®ä¼˜å…ˆçº§
    advert_int 1  ! è®¾ç½®VRRPå¹¿æ’­é—´éš”ï¼ˆç§’ï¼‰
    authentication {
        auth_type PASS  ! è®¾ç½®è®¤è¯ç±»å‹ä¸ºå¯†ç 
        auth_pass 1111  ! è®¾ç½®è®¤è¯å¯†ç 
    }
    virtual_ipaddress {
        192.168.192.200  ! è®¾ç½®è™šæ‹ŸIPåœ°å€
    }
}

virtual_server 192.168.192.200 80 {
    delay_loop 6  ! è®¾ç½®å¥åº·æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
    lb_algo rr  ! è®¾ç½®è´Ÿè½½å‡è¡¡ç®—æ³•ä¸ºè½®è¯¢
    lb_kind DR  ! è®¾ç½®LVSæ¨¡å¼ä¸ºç›´æ¥è·¯ç”±
    nat_mask 255.255.255.0  ! è®¾ç½®NATæ©ç 
!   persistence_timeout 50  ! ä¼šè¯ä¿æŒæ—¶é—´ï¼ˆç§’ï¼‰ï¼Œå½“å‰è¢«æ³¨é‡Š
    protocol TCP  ! è®¾ç½®åè®®ä¸ºTCP

    real_server 192.168.192.112 80 {
        weight 1  ! è®¾ç½®æœåŠ¡å™¨æƒé‡
        TCP_CHECK {
            connect_port 80  ! è®¾ç½®å¥åº·æ£€æŸ¥è¿æ¥çš„ç«¯å£
            connect_timeout 3  ! è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
            nb_get_retry 3  ! è®¾ç½®é‡è¯•æ¬¡æ•°
            delay_before_retry 3  ! è®¾ç½®é‡è¯•é—´éš”ï¼ˆç§’ï¼‰
        }
    }

    real_server 192.168.192.114 80 {
        weight 1
        TCP_CHECK {
            connect_port 80
            connect_timeout 3
            nb_get_retry 3
            delay_before_retry 3
        }
    }
}
</code></pre> 
<p><span style="color:#fe2c24;">keepalivedä¼šå®šæœŸå¯¹real serverè¿›è¡Œå¥åº·æ£€æŸ¥ï¼Œå¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œå®ƒä¼šå°è¯•é‡æ–°è¿æ¥ã€‚å¦‚æœåœ¨æŒ‡å®šçš„é‡è¯•æ¬¡æ•°å†…éƒ½æ— æ³•æˆåŠŸè¿æ¥<strong>ï¼Œkeepalivedä¼šå°†è¯¥æœåŠ¡å™¨æ ‡è®°ä¸ºä¸å¯ç”¨ï¼Œå¹¶å°†æµé‡è½¬å‘åˆ°å…¶ä»–å¯ç”¨çš„æœåŠ¡å™¨ã€‚</strong></span></p> 
<p><br> Â </p> 
<pre><code class="language-javascript">systemctl start keepalivedÂ Â  Â #å¯åŠ¨æœåŠ¡
systemctl enable keepalivedÂ Â  Â #å¼€æœºè‡ªå¯

systemctl status keepalived</code></pre> 
<p><img alt="" height="542" src="https://images2.imgbox.com/ed/a2/QZr7el5j_o.png" width="1200"></p> 
<p></p> 
<h3 id="%E5%A4%87%E6%9C%8D%E5%8A%A1%E5%99%A8">å¤‡æœåŠ¡å™¨</h3> 
<pre><code>å®‰è£…æ‰€éœ€ç»„ä»¶
yum -y install gcc openssl-devel libnfnetlink-devel libnl libnl3-devel
yum install -y keepalived ipvsadm</code></pre> 
<p>ç¼–è¾‘é…ç½®æ–‡ä»¶</p> 
<p>æ ¹æ®è¡Œå·æ¥ä¿®æ”¹æ‰€éœ€çš„ä¿¡æ¯ æˆ‘éƒ½åˆ—å‡ºæ¥ å¤§å®¶è‡ªè¡Œå¯»æ‰¾å‡ºæ¥ä¿®æ”¹</p> 
<pre><code>vim /etc/keepalived/keepalived.conf</code></pre> 
<p></p> 
<pre><code class="language-javascript"> 12    router_id R2
 13 }
 14 
 15 vrrp_instance VI_1 {
 16     state BACKUP
 17     interface ens33
 18     virtual_router_id 2
 19     priority 95
 20     advert_int 1
 21     authentication {
 22         auth_type PASS
 23         auth_pass 1111
 24     }
 25     virtual_ipaddress {
 26         192.168.192.200
 27     }
 28 }
 
 30 virtual_server 192.168.192.200 80 {
 31     delay_loop 6
 32     lb_algo rr
 33     lb_kind DR
 34     nat_mask 255.255.255.0
 35 #   persistence_timeout 50
 36     protocol TCP
 37 
 38     real_server 192.168.192.112 80 {
 39         weight 1
 40         TCP_CHECK{
 41             connetc_port 80
 42             connect_timeout 3
 43             nb_get_retry 3
 44             delay_before_retry 3
 45          }
 46 
 47     real_server 192.168.192.114 80 {
 48         weight 1
 49         TCP_CHECK{
 50             connetc_port 80
 51             connect_timeout 3
 52             nb_get_retry 3
 53             delay_before_retry 3
 54          }
 55         }
 56         }
 57     }</code></pre> 
<p></p> 
<pre><code class="language-javascript">systemctl start keepalived  #å¯åŠ¨æœåŠ¡
systemctl enable keepalived #å¼€æœºè‡ªå¯</code></pre> 
<pre></pre> 
<p>æŸ¥çœ‹æ˜¯å¦å‡ºé”™</p> 
<pre><code class="language-javascript">systemctl status keepalived</code></pre> 
<p><img alt="" height="574" src="https://images2.imgbox.com/d1/a8/unS4v2II_o.png" width="1200"></p> 
<p></p> 
<p></p> 
<h3 id="%E8%99%9A%E6%8B%9F(%E6%BC%82%E7%A7%BB)%E5%9C%B0%E5%9D%80%E6%B5%8B%E8%AF%95" style="background-color:transparent;">è™šæ‹Ÿ(æ¼‚ç§»)åœ°å€æµ‹è¯•</h3> 
<p>åœ¨ä¸»æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹</p> 
<pre><code class="language-javascript">[root@localhost ~]# ip a sh dev ens33
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000
    link/ether 00:0c:29:af:b6:81 brd ff:ff:ff:ff:ff:ff
    inet 192.168.192.100/24 brd 192.168.192.255 scope global ens33
       valid_lft forever preferred_lft forever
    inet 192.168.192.200/32 scope global ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:feaf:b681/64 scope link 
       valid_lft forever preferred_lft forever</code></pre> 
<p><img alt="" height="368" src="https://images2.imgbox.com/1b/a3/WEbX5zn9_o.png" width="1200"></p> 
<p>å¤‡æœåŠ¡å™¨æŸ¥çœ‹</p> 
<pre><code class="language-javascript">[root@localhost ~]# ip a sh dev ens33
2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000
    link/ether 00:0c:29:b2:65:cb brd ff:ff:ff:ff:ff:ff
    inet 192.168.192.111/24 brd 192.168.192.255 scope global ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::20c:29ff:feb2:65cb/64 scope link 
       valid_lft forever preferred_lft forever</code></pre> 
<p></p> 
<p><img alt="" height="274" src="https://images2.imgbox.com/bb/55/m5oubwGm_o.png" width="1200"></p> 
<p></p> 
<p></p> 
<p><span style="color:#fe2c24;"><strong>æ­¤åˆ»æˆ‘ä»¬å…³é—­ç»ˆæ­¢ä¸»æœåŠ¡å™¨keepalived</strong></span></p> 
<p>åœ¨æŸ¥çœ‹</p> 
<p>ä¸»æœåŠ¡å™¨<img alt="" height="629" src="https://images2.imgbox.com/06/7c/ySmupaz1_o.png" width="1200"></p> 
<p></p> 
<p>å¤‡æœåŠ¡å™¨</p> 
<p><img alt="" height="576" src="https://images2.imgbox.com/49/ab/yUrpywoZ_o.png" width="1200"></p> 
<p></p> 
<p></p> 
<p></p> 
<blockquote> 
 <p><strong>"æˆåŠŸçš„è·¯ä¸Šæ²¡æœ‰æ·å¾„ï¼Œåªæœ‰ä¸æ–­çš„åŠªåŠ›ä¸åšæŒã€‚å¦‚æœä½ å’Œæˆ‘ä¸€æ ·ï¼Œåšä¿¡åŠªåŠ›ä¼šå¸¦æ¥å›æŠ¥ï¼Œè¯·å…³æ³¨æˆ‘ï¼Œç‚¹ä¸ªèµï¼Œä¸€èµ·è¿æ¥æ›´åŠ ç¾å¥½çš„æ˜å¤©ï¼ä½ çš„æ”¯æŒæ˜¯æˆ‘ç»§ç»­å‰è¡Œçš„åŠ¨åŠ›ï¼"</strong></p> 
 <p></p> 
 <p>"æ¯ä¸€æ¬¡åˆ›ä½œéƒ½æ˜¯ä¸€æ¬¡å­¦ä¹ çš„è¿‡ç¨‹ï¼Œæ–‡ç« ä¸­è‹¥æœ‰ä¸è¶³ä¹‹å¤„ï¼Œè¿˜è¯·å¤§å®¶å¤šå¤šåŒ…å®¹ã€‚ä½ çš„å…³æ³¨å’Œç‚¹èµæ˜¯å¯¹æˆ‘æœ€å¤§çš„æ”¯æŒï¼Œä¹Ÿæ¬¢è¿å¤§å®¶æå‡ºå®è´µçš„æ„è§å’Œå»ºè®®ï¼Œè®©æˆ‘ä¸æ–­è¿›æ­¥ã€‚"</p> 
 <p style="text-align:center;">ç¥ç§˜æ³£ç”·å­</p> 
 <p style="text-align:center;"><img alt="" height="289" src="https://images2.imgbox.com/92/d5/2f5Dnyku_o.png" width="296"></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0bdba70eb6871f67e0a7576b76005d67/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">python pandaså¤„ç†è‚¡ç¥¨é‡åŒ–æ•°æ®ï¼šç¬”è®°1</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/39a5c1145245745823e4f556bd3b7781/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">åä¸ƒã€ã€æ–‡æœ¬ç¼–è¾‘å™¨(ä¸‰)ã€‘å›¾åƒåæ ‡å˜æ¢</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>