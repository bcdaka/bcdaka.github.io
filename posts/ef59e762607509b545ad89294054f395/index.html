<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>sql server修改数据库文件位置 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/ef59e762607509b545ad89294054f395/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="sql server修改数据库文件位置">
  <meta property="og:description" content="背景：装数据库的时候将文件位置装在了C盘，C盘分的又比较小，每日数据量增加会导致系统崩溃，没有服务端，只有数据库。
注：1.实体机不要在业务时间操作，拔了网线操作是安全有保障的方法-防止有其他连接，数据写入这些。
2.所有操作先搭测试环境多操作几次，然后再在实体机上操作，毕竟数据很重要，备份也非常重要。
3.不要去移动系统数据库（如master,tempdb…这些），不然整个数据库都会用不了
步骤
下面是将数据库从一个路径转移到另一个路径的常见步骤（以ReportServer为例）:
1.备份数据库
在转移数据库之前，我们首先需要备份数据库，以便在出现任何问题时能够恢复数据。可以使用以下T-SQL语句进行数据库备份:
----1.备份
BACKUP DATABASE [数据库名] TO DISK =&#39;D:\Backup\数据库名.bak&#39; [也可以用块设备的方法备份可以看到更多信息 斜体部分不用操作，了解一下]
[
-----设备块备份
–Use 学生成绩管理
–GO
—Exec sp_addumpdevice ‘disk’,‘备份设备01’,‘d:\backup1\学生成绩管理.bak’
备份数据库命令:
—backup database 学生成绩管理 to 备份设备01
还原数据库
—restore database 学生成绩管理from 备份设备01 with replace
注意:在还原数据库时，必须先关闭要还原的数据库]
—2.先将所需更改的数据库的路径先查询出来再进行关闭
USE [数据库名]; GO SELECT name As [Database Name], physical_name As [File Path], type_desc As [File Type],state_desc FROM sys.master_files WHERE database_id= DB_ID(&#39; [数据库名]&#39;); —3.关闭该数据库
USE master; GO ALTER DATABASE [数据库名] SET OFFLINE WITH ROLLBACK IMMEDIATE; GO 4.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-11T11:04:57+08:00">
    <meta property="article:modified_time" content="2024-05-11T11:04:57+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">sql server修改数据库文件位置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>背景：装数据库的时候将文件位置装在了C盘，C盘分的又比较小，每日数据量增加会导致系统崩溃，没有服务端，只有数据库。</p> 
<p><strong>注：<em>1.实体机不要在业务时间操作，拔了网线操作是安全有保障的方法-防止有其他连接，数据写入这些。<br> 2.所有操作先搭测试环境多操作几次，然后再在实体机上操作，毕竟数据很重要，备份也非常重要。</em><br> <em>3.不要去移动系统数据库（如master,tempdb…这些），不然整个数据库都会用不了</em></strong></p> 
<p>步骤</p> 
<p>下面是将数据库从一个路径转移到另一个路径的常见步骤（以ReportServer为例）:<br> 1.备份数据库<br> 在转移数据库之前，我们首先需要备份数据库，以便在出现任何问题时能够恢复数据。可以使用以下T-SQL语句进行数据库备份:<br> ----1.<strong>备份</strong></p> 
<pre><code class="prism language-bash">BACKUP DATABASE <span class="token punctuation">[</span>数据库名<span class="token punctuation">]</span>
TO DISK <span class="token operator">=</span><span class="token string">'D:\Backup\数据库名.bak'</span>
</code></pre> 
<p><em>[也可以用块设备的方法备份可以看到更多信息 斜体部分不用操作，了解一下]<br> [<br> -----设备块备份<br> –Use 学生成绩管理<br> –GO<br> —Exec sp_addumpdevice ‘disk’,‘备份设备01’,‘d:\backup1\学生成绩管理.bak’<br> 备份数据库命令:<br> —backup database 学生成绩管理 to 备份设备01<br> 还原数据库<br> —restore database 学生成绩管理from 备份设备01 with replace<br> 注意:在还原数据库时，必须先关闭要还原的数据库]</em></p> 
<p>—2.<strong>先将所需更改的数据库的路径先查询出来再进行关闭</strong></p> 
<pre><code class="prism language-bash">USE  <span class="token punctuation">[</span>数据库名<span class="token punctuation">]</span><span class="token punctuation">;</span>
GO
SELECT name As <span class="token punctuation">[</span>Database Name<span class="token punctuation">]</span>,
physical_name As <span class="token punctuation">[</span>File Path<span class="token punctuation">]</span>,
type_desc As <span class="token punctuation">[</span>File Type<span class="token punctuation">]</span>,state_desc
FROM sys.master_files
WHERE <span class="token assign-left variable">database_id</span><span class="token operator">=</span> DB_ID<span class="token punctuation">(</span><span class="token string">' [数据库名]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/49/34/aexCaA6P_o.png" alt="在这里插入图片描述"></p> 
<p>—3.<strong>关闭该数据库</strong></p> 
<pre><code class="prism language-bash">USE master<span class="token punctuation">;</span>
GO
ALTER DATABASE <span class="token punctuation">[</span>数据库名<span class="token punctuation">]</span> SET OFFLINE WITH ROLLBACK IMMEDIATE<span class="token punctuation">;</span> 
GO
</code></pre> 
<p><img src="https://images2.imgbox.com/3d/54/pL5bHnqi_o.png" alt="在这里插入图片描述"><br> 4.<strong>再次查询发现已经是离线</strong></p> 
<pre><code class="prism language-bash">USE  <span class="token punctuation">[</span>数据库名<span class="token punctuation">]</span><span class="token punctuation">;</span>
GO
SELECT name As <span class="token punctuation">[</span>Database Name<span class="token punctuation">]</span>,
physical_name As <span class="token punctuation">[</span>File Path<span class="token punctuation">]</span>,
type_desc As <span class="token punctuation">[</span>File Type<span class="token punctuation">]</span>,state_desc
FROM sys.master_files
WHERE <span class="token assign-left variable">database_id</span><span class="token operator">=</span> DB_ID<span class="token punctuation">(</span><span class="token string">' [数据库名]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/76/aa/1lVYvZFL_o.png" alt="在这里插入图片描述"><br> ----5.<strong>移动数据库文件（文件位置我移到D盘，根据个人情况。文件夹可以不需要建那么长）<br> 注：必须要先把文件夹位置建好，才能执行下列移动位置命令</strong></p> 
<pre><code class="prism language-bash">USE master<span class="token punctuation">;</span>
GO
ALTER DATABASE ReportServer
MODIFY FILE<span class="token punctuation">(</span>NAME <span class="token operator">=</span> <span class="token string">'ReportServer'</span>, FILENAME <span class="token operator">=</span> <span class="token string">'D:\Program Files\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\DATA\ReportServer.mdf'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
GO
ALTER DATABASE ReportServer
MODIFY FILE <span class="token punctuation">(</span>NAME <span class="token operator">=</span> <span class="token string">'ReportServer_log'</span>, FILENAME <span class="token operator">=</span> <span class="token string">'D:\Program Files\Microsoft SQL Server\MSSQL12.MSSQLSERVER\MSSQL\DATA\ReportServer_log.ldf'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
GO
</code></pre> 
<p>----执行成功提示如下<br> <img src="https://images2.imgbox.com/b2/ec/w1aaHTfh_o.png" alt="在这里插入图片描述"><br> —6.<strong>开启数据库时提示报错信息</strong></p> 
<pre><code class="prism language-bash">USE master<span class="token punctuation">;</span>
GO
ALTER DATABASE ReportServer SET ONLINE<span class="token punctuation">;</span>
GO 
</code></pre> 
<p>这是因为文件逻辑位置做了更改，但是文件物理位置没变导致的，需要先找到该数据库在C盘下的位置，移动到D盘下新建的位置即可<br> <img src="https://images2.imgbox.com/b5/29/myPia1q3_o.png" alt="在这里插入图片描述"><br> D盘下现在还没有移动过去<img src="https://images2.imgbox.com/b2/d3/vZPBQ1dX_o.png" alt="在这里插入图片描述"><br> 7.<strong>手动拖过去即可</strong><img src="https://images2.imgbox.com/9f/49/gM8JDvob_o.png" alt="在这里插入图片描述"><br> 注：还有另外一种情况，手动移动过去报错，提示****已在文件中打开，此时需要加权限，如此类报错<br> <img src="https://images2.imgbox.com/fb/c7/N5xdqnd8_o.png" alt="在这里插入图片描述"><br> 解决方法如下<br> 将2个文件都把everyone添加进去，权限为完全控制，即可复制过去。<br> <img src="https://images2.imgbox.com/6d/df/UFO35Oz2_o.png" alt="在这里插入图片描述"><br> 8.<strong>然后移动过去又报操作系统错误5：“5（拒绝访问。）”</strong><img src="https://images2.imgbox.com/7f/ed/m4V5AqwE_o.png" alt="在这里插入图片描述"><br> 9.<strong>这是需要将移动到D盘的数据文件中user的权限改为完全控制，（2个文件都需要这么操作，不然也会报错）然后再次执行</strong><br> <img src="https://images2.imgbox.com/19/21/MC5rYzPX_o.png" alt="在这里插入图片描述"><br> 10.<strong>执行成功</strong><img src="https://images2.imgbox.com/b9/0d/f4WmdY5A_o.png" alt="在这里插入图片描述"><br> 注：执行成功之后，去文件夹下看两边都会有，但是以后写数据只会写在移动到D盘的文件位置里边。以上为我亲测有效的方法。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a38a0edd7f4c66d80cc134f73a3d89b5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Hadoop核心技术</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2e87f451bf0ca95cab644503a4d42e68/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【数据结构】第五讲：栈和队列</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>