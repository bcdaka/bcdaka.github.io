<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python网络爬虫4-实战爬取pdf - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/26d15bd8161d6a6dd0a462ca961db9e5/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Python网络爬虫4-实战爬取pdf">
  <meta property="og:description" content="1.需求背景 爬取松产品中心网站下的家电说明书。这里以冰箱为例：松下电器-冰箱网址
网站分析：
第一步：
点击一个具体的冰箱型号，点击了解更多，会打开此型号电器的详情页面。
第二步：在新打开的详情页面中说明书下载标识
第三步：点击说明书下载，将下载此说明书
2.实现思路与核心步骤 由以上操作，我们知道了模拟用户点击的具体步骤，大致得到了一个整体思路。
主要难点：
如何在整个页面中定位到某一个具体的电器型号，如何遍历依次得到此页面所有型号打开新页面，如何切换到新打开的窗口如何定位到新打开窗口的说明书下载按钮下载完成后如何切换回到原始的页面，进行下一个电器的点击多个页面，如何进行翻页 2.1 得到新页面的链接 依次解决：
1.按F12，打开开发者模式，点击如图所示的1，检查，点击了解详情2，会自动定位显示如图3所示。
发现3标识的href就是此型号的详情页面。所以可以编写函数得到此链接。
这里也有两种方式：
方式一：使用Selenium模拟用户点击，使用xpath定位得到此href
方式二：使用requests直接得到此页面中的所有href链接，发现具体型号的链接时带有product，依据此进行筛选。
本文使用方式二：
def get_allurl(url): &#39;&#39;&#39; 得到url下，所有以.html结尾的href标签下的链接 :param url: :return: &#39;&#39;&#39; result_link = [] html_content = requests.get(url).text soup = BeautifulSoup(html_content, &#34;html.parser&#34;) # 由开发者模式下可以看出，我们需要的href标签时a，且时以.html为结尾 link_nodes = soup.find_all(&#39;a&#39;, href=lambda href: href and href.endswith(&#39;.html&#39;)) for node in link_nodes: tem_url=node.get(&#34;href&#34;) result_link.append(tem_url) return result_link 2.2 模拟用户进行点击下载 进入此页面，发现此网站下的链接并不是直接以.pdf为结尾的链接，而是有封装了一层，所以只能通过模拟用户点击的方式。
同时需要点击两次，首先第一次时说明书下载，出来具体型号，我们这里只选第一个NR-ZE391LG-W这个位置。
点击这些位置，得到其对应的XPATH
代码实现如下：
def clik_url(url): # 初始化WebDriver driver = webdriver.Chrome() # 导航到包含链接的网页 driver.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-11T20:20:32+08:00">
    <meta property="article:modified_time" content="2024-06-11T20:20:32+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python网络爬虫4-实战爬取pdf</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1_0"></a>1.需求背景</h3> 
<p>爬取松产品中心网站下的家电说明书。这里以冰箱为例：<a href="https://consumer.panasonic.cn/product/ref/" rel="nofollow">松下电器-冰箱网址</a><br> 网站分析：<br> 第一步：<br> 点击一个具体的冰箱型号，点击了解更多，会打开此型号电器的详情页面。<br> <img src="https://images2.imgbox.com/8f/98/tjAtkOth_o.png" alt="在这里插入图片描述"><br> 第二步：在新打开的详情页面中说明书下载标识</p> 
<p><img src="https://images2.imgbox.com/e1/4a/riNi6mpN_o.png" alt="在这里插入图片描述"><br> 第三步：点击说明书下载，将下载此说明书</p> 
<h3><a id="2_11"></a>2.实现思路与核心步骤</h3> 
<p>由以上操作，我们知道了模拟用户点击的具体步骤，大致得到了一个整体思路。<br> 主要难点：</p> 
<ol><li>如何在整个页面中定位到某一个具体的电器型号，如何遍历依次得到此页面所有型号</li><li>打开新页面，如何切换到新打开的窗口</li><li>如何定位到新打开窗口的说明书下载按钮</li><li>下载完成后如何切换回到原始的页面，进行下一个电器的点击</li><li>多个页面，如何进行翻页</li></ol> 
<h4><a id="21__20"></a>2.1 得到新页面的链接</h4> 
<p>依次解决：<br> 1.按F12，打开开发者模式，点击如图所示的1，检查，点击了解详情2，会自动定位显示如图3所示。</p> 
<p><img src="https://images2.imgbox.com/2c/18/5Idxmm5r_o.png" alt="在这里插入图片描述"><br> 发现3标识的href就是此型号的详情页面。所以可以编写函数得到此链接。<br> 这里也有两种方式：<br> 方式一：使用Selenium模拟用户点击，使用xpath定位得到此href<br> 方式二：使用requests直接得到此页面中的所有href链接，发现具体型号的链接时带有product，依据此进行筛选。<br> 本文使用方式二：</p> 
<pre><code class="prism language-python">
<span class="token keyword">def</span> <span class="token function">get_allurl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    得到url下，所有以.html结尾的href标签下的链接
    :param url:
    :return:
    '''</span>
    result_link <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    html_content <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>text
    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html_content<span class="token punctuation">,</span> <span class="token string">"html.parser"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 由开发者模式下可以看出，我们需要的href标签时a，且时以.html为结尾</span>
    link_nodes <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> href<span class="token operator">=</span><span class="token keyword">lambda</span> href<span class="token punctuation">:</span> href <span class="token keyword">and</span> href<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> node <span class="token keyword">in</span> link_nodes<span class="token punctuation">:</span>
        tem_url<span class="token operator">=</span>node<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">)</span>
        result_link<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tem_url<span class="token punctuation">)</span>
       
    <span class="token keyword">return</span> result_link
</code></pre> 
<h4><a id="22__52"></a>2.2 模拟用户进行点击下载</h4> 
<p><img src="https://images2.imgbox.com/9b/84/ZazOzCyj_o.png" alt="在这里插入图片描述"><br> 进入此页面，发现此网站下的链接并不是直接以.pdf为结尾的链接，而是有封装了一层，所以只能通过模拟用户点击的方式。</p> 
<p><img src="https://images2.imgbox.com/31/c5/HYqRAJ7p_o.png" alt="在这里插入图片描述"><br> 同时需要点击两次，首先第一次时说明书下载，出来具体型号，我们这里只选第一个NR-ZE391LG-W这个位置。<br> 点击这些位置，得到其对应的XPATH<br> 代码实现如下：</p> 
<pre><code class="prism language-python">
<span class="token keyword">def</span> <span class="token function">clik_url</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 初始化WebDriver</span>
    driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 导航到包含链接的网页</span>
    driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
	
	<span class="token comment"># 为了防止有的型号不包含说明书，不存在对应的xpath路径，出现错误，终止程序</span>
	<span class="token comment"># 这里使用了try except</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
      
        <span class="token comment"># 找到说明书下载按钮的Xpath ='/html/body/div[5]/div/div[2]/div[1]/div/div[1]'</span>
        click_element <span class="token operator">=</span> WebDriverWait<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>until<span class="token punctuation">(</span>
            EC<span class="token punctuation">.</span>element_to_be_clickable<span class="token punctuation">(</span><span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">'/html/body/div[5]/div/div[2]/div[1]/div/div[1]'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token comment"># 点击说明书下载</span>
        click_element<span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># 页面加载完成后会出现具体型号，比如图中的NR-ZE391LG-W，找到此位置</span>
        res<span class="token operator">=</span>WebDriverWait<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>until<span class="token punctuation">(</span>
            EC<span class="token punctuation">.</span>visibility_of_element_located<span class="token punctuation">(</span><span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">'/html/body/div[5]/div/div[2]/div[1]/div/div[2]/ul/li/a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
        <span class="token comment"># 此位置包含了一个以.pdf为结尾的href链接，是我们需要找的。</span>
        <span class="token keyword">if</span> res<span class="token punctuation">:</span>
            new_url<span class="token operator">=</span>res<span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span>
            <span class="token comment"># get_pdf(new_url)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>new_url<span class="token punctuation">)</span>

            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
            driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> new_url

        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"none"</span><span class="token punctuation">)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
            driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        driver<span class="token punctuation">.</span>quit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">pass</span>
</code></pre> 
<p>此函数返回了pdf的具体链接，由此链接就可以直接获取到pdf文件</p> 
<h4><a id="23_pdf_106"></a>2.3 获取pdf文件</h4> 
<p>由以上得到的pdf链接，获取保存为pdf文件。例如：<br> https://home.panasonic.cn/support/attachments/auld/manual/NR-ZE391LG-W.pdf</p> 
<pre><code class="prism language-python">
<span class="token keyword">def</span> <span class="token function">get_pdf</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>output_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    url是一个后缀为.pdf的链接，点击就可以下载pdf文件，此函数保存pdf到output_dir路径
    :param url:
    :param output_dir:
    :return:
    '''</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>output_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>output_dir<span class="token punctuation">)</span>

    <span class="token comment"># 下载文件</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> stream<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        response<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span>

    <span class="token comment"># 提取文件名（这里需要根据你的URL结构或链接的href属性来提取）</span>
    <span class="token comment"># 假设文件名是URL的最后一部分（不包括查询参数）</span>
    filename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>urlparse<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>path<span class="token punctuation">)</span>

    <span class="token comment"># 将文件保存到本地</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>output_dir<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        <span class="token keyword">for</span> chunk <span class="token keyword">in</span> response<span class="token punctuation">.</span>iter_content<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'Downloaded: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>filename<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="3__141"></a>3. 整体流程和代码实现</h3> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_allurl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ······如上所示······
    <span class="token keyword">return</span> result_link

<span class="token keyword">def</span> <span class="token function">get_pdf</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>output_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>

    ······如上所示······
    

<span class="token keyword">def</span> <span class="token function">clik_url</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ······如上所示······
   <span class="token keyword">return</span> new_url

<span class="token comment"># 函数开始入口</span>
<span class="token keyword">def</span> <span class="token function">page_res</span><span class="token punctuation">(</span>page_url<span class="token punctuation">,</span>output_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token comment"># 1.点击到电饭煲的主页面，返回这个页面下所有的以.html结尾的网址</span>
    prod_urls <span class="token operator">=</span> get_allurl<span class="token punctuation">(</span>page_url<span class="token punctuation">)</span>
	
	<span class="token comment"># 2.遍历网址，进行pdf下载</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>prod_urls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span>prod_urls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token comment"># 有一些.html的网页也不含pdf，发现含的都带有product字样，所以进行过滤</span>
        <span class="token keyword">if</span> <span class="token string">'product'</span> <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">(</span>prod_urls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
          
          <span class="token comment"># 3.点击得到新出现的pdf链接</span>
           pdf_url <span class="token operator">=</span> clik_url<span class="token punctuation">(</span>prod_urls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>

           <span class="token keyword">if</span> pdf_url<span class="token punctuation">:</span>
               <span class="token comment"># 4.进行pdf文件下载</span>
               get_pdf<span class="token punctuation">(</span>pdf_url<span class="token punctuation">,</span> output_dir<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"本页下载已完成"</span><span class="token punctuation">)</span>
</code></pre> 
<p>如果想要获取更多页面的冰箱型号，可以观察到不同页面的url是由规律的，直接for循环遍历页面就行了。</p> 
<h3><a id="4_180"></a>4.总结</h3> 
<p>1.使用获取所有链接再进行筛选的方式，代替了模拟用户点击以此定位具体位置，进行点击<br> 2.在新打开的页面中没有直接暴露pdf链接，需要点击说明书下载按钮才能得到pdf链接，点击一次，显示pdf链接之后，并没有继续采用用户点击的方式，而是直接获取（这与网站有关，有点还是不会显示出来，只有点击才会出现）<br> 因为没用采用点击，也不存在页面切换的问题。相比于全部Selenium模拟用户点击，少了许多步骤。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/13d7ac4277aad29e2c35c31a4f6e27ab/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Jenkins的jdk和maven配置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c4752193c989970e6299cd9f6d7ba568/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2024年最佳AI大模型-LLM排名（非常详细）零基础入门到精通，收藏这一篇就够了</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>