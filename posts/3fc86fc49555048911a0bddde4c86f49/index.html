<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>PostgreSQL基本使用与数据备份 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/3fc86fc49555048911a0bddde4c86f49/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="PostgreSQL基本使用与数据备份">
  <meta property="og:description" content="前言
上篇了解了 PostgrerSQL 数据库的部署PostgreSQL关系型数据库介绍与部署-CSDN博客，本篇将继续就其基本操作、备份与还原内容做相关介绍。
目录
一、数据库的操作
1. 本机登录
2. 开启远程登录
2.1 开放远程端口
2.2 编辑配置文件
2.3 修改配置密码
2.4 重启数据库服务
2.5 远程登录
3. 创建数据库
4. 查看数据库
5. 切换当前数据库 6. 删除数据库 二、数据表的操作
1. 新建表
2. 插入数据 3. 查看表结构和内容 4. 更新表内容
5. 删除表内容 三、PostgreSQL 管理
1. 配置文件介绍
2. 数据库相关概念
2.1 数据库的结构组织
2.2 PostgreSQL 中的术语
2.3 模版数据库template0 和template1
3. Schema 模式
3.1 创建一个新的 Schema
3.2 在新的 Schema 中创建一个新的表
3.3 查看 Schema 表
3.4 删除模式 四、用户管理">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-14T19:38:08+08:00">
    <meta property="article:modified_time" content="2024-04-14T19:38:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">PostgreSQL基本使用与数据备份</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>前言</strong></p> 
<p>上篇了解了 PostgrerSQL 数据库的部署<a href="https://blog.csdn.net/qq_64612585/article/details/136954126?spm=1001.2014.3001.5501" title="PostgreSQL关系型数据库介绍与部署-CSDN博客">PostgreSQL关系型数据库介绍与部署-CSDN博客</a>，本篇将继续就其基本操作、备份与还原内容做相关介绍。</p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%93%8D%E4%BD%9C-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%93%8D%E4%BD%9C" rel="nofollow">一、数据库的操作</a></p> 
<p id="1.%20%E6%9C%AC%E6%9C%BA%E7%99%BB%E5%BD%95-toc" style="margin-left:40px;"><a href="#1.%20%E6%9C%AC%E6%9C%BA%E7%99%BB%E5%BD%95" rel="nofollow">1. 本机登录</a></p> 
<p id="2.%20%E5%BC%80%E5%90%AF%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95-toc" style="margin-left:40px;"><a href="#2.%20%E5%BC%80%E5%90%AF%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95" rel="nofollow">2. 开启远程登录</a></p> 
<p id="2.1%20%E5%BC%80%E6%94%BE%E8%BF%9C%E7%A8%8B%E7%AB%AF%E5%8F%A3-toc" style="margin-left:80px;"><a href="#2.1%20%E5%BC%80%E6%94%BE%E8%BF%9C%E7%A8%8B%E7%AB%AF%E5%8F%A3" rel="nofollow">2.1 开放远程端口</a></p> 
<p id="2.2%20%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#2.2%20%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="nofollow">2.2 编辑配置文件</a></p> 
<p id="1.%20%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#1.%20%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="nofollow">2.3 修改配置密码</a></p> 
<p id="2.%20%E9%87%8D%E5%90%AF%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#2.%20%E9%87%8D%E5%90%AF%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1" rel="nofollow">2.4 重启数据库服务</a></p> 
<p id="3.%20%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95-toc" style="margin-left:80px;"><a href="#3.%20%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95" rel="nofollow">2.5 远程登录</a></p> 
<p id="3.%20%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93-toc" style="margin-left:40px;"><a href="#3.%20%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93" rel="nofollow">3. 创建数据库</a></p> 
<p id="4.%20%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93-toc" style="margin-left:40px;"><a href="#4.%20%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93" rel="nofollow">4. 查看数据库</a></p> 
<p id="5.%20%E5%88%87%E6%8D%A2%E5%BD%93%E5%89%8D%E6%95%B0%E6%8D%AE%E5%BA%93%C2%A0-toc" style="margin-left:40px;"><a href="#5.%20%E5%88%87%E6%8D%A2%E5%BD%93%E5%89%8D%E6%95%B0%E6%8D%AE%E5%BA%93%C2%A0" rel="nofollow">5. 切换当前数据库 </a></p> 
<p id="6.%20%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93%C2%A0-toc" style="margin-left:40px;"><a href="#6.%20%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93%C2%A0" rel="nofollow">6. 删除数据库 </a></p> 
<p id="%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E8%A1%A8%E7%9A%84%E6%93%8D%E4%BD%9C-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E8%A1%A8%E7%9A%84%E6%93%8D%E4%BD%9C" rel="nofollow">二、数据表的操作</a></p> 
<p id="1.%20%E6%96%B0%E5%BB%BA%E8%A1%A8-toc" style="margin-left:40px;"><a href="#1.%20%E6%96%B0%E5%BB%BA%E8%A1%A8" rel="nofollow">1. 新建表</a></p> 
<p id="2.%20%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%C2%A0-toc" style="margin-left:40px;"><a href="#2.%20%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%C2%A0" rel="nofollow">2. 插入数据 </a></p> 
<p id="3.%20%E6%9F%A5%E7%9C%8B%E8%A1%A8%E7%BB%93%E6%9E%84%E5%92%8C%E5%86%85%E5%AE%B9%C2%A0-toc" style="margin-left:40px;"><a href="#3.%20%E6%9F%A5%E7%9C%8B%E8%A1%A8%E7%BB%93%E6%9E%84%E5%92%8C%E5%86%85%E5%AE%B9%C2%A0" rel="nofollow">3. 查看表结构和内容 </a></p> 
<p id="4.%20%E6%9B%B4%E6%96%B0%E8%A1%A8%E5%86%85%E5%AE%B9-toc" style="margin-left:40px;"><a href="#4.%20%E6%9B%B4%E6%96%B0%E8%A1%A8%E5%86%85%E5%AE%B9" rel="nofollow">4. 更新表内容</a></p> 
<p id="5.%20%E5%88%A0%E9%99%A4%E8%A1%A8%E5%86%85%E5%AE%B9%C2%A0-toc" style="margin-left:40px;"><a href="#5.%20%E5%88%A0%E9%99%A4%E8%A1%A8%E5%86%85%E5%AE%B9%C2%A0" rel="nofollow">5. 删除表内容 </a></p> 
<p id="%E4%B8%89%E3%80%81PostgreSQL%20%E7%AE%A1%E7%90%86-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81PostgreSQL%20%E7%AE%A1%E7%90%86" rel="nofollow">三、PostgreSQL 管理</a></p> 
<p id="1.%C2%A0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D-toc" style="margin-left:40px;"><a href="#1.%C2%A0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D" rel="nofollow">1. 配置文件介绍</a></p> 
<p id="2.%C2%A0%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5-toc" style="margin-left:40px;"><a href="#2.%C2%A0%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5" rel="nofollow">2. 数据库相关概念</a></p> 
<p id="2.1%C2%A0%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%BB%93%E6%9E%84%E7%BB%84%E7%BB%87-toc" style="margin-left:80px;"><a href="#2.1%C2%A0%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%BB%93%E6%9E%84%E7%BB%84%E7%BB%87" rel="nofollow">2.1 数据库的结构组织</a></p> 
<p id="2.2%C2%A0PostgreSQL%20%E4%B8%AD%E7%9A%84%E6%9C%AF%E8%AF%AD-toc" style="margin-left:80px;"><a href="#2.2%C2%A0PostgreSQL%20%E4%B8%AD%E7%9A%84%E6%9C%AF%E8%AF%AD" rel="nofollow">2.2 PostgreSQL 中的术语</a></p> 
<p id="2.3%20%E6%A8%A1%E7%89%88%E6%95%B0%E6%8D%AE%E5%BA%93template0%20%E5%92%8Ctemplate1-toc" style="margin-left:80px;"><a href="#2.3%20%E6%A8%A1%E7%89%88%E6%95%B0%E6%8D%AE%E5%BA%93template0%20%E5%92%8Ctemplate1" rel="nofollow">2.3 模版数据库template0 和template1</a></p> 
<p id="6.%20Schema%20%E6%A8%A1%E5%BC%8F-toc" style="margin-left:40px;"><a href="#6.%20Schema%20%E6%A8%A1%E5%BC%8F" rel="nofollow">3. Schema 模式</a></p> 
<p id="6.1%C2%A0%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%20Schema-toc" style="margin-left:80px;"><a href="#6.1%C2%A0%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%20Schema" rel="nofollow">3.1 创建一个新的 Schema</a></p> 
<p id="6.2%20%E5%9C%A8%E6%96%B0%E7%9A%84%20Schema%20%E4%B8%AD%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E8%A1%A8-toc" style="margin-left:80px;"><a href="#6.2%20%E5%9C%A8%E6%96%B0%E7%9A%84%20Schema%20%E4%B8%AD%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E8%A1%A8" rel="nofollow">3.2 在新的 Schema 中创建一个新的表</a></p> 
<p id="6.3%20%E6%9F%A5%E7%9C%8B%20Schema%20%E8%A1%A8-toc" style="margin-left:80px;"><a href="#6.3%20%E6%9F%A5%E7%9C%8B%20Schema%20%E8%A1%A8" rel="nofollow">3.3 查看 Schema 表</a></p> 
<p id="3.4%C2%A0%E5%88%A0%E9%99%A4%E6%A8%A1%E5%BC%8F%C2%A0-toc" style="margin-left:80px;"><a href="#3.4%C2%A0%E5%88%A0%E9%99%A4%E6%A8%A1%E5%BC%8F%C2%A0" rel="nofollow">3.4 删除模式 </a></p> 
<p id="%E4%B8%89%E3%80%81%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86" rel="nofollow">四、用户管理</a></p> 
<p id="1.%20%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7-toc" style="margin-left:40px;"><a href="#1.%20%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7" rel="nofollow">1. 创建用户</a></p> 
<p id="2.%20%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81-toc" style="margin-left:40px;"><a href="#2.%20%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81" rel="nofollow">2. 修改密码</a></p> 
<p id="3.%C2%A0%E6%8E%88%E6%9D%83%E7%AE%A1%E7%90%86-toc" style="margin-left:40px;"><a href="#3.%C2%A0%E6%8E%88%E6%9D%83%E7%AE%A1%E7%90%86" rel="nofollow">3. 授权管理</a></p> 
<p id="4.%20%E7%94%A8%E6%88%B7%E5%88%A0%E9%99%A4-toc" style="margin-left:40px;"><a href="#4.%20%E7%94%A8%E6%88%B7%E5%88%A0%E9%99%A4" rel="nofollow">4. 用户删除</a></p> 
<p id="%E5%9B%9B%E3%80%81%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%BF%98%E5%8E%9F%C2%A0-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%BF%98%E5%8E%9F%C2%A0" rel="nofollow">五、备份与还原 </a></p> 
<p id="1.%20%E5%8D%95%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D-toc" style="margin-left:40px;"><a href="#1.%20%E5%8D%95%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D" rel="nofollow">1. 单数据库备份与恢复</a></p> 
<p id="2.%20%E6%89%80%E6%9C%89%E5%BA%93%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%BF%98%E5%8E%9F-toc" style="margin-left:40px;"><a href="#2.%20%E6%89%80%E6%9C%89%E5%BA%93%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%BF%98%E5%8E%9F" rel="nofollow">2. 所有库备份与还原</a></p> 
<p id="3.%20%E6%9B%B4%E5%A4%9A%E9%80%89%E9%A1%B9-toc" style="margin-left:40px;"><a href="#3.%20%E6%9B%B4%E5%A4%9A%E9%80%89%E9%A1%B9" rel="nofollow">3. 更多选项</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%93%8D%E4%BD%9C">一、数据库的操作</h2> 
<h3 id="1.%20%E6%9C%AC%E6%9C%BA%E7%99%BB%E5%BD%95">1. 本机登录</h3> 
<pre><code class="language-bash">格式：
psql -h 服务器 -U 用户名 -d 数据库 -p 端口地址 
psql -h 127.0.0.1 -U dbuser -d exampledb -p 5432

$ psql   
# 连接数据库，默认用户和数据库都是postgres
# 相当于系统用户postgres以同名数据库用户的身份，登录数据库，这是不用输入密码的。如果一切正常，系统提示符会变为"postgres=#”，表示这时己经进入了数据库控制台。

[root@localhost ~]# su - postgres # 切换 postgres 用户
-bash-4.2$ psql                   # 登录 PostgreSQL 控制台，可以输入该数据库支持的一些命令
psql (14.11)
输入 "help" 来获取帮助信息.

postgres=# alter user postgres with password '123123'; # 修改 postgres 用户密码
ALTER ROLE
postgres=# \q                     # 退出该数据库
-bash-4.2$ 
</code></pre> 
<p>方法一：在默认配置下，本机访问 PostgreSQL</p> 
<pre><code class="language-bash">[root@localhost ~]# su - postgres               # 切换 postgres 用户
-bash-4.2$ psql                                 # 登录 PostgreSQL 控制台
psql (14.11)
输入 "help" 来获取帮助信息.

postgres=#                       # 此时说明用 postgres 身份登录数据库，且不需要密码
postgres=# \password postgres    # 给 postgres 用户设置密码
Enter new password for user "postgres": 
再输入一遍：
</code></pre> 
<p>方法二：创建新用户来访问 PostgreSQL</p> 
<pre><code class="language-bash">[root@localhost ~]# su - postgres              # 切换linux用户postgres
-bash-4.2$ psql                                # 执行psql
psql (14.11)
输入 "help" 来获取帮助信息.

postgres=# create user dbfql with password '123456'; # 创建数据库用户dbfql
CREATE ROLE
postgres=# craete database db1 owner dbfql;          # 创建数据库db1
CREATE DATABASE
postgres=# grant all privileges on database db1 to dbfql;  # 将db1数据库的所有权都赋予dbdql
GRANT  
postgres=# \q-bash-4.2$ exit
登出

[root@localhost ~]# useradd dbfql                    # 创建普通用户dbfql
[root@localhost ~]# passwd dbfql
[root@localhost ~]# su - dbfql
[dbfql@localhost ~]$ psql -d db1
psql (14.11)
输入 "help" 来获取帮助信息.

db1=&gt; 
</code></pre> 
<p>方法三：已存在普通用户，在数据库创建同名用户和数据库</p> 
<pre><code class="language-bash">[root@localhost ~]# id lisi
uid=1002(lisi) gid=1002(lisi) 组=1002(lisi)
[root@localhost ~]# su - postgres
-bash-4.2$ psql
psql (14.11)
输入 "help" 来获取帮助信息
postgres=# create user lisi with password '123456';
CREATE ROLE
postgres=# create database lisidb owner lisi;
CREATE DATABASE
postgres=# grant all privileges on database lisidb to lisi;
GRANT
postgres=# \q
-bash-4.2$ exit
登出

[root@localhost ~]# su - lisi
[lisi@localhost ~]$ psql -d lisidb
psql (14.11)
输入 "help" 来获取帮助信息.

lisidb=&gt; </code></pre> 
<h3 id="2.%20%E5%BC%80%E5%90%AF%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95">2. 开启远程登录</h3> 
<p>以上篇编译安装目录为例，默认安装配置文件路径如下：</p> 
<ul><li>主要配置文件：/var/lib/pgsql/14/data/postgresql.conf</li><li>主机基于身份验证配置文件：/var/lib/pgsql/14/data/pg_hba.conf</li></ul> 
<h4 id="2.1%20%E5%BC%80%E6%94%BE%E8%BF%9C%E7%A8%8B%E7%AB%AF%E5%8F%A3">2.1 开放远程端口</h4> 
<pre><code class="language-bash">允许TCP端口5432的传入连接，并将规则永久性地添加到防火墙配置中，防火墙关闭可以忽略
firewall-cmd --add-port=5432/tcp --permanent  # --permanent选项表示该规则是永久性的
firewall-cmd --reload                         # 重新加载防火墙配置</code></pre> 
<h4 id="2.2%20%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">2.2 编辑配置文件</h4> 
<pre><code class="language-bash">[root@localhost ~]# vim /pgsql/data/postgresql.conf # 主要配置文件
listen_addresses = '*'
# 在所有IP地址上监听，从而允许远程连接到数据库服务器，默认只允许本机登录

[root@localhost ~]# vim /pgsql/data/pg_hba.conf     # "主机基于身份验证" 配置文件
# "local" is for Unix domain socket connections only
local   all             all                                     peer
# IPv4 local connections:
host    all             all             127.0.0.1/32            scram-sha-256
host    all             all             192.168.190.0/24        trust   # 添加此行
# 允许任意用户（第二个 "all"）从192.168.190段地址上以md5密码方式访问任意数据库（第一个 "all"）
# peer： 使用 "peer" 认证方式时，系统会检查操作系统用户是否与要连接到数据库的数据库角色名称相匹配；不需要输入密码来连接到数据库，只需确保操作系统用户名和数据库角色名称匹配即可完成认证。
# md5：当使用 "md5" 时，客户端连接时需要提供经过 MD5 加密的密码进行认证。
# trust方法表示无需密码即可连接数据库
# scram-sha-256：相比之下，"scram-sha-256" 使用了更安全的加密机制，比 MD5 更安全。</code></pre> 
<h4 id="1.%20%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">2.3 修改配置密码</h4> 
<pre><code class="language-bash">[root@localhost ~]# su - postgres
上一次登录：日 3月 24 15:17:53 CST 2024pts/1 上
[postgres@localhost ~]$ psql
psql (14.1)
Type "help" for help.

postgres=# alter user postgres with password '123123';  # 登录数据修改密码
ALTER ROLE
或者：
postgres=# \password postgres   # 给 postgres 用户设置密码
Enter new password for user "postgres": 
再输入一遍：</code></pre> 
<h4 id="2.%20%E9%87%8D%E5%90%AF%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9C%8D%E5%8A%A1">2.4 重启数据库服务</h4> 
<pre><code class="language-bash">[root@localhost ~]# systemctl restart postgresql.service
或者：
[postgres@localhost ~]$ pg_ctl restart   # 重启</code></pre> 
<h4 id="3.%20%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95">2.5 远程登录</h4> 
<p>① 使用 linux 系统字符登录</p> 
<pre><code class="language-bash">[root@localhost ~]# psql -U postgres -h 192.168.190.100
用户 postgres 的口令：
psql (14.11, 服务器 14.1)
输入 "help" 来获取帮助信息.

postgres=# 
</code></pre> 
<p> ② 使用 Navicat 工具登录（可能存在版本问题，可以修改 pg_hba.conf 认证方式为 trust）</p> 
<p><img alt="" src="https://images2.imgbox.com/99/7e/iGsERzO3_o.png"><img alt="" src="https://images2.imgbox.com/32/66/sa3y5mAr_o.png"></p> 
<h3 id="3.%20%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93">3. 创建数据库</h3> 
<pre><code class="language-bash">在数据库控制台下创建操作：
postgres=# create database mydb;
CREATE DATABASE
也可以在壳下进行创建操作：
[postgres@localhost ~]$ createdb 库名;</code></pre> 
<h3 id="4.%20%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93">4. 查看数据库</h3> 
<pre><code class="language-bash">mydb=# \l
                                     数据库列表
   名称    |  拥有者  | 字元编码 |  校对规则   |    Ctype    |       存取权限        
-----------+----------+----------+-------------+-------------+-----------------------
 mydb      | postgres | UTF8     | zh_CN.UTF-8 | zh_CN.UTF-8 | 
 postgres  | postgres | UTF8     | zh_CN.UTF-8 | zh_CN.UTF-8 | 
 template0 | postgres | UTF8     | zh_CN.UTF-8 | zh_CN.UTF-8 | =c/postgres          +
           |          |          |             |             | postgres=CTc/postgres
 template1 | postgres | UTF8     | zh_CN.UTF-8 | zh_CN.UTF-8 | =c/postgres          +
           |          |          |             |             | postgres=CTc/postgres
</code></pre> 
<p><img alt="" src="https://images2.imgbox.com/ba/ee/6Z95vkXr_o.png"></p> 
<h3 id="5.%20%E5%88%87%E6%8D%A2%E5%BD%93%E5%89%8D%E6%95%B0%E6%8D%AE%E5%BA%93%C2%A0">5. 切换当前数据库 </h3> 
<pre><code class="language-bash">postgres=# \c mydb;
您现在已经连接到数据库 "mydb",用户 "postgres".</code></pre> 
<h3 id="6.%20%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93%C2%A0">6. 删除数据库 </h3> 
<pre><code class="language-bash">postgres=# drop database mydb;  # 注意，删除数据库是一个不可逆的操作
ERROR:  database "mydb" is being accessed by other users
DETAIL:  There is 1 other session using the database.
# 在PostgreSQL中，如果有其他用户正在使用数据库，你就不能删除它

postgres=# select * from pg_stat_activity where datname = 'mydb';
# 可以通过查询 pg_stat_activity 视图来检查是否有活动的会话，确保没有用户正在使用数据库 "mydb"，再次删除</code></pre> 
<h2 id="%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E8%A1%A8%E7%9A%84%E6%93%8D%E4%BD%9C">二、数据表的操作</h2> 
<h3 id="1.%20%E6%96%B0%E5%BB%BA%E8%A1%A8">1. 新建表</h3> 
<pre><code class="language-bash">语法与mysql基本相似：
postgres=# \c mydb    # 切换到 mydb 库
You are now connected to database "mydb" as user "postgres".
mydb=# create table class (id int,name char(15));  # 新建表 class
CREATE TABLE
# 在 mysql 中 auto_increment 代表自增，在这里使用 serial 可以实现自增，但是不能与 int 一起使用</code></pre> 
<h3 id="2.%20%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE%C2%A0">2. 插入数据 </h3> 
<pre><code class="language-bash">mydb=# insert into class values (1,'zhangsan'); 
mydb=# insert into class values (2,'lisi');
</code></pre> 
<h3 id="3.%20%E6%9F%A5%E7%9C%8B%E8%A1%A8%E7%BB%93%E6%9E%84%E5%92%8C%E5%86%85%E5%AE%B9%C2%A0">3. 查看表结构和内容 </h3> 
<pre><code class="language-bash">mydb=# \dt                  # 列出当前数据库中的所有表
         List of relations
 Schema |  Name  | Type  |  Owner   
--------+--------+-------+----------
 public | class  | table | postgres


mydb=# \d class             # 查看表结构，不指定表可以查看当前库所有表，\d相当于desc
                  Table "public.class"
 Column |     Type      | Collation | Nullable | Default 
--------+---------------+-----------+----------+---------
 id     | integer       |           |          | 
 name   | character(15) |           |          | 

mydb=# select * from class; # 查看表内容
 id |      name       
----+-----------------
  1 | zhangsan       
  2 | lisi   </code></pre> 
<h3 id="4.%20%E6%9B%B4%E6%96%B0%E8%A1%A8%E5%86%85%E5%AE%B9">4. 更新表内容</h3> 
<pre><code class="language-bash">mydb=# select * from class;
 id |      name       
----+-----------------
  2 | lisi           
  1 | wangwu         
(2 rows)

mydb=# select * from class order by id;  # 按 id 升序查看
 id |      name       
----+-----------------
  1 | wangwu         
  2 | lisi </code></pre> 
<h3 id="5.%20%E5%88%A0%E9%99%A4%E8%A1%A8%E5%86%85%E5%AE%B9%C2%A0">5. 删除表内容 </h3> 
<pre><code class="language-bash">mydb=# delete from class where id=1;
mydb=# select * from class;
 id |      name       
----+-----------------
  2 | lisi </code></pre> 
<h2 id="%E4%B8%89%E3%80%81PostgreSQL%20%E7%AE%A1%E7%90%86"><strong>三、PostgreSQL</strong> <strong>管理</strong></h2> 
<h3 id="1.%C2%A0%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BB%8B%E7%BB%8D">1. 配置文件介绍</h3> 
<p>PostgreSQL 使用环境变量 PGDATA 指向的目录做为数据存放的目录。这个目录是在安装时指定的，所以在安装时需要指定一个合适的目录作为数据目录的根目录，而且，每一个 PG 数据库实例都需要有这样的一个目录。此数据目录的初始化是使用命令 initdb 来完成的。初始化完成后， PGDATA 数据目录下就会生成三个配置文件</p> 
<ul><li>postgresql.conf：数据库实例的主配置文件，基本上所有的配置参数都在此文件中 </li><li>pg_hba.conf：认证配置文件，配置了允许哪些IP的主机访问数据库，认证的方法是什么等信息</li><li>pg_ident.conf：认证方式ident的用户映射文件</li></ul> 
<h3 id="2.%C2%A0%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5">2. 数据库相关概念</h3> 
<h4 id="2.1%C2%A0%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%BB%93%E6%9E%84%E7%BB%84%E7%BB%87">2.1 数据库的结构组织</h4> 
<p><img alt="" src="https://images2.imgbox.com/92/5c/rT90R5DZ_o.png"></p> 
<p>在一个 PostgreSQL 数据库系统中，数据的组织结构可以分为以下五层：</p> 
<ul><li>实例: 一个 PostgreSQL 对应一个安装的数据目录$PGDATA，即一个instance实例</li><li>数据库：一个 PostgreSQL 数据库服务下可以管理多个数据库，当应用连接到一个数据库时，一般只能访问这个数据库中的数据，而不能访问其他数据库中的内容默认情况下初始实例只有三个数据库： postgres、template0、template1</li><li>模式：一个数据库可以创建多个不同的名称空间即 Schema，用于分隔不同的业务数据</li><li>表和索引：一个数据库可以有多个表和索引。在 PostgreSQL 中表的术语称为 Relation，而在其他数据库中通常叫Table</li><li>行和列：每张表中有很多列和行数据。在 PostgreSQL 中行的术语一般为“Tuple”，而在其他数据库中则叫“Row”</li></ul> 
<h4 id="2.2%C2%A0PostgreSQL%20%E4%B8%AD%E7%9A%84%E6%9C%AF%E8%AF%AD">2.2 PostgreSQL 中的术语</h4> 
<p>PostgreSQL 有一些术语与其他数据库中不一样，了解了这些术语的意思，就能更好地看懂PostgreSQL 中的文档。与其他数据库不同的术语如下：</p> 
<ul><li>Relation：表示表table或索引index，具体表示的是Table还是 Index需要看具体情况</li><li>Tuple：表示表中的行，在其他数据库中使用Row来表示</li><li>Segment：每个表和索引都单独对应一个文件,,即为segment,如果文件大小超过1GB,会创建多个相同名称但后缀不同的文件</li><li>Page：表示在磁盘中的数据块。在文件中以块为单位存放数据, 默认值为8KB,最大可以为32KB</li><li>Buffer：表示在内存中的数据块</li></ul> 
<h4 id="2.3%20%E6%A8%A1%E7%89%88%E6%95%B0%E6%8D%AE%E5%BA%93template0%20%E5%92%8Ctemplate1">2.3 模版数据库template0 和template1</h4> 
<p>template1 和 template0 是 PostgreSQL 的模板数据库。所谓模板数据库就是创建新 database 时，PostgreSQL 会基于模板数据库制作一份副本，其中会包含所有的数据库设置和数据文件。</p> 
<p>PostgreSQL安装好以后会默认附带两个模板数据库： 默认模板库为 template0 和template1。默认模板库为 template1，也可以指定template0</p> 
<p>template1 和t emplate0 的区别主要有两点：</p> 
<ul><li>template1 可以连接，template0 不可以连接</li><li>使用 template1 模板库建库时不可指定新的encoding 和locale，而 template0可以</li></ul> 
<p>注意：template0和template1都不能被删除。</p> 
<h3 id="6.%20Schema%20%E6%A8%A1%E5%BC%8F">3. Schema 模式</h3> 
<p>在 PostgreSQL 中，Schema 是一种用于组织和命名数据库对象（如表、视图、函数等）的机制。它提供了命名空间隔离、权限控制和代码组织的功能，使得在同一个数据库中可以创建多个相互独立的对象，更精细地控制用户对数据库对象的访问，以及更好地组织和管理数据库对象。每个数据库都包含一个默认的 Schema，名为 public，但是你也可以创建自己的 Schema。 </p> 
<p>使用模式的优势：</p> 
<ul><li>允许多个用户使用一个数据库并且不会互相干扰</li><li>将数据库对象组织成逻辑组以便更容易管理</li><li>第三方应用的对象可以放在独立的模式中，这样它们就不会与其他对象的名称发生冲突模式类似于操作系统层的目录，但是模式不能嵌套</li></ul> 
<h4 id="6.1%C2%A0%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%20Schema">3.1 创建一个新的 Schema</h4> 
<pre><code class="language-bash">mydb=# create schema myschema;
CREATE SCHEMA
mydb=# \dn        # 查看模式
</code></pre> 
<h4 id="6.2%20%E5%9C%A8%E6%96%B0%E7%9A%84%20Schema%20%E4%B8%AD%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E8%A1%A8">3.2 在新的 Schema 中创建一个新的表</h4> 
<pre><code class="language-bash">mydb=# create table myschema.student (id serial,name char(15));
CREATE TABLE
</code></pre> 
<h4 id="6.3%20%E6%9F%A5%E7%9C%8B%20Schema%20%E8%A1%A8">3.3 查看 Schema 表</h4> 
<pre><code class="language-bash">mydb=# \dt myschema.*         # 查看 Schema 中的所有表
           List of relations
  Schema  |  Name   | Type  |  Owner   
----------+---------+-------+----------
 myschema | student | table | postgres

mydb=# insert into myschema.student values (1,'lisi');
INSERT 0 1
mydb=# select * from myschema.student;
 id |      name       
----+-----------------
  1 | lisi  </code></pre> 
<h4 id="3.4%C2%A0%E5%88%A0%E9%99%A4%E6%A8%A1%E5%BC%8F%C2%A0">3.4 删除模式 </h4> 
<pre><code class="language-bash">格式：
drop schema schema_name;

示例：
postgres=# \c mydb1
mydb1=# create schema schema_db1;
mydb1=# \dn
    List of schemas
    Name    |  Owner   
------------+----------
 myschema   | postgres
 public     | postgres
 schema_db1 | postgres
mydb1=# drop schema schema_db1;  # 删除模式
mydb1=# \dn
   List of schemas
   Name   |  Owner   
----------+----------
 myschema | postgres
 public   | postgres</code></pre> 
<h2 id="%E4%B8%89%E3%80%81%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86">四、用户管理</h2> 
<p>新建用户、修改密码等操作，前文已做相关介绍，这里继续介绍一下用户的权限管理与用户删除。</p> 
<h3 id="1.%20%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7">1. 创建用户</h3> 
<pre><code class="language-bash">mydb=# create user fql with password '123456';  # 创建用户 fql 并设置密码 123456
CREATE ROLE
</code></pre> 
<h3 id="2.%20%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81">2. 修改密码</h3> 
<pre><code class="language-bash">mydb=# alter user fql with password '666666'; # 修改用户 fql 密码为 666666
ALTER ROLE</code></pre> 
<h3 id="3.%C2%A0%E6%8E%88%E6%9D%83%E7%AE%A1%E7%90%86">3. 授权管理</h3> 
<pre><code class="language-bash">数据库授权，赋予指定账户指定数据库所有权限，格式如下：
grant all privileges on database 'dbname' To 'username';

mydb=# grant all privileges on database mydb to fql;
# 将数据库 mydb 赋予用户 fql 所有权限
mydb=# grant all privileges on all tables in schema public to fql;
# 但此时用户还是没有读写权限，需要继续授权表,授予用户 fql 对 public Schema 中的所有表的所有权限
# 注意，该sql语句必须在所要操作的数据库里执行

查看权限：
[root@localhost ~]# psql -U fql -d mydb;
\du             # 列出所有的用户，包括他们的角色、登录权限、超用户权限等信息
\du username    # 查看指定用户的权限

移除指定账户指定数据库/表所有权限：
mydb=# revoke all privileges on database mydb from fql;
mydb=# revoke all privileges on all tables in schema public from fql;</code></pre> 
<h3 id="4.%20%E7%94%A8%E6%88%B7%E5%88%A0%E9%99%A4">4. 用户删除</h3> 
<pre><code class="language-bash">mydb=# drop user 用户名;
# 注意，需要删除给予库/表的权限，才可以执行删除动作</code></pre> 
<h2 id="%E5%9B%9B%E3%80%81%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%BF%98%E5%8E%9F%C2%A0">五、备份与还原 </h2> 
<h3 id="1.%20%E5%8D%95%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D">1. 单数据库备份与恢复</h3> 
<p>PostgreSQL 提供了 pg_dump 实用程序来简化备份单个数据库的过程。 必须以对要备份的数据库具有读取权限的用户身份运行此命令。以 postgres 用户身份登录：</p> 
<pre><code class="language-bash">[root@localhost ~]# su - postgres
[postgres@localhost ~]$ 
</code></pre> 
<p>① 通过运行以下命令将数据库的内容转储到文件中</p> 
<pre><code class="language-bash">[postgres@localhost ~]$ pg_dump mydb &gt; /pgsql/mydb.bak

[root@localhost pgsql]# ll
总用量 8
drwx------. 19 postgres postgres 4096 4月   6 15:06 data
-rw-rw-r--.  1 postgres postgres 3500 4月   6 18:30 mydb.bak
# 生成的备份文件 mydb.bak 可以使用 scp 传输到另一台主机，也可以存储在本地以供以后使用
</code></pre> 
<p> ② 模拟删除数据库，并新建空库</p> 
<pre><code class="language-bash">[root@localhost pgsql]# psql
postgres=# drop database mydb;

恢复数据库，需要先建立一个空库：
postgres=# create database mydb1;</code></pre> 
<p>③ 恢复，验证数据</p> 
<pre><code class="language-bash">[root@localhost pgsql]# psql mydb1 &lt; /pgsql/mydb.bak;
postgres=# \c mydb1
You are now connected to database "mydb1" as user "postgres".
mydb1=# \dt
         List of relations
 Schema |  Name  | Type  |  Owner   
--------+--------+-------+----------
 public | class  | table | postgres
 public | class1 | table | postgres
</code></pre> 
<p>备份格式有几种选择：</p> 
<ul><li>*.bak：压缩二进制格式</li><li>*.sql：明文转储</li><li>*.tar：tarball</li></ul> 
<p>注意：默认情况下，PostgresQL 将忽路备份过程中发生的任何错误，这可能导致备份不完整，要防止这种情况，可以使用 -1 选项运行 pg_dunp 命令。这会将整个备份过程视为单个事务，这将在发生错误时阻止部分备份。 </p> 
<h3 id="2.%20%E6%89%80%E6%9C%89%E5%BA%93%E5%A4%87%E4%BB%BD%E4%B8%8E%E8%BF%98%E5%8E%9F">2. 所有库备份与还原</h3> 
<p>由于 pg_dump 一次只创建一个数据库的备份，因此它不会存储有关数据库角色或其他群集范围配置的信息。 要存储此信息并同时务份所有数据库，可以使用 pg_dumpall。</p> 
<p>① 创建备份文件</p> 
<pre><code class="language-bash">[postgres@localhost ~]$ pg_dumpall &gt; /pgsql/allpg.bak</code></pre> 
<p>② 从备份还原所有数据库</p> 
<pre><code class="language-bash">[postgres@localhost ~]$  psql -f /pgsql/allpg.bak postgres
# -f 选项用于指定要执行的 SQL 脚本文件或文件路径</code></pre> 
<h3 id="3.%20%E6%9B%B4%E5%A4%9A%E9%80%89%E9%A1%B9">3. 更多选项</h3> 
<pre><code class="language-bash">备份数据库：
pg_dump -U postgres -f /pgsql/postgres.sgl postgres
# 导出 postgres 数据岸保存为 postgres.sql
pg_dump -U postgres -f /pgsql/postgres.sql -t test postgres
# 导出 postgres 数据库中表 test 的数据
pg_dump -U postgres -F t -f /pgsql/postgres.tar postgres
# -F t：这个选项指定了备份文件的格式。t 表示 "tar" 格式，导出 postgres 数据库以 tar 形式压缩保存为 postgres.tar

恢复数据库：
psgl-postgres -f /pgsql/postgres.sql newsql
# 恢复 postgres.sql 数据到 newsql 数据库
pg_restore -- 
# 从 pg_dump 创建的备份文件中恢复 PostgresQL 数据库,用于恢复由 pg_dump 转储的任何非纯文本格式中的PostgreSQL 数据库
pg_restore -U postgres -d newsql /pgsql/postgres.tar
# 恢复 postgres.tar 数据列 newsql 数据库</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/897a036a0be1c67c97297fe77c9087dd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">eNSP防火墙配置实验（trust、DMZ、untrust）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/15ba2fa16554120bac1c3f3b8a039a03/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python作品 运动模糊图像修复算法(上)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>