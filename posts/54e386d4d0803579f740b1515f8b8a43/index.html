<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 14 变更及适配攻略 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/54e386d4d0803579f740b1515f8b8a43/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Android 14 变更及适配攻略">
  <meta property="og:description" content="准备工作 首先将我们项目中的 targetSdkVersion和compileSdkVersion 升至 34。
影响Android 14上所有应用 1.最低可安装的目标 API 级别 从 Android 14 开始，targetSdkVersion 低于 23 的应用无法安装。要求应用满足这些最低目标 API 级别要求有助于提高用户的安全性和隐私性。
恶意软件通常会以较旧的 API 级别为目标平台，以绕过在较新版本 Android 中引入的安全和隐私保护机制。例如，有些恶意软件应用使用 targetSdkVersion 22，以避免受到 Android 6.0 Marshmallow（API 级别 23）在 2015 年引入的运行时权限的约束。这项 Android 14 变更使恶意软件更难以规避安全和隐私权方面的改进限制。
注意在升级到 Android 14 的设备上，targetSdkVersion 低于 23 的所有应用都将继续保持安装状态。
2.默认拒绝设定精确的闹钟 精确闹钟适用于用户指定的通知，或是在确切时间需要执行的操作。
SCHEDULE_EXACT_ALARM 是 Android 12 中引入的可让应用安排精确闹钟的权限，不再预先授予以 Android 13 和更高版本为目标平台的最新安装应用（默认情况下，设置为“拒绝”）。如果用户通过备份和恢复操作将应用数据转移到搭载 Android 14 的设备，则该权限仍然会被拒绝。如果现有应用已拥有此权限，则当设备升级到 Android 14 时，系统会预先授予此权限。
需要 SCHEDULE_EXACT_ALARM 权限才能通过以下 API 启动精确闹钟，否则系统会抛出 SecurityException：
setExact()setExactAndAllowWhileIdle()setAlarmClock() 注意：如果使用 OnAlarmListener 对象设置精确闹钟（例如在 setExact API 中），则不需要 SCHEDULE_EXACT_ALARM 权限。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-05T11:38:48+08:00">
    <meta property="article:modified_time" content="2024-05-05T11:38:48+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 14 变更及适配攻略</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/0e/dd/ddw8u4Wc_o.jpg" alt="请添加图片描述"></p> 
<h3><a id="_1"></a>准备工作</h3> 
<p>首先将我们项目中的 <code>targetSdkVersion</code>和<code>compileSdkVersion</code> 升至 34。</p> 
<h3><a id="Android_14_5"></a>影响Android 14上所有应用</h3> 
<h4><a id="1_API__7"></a>1.最低可安装的目标 API 级别</h4> 
<blockquote> 
 <p>从 Android 14 开始，targetSdkVersion 低于 23 的应用无法安装。要求应用满足这些最低目标 API 级别要求有助于提高用户的安全性和隐私性。</p> 
</blockquote> 
<p>恶意软件通常会以较旧的 API 级别为目标平台，以绕过在较新版本 Android 中引入的安全和隐私保护机制。例如，有些恶意软件应用使用 <code>targetSdkVersion</code> 22，以避免受到 Android 6.0 Marshmallow（API 级别 23）在 2015 年引入的运行时权限的约束。这项 Android 14 变更使恶意软件更难以规避安全和隐私权方面的改进限制。</p> 
<p>注意在升级到 Android 14 的设备上，<code>targetSdkVersion</code> 低于 23 的所有应用都将继续保持安装状态。</p> 
<h4><a id="2_15"></a>2.默认拒绝设定精确的闹钟</h4> 
<blockquote> 
 <p>精确闹钟适用于用户指定的通知，或是在确切时间需要执行的操作。</p> 
</blockquote> 
<p><code>SCHEDULE_EXACT_ALARM</code> 是 Android 12 中引入的可让应用安排精确闹钟的权限，不再预先授予以 Android 13 和更高版本为目标平台的最新安装应用（默认情况下，设置为“拒绝”）。如果用户通过备份和恢复操作将应用数据转移到搭载 Android 14 的设备，则该权限仍然会被拒绝。如果现有应用已拥有此权限，则当设备升级到 Android 14 时，系统会预先授予此权限。</p> 
<p>需要 <code>SCHEDULE_EXACT_ALARM</code> 权限才能通过以下 API 启动精确闹钟，否则系统会抛出 <code>SecurityException</code>：</p> 
<ul><li>setExact()</li><li>setExactAndAllowWhileIdle()</li><li>setAlarmClock()</li></ul> 
<p>注意：如果使用 <code>OnAlarmListener</code> 对象设置精确闹钟（例如在 <code>setExact</code> API 中），则不需要 <code>SCHEDULE_EXACT_ALARM</code> 权限。</p> 
<p>官方建议开发者评估其使用场景，并确定精确闹钟是否仍然适用于他们。如果可以使用不精确闹钟，可以使用<code>WorkManager</code>或者<code>AlarmManager</code>的<code>setAndAllowWhileIdle()</code> , <code>setWindow()</code>或 <code>set()</code> API。</p> 
<p>如果继续使用精确闹钟，首先使用<code>AlarmManager</code>的<code>canScheduleExactAlarms()</code> 检查权限。没有权限时，可以引导用户跳动系统设置页 <code>startActivity(Intent(Settings.ACTION_REQUEST_SCHEDULE_EXACT_ALARM))</code>去开启权限。最后在<code>onResume()</code>或者监听用户授予权限时系统发送的<code>AlarmManager.ACTION_SCHEDULE_EXACT_ALARM_PERMISSION_STATE_CHANGED</code>广播来设置精确闹钟。</p> 
<p>最后记得添加权限到AndroidManifest.xml中：</p> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.SCHEDULE_EXACT_ALARM"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="3_39"></a>3.关于不可关闭通知用户体验方式的变更</h4> 
<p>通过 <code>setOngoing(true)</code> 或设置 <code>Notification.FLAG_ONGOING_EVENT</code> 来阻止用户关闭前台通知的应用。在Android 14上用户实际上能够关闭此类通知。</p> 
<p>在以下情况下，此类通知仍不可关闭：</p> 
<ul><li>当手机处于锁屏状态时。</li><li>如果用户选择全部清除通知操作（有助于防止意外关闭）。</li><li>使用 <code>CallStyle</code> 绑定到呼叫的通知。</li><li>使用 <code>NotificationCompat.MediaStyle</code> 创建的媒体通知。</li><li>企业设备政策控制器 (DPC) 和支持软件包</li><li>默认的搜索选择器软件包。</li></ul> 
<h4><a id="4_52"></a>4.获得照片和视频的部分访问权限</h4> 
<p>Android 14 引入了“选定照片访问”，允许用户授予应用对其库中特定图像和视频的访问权限，而不是授予对给定类型的所有媒体的访问权限。</p> 
<p><img src="https://images2.imgbox.com/70/33/7gAERoWq_o.jpg" alt="请添加图片描述" width="360"></p> 
<p>如果您在应用中使用了照片选择器，就无需请求任何存储权限，不受此变更影响。</p> 
<p>如果您使用存储权限维护自己的图库选择器，请调整您的应用以使用新的<code>READ_MEDIA_VISUAL_USER_SELECTED</code>权限。如果您的应用不使用新权限，系统将以兼容模式运行您的应用。</p> 
<p>兼容模式：如果应用不使用新权限，应用请求<code>READ_MEDIA_IMAGES</code>或<code>READ_MEDIA_VIDEO</code>权限，则系统会自动添加<code>READ_MEDIA_VISUAL_USER_SELECTED</code>权限到你的应用。当您的应用程序移动到后台时，或者当用户主动杀死您的应用程序时，系统最终会拒绝这些权限。这种行为就像其他一次性权限一样。</p> 
<p>因为没有适配新权限，所以当用户选定了部分照片的访问权限后，如果用户想修改可见范围，无法做主动修改。因为对于此时的应用来说，是有<code>READ_MEDIA_IMAGES</code>或<code>READ_MEDIA_VIDEO</code>权限的。不可能每次都询问用户指定访问范围。</p> 
<p>其实整体看来，兼容模式影响不大，应用可以正常使用。如果想要一个良好的用户交互体验，需要做适配，具体适配方法我们下面再详细说明。</p> 
<h3><a id="Android_13_67"></a>影响以Android 13或更高版本为目标平台的应用</h3> 
<h4><a id="1_69"></a>1.必须声明前台服务类型</h4> 
<blockquote> 
 <p>为了帮助开发者更有目的地定义面向用户的前台服务，Android 10 在 元素内引入了 android:foregroundServiceType 属性。如果您的应用以 Android 14（API 级别 34）或更高版本为目标平台，则必须为应用中的每项前台服务指定至少一个前台服务类型。您应该选择一个能够代表应用用例的前台服务类型。系统需要特定类型的前台服务满足特定用例。</p> 
</blockquote> 
<p>Android 14 中新增了 <code>health</code>, <code>remoteMessaging</code>, <code>shortService</code>, <code>specialUse</code> 和 <code>systemExempted</code> 类型，加上之前的还有<code>camera</code>, <code>connectedDevice</code>, <code>dataSync</code>, <code>location</code>, <code>mediaPlayback</code>, <code>mediaProjection</code>, <code>microphone</code>, <code>phoneCall</code>类型。</p> 
<p>以下代码段提供了一个清单中的前台服务类型声明示例：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifest</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>
  ...
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.FOREGROUND_SERVICE<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.FOREGROUND_SERVICE_MEDIA_PLAYBACK<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.FOREGROUND_SERVICE_LOCATION<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>application</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span>
          <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.MyMediaPlaybackService<span class="token punctuation">"</span></span>
          <span class="token attr-name"><span class="token namespace">android:</span>foregroundServiceType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>location|mediaPlayback<span class="token punctuation">"</span></span>
          <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>service</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>application</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifest</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>如果以 Android 14 为目标平台的应用未在清单中定义给定服务的类型，系统会在调用 <code>startForeground()</code> 时引发 <code>MissingForegroundServiceTypeException</code>。如果应用中的用例与这些类型均不相关，强烈建议您迁移逻辑以使用 <code>WorkManager</code> 或<a href="https://developer.android.google.cn/about/versions/14/changes/user-initiated-data-transfers?hl=zh-cn" rel="nofollow">用户发起的数据传输作业</a>。</p> 
<p>然后上面的代码中，你会发现多了一个<code>FOREGROUND_SERVICE_MEDIA_PLAYBACK</code>权限，因为Android14上<strong>必须声明</strong>所选前台服务类型所对应的权限，比如<code>mediaPlayback</code>就对应<code>FOREGROUND_SERVICE_MEDIA_PLAYBACK</code>。所有这些权限都定义为一般权限，并默认授予，且用户无法撤消这些权限。</p> 
<p>如果没有声明适当的前台服务类型权限，系统会抛出 <code>SecurityException</code>。</p> 
<p>也可以在启动前台服务时声明类型，此时所声明的类型应是<code>AndroidManifest</code>中类型的子集：</p> 
<pre><code class="prism language-java"><span class="token class-name">ServiceCompat</span><span class="token punctuation">.</span><span class="token function">startForeground</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> notification<span class="token punctuation">,</span> notification<span class="token punctuation">,</span> <span class="token constant">FOREGROUND_SERVICE_TYPE_MEDIA_PLAYBACK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>如果调用中未指定前台服务类型，则该类型默认为清单中定义的值。如果您未在清单中指定服务类型，系统会抛出 <code>MissingForegroundServiceTypeException</code>。</p> 
<p>同时注意系统会检查前台服务类型的使用是否恰当，并确认应用是否已请求适当的运行时权限或使用所需的 API。例如，系统希望使用前台服务类型 <code>FOREGROUND_SERVICE_TYPE_LOCATION</code> 的应用请求 <code>ACCESS_COARSE_LOCATION</code> 或 <code>ACCESS_FINE_LOCATION</code>。其他类型规则见<a href="https://developer.android.google.cn/about/versions/14/changes/fgs-types-required?hl=zh-cn#use-cases" rel="nofollow">每种前台服务类型的预期用例和强制执行</a>。</p> 
<h4><a id="2BLUETOOTH_CONNECT_108"></a>2.BLUETOOTH_CONNECT</h4> 
<p>在 <code>BluetoothAdapter</code> 中强制执行 <code>BLUETOOTH_CONNECT</code> 权限，对于以 Android 14（API 级别 34）或更高版本为目标平台的应用，Android 14 会在调用 <code>BluetoothAdapter getProfileConnectionState() </code>方法时强制执行 <code>BLUETOOTH_CONNECT</code> 权限。</p> 
<p>此方法已需要 <code>BLUETOOTH_CONNECT</code> 权限，但未被强制执行。请确保您的应用在应用的 <code>AndroidManifest.xml</code> 文件中声明 <code>BLUETOOTH_CONNECT</code>，并在调用 <code>getProfileConnectionState</code> 之前检查用户是否已授予权限。</p> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.BLUETOOTH_CONNECT"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="3OpenJDK_17__118"></a>3.OpenJDK 17 更新</h4> 
<p>Android 14 将继续更新 Android 的核心库，以与最新 OpenJDK LTS 版本中的功能保持一致，包括适合应用和平台开发者的库更新和 Java 17 语言支持。</p> 
<p>以下变更可能会影响应用兼容性：</p> 
<ul><li>对正则表达式的更改：现在，为了更严格地遵循 OpenJDK 的语义，不允许无效的组引用。您可能会看到 <code>java.util.regex.Matcher</code> 类抛出 <code>IllegalArgumentException</code> 的新情况，因此请务<strong>必测试应用中使用正则表达式的情形</strong>。如需在测试期间启用或停用此变更，请使用兼容性框架工具切换 <code>DISALLOW_INVALID_GROUP_REFERENCE</code> 标志。</li><li>UUID 处理：现在，验证输入参数时，<code>java.util.UUID.fromString()</code> 方法会执行更严格的检查，因此您可能会在反序列化期间看到 <code>IllegalArgumentException</code>。如需在测试期间启用或停用此变更，请使用兼容性框架工具切换 <code>ENABLE_STRICT_VALIDATION</code> 标志。</li><li>ProGuard 问题：有时，在您尝试使用 ProGuard 缩减、混淆和优化应用时，添加 <code>java.lang.ClassValue</code> 类会导致问题。问题源自 Kotlin 库，该库会根据 <code>Class.forName("java.lang.ClassValue")</code>是否会返回类更改运行时行为。如果您的应用是根据没有 <code>java.lang.ClassValue</code> 类的旧版运行时开发的，则这些优化可能会将<code>computeValue</code> 方法从派生自 <code>java.lang.ClassValue</code> 的类中移除。</li></ul> 
<h4><a id="4_Intent_PendingIntent__128"></a>4.对隐式 Intent 和PendingIntent 的限制</h4> 
<p>对于以 Android 14（API 级别 34）或更高版本为目标平台的应用，隐式Intent或PendingIntent只能打开设置了<code>android:exported="true"</code>的组件，如果<code>android:exported="false"</code>，系统会抛出异常。</p> 
<p>例如，下面是可以在应用的清单文件中声明的 intent 过滤器：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.AppActivity<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.action.APP_ACTION<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.category.DEFAULT<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>如果应用尝试使用隐式 intent 启动此 activity，则系统会抛出异常：</p> 
<pre><code class="prism language-java">context<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token string">"com.example.action.APP_ACTION"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>如需启动非导出的 activity，应用应改用显式 intent：</p> 
<pre><code class="prism language-java"><span class="token class-name">Intent</span> explicitIntent <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token string">"com.example.action.APP_ACTION"</span><span class="token punctuation">)</span>
explicitIntent<span class="token punctuation">.</span><span class="token function">setPackage</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">startActivity</span><span class="token punctuation">(</span>explicitIntent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="5_157"></a>5.动态注册的广播接收器必须指定导出行为</h4> 
<p>以 Android 14（API 级别 34）或更高版本为目标平台并使用上下文注册的接收器的应用和服务必须指定一个标志，以指明接收器是否应导出到设备上的所有其他应用：分别为 <code>RECEIVER_EXPORTED</code> 或 <code>RECEIVER_NOT_EXPORTED</code>。</p> 
<p>这点去年的Android 13中就有相关介绍，当时不是强制适配，到Android 14开始就必须要适配了。如果不适配，会有如下崩溃信息：</p> 
<pre><code class="prism language-java"><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>SecurityException</span><span class="token operator">:</span> xxx<span class="token punctuation">.</span>xxx<span class="token operator">:</span> <span class="token class-name">One</span> of <span class="token constant">RECEIVER_EXPORTED</span> or <span class="token constant">RECEIVER_NOT_EXPORTED</span> should be specified when a receiver isn't being registered exclusively <span class="token keyword">for</span> system broadcasts
</code></pre> 
<p>适配方法：</p> 
<pre><code class="prism language-java"><span class="token comment">// 接收来自其他应用程序的广播</span>
context<span class="token punctuation">.</span><span class="token function">registerReceiver</span><span class="token punctuation">(</span>sharedBroadcastReceiver<span class="token punctuation">,</span> intentFilter<span class="token punctuation">,</span> <span class="token class-name">ContextCompat</span><span class="token punctuation">.</span><span class="token constant">RECEIVER_EXPORTED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 私有广播接收器</span>
context<span class="token punctuation">.</span><span class="token function">registerReceiver</span><span class="token punctuation">(</span>privateBroadcastReceiver<span class="token punctuation">,</span> intentFilter<span class="token punctuation">,</span> <span class="token class-name">ContextCompat</span><span class="token punctuation">.</span><span class="token constant">RECEIVER_NOT_EXPORTED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>如果应用利用<code>Context#registerReceiver</code>方法注册了一个系统广播接收器，那么不需要声明以上标志。如果你使用的是<code>LocalBroadcastManager</code>，那么也可以忽略此条变更。</p> 
<h4><a id="6_activity__178"></a>6.后台启动 activity 限制</h4> 
<p>对于以 Android 14（API 级别 34）或更高版本为目标平台的应用，在<strong>原有的基础上</strong>增加了两条限制：</p> 
<ul><li>当应用使用 <code>PendingIntent#send()</code> 或类似方法发送 <code>PendingIntent</code> 时，，其相关的参数<code>ActivityOptions</code>应该设置<code>setPendingIntentBackgroundActivityStartMode(MODE_BACKGROUND_ACTIVITY_START_ALLOWED)</code>。</li></ul> 
<pre><code class="prism language-java"><span class="token comment">// A app创建pendingIntent</span>
<span class="token class-name">PendingIntent</span> pendingIntent <span class="token operator">=</span> <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token function">getActivity</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        notificationIntent<span class="token punctuation">,</span>
        <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token constant">FLAG_MUTABLE</span><span class="token punctuation">,</span>
        <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//通过将pendingIntent发送到B app</span>
<span class="token comment">//B app收到创建的pendingcontent，然后执行send()方法发送，同时构建ActivityOptions，</span>
<span class="token comment">//设置相应的模式</span>
<span class="token class-name">PendingIntent</span> pendingIntent <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getParcelableExtra</span><span class="token punctuation">(</span><span class="token string">"pending"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ActivityOptions</span> options <span class="token operator">=</span> <span class="token class-name">ActivityOptions</span><span class="token punctuation">.</span><span class="token function">makeBasic</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">setPendingIntentBackgroundActivityStartMode</span><span class="token punctuation">(</span><span class="token class-name">ActivityOptions</span><span class="token punctuation">.</span><span class="token constant">MODE_BACKGROUND_ACTIVITY_START_ALLOWED</span><span class="token punctuation">)</span>
 <span class="token punctuation">.</span><span class="token function">setPendingIntentCreatorBackgroundActivityStartMode</span><span class="token punctuation">(</span><span class="token class-name">ActivityOptions</span><span class="token punctuation">.</span><span class="token constant">MODE_BACKGROUND_ACTIVITY_START_ALLOWED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pendingIntent<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span><span class="token function">toBundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre> 
<ul><li>当一个可见应用程序使用<code>bindService()</code>方法绑定另一个后台应用程序的服务时，如果想要授予绑定的后台服务所在应用启动Activity，必须要在绑定服务的时候，即调用<code>bindService()</code>方法的时候包含<code>BIND_ALLOW_ACTIVITY_STARTS</code>。</li></ul> 
<pre><code class="prism language-java">targetSdk＜<span class="token number">34</span>，前台应用绑定后台服务启动<span class="token class-name">Activity</span>需要<span class="token class-name">BIND_AUTO_CREATE</span>
<span class="token function">bindService</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> coon<span class="token punctuation">,</span> <span class="token constant">BIND_AUTO_CREATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
targetSdk≥<span class="token number">34</span>，前台应用绑定后台服务要启动<span class="token class-name">Activity</span>，需要在之前的基础上添加<span class="token constant">BIND_ALLOW_ACTIVITY_STARTS</span>标志。
<span class="token function">bindService</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> coon<span class="token punctuation">,</span> <span class="token class-name">BindServiceFlags</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token constant">BIND_ALLOW_ACTIVITY_STARTS</span><span class="token operator">|</span><span class="token constant">BIND_AUTO_CREATE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="7_210"></a>7.压缩路径遍历</h4> 
<p>对于以 Android 14（API 级别 34）或更高版本为目标平台的应用，Android 会通过以下方式防止 Zip 路径遍历漏洞：如果 zip 文件条目名称包含<code>..</code>或以<code>/</code>开头，则 <code>ZipInputStream.getNextEntry()</code> 和<code>ZipFile(String)</code>会抛出<code>ZipException</code>。</p> 
<p>应用可以通过调用 <code>dalvik.system.ZipPathValidator.clearCallback()</code> 选择停用此验证。</p> 
<h4><a id="8_216"></a>8.获得照片和视频的部分访问权限</h4> 
<p>上面已经说明了相关情况，这里就不赘述了，下面直接说如何适配。</p> 
<p>首先Android 13的基础上添加新权限：</p> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token keyword">uses</span><span class="token operator">-</span>permission android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"android.permission.READ_MEDIA_VISUAL_USER_SELECTED"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> 
<p>请求权限时，根据版本区分请求的权限，Android 14上需要同时请求<code>READ_MEDIA_IMAGES</code>，<code>READ_MEDIA_VISUAL_USER_SELECTED</code>，如果你需要视频，那就再加上<code>READ_MEDIA_VIDEO</code>。</p> 
<pre><code class="prism language-kotlin"><span class="token keyword">private</span> <span class="token keyword">val</span> permissionLauncher <span class="token operator">=</span>
    <span class="token function">registerForActivityResult</span><span class="token punctuation">(</span>ActivityResultContracts<span class="token punctuation">.</span><span class="token function">RequestMultiplePermissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> _ <span class="token operator">-&gt;</span>
        <span class="token comment">// 处理权限请求结果</span>
    <span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">requestPermissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>UPSIDE_DOWN_CAKE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        permissionLauncher<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>
            <span class="token function">arrayOf</span><span class="token punctuation">(</span>READ_MEDIA_IMAGES<span class="token punctuation">,</span>
                READ_MEDIA_VIDEO<span class="token punctuation">,</span>
                READ_MEDIA_VISUAL_USER_SELECTED<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">==</span> Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>TIRAMISU<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        permissionLauncher<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token function">arrayOf</span><span class="token punctuation">(</span>READ_MEDIA_IMAGES<span class="token punctuation">,</span> READ_MEDIA_VIDEO<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        permissionLauncher<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token function">arrayOf</span><span class="token punctuation">(</span>READ_EXTERNAL_STORAGE<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>授权结果检查判断：</p> 
<pre><code class="prism language-kotlin"><span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">checkPermissionResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>TIRAMISU
        <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>ContextCompat<span class="token punctuation">.</span><span class="token function">checkSelfPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> READ_MEDIA_IMAGES<span class="token punctuation">)</span> <span class="token operator">==</span> PERMISSION_GRANTED
                <span class="token operator">||</span> ContextCompat<span class="token punctuation">.</span><span class="token function">checkSelfPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> READ_MEDIA_VIDEO<span class="token punctuation">)</span> <span class="token operator">==</span> PERMISSION_GRANTED<span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Android 13及以上完整照片和视频访问权限</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>
        Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>UPSIDE_DOWN_CAKE <span class="token operator">&amp;&amp;</span>
        ContextCompat<span class="token punctuation">.</span><span class="token function">checkSelfPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> READ_MEDIA_VISUAL_USER_SELECTED<span class="token punctuation">)</span> <span class="token operator">==</span> PERMISSION_GRANTED
    <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Android 14及以上部分照片和视频访问权限</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ContextCompat<span class="token punctuation">.</span><span class="token function">checkSelfPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> READ_EXTERNAL_STORAGE<span class="token punctuation">)</span> <span class="token operator">==</span> PERMISSION_GRANTED<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Android 12及以下完整本地读写访问权限</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 无本地读写访问权限</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果<code>READ_MEDIA_IMAGES</code>和<code>READ_MEDIA_VIDEO</code>权限都有了，那就获取了所有的照片视频的访问权限，就和之前版本的交互一样。</p> 
<p>如果只有<code>READ_MEDIA_VISUAL_USER_SELECTED</code>权限，说明用户之前指定看可见范围。那么可以添加一个入口让用户修改可见的照片和视频范围，具体可以参考下面的交互流程。<br> <img src="https://images2.imgbox.com/07/50/0q7qqjY4_o.png" alt="在这里插入图片描述"><br> 点击按钮可以重新请求权限，让用户修改可见范围。</p> 
<hr> 
<p>其他还有安全的全屏 intent 通知，每个 <code>MediaProjection</code> 拍摄会话均需要征得用户同意等行为变更，因为我涉及不多，这里就不说了，有需要可以直接看文末的官方文档。</p> 
<h3><a id="API_276"></a>其他新功能及API</h3> 
<h4><a id="1_200_278"></a>1.非线性字体放大至 200%</h4> 
<p>从 Android 14 开始，系统支持字体放大高达 200%，为弱视用户提供了符合网络内容无障碍指南 (WCAG) 的其他无障碍选项。</p> 
<p>为防止屏幕上的大文本元素放大过大，系统会采用非线性放大曲线。这种放大策略意味着大号文本的放大比例不会与较小的文本相同。非线性字体缩放有助于保持不同大小元素之间的比例层次结构，同时缓解高级别线性文本缩放的问题（例如文本被截断或文本因超大显示大小而难以阅读）。</p> 
<p>如果你的应用字体使用的dp为单位，那么不会受次影响，否则需要测试一下ui是否可以正常显示。但是需要注意一点，使用 <code>TypedValue.applyDimension()</code> 从 <code>sp</code> 单位转换为像素，并使用 <code>TypedValue.deriveDimension()</code> 将像素转换为 <code>sp</code>。这些方法会自动应用适当的非线性缩放曲线。</p> 
<p>避免使用 <code>Configuration.fontScale</code> 或 <code>DisplayMetrics.scaledDensity</code> 。由于字体缩放是非线性的，因此 <code>scaledDensity</code> 字段不再准确。<code>fontScale</code> 字段应仅用于提供信息，因为字体不再使用单个标量值进行缩放。</p> 
<p>比如我们常使用<code>scaledDensity</code>用作像素转sp：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">px2sp</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token keyword">float</span> pxValue<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">final</span> <span class="token keyword">float</span> fontScale <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>scaledDensity<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>pxValue <span class="token operator">/</span> fontScale <span class="token operator">+</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>修改为：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">px2sp</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token keyword">float</span> pxValue<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>Build</span><span class="token punctuation">.</span><span class="token constant">VERSION</span><span class="token punctuation">.</span><span class="token constant">SDK_INT</span> <span class="token operator">&gt;=</span> <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>Build</span><span class="token punctuation">.</span><span class="token constant">VERSION_CODES</span><span class="token punctuation">.</span><span class="token constant">UPSIDE_DOWN_CAKE</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">TypedValue</span><span class="token punctuation">.</span><span class="token function">deriveDimension</span><span class="token punctuation">(</span><span class="token class-name">TypedValue</span><span class="token punctuation">.</span><span class="token constant">COMPLEX_UNIT_SP</span><span class="token punctuation">,</span> pxValue<span class="token punctuation">,</span> context<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">final</span> <span class="token keyword">float</span> fontScale <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>scaledDensity<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>pxValue <span class="token operator">/</span> fontScale <span class="token operator">+</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>比如我同一设备调到最大字号时，计算了100px等于多少sp，两种方法结果如下：</p> 
<pre><code class="prism language-java">scaledDensity：<span class="token number">17</span>
deriveDimension：<span class="token number">21</span>
</code></pre> 
<p>可以看到就有误差了，如果是标准字号，结果如下：</p> 
<pre><code class="prism language-java">scaledDensity：<span class="token number">35</span>
deriveDimension：<span class="token number">34</span>
</code></pre> 
<p>差1是因为我们加了0.5f，实际浮点值都是34.72222。</p> 
<p>当然更推荐使用的core库（1.12.0版本以上）的<code>TypedValueCompat</code>类，里面有<code>pxToSp</code>等方法，里面已经帮我们做了以上适配。</p> 
<h4><a id="2APIhttpsdeveloperandroidcomaboutversions14featuresgrammaticalinflectionhlzhcnjava_322"></a>2.<a href="https://developer.android.com/about/versions/14/features/grammatical-inflection?hl=zh-cn#java" rel="nofollow">语法性别API</a></h4> 
<p>有 30 亿人在使用区分性别的语言，此类语言的语法类别（例如名词、动词、形容词和介词）会根据您交谈所涉及的人或物的性别而变化。传统上，许多区分性别的语言使用阳性语法性别作为默认或通用性别。</p> 
<p>以错误的语法性别来称呼用户，例如以阳性语法性别来称呼女性，可能会对她们的表现和态度产生负面影响。相比之下，界面语言如果能正确反映用户的语法性别，就可以提高用户互动度，并提供更个性化、更自然的用户体验。</p> 
<p>为帮助您针对区分性别的语言构建以用户为中心的界面，Android 14 引入了语法变化 API，让您无需重构应用便能添加对语法性别的支持。</p> 
<p>比如首选语法性别设为阴性，通过以下API指定：</p> 
<pre><code class="prism language-java"><span class="token class-name">GrammaticalInflectionManager</span> gIM <span class="token operator">=</span> mContext<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">GrammaticalInflectionManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
gIM<span class="token punctuation">.</span><span class="token function">setRequestedApplicationGrammaticalGender</span><span class="token punctuation">(</span><span class="token class-name">Configuration</span><span class="token punctuation">.</span><span class="token constant">GRAMMATICAL_GENDER_FEMININE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>string.xml</code>需要相应的配置，比如法语：</p> 
<ul><li>阴性：res/values-fr-feminine/strings.xml</li><li>阳性：res/values-fr-masculine/strings.xml</li><li>中性：res/values-fr-neuter/strings.xml</li><li>默认：res/values-fr/strings.xml</li></ul> 
<p>因为我做的是出海项目，所以我会特别注意这点。因为之前我们遇到过用户反馈的相关问题，所以针对不同性别显示不同的文案。</p> 
<h4><a id="3_345"></a>3.各应用语言偏好设定</h4> 
<p>去年在Android 13的新功能上就看到了这条，当时发现此功能被阉割了，所以没有过多的尝试。这次在我的手机上（Origin OS 4）发现了几款海外应用支持了此功能，没有被阉割了。</p> 
<p>位置位于应用信息页，有个语言入口：</p> 
<p><img src="https://images2.imgbox.com/d4/83/x10bkFwf_o.jpg" alt="请添加图片描述" width="360"></p> 
<p>Android 14 扩展了 Android 13中引入的按应用设定语言功能，并包含以下额外功能：</p> 
<ul><li> <p>自动生成应用的 <code>localeConfig</code>：从 Android Studio Giraffe Canary 7 和 <a href="https://developer.android.google.cn/build/releases/past-releases/agp-8-1-0-release-notes?hl=zh-cn" rel="nofollow">AGP 8.1.0-alpha07</a> 开始，您可以将应用配置为自动支持各应用语言偏好设定。Android Gradle 插件会根据您的项目资源生成 <code>LocaleConfig</code> 文件，并在最终清单文件中添加对该文件的引用，这样您就不再需要手动创建或更新该文件。AGP 使用应用模块的 res 文件夹中的资源以及任何库模块依赖项来确定要在 <code>LocaleConfig</code> 文件中添加的语言区域。</p> </li><li> <p>动态更新应用的 <code>localeConfig</code>：使用 <code>LocaleManager</code>方法中的 <code>setOverrideLocaleConfig()</code> 和 <code>getOverrideLocaleConfig()</code> 可以在设备的系统设置中动态更新应用的受支持语言列表。有了这种灵活性，您可以按区域自定义支持的语言列表、运行 A/B 实验，或者如果您的应用通过服务器端推送进行本地化，则可以提供更新后的语言区域列表。</p> </li><li> <p>输入法 (IME) 的应用语言可见性：IME 可以利用 <code>getApplicationLocales()</code> 方法查看当前应用的语言，并将 IME 语言与该语言进行匹配。</p> </li></ul> 
<p>详细使用方法参考：<a href="https://developer.android.google.cn/guide/topics/resources/app-languages?hl=zh-cn#api-implementation" rel="nofollow">按应用设定语言偏好</a>。说句题外话，这些新功能我发现一般谷歌自家的Gmail都支持的比较快，比如各应用语言偏好设定，预测性返回手势，应用启动画面等都可以在Gmail上体验。</p> 
<p>其他新功能我就不一一介绍了，有需要可以直接看文末的官方文档。</p> 
<hr> 
<p>整体来说，Android 14是在13的基础上做了更多的补充完善，适配上来说难度不大。</p> 
<h3><a id="_367"></a>参考</h3> 
<ul><li><a href="https://developer.android.google.cn/about/versions/14?hl=zh-cn" rel="nofollow">官方文档</a></li><li><a href="https://dev.mi.com/distribute/doc/details?pId=1718" rel="nofollow">小米 - Android14 应用适配指南</a></li><li><a href="https://mp.weixin.qq.com/s/qpbHBhmfwZcgq5CLdRj2rQ" rel="nofollow">Android 14新特性，选择性照片和视频访问授权</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/08d767c31d16004fe5382bdbb1d31d5b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【数据结构】--- 深入剖析二叉树（上篇）--- 初识树和二叉树</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a3dcbe694d1170da93d5864589741430/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">全方位了解 Meta Llama 3</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>