<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MySQL —— 约束 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/e011470c22a7d3e98df0117cedcea932/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="MySQL —— 约束">
  <meta property="og:description" content="MySQL —— 约束 引言not nulluniqueprimary key —— 主键auto_increment复合主键 foreign key —— 外键插入数据删除主表的数据 default 引言 在设计表的时候，有些列是必填项（如果用户不填，那这个数据就没有必要存进数据库），可能表的第一列就是编号需要能自动帮我们排序（这样可以减少用户的填写负担，也减少我们的工作量），又或者我们需要有些数据是不能重复填写的（例如身份证号，每一个人都是独一无二的）等等… 这些需求其实都可以实现，现在我们来学习数据库是如何实现约束的。
not null 表示某一列是不能存储 null 值的，也就是这一列是必填项：
格式：在你定义表的时候，在需要不为空的列旁边加上 not null 即可
我们查看表结构发现 Null 那一列的 id 对应的一行现实 No ，说明定义成功，现在我们插入一个 id 为 空的数据实验一下：
会发现不允许你插入 id 为空的数据。
unique 保证某列的每一行都有一个唯一值，即不可以在某列上出现重复的数据。
语法格式：在你定义表的时候，在需要的列旁边加上 unique 即可
我们来查看表结构：
我们发现 id 那一行的 Key 值被置为了 UNI ，说明 id 是唯一值，如果插入id 相同的数据，数据库会报错：
null 是可以重复的，不受 unique 约束
primary key —— 主键 primary key（也被我们称为主键） 是 not null 和 unique 的结合（即主键约束的列即是非空的也是唯一的），能确保某列(或者两列及以上的列的组合) 有唯一的标识。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-07T18:50:17+08:00">
    <meta property="article:modified_time" content="2024-08-07T18:50:17+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MySQL —— 约束</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>MySQL —— 约束</h4> 
 <ul><li><a href="#_1" rel="nofollow">引言</a></li><li><a href="#not_null_4" rel="nofollow">not null</a></li><li><a href="#unique_17" rel="nofollow">unique</a></li><li><a href="#primary_key___35" rel="nofollow">primary key —— 主键</a></li><li><ul><li><a href="#auto_increment_54" rel="nofollow">auto_increment</a></li><li><a href="#_100" rel="nofollow">复合主键</a></li></ul> 
  </li><li><a href="#foreign_key___130" rel="nofollow">foreign key —— 外键</a></li><li><ul><li><a href="#_160" rel="nofollow">插入数据</a></li><li><a href="#_168" rel="nofollow">删除主表的数据</a></li></ul> 
  </li><li><a href="#default_183" rel="nofollow">default</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>引言</h2> 
<p>在设计表的时候，有些列是必填项（如果用户不填，那这个数据就没有必要存进数据库），可能表的第一列就是编号需要能自动帮我们排序（这样可以减少用户的填写负担，也减少我们的工作量），又或者我们需要有些数据是不能重复填写的（例如身份证号，每一个人都是独一无二的）等等… 这些需求其实都可以实现，现在我们来学习数据库是如何实现约束的。</p> 
<h2><a id="not_null_4"></a>not null</h2> 
<p><strong>表示某一列是不能存储 null 值的</strong>，也就是这一列是必填项：</p> 
<p><strong>格式：在你定义表的时候，在需要不为空的列旁边加上 not null 即可</strong></p> 
<p><img src="https://images2.imgbox.com/f2/8c/UnixaQML_o.png" alt="在这里插入图片描述"></p> 
<p>我们查看表结构发现 Null 那一列的 id 对应的一行现实 No ，说明定义成功，现在我们插入一个 id 为 空的数据实验一下：</p> 
<p><img src="https://images2.imgbox.com/0c/7d/6Eh4qppG_o.png" alt="在这里插入图片描述"></p> 
<p>会发现不允许你插入 id 为空的数据。</p> 
<h2><a id="unique_17"></a>unique</h2> 
<p>保证某列的每一行都有一个唯一值，即<strong>不可以在某列上出现重复的数据</strong>。</p> 
<p>语法格式：<strong>在你定义表的时候，在需要的列旁边加上 unique 即可</strong></p> 
<p><img src="https://images2.imgbox.com/5d/f7/KtPW0QJw_o.png" alt="在这里插入图片描述"></p> 
<p>我们来查看表结构：</p> 
<p><img src="https://images2.imgbox.com/9b/eb/9pfxSt7u_o.png" alt="在这里插入图片描述"><br> 我们发现 id 那一行的 Key 值被置为了 UNI ，说明 id 是唯一值，如果插入id 相同的数据，数据库会报错：</p> 
<p><img src="https://images2.imgbox.com/4b/fc/rufXi4K9_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<blockquote> 
 <p><strong>null 是可以重复的，不受 unique 约束</strong></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/f9/98/u0uRqSwc_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="primary_key___35"></a>primary key —— 主键</h2> 
<p><strong>primary key（也被我们称为主键） 是 not null 和 unique 的结合（即主键约束的列即是非空的也是唯一的）</strong>，能确保某列(或者两列及以上的列的组合) 有唯一的标识。</p> 
<p>我们可以使用 not null + unique （没有顺序之分）来创建主键：</p> 
<p><img src="https://images2.imgbox.com/cc/32/1ZEQbciY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b2/4a/SSR3ir9F_o.png" alt="在这里插入图片描述"></p> 
<p><strong>Key 显示 PRI 就是主键的意思</strong>。</p> 
<hr> 
<p>当然这里可以直接使用关键字 primary key 来定义主键 ：</p> 
<p><img src="https://images2.imgbox.com/d5/05/IiyJryzI_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p><strong>主键约束帮我们对非空和唯一值进行了校验</strong>，对于这个性能消耗来说，我们还是能接受的。</p> 
</blockquote> 
<hr> 
<h3><a id="auto_increment_54"></a>auto_increment</h3> 
<blockquote> 
 <p>对于<strong>整数类型的主键</strong>，常配搭自增长<strong>auto_increment</strong>来使用。<strong>插入数据对应字段不给值时，数据库使用最大值+1 对其进行赋值</strong></p> 
</blockquote> 
<p>语法格式就是<strong>在主键后面加 auto_increment</strong></p> 
<p><img src="https://images2.imgbox.com/b0/80/BrqR35NY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/19/0f/SI3mk9N1_o.png" alt="在这里插入图片描述"></p> 
<p>我们查看表结构可以看到 Extra 这个扩展列表里出现了 auto_increment ，说明 id 这一列数据会自增，其实可以类比我们的excel 表格，现在给大家演示自增的现象：</p> 
<p><img src="https://images2.imgbox.com/cd/b7/anxao6qx_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<blockquote> 
 <p><strong>数据库会帮我们维护主键的增长，在插入的时候，找到目前的最大值，然后在这个基础上 +1 即可。</strong></p> 
</blockquote> 
<p>我们在插入一个id 定义为 100 的数据，然后再插入只有姓名的数据，看看现象：</p> 
<p><img src="https://images2.imgbox.com/c4/96/entoz1Be_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/f6/18/oGyPkP86_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p><strong>这里说明了主键可以是不连续的</strong></p> 
</blockquote> 
<hr> 
<p>现在我们清空 test 表中的所有数据，如果我们第一个插入的数据的 id 值为 null ，数据库其实也能帮我们插入进去：</p> 
<p><img src="https://images2.imgbox.com/35/e9/FzBcmubb_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8d/89/Hb5APVFb_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>empty set 表示空集。</p> 
</blockquote> 
<p><strong>这个 id 生成的数值是上次 id 的最大值加 1 。</strong></p> 
<hr> 
<p>现在我们来定义一个新的表，来试一下 第一个插入的数据的 id 值为 null：</p> 
<p><img src="https://images2.imgbox.com/1c/0f/HZINxQSX_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3e/84/0wWiTKpC_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/dc/a5/cRZ8KczE_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/03/e8/zXRGir80_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p><strong>如果是全新的表，插入第一个数据的主键值为 null,会自动赋值为 1</strong><br> <strong>如果后序还是插入主键值为 null 的数据，数据库会为其赋值为最大值加 1</strong></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/23/7e/SgcsRbdF_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_100"></a>复合主键</h3> 
<blockquote> 
 <p>注意<strong>一个表中只能存在一个主键</strong></p> 
</blockquote> 
<blockquote> 
 <p>但是<strong>一个主键可以同时包含很多个列，这就是复合主键</strong></p> 
</blockquote> 
<blockquote> 
 <p>如何定义符合主键？<br> 在创建表的时候，加上 primary key (列名,列名…)</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/ff/0c/4yLwXbe3_o.png" alt="在这里插入图片描述"></p> 
<p>通过查看表结构可以看到两个列被主键管理着：</p> 
<p><img src="https://images2.imgbox.com/fb/fc/477fhpI9_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<blockquote> 
 <p><strong>复合主键在做非空校验的时候，所有被主键管理的列都不能被定义为空，但是在做唯一性检验的时候，只有当所有被主键管理的列的数值都相同时，才不会被允许插入。</strong></p> 
</blockquote> 
<p>演示一下:</p> 
<p>现在插入两个数据：<br> <img src="https://images2.imgbox.com/a2/dd/ooTmJFpD_o.png" alt="在这里插入图片描述"></p> 
<p>再插入主键值相同的张三数据：<br> <img src="https://images2.imgbox.com/9e/ac/YxLtv0CO_o.png" alt="在这里插入图片描述"><br> 发现插入不了，因为 1, 张三 被主键唯一值校验发现，无法插入</p> 
<p>但是你可以插入，主键值不完全相同的张三数据：<br> <img src="https://images2.imgbox.com/b5/08/Pv6THRsf_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="foreign_key___130"></a>foreign key —— 外键</h2> 
<p><strong>外键用于关联其他表的主键或唯一键</strong></p> 
<p>举个例子：<br> <img src="https://images2.imgbox.com/ec/7e/vokU69Do_o.png" alt="在这里插入图片描述"></p> 
<p>设置外键的语法格式：<code>foreign key (字段名) references 主表(列)</code></p> 
<blockquote> 
 <p>foreign key 是外键的关键字，字段名是表实当前表中哪个字段要与主表建立主外键关系，references 关键字，表实后面要引用哪个表中的哪个列。</p> 
</blockquote> 
<p>演示：</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> class <span class="token punctuation">(</span>
	id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">comment</span> <span class="token string">'班级'</span><span class="token punctuation">,</span>
	num <span class="token keyword">int</span> <span class="token keyword">comment</span> <span class="token string">'人数'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> student <span class="token punctuation">(</span>
  	id <span class="token keyword">bigint</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">comment</span> <span class="token string">'学号'</span><span class="token punctuation">,</span>
  	name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">comment</span> <span class="token string">'姓名'</span><span class="token punctuation">,</span>
	class_id <span class="token keyword">int</span> <span class="token keyword">comment</span> <span class="token string">'班级'</span><span class="token punctuation">,</span>
	<span class="token keyword">foreign</span> <span class="token keyword">key</span> <span class="token punctuation">(</span>class_id<span class="token punctuation">)</span> <span class="token keyword">references</span> class<span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p><strong>注意被关联的表要先创建好，然后才能创建与其构建主外键关系的表</strong></p> 
</blockquote> 
<blockquote> 
 <p><strong>外键一定是关联另一张表的主键的</strong></p> 
</blockquote> 
<h3><a id="_160"></a>插入数据</h3> 
<p><img src="https://images2.imgbox.com/52/cc/iudb1mlh_o.png" alt="在这里插入图片描述"></p> 
<p>我们往 student 表中 插入 一个不存在的班级编号的数据：<br> <img src="https://images2.imgbox.com/a1/e6/6kGQw5hF_o.png" alt="在这里插入图片描述"><br> 发现这是不能插入的</p> 
<blockquote> 
 <p><strong>通过外键的约束，可以保证数据的完整性和关系的确定性。</strong></p> 
</blockquote> 
<h3><a id="_168"></a>删除主表的数据</h3> 
<p><img src="https://images2.imgbox.com/af/04/bDOKT7ms_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3a/08/6zN6kse6_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>首先先确定 class 是主表，因为它是被关联的，student 是 子表</p> 
</blockquote> 
<blockquote> 
 <p><strong>当子表存在对主表依赖的数据的时候，不能删除主表对应的数据</strong><br> <img src="https://images2.imgbox.com/6c/35/2rzOCeYB_o.png" alt="在这里插入图片描述"><br> 因为 231 与子表存在关联，所以主表的 231 数据不能被删除</p> 
 <p><strong>但是可以删除没有关联关系的数据</strong>：<br> <img src="https://images2.imgbox.com/ea/fb/CvSG8Fqz_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<blockquote> 
 <p>如果一定要删除主表的存在关联关系的数据的时候，那么子表就不能存在有数据行对其有依赖，所以先删除子表的数据行解除关联关系，再去删除主表的数据：<br> <img src="https://images2.imgbox.com/6b/87/xFQOfDus_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h2><a id="default_183"></a>default</h2> 
<p><strong>给没有赋值的列 赋默认值。</strong></p> 
<p>语法格式：<strong>在你定义表的时候，在指定的列旁边加上 （default + 默认值） 即可</strong></p> 
<p><img src="https://images2.imgbox.com/16/ff/9HCQVXe5_o.png" alt="在这里插入图片描述"></p> 
<p>查看表结构发现 Default 列表对应的 name 出现了 默认值为 无名氏，也就是当你没有填姓名的时候默认值会默认为 无名氏。</p> 
<p><img src="https://images2.imgbox.com/b7/ef/ukOJKqDZ_o.png" alt="在这里插入图片描述"></p> 
<p>演示一下：</p> 
<p>如果你有设置name 这个数值，那就不会赋默认值</p> 
<p><img src="https://images2.imgbox.com/a2/ef/HSct34gr_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p>如果你没有设置name 这个数值，就会赋默认值——无名氏：</p> 
<p><img src="https://images2.imgbox.com/b3/c0/b1GP2cRV_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/53ff93ac7acb621b2c1c3e7ce76c6e07/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Maven 核心配置有哪些</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0c0f742df88f23a0ac79f4b2f55e9a0a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">学习日志8.7--Security Zone防火墙安全区域</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>