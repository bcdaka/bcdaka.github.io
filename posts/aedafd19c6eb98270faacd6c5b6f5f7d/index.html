<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Hadoop高可靠集群搭建步骤（手把手教学）【超级详细】 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/aedafd19c6eb98270faacd6c5b6f5f7d/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Hadoop高可靠集群搭建步骤（手把手教学）【超级详细】">
  <meta property="og:description" content="Hadoop高可靠集群搭建步骤（手把手教学）
【超级详细】
文章目录 1 HA集群基础配置1.1 创建系统为Centos7（Linux）的虚拟机1.2 基本网络配置1.3 连接FinalShell 2 NTP时间同步和免密登录2.1 NTP时间同步2.2 集群免密登录 3 JDK的安装与配置4 Zookeeper的安装与配置5 高可靠的Hadoop集群的安装与配置【核心】6.功能验证注意创作不易，关注一波呗 1 HA集群基础配置 基于VMware Workstation 17 Pro 1.1 创建系统为Centos7（Linux）的虚拟机 一、用管理员身份运行虚拟机
二、创建新的虚拟机：
选择自定义→选择硬件兼容性:Workstation 15.x→选择稍后安装→选Linux(L)（选CentOS 7 64位）→编辑虚拟机名字并选择文件位置→处理器数量和内核数量均选1→选择虚拟机内存(若运行内存是8G，则选择1G，若16G则选择2G，以此类推)→选择网络NAT模式(NAT模式就是电脑能上网虚拟机就能上网)→控制器类型选择推荐→磁盘类型也选择推荐→选择创建新虚拟磁盘→最大磁盘大小选择10G，并选择将虚拟磁盘存储为单个文件(若电脑为256或512G的就选择10G，1t的可选择20G)→在自定义硬件中可以把打印机和声卡移除
三、安装系统：
点击CD/DVD，选择使用ISO映像文件，找到已下载好的光盘iso文件CentOS-7-x86_64-Minimal-1908.iso
图 3-1虚拟机创建
四、开启虚拟机，选择第一个安装虚拟机(即直接按回车)
五、文字选英文版→选系统选→点击Done→安装的同时可设置密码
1.2 基本网络配置 一、修改主机名
1、配置hostname文件：
vi /etc/hostname
输入master
2、配置network文件：
vi /etc/sysconfig/network
输入NETWORKING=yes
HOSTNAME=master
（修改名字后要reboot重启虚拟机）
二、NET网络设置
首先以管理员身份进入，在页面左上角寻找“编辑”，点击进入后选择“虚拟网络编辑器”，点击“添加网络”，选择”VMnet8”，将”仅主机模式”改为“NAT模式”，
1、子网设置：
子网IP：192.168.222.0 #子网的最后一位一定是0
子网掩码：255.255.255.0
2、DHCP设置：
起始IP地址：192.168.222.128
结束IP地址：192.168.222.254
图 3-4 DHCP设置
3、NAT设置：
网关IP:192.168.222.2
图 3-5 NAT设置
以上三步做完点击“应用”，再点击“确定”
三、虚拟机网络配置
1、配置ifcfg-ens33文件：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-19T00:53:10+08:00">
    <meta property="article:modified_time" content="2024-04-19T00:53:10+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Hadoop高可靠集群搭建步骤（手把手教学）【超级详细】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>Hadoop高可靠集群搭建步骤（手把手教学）<br> 【超级详细】<br> </p> 
 <div class="toc"> 
  <h4>文章目录</h4> 
  <ul><li><a href="#1_HA_6" rel="nofollow">1 HA集群基础配置</a></li><li><ul><li><a href="#11_Centos7Linux_12" rel="nofollow">1.1 创建系统为Centos7（Linux）的虚拟机</a></li><li><a href="#12__25" rel="nofollow">1.2 基本网络配置</a></li><li><a href="#13_FinalShell_89" rel="nofollow">1.3 连接FinalShell</a></li></ul> 
   </li><li><a href="#2_NTP_109" rel="nofollow">2 NTP时间同步和免密登录</a></li><li><ul><li><a href="#21_NTP_110" rel="nofollow">2.1 NTP时间同步</a></li><li><a href="#22__127" rel="nofollow">2.2 集群免密登录</a></li></ul> 
   </li><li><a href="#3_JDK_168" rel="nofollow">3 JDK的安装与配置</a></li><li><a href="#4_Zookeeper_194" rel="nofollow">4 Zookeeper的安装与配置</a></li><li><a href="#5_Hadoop_255" rel="nofollow">5 高可靠的Hadoop集群的安装与配置【核心】</a></li><li><a href="#6_542" rel="nofollow">6.功能验证</a></li><li><ul><li><a href="#_563" rel="nofollow">注意</a></li><li><ul><li><a href="#_566" rel="nofollow">创作不易，关注一波呗</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </div> 
 <p></p> 
</blockquote> 
<hr> 
<h2><a id="1_HA_6"></a>1 HA集群基础配置</h2> 
<pre><code>	基于VMware Workstation 17 Pro
</code></pre> 
<hr> 
<h3><a id="11_Centos7Linux_12"></a>1.1 创建系统为Centos7（Linux）的虚拟机</h3> 
<p>一、用管理员身份运行虚拟机<br> 二、创建新的虚拟机：<br> 选择自定义→选择硬件兼容性:Workstation 15.x→选择稍后安装→选Linux(L)（选CentOS 7 64位）→编辑虚拟机名字并选择文件位置→处理器数量和内核数量均选1→选择虚拟机内存(若运行内存是8G，则选择1G，若16G则选择2G，以此类推)→选择网络NAT模式(NAT模式就是电脑能上网虚拟机就能上网)→控制器类型选择推荐→磁盘类型也选择推荐→选择创建新虚拟磁盘→最大磁盘大小选择10G，并选择将虚拟磁盘存储为单个文件(若电脑为256或512G的就选择10G，1t的可选择20G)→在自定义硬件中可以把打印机和声卡移除<br> 三、安装系统：<br> 点击CD/DVD，选择使用ISO映像文件，找到已下载好的光盘iso文件CentOS-7-x86_64-Minimal-1908.iso<br> <img src="https://images2.imgbox.com/de/10/oawMwIdD_o.png" alt="在这里插入图片描述"></p> 
<p>图 3-1虚拟机创建<br> 四、开启虚拟机，选择第一个安装虚拟机(即直接按回车)<br> 五、文字选英文版→选系统选→点击Done→安装的同时可设置密码<br> <img src="https://images2.imgbox.com/32/14/H51e1JAq_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="12__25"></a>1.2 基本网络配置</h3> 
<p>一、修改主机名<br> 1、配置hostname文件：<br> vi /etc/hostname<br> 输入master<br> 2、配置network文件：<br> vi /etc/sysconfig/network<br> 输入NETWORKING=yes<br> HOSTNAME=master<br> （修改名字后要reboot重启虚拟机）<br> 二、NET网络设置<br> 首先以管理员身份进入，在页面左上角寻找“编辑”，点击进入后选择“虚拟网络编辑器”，点击“添加网络”，选择”VMnet8”，将”仅主机模式”改为“NAT模式”，<br> <img src="https://images2.imgbox.com/d4/11/UtXkU2PJ_o.png" alt="在这里插入图片描述"></p> 
<p>1、子网设置：<br> 子网IP：192.168.222.0 #子网的最后一位一定是0<br> 子网掩码：255.255.255.0<br> 2、DHCP设置：<br> 起始IP地址：192.168.222.128<br> 结束IP地址：192.168.222.254<br> <img src="https://images2.imgbox.com/e9/f2/DxMKZ74D_o.png" alt="在这里插入图片描述"></p> 
<p>图 3-4 DHCP设置<br> 3、NAT设置：<br> 网关IP:192.168.222.2<br> <img src="https://images2.imgbox.com/26/8b/2ZIT2bvU_o.png" alt="在这里插入图片描述"></p> 
<p>图 3-5 NAT设置<br> 以上三步做完点击“应用”，再点击“确定”<br> 三、虚拟机网络配置<br> 1、配置ifcfg-ens33文件：<br> vi /etc/sysconfig/network-scripts/ifcfg-ens33</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span>dhcp   改为BOOTPROTO<span class="token operator">=</span>static  <span class="token comment">#静态的意思</span>
<span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span>no        改为ONBOOT<span class="token operator">=</span>yes 
</code></pre> 
<p>再添加5条记录</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.222.171 <span class="token comment">#IPADDR 互联网协议地址GATEWAY=192.168.222.2  #GATEWAY 网关</span>
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0  <span class="token comment">#NETWORK子网掩码</span>
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">192.168</span>.222.2     <span class="token comment">#DNS1域名解析服务器1</span>
<span class="token assign-left variable">DNS2</span><span class="token operator">=</span><span class="token number">8.8</span>.8.8           <span class="token comment">#DNS2 域名解析服务器2</span>
</code></pre> 
<p>2、网络服务重启并关闭防火墙：<br> service network restart<br> systemctl stop firewalld<br> <img src="https://images2.imgbox.com/25/5e/ayi82Axp_o.png" alt="在这里插入图片描述"></p> 
<p>四、克隆四台虚拟机：虚拟机–管理–克隆–选完整克隆<br> <img src="https://images2.imgbox.com/6e/e9/MPBZIiqn_o.png" alt="在这里插入图片描述"></p> 
<p>图 3-7虚拟机克隆界面<br> 五、修改克隆的虚拟机IP、机器名、网络名:</p> 
<pre><code class="prism language-bash"><span class="token function">vi</span> /etc/hostname
<span class="token function">vi</span> /etc/sysconfig/network
<span class="token function">vi</span> /etc/sysconfig/network-scripts/ifcfg-ens33
</code></pre> 
<h3><a id="13_FinalShell_89"></a>1.3 连接FinalShell</h3> 
<p>打开finalshell，页面左上角有一个文件夹图标，点击之后在弹出的页面上再点击左上角的文件夹图标，然后点击新建一个连接，点击“SSH连接”（免密安全登录）</p> 
<p><img src="https://images2.imgbox.com/36/6b/vEnxcK92_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c3/b5/z749Jyl7_o.png" alt="在这里插入图片描述"></p> 
<p>将ip 地址和名字做连接<br> vi /etc/hosts键入：</p> 
<pre><code class="prism language-bash"><span class="token number">192.168</span>.222.171 master master.root
<span class="token number">192.168</span>.222.172 slave1 slave1.root
<span class="token number">192.168</span>.222.173 slave2 slave2.root
<span class="token number">192.168</span>.222.174 masterback masterbak.root
</code></pre> 
<p><img src="https://images2.imgbox.com/de/a7/MkFwMmMo_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2_NTP_109"></a>2 NTP时间同步和免密登录</h2> 
<h3><a id="21_NTP_110"></a>2.1 NTP时间同步</h3> 
<p>安装NTP软件，并以master为时间服务器做时间同步<br> 一、安装NTP：yum install -y ntp<br> 二、修改ntp配置文件：<br> vi /etc/ntp.conf<br> 末尾追加：server 127.127.1.0<br> Fudge 127.127.1.0 stratum 10<br> <img src="https://images2.imgbox.com/81/93/U0yNisLR_o.png" alt="在这里插入图片描述"></p> 
<p>图 3-11配置conf文件<br> 三、重启时间服务<br> /bin/systemctl restart ntpd.service<br> 可以在slave1、slave2、slave3、masterbak上去更新时间（以master为标准进行时间的校对）：<br> ntpdate master 结果：如下图<br> 代码如下（示例）：<br> <img src="https://images2.imgbox.com/32/07/GdOnQp61_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="22__127"></a>2.2 集群免密登录</h3> 
<p>操作发现两个服务器之间通信（例如传数据）需要密码才可以。<br> 当集群运行起来后，频繁交换数据，每次输入密码是不可能的。不输入密码如何保证安全呢？那就是进行加密<br> 明文—加密—密文—解密—明文<br> 具体实现步骤如下：<br> 一、四台机器上生成公钥-密钥</p> 
<pre><code class="prism language-bash">ssh-keygen <span class="token parameter variable">-t</span> dsa（以master为例）
</code></pre> 
<p><img src="https://images2.imgbox.com/74/a0/ycwk7UPg_o.png" alt="图 3-13 master公钥密钥包"></p> 
<p>二、传递公钥（以slave1为例）<br> 1.进入slave1中的 .ssh 文件夹：cd/root/.ssh<br> 2.将slave1的公钥传递到master中<br> scp id_dsa.pub root@master:/root/.ssh/s1.pub<br> <img src="https://images2.imgbox.com/b1/13/rWboY8mE_o.png" alt="在这里插入图片描述"><br> 三、slave2，slave3和masterbak操作同上<br> 四、在master中将五个公钥合并成一个公钥包<br> 1.先切换到/root/.ssh目录下面：<br> cd /root/.ssh<br> 2.将五个公钥合并成一个公钥包：<br> cat id_dsa.pub s1.pub s2.pub s3.pub mb.pub &gt;&gt; authorized_keys<br> 五、将master中合成的公钥包分发至集群内其他机器：</p> 
<pre><code class="prism language-bash"><span class="token function">scp</span> authorized_keys root@slave1:/root/.ssh
<span class="token function">scp</span> authorized_keys root@slave2:/root/.ssh
<span class="token function">scp</span> authorized_keys root@slave3:/root/.ssh
<span class="token function">scp</span> authorized_keys root@masterbak:/root/.ssh
</code></pre> 
<p><img src="https://images2.imgbox.com/0c/ee/1xOz45yH_o.png" alt="在这里插入图片描述"></p> 
<p>六、验证<br> <img src="https://images2.imgbox.com/5e/d8/cpLEDC43_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="3_JDK_168"></a>3 JDK的安装与配置</h2> 
<p>一、创建/opt/soft 文件夹：<br> mkdir -p /opt/soft<br> 二、切换到这个目录下面:<br> cd /opt/soft<br> 三、点击页面上的上传按钮，将JDK文件（jdk-8u171-linux-x64.tar.gz）上传到该目录下面<br> 四、创建一个目录用来安装jdk<br> mkdir -p /usr/java<br> 五、将JDK安装到特定的目录下:<br> tar -zxvf jdk-8u171-linux-x64.tar.gz -C /usr/java<br> 六、修改环境变量<br> vi /etc/profile</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/java/jdk1.8.0_171
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span>.:<span class="token variable">$JAVA_HOME</span>/lib
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin
</code></pre> 
<p>七、让环境变量生效：source /etc/profile<br> 八、测试JDk安装配置成功：<br> 1、java -version<br> <img src="https://images2.imgbox.com/2f/78/pOpwKXti_o.png" alt="在这里插入图片描述"></p> 
<p>九、分发至集群内其他机器</p> 
<h2><a id="4_Zookeeper_194"></a>4 Zookeeper的安装与配置</h2> 
<p>一、切换到这个目录下面（master机器中）:<br> cd /opt/soft<br> 二、点击上传按钮，将zookeeper文件（zookeeper-3.4.10.tar.gz）上传到soft文件夹内部<br> 三、创建一个目录用来安装zookeeper：<br> mkdir -p /usr/zookeeper<br> 四、安装zookeeper</p> 
<pre><code class="prism language-bash"><span class="token function">tar</span>  <span class="token parameter variable">-zxvf</span>   zookeeper-3.4.10.tar.gz  <span class="token parameter variable">-C</span>  /usr/zookeeper
</code></pre> 
<p>五、配置zookeeper<br> （1）配置zoo.cfg<br> /usr/zookeeper/zookeeper-3.4.10/conf下的zoo_sample.cfg 复制一份为zoo.cfg<br> 进入该目录下，cp zoo_sample.cfg zoo.cfg<br> vi zoo.cfg<br> 编辑添加：</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">dataDir</span><span class="token operator">=</span>/usr/zookeeper/zookeeper-3.4.10/zkdata
<span class="token assign-left variable">dataLogDir</span><span class="token operator">=</span>/usr/zookeeper/zookeeper-3.4.10/zkdatalog <span class="token assign-left variable">server.1</span><span class="token operator">=</span><span class="token number">192.168</span>.222.171:2888:3888
<span class="token assign-left variable">server.2</span><span class="token operator">=</span><span class="token number">192.168</span>.222.172:2888:3888
<span class="token assign-left variable">server.3</span><span class="token operator">=</span><span class="token number">192.168</span>.222.173:2888:3888
<span class="token assign-left variable">server.4</span><span class="token operator">=</span><span class="token number">192.168</span>.222.174:2888:3888
</code></pre> 
<p><img src="https://images2.imgbox.com/66/f4/4rN1jXhi_o.png" alt="图 3-18 zoo.cfg文件配置"></p> 
<p>（2）创建zoo.cfg里配置的目录：<br> mkdir zkdata/mkdir zkdatalog<br> 在 zkdata中：vi myid 并编辑内容为1</p> 
<p><img src="https://images2.imgbox.com/f8/f3/xQDgphlb_o.png" alt="图 3-19 Zookeeper相关目录配置"></p> 
<p>六、对另外四台机器进行分发</p> 
<pre><code class="prism language-bash"><span class="token function">scp</span> <span class="token parameter variable">-r</span> /usr/zookeeper root@slave1:/usr
<span class="token function">scp</span> <span class="token parameter variable">-r</span> /usr/zookeeper root@slave2:/usr
<span class="token function">scp</span> <span class="token parameter variable">-r</span> /usr/zookeeper root@slave3:/usr
<span class="token function">scp</span> <span class="token parameter variable">-r</span> /usr/zookeeper root@masterbak:/usr
</code></pre> 
<p>七、修改slave1，slave2,slave3和masterbak的myid，分别为 2，3,4和5（注意：这里的数字2、3、4、5要与zoo.cfg中的server.数字 一一对应）<br> 八、配置环境变量：<br> vi /etc/profile<br> 添加:</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">ZOOKEEPER_HOME</span><span class="token operator">=</span>/usr/zookeeper/zookeeper-3.4.10/
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$ZOOKEEPER_HOME</span>
</code></pre> 
<p>使环境变量生效：source /etc/profile<br> 九、分发至集群内其他机器<br> 十、启动四台虚拟机的zookeeper服务：<br> bin/zkServer.sh start<br> 查看四台虚拟机的zookeeper状态（以master为例）：<br> bin/zkServer.sh status<br> <img src="https://images2.imgbox.com/fb/82/HAwnyzWX_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="5_Hadoop_255"></a>5 高可靠的Hadoop集群的安装与配置【核心】</h2> 
<p>一、在master上创建：<br> mkdir -p /usr/hadoop<br> 二、解压安装：<br> cd /opt/soft上传已下好的hadoop-2.7.3<br> tar -zxvf hadoop-2.7.3.tar.gz -C /usr/hadoop<br> 三、在五台机器上配置环境变量：<br> vi /etc/profile</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span>/usr/hadoop/hadoop-2.7.3
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span><span class="token variable">$CLASSPATH</span><span class="token builtin class-name">:</span><span class="token variable">$HADOOP_HOME</span>/lib
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$HADOOP_HOME</span>/bin
</code></pre> 
<p>让环境变量生效：source /etc/profile</p> 
<p><img src="https://images2.imgbox.com/4f/7b/rx8iNFfk_o.png" alt="图 3-21 环境配置"></p> 
<p>四、在master中cd /usr/hadoop/hadoop-2.7.3/etc/hadoop进入到hadoop配置文件</p> 
<p><img src="https://images2.imgbox.com/b7/ef/4Dpu6f96_o.png" alt="图 3-22 Hadoop配置文件"></p> 
<p>1、vi hadoop-env.sh修改java的安装目录：<br> export JAVA_HOME=/usr/java/jdk1.8.0_171<br> 2、vi yarn-env.sh修改java的安装目录：<br> export JAVA_HOME=/usr/java/jdk1.8.0_171<br> 3、配置vi core-site.xml,放在，中间）</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 指定hdfs的nameservice为cluster --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.defaultFS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hdfs://cluster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 指定zookeeper地址--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>        
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>ha.zookeeper.quorum<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>192.168.222.171:2181,192.168.222.172:2181,192.168.222.173:2181,192.168.222.174:2181,192.168.222.175:2181<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>ha.zookeeper.session-timeout.ms<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>60000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
 <span class="token comment">&lt;!-- 故障检查时间 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>ha.failover-controller.cli-check.rpc-timeout.ms<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>60000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- ipc通讯超时时间 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>ipc.client.connect.timeout<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>20000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 指定hadoop临时目录 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hadoop.tmp.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>file:/usr/hadoop/tmp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>4、配置vi mapred-site.xml<br> cp mapred-site.xml.template mapred-site.xml<br> vi mapred-site.xml</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.framework.name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>yarn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>5、配置vi hdfs-site.xml<br> vi hdfs-site.xml</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
   <span class="token comment">&lt;!--指定hdfs的nameservice为cluster，需要和core-site.xml中的保持一致 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.nameservices<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>cluster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- cluster下面有两个NameNode，分别是nn1，nn2 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.ha.namenodes.cluster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>nn1,nn2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- nn1、nn2的RPC通信地址 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.namenode.rpc-address.cluster.nn1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>192.168.222.171:8020<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.namenode.rpc-address.cluster.nn2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>192.168.222.175:8020<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- nn1、nn2的http通信地址 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.namenode.http-address.cluster.nn1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>192.168.222.171:50070<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.namenode.http-address.cluster.nn2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>192.168.222.175:50070<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.namenode.servicerpc-address.cluster.nn1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>192.168.222.171:53310<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 指定NameNode的元数据在JournalNode上的存放位置 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.namenode.shared.edits.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>qjournal://192.168.222.172:8485;192.168.222.173:8485;192.168.222.174:8485/cluster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 指定JournalNode在本地磁盘存放数据的位置 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.journalnode.edits.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/usr/hadoop/hdfs/journal/data<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 开启NameNode失败自动切换 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.ha.automatic-failover.enabled<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 配置失败自动切换实现方式 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.client.failover.proxy.provider.cluster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 配置隔离机制方法，多个机制用换行分割，即每个机制暂用一行 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.ha.fencing.methods<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>
            sshfence
            shell(/bin/true)
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.ha.fencing.ssh.connect-timeout<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>30000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.webhdfs.enabled<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.permissions.enable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.image.transfer.bandwidthPerSec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>1048576<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.replication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.namenode.name.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>file:/usr/hadoop/hdfs/name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.datanode.name.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>file:/usr/hadoop/hdfs/data<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.namenode.checkpoint.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>file:/usr/hadoop/hdfs/namesecondary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>6、配置 vi yarn-site.xml</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.aux-services<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>mapreduce_shuffle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.resourcemanager.hostname<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>192.168.222.171<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>7、配置slaves<br> vi slaves<br> 删去localhost<br> 输入<br> 192.168.222.172<br> 192.168.222.173<br> 192.168.222.174</p> 
<p>五、将配置好的hadoop分发到其他服务器上：</p> 
<pre><code class="prism language-xml">scp -r /usr/hadoop root@slave1:/usr
scp -r /usr/hadoop root@slave2:/usr
scp -r /usr/hadoop root@slave3:/usr
scp -r /usr/hadoop root@masterbak:/usr
</code></pre> 
<p>六、在四台机器上启动zookeeper：</p> 
<pre><code class="prism language-xml">cd $ZOOKEEPER_HOME
bin/zkServer.sh start
</code></pre> 
<p>七、启动journalNode集群（在slave1，slave2,slave3）</p> 
<pre><code class="prism language-xml">$HADOOP_HOME/sbin/hadoop-daemons.sh start journalnode
</code></pre> 
<p>图 3-23 启动journalNode集群<br> 八、格式化HDFS（namenode）第一次要格式化<br> （在master,masterbak中任意一台，我选择master）</p> 
<pre><code class="prism language-xml">hdfs namenode –format
</code></pre> 
<p>九、在master上格式化zkfc,使zookeeper中生成HA节点：</p> 
<pre><code class="prism language-xml">bin/hdfs zkfc -formatZK
</code></pre> 
<p>在master上格式化hdfs<br> 格式成功后，查看zookeeper中可以看到<br> [zk: localhost:2181(CONNECTED) 1] ls /hadoop-ha<br> [cluster]<br> 十、启动zkfc来监控NN状态（在master,masterbak）</p> 
<pre><code class="prism language-xml">sbin/hadoop-daemon.sh start zkfc
</code></pre> 
<p>十一、启动HDFS（namenode）（在master即可）</p> 
<pre><code class="prism language-xml">sbin/start-dfs.sh
</code></pre> 
<p>十二、把NameNode的数据同步到masterbak上（在masterbak上执行）</p> 
<pre><code class="prism language-xml">hdfs namenode –bootstrapStandby
</code></pre> 
<p>十三、启动masterbak上的namenode作为standby</p> 
<pre><code class="prism language-xml">sbin/hadoop-daemon.sh start namenode
</code></pre> 
<p>十四、启动YARN<br> 在master上执行如下命令</p> 
<pre><code class="prism language-xml">sbin/start-yarn.sh 
</code></pre> 
<p>启动YARN（MR）（在192.168.222.171即可）</p> 
<p>图 3-24启动Hadoop集群<br> 在五台机器上jps查看进程，如下图。</p> 
<p><img src="https://images2.imgbox.com/6c/10/APRgpyBE_o.png" alt="图 3-28 master-jps"></p> 
<p><img src="https://images2.imgbox.com/f2/76/I1Hv1MBE_o.png" alt="图 3-29 slave1-jps"></p> 
<p><img src="https://images2.imgbox.com/4b/a2/SqKW8s5x_o.png" alt="图 3-30 slave2-jps"></p> 
<p><img src="https://images2.imgbox.com/7d/67/hPlKoXFx_o.png" alt="图 3-31 slave3-jps"></p> 
<p><img src="https://images2.imgbox.com/e6/a3/LtTadnfT_o.png" alt="图 3-31 masterbak-jps"></p> 
<h2><a id="6_542"></a>6.功能验证</h2> 
<p>在浏览器上：http://192.168.222.171:50070。<br> <img src="https://images2.imgbox.com/45/c6/opk6jXNU_o.png" alt="在这里插入图片描述"></p> 
<p>在浏览器上：http://192.168.222.175:50070。</p> 
<p><img src="https://images2.imgbox.com/77/0d/PakDECec_o.png" alt="在这里插入图片描述"></p> 
<p>此时master节点处于standby状态，masterback节点处于active状态，当主节点namenode失效时，备用节点会自动替代上去，因此我们模拟主节点失灵，在masterbak上关闭namenode再去查看master的namenode状态。<br> 执行命令： sbin/hadoop-daemon.sh stop namenode</p> 
<p><img src="https://images2.imgbox.com/26/22/wRji9OfW_o.png" alt="图 4-5 停止 master的namenode"></p> 
<p><img src="https://images2.imgbox.com/f2/18/Hd9D6ER2_o.png" alt="图4-6查看停止后的master的namenode状态"></p> 
<p>因为masterbak关闭了namenode,所以会拒绝连接而无法查看状态。</p> 
<p><img src="https://images2.imgbox.com/3f/08/E5pU19Hj_o.png" alt="图4-7查看停止后的masterbak的页面"></p> 
<h3><a id="_563"></a>注意</h3> 
<p>保证master和masterbak均有name文件，没有的话通过scp传输过去</p> 
<h4><a id="_566"></a>创作不易，关注一波呗</h4>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/289c518714dea89d49128ae28cca9a94/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">《大众点评爬虫程序实战：爬取店铺评论信息》</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8aa487b5cd97aeaca79997e3f313ca78/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Kotlin 与 Java有什么区别（最全最新的）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>