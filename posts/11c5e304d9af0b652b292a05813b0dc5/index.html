<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【机器学习】决策树（实战） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/11c5e304d9af0b652b292a05813b0dc5/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【机器学习】决策树（实战）">
  <meta property="og:description" content="决策树（实战） 目录 一、准备工作（设置 jupyter notebook 中的字体大小样式等）二、树模型的可视化展示1、通过鸢尾花数据集构建一个决策树模型2、对决策树进行可视化展示的具体步骤3、概率估计 三、决策边界展示四、决策树的正则化（预剪枝）五、实验：探究树模型对数据的敏感程度六、实验：用决策树解决回归问题七、实验：探究决策树的深度对其拟合能力的影响 实战部分将结合着 理论部分 进行，旨在帮助理解和强化实操（以下代码将基于 jupyter notebook 进行）。
一、准备工作（设置 jupyter notebook 中的字体大小样式等） import numpy as np import os %matplotlib inline import matplotlib import matplotlib.pyplot as plt plt.rcParams[&#39;axes.labelsize&#39;] = 14 plt.rcParams[&#39;xtick.labelsize&#39;] = 12 plt.rcParams[&#39;ytick.labelsize&#39;] = 12 import warnings warnings.filterwarnings(&#39;ignore&#39;) 二、树模型的可视化展示 决策树不仅在理论上很容易理解（机器学习“最友好”的算法），实现时还能对构建过程进行可视化（诸如神经网络等算法本身就是黑盒模型，更难可视化展示模型的构建）。因此，决策树的另一大优势就是能利用相关包来查看构建的树模型。下面介绍一个可以对决策树进行可视化展示的包：
下载链接：Graphviz 。
注：为了能在 cmd 中调用指令，在安装时需配置环境变量（下载exe文件，在安装过程中勾选 Add PATH）。
1、通过鸢尾花数据集构建一个决策树模型 # 导入鸢尾花数据集 和 决策树的相关包 from sklearn.datasets import load_iris from sklearn.tree import DecisionTreeClassifier # 加载鸢尾花数据集 iris = load_iris() # 选用鸢尾花数据集的特征 # 尾花数据集的 4 个特征分别为：sepal length:、sepal width、petal length:、petal width # 下面选用 petal length、petal width 作为实验用的特征 X= iris.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-04-11T19:52:37+08:00">
    <meta property="article:modified_time" content="2023-04-11T19:52:37+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【机器学习】决策树（实战）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3 align="center">决策树（实战）</h3> 
<br> 
<br> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><ul><li><a href="#_jupyter_notebook__17" rel="nofollow">一、准备工作（设置 jupyter notebook 中的字体大小样式等）</a></li><li><a href="#_38" rel="nofollow">二、树模型的可视化展示</a></li><li><ul><li><a href="#1_50" rel="nofollow">1、通过鸢尾花数据集构建一个决策树模型</a></li><li><a href="#2_79" rel="nofollow">2、对决策树进行可视化展示的具体步骤</a></li><li><a href="#3_125" rel="nofollow">3、概率估计</a></li></ul> 
   </li><li><a href="#_177" rel="nofollow">三、决策边界展示</a></li><li><a href="#_267" rel="nofollow">四、决策树的正则化（预剪枝）</a></li><li><a href="#_319" rel="nofollow">五、实验：探究树模型对数据的敏感程度</a></li><li><a href="#_374" rel="nofollow">六、实验：用决策树解决回归问题</a></li><li><a href="#_420" rel="nofollow">七、实验：探究决策树的深度对其拟合能力的影响</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p>实战部分将结合着 <a href="https://serein.blog.csdn.net/article/details/129290733" rel="nofollow">理论部分</a> 进行，旨在帮助理解和强化实操（以下代码将基于 jupyter notebook 进行）。</p> 
<br> 
<hr> 
<br> 
<h3><a id="_jupyter_notebook__17"></a>一、准备工作（设置 jupyter notebook 中的字体大小样式等）</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> os
<span class="token operator">%</span>matplotlib inline
<span class="token keyword">import</span> matplotlib
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.labelsize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">14</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'xtick.labelsize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'ytick.labelsize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">12</span>
<span class="token keyword">import</span> warnings
warnings<span class="token punctuation">.</span>filterwarnings<span class="token punctuation">(</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<hr> 
<br> 
<h3><a id="_38"></a>二、树模型的可视化展示</h3> 
<br> 
<p>决策树不仅在理论上很容易理解（机器学习“最友好”的算法），实现时还能对构建过程进行可视化（诸如神经网络等算法本身就是黑盒模型，更难可视化展示模型的构建）。因此，决策树的另一大优势就是能利用相关包来查看构建的树模型。下面介绍一个可以对决策树进行可视化展示的包：</p> 
<p>下载链接：<a href="https://graphviz.org/" rel="nofollow">Graphviz</a> 。</p> 
<p>注：为了能在 cmd 中调用指令，在安装时需配置环境变量（下载exe文件，在安装过程中勾选 Add PATH）。</p> 
<br> 
<h4><a id="1_50"></a>1、通过鸢尾花数据集构建一个决策树模型</h4> 
<pre><code class="prism language-python"><span class="token comment"># 导入鸢尾花数据集 和 决策树的相关包</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier

<span class="token comment"># 加载鸢尾花数据集</span>
iris <span class="token operator">=</span> load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 选用鸢尾花数据集的特征</span>
<span class="token comment"># 尾花数据集的 4 个特征分别为：sepal length:、sepal width、petal length:、petal width</span>
<span class="token comment"># 下面选用 petal length、petal width 作为实验用的特征</span>
X<span class="token operator">=</span> iris<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

<span class="token comment"># 取出标签</span>
y <span class="token operator">=</span> iris<span class="token punctuation">.</span>target

<span class="token comment"># 设置决策树的最大深度为 2（也可以限制其他属性）</span>
tree_clf <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>max_depth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment"># 训练分类器</span>
tree_clf<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/52/bc/O2eYAB73_o.png" alt="在这里插入图片描述" height="70"></p> 
<br> 
<h4><a id="2_79"></a>2、对决策树进行可视化展示的具体步骤</h4> 
<pre><code class="prism language-python"><span class="token comment"># 导入对决策树进行可视化展示的相关包</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> export_graphviz

export_graphviz<span class="token punctuation">(</span>
    <span class="token comment"># 传入构建好的决策树模型</span>
    tree_clf<span class="token punctuation">,</span>
    
    <span class="token comment"># 设置输出文件（需要设置为 .dot 文件，之后再转换为 jpg 或 png 文件）</span>
    out_file<span class="token operator">=</span><span class="token string">"iris_tree.dot"</span><span class="token punctuation">,</span>
    
    <span class="token comment"># 设置特征的名称</span>
    feature_names<span class="token operator">=</span>iris<span class="token punctuation">.</span>feature_names<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    
    <span class="token comment"># 设置不同分类的名称（标签）</span>
    class_names<span class="token operator">=</span>iris<span class="token punctuation">.</span>target_names<span class="token punctuation">,</span>
    
    rounded <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
    filled <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token punctuation">)</span>

<span class="token comment"># 该代码执行完毕后，此 .ipython 文件存放路径下将生成一个 .dot 文件（名字由 out_file 设置，此处我设置的文件名为 iris_tree.dot）</span>
</code></pre> 
<blockquote> 
 <p>接下来可以打开 cmd 用 graphviz 包中的 dot 命令将 .dot 文件转换为各种格式，如 .png 或 .jpg。命令为：<br> $ dot -T[图片格式，如 ‘jpg’] [目标dot文件,如 ‘iris_tree.dot’] -o [转换后的文件名，如 ‘iris_tree.jpg’]<br> 例如：dot -Tjpg iris_tree.dot -o iris_tree.jpg</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/b8/46/GOOXAJB5_o.png" alt="dot 命令格式" height="500"></p> 
<blockquote> 
 <p>输入指令，点击回车后，若未出现任何反应（如上图所示），则代表执行成功！打开 iris_tree.dot 文件存放的目录会看到里面生成了一张图片文件：iris_tree.jpg。点击查看，如下：</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/b4/c0/4497C3qp_o.jpg" alt="iris_tree" height="300"></p> 
<br> 
<p><strong>图像解读</strong></p> 
<ul><li>上图中，根节点第一行数据是划分特征，可见根节点采用“花瓣长度”这个特征作为划分特征，判断条件是“花瓣宽度是否不大于 2.45”；</li><li>根节点第二行数据是基尼系数，可见根节点的基尼系数为 0.667；</li><li>根节点第三行数据是当前数据集的分类情况，可见在初始情况下，共有 3 类花（每类各 50 个）；</li><li>根节点第四行数据表示在当前结点下，数据集被归类至哪一类。</li></ul> 
<br> 
<h4><a id="3_125"></a>3、概率估计</h4> 
<p>估计类概率：假设输入数据为：花瓣长 5cm，宽 1.5cm。从上图可以看出，其应当被分类至 versicolor 花。若要查看其归类概率，则决策树的输出如下：</p> 
<ul><li>iris-Setosa 为 0% （0/54）;</li><li>iris-Versicolor 为 90.7% (49/54);</li><li>iris-Virginica 为 9.3% (5/54)。</li></ul> 
<p>下面我们调用函数来查看各概率值：</p> 
<pre><code class="prism language-python"><span class="token comment"># 调用函数查看概率估计</span>
tree_clf<span class="token punctuation">.</span>predict_proba<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1.5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>Out
	array([[0.        , 0.90740741, 0.09259259]])
</code></pre> 
<p>可以看出，通过函数计算出的估计值和我们计算出的结果基本一致。</p> 
<br> 
<pre><code class="prism language-python"><span class="token comment"># 调用函数查看预测结果</span>
tree_clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">1.5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>Out
	array([1])
</code></pre> 
<p>由于三类花及其索引分别为：</p> 
<p>0 —— iris-Setosa;<br> 1 —— iris-Versicolor;<br> 2 —— iris-Virginica。</p> 
<p>因此输出结果为：array([1])。</p> 
<br> 
<hr> 
<br> 
<h3><a id="_177"></a>三、决策边界展示</h3> 
<br> 
<p>定义绘制决策边界的函数：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> matplotlib<span class="token punctuation">.</span>colors <span class="token keyword">import</span> ListedColormap

<span class="token comment"># 定义绘制决策边界的函数</span>
<span class="token keyword">def</span> <span class="token function">plot_decision_boundary</span><span class="token punctuation">(</span>clf<span class="token punctuation">,</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> axes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> iris<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>legend<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>plot_training<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    <span class="token comment"># 构建坐标棋盘</span>
    <span class="token comment"># 等距选 100 个居于 axes[0],axes[1] 之间的点</span>
    x1s <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token comment"># x1s.shape = (100,)</span>
    
    <span class="token comment"># 等距选 100 个居于 axes[2],axes[3] 之间的点</span>
    x2s <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace <span class="token punctuation">(</span>axes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>axes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
    <span class="token comment"># x2s.shape = (100,)</span>
    
    <span class="token comment"># 构建棋盘数据</span>
    x1<span class="token punctuation">,</span>x2 <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>x1s<span class="token punctuation">,</span>x2s<span class="token punctuation">)</span>
    <span class="token comment"># x1.shape = x2.shape = (100,100)</span>
    
    <span class="token comment"># 将构建好的两个棋盘数据分别作为一个坐标轴上的数据（从而构成新的测试数据）</span>
    <span class="token comment"># x1.ravel() 将拉平数据（得到的是个列向量（矩阵）），此时 x1.shape = (10000,)</span>
    <span class="token comment"># 将 x1 和 x2 拉平后分别作为两条坐标轴</span>
    <span class="token comment"># 这里用到 numpy.c_() 函数，以将两个矩阵合并为一个矩阵</span>
    X_new <span class="token operator">=</span> np<span class="token punctuation">.</span>c_<span class="token punctuation">[</span>x1<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>x2<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token comment"># 此时 X_new.shape = (10000,2)</span>
    
    <span class="token comment"># 对构建好的新测试数据进行预测</span>
    y_pred <span class="token operator">=</span> clf<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_new<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>x1<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
    
    <span class="token comment"># 选用背景颜色</span>
    custom_cmap <span class="token operator">=</span> ListedColormap<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'#fafab0'</span><span class="token punctuation">,</span> <span class="token string">'#9898ff'</span><span class="token punctuation">,</span> <span class="token string">'#a0faa0'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 执行填充</span>
    plt<span class="token punctuation">.</span>contourf<span class="token punctuation">(</span>x1<span class="token punctuation">,</span>x2<span class="token punctuation">,</span>y_pred<span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span>cmap<span class="token operator">=</span>custom_cmap<span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> <span class="token keyword">not</span> iris<span class="token punctuation">:</span>
        custom_cmap2 <span class="token operator">=</span> ListedColormap<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'#7d7d58'</span><span class="token punctuation">,</span><span class="token string">'#4c4c7f'</span><span class="token punctuation">,</span><span class="token string">'#507d50'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>contour<span class="token punctuation">(</span>x1<span class="token punctuation">,</span>x2<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span>cmap<span class="token operator">=</span>custom_cmap2<span class="token punctuation">,</span>alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> plot_training<span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"yo"</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"Iris-Setosa"</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"bs"</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"Iris-Versicolor"</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"g^"</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">"Iris-Virginica"</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span>axes<span class="token punctuation">)</span>
    <span class="token keyword">if</span> iris<span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"Petal length"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"Petal width"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">r"$x_1$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>ylabel <span class="token punctuation">(</span><span class="token string">r"$x_2$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span>rotation <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> legend<span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">"lower right"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>

</code></pre> 
<p>绘制决策边界：</p> 
<pre><code class="prism language-python"><span class="token comment"># 绘制决策边界</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plot_decision_boundary<span class="token punctuation">(</span>tree_clf<span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">)</span>

<span class="token comment"># 为了便于理解，这里还绘制了决策边界的切割线（基于前面得到的图片）</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2.45</span><span class="token punctuation">,</span> <span class="token number">2.45</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"k-"</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2.45</span><span class="token punctuation">,</span> <span class="token number">7.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1.75</span><span class="token punctuation">,</span><span class="token number">1.75</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"k--"</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4.95</span><span class="token punctuation">,</span> <span class="token number">4.95</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1.75</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"k:"</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4.85</span><span class="token punctuation">,</span> <span class="token number">4.85</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1.75</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"k:"</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制决策边界划分出的类别所处深度</span>
plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token string">"Depth=1"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">3.2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"Depth=2"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">13</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">3.2</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token string">"Depth=2"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">13</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Decision Tree decision boundaries'</span><span class="token punctuation">)</span>
          
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/4d/c2/Vj2MtPjk_o.png" alt="在这里插入图片描述" height="300"></p> 
<br> 
<hr> 
<br> 
<h3><a id="_267"></a>四、决策树的正则化（预剪枝）</h3> 
<br> 
<p>DecisionTreeClassfilter 类中有以下限制决策树形状的参数（可用于做预剪枝操作）：</p> 
<ul><li>max_depth (决策树的最大深度)</li><li>min_samples_split (结点在分割之前必须具有的最小样本数)</li><li>min_samples_leaf (结点在分割之后其叶子结点必须具有的最小样本数)</li><li>max_leaf_nodes (叶子结点的最大数量)</li><li>max_features (在每个节点处评估用于拆分的最大特征数，通常情况下不限制这个参数)</li></ul> 
<p>接下来通过一个实验来测试 “限制 min_samples_leaf 属性” 对树模型的正则化效果（其他参数可照同样的方式进行测试，在此就不一一进行了）：</p> 
<pre><code class="prism language-python"><span class="token comment"># 这里选用一个难度稍微大一点的数据集</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> make_moons

<span class="token comment"># 构建数据集：X.shape = (100,2)  y.shape = (100,)</span>
X<span class="token punctuation">,</span>y <span class="token operator">=</span> make_moons<span class="token punctuation">(</span>n_samples <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> noise <span class="token operator">=</span> <span class="token number">0.25</span><span class="token punctuation">,</span> random_state <span class="token operator">=</span> <span class="token number">43</span><span class="token punctuation">)</span>

<span class="token comment"># 构建决策树</span>
tree_clf1 <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>random_state <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">)</span>
tree_clf2 <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>min_samples_leaf <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> random_state <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">)</span>
tree_clf1<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
tree_clf2<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y<span class="token punctuation">)</span>

<span class="token comment"># 画图展示：绘制决策边界</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span>
plot_decision_boundary<span class="token punctuation">(</span>tree_clf1<span class="token punctuation">,</span>X<span class="token punctuation">,</span>y<span class="token punctuation">,</span>axes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> iris <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'No Restrictions'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span>
plot_decision_boundary<span class="token punctuation">(</span>tree_clf2<span class="token punctuation">,</span>X<span class="token punctuation">,</span>y<span class="token punctuation">,</span>axes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> iris <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'min_samples_leaf = 5'</span><span class="token punctuation">)</span>
</code></pre> 
<p>其输出如下：</p> 
<p><img src="https://images2.imgbox.com/cf/30/Q8wkYewj_o.png" alt="在这里插入图片描述" height="300"></p> 
<p>从上图可以得出以下结论：</p> 
<ul><li>左图在构建决策树时无限制，因此它能将所有数据点都归类好（不会出现任何离群点），所以其得到的决策树模型会相当复杂；但是，它出现了严重的过拟合现象。</li><li>右图由于加了限制，使得其构建的决策树模型不会过于复杂（奥卡姆剃刀原则：越简单的越好），但其分类效果自然也不会有左图那么高。</li></ul> 
<br> 
<hr> 
<br> 
<h3><a id="_319"></a>五、实验：探究树模型对数据的敏感程度</h3> 
<br> 
<p>下面通过一个实验探究：当样本数据发生变动时，已构建好的模型是否依然稳定。</p> 
<pre><code class="prism language-python"><span class="token comment"># 构建随机测试数据</span>
np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
Xs <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span>
ys <span class="token operator">=</span><span class="token punctuation">(</span>Xs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span>

<span class="token comment"># 定义数据的旋转角度</span>
angle <span class="token operator">=</span> np<span class="token punctuation">.</span>pi<span class="token operator">/</span> <span class="token number">4</span>

<span class="token comment"># 旋转原始测试数据矩阵</span>
rotation_matrix <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span>np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>angle<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Xsr <span class="token operator">=</span> Xs<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>rotation_matrix<span class="token punctuation">)</span>

<span class="token comment"># 构建分类器 tree_clf_s 对原始数据进行训练</span>
tree_clf_s <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
tree_clf_s<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>Xs<span class="token punctuation">,</span>ys<span class="token punctuation">)</span>

<span class="token comment"># 构建分类器 tree_clf_sr 对处理后的数据进行训练</span>
tree_clf_sr <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
tree_clf_sr<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>Xsr<span class="token punctuation">,</span>ys<span class="token punctuation">)</span>

<span class="token comment"># 绘图展示这两个分类器的测试效果</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span>
plot_decision_boundary<span class="token punctuation">(</span>tree_clf_s<span class="token punctuation">,</span>Xs<span class="token punctuation">,</span>ys<span class="token punctuation">,</span>axes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.7</span><span class="token punctuation">,</span><span class="token number">0.7</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.7</span><span class="token punctuation">,</span><span class="token number">0.7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> iris<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Sensitivity to training set rotation'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span>
plot_decision_boundary<span class="token punctuation">(</span>tree_clf_sr<span class="token punctuation">,</span>Xsr<span class="token punctuation">,</span>ys<span class="token punctuation">,</span>axes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.7</span><span class="token punctuation">,</span><span class="token number">0.7</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.7</span><span class="token punctuation">,</span><span class="token number">0.7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>iris<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Sensitivity to training set rotation'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>其输出如下：</p> 
<p><img src="https://images2.imgbox.com/53/c3/IPsxMWdL_o.png" alt="在这里插入图片描述" height="300"></p> 
<p>上图左边展示了对某数据集进行切割后得到的决策边界。接下来，将该数据集中的数据 “旋转” 45°，按理来说，其决策边界也会 “旋转” 45°，但根据上图右边的结果可以看出，决策边界并没有跟着旋转，而是采取了右边所示的方式重新绘制。</p> 
<p>由此可见，决策树模型对数据非常敏感。</p> 
<br> 
<hr> 
<br> 
<h3><a id="_374"></a>六、实验：用决策树解决回归问题</h3> 
<br> 
<p>决策树在做分类或回归任务时，对应的数据集分别为离散型和连续性，因此这就导致其在评估时需要用不同的数学方法：<br> 分类任务多用熵或基尼系数（从计算速度的角度来看更常用基尼系数）；而回归任务则多用方差（方差是衡量一组数据之间相似程度的最简单的指标）。</p> 
<pre><code class="prism language-python"><span class="token comment"># 导入相关库函数</span>
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeRegressor

<span class="token comment"># 构造数据（一维数据）</span>
m <span class="token operator">=</span> <span class="token number">200</span>
X <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>rand<span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> <span class="token number">4</span><span class="token operator">*</span><span class="token punctuation">(</span>X<span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">10</span>

<span class="token comment"># 训练分类器</span>
tree_reg <span class="token operator">=</span> DecisionTreeRegressor<span class="token punctuation">(</span>max_depth <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
tree_reg<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/6b/c8/x0NZY2Kt_o.png" alt="在这里插入图片描述" height="70"></p> 
<pre><code class="prism language-python"><span class="token comment"># 树模型的展示</span>
export_graphviz<span class="token punctuation">(</span>
    tree_reg<span class="token punctuation">,</span>
    out_file<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"regression_tree.dot"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    feature_names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"x"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    rounded<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    filled<span class="token operator">=</span><span class="token boolean">True</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>接下来用 graphviz 包中的 dot 命令可得到以下决策树图片：</p> 
<p><img src="https://images2.imgbox.com/40/db/KOm0yJyC_o.jpg" alt="regression_tree" height="300"></p> 
<p>注：Sklearn中，默认生成的决策树为二叉树（CART）。</p> 
<br> 
<hr> 
<br> 
<h3><a id="_420"></a>七、实验：探究决策树的深度对其拟合能力的影响</h3> 
<br> 
<p>下面的实验将通过控制变量的方式，来探究两棵仅深度不同的决策树对样本数据的拟合能力差异。</p> 
<p>设置两棵仅深度不同的树：</p> 
<pre><code class="prism language-python"><span class="token comment"># 构建两棵深度不一致的决策树</span>
tree_reg1 <span class="token operator">=</span> DecisionTreeRegressor<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span>max_depth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
tree_reg2 <span class="token operator">=</span> DecisionTreeRegressor<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span>max_depth<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment"># 训练分类器</span>
tree_reg1<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
tree_reg2<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
</code></pre> 
<p>定义相关函数：</p> 
<pre><code class="prism language-python"><span class="token comment"># 定义预测回归值并绘制的函数</span>
<span class="token keyword">def</span> <span class="token function">plot_regression_predictions</span><span class="token punctuation">(</span>tree_reg<span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> axes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ylabel<span class="token operator">=</span><span class="token string">"$y$"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取棋盘坐标（这里的对象是一维坐标）</span>
    <span class="token comment"># reshape() 函数的 -1 表示对全部数据执行此函数执行后，数据由 (100,) 变为 (100,1)</span>
    x1 <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span>axes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> axes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 得到预测值</span>
    y_pred <span class="token operator">=</span> tree_reg<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>
    
    <span class="token comment"># 绘图</span>
    plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span>axes<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"$x_1$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> ylabel<span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span>ylabel<span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token string">"b."</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y_pred<span class="token punctuation">,</span><span class="token string">"r.-"</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> label <span class="token operator">=</span> <span class="token string">r"$\hat{y}$"</span><span class="token punctuation">)</span>
</code></pre> 
<p>查看差异：</p> 
<pre><code class="prism language-python"><span class="token comment"># 开始绘制两个分类器的回归效果</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span>
plot_regression_predictions<span class="token punctuation">(</span>tree_reg1<span class="token punctuation">,</span> X<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
<span class="token keyword">for</span> split<span class="token punctuation">,</span>style <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0.1973</span><span class="token punctuation">,</span> <span class="token string">"k-"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0.0917</span><span class="token punctuation">,</span><span class="token string">"k--"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0.7718</span><span class="token punctuation">,</span><span class="token string">"k--"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>split<span class="token punctuation">,</span>split<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>style<span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0.21</span><span class="token punctuation">,</span><span class="token number">0.65</span><span class="token punctuation">,</span><span class="token string">"Depth=0"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token string">"Depth=l"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">13</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0.65</span><span class="token punctuation">,</span><span class="token number">0.8</span><span class="token punctuation">,</span><span class="token string">"Depth=1"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">13</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">"upper center"</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"max_depth=2"</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span>
plot_regression_predictions<span class="token punctuation">(</span>tree_reg2<span class="token punctuation">,</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span>ylabel<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> split<span class="token punctuation">,</span>style <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0.1973</span><span class="token punctuation">,</span><span class="token string">"k-"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0.0917</span><span class="token punctuation">,</span><span class="token string">"k--"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0.7718</span><span class="token punctuation">,</span><span class="token string">"k--"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>split<span class="token punctuation">,</span>split<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> style<span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> split <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">0.0458</span><span class="token punctuation">,</span><span class="token number">0.1298</span><span class="token punctuation">,</span><span class="token number">0.2873</span><span class="token punctuation">,</span><span class="token number">0.9040</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">[</span>split<span class="token punctuation">,</span>split<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"k:"</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token string">"Depth=2"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">13</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"max_depth=3"</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>得到的输出如下：</p> 
<p><img src="https://images2.imgbox.com/15/25/HGOWreuM_o.png" alt="在这里插入图片描述" height="300"></p> 
<p>从上图可以看出，设置的 max_depth 越大，得到的决策树模型划分得越细，拟合效果越好。</p> 
<p>接下来尝试将深度加大，看会出现什么效果：</p> 
<pre><code class="prism language-python"><span class="token comment"># 不限制深度</span>
tree_reg1 <span class="token operator">=</span> DecisionTreeRegressor<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>

<span class="token comment"># 深度限制为 10</span>
tree_reg2 <span class="token operator">=</span> DecisionTreeRegressor<span class="token punctuation">(</span>random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">,</span>min_samples_leaf<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token comment"># 训练分类器</span>
tree_reg1<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
tree_reg2<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span>y<span class="token punctuation">)</span>

<span class="token comment"># 设置坐标数据（作为测试数据）</span>
x1 <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># 得到模型的预测值</span>
y_pred1 <span class="token operator">=</span> tree_reg1<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>
y_pred2 <span class="token operator">=</span> tree_reg2<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>
</code></pre> 
<p>绘图展示效果：</p> 
<pre><code class="prism language-python"><span class="token comment"># 绘制两个分类器的回归效果</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span><span class="token string">"b."</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x1<span class="token punctuation">,</span>y_pred1<span class="token punctuation">,</span><span class="token string">"r.-"</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">r"$\hat{y}$"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">1.1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"$x_1$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">"$y$"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> rotation<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">"upper center"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"No restrictions"</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span><span class="token string">"b."</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x1<span class="token punctuation">,</span>y_pred2<span class="token punctuation">,</span><span class="token string">"r.-"</span><span class="token punctuation">,</span>linewidth<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">r"$ \hat{y}$"</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0.2</span><span class="token punctuation">,</span><span class="token number">1.1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">"$x_1$"</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"min_samples_leaf={}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>tree_reg2<span class="token punctuation">.</span>min_samples_leaf<span class="token punctuation">)</span><span class="token punctuation">,</span>fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>show <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>得到的输出如下：</p> 
<p><img src="https://images2.imgbox.com/b0/9e/iX7tmO0M_o.png" alt="在这里插入图片描述"></p> 
<p>上图左边由于不加限制，所以出现了严重的过拟合现象（为了满足每个点，而将模型设置得相当复杂）；而右图由于对 “叶子结点的最小样本数” 加了一定限制，故规避了过拟合风险。</p> 
<br> 
<h3>END</h3> 
<hr>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/55bbdf80bef24e6cb462765505998f7a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">你理解了for-in 和 for-of 吗？他们有什么区别？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e45daf1f769a6bfd82446f11c14af923/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">分享一下基于若依的二开经验</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>