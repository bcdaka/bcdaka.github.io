<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spark&#43;Flink&#43;Kafka环境配置 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/eb23d1f85ae437c9aa9c2618dd5543e1/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Spark&#43;Flink&#43;Kafka环境配置">
  <meta property="og:description" content="一、准备工作
1.安装虚拟机
VMware 安装 CentOS 7， 选择mini版，英文，网络NAT。
http://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-Minimal-2009.iso
vim /etc/sysconfig/network-scripts/ifcfg-ens33 将最后一行修改为 ONBOOT=&#34;yes&#34; 重启网络服务, 确保自己能够ping通baidu，如果依旧不行可以直接reboot重启虚拟机
systemctl restart network 查看ip地址
yum install net-tools ifconfig 2. 安装java 环境
yum install java-1.8.* 3.安装scala
yum install https://downloads.lightbend.com/scala/2.12.10/scala-2.12.10.rpm 4.安装screen
yum install screen #新建 screen -S xxx #退出 ctrl &#43; A &#43; D #重连 screen -r #列表 screen -ls 5. 安装wget,vim
yum install wget yum install vim 6.关闭防火墙
systemctl stop firewalld 二、安装Kafka
1. 下载
cd wget https://dlcdn.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-03T12:54:41+08:00">
    <meta property="article:modified_time" content="2024-04-03T12:54:41+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spark&#43;Flink&#43;Kafka环境配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>一、准备工作</p> 
<p>1.安装虚拟机</p> 
<p>VMware 安装 CentOS 7， 选择mini版，英文，网络NAT。</p> 
<p><a href="http://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-Minimal-2009.iso" rel="nofollow" title="http://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-Minimal-2009.iso">http://mirrors.aliyun.com/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-Minimal-2009.iso</a></p> 
<pre><code>vim /etc/sysconfig/network-scripts/ifcfg-ens33


将最后一行修改为
ONBOOT="yes"</code></pre> 
<p>重启网络服务, 确保自己能够ping通baidu，如果依旧不行可以直接reboot重启虚拟机</p> 
<pre><code>systemctl restart network</code></pre> 
<p>查看ip地址</p> 
<pre><code class="language-bash">yum install net-tools

ifconfig </code></pre> 
<p>2. 安装java 环境</p> 
<pre><code class="language-bash">yum install java-1.8.*</code></pre> 
<p>3.安装scala</p> 
<pre><code class="language-bash">yum install https://downloads.lightbend.com/scala/2.12.10/scala-2.12.10.rpm</code></pre> 
<p>4.安装screen</p> 
<pre><code class="language-bash">yum install screen

#新建 screen -S xxx
#退出 ctrl + A + D
#重连 screen -r
#列表 screen -ls
</code></pre> 
<p>5. 安装wget,vim</p> 
<pre><code class="language-bash">yum install wget
yum install vim</code></pre> 
<p>6.关闭防火墙</p> 
<pre><code class="language-bash">systemctl stop firewalld</code></pre> 
<p>二、安装Kafka</p> 
<p>1. 下载</p> 
<pre><code class="language-bash">cd

wget https://dlcdn.apache.org/kafka/3.7.0/kafka_2.13-3.7.0.tgz --no-check-certificate

tar -xzf kafka_2.13-3.7.0.tgz
cd kafka_2.13-3.7.0</code></pre> 
<p>2. 启动zookeeper</p> 
<pre><code class="language-bash">#启动zookeeper
screen -S zookeeper
bin/zookeeper-server-start.sh config/zookeeper.properties
#ctrl+A+D退出screen</code></pre> 
<p>3. 启动kafka</p> 
<pre><code class="language-bash">screen -S kafka
bin/kafka-server-start.sh config/server.properties
#ctrl+A+D退出screen</code></pre> 
<p>三、安装flink</p> 
<pre><code class="language-bash">cd


wget https://archive.apache.org/dist/flink/flink-1.13.0/flink-1.13.0-bin-scala_2.11.tgz --no-check-certificate
tar -xf flink-1.13.0-bin-scala_2.11.tgz &amp;&amp; cd flink-1.13.0

#启动
./bin/start-cluster.sh</code></pre> 
<p>四、安装spark</p> 
<pre><code class="language-bash">#安装spark
#参考教程 https://spark.apache.org/docs/3.2.0/

cd

wget https://archive.apache.org/dist/spark/spark-3.2.0/spark-3.2.0-bin-hadoop3.2.tgz --no-check-certificate
tar -xf spark-3.2.0-bin-hadoop3.2.tgz
cd spark-3.2.0-bin-hadoop3.2

./bin/pyspark</code></pre> 
<p>五、配置Python环境</p> 
<p>1.安装python</p> 
<pre><code class="language-bash">yum install python36 python3-devel
yum install gcc gcc-c++

pip3 install pip --upgrade</code></pre> 
<p>2. 安装pyalink</p> 
<pre><code class="language-bash">pip3 install pyalink --user -i https://mirrors.aliyun.com/pypi/simple --ignore-installed PyYAML

ln -si /root/.local/bin/* /usr/bin/</code></pre> 
<p>3. 安装pyspark</p> 
<pre><code class="language-bash">pip3 install pyspark -i https://mirrors.aliyun.com/pypi/simple/</code></pre> 
<p>4. 安装kafka-python</p> 
<pre><code class="language-bash">pip3 install kafka-python</code></pre> 
<p>5. 配置jupyter</p> 
<pre><code class="language-bash">jupyter notebook --generate-config
jupyter notebook password

</code></pre> 
<p>修改配置文件</p> 
<pre><code class="language-bash">vim /root/.jupyter/jupyter_notebook_config.py

#修改对应的两行
c.NotebookApp.ip = '*'
c.NotebookApp.open_browser = False</code></pre> 
<p>启动</p> 
<pre><code class="language-bash">jupyter notebook --allow-root</code></pre> 
<p>六、测试</p> 
<ul><li>本机打开浏览器访问 服务器ip:8888, 例如192.168.128.140:8888</li></ul> 
<p>1. 测试kafka</p> 
<ul><li>生产者</li></ul> 
<pre><code class="language-python">from kafka import KafkaProducer
import json
 
producer = KafkaProducer(
        bootstrap_servers=['localhost:9092'], 
        key_serializer=lambda k: json.dumps(k).encode(),
        value_serializer=lambda v: json.dumps(v).encode()
)

 
 
msg = "Hello World"
producer.send('result', msg)
</code></pre> 
<ul><li>消费者</li></ul> 
<pre><code class="language-python">from kafka import KafkaConsumer

consumer = KafkaConsumer('result', bootstrap_servers=['localhost:9092'])

for msg in consumer:
    print(msg.value)
</code></pre> 
<p>2. 测试flink</p> 
<pre><code class="language-python">from pyalink.alink import *
import pandas as pd

useLocalEnv(1)


df = pd.DataFrame(
    [
        [2009, 0.5],
        [2010, 9.36],
        [2011, 52.0],
        [2012, 191.0],
        [2013, 350.0],
        [2014, 571.0],
        [2015, 912.0],
        [2016, 1207.0],
        [2017, 1682.0]
    ]
)

train_set = BatchOperator.fromDataframe(df, schemaStr='sumMoney double, fraud double')


trainer = LinearRegTrainBatchOp()\
    .setFeatureCols(["sumMoney"])\
    .setLabelCol("fraud")

train_set.link(trainer);
train_set.print()</code></pre> 
<p>3.测试spark</p> 
<pre><code class="language-python">from pyspark.sql import SparkSession 
spark=SparkSession.builder.appName('ml').getOrCreate()

_schema1 = 'x1 int, x2 int, x3 int, y int '
_schema2 = 'x1 int, x2 int , x3 int '

trainDf = spark.createDataFrame([
    [900,50,90,1],
    [800,50,90,1],
    [600,50,120,1],
    [500,40,100,0],
    [750,60,150,0]
],schema=_schema1)

testDf = spark.createDataFrame([
    [650,60,90],
    [600,40,90],
    [750,50,60]
],schema=_schema2)

trainDf.show()
testDf.show()
</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ee2b6a0d3935e1b504586e13417a223b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【数据库】锁表原因及处理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0296890ab60bf970b7816be2937823e2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">必看！前端角度梳理微信支付（小程序、H5、JSAPI）流程解密</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>