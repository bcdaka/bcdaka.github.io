<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Mac版Jmeter安装与使用&amp;模拟分布式环境 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/fe0be4b080eb6aae96b62eb4dedc6c90/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Mac版Jmeter安装与使用&模拟分布式环境">
  <meta property="og:description" content="Mac版Jmeter安装与使用&amp;模拟分布式环境 1 安装Jmeter 1.1 安装Java环境 国内镜像地址：https://repo.huaweicloud.com/java/jdk/11.0.2&#43;9/jdk-11.0.2_osx-x64_bin.dmg
下载dmg后，双击进行安装。
配置环境变量：
# 1 打开环境变量配置文件 open ~/.bash_profile # 2 在最后一行插入 export JAVA_11_HOME=`/usr/libexec/java_home -v 11` export JAVA_HOME=$JAVA_11_HOME alias jdk11=&#34;export JAVA_HOME=$JAVA_11_HOME&#34; # 3 刷新配置文件 source ~/.bash_profile # 4 查看配置是否生效 java -version 1.2 下载安装Jmeter ①官网下载安装包：https://jmeter.apache.org/download_jmeter.cgi
②下载完成后，直接解压
bin：Jmeter可执行文件
docs：包含用户指南等文档。
extras：包含各种使用样例。
lib：该目录包含 Jmeter 所需的 JAR 包（也可以添加其他的 JAR 包）。
printable_docs：里面是一些可打印的文件。
③启动Jmeter
进入bin目录，执行sh jmeter
1.3 插件安装（可选） 插件地址：https://jmeter-plugins.org/wiki/Start/
TPS：Transactions Per Second 也就是事务数/秒QPS：QPS Queries Per Second 是每秒查询率,是一台服务器 每秒能够相应的查询次数，是对一个特定的查询服务器 在规定时间内 所处理流量多少的衡量标准, 即每秒的响应请求数，也即是最大吞吐能力。 Jmeter默认的图表比较简单。大家可根据需要自行安装插件。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-16T19:09:31+08:00">
    <meta property="article:modified_time" content="2024-03-16T19:09:31+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Mac版Jmeter安装与使用&amp;模拟分布式环境</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="MacJmeter_0"></a>Mac版Jmeter安装与使用&amp;模拟分布式环境</h2> 
<h3><a id="1_Jmeter_1"></a>1 安装Jmeter</h3> 
<h4><a id="11_Java_2"></a>1.1 安装Java环境</h4> 
<blockquote> 
 <p>国内镜像地址：https://repo.huaweicloud.com/java/jdk/11.0.2+9/jdk-11.0.2_osx-x64_bin.dmg</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/2b/03/6vpsLEVp_o.png" alt="在这里插入图片描述"><br> 下载dmg后，双击进行安装。</p> 
<p>配置环境变量：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 1 打开环境变量配置文件</span>
<span class="token function">open</span> ~/.bash_profile

<span class="token comment"># 2 在最后一行插入</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_11_HOME</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>/usr/libexec/java_home <span class="token parameter variable">-v</span> <span class="token number">11</span><span class="token variable">`</span></span> 

<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span><span class="token variable">$JAVA_11_HOME</span>

<span class="token builtin class-name">alias</span> <span class="token assign-left variable">jdk11</span><span class="token operator">=</span><span class="token string">"export JAVA_HOME=<span class="token variable">$JAVA_11_HOME</span>"</span>

<span class="token comment"># 3 刷新配置文件</span>
<span class="token builtin class-name">source</span> ~/.bash_profile

<span class="token comment"># 4 查看配置是否生效</span>
<span class="token function">java</span> <span class="token parameter variable">-version</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d5/81/KZfjqbtp_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="12_Jmeter_30"></a>1.2 下载安装Jmeter</h4> 
<p>①官网下载安装包：https://jmeter.apache.org/download_jmeter.cgi<br> <img src="https://images2.imgbox.com/75/94/tKwwBXdI_o.png" alt="在这里插入图片描述"></p> 
<p>②下载完成后，直接解压<br> <img src="https://images2.imgbox.com/2c/0f/s3ODOe0s_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p>bin：Jmeter可执行文件</p> </li><li> <p>docs：包含用户指南等文档。</p> </li><li> <p>extras：包含各种使用样例。</p> </li><li> <p>lib：该目录包含 Jmeter 所需的 JAR 包（也可以添加其他的 JAR 包）。</p> </li><li> <p>printable_docs：里面是一些可打印的文件。</p> </li></ul> 
<p>③启动Jmeter</p> 
<blockquote> 
 <p>进入bin目录，执行sh jmeter</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/c1/7e/kLeg28C9_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="13__51"></a>1.3 插件安装（可选）</h4> 
<blockquote> 
 <p>插件地址：https://jmeter-plugins.org/wiki/Start/</p> 
</blockquote> 
<ul><li>TPS：Transactions Per Second 也就是事务数/秒</li><li>QPS：QPS Queries Per Second 是每秒查询率,是一台服务器 每秒能够相应的查询次数，是对一个特定的查询服务器 在规定时间内 所处理流量多少的衡量标准, 即每秒的响应请求数，也即是最大吞吐能力。</li></ul> 
<p>Jmeter默认的图表比较简单。大家可根据需要自行安装插件。</p> 
<blockquote> 
 <p>以安装TPS插件为例：</p> 
 <ol><li>来到官网，搜索插件名，点击<br> <img src="https://images2.imgbox.com/f8/60/hUbpbmDt_o.png" alt="在这里插入图片描述"></li><li>点击Download<br> <img src="https://images2.imgbox.com/be/94/gPNqB4e4_o.png" alt="在这里插入图片描述">3. 点击版本号，进行下载<br> <img src="https://images2.imgbox.com/bb/22/N3cOqqm5_o.png" alt="在这里插入图片描述"></li></ol> 
</blockquote> 
<blockquote> 
 <p>下载后，我们解压后放到jmeter的安装目录的相同位置，如：</p> 
 <ol><li>lib目录下的就放到apache-jmeter-3.0\lib下</li><li>ext下的就放到apache-jmeter-3.0\lib\ext\ 下，</li><li>重新启动Jmeter。</li></ol> 
</blockquote> 
<h4><a id="14__71"></a>1.4 使用</h4> 
<blockquote> 
 <p>详情用法参考：https://editor.csdn.net/md/?articleId=127047200</p> 
</blockquote> 
<p>步骤：创建测试计划-创建线程组（设置并发数）- 创建HTTP请求</p> 
<p>观测结果：<br> <img src="https://images2.imgbox.com/fd/cd/VdzJX4nJ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_nginxiris_web_80"></a>2 本地模拟分布式环境：nginx+iris web服务</h3> 
<blockquote> 
 <p>思路：</p> 
 <ol><li>docker启nginx，nginx配置：<code>server_name ziyi.com</code>，当拦截ziyi.com服务并转发给（本地8888和9999两个服务）：<br> server docker.for.mac.host.internal:8888;<br> server docker.for.mac.host.internal:9999;</li><li>本地配置域名解析：sudo vim /etc/hosts。添加解析记录：<br> 127.0.0.1 ziyi.com</li><li>docker启动nginx</li><li>启动两个iris web服务，分别为8888和9999端口</li></ol> 
</blockquote> 
<h4><a id="21_docker_90"></a>2.1 安装docker</h4> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils
yum-config-manager <span class="token punctuation">\</span>
    --add-repo <span class="token punctuation">\</span>
    https://download.docker.com/linux/centos/docker-ce.repo
yum <span class="token function">install</span> <span class="token function">docker</span>
systemctl start <span class="token function">docker</span>
</code></pre> 
<h4><a id="22_nginx_101"></a>2.2 安装配置nginx</h4> 
<h5><a id="nginxconf_102"></a>①nginx.conf</h5> 
<blockquote> 
 <p>以mac版本为例：因为nginx是在mac版的docker上跑的，所以可以通过 <code>docker.for.mac.host.internal</code>指向我mac宿主机，保证nginx转发请求到宿主机（mac），实现负载均衡。</p> 
 <ul><li>大家也可以通过create docker网络实现docker中的nginx转发到宿主机</li></ul> 
</blockquote> 
<pre><code class="prism language-bash">user nginx<span class="token punctuation">;</span>
worker_processes auto<span class="token punctuation">;</span>
error_log /var/log/nginx/error.log warn<span class="token punctuation">;</span>
pid /var/run/nginx.pid<span class="token punctuation">;</span>

events <span class="token punctuation">{<!-- --></span>
    worker_connections <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{<!-- --></span>
    include       /etc/nginx/mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>

    log_format  main  <span class="token string">'$remote_addr - $remote_user [$time_local] "$request" '</span>
                      <span class="token string">'$status $body_bytes_sent "$http_referer" '</span>
                      <span class="token string">'"$http_user_agent" "$http_x_forwarded_for"'</span><span class="token punctuation">;</span>

    access_log  /var/log/nginx/access.log  main<span class="token punctuation">;</span>

    upstream backend_consume <span class="token punctuation">{<!-- --></span>
        <span class="token comment"># mac下的docker有加一层虚拟机，所以无法直接访问，需要使用docker.for.mac.host.internal</span>
        server docker.for.mac.host.internal:8888 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
        server docker.for.mac.host.internal:9999 <span class="token assign-left variable">weight</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token comment"># server 127.0.0.1:8888; # 第一个服务</span>
        <span class="token comment"># server 127.0.0.1:9999; # 第二个服务</span>

        <span class="token comment"># 如果要实现更高级的负载均衡策略，比如轮询、权重等，可以在这里添加相应配置</span>
        <span class="token comment"># 比如：</span>
        <span class="token comment"># least_conn; # 最小连接数分配</span>
        <span class="token comment"># ip_hash;    # 根据客户端IP进行哈希一致性分配</span>
    <span class="token punctuation">}</span>

    server <span class="token punctuation">{<!-- --></span>
        listen <span class="token number">80</span><span class="token punctuation">;</span>

        server_name ziyi.com<span class="token punctuation">;</span>

        location / <span class="token punctuation">{<!-- --></span>
            proxy_pass http://backend_consume/consume<span class="token punctuation">;</span>
            proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
            proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
            proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
         	add_header <span class="token string">'Access-Control-Allow-Origin'</span> <span class="token string">'*'</span><span class="token punctuation">;</span>
         	add_header <span class="token string">'Access-Control-Allow-Credentials'</span> <span class="token string">'true'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="dockernginx_155"></a>②docker启动nginx</h5> 
<pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> nginx <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /Users/ziyi2/docker-home/nginx/nginx.conf:/etc/nginx/nginx.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /Users/ziyi2/docker-home/nginx:/var/log/nginx <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">80</span>:80 nginx
</code></pre> 
<h5><a id="iris_web_164"></a>③启动两个iris web服务</h5> 
<p>svc1：</p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"github.com/kataras/iris/v12"</span>
	context2 <span class="token string">"github.com/kataras/iris/v12/context"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	app <span class="token operator">:=</span> iris<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	app<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"/consume"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>context2<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token string">"ok port:8888"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	app<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>Cors<span class="token punctuation">)</span>
	app<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token string">":8888"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Cors</span><span class="token punctuation">(</span>ctx iris<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	ctx<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin"</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Credentials"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>svc2：</p> 
<pre><code class="prism language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">"github.com/kataras/iris/v12"</span>
	context2 <span class="token string">"github.com/kataras/iris/v12/context"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	app <span class="token operator">:=</span> iris<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	app<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"/consume"</span><span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>c <span class="token operator">*</span>context2<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		c<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token string">"ok port:9999"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	app<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>Cors<span class="token punctuation">)</span>
	app<span class="token punctuation">.</span><span class="token function">Listen</span><span class="token punctuation">(</span><span class="token string">":9999"</span><span class="token punctuation">,</span> <span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Cors</span><span class="token punctuation">(</span>ctx iris<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	ctx<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin"</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">Header</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Credentials"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span>
	ctx<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_216"></a>观察：</h5> 
<p>配置20个并发：<br> <img src="https://images2.imgbox.com/ae/12/6QEBSgMm_o.png" alt="在这里插入图片描述"></p> 
<p>新建请求，填写域名及路径：<br> <img src="https://images2.imgbox.com/c1/be/KHRiK5fj_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>后台打印日志，应该是8888一次、9999一次，出现负载均衡，交替打印</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/91c11d47b6bef9835e7ac94ab9fde36f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【保姆级教程】SpringBoot后端项目在Linux服务器中使用宝塔面板进行Docker部署</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/08bfb1df0179d4603900709fbedf989d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【java数据结构】HashMap和HashSet</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>