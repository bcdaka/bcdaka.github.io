<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spark on YARN部署模式保姆级教程 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/99816a69769cfb2d8dae900f50b9d230/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Spark on YARN部署模式保姆级教程">
  <meta property="og:description" content="目录
一、引言
二、基础环境（可根据自己的环境进行调整）
三、安装包下载及解压
1.下载压缩包及上传
2.上传压缩包
3.解压
四、配置环境变量
五、Spark的配置
六、配置worker节点
七、启动Spark集群
八、测试用例
九、关闭集群
一、引言 Local模式：这种模式主要用于本地开发和测试。它可以启动一个或多个执行器，具体取决于你是否使用&#34;local&#34;还是&#34;local [n]&#34;来启动Spark应用。&#34;local&#34;模式表示利用本节点单核单线程运行，而&#34;local [n]&#34;则表示利用本节点多核多线程运行。
Standalone模式：这是独立模式，自带完整的服务，可以单独部署到一个集群中，无需依赖任何其他资源管理系统。从一定程度上说，该模式是其他三种模式的基础。目前Spark在Standalone模式下是没有任何单点故障问题的，这是借助ZooKeeper实现的。
Yarn模式：这种模式运行在YARN资源管理器框架之上，由YARN负责资源管理，Spark负责任务调度和计算。
Mesos模式：这种模式运行在Mesos资源管理器框架之上，由Mesos负责资源管理，Spark负责任务调度和计算。
Kubernetes模式：这是一种较新的部署模式，将Spark应用部署到Kubernetes集群中。
没有最好的部署模式，具体要根据实际需求进行部署，由于Spark可以和Hadoop部署在一起，相互协作，Hadoop的HDFS，HBase负责数据存储与管理，Spark负责数据的计算，所以本文将详细讲解Spark on YARN模式的部署。
二、基础环境（可根据自己的环境进行调整） 1. Linux系统，CentOS7.6及以上
2. Hadoop3.3.5
3.JDK1.8版本及以上
4. spark3.4.0
5.集群架构
Hadoop集群架构Spark架构 IPmasterMaster节点192.168.244.131hadoop01Worker节点192.168.244.132hadoop02Worker节点192.168.244.133 三、安装包下载及解压 1.下载压缩包及上传 访问Spark官网下载页面 Index of /dist/spark (apache.org)https://archive.apache.org/dist/spark/
由于此前我们已经安装了Apache Hadoop3.3.5，所以，下载“
spark-3.4.0-bin-hadoop3-scala2.13.tgz 即可。
补充：
spark-3.4.0-bin-without-hadoop.tgz：这个版本是用于没有安装Hadoop环境下的Spark安装包。
spark-3.4.0-bin-hadoop3-scala2.13.tgz：这个版本是专为安装了Hadoop 3.x版本且使用Scala 2.13的用户而设计的。
spark-3.4.0-bin-hadoop3.tgz：这个版本则是为已经安装了Hadoop 3.x版本的用户提供的。
spark-3.4.0.tgz：这是Spark 3.4.0版本的通用安装包，适用于多种环境和组合。
2.上传压缩包 通过xftp或rz命令将压缩包上传到Linux的/export/software目录
3.解压 $ tar -zxvf /export/software/spark-3.4.0-bin-hadoop3-scala2.13.tgz -C /export/servers $ cd /export/servers $ ln -s spark-3.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-10T16:57:27+08:00">
    <meta property="article:modified_time" content="2024-01-10T16:57:27+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spark on YARN部署模式保姆级教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E5%BC%95%E8%A8%80-toc" style="margin-left:80px;"><a href="#%E4%B8%80%E3%80%81%E5%BC%95%E8%A8%80" rel="nofollow">一、引言</a></p> 
<p id="%E4%BA%8C%E3%80%81%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%EF%BC%88%E5%8F%AF%E6%A0%B9%E6%8D%AE%E8%87%AA%E5%B7%B1%E7%9A%84%E7%8E%AF%E5%A2%83%E8%BF%9B%E8%A1%8C%E8%B0%83%E6%95%B4%EF%BC%89-toc" style="margin-left:80px;"><a href="#%E4%BA%8C%E3%80%81%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%EF%BC%88%E5%8F%AF%E6%A0%B9%E6%8D%AE%E8%87%AA%E5%B7%B1%E7%9A%84%E7%8E%AF%E5%A2%83%E8%BF%9B%E8%A1%8C%E8%B0%83%E6%95%B4%EF%BC%89" rel="nofollow">二、基础环境（可根据自己的环境进行调整）</a></p> 
<p id="%E4%B8%89%E3%80%81%E5%AE%89%E8%A3%85%E5%8C%85%E4%B8%8B%E8%BD%BD%E5%8F%8A%E8%A7%A3%E5%8E%8B-toc" style="margin-left:80px;"><a href="#%E4%B8%89%E3%80%81%E5%AE%89%E8%A3%85%E5%8C%85%E4%B8%8B%E8%BD%BD%E5%8F%8A%E8%A7%A3%E5%8E%8B" rel="nofollow">三、安装包下载及解压</a></p> 
<p id="1.%E4%B8%8B%E8%BD%BD%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%8F%8A%E4%B8%8A%E4%BC%A0-toc" style="margin-left:160px;"><a href="#1.%E4%B8%8B%E8%BD%BD%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%8F%8A%E4%B8%8A%E4%BC%A0" rel="nofollow">1.下载压缩包及上传</a></p> 
<p id="2.%E4%B8%8A%E4%BC%A0%E5%8E%8B%E7%BC%A9%E5%8C%85-toc" style="margin-left:160px;"><a href="#2.%E4%B8%8A%E4%BC%A0%E5%8E%8B%E7%BC%A9%E5%8C%85" rel="nofollow">2.上传压缩包</a></p> 
<p id="3.%E8%A7%A3%E5%8E%8B-toc" style="margin-left:160px;"><a href="#3.%E8%A7%A3%E5%8E%8B" rel="nofollow">3.解压</a></p> 
<p id="%E5%9B%9B%E3%80%81%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-toc" style="margin-left:80px;"><a href="#%E5%9B%9B%E3%80%81%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" rel="nofollow">四、配置环境变量</a></p> 
<p id="%E4%BA%94%E3%80%81Spark%E7%9A%84%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#%E4%BA%94%E3%80%81Spark%E7%9A%84%E9%85%8D%E7%BD%AE" rel="nofollow">五、Spark的配置</a></p> 
<p id="%E5%85%AD%E3%80%81%E9%85%8D%E7%BD%AEworker%E8%8A%82%E7%82%B9-toc" style="margin-left:80px;"><a href="#%E5%85%AD%E3%80%81%E9%85%8D%E7%BD%AEworker%E8%8A%82%E7%82%B9" rel="nofollow">六、配置worker节点</a></p> 
<p id="%E4%B8%83%E3%80%81%E5%90%AF%E5%8A%A8Spark%E9%9B%86%E7%BE%A4-toc" style="margin-left:80px;"><a href="#%E4%B8%83%E3%80%81%E5%90%AF%E5%8A%A8Spark%E9%9B%86%E7%BE%A4" rel="nofollow">七、启动Spark集群</a></p> 
<p id="%E5%85%AB%E3%80%81%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B-toc" style="margin-left:80px;"><a href="#%E5%85%AB%E3%80%81%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B" rel="nofollow">八、测试用例</a></p> 
<p id="%E4%B9%9D%E3%80%81%E5%85%B3%E9%97%AD%E9%9B%86%E7%BE%A4-toc" style="margin-left:80px;"><a href="#%E4%B9%9D%E3%80%81%E5%85%B3%E9%97%AD%E9%9B%86%E7%BE%A4" rel="nofollow">九、关闭集群</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h4 id="%E4%B8%80%E3%80%81%E5%BC%95%E8%A8%80">一、引言</h4> 
<ol><li> <p>Local模式：这种模式主要用于本地开发和测试。它可以启动一个或多个执行器，具体取决于你是否使用"local"还是"local [n]"来启动Spark应用。"local"模式表示利用本节点单核单线程运行，而"local [n]"则表示利用本节点多核多线程运行。</p> </li><li> <p>Standalone模式：这是独立模式，自带完整的服务，可以单独部署到一个集群中，无需依赖任何其他资源管理系统。从一定程度上说，该模式是其他三种模式的基础。目前Spark在Standalone模式下是没有任何单点故障问题的，这是借助ZooKeeper实现的。</p> </li><li> <p>Yarn模式：这种模式运行在YARN资源管理器框架之上，由YARN负责资源管理，Spark负责任务调度和计算。</p> </li><li> <p>Mesos模式：这种模式运行在Mesos资源管理器框架之上，由Mesos负责资源管理，Spark负责任务调度和计算。</p> </li><li> <p>Kubernetes模式：这是一种较新的部署模式，将Spark应用部署到Kubernetes集群中。</p> </li></ol> 
<p>没有最好的部署模式，具体要根据实际需求进行部署，由于Spark可以和Hadoop部署在一起，相互协作，Hadoop的HDFS，HBase负责数据存储与管理，Spark负责数据的计算，所以本文将详细讲解Spark on YARN模式的部署。</p> 
<h4 id="%E4%BA%8C%E3%80%81%E5%9F%BA%E7%A1%80%E7%8E%AF%E5%A2%83%EF%BC%88%E5%8F%AF%E6%A0%B9%E6%8D%AE%E8%87%AA%E5%B7%B1%E7%9A%84%E7%8E%AF%E5%A2%83%E8%BF%9B%E8%A1%8C%E8%B0%83%E6%95%B4%EF%BC%89">二、基础环境（可根据自己的环境进行调整）</h4> 
<p>1. Linux系统，CentOS7.6及以上</p> 
<p>2. Hadoop3.3.5</p> 
<p>3.JDK1.8版本及以上</p> 
<p>4. spark3.4.0</p> 
<p>5.集群架构</p> 
<table border="1" cellpadding="1" cellspacing="1" style="width:500px;"><tbody><tr><td style="width:249px;">Hadoop集群架构</td><td style="width:249px;">Spark架构</td><td style="width:249px;">             IP</td></tr><tr><td style="width:249px;">master</td><td style="width:249px;">Master节点</td><td style="width:249px;">192.168.244.131</td></tr><tr><td style="width:249px;">hadoop01</td><td style="width:249px;">Worker节点</td><td style="width:249px;">192.168.244.132</td></tr><tr><td style="width:249px;">hadoop02</td><td style="width:249px;">Worker节点</td><td style="width:249px;">192.168.244.133</td></tr></tbody></table> 
<h4 id="%E4%B8%89%E3%80%81%E5%AE%89%E8%A3%85%E5%8C%85%E4%B8%8B%E8%BD%BD%E5%8F%8A%E8%A7%A3%E5%8E%8B">三、安装包下载及解压</h4> 
<h6 id="1.%E4%B8%8B%E8%BD%BD%E5%8E%8B%E7%BC%A9%E5%8C%85%E5%8F%8A%E4%B8%8A%E4%BC%A0">1.下载压缩包及上传</h6> 
<p>访问Spark官网下载页面 </p> 
<p><a class="has-card" href="https://archive.apache.org/dist/spark/" rel="nofollow" title="Index of /dist/spark (apache.org)"><span class="link-card-box"><span class="link-title">Index of /dist/spark (apache.org)</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/37/95/RmkVb52v_o.png" alt="icon-default.png?t=N7T8">https://archive.apache.org/dist/spark/</span></span></a></p> 
<p>由于此前我们已经安装了Apache Hadoop3.3.5，所以，下载“</p> 
<pre><a href="https://archive.apache.org/dist/spark/spark-3.4.0/spark-3.4.0-bin-hadoop3-scala2.13.tgz" rel="nofollow" title="spark-3.4.0-bin-hadoop3-scala2.13.tgz">spark-3.4.0-bin-hadoop3-scala2.13.tgz</a></pre> 
<p>即可。</p> 
<p>补充：</p> 
<ol><li> <p>spark-3.4.0-bin-without-hadoop.tgz：这个版本是用于没有安装Hadoop环境下的Spark安装包。</p> </li><li> <p>spark-3.4.0-bin-hadoop3-scala2.13.tgz：这个版本是专为安装了Hadoop 3.x版本且使用Scala 2.13的用户而设计的。</p> </li><li> <p>spark-3.4.0-bin-hadoop3.tgz：这个版本则是为已经安装了Hadoop 3.x版本的用户提供的。</p> </li><li> <p>spark-3.4.0.tgz：这是Spark 3.4.0版本的通用安装包，适用于多种环境和组合。</p> </li></ol> 
<h6 id="2.%E4%B8%8A%E4%BC%A0%E5%8E%8B%E7%BC%A9%E5%8C%85">2.上传压缩包</h6> 
<p>通过xftp或rz命令将压缩包上传到Linux的/export/software目录</p> 
<h6 id="3.%E8%A7%A3%E5%8E%8B">3.解压</h6> 
<pre><code class="hljs">$ tar -zxvf /export/software/spark-3.4.0-bin-hadoop3-scala2.13.tgz -C /export/servers
$ cd /export/servers
$ ln -s spark-3.4.0-bin-hadoop3-scala2.13 spark
$ chowm -R hadoop:hadoop ./spark #第一个"Hadoop"是用户名，指的是拥有执行该命令权限的用户。第二个"Hadoop"则是文件或目录的所属组名，这个命令的作用是将当前目录下的所有文件和文件夹的所有权更改为hadoop用户和hadoop组。</code></pre> 
<h4 id="%E5%9B%9B%E3%80%81%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">四、配置环境变量</h4> 
<p>1. 在Master节点终端执行以下命令</p> 
<pre><code class="hljs">$ vim /etc/profile

# 在底部追加如下2行内容：
export SPARK_HOME=/export/servers/spark
export PATH=$PATH:$SPARK_HOME/bin:$SPARK_HOME/sbin

# 使环境变量生效
$ source /etc/profile</code></pre> 
<h4 id="%E4%BA%94%E3%80%81Spark%E7%9A%84%E9%85%8D%E7%BD%AE">五、Spark的配置</h4> 
<p>1.  在Master节点执行以下命令将workers.template复制并命名为“workers”</p> 
<pre><code class="hljs">$ cd /export/servers/spark
$ cp ./conf/workers.template ./conf/workers
$ vim ./conf/workers</code></pre> 
<p>2. 在workers文件中设置Spark集群的Worker节点。编辑workers文件的内容，把其中的默认内容“localhost”替换成内容如下。</p> 
<pre><code class="hljs">hadoop02
hadoop03</code></pre> 
<p>3. 配置spark-env.sh</p> 
<p>在Master节点执行以下命令将spark-env.sh.template复制命名为“spark-env.sh”</p> 
<pre><code class="hljs">$ cd /export/servers/spark/conf
$ cp spark-env.sh.template spark-env.sh</code></pre> 
<p>编辑spark-env.sh文件内容</p> 
<pre><code class="hljs">vim spark-env.sh
# 在顶部输入以下内容

# 配置Java安装路径
export JAVA_HOME=/export/servers/jdk

# 配置Hadoop的配置文件路径   // on yarn 模式 主要在这
export HADOOP_CONF_DIR=/export/servers/hadoop/etc/hadoop

# 配置MASTER的IP，由于前面做了主机名映射，这里也可以直接用主机名
export SPARK_MASTER_IP=192.168.224.131  #IP地址为Master的ip地址</code></pre> 
<h4 id="%E5%85%AD%E3%80%81%E9%85%8D%E7%BD%AEworker%E8%8A%82%E7%82%B9">六、配置worker节点</h4> 
<p>在Master节点执行以下命令，将Master节点上的/export/servers/spark目录复制到各个worker节点</p> 
<pre><code class="hljs">$ cd /export/servers/
$ scp -r ./spark-3.4.0-bin-hadoop3-scala2.13/  hadoop02:/export/servers/
$ scp -r ./spark-3.4.0-bin-hadoop3-scala2.13/  hadoop03:/export/servers/

#在node2和node3上，构建软链接，完成配置
$ cd /export/servers
$ ln -s spark-3.4.0-bin-hadoop3-scala2.13 spark
# 不推荐用mv修改目录的名字</code></pre> 
<h4 id="%E4%B8%83%E3%80%81%E5%90%AF%E5%8A%A8Spark%E9%9B%86%E7%BE%A4">七、启动Spark集群</h4> 
<ol><li>切换为uHadoop用户： su - hadoop</li><li>启动Hadoop集群 ：start-all.sh</li><li>在Master节点启动Master节点：start-master.sh  </li><li>执行 jps 查看是否有Master进程</li><li>在Master节点启动所有Worker节点：start-workers.sh</li><li>在Hadoop02和Hadoop03分别 jps查看是否有Worker进程</li><li>在浏览器输入http://master:8080,可以查看spark的集群信息</li></ol> 
<h4 id="%E5%85%AB%E3%80%81%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B">八、测试用例</h4> 
<p>在Spark中，根据运行模式的不同，有两种提交任务的方式：YARN-Client和YARN-Cluster。</p> 
<ol><li> <p>YARN-Client模式：在此模式下，Driver程序运行在提交应用程序的客户端机器上，并通过客户端来监控和管理应用程序的执行过程。资源由客户端向YARN资源管理器请求。驱动程序首先向资源管理器注册应用程序，并由客户端协调Executor的启动和资源分配。这种模式通常适用于交互、调试和小规模的任务。提交任务时，只需要有Spark的安装包即可，不需要其他配置。</p> </li><li> <p>YARN-Cluster模式：与YARN-Client模式不同，此模式下的Driver程序运行在YARN集群中的某个Worker节点上。这样，Driver程序与Executor程序同在一个集群中，可以降低通信开销，因此适合在生产环境中使用。资源由YARN资源管理器自行分配和管理。驱动程序向资源管理器请求资源，并由资源管理器负责启动Executor进程并分配计算资源。</p> </li></ol> 
<p>这两种模式的选择取决于实际需求和使用环境，例如，学习、调试阶段可能更适合使用YARN-Client模式，而在生产环境中则常使用YARN-Cluster模式。</p> 
<pre><code class="hljs">$ spark-submit --class org.apache.spark.examples.SparkPi --master yarn --deploy-mode cluster /export/servers/spark/examples/jars/spark-examples_2.13-3.4.0.jar 100  //指定跑100轮   能看到SUCCEEDED    

run-example SparkPi 2&gt;&amp;1 | grep "Pi is"    //用管道，stdout只输出Pi is roughly 3.14 </code></pre> 
<h4 id="%E4%B9%9D%E3%80%81%E5%85%B3%E9%97%AD%E9%9B%86%E7%BE%A4">九、关闭集群</h4> 
<p>1. 关闭master：stop-master.sh</p> 
<p>2. 关闭worker：stop-workers.sh</p> 
<p>3. 关闭Hadoop：stop-all.sh</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a375313de520823e60f9e48af5d0673e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java解压缩(上传和下载)zip压缩包[超详细]包含[前后端]</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cfd6af0ef4a2db654bb6f40a6b55a1af/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">文心一言API调用，保姆级案例分享</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>