<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python从0到100（三十二）：lxml模块的学习与应用 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/0e17270b647f5e9d368dcb318ead77f7/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Python从0到100（三十二）：lxml模块的学习与应用">
  <meta property="og:description" content="学习目标 掌握使用lxml库提取数据的方法。理解lxml在数据处理后提取的数据类型。学习将元素（element）转换为字符串的方法。 1. lxml的安装 通过以下命令安装lxml库：
pip install lxml 2. lxml的使用 2.1 基础使用 导入lxml的etree库：from lxml import etree 将字符串转换为Element对象，并使用xpath方法提取数据：html = etree.HTML(text) ret_list = html.xpath(&#34;xpath字符串&#34;) 将Element对象转换为字符串（bytes类型）：
etree.tostring(element) 示例 假设有以下HTML内容，我们将对其进行操作：
&lt;div&gt; &lt;ul&gt; &lt;li class=&#34;item-1&#34;&gt;&lt;a href=&#34;link1.html&#34;&gt;first item&lt;/a&gt;&lt;/li&gt; &lt;li class=&#34;item-1&#34;&gt;&lt;a href=&#34;link2.html&#34;&gt;second item&lt;/a&gt;&lt;/li&gt; &lt;li class=&#34;item-inactive&#34;&gt;&lt;a href=&#34;link3.html&#34;&gt;third item&lt;/a&gt;&lt;/li&gt; &lt;li class=&#34;item-1&#34;&gt;&lt;a href=&#34;link4.html&#34;&gt;fourth item&lt;/a&gt;&lt;/li&gt; &lt;li class=&#34;item-0&#34;&gt;&lt;a href=&#34;link5.html&#34;&gt;fifth item&lt;/a&gt; &lt;!-- 注意此处缺少闭合标签 --&gt; &lt;/ul&gt; &lt;/div&gt; 使用lxml进行操作的代码如下：
from lxml import etree text = &#34;&#34;&#34; &lt;div&gt; &lt;ul&gt; ... &lt;/ul&gt; &lt;/div&gt; &#34;&#34;&#34; html = etree.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-16T10:11:49+08:00">
    <meta property="article:modified_time" content="2024-06-16T10:11:49+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python从0到100（三十二）：lxml模块的学习与应用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/5b/84/akjWlN7B_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1"></a>学习目标</h4> 
<ul><li>掌握使用lxml库提取数据的方法。</li><li>理解lxml在数据处理后提取的数据类型。</li><li>学习将元素（element）转换为字符串的方法。</li></ul> 
<h4><a id="1_lxml_6"></a>1. lxml的安装</h4> 
<p>通过以下命令安装lxml库：</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> lxml
</code></pre> 
<h4><a id="2_lxml_12"></a>2. lxml的使用</h4> 
<h5><a id="21__13"></a>2.1 基础使用</h5> 
<ul><li>导入lxml的etree库：<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
</code></pre> </li><li>将字符串转换为Element对象，并使用xpath方法提取数据：<pre><code class="prism language-python">html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
ret_list <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"xpath字符串"</span><span class="token punctuation">)</span>
</code></pre> </li><li>将Element对象转换为字符串（bytes类型）：<br> <code>etree.tostring(element)</code></li></ul> 
<h5><a id="_26"></a>示例</h5> 
<p>假设有以下HTML内容，我们将对其进行操作：</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item-1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>link1.html<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>first item<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item-1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>link2.html<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>second item<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item-inactive<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>link3.html<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>third item<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item-1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>link4.html<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>fourth item<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span> 
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item-0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>link5.html<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>fifth item<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- 注意此处缺少闭合标签 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span> 
</code></pre> 
<p>使用lxml进行操作的代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree

text <span class="token operator">=</span> <span class="token triple-quoted-string string">""" 
&lt;div&gt; &lt;ul&gt; ... &lt;/ul&gt; &lt;/div&gt; """</span>

html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">)</span>

handeled_html_str <span class="token operator">=</span> etree<span class="token punctuation">.</span>tostring<span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>handeled_html_str<span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<pre><code>&lt;class 'lxml.etree._Element'&gt;
&lt;html&gt;&lt;body&gt;&lt;div&gt; ... &lt;/div&gt; &lt;/body&gt;&lt;/html&gt;
</code></pre> 
<p>注意：lxml能够补充缺失的标签，但在数据提取时可能遇到问题。使用<code>etree.tostring</code>方法可以观察lxml处理后的HTML结构。</p> 
<h5><a id="22__60"></a>2.2 进阶练习</h5> 
<p>假设每个class为<code>item-1</code>的<code>li</code>标签代表一条新闻数据，我们将这些数据组成字典。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree

text <span class="token operator">=</span> <span class="token triple-quoted-string string">""" 
&lt;div&gt; &lt;ul&gt; ... &lt;/ul&gt; &lt;/div&gt; """</span>

html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>text<span class="token punctuation">)</span>

<span class="token comment"># 获取所有`li`标签的`href`和标题</span>
href_list <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//li[@class='item-1']/a/@href"</span><span class="token punctuation">)</span>
title_list <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//li[@class='item-1']/a/text()"</span><span class="token punctuation">)</span>

<span class="token comment"># 组装新闻数据</span>
<span class="token keyword">for</span> href <span class="token keyword">in</span> href_list<span class="token punctuation">:</span>
    item <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"href"</span><span class="token punctuation">:</span> href<span class="token punctuation">,</span> <span class="token string">"title"</span><span class="token punctuation">:</span> title_list<span class="token punctuation">[</span>href_list<span class="token punctuation">.</span>index<span class="token punctuation">(</span>href<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-python"><span class="token punctuation">{<!-- --></span><span class="token string">'href'</span><span class="token punctuation">:</span> <span class="token string">'link1.html'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'first item'</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">'href'</span><span class="token punctuation">:</span> <span class="token string">'link2.html'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'second item'</span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">'href'</span><span class="token punctuation">:</span> <span class="token string">'link4.html'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'fourth item'</span><span class="token punctuation">}</span>
</code></pre> 
<h5><a id="23__88"></a>2.3 进阶使用</h5> 
<p>如果提取的是一个节点而非属性或文本，lxml会返回Element对象，可以继续使用xpath方法。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree

text <span class="token operator">=</span> <span class="token triple-quoted-string string">""" 
&lt;div&gt; &lt;ul&gt; ... &lt;/ul&gt; &lt;/div&gt; """</span>

html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
li_list <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//li[@class='item-1']"</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> li <span class="token keyword">in</span> li_list<span class="token punctuation">:</span>
    item <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"href"</span><span class="token punctuation">:</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"./a/@href"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">if</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"./a/@href"</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
            <span class="token string">"title"</span><span class="token punctuation">:</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"./a/text()"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">if</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"./a/text()"</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token boolean">None</span><span class="token punctuation">}</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<pre><code>{'href': None, 'title': 'first item'}
{'href': 'link2.html', 'title': 'second item'}
{'href': 'link4.html', 'title': 'fourth item'}
</code></pre> 
<h4><a id="_113"></a>小结</h4> 
<ul><li>安装lxml库：<code>pip install lxml</code></li><li>导入lxml库：<code>from lxml import etree</code></li><li>使用lxml转换和解析HTML：<code>etree.HTML(text)</code></li><li>使用xpath提取数据：<code>data.xpath("//div/text()")</code></li><li>注意lxml提取的数据都是列表类型</li><li>对于复杂数据，先提取大节点，再遍历小节点进行操作，即先分组再提取数据</li></ul> 
<p>通过上述学习，你应该能够使用lxml库进行基本的数据提取和处理。在实际应用中，你可能需要根据具体情况调整xpath表达式以适应不同的数据结构。</p> 
<h2><a id="_122"></a>好书推荐</h2> 
<p><img src="https://images2.imgbox.com/57/98/p9eEttTY_o.png" alt="在这里插入图片描述"><br> 《人工智能注意力机制：体系、模型与算法剖析》融合了资深开发工程师多年一线工作经验，从注意力机制这一重要角度入手，阐述注意力机制的产生背景和发展历程，通过详实的理论剖析，以深入浅出的方式着重介绍注意力机制在计算机视觉与自然语言处理两大人工智能方向中的体系、模型与算法，并在最后将注意力机制在其他智能领域的应用加以拓展。内容循序渐进，图文细腻讲解，使读者身临其境，迅速、深入地掌握各种经验和技巧。<br> 内容简介<br> “注意”作为一切思维活动的起点，一直是哲学、心理学和认知神经科学的重点研究对象。随着计算机技术的发展，人类对注意力机制的模拟和应用成为计算机科学领域的热点研究方向——让计算机能够具有类似人类的注意力机制，使其能够有效地应用于对数据的理解和分析。Transformer模型诞生后，注意力机制在人工智能各大重要领域的研究和应用更是如火如荼，成果丰硕。<br> 《人工智能注意力机制：体系、模型与算法剖析》从注意力机制这一重要角度入手，阐述注意力机制的产生背景和发展历程，通过详实的理论剖析，以深入浅出的方式着重介绍注意力机制在计算机视觉、自然语言处理，以及多模态机器学习三大人工智能方向中的应用思路、模型与算法。<br> 《人工智能注意力机制：体系、模型与算法剖析》以人工智能相关专业研究人员，特别是计算机视觉与自然语言处理等领域的研发人员作为主要读者对象，一方面帮其梳理技术的发展脉络、开拓思路、构建完整的认知体系；另一方面为其剖析算法原理、深刻理解算法细节。本书提供配套源代码，下载方式见封底。</p> 
<p><strong>购买链接：<a href="https://item.jd.com/14544040.html" rel="nofollow">https://item.jd.com/14544040.html</a></strong><br> <img src="https://images2.imgbox.com/9f/c8/smKnEUbD_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4279bcdf5daf31f58de8e4d8a89c81af/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【机器学习】人工智能与气候变化：利用深度学习与机器学习算法预测和缓解环境影响</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/184422d5d75a9e83845ef003f7aba6f4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2024年最新MacBook苹果电脑安装JDK8、JDK11教程，配置环境变量 &#43; 快速切换JDK版本</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>