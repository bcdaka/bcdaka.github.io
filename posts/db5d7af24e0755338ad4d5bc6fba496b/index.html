<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SeaTunnel-web in K8S - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/db5d7af24e0755338ad4d5bc6fba496b/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="SeaTunnel-web in K8S">
  <meta property="og:description" content="下载，官网下载有问题，上dlcdn.apache.org下载
https://dlcdn.apache.org/seatunnel/seatunnel-web/1.0.0/apache-seatunnel-web-1.0.0-bin.tar.gz
apache-seatunnel-2.3.3中执行bin/install-plugin.sh下载connectors
下载web的源码
https://github.com/apache/seatunnel-web.git
seatunnel-server/seatunnel-app/src/main/bin/download_datasource.sh
将download_datasource.sh复制到/root/seatunnel/apache-seatunnel-web-1.0.0-bin/bin目录
sh download_datasource.sh 下载 datasource
vim conf/application.yml修改端口号和数据源信息
根据script目录下的数据表初始化脚本，把数据库建好 seatunnel_server_mysql.sql
将apache-seatunnel-2.3.4/conf目录下的hazelcast-client.yaml和plugin-mapping.properties复制过来
hazelcast-client.yaml中的信息连接到之前部署好的SeaTunnel集群
参考：SeaTunnel 2.3.4 Cluster in K8S-CSDN博客
logback-spring.xml文件中的日志级别如果需要可改成debug方便调试
准备创建镜像文件
apache-seatunnel-2.3.3（重命名为：seatunnel-zeta）和apache-seatunnel-web-1.0.0-bin（重命名为：seatunnel，web依赖zeta连接集群）都放在一个容器中。
在镜像中配置相关的环境变量
SEATUNNEL_HOME=/opt/seatunnel-zeta
SEATUNNEL_WEB_HOME=/opt/seatunnel
ST_WEB_BASEDIR_PATH=/opt/seatunnel/ui
将connectors和plugins目录复制到web下，打包后拷贝到镜像中，然后镜像中编写的启动脚本会把该目录移动到seatunnel-zeta目录下，不然在web界面选择不了数据源，connectors又依赖plugins cp -r /root/seatunnel/apache-seatunnel-2.3.3/connectors /root/seatunnel/apache-seatunnel-web-1.0.0-bin/
cp -r /root/seatunnel/apache-seatunnel-2.3.3/plugins /root/seatunnel/apache-seatunnel-web-1.0.0-bin/
创建启动脚本 web自带的是后台启动，所以需要自己写个脚本在容器中前台运行
vi apache-seatunnel-web-1.0.0-bin/start.sh
一定要在bin目录下执行启动后的脚本 sh bin/seatunnel-backend-daemon.sh start ，不然找不到首页 jetty err_empty_response 404
参考：CentOs7.x安装部署SeaTunnelWeb遇到的坑_seatunnel unable to connect to any cluster-CSDN博客
#!/bin/bash cp /opt/seatunnel-zeta/lib/* /opt/seatunnel/libs/ cp /opt/seatunnel/libs/datasource*.jar /opt/seatunnel-zeta/lib/ mv -r /opt/seatunnel/connectors /opt/seatunnel-zeta/ cd /opt/seatunnel/ # 一定要在这个目录执行，不然找不到首页 jetty err_empty_response 404 # https://blog.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-13T08:49:00+08:00">
    <meta property="article:modified_time" content="2024-03-13T08:49:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SeaTunnel-web in K8S</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<p><strong>下载，官网下载有问题，上dlcdn.apache.org下载</strong><br> https://dlcdn.apache.org/seatunnel/seatunnel-web/1.0.0/apache-seatunnel-web-1.0.0-bin.tar.gz</p> 
<p><strong>apache-seatunnel-2.3.3中执行bin/install-plugin.sh下载connectors</strong></p> 
<p><strong>下载web的源码</strong></p> 
<p>https://github.com/apache/seatunnel-web.git</p> 
<p>seatunnel-server/seatunnel-app/src/main/bin/<strong>download_datasource.sh</strong></p> 
<p>将download_datasource.sh复制到/root/seatunnel/apache-seatunnel-web-1.0.0-bin/bin目录<br> sh download_datasource.sh 下载 datasource</p> 
<p><strong>vim conf/application.yml修改端口号和数据源信息</strong></p> 
<p><strong>根据script目录下的数据表初始化脚本，把数据库建好 seatunnel_server_mysql.sql</strong></p> 
<p>将apache-seatunnel-2.3.4/conf目录下的<strong>hazelcast-client.yaml</strong>和<strong>plugin-mapping.properties</strong>复制过来</p> 
<p><strong>hazelcast-client.yaml中的信息连接到之前部署好的SeaTunnel集群</strong></p> 
<p><strong>参考：</strong><a href="https://blog.csdn.net/alksjdfp32r/article/details/136652912" title="SeaTunnel 2.3.4 Cluster in K8S-CSDN博客">SeaTunnel 2.3.4 Cluster in K8S-CSDN博客</a></p> 
<p>logback-spring.xml文件中的日志级别如果需要可改成debug方便调试</p> 
<p></p> 
<p><br><strong>准备创建镜像文件</strong></p> 
<p>apache-seatunnel-2.3.3（<strong>重命名为</strong><strong>：seatunnel-zeta</strong>）和apache-seatunnel-web-1.0.0-bin（<strong>重命名为：seatunnel，web依赖zeta连接集群</strong>）都放在一个容器中。</p> 
<p>在镜像中配置相关的环境变量</p> 
<p>SEATUNNEL_HOME=/opt/seatunnel-zeta<br> SEATUNNEL_WEB_HOME=/opt/seatunnel<br> ST_WEB_BASEDIR_PATH=/opt/seatunnel/ui</p> 
<p><br> 将connectors和plugins目录复制到web下，打包后拷贝到镜像中，然后镜像中编写的启动脚本会把该目录移动到<strong>seatunnel-zeta</strong>目录下，<span style="color:#fe2c24;"><strong>不然在web界面选择不了数据源，connectors又依赖plugins  </strong></span><br>  cp -r /root/seatunnel/apache-seatunnel-2.3.3/connectors   /root/seatunnel/apache-seatunnel-web-1.0.0-bin/<br>  cp -r /root/seatunnel/apache-seatunnel-2.3.3/plugins   /root/seatunnel/apache-seatunnel-web-1.0.0-bin/</p> 
<p><strong>创建启动脚本 web自带的是后台启动，所以需要自己写个脚本在容器中前台运行</strong><br> vi apache-seatunnel-web-1.0.0-bin/start.sh</p> 
<p>一定要在bin目录下执行启动后的脚本  sh bin/seatunnel-backend-daemon.sh start ，不然找不到首页  jetty err_empty_response 404</p> 
<p>参考：<a href="https://blog.csdn.net/qq_34905631/article/details/135074860" title="CentOs7.x安装部署SeaTunnelWeb遇到的坑_seatunnel unable to connect to any cluster-CSDN博客">CentOs7.x安装部署SeaTunnelWeb遇到的坑_seatunnel unable to connect to any cluster-CSDN博客</a></p> 
<pre><code>#!/bin/bash

cp /opt/seatunnel-zeta/lib/* /opt/seatunnel/libs/

cp /opt/seatunnel/libs/datasource*.jar /opt/seatunnel-zeta/lib/
mv -r /opt/seatunnel/connectors /opt/seatunnel-zeta/

cd /opt/seatunnel/
# 一定要在这个目录执行，不然找不到首页  jetty err_empty_response 404
# https://blog.csdn.net/qq_34905631/article/details/135074860
sh bin/seatunnel-backend-daemon.sh start

tail -f /opt/seatunnel/logs/seatunnel-web.log</code></pre> 
<p><strong>创建dockerfile</strong></p> 
<pre><code>FROM flink:1.18
ENV SEATUNNEL_VERSION="2.3.3"
ENV SEATUNNEL_WEB_VERSION="1.0.0"
COPY ./apache-seatunnel-web-${SEATUNNEL_WEB_VERSION}-bin.tar /opt/apache-seatunnel-web-${SEATUNNEL_WEB_VERSION}-bin.tar
WORKDIR /opt
RUN tar -xvf apache-seatunnel-web-${SEATUNNEL_WEB_VERSION}-bin.tar
RUN mv apache-seatunnel-web-${SEATUNNEL_WEB_VERSION}-bin seatunnel
RUN rm -f /opt/apache-seatunnel-web-${SEATUNNEL_WEB_VERSION}-bin.tar
WORKDIR /opt/seatunnel


COPY /apache-seatunnel-${SEATUNNEL_VERSION}-bin.tar.gz /opt/apache-seatunnel-${SEATUNNEL_VERSION}-bin.tar.gz
WORKDIR /opt
RUN tar -xzvf apache-seatunnel-${SEATUNNEL_VERSION}-bin.tar.gz
RUN mv apache-seatunnel-${SEATUNNEL_VERSION} seatunnel-zeta
RUN rm -f /opt/apache-seatunnel-${SEATUNNEL_VERSION}-bin.tar.gz


RUN export SEATUNNEL_HOME=/opt/seatunnel-zeta
RUN export SEATUNNEL_WEB_HOME=/opt/seatunnel
RUN export ST_WEB_BASEDIR_PATH=/opt/seatunnel/ui
RUN export PATH=$PATH:$SEATUNNEL_HOME/bin:$SEATUNNEL_WEB_HOME/bin:$ST_WEB_BASEDIR_PATH/bin


ENTRYPOINT ["sh", "/opt/seatunnel/start.sh"]</code></pre> 
<p><br>  tar -cvf apache-seatunnel-web-1.0.0-bin.tar apache-seatunnel-web-1.0.0-bin<br>  docker build -t yourharbor/yourlib/seatunnel-web:1.0.0 -f dockerfile-seatunnel-web-1.0.0-bin .<br>  docker push  yourharbor/yourlib/seatunnel-web:1.0.0</p> 
<p></p> 
<p><br><strong>vi web.yaml</strong></p> 
<pre><code>---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: seatunnel-web-deployment
  labels:
    app: seatunnel-web-dev
  namespace: seatunnel
spec:
  replicas: 1
  selector:
    matchLabels:
      app: seatunnel-web-pod
  template:
    metadata:
      labels:
        app: seatunnel-web-pod
    spec:
      containers:
      - name: seatunnel-web-serivce
        image: yourharbor/yourlib/seatunnel-web:1.0.0
        imagePullPolicy: Always
      tolerations:
      - effect: NoSchedule
        key: node-role.kubernetes.io/control-plane

---
apiVersion: v1
kind: Service
metadata:
  name: seatunnel-web-svc
  labels:
    app: seatunnel-web-svc
  namespace: seatunnel
spec:
  selector:
    app: seatunnel-web-pod
  ports:
  - name: seatunnel-web-ports
    protocol: TCP
    port: 8801
    nodePort: 3xxxx
    targetPort: 8801
  type: NodePort</code></pre> 
<p><br><strong>部署镜像</strong><br> kubectl apply -f web.yaml<br><strong>错了就删除</strong><br> kubectl delete -f web.yaml<br><strong>查看pod</strong><br> kubectl get po -n seatunnel -owide<br><strong>查看svc</strong><br> kubectl get svc -n seatunnel -owide<br><strong>describe</strong><br> kubectl describe po -n seatunnel seatunnel-web-deployment-75f465bd8b-tcvmf     <br><strong>logs</strong><br> kubectl logs -f -n seatunnel seatunnel-web-deployment-75f465bd8b-tcvmf      <br><strong>进去容器看看</strong><br> kubectl exec -it -n seatunnel seatunnel-web-deployment-75f465bd8b-tcvmf      -- /bin/bash<br><strong>容器里访问一下</strong><br> curl localhost:8801 </p> 
<p></p> 
<p>admin/admin登录，创建数据源，开始建source和sink</p> 
<p><br><strong>MySQL-CDC数据源建好了连接<span style="color:#fe2c24;">MySQL8.0输入连接信息时没有Driver信息</span>，所以实现MySQL8.0 CDC会出现找不到合适的Driver的异常</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/09c0158e553c264d9bc9f256e844979a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">docker部署rustdesk远程控制服务器</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a6bae6f309a454b16839265b439e21ce/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Visual Studio Code 配置 java/maven 环境(Windows版)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>