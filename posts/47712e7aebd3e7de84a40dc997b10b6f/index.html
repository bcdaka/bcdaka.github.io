<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HarmonyOS Next 实现登录注册页面(ARKTS) 并使用Springboot作为后端提供接口 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/47712e7aebd3e7de84a40dc997b10b6f/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="HarmonyOS Next 实现登录注册页面(ARKTS) 并使用Springboot作为后端提供接口">
  <meta property="og:description" content="1. HarmonyOS next ArkTS ArkTS围绕应用开发在 TypeScript （简称TS）生态基础上做了进一步扩展，继承了TS的所有特性，是TS的超集
ArkTS在TS的基础上扩展了struct和很多的装饰器以达到描述UI和状态管理的目的
以下代码是一个基于 HarmonyOS 的登录页面组件的示例代码，主要实现了用户登录功能以及一些数据存储和页面跳转的操作。下面我会逐步解释每个部分并添加注释：
2. 实例 3. 功能分区 1.1. HTTP获取后台接口数据，以下是示例 async jwt(jwt: string) { try { const res = await this.httpUtil.request(`192.168.xxx.xxx/readers/userinfo`, { method: http.RequestMethod.GET, extraData: { no: jwt }, }); let data = JSON.parse(res.result.toString()); return data; } catch (error) { throw error; } } 1.2 接口数据（作为测试，可以直接使用json）： 2.生命周期函数的使用--AboutToAppear AboutToDisappear aboutToAppear() { let httpRequest = http.createHttp() this.httpUtil = httpRequest // todo 初始化上一次访问时间 this.getPreTime() // todo 初始化当前时间 this.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-03T16:42:29+08:00">
    <meta property="article:modified_time" content="2024-03-03T16:42:29+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">HarmonyOS Next 实现登录注册页面(ARKTS) 并使用Springboot作为后端提供接口</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>1. HarmonyOS next</h3> 
<h3>ArkTS</h3> 
<p>ArkTS围绕应用开发在 TypeScript （简称TS）生态基础上做了进一步扩展，继承了TS的所有特性，是TS的超集</p> 
<p>ArkTS在TS的基础上扩展了struct和很多的装饰器以达到描述UI和状态管理的目的</p> 
<p>以下代码是一个基于 HarmonyOS 的登录页面组件的示例代码，主要实现了用户登录功能以及一些数据存储和页面跳转的操作。下面我会逐步解释每个部分并添加注释：</p> 
<h3>2. 实例</h3> 
<p><img alt="" height="1009" src="https://images2.imgbox.com/17/83/1Z7Xo6vq_o.png" width="534"></p> 
<h3>3. 功能分区</h3> 
<h4>1.1. HTTP获取后台接口数据，以下是示例</h4> 
<pre><code class="language-javascript">  async jwt(jwt: string) {
    try {
      const res = await this.httpUtil.request(`192.168.xxx.xxx/readers/userinfo`, {
        method: http.RequestMethod.GET,
        extraData: { no: jwt },
      });
      let data = JSON.parse(res.result.toString());
      return data;
    } catch (error) {
      throw error;
    }
  }
</code></pre> 
<h4>1.2 接口数据（作为测试，可以直接使用json）：</h4> 
<p><img alt="" height="1150" src="https://images2.imgbox.com/19/1a/2ZmZNRba_o.png" width="1200"></p> 
<h4><img alt="" height="1200" src="https://images2.imgbox.com/2a/cb/vfO6pQNM_o.png" width="1200"></h4> 
<h4></h4> 
<h4></h4> 
<h4></h4> 
<h4></h4> 
<h4></h4> 
<h4></h4> 
<h4>2.生命周期函数的使用--AboutToAppear AboutToDisappear</h4> 
<pre><code class="language-javascript">  aboutToAppear() {
    let httpRequest = http.createHttp()
    this.httpUtil = httpRequest
    // todo 初始化上一次访问时间
    this.getPreTime()
    // todo 初始化当前时间
    this.getLocalTimeToPreference()
    // todo 初始化本地数据库的密码和用户名
    this.getUserInfo()
  }
</code></pre> 
<h4>3.APPStorage进程作为缓存，只能在应用运行时使用</h4> 
<h4>4.DATAPreference 数据持久化，存于用户本机</h4> 
<p></p> 
<h4>4. 分层结构</h4> 
<p><img alt="" height="874" src="https://images2.imgbox.com/01/1d/LDKZEbqG_o.png" width="1104"></p> 
<h3>4.代码演示</h3> 
<p>1. 导入模块：<br>  </p> 
<pre><code class="language-javascript">import router from '@ohos.router' // 导入路由模块
import storage from '@ohos.data.storage' // 导入数据存储模块
import App from '@system.app' // 导入应用模块
import Prompt from '@system.prompt' // 导入提示模块
import http from '@ohos.net.http' // 导入网络请求模块
import { RouterInfo } from '../../Pojo/RouterInfo' // 导入自定义的 RouterInfo 类
import common from '@ohos.app.ability.common' // 导入通用模块
import dataPreference from '@ohos.data.preferences' // 导入数据首选项模块</code></pre> 
<p></p> 
<p>2. 定义 `Login` 结构体：<br>  </p> 
<pre><code class="language-javascript">@Entry
@Component
struct Login {
  // 定义状态变量
  @State username: string = ""
  @State pwd: string = ""
  @State allow: boolean = false
  @State upload: boolean = true
  @State uploadTag: boolean = false
  @State lastLocalTime: string = ""
  
  // 其他属性和方法...
}</code></pre> 
<p>3. 实例化 `RouterInfo` 对象和初始化方法：</p> 
<p>RouterInfo是一个自定义的类</p> 
<pre><code class="language-javascript">export class RouterInfo{
  name:string
  url:string
  message:string

  constructor(name,url,message) {
    this.name=name
    this.url=url
    this.message=message
  }
}</code></pre> 
<pre><code class="language-javascript">Router = new RouterInfo("进入主页", "pages/Books/Main", "主页面")

aboutToAppear() {
  // 初始化操作，包括创建 HTTP 请求对象、获取上次访问时间、初始化本地时间等
}</code></pre> 
<p>4. 页面跳转方法 `goTo()`：</p> 
<pre><code class="language-javascript">goTo(Router: RouterInfo) {
  // 调用路由模块进行页面跳转
}</code></pre> 
<p>5. 异步获取用户信息的方法 `jwt()`：<br>  </p> 
<pre><code class="language-javascript">async jwt(jwt: string) {
  // 发起网络请求获取用户信息
}</code></pre> 
<p>6. 存储当前时间到用户首选项方法 `getLocalTimeToPreference()`：<br>  </p> 
<pre><code class="language-javascript">// 获取当前时间并存入用户首选项
  getLocalTimeToPreference(){
    const currentDate: Date = new Date();
    const currentYear: number = currentDate.getFullYear();
    const currentMonth: number = currentDate.getMonth() + 1; // 注意：月份从 0 开始，需要加 1
    const currentDay: number = currentDate.getDate();
    const currentHour: number = currentDate.getHours();
    const currentMinute: number = currentDate.getMinutes();
    const currentSecond: number = currentDate.getSeconds();

    const curTime = `北京时间：${currentYear}-${currentMonth}-${currentDay} ${currentHour}:${currentMinute}:${currentSecond}`;

    dataPreference.getPreferences(this.context, "myBookStore").then(preferences =&gt; {
      preferences.put("curTime", curTime).then(_ =&gt; {
        preferences.flush();
      });
    }).catch((err: Error) =&gt; {
      console.error(err.message);
    });
  }</code></pre> 
<p>7. 获取上一次访问时间方法 `getPreTime()` 和关闭应用更新时间方法</p> 
<pre><code class="language-javascript"> // 获取上一次的时间--lastTime
  getPreTime(){
    dataPreference.getPreferences(this.context, "myBookStore").then(preferences =&gt; {
      if (!preferences.has("lastTime")) {
        console.log("数据并未能保存");
      } else {
        preferences.get("lastTime", 'null').then((value) =&gt; {
          this.last=value.toLocaleString()
          // AlertDialog.show({message:`上一次访问时间：${this.last}`})
          console.log("数据为:" + value);
        }).catch(_ =&gt; {
          console.log("读取失败");
        });
      }
    });
  }

  // 关闭应用时将lastTime置换为curTime，并将curTime替换为空值
  closeAppAndUpdateTime(){
    dataPreference.getPreferences(this.context, "myBookStore").then(preferences =&gt; {
      preferences.get("curTime", '').then((curTime) =&gt; {
        preferences.put("lastTime", curTime);
        preferences.put("curTime", '');
        preferences.flush();
        console.log("上一次时间已更新，当前时间已清空");
      }).catch((err: Error) =&gt; {
        console.error(err.message)
      });
    }).catch((err: Error) =&gt; {
      console.error(err.message);
    });
  }
</code></pre> 
<p>8. 用户登录方法 `login()` 和相关辅助方法：</p> 
<pre><code class="language-javascript">login() {
  // 用户登录逻辑，包括密码验证、令牌解析、存储用户信息等操作
}

uploadUserInfo() {
  // 将用户信息上传到本地存储
}

getUserInfo() {
  // 获取本地存储的用户信息
}</code></pre> 
<p>9. 构建页面布局的方法 `build()`：</p> 
<pre><code class="language-javascript">build() {
  // 构建页面布局，包括输入框、按钮、复选框等组件
}</code></pre> 
<p>这段代码实现了一个简单的登录页面，涵盖了用户输入、网络请求、数据存储等功能，并且使用 HarmonyOS 的一些模块来实现这些功能。</p> 
<h3>5.全代码</h3> 
<pre><code class="language-javascript">import router from '@ohos.router'
import storage from '@ohos.data.storage'
import App from '@system.app'
import Prompt from '@system.prompt'
import http from '@ohos.net.http'
import { RouterInfo } from '../../Pojo/RouterInfo'
import common from '@ohos.app.ability.common'
import dataPreference from '@ohos.data.preferences'
@Entry
@Component
struct Login {
  // todo 定义域
  @State username:string=""
  @State pwd:string=""
  @State allow:boolean = false
  @State upload:boolean = true
  @State uploadTag:boolean = false
  @State lastLocalTime:string=""
  httpUtil: http.HttpRequest
  context = getContext(this) as common.UIAbilityContext
  @State last:string=''
  Router = new RouterInfo("进入主页","pages/Books/Main","主页面")

  aboutToAppear() {
    let httpRequest = http.createHttp()
    this.httpUtil = httpRequest
    // todo 初始化上一次访问时间
    this.getPreTime()
    // todo 初始化当前时间
    this.getLocalTimeToPreference()
    // todo 初始化本地数据库的密码和用户名
    this.getUserInfo()
  }

  aboutToDisappear(){
    // todo 保存当前时间作为上一次的时间
    this.closeAppAndUpdateTime()
  }



  goTo(Router:RouterInfo){
    router.pushUrl({
      url: Router.url,
      params:{
        title:Router.message
      }
    },
      router.RouterMode.Single,
      err=&gt; {
        if (err) {
          console.log("路由失败"+err.code+':'+err.message)
        }
      })
  }


  async jwt(jwt: string) {
    try {
      const res = await this.httpUtil.request(`192.168.137.1/readers/userinfo`, {
        method: http.RequestMethod.GET,
        extraData: { no: jwt },
      });
      let data = JSON.parse(res.result.toString());
      return data;
    } catch (error) {
      throw error;
    }
  }

  // 获取当前时间并存入用户首选项
  getLocalTimeToPreference(){
    const currentDate: Date = new Date();
    const currentYear: number = currentDate.getFullYear();
    const currentMonth: number = currentDate.getMonth() + 1; // 注意：月份从 0 开始，需要加 1
    const currentDay: number = currentDate.getDate();
    const currentHour: number = currentDate.getHours();
    const currentMinute: number = currentDate.getMinutes();
    const currentSecond: number = currentDate.getSeconds();

    const curTime = `北京时间：${currentYear}-${currentMonth}-${currentDay} ${currentHour}:${currentMinute}:${currentSecond}`;

    dataPreference.getPreferences(this.context, "myBookStore").then(preferences =&gt; {
      preferences.put("curTime", curTime).then(_ =&gt; {
        preferences.flush();
      });
    }).catch((err: Error) =&gt; {
      console.error(err.message);
    });
  }

  // 获取上一次的时间--lastTime
  getPreTime(){
    dataPreference.getPreferences(this.context, "myBookStore").then(preferences =&gt; {
      if (!preferences.has("lastTime")) {
        console.log("数据并未能保存");
      } else {
        preferences.get("lastTime", 'null').then((value) =&gt; {
          this.last=value.toLocaleString()
          // AlertDialog.show({message:`上一次访问时间：${this.last}`})
          console.log("数据为:" + value);
        }).catch(_ =&gt; {
          console.log("读取失败");
        });
      }
    });
  }

  // 关闭应用时将lastTime置换为curTime，并将curTime替换为空值
  closeAppAndUpdateTime(){
    dataPreference.getPreferences(this.context, "myBookStore").then(preferences =&gt; {
      preferences.get("curTime", '').then((curTime) =&gt; {
        preferences.put("lastTime", curTime);
        preferences.put("curTime", '');
        preferences.flush();
        console.log("上一次时间已更新，当前时间已清空");
      }).catch((err: Error) =&gt; {
        console.error(err.message)
      });
    }).catch((err: Error) =&gt; {
      console.error(err.message);
    });
  }






  // todo 函数定义域
  async login() {
    if (this.username &amp;&amp; this.pwd &amp;&amp; this.allow) {
      try {
        const res = await this.httpUtil.request(`192.168.137.1/readers/login`, {
          method: http.RequestMethod.GET,
          extraData: { no: this.username, pwd: this.pwd },
        });
        let jsonResult = res.result.toString();
        let responseObject = JSON.parse(jsonResult);
        if (responseObject['code'] === 200) {
          // todo 解析令牌
          const data = await this.jwt(responseObject['data']);

          // todo 上下文 -- 存储令牌
          AppStorage.SetOrCreate("info",data['data']['readerno'])

          // todo 是否将密码存储至本地
          if (this.upload===true) {
            this.uploadUserInfo()
          }

          // todo 跳转
          this.goTo(this.Router)

        }
      } catch (error) {
        console.error(error);
        Prompt.showDialog({
          message: "登录失败",
        });
      }
    } else {
      if (!this.username || !this.pwd) {
        Prompt.showDialog({
          message: "请输入用户名和密码",
        });
      } else if (!this.allow) {
        Prompt.showDialog({
          message: "请勾选允许登录选项",
        });
      }
    }
  }


  uploadUserInfo(){
    // 用户存储信息到本地，使用用户首选项
    dataPreference.getPreferences(this.context, "myBookStore").then(preferences =&gt; {
      let user:{}={'username':this.username,'pwd':this.pwd}
      preferences.put("userInfo",JSON.stringify(user)).then(_ =&gt; {
        preferences.flush();
      });
    }).catch((err: Error) =&gt; {
      console.error(err.message);
    });
  }

  getUserInfo(){
    dataPreference.getPreferences(this.context, "myBookStore").then(preferences =&gt; {
      preferences.get("userInfo", '').then((userInfo) =&gt; {
        let user = JSON.parse(userInfo.toLocaleString())
        if (user) {
          this.uploadTag=true
          this.username = user['username']
          this.pwd = user['pwd']
        }
      }).catch((err: Error) =&gt; {
        console.error(err.message)
      });
    }).catch((err: Error) =&gt; {
      console.error(err.message);
    });
  }





  build() {
      Column(){
        Column() {

            Text("掌上书店")
              .fontColor('#096789')
              .fontSize(70)
          this.displayLast("上一次访问时间："+this.last)
          if (this.uploadTag===true){
            this.displayLast("本地已经存储密码")
          }
        }.margin({ bottom: 100 })
        .height('50%')
        .justifyContent(FlexAlign.Center)

        Column()
        {
          Row()
          {
            // 用户名输入框
            TextInput({ placeholder: this.username===''? "请输入您的用户名":this.username })
              .type(InputType.Normal)
              .width('80%')
              .height(50)
              .placeholderColor(Color.Black)
              .backgroundColor('#ffd3d7d3')
              .borderRadius(10)
              .margin({ bottom: 10})
              .onChange(val=&gt;{
                this.username=val
                console.log(val)
              })

          }

          Row()
          {
            // 密码输入框
            TextInput({ placeholder: this.pwd===''?"请输入您的密码":this.pwd })
              .type(InputType.Password)
              .width('80%')
              .height(50)
              .placeholderColor(Color.Black)
              .backgroundColor('#ffd3d7d3')
              .borderRadius(10)
              .onChange(val=&gt;{
                this.pwd=val
                console.log(val)
              })
          }
          Row(){
            Row(){
              Checkbox().onChange((val:boolean)=&gt;{
                this.upload=val
                console.log('Checkbox2 change is'+val)
              })
              Text("将密码存储到本地")
            }.width('98%')
            .padding({left:30})
            .height('40')
          }.margin({ bottom: 40 })

          Row()
          {
            //登录按钮
            Button("登录")
              .width(120)
              .height(40)
              .fontColor(Color.White)
              .onClick(() =&gt; {
                this.login()

              })
              .backgroundColor('#ff5eb35b')
              .margin({right:40})
              .borderStyle(BorderStyle.Dotted)

            //  注册按钮
            Button("注册")
              .width(120)
              .height(40)
              .fontColor(Color.White)
              .onClick(() =&gt; {
                router.pushUrl({
                  url: "pages/Second"
                })
              })
              .backgroundColor('#ff5eb35b')
          }
          .justifyContent(FlexAlign.SpaceEvenly)
        }
        .width("100%")
        .height("30%")

        Row(){
          Checkbox().onChange((val:boolean)=&gt;{
            this.allow=val
            console.log('Checkbox2 change is'+val)
          })
          Text("点击代表同意相关使用条例与请求")
        }.width('90%')
        .padding({left:30})
        .height('40')

      }
      .height('100%')
        .width('100%')
        .margin({bottom:20})
        .linearGradient({
          direction:GradientDirection.RightBottom,
          colors:[[0xAEE1E1, 0.0], [0xD3E0DC, 0.3], [0xFCD1D1, 1.0]]
        })

  }


  @Builder displayLast(message) {
    Row(){
      Text(message)
        .fontColor("b#ffe7eae7")
    }.width("70%").
    height("40")
    .backgroundColor("#ffe7eae7")
    .borderRadius(20)
    .padding({left:10})
    .margin({bottom:5})
  }
}</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/602eb34367353f38ccfbdd1e75a7cb8b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Stable Diffusion webui 常用启动参数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c6db1b3b49c07c4a925f8d84bd22f98b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Docker：安装和使用教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>