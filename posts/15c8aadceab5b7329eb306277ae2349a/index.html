<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>毕设：《基于hive的音乐数据分析系统的设计与实现》 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/15c8aadceab5b7329eb306277ae2349a/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="毕设：《基于hive的音乐数据分析系统的设计与实现》">
  <meta property="og:description" content="文章目录 环境启动一、爬取数据1.1、歌单信息1.2、每首歌前20条评论1.3、排行榜 二、搭建环境1.1、搭建JAVA1.2、配置hadoop1.3、配置Hadoop环境：YARN1.4、MYSQL1.5、HIVE(数据仓库)1.6、Sqoop（关系数据库数据迁移） 三、hadoop配置内存四、导入数据到hive五、sqoop导入数据 环境启动 启动hadoop图形化界面
cd /opt/server/hadoop-3.1.0/sbin/ ./start-dfs.sh ./start-yarn.sh # 或者 ./start-all.sh 启动hive
hive 一、爬取数据 1.1、歌单信息 CREATE TABLE playlist ( PlaylistID INT AUTO_INCREMENT PRIMARY KEY, Type VARCHAR(255), Title VARCHAR(255), PlayCount VARCHAR(255), Contributor VARCHAR(255) ); # _*_ coding : utf-8 _*_ # @Time : 2023/11/15 10:26 # @Author : Laptoy # @File : 01_playlist # @Project : finalDesign import requests import time from bs4 import BeautifulSoup import pymysql db_connection = pymysql.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-21T14:38:19+08:00">
    <meta property="article:modified_time" content="2024-04-21T14:38:19+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">毕设：《基于hive的音乐数据分析系统的设计与实现》</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_4" rel="nofollow">环境启动</a></li><li><a href="#_25" rel="nofollow">一、爬取数据</a></li><li><ul><li><a href="#11_26" rel="nofollow">1.1、歌单信息</a></li><li><a href="#1220_104" rel="nofollow">1.2、每首歌前20条评论</a></li><li><a href="#13_252" rel="nofollow">1.3、排行榜</a></li></ul> 
  </li><li><a href="#_320" rel="nofollow">二、搭建环境</a></li><li><ul><li><a href="#11JAVA_321" rel="nofollow">1.1、搭建JAVA</a></li><li><a href="#12hadoop_358" rel="nofollow">1.2、配置hadoop</a></li><li><a href="#13HadoopYARN_453" rel="nofollow">1.3、配置Hadoop环境：YARN</a></li><li><a href="#14MYSQL_512" rel="nofollow">1.4、MYSQL</a></li><li><a href="#15HIVE_589" rel="nofollow">1.5、HIVE(数据仓库)</a></li><li><a href="#16Sqoop_650" rel="nofollow">1.6、Sqoop（关系数据库数据迁移）</a></li></ul> 
  </li><li><a href="#hadoop_676" rel="nofollow">三、hadoop配置内存</a></li><li><a href="#hive_702" rel="nofollow">四、导入数据到hive</a></li><li><a href="#sqoop_798" rel="nofollow">五、sqoop导入数据</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_4"></a>环境启动</h2> 
<p>启动hadoop图形化界面</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /opt/server/hadoop-3.1.0/sbin/

./start-dfs.sh
./start-yarn.sh

<span class="token comment"># 或者</span>
./start-all.sh
</code></pre> 
<p>启动hive</p> 
<pre><code class="prism language-bash">hive
</code></pre> 
<hr> 
<h2><a id="_25"></a>一、爬取数据</h2> 
<h3><a id="11_26"></a>1.1、歌单信息</h3> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> playlist <span class="token punctuation">(</span>
    PlaylistID <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    <span class="token keyword">Type</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Title <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    PlayCount <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Contributor <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># _*_ coding : utf-8 _*_</span>
<span class="token comment"># @Time : 2023/11/15 10:26</span>
<span class="token comment"># @Author : Laptoy</span>
<span class="token comment"># @File : 01_playlist</span>
<span class="token comment"># @Project : finalDesign</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> time
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> pymysql

db_connection <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>
    host<span class="token operator">=</span><span class="token string">"localhost"</span><span class="token punctuation">,</span>
    user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>
    password<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>
    database<span class="token operator">=</span><span class="token string">"music"</span>
<span class="token punctuation">)</span>
cursor <span class="token operator">=</span> db_connection<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'user-agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>

types <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'华语'</span><span class="token punctuation">,</span> <span class="token string">'欧美'</span><span class="token punctuation">,</span> <span class="token string">'日语'</span><span class="token punctuation">,</span> <span class="token string">'韩语'</span><span class="token punctuation">,</span> <span class="token string">'粤语'</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> <span class="token builtin">type</span> <span class="token keyword">in</span> types<span class="token punctuation">:</span>
    <span class="token comment"># 按类型获取歌单</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1295</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        url <span class="token operator">=</span> <span class="token string">'https://music.163.com/discover/playlist/?cat='</span> <span class="token operator">+</span> <span class="token builtin">type</span> <span class="token operator">+</span> <span class="token string">'&amp;order=hot&amp;limit=35&amp;offset='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
        html <span class="token operator">=</span> response<span class="token punctuation">.</span>text
        soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>
        <span class="token comment"># 获取包含歌单详情页网址的标签</span>
        ids <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'.dec a'</span><span class="token punctuation">)</span>
        <span class="token comment"># 获取包含歌单索引页信息的标签</span>
        lis <span class="token operator">=</span> soup<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'#m-pl-container li'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>lis<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'类型'</span><span class="token punctuation">,</span> <span class="token string">'标题'</span><span class="token punctuation">,</span> <span class="token string">'播放量'</span><span class="token punctuation">,</span> <span class="token string">'歌单贡献者'</span><span class="token punctuation">,</span> <span class="token string">'歌单链接'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>lis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 标准歌单类型</span>
            <span class="token builtin">type</span> <span class="token operator">=</span> <span class="token builtin">type</span>
            <span class="token comment"># 获取歌单标题,替换英文分割符</span>
            title <span class="token operator">=</span> ids<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">'，'</span><span class="token punctuation">)</span>
            <span class="token comment"># 获取歌单播放量</span>
            playCount <span class="token operator">=</span> lis<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'.nb'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 获取歌单贡献者名字</span>
            contributor <span class="token operator">=</span> lis<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 输出歌单索引页信息</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">,</span> title<span class="token punctuation">,</span> playCount<span class="token punctuation">,</span> contributor<span class="token punctuation">)</span>

            insert_query <span class="token operator">=</span> <span class="token string">"INSERT INTO playlist (Type, Title, PlayCount, Contributor) VALUES (%s, %s, %s, %s)"</span>
            playlist_data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">,</span> title<span class="token punctuation">,</span> playCount<span class="token punctuation">,</span> contributor<span class="token punctuation">)</span>
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>insert_query<span class="token punctuation">,</span> playlist_data<span class="token punctuation">)</span>
            db_connection<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>

            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span>
cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
db_connection<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/aa/28/Y0dWlNLP_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f3/d9/h1CtLvSp_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/96/96/mslZPfq1_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/fc/1c/pqWoNbla_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h3><a id="1220_104"></a>1.2、每首歌前20条评论</h3> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>comment<span class="token punctuation">`</span></span>  <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>song_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>song_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>comment<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>nickname<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8mb4 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8mb4_unicode_ci ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># _*_ coding : utf-8 _*_</span>
<span class="token comment"># @Time : 2023/11/15 15:09</span>
<span class="token comment"># @Author : Laptoy</span>
<span class="token comment"># @File : ces</span>
<span class="token comment"># @Project : finalDesign</span>
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> AES
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree
<span class="token keyword">from</span> binascii <span class="token keyword">import</span> b2a_base64
<span class="token keyword">import</span> json
<span class="token keyword">import</span> time
<span class="token keyword">import</span> pymysql
<span class="token keyword">from</span> pymysql<span class="token punctuation">.</span>converters <span class="token keyword">import</span> escape_string

headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'user-agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36'</span>
<span class="token punctuation">}</span>
e <span class="token operator">=</span> <span class="token string">'010001'</span>
f <span class="token operator">=</span> <span class="token string">'00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7'</span>

g <span class="token operator">=</span> <span class="token string">'0CoJUm6Qyw8W8jud'</span>
<span class="token comment"># 随机值</span>
i <span class="token operator">=</span> <span class="token string">'vDIsXMJJZqADRVBP'</span>


<span class="token keyword">def</span> <span class="token function">get_163</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 热歌榜URL</span>
    toplist_url <span class="token operator">=</span> <span class="token string">'https://music.163.com/discover/toplist?id=3778678'</span>

    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>toplist_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    html <span class="token operator">=</span> response<span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    html <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>html<span class="token punctuation">)</span>
    namelist <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">"//div[@id='song-list-pre-cache']/ul[@class='f-hide']/li"</span><span class="token punctuation">)</span>
    <span class="token comment"># 可选择保存到文件</span>
    <span class="token comment"># f = open('./wangyi_hotcomments.txt',mode='a',encoding='utf-8')</span>
    <span class="token keyword">for</span> name <span class="token keyword">in</span> namelist<span class="token punctuation">:</span>
        song_name <span class="token operator">=</span> name<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./a/text()'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        song_id <span class="token operator">=</span> name<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./a/@href'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        content <span class="token operator">=</span> get_hotConmments<span class="token punctuation">(</span>song_id<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>song_name<span class="token punctuation">,</span> song_id<span class="token punctuation">)</span>
        save_mysql<span class="token punctuation">(</span>song_id<span class="token punctuation">,</span> song_name<span class="token punctuation">,</span> content<span class="token punctuation">)</span>
        <span class="token comment"># f.writelines(song_id+song_name)</span>
        <span class="token comment"># f.write('\n')</span>
        <span class="token comment"># f.write(str(content))</span>
    <span class="token comment"># f.close()</span>


<span class="token keyword">def</span> <span class="token function">get_encSecKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    encSecKey <span class="token operator">=</span> <span class="token string">"516070c7404b42f34c24ef20b659add657c39e9c52125e9e9f7f5441b4381833a407e5ed302cac5d24beea1c1629b17ccb86e0d9d57f6508db5fb7a6df660089ac57b093d19421d386101676a1c8d1e312e099a3463f81fbe91f28211f9eccccfbfc64148fdd65e2b9f5fcf439a865b95fb656e36f75091957f0a1d39ca8ddd3"</span>
    <span class="token keyword">return</span> encSecKey

<span class="token keyword">def</span> <span class="token function">get_params</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    first <span class="token operator">=</span> enconda_params<span class="token punctuation">(</span>data<span class="token punctuation">,</span> g<span class="token punctuation">)</span>
    second <span class="token operator">=</span> enconda_params<span class="token punctuation">(</span>first<span class="token punctuation">,</span> i<span class="token punctuation">)</span>

    <span class="token keyword">return</span> second


<span class="token comment"># 加密params</span>
<span class="token keyword">def</span> <span class="token function">enconda_params</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    d <span class="token operator">=</span> <span class="token number">16</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">16</span>
    data <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token operator">*</span> d
    data <span class="token operator">=</span> data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    aes <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token operator">=</span>key<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> IV<span class="token operator">=</span><span class="token string">'0102030405060708'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mode<span class="token operator">=</span>AES<span class="token punctuation">.</span>MODE_CBC<span class="token punctuation">)</span>
    bs <span class="token operator">=</span> aes<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token comment"># b64解码</span>
    params <span class="token operator">=</span> b2a_base64<span class="token punctuation">(</span>bs<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token comment"># params = b64decode(bs)</span>
    <span class="token keyword">return</span> params


<span class="token keyword">def</span> <span class="token function">get_hotConmments</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># print(id)</span>
    <span class="token comment"># 提交的信息</span>
    data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'cursor'</span><span class="token punctuation">:</span> <span class="token string">'-1'</span><span class="token punctuation">,</span>
        <span class="token string">'offset'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>
        <span class="token string">'orderType'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
        <span class="token string">'pageNo'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
        <span class="token string">'pageSize'</span><span class="token punctuation">:</span> <span class="token string">'20'</span><span class="token punctuation">,</span>
        <span class="token string">'rid'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'R_SO_4_</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">,</span>
        <span class="token string">'threadId'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'R_SO_4_</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">'</span></span>
    <span class="token punctuation">}</span>
    post_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'params'</span><span class="token punctuation">:</span> get_params<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'encSecKey'</span><span class="token punctuation">:</span> get_encSecKey<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># 获取评论的URL</span>
    song_url <span class="token operator">=</span> <span class="token string">'https://music.163.com/weapi/comment/resource/comments/get?csrf_token=ce10dc34c626dc6aef3e07c86be16d70'</span>

    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>song_url<span class="token punctuation">,</span> data<span class="token operator">=</span>post_data<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    <span class="token comment"># time.sleep(1)</span>
    json_dict <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
    <span class="token comment"># print(json_dict)</span>
    hotcontent <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> content <span class="token keyword">in</span> json_dict<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'hotComments'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        content_text <span class="token operator">=</span> content<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span>
        content_id <span class="token operator">=</span> content<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'nickname'</span><span class="token punctuation">]</span>
        hotcontent<span class="token punctuation">[</span>content_id<span class="token punctuation">]</span> <span class="token operator">=</span> content_text

    <span class="token keyword">return</span> hotcontent


<span class="token comment"># 保存到MySQL数据库</span>
<span class="token keyword">def</span> <span class="token function">save_mysql</span><span class="token punctuation">(</span>song_id<span class="token punctuation">,</span> song_name<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    connect <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>Connect<span class="token punctuation">(</span>
        host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>
        port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>
        user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span>
        passwd<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span>
        db<span class="token operator">=</span><span class="token string">'music'</span><span class="token punctuation">,</span>
        <span class="token comment"># charset='utf8mb4'</span>
    <span class="token punctuation">)</span>
    cursor <span class="token operator">=</span> connect<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># sql = "inster into music_163 velues(%d,'%s','%s','%s')"</span>
    sql <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
        INSERT INTO comment(song_id, song_name, comment,nickname)
        VALUES(%d, '%s', '%s', '%s')
    """</span>
    <span class="token keyword">for</span> nikename <span class="token keyword">in</span> content<span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>song_id<span class="token punctuation">)</span><span class="token punctuation">,</span> escape_string<span class="token punctuation">(</span>song_name<span class="token punctuation">)</span><span class="token punctuation">,</span> escape_string<span class="token punctuation">(</span>content<span class="token punctuation">[</span>nikename<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> escape_string<span class="token punctuation">(</span>nikename<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql <span class="token operator">%</span> data<span class="token punctuation">)</span>
        connect<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    get_163<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/59/2c/euHrBr4k_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h3><a id="13_252"></a>1.3、排行榜</h3> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>chart<span class="token punctuation">`</span></span>  <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>Chart<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Rank<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Title<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Times<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>Singer<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token operator">=</span> utf8 <span class="token keyword">COLLATE</span> <span class="token operator">=</span> utf8_general_ci ROW_FORMAT <span class="token operator">=</span> Dynamic<span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># _*_ coding : utf-8 _*_</span>
<span class="token comment"># @Time : 2023/11/15 14:20</span>
<span class="token comment"># @Author : Laptoy</span>
<span class="token comment"># @File : 02_musicChart</span>
<span class="token comment"># @Project : finalDesign</span>
<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> selenium<span class="token punctuation">.</span>webdriver<span class="token punctuation">.</span>common<span class="token punctuation">.</span>by <span class="token keyword">import</span> By
<span class="token keyword">import</span> pymysql
<span class="token keyword">import</span> time

db_connection <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>
    host<span class="token operator">=</span><span class="token string">"localhost"</span><span class="token punctuation">,</span>
    user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>
    password<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>
    database<span class="token operator">=</span><span class="token string">"music"</span>
<span class="token punctuation">)</span>
cursor <span class="token operator">=</span> db_connection<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span><span class="token punctuation">)</span>
ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'19723756'</span><span class="token punctuation">,</span> <span class="token string">'3779629'</span><span class="token punctuation">,</span> <span class="token string">'2884035'</span><span class="token punctuation">,</span> <span class="token string">'3778678'</span><span class="token punctuation">]</span>
charts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'飙升榜'</span><span class="token punctuation">,</span> <span class="token string">'新歌榜'</span><span class="token punctuation">,</span> <span class="token string">'原创榜'</span><span class="token punctuation">,</span> <span class="token string">'热歌榜'</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> <span class="token builtin">id</span><span class="token punctuation">,</span> chart <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>ids<span class="token punctuation">,</span> charts<span class="token punctuation">)</span><span class="token punctuation">:</span>
    driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://music.163.com/#/discover/toplist?id='</span> <span class="token operator">+</span> <span class="token builtin">id</span><span class="token punctuation">)</span>
    driver<span class="token punctuation">.</span>switch_to<span class="token punctuation">.</span>frame<span class="token punctuation">(</span><span class="token string">'contentFrame'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    divs <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_elements<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">'//*[@class="g-wrap12"]//tr[contains(@id,"1")]'</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> div <span class="token keyword">in</span> divs<span class="token punctuation">:</span>
        <span class="token comment"># 榜单类型</span>
        chart <span class="token operator">=</span> chart
        <span class="token comment"># 标题</span>
        title <span class="token operator">=</span> div<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">'.//div[@class="ttc"]//b'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span>
        <span class="token comment"># 排名</span>
        rank <span class="token operator">=</span> div<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">'.//span[@class="num"]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
        <span class="token comment"># 时长</span>
        times <span class="token operator">=</span> div<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">'.//span[@class="u-dur "]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
        <span class="token comment"># 歌手</span>
        singer <span class="token operator">=</span> div<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span>By<span class="token punctuation">.</span>XPATH<span class="token punctuation">,</span> <span class="token string">'./td/div[@class="text"]/span'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_attribute<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>chart<span class="token punctuation">,</span> title<span class="token punctuation">,</span> rank<span class="token punctuation">,</span> times<span class="token punctuation">,</span> singer<span class="token punctuation">)</span>

        insert_query <span class="token operator">=</span> <span class="token string">"INSERT INTO chart(chart, title, rank, times,singer) VALUES (%s, %s, %s, %s, %s)"</span>
        chart_data <span class="token operator">=</span> <span class="token punctuation">(</span>chart<span class="token punctuation">,</span> title<span class="token punctuation">,</span> rank<span class="token punctuation">,</span> times<span class="token punctuation">,</span> singer<span class="token punctuation">)</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>insert_query<span class="token punctuation">,</span> chart_data<span class="token punctuation">)</span>
        db_connection<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>

        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
cursor<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
db_connection<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h2><a id="_320"></a>二、搭建环境</h2> 
<h3><a id="11JAVA_321"></a>1.1、搭建JAVA</h3> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> /opt/tools
<span class="token function">mkdir</span> /opt/server

<span class="token function">tar</span> <span class="token parameter variable">-zvxf</span> jdk-8u131-linux-x64.tar.gz <span class="token parameter variable">-C</span> /opt/server
</code></pre> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /etc/profile

<span class="token comment"># 文件末尾增加</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/server/jdk1.8.0_131
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">${JAVA_HOME}</span>/bin:<span class="token environment constant">$PATH</span>

<span class="token builtin class-name">source</span> /etc/profile

<span class="token function">java</span> <span class="token parameter variable">-version</span>
</code></pre> 
<p>1、配置免密登录</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /etc/hosts
<span class="token comment"># 文件末尾增加</span>
<span class="token number">192.168</span>.88.110  <span class="token punctuation">[</span>主机名<span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-bash">ssh-keygen <span class="token parameter variable">-t</span> rsa

<span class="token builtin class-name">cd</span> ~/.ssh
<span class="token function">cat</span> id_rsa.pub <span class="token operator">&gt;&gt;</span> authorized_keys
<span class="token function">chmod</span> <span class="token number">600</span> authorized_keys
</code></pre> 
<hr> 
<h3><a id="12hadoop_358"></a>1.2、配置hadoop</h3> 
<pre><code class="prism language-bash"><span class="token function">tar</span> <span class="token parameter variable">-zvxf</span> hadoop-3.1.0.tar.gz <span class="token parameter variable">-C</span> /opt/server/
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># 进入/opt/server/hadoop-3.1.0/etc/hadoop</span>
<span class="token function">vim</span> hadoop-env.sh
<span class="token comment"># 文件添加</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/server/jdk1.8.0_131
</code></pre> 
<p>vim core-site.xml</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--指定 namenode 的 hdfs 协议文件系统的通信地址--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.defaultFS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hdfs://[主机名]:8020<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--指定 hadoop 数据文件存储目录--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>hadoop.tmp.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/home/hadoop/data<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>hdfs-site.xml</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--由于我们这里搭建是单机版本，所以指定 dfs 的副本系数为 1--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>dfs.replication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token function">vim</span> workers
<span class="token comment"># 配置所有从属节点的主机名或 IP 地址，由于是单机版本，所以指定本机即可：</span>
server
</code></pre> 
<p>1、关闭防火墙</p> 
<pre><code class="prism language-bash"><span class="token comment"># 查看防火墙状态</span>
<span class="token function">sudo</span> firewall-cmd <span class="token parameter variable">--state</span>
<span class="token comment"># 关闭防火墙:</span>
<span class="token function">sudo</span> systemctl stop firewalld
<span class="token comment"># 禁止开机启动</span>
<span class="token function">sudo</span> systemctl disable firewalld
</code></pre> 
<p>2、初始化</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /opt/server/hadoop-3.1.0/bin
./hdfs namenode <span class="token parameter variable">-format</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/82/fc/0tA52BKe_o.png" alt="在这里插入图片描述"></p> 
<p>3、配置启动用户</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /opt/server/hadoop-3.1.0/sbin/
<span class="token comment"># 编辑start-dfs.sh、stop-dfs.sh,在顶部加入以下内容</span>
<span class="token comment"># 编辑start-all.sh、stop-all.sh,在顶部加入以下内容</span>
<span class="token assign-left variable">HDFS_DATANODE_USER</span><span class="token operator">=</span>root
<span class="token assign-left variable">HDFS_DATANODE_SECURE_USER</span><span class="token operator">=</span>hdfs
<span class="token assign-left variable">HDFS_NAMENODE_USER</span><span class="token operator">=</span>root
<span class="token assign-left variable">HDFS_SECONDARYNAMENODE_USER</span><span class="token operator">=</span>root
</code></pre> 
<p>4、启动</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /opt/server/hadoop-3.1.0/sbin/
./start-dfs.sh

jps
</code></pre> 
<p><img src="https://images2.imgbox.com/3a/2e/oaLhJfK1_o.png" alt="在这里插入图片描述"><br> 5、访问</p> 
<pre><code class="prism language-bash"><span class="token number">192.168</span>.88.110:9870
</code></pre> 
<p><img src="https://images2.imgbox.com/46/81/XOCRFhie_o.png" alt="在这里插入图片描述"><br> 6、配置环境变量方便启动</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /etc/profile
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span>/opt/server/hadoop-3.1.0
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">${HADOOP_HOME}</span>/bin:<span class="token variable">${HADOOP_HOME}</span>/sbin
<span class="token builtin class-name">source</span> /etc/profile
</code></pre> 
<hr> 
<h3><a id="13HadoopYARN_453"></a>1.3、配置Hadoop环境：YARN</h3> 
<pre><code class="prism language-bash"><span class="token comment"># 进入/opt/server/hadoop-3.1.0/etc/hadoop</span>
<span class="token function">vim</span> mapred-site.xml
</code></pre> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.framework.name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>yarn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.app.mapreduce.am.env<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>HADOOP_MAPRED_HOME=${HADOOP_HOME}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.map.env<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>HADOOP_MAPRED_HOME=${HADOOP_HOME}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.reduce.env<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>HADOOP_MAPRED_HOME=${HADOOP_HOME}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token function">vim</span> yarn-site.xml
</code></pre> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--配置 NodeManager 上运行的附属服务。需要配置成 mapreduce_shuffle 后才可
			以在Yarn 上运行 MapRedvimuce 程序。--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.aux-services<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>mapreduce_shuffle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /opt/server/hadoop-3.1.0/sbin/
<span class="token comment"># start-yarn.sh stop-yarn.sh在两个文件顶部添加以下内容</span>
<span class="token assign-left variable">YARN_RESOURCEMANAGER_USER</span><span class="token operator">=</span>root
<span class="token assign-left variable">HADOOP_SECURE_DN_USER</span><span class="token operator">=</span>yarn
<span class="token assign-left variable">YARN_NODEMANAGER_USER</span><span class="token operator">=</span>root
</code></pre> 
<pre><code class="prism language-bash">./start-yarn.sh
</code></pre> 
<p><img src="https://images2.imgbox.com/a7/d9/GD5Hyh2B_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d4/e6/jUSiRYt2_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h3><a id="14MYSQL_512"></a>1.4、MYSQL</h3> 
<pre><code class="prism language-bash"><span class="token comment"># 用于存放安装包</span>
<span class="token function">mkdir</span> /opt/tools
<span class="token comment"># 用于存放解压后的文件</span>
<span class="token function">mkdir</span> /opt/server
</code></pre> 
<p>卸载Centos7自带mariadb</p> 
<pre><code class="prism language-bash"><span class="token comment"># 查找</span>
<span class="token function">rpm</span> -qa<span class="token operator">|</span><span class="token function">grep</span> mariadb
<span class="token comment"># mariadb-libs-5.5.52-1.el7.x86_64</span>
<span class="token comment"># 卸载</span>
<span class="token function">rpm</span> <span class="token parameter variable">-e</span> mariadb-libs-5.5.52-1.el7.x86_64 <span class="token parameter variable">--nodeps</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># 创建mysql安装包存放点</span>
<span class="token function">mkdir</span> /opt/server/mysql
<span class="token comment"># 解压</span>
<span class="token function">tar</span> xvf mysql-5.7.34-1.el7.x86_64.rpm-bundle.tar <span class="token parameter variable">-C</span> /opt/server/mysql/
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># 安装依赖</span>
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> libaio
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> libncurses*
yum <span class="token parameter variable">-y</span> <span class="token function">install</span> perl perl-devel
<span class="token comment"># 切换到安装目录</span>
<span class="token builtin class-name">cd</span> /opt/server/mysql/
<span class="token comment"># 安装</span>
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> mysql-community-common-5.7.34-1.el7.x86_64.rpm 
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> mysql-community-libs-5.7.34-1.el7.x86_64.rpm 
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> mysql-community-client-5.7.34-1.el7.x86_64.rpm 
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> mysql-community-server-5.7.34-1.el7.x86_64.rpm
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#启动mysql</span>
systemctl start mysqld.service
<span class="token comment">#查看生成的临时root密码</span>
<span class="token function">cat</span> /var/log/mysqld.log <span class="token operator">|</span> <span class="token function">grep</span> password
</code></pre> 
<p><img src="https://images2.imgbox.com/a6/ae/X88TIDWW_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment"># 登录mysql</span>
mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span>
Enter password:     <span class="token comment">#输入在日志中生成的临时密码</span>
<span class="token comment"># 更新root密码 设置为root</span>
<span class="token builtin class-name">set</span> global <span class="token assign-left variable">validate_password_policy</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token builtin class-name">set</span> global <span class="token assign-left variable">validate_password_length</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token builtin class-name">set</span> <span class="token assign-left variable">password</span><span class="token operator">=</span>password<span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-bash">grant all privileges on *.* to <span class="token string">'root'</span> @<span class="token string">'%'</span> identified by <span class="token string">'root'</span><span class="token punctuation">;</span>
<span class="token comment"># 刷新</span>
flush privileges<span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#mysql的启动和关闭 状态查看</span>
systemctl stop mysqld
systemctl status mysqld
systemctl start mysqld
<span class="token comment">#建议设置为开机自启动服务</span>
systemctl <span class="token builtin class-name">enable</span> mysqld
<span class="token comment">#查看是否已经设置自启动成功</span>
systemctl list-unit-files <span class="token operator">|</span> <span class="token function">grep</span> mysqld
</code></pre> 
<hr> 
<h3><a id="15HIVE_589"></a>1.5、HIVE(数据仓库)</h3> 
<pre><code class="prism language-bash"><span class="token comment"># 切换到安装包目录</span>
<span class="token builtin class-name">cd</span> /opt/tools
<span class="token comment"># 解压到/root/server目录</span>
<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> apache-hive-3.1.2-bin.tar.gz <span class="token parameter variable">-C</span> /opt/server/
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># 上传mysql-connector-java-5.1.38.jar到下面目录</span>
<span class="token builtin class-name">cd</span> /opt/server/apache-hive-3.1.2-bin/lib
</code></pre> 
<p>配置文件</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /opt/server/apache-hive-3.1.2-bin/conf
<span class="token function">cp</span> hive-env.sh.template hive-env.sh
<span class="token function">vim</span> hive-env.sh
<span class="token comment"># 加入以下内容</span>
<span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span>/opt/server/hadoop-3.1.0
</code></pre> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /opt/server/apache-hive-3.1.2-bin/conf
<span class="token function">vim</span> hive-site.xml
</code></pre> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0"?&gt;</span>
<span class="token prolog">&lt;?xml-stylesheet type="text/xsl" href="configuration.xsl"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 存储元数据mysql相关配置 /etc/hosts --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionURL<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span> jdbc:mysql://[主机名]:3306/hive?
createDatabaseIfNotExist=true<span class="token entity named-entity" title="&amp;">&amp;amp;</span>useSSL=false<span class="token entity named-entity" title="&amp;">&amp;amp;</span>useUnicode=true<span class="token entity named-entity" title="&amp;">&amp;amp;</span>chara
cterEncoding=UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionDriverName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>com.mysql.jdbc.Driver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionUserName<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>javax.jdo.option.ConnectionPassword<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>初始化表</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /opt/server/apache-hive-3.1.2-bin/bin
./schematool <span class="token parameter variable">-dbType</span> mysql <span class="token parameter variable">-initSchema</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e4/95/GsdLAvvK_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/46/72/DDT8b9ql_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h3><a id="16Sqoop_650"></a>1.6、Sqoop（关系数据库数据迁移）</h3> 
<p>1、拉取sqoop</p> 
<pre><code class="prism language-bash"><span class="token comment"># /opt/tools</span>
<span class="token function">wget</span> https://archive.apache.org/dist/sqoop/1.4.7/sqoop-1.4.7.bin__hadoop-2.6.0.tar.gz

<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> sqoop-1.4.7.bin__hadoop-2.6.0.tar.gz <span class="token parameter variable">-C</span> /opt/server/
</code></pre> 
<p>2、配置</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /opt/server/sqoop-1.4.7.bin__hadoop-2.6.0/conf
<span class="token function">cp</span> sqoop-env-template.sh sqoop-env.sh

<span class="token function">vim</span> sqoop-env.sh
<span class="token comment"># 加入以下内容</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_COMMON_HOME</span><span class="token operator">=</span>/opt/server/hadoop-3.1.0
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_MAPRED_HOME</span><span class="token operator">=</span>/opt/server/hadoop-3.1.0
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HIVE_HOME</span><span class="token operator">=</span>/opt/server/apache-hive-3.1.2-bin
</code></pre> 
<p>3、加入mysql的jdbc驱动包</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /opt/server/sqoop-1.4.7.bin__hadoop-2.6.0/lib
<span class="token comment"># mysql-connector-java-5.1.38.jar</span>
</code></pre> 
<hr> 
<h2><a id="hadoop_676"></a>三、hadoop配置内存</h2> 
<p>修改yarn-site.xml</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Site specific YARN configuration properties --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.aux-services<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>mapreduce_shuffle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.vmem-pmem-ratio<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>重启</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /opt/server/hadoop-3.1.0/sbin
./stop-all.sh
./start-all.sh
</code></pre> 
<hr> 
<h2><a id="hive_702"></a>四、导入数据到hive</h2> 
<p>1、hive创建数据库</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">database</span> music<span class="token punctuation">;</span>
<span class="token keyword">use</span> music<span class="token punctuation">;</span>
</code></pre> 
<p>2、hive创建数据表</p> 
<pre><code class="prism language-sql"><span class="token comment"># -- 将数据当做一列放入表中，后续再使用sql进行分割处理</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> chart_content<span class="token punctuation">(</span>
   content STRING
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> playlist_content <span class="token punctuation">(</span>
   content STRING
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>3、hive加载csv文件进hive表</p> 
<pre><code class="prism language-bash">load data <span class="token builtin class-name">local</span> inpath <span class="token string">'/opt/data/chart.csv'</span> into table chart_content<span class="token punctuation">;</span>
load data <span class="token builtin class-name">local</span> inpath <span class="token string">'/opt/data/playlist.csv'</span> into table playlist<span class="token punctuation">;</span>
</code></pre> 
<p>4、创建表</p> 
<pre><code class="prism language-bash">CREATE TABLE <span class="token variable"><span class="token variable">`</span>chart<span class="token variable">`</span></span>  <span class="token punctuation">(</span>
  <span class="token variable"><span class="token variable">`</span>Chart<span class="token variable">`</span></span> string,
  <span class="token variable"><span class="token variable">`</span>Rank<span class="token variable">`</span></span> string,
  <span class="token variable"><span class="token variable">`</span>Title<span class="token variable">`</span></span> string,
  <span class="token variable"><span class="token variable">`</span>Times<span class="token variable">`</span></span> string,
  <span class="token variable"><span class="token variable">`</span>Singer<span class="token variable">`</span></span> string
<span class="token punctuation">)</span><span class="token punctuation">;</span>

CREATE TABLE <span class="token variable"><span class="token variable">`</span>playlist<span class="token variable">`</span></span>  <span class="token punctuation">(</span>
  <span class="token variable"><span class="token variable">`</span>PlaylistID<span class="token variable">`</span></span> string,
  <span class="token variable"><span class="token variable">`</span>Type<span class="token variable">`</span></span> string,
  <span class="token variable"><span class="token variable">`</span>Title<span class="token variable">`</span></span> string,
  <span class="token variable"><span class="token variable">`</span>PlayCount<span class="token variable">`</span></span> string,
  <span class="token variable"><span class="token variable">`</span>Contributor<span class="token variable">`</span></span> string
<span class="token punctuation">)</span><span class="token punctuation">;</span>

CREATE TABLE playlist <span class="token punctuation">(</span>
   <span class="token variable"><span class="token variable">`</span>PlaylistID<span class="token variable">`</span></span> string,
  <span class="token variable"><span class="token variable">`</span>Type<span class="token variable">`</span></span> string,
  <span class="token variable"><span class="token variable">`</span>Title<span class="token variable">`</span></span> string,
  <span class="token variable"><span class="token variable">`</span>PlayCount<span class="token variable">`</span></span> string,
  <span class="token variable"><span class="token variable">`</span>Contributor<span class="token variable">`</span></span> string
<span class="token punctuation">)</span>
row <span class="token function">format</span> delimited
fields terminated by <span class="token string">','</span><span class="token punctuation">;</span>
</code></pre> 
<p>5、将数据插入表中去掉","</p> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>chart<span class="token punctuation">`</span></span>
<span class="token keyword">SELECT</span>
  split<span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>Chart<span class="token punctuation">`</span></span><span class="token punctuation">,</span>
  split<span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>Rank<span class="token punctuation">`</span></span><span class="token punctuation">,</span>
  split<span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>Title<span class="token punctuation">`</span></span><span class="token punctuation">,</span>
  split<span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>Times<span class="token punctuation">`</span></span><span class="token punctuation">,</span>
  split<span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>Singer<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>chart_content<span class="token punctuation">`</span></span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>playlist<span class="token punctuation">`</span></span>
<span class="token keyword">SELECT</span>
  split<span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>PlaylistID<span class="token punctuation">`</span></span><span class="token punctuation">,</span>
  split<span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>Type<span class="token punctuation">`</span></span><span class="token punctuation">,</span>
  split<span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>Title<span class="token punctuation">`</span></span><span class="token punctuation">,</span>
  split<span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>PlayCount<span class="token punctuation">`</span></span><span class="token punctuation">,</span>
  split<span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token keyword">AS</span> <span class="token identifier"><span class="token punctuation">`</span>Contributor<span class="token punctuation">`</span></span>
<span class="token keyword">FROM</span> <span class="token identifier"><span class="token punctuation">`</span>playlist_content<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a2/a6/PmP4JJsz_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1a/ca/xx4PZVg8_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<pre><code class="prism language-bash">SELECT
  PlaylistID,
  Type,
  Title,
  CAST<span class="token punctuation">(</span>PlayCount AS int<span class="token punctuation">)</span> AS PlayCount,
  Contributor
FROM playlist<span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-bash">SELECT
    REGEXP_REPLACE<span class="token punctuation">(</span>Contributor, <span class="token string">'"'</span>, <span class="token string">''</span><span class="token punctuation">)</span>
FROM playlist<span class="token punctuation">;</span>
</code></pre> 
<h2><a id="sqoop_798"></a>五、sqoop导入数据</h2> 
<pre><code class="prism language-bash">./sqoop <span class="token builtin class-name">export</span>   <span class="token parameter variable">--connect</span> jdbc:mysql://192.168.137.1:3306/lenten   <span class="token parameter variable">--username</span> sqoop   <span class="token parameter variable">--password</span> <span class="token string">'123456'</span>   <span class="token parameter variable">--table</span> singer_count   --export-dir hdfs://server:8020/user/hive/warehouse/charts.db/singer_count   --input-fields-terminated-by <span class="token string">'\001或者,'</span>   --input-lines-terminated-by <span class="token string">'\n'</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aca3afa7b0dd98406fa02ae634777504/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MacOS 文件系统种类及介绍</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3a68d241f348ec6351d5ac95089004ed/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">最新 CentOS7 上使用 yum 安装 MySQL8 超详细教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>