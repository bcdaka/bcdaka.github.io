<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于python机器学习算法的农作物产量可视化分析预测系统（完整系统源码&#43;数据库&#43;详细文档&#43;论文&#43;部署教程） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/b3933fe62fb640c45680cc6ad71ccf78/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="基于python机器学习算法的农作物产量可视化分析预测系统（完整系统源码&#43;数据库&#43;详细文档&#43;论文&#43;部署教程）">
  <meta property="og:description" content="文章目录 基于python机器学习算法的农作物产量可视化分析预测系统一、项目简介二、开发环境三、项目技术四、功能结构五、功能实现模型构建封装类用于网格调参训练模型系统可视化数据请求接口模型评分 0.5*mse 六、系统实现七、总结 基于python机器学习算法的农作物产量可视化分析预测系统 一、项目简介 基于集成学习算法XGBoost农作物产量可视化分析预测系统，旨在帮助农民和相关从业者更好地预测农作物产量，以优化农业生产。该系统主要包括四个功能模块。
首先，农作物数据可视化模块利用Echarts、Ajax、Flask、PyMysql技术实现了可视化展示农作物产量相关数据的功能。
其次，产量预测模块使用pandas、numpy等技术，通过对气象和农作物产量关系数据集的分析和训练，实现了对农作物产量的预测功能。该模块可以对当前或未来某一时间段的农作物产量进行预测，并提供预测结果的可视化展示。
然后，用户登录与用户注册模块使用layui、Flask、PyMysql技术实现了用户登录和注册功能。用户可以通过登录系统后，利用该系统提供的预测和可视化功能，更好地规划和管理自己的农业生产。
最后，数据管理模块使用layui、Flask、PyMysql技术，实现了用户管理、公告管理和农作物数据管理等功能。系统管理员可以通过后台界面对用户信息、公告信息和农作物数据进行管理和维护，保证系统的正常运行和信息安全。
本系统的实现对农业生产的优化具有积极的意义。通过对气象和农作物产量关系数据的分析和训练，该系统可以帮助用户更好地了解不同作物产量随时间变化的趋势和规律，提高农作物的产量和品质，促进农业生产的可持续发展。
二、开发环境 开发环境版本/工具PYTHON3.x开发工具PyCharm2021操作系统Windows 10内存要求16GB浏览器Firefox数据库MySQL 8.0数据库工具Navicat Premium 15项目框架FLASK、layui 三、项目技术 后端：Flask、sklearn、PyMySQL、MySQL、urllib
前端：Jinja2、Jquery、Ajax、layui
四、功能结构 农作物产量大屏数据可视化模块：通过ECharts实现数据可视化，展示农作物产量的趋势、关联因素等。
机器学习预测农作物产量模型构建与训练：使用Scikit-learn、Pandas、NumPy构建机器学习模型，对农作物产量进行预测。
用户登录与注册：通过Flask、PyMySQL、LAYUI实现用户登录和注册功能。
系统后台管理模块：
​ 用户模块：管理用户信息，权限等。
​ 公告模块：发布和管理系统相关公告信息。
​ 农作物数据管理模块：存储和管理与农作物产量预测相关的数据集。
​ 预测可视化后台交互：提供用户与预测数据的交互界面，使用Ajax请求后端数据接口展示数据可视化结果。
系统结构图
五、功能实现 模型构建 def model(X_data,y_label,testst,prediction): &#34;&#34;&#34;模型搭建 &#34;&#34;&#34; global params_xgb #模型参数，设置全局变量便于调参 n_splits = 25 res = [] kf = KFold(n_splits = n_splits, shuffle=True, random_state=520) for i, (train_index, test_index) in enumerate(kf.split(X_data)): print(&#39;第{}次训练...&#39;.format(i&#43;1)) train_data = X_data.iloc[train_index] train_label = y_label.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-06T12:51:01+08:00">
    <meta property="article:modified_time" content="2024-04-06T12:51:01+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于python机器学习算法的农作物产量可视化分析预测系统（完整系统源码&#43;数据库&#43;详细文档&#43;论文&#43;部署教程）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#python_2" rel="nofollow">基于python机器学习算法的农作物产量可视化分析预测系统</a></li><li><ul><li><a href="#_3" rel="nofollow">一、项目简介</a></li><li><a href="#_17" rel="nofollow">二、开发环境</a></li><li><a href="#_32" rel="nofollow">三、项目技术</a></li><li><a href="#_38" rel="nofollow">四、功能结构</a></li><li><a href="#_57" rel="nofollow">五、功能实现</a></li><li><ul><li><a href="#_58" rel="nofollow">模型构建</a></li><li><a href="#_118" rel="nofollow">封装类用于网格调参</a></li><li><a href="#_184" rel="nofollow">训练模型</a></li><li><a href="#_232" rel="nofollow">系统可视化数据请求接口</a></li><li><a href="#_05mse_266" rel="nofollow">模型评分 0.5*mse</a></li></ul> 
   </li><li><a href="#_301" rel="nofollow">六、系统实现</a></li><li><a href="#_358" rel="nofollow">七、总结</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="python_2"></a>基于python机器学习算法的农作物产量可视化分析预测系统</h2> 
<h3><a id="_3"></a>一、项目简介</h3> 
<p>基于集成学习算法XGBoost农作物产量可视化分析预测系统，旨在帮助农民和相关从业者更好地预测农作物产量，以优化农业生产。该系统主要包括四个功能模块。</p> 
<p>首先，农作物数据可视化模块利用Echarts、Ajax、Flask、PyMysql技术实现了可视化展示农作物产量相关数据的功能。</p> 
<p>其次，产量预测模块使用pandas、numpy等技术，通过对气象和农作物产量关系数据集的分析和训练，实现了对农作物产量的预测功能。该模块可以对当前或未来某一时间段的农作物产量进行预测，并提供预测结果的可视化展示。</p> 
<p>然后，用户登录与用户注册模块使用layui、Flask、PyMysql技术实现了用户登录和注册功能。用户可以通过登录系统后，利用该系统提供的预测和可视化功能，更好地规划和管理自己的农业生产。</p> 
<p>最后，数据管理模块使用layui、Flask、PyMysql技术，实现了用户管理、公告管理和农作物数据管理等功能。系统管理员可以通过后台界面对用户信息、公告信息和农作物数据进行管理和维护，保证系统的正常运行和信息安全。</p> 
<p>本系统的实现对农业生产的优化具有积极的意义。通过对气象和农作物产量关系数据的分析和训练，该系统可以帮助用户更好地了解不同作物产量随时间变化的趋势和规律，提高农作物的产量和品质，促进农业生产的可持续发展。</p> 
<h3><a id="_17"></a>二、开发环境</h3> 
<table><thead><tr><th>开发环境</th><th>版本/工具</th></tr></thead><tbody><tr><td>PYTHON</td><td>3.x</td></tr><tr><td>开发工具</td><td>PyCharm2021</td></tr><tr><td>操作系统</td><td>Windows 10</td></tr><tr><td>内存要求</td><td>16GB</td></tr><tr><td>浏览器</td><td>Firefox</td></tr><tr><td>数据库</td><td>MySQL 8.0</td></tr><tr><td>数据库工具</td><td>Navicat Premium 15</td></tr><tr><td>项目框架</td><td>FLASK、layui</td></tr></tbody></table> 
<h3><a id="_32"></a>三、项目技术</h3> 
<p>后端：Flask、sklearn、PyMySQL、MySQL、urllib</p> 
<p>前端：Jinja2、Jquery、Ajax、layui</p> 
<h3><a id="_38"></a>四、功能结构</h3> 
<p>农作物产量大屏数据可视化模块：通过ECharts实现数据可视化，展示农作物产量的趋势、关联因素等。</p> 
<p>机器学习预测农作物产量模型构建与训练：使用Scikit-learn、Pandas、NumPy构建机器学习模型，对农作物产量进行预测。</p> 
<p>用户登录与注册：通过Flask、PyMySQL、LAYUI实现用户登录和注册功能。</p> 
<p>系统后台管理模块：</p> 
<p>​ 用户模块：管理用户信息，权限等。</p> 
<p>​ 公告模块：发布和管理系统相关公告信息。</p> 
<p>​ 农作物数据管理模块：存储和管理与农作物产量预测相关的数据集。</p> 
<p>​ 预测可视化后台交互：提供用户与预测数据的交互界面，使用Ajax请求后端数据接口展示数据可视化结果。<br> 系统结构图<br> <img src="https://images2.imgbox.com/c8/67/R2iS8gUl_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_57"></a>五、功能实现</h3> 
<h4><a id="_58"></a>模型构建</h4> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">model</span><span class="token punctuation">(</span>X_data<span class="token punctuation">,</span>y_label<span class="token punctuation">,</span>testst<span class="token punctuation">,</span>prediction<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""模型搭建
    """</span>
    <span class="token keyword">global</span> params_xgb  <span class="token comment">#模型参数，设置全局变量便于调参</span>
    n_splits <span class="token operator">=</span> <span class="token number">25</span>
    res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    kf <span class="token operator">=</span> KFold<span class="token punctuation">(</span>n_splits <span class="token operator">=</span> n_splits<span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">520</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>train_index<span class="token punctuation">,</span> test_index<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>kf<span class="token punctuation">.</span>split<span class="token punctuation">(</span>X_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'第{}次训练...'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        train_data <span class="token operator">=</span> X_data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>train_index<span class="token punctuation">]</span>
        train_label <span class="token operator">=</span> y_label<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>train_index<span class="token punctuation">]</span>

        valid_data <span class="token operator">=</span> X_data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>test_index<span class="token punctuation">]</span>
        valid_label <span class="token operator">=</span> y_label<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>test_index<span class="token punctuation">]</span>

        xgb_train <span class="token operator">=</span> xgb<span class="token punctuation">.</span>DMatrix<span class="token punctuation">(</span>train_data<span class="token punctuation">,</span> label<span class="token operator">=</span>train_label<span class="token punctuation">)</span>
        xgb_valid <span class="token operator">=</span> xgb<span class="token punctuation">.</span>DMatrix<span class="token punctuation">(</span>valid_data<span class="token punctuation">,</span> valid_label<span class="token punctuation">)</span>
        evallist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>xgb_valid<span class="token punctuation">,</span> <span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>xgb_train<span class="token punctuation">,</span> <span class="token string">'train'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        cgb_model <span class="token operator">=</span> xgb<span class="token punctuation">.</span>train<span class="token punctuation">(</span>params_xgb<span class="token punctuation">,</span> xgb_train<span class="token punctuation">,</span> num_boost_round<span class="token operator">=</span><span class="token number">500</span> <span class="token punctuation">,</span> evals<span class="token operator">=</span>evallist<span class="token punctuation">,</span> verbose_eval<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span> early_stopping_rounds<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span> feval<span class="token operator">=</span>myFeval<span class="token punctuation">)</span>

        valid <span class="token operator">=</span> cgb_model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>xgb_valid<span class="token punctuation">,</span> ntree_limit<span class="token operator">=</span>cgb_model<span class="token punctuation">.</span>best_ntree_limit<span class="token punctuation">)</span>
        valid_score <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>valid_label<span class="token punctuation">,</span>valid<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.5</span>
        <span class="token keyword">if</span> valid_score <span class="token operator">&gt;</span> <span class="token number">0.01</span><span class="token punctuation">:</span>
            <span class="token comment">#验证集分数不好的模型丢弃</span>
            <span class="token keyword">continue</span>
        xgb_test <span class="token operator">=</span> xgb<span class="token punctuation">.</span>DMatrix<span class="token punctuation">(</span>testst<span class="token punctuation">)</span>
        preds <span class="token operator">=</span> cgb_model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>xgb_test<span class="token punctuation">,</span> ntree_limit<span class="token operator">=</span>cgb_model<span class="token punctuation">.</span>best_ntree_limit<span class="token punctuation">)</span>

        res<span class="token punctuation">.</span>append<span class="token punctuation">(</span>preds<span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5f/85/gNRdCrqm_o.png" alt="在这里插入图片描述"></p> 
<p>使用XGBoost（Extreme Gradient Boosting）算法进行回归任务的模型搭建函数。</p> 
<ol><li><strong>参数说明:</strong> 
  <ul><li><code>X_data</code>: 训练数据的特征。</li><li><code>y_label</code>: 训练数据的目标标签。</li><li><code>testst</code>: 测试数据的特征，用于进行预测。</li><li><code>prediction</code>: 预测结果的存储列表。</li></ul> </li><li><strong>交叉验证:</strong> 
  <ul><li>该模型使用了 K 折交叉验证（KFold），将数据集分成训练集和验证集，循环进行训练和验证。这有助于评估模型的性能，并减少由于数据集划分不同而引起的波动。</li></ul> </li><li><strong>XGBoost模型训练:</strong> 
  <ul><li>使用 XGBoost 中的 <code>xgb.train</code> 函数进行模型训练。</li><li>参数 <code>params_xgb</code> 是全局变量，应该在代码其他地方定义，包含了 XGBoost 模型的超参数设置。</li><li>训练中使用了早停法（early stopping），如果在一定迭代次数内验证集分数没有提高，则提前结束训练。</li></ul> </li><li><strong>模型预测:</strong> 
  <ul><li>使用训练好的模型对验证集和测试集进行预测。</li><li>验证集预测结果与真实标签计算均方误差（Mean Squared Error），如果分数大于0.01，则该模型被丢弃。</li><li>如果验证集分数较好，将测试集的预测结果添加到 <code>res</code> 列表中。</li></ul> </li><li><strong>输出信息:</strong> 
  <ul><li>打印每次训练的信息，包括训练次数、验证集分数等。</li></ul> </li></ol> 
<h4><a id="_118"></a>封装类用于网格调参</h4> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">XGBoostre</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""封装类用于网格调参
    """</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>params <span class="token operator">=</span> kwargs
        <span class="token keyword">if</span> <span class="token string">"num_boost_round"</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>params<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>num_boost_round <span class="token operator">=</span> self<span class="token punctuation">.</span>params<span class="token punctuation">[</span><span class="token string">"num_boost_round"</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>params<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'objective'</span><span class="token punctuation">:</span> <span class="token string">'reg:squarederror'</span><span class="token punctuation">,</span><span class="token string">'silent'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token string">'seed'</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">fit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span><span class="token punctuation">:</span>
        xgb_train <span class="token operator">=</span> xgb<span class="token punctuation">.</span>DMatrix<span class="token punctuation">(</span>x_train<span class="token punctuation">,</span> label<span class="token operator">=</span>y_train<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>bst <span class="token operator">=</span> xgb<span class="token punctuation">.</span>train<span class="token punctuation">(</span>params<span class="token operator">=</span>self<span class="token punctuation">.</span>params<span class="token punctuation">,</span> dtrain<span class="token operator">=</span>xgb_train<span class="token punctuation">,</span> num_boost_round<span class="token operator">=</span>self<span class="token punctuation">.</span>num_boost_round<span class="token punctuation">,</span>  verbose_eval<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> feval<span class="token operator">=</span>myFeval<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x_pred<span class="token punctuation">)</span><span class="token punctuation">:</span>
        dpred <span class="token operator">=</span> xgb<span class="token punctuation">.</span>DMatrix<span class="token punctuation">(</span>x_pred<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>bst<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>dpred<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">kfold</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>x_train<span class="token punctuation">,</span>y_train<span class="token punctuation">,</span>n_fold<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        xgb_train <span class="token operator">=</span> xgb<span class="token punctuation">.</span>DMatrix<span class="token punctuation">(</span>x_train<span class="token punctuation">,</span> label<span class="token operator">=</span>y_train<span class="token punctuation">)</span>
        bst_cv <span class="token operator">=</span> xgb<span class="token punctuation">.</span>cv<span class="token punctuation">(</span>params<span class="token operator">=</span>self<span class="token punctuation">.</span>params<span class="token punctuation">,</span> dtrain<span class="token operator">=</span>xgb_train<span class="token punctuation">,</span>feval<span class="token operator">=</span>myFeval<span class="token punctuation">,</span>num_boost_round<span class="token operator">=</span>self<span class="token punctuation">.</span>num_boost_round<span class="token punctuation">,</span> nfold<span class="token operator">=</span>n_fold<span class="token punctuation">,</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> bst_cv<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">plt_feature_importance</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        feat <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>self<span class="token punctuation">.</span>bst<span class="token punctuation">.</span>get_fscore<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        feat<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">"Feature_importance"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_params</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>deep<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>params

    <span class="token keyword">def</span> <span class="token function">set_params</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span><span class="token operator">**</span>params<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>params<span class="token punctuation">.</span>update<span class="token punctuation">(</span>params<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self
</code></pre> 
<p><img src="https://images2.imgbox.com/00/e9/XTIX0yKC_o.png" alt="在这里插入图片描述"></p> 
<ol><li><strong>初始化方法 <code>__init__</code></strong>： 
  <ul><li>这个方法用于初始化<code>XGBoostre</code>类的实例。</li><li>使用<code>**kwargs</code>来接收任意数量的关键字参数，并将这些参数存储在<code>self.params</code>字典中。</li><li>如果<code>"num_boost_round"</code>存在于<code>self.params</code>中，则将其值存储在<code>self.num_boost_round</code>中。</li><li>设置默认的XGBoost参数，包括目标函数为<code>'reg:squarederror'</code>，不进行静默操作（<code>'silent': 0</code>），并设置随机种子为1000。</li></ul> </li><li><strong>fit 方法</strong>： 
  <ul><li>该方法用于训练XGBoost模型。</li><li>将训练数据<code>x_train</code>和<code>y_train</code>转换为<code>xgb.DMatrix</code>格式。</li><li>使用<code>xgb.train</code>函数进行模型训练，并保存训练好的模型为<code>self.bst</code>。</li></ul> </li><li><strong>predict 方法</strong>： 
  <ul><li>该方法用于使用训练好的模型进行预测。</li><li>将待预测数据<code>x_pred</code>转换为<code>xgb.DMatrix</code>格式。</li><li>使用训练好的模型<code>self.bst</code>进行预测，并返回预测结果。</li></ul> </li><li><strong>kfold 方法</strong>： 
  <ul><li>该方法执行K折交叉验证。</li><li>使用<code>xgb.cv</code>函数进行K折交叉验证，并返回交叉验证的结果。</li></ul> </li><li><strong>plt_feature_importance 方法</strong>： 
  <ul><li>该方法用于绘制特征重要性。</li><li>获取模型中特征的重要性得分，并将其排序。</li><li>使用<code>pd.Series.plot</code>方法绘制特征重要性的条形图。</li></ul> </li><li><strong>get_params 方法</strong>： 
  <ul><li>该方法用于获取当前设置的XGBoost参数。</li><li>返回存储在<code>self.params</code>中的参数。</li></ul> </li><li><strong>set_params 方法</strong>： 
  <ul><li>该方法用于更新XGBoost参数。</li><li>使用传入的关键字参数更新<code>self.params</code>字典中的参数，并返回更新后的参数。</li></ul> </li></ol> 
<p>这个<code>XGBoostre</code>类为XGBoost模型提供了一个封装接口，使得用户可以更方便地进行模型训练、预测和评估，同时还可以进行参数调优和特征重要性分析。</p> 
<h4><a id="_184"></a>训练模型</h4> 
<pre><code class="prism language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    deal_loss<span class="token punctuation">(</span><span class="token punctuation">)</span>
    change<span class="token punctuation">(</span><span class="token punctuation">)</span>
    change_week<span class="token punctuation">(</span><span class="token punctuation">)</span>
    params_xgb <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'booster'</span><span class="token punctuation">:</span> <span class="token string">'gbtree'</span><span class="token punctuation">,</span>
        <span class="token string">'objective'</span><span class="token punctuation">:</span> <span class="token string">'reg:squarederror'</span><span class="token punctuation">,</span>
        <span class="token string">'eval_metric'</span><span class="token punctuation">:</span> <span class="token string">'rmse'</span><span class="token punctuation">,</span>  <span class="token comment"># 对于回归问题,默认值是rmse,对于分类问题,默认值是error</span>
        <span class="token string">'gamma'</span><span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>     <span class="token comment">#损失下降多少才分裂</span>
        <span class="token string">'max_depth'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
        <span class="token string">'lambda'</span><span class="token punctuation">:</span> <span class="token number">1.2</span><span class="token punctuation">,</span>    <span class="token comment">#控制模型复杂度的权重值的L2曾泽化参数，参数越大越不容易过拟合</span>
        <span class="token string">'subsample'</span><span class="token punctuation">:</span> <span class="token number">0.9</span><span class="token punctuation">,</span>   <span class="token comment">#随机采样的训练样本</span>
        <span class="token string">'colsample_bytree'</span><span class="token punctuation">:</span> <span class="token number">0.9</span><span class="token punctuation">,</span>    <span class="token comment">#生成树时特征采样比例</span>
        <span class="token string">'min_child_weight'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token comment"># 6</span>
        <span class="token string">'silent'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token comment">#信息输出设置成1则没有信息输出</span>
        <span class="token string">'eta'</span><span class="token punctuation">:</span> <span class="token number">0.12</span><span class="token punctuation">,</span>   <span class="token comment">#类似学习率</span>
        <span class="token string">'seed'</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
        <span class="token string">'nthread'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    X_data<span class="token punctuation">,</span>y_label<span class="token punctuation">,</span>testst<span class="token punctuation">,</span>prediction <span class="token operator">=</span> get_data<span class="token punctuation">(</span><span class="token punctuation">)</span>

    model<span class="token punctuation">(</span>X_data<span class="token punctuation">,</span>y_label<span class="token punctuation">,</span>testst<span class="token punctuation">,</span>prediction<span class="token punctuation">)</span>


    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"result.csv"</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">"gbk"</span><span class="token punctuation">)</span>
    df<span class="token punctuation">[</span><span class="token string">"区县id"</span><span class="token punctuation">]</span> <span class="token operator">=</span>  df<span class="token punctuation">[</span><span class="token string">"columns"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d0/28/GWtXfVGY_o.png" alt="在这里插入图片描述"></p> 
<p>对预测模型进行训练和预测，然后将结果保存到一个 CSV 文件中，并进行后续的数据处理。</p> 
<ol><li><strong>XGBoost模型参数设置:</strong> 
  <ul><li>定义了一个字典 <code>params_xgb</code>，包含了 XGBoost 模型的超参数设置。这些参数控制了模型的结构和训练过程。</li></ul> </li><li><strong>获取数据:</strong> 
  <ul><li>调用 <code>get_data()</code> 函数，但代码中未提供该函数的实现。这个函数用于获取训练数据 (<code>X_data</code>, <code>y_label</code>) 和测试数据 (<code>testst</code>)。</li></ul> </li><li><strong>模型训练:</strong> 
  <ul><li>调用 <code>model</code> 函数，传入训练数据和测试数据，进行模型训练和预测。模型的超参数通过 <code>params_xgb</code> 传递。</li></ul> </li><li><strong>读取CSV文件并进行数据处理:</strong> 
  <ul><li>使用 Pandas (<code>pd</code>) 读取一个 CSV 文件，文件名为 “result.csv”，使用 GBK 编码。</li><li>对 DataFrame 中的 “columns” 列应用 <code>arr</code> 函数，但未提供 <code>arr</code> 函数的实现。</li></ul> </li></ol> 
<h4><a id="_232"></a>系统可视化数据请求接口</h4> 
<p><img src="https://images2.imgbox.com/33/be/tenPBWLF_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">main_page</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    month_rain <span class="token operator">=</span> data_service<span class="token punctuation">.</span>get_month_rain_volume<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ave_wind <span class="token operator">=</span> data_service<span class="token punctuation">.</span>get_ave_wind<span class="token punctuation">(</span><span class="token punctuation">)</span>
    count<span class="token punctuation">,</span> output<span class="token punctuation">,</span> weather <span class="token operator">=</span> data_service<span class="token punctuation">.</span>get_total<span class="token punctuation">(</span><span class="token punctuation">)</span>
    yearly_outputs <span class="token operator">=</span> data_service<span class="token punctuation">.</span>get_yearly_output<span class="token punctuation">(</span><span class="token punctuation">)</span>
    months_temp <span class="token operator">=</span> data_service<span class="token punctuation">.</span>get_months_temp<span class="token punctuation">(</span><span class="token punctuation">)</span>
    times_selling <span class="token operator">=</span> data_service<span class="token punctuation">.</span>get_times_selling<span class="token punctuation">(</span><span class="token punctuation">)</span>
    months_sun <span class="token operator">=</span> data_service<span class="token punctuation">.</span>get_months_sun<span class="token punctuation">(</span><span class="token punctuation">)</span>
    table_list <span class="token operator">=</span> data_service<span class="token punctuation">.</span>get_table_list<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"main.html"</span><span class="token punctuation">,</span> month_rain<span class="token operator">=</span>month_rain<span class="token punctuation">,</span>
                           ave_wind<span class="token operator">=</span>ave_wind<span class="token punctuation">,</span>
                           table_list<span class="token operator">=</span>table_list<span class="token punctuation">,</span>
                           count<span class="token operator">=</span>count<span class="token punctuation">,</span> output<span class="token operator">=</span>output<span class="token punctuation">,</span> weather<span class="token operator">=</span>weather<span class="token punctuation">,</span>
                           yearly_outputs<span class="token operator">=</span>yearly_outputs<span class="token punctuation">,</span> months_temp<span class="token operator">=</span>months_temp<span class="token punctuation">,</span>
                           times_selling<span class="token operator">=</span>times_selling<span class="token punctuation">,</span> months_sun<span class="token operator">=</span>months_sun<span class="token punctuation">)</span>
</code></pre> 
<ol><li><strong>数据获取:</strong> 
  <ul><li><code>month_rain = data_service.get_month_rain_volume()</code>: 获取月降雨量的数据，是通过调用 <code>get_month_rain_volume</code> 函数从 <code>data_service</code> 中获取。</li><li><code>ave_wind = data_service.get_ave_wind()</code>: 获取平均风速的数据，是通过调用 <code>get_ave_wind</code> 函数从 <code>data_service</code> 中获取。</li><li><code>count, output, weather = data_service.get_total()</code>: 获取总数、输出和天气的数据，是通过调用 <code>get_total</code> 函数从 <code>data_service</code> 中获取。</li><li>其他类似的语句用于获取其他数据，如年度产出、月温度、销售次数、月日照时间等。</li></ul> </li><li><strong>HTML 模板渲染:</strong> 
  <ul><li><code>return render_template("main.html", ...)</code>: 使用 Flask 提供的 <code>render_template</code> 函数渲染 HTML 模板。传递了多个变量作为模板中的参数，这些变量包括上面获取的各种数据。</li></ul> </li><li><strong>返回结果:</strong> 
  <ul><li><code>main.html</code> 模板将使用传递的数据进行渲染，然后作为 HTTP 响应返回给用户。</li></ul> </li></ol> 
<h4><a id="_05mse_266"></a>模型评分 0.5*mse</h4> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">myFeval</span><span class="token punctuation">(</span>preds<span class="token punctuation">,</span> xgbtrain<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""模型评分 0.5*mse
    """</span>
    xgbtrain <span class="token operator">=</span> xgbtrain<span class="token punctuation">.</span>get_label<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#将xgboost.core.DMatrix类转化为ndarray类别</span>
    score <span class="token operator">=</span> mean_squared_error<span class="token punctuation">(</span>xgbtrain<span class="token punctuation">,</span>preds<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">0.5</span>
    <span class="token keyword">return</span> <span class="token string">'myFeval'</span><span class="token punctuation">,</span> score
</code></pre> 
<p><img src="https://images2.imgbox.com/54/cd/t3TSbNgq_o.png" alt="在这里插入图片描述"></p> 
<p>自定义评估函数 <code>myFeval</code>，用于在XGBoost模型训练过程中评估模型的性能。</p> 
<ol><li> <p><strong>参数解释:</strong></p> 
  <ul><li><code>preds</code>: 预测的目标变量值。</li><li><code>xgbtrain</code>: XGBoost训练数据，通常是 <code>xgboost.DMatrix</code> 类型。</li></ul> </li><li> <p><strong>函数逻辑:</strong></p> 
  <ul><li> <p><code>xgbtrain = xgbtrain.get_label()</code>: 将 <code>xgbtrain</code> 转换为 <code>ndarray</code> 类型，通过调用 <code>get_label()</code> 方法获取标签。这是将XGBoost的 <code>DMatrix</code> 转换为NumPy数组的操作。</p> </li><li> <p><code>score = mean_squared_error(xgbtrain, preds) * 0.5</code>: 计算均方误差（Mean Squared Error，MSE），然后乘以0.5。这是一个模型评估指标，用于衡量模型预测值与实际标签之间的平方差。将MSE乘以0.5可能是为了得到更合适的评估分数。</p> </li><li> <p><code>return 'myFeval', score</code>: 返回一个元组，包含自定义评估名称 ‘myFeval’ 和计算得到的分数。</p> <p>该评估函数主要用于XGBoost模型训练中，作为 <code>eval_metric</code> 参数的值。这个函数的设计是为了与XGBoost的内置评估函数保持一致，并且使用MSE的一半作为最终评估分数。</p> </li></ul> </li></ol> 
<h3><a id="_301"></a>六、系统实现</h3> 
<p>启动项目</p> 
<p><img src="https://images2.imgbox.com/95/17/67tpot5R_o.png" alt="在这里插入图片描述"></p> 
<p>可视化模块主要实现了对各个地区农业产量的轮播数据展示、对气象变化归路展 示、对气象天气进行分类统计、对日照时间进行统计柱状图分析等功能。实现流程首先 通过浏览器发动 http 请求，Flask 接收到请求后，通过 PyMysql 对数据库进行查询，然 后格式化与分析后响应给前端，前端通过 Echarts 技术在进行可视化解析与渲染，最终 实现可视化效果。</p> 
<p><img src="https://images2.imgbox.com/77/f5/9pC02jVv_o.png" alt="在这里插入图片描述"></p> 
<p>用户模块核心带主要是用户登录时候的校验，这里以用户登录的业务逻辑层代码为</p> 
<p>例，如下图 所示。</p> 
<p><img src="https://images2.imgbox.com/01/7c/CP9n1sM6_o.png" alt="在这里插入图片描述"></p> 
<p>登录页面</p> 
<p><img src="https://images2.imgbox.com/84/f6/vYfoxJKY_o.png" alt="在这里插入图片描述"></p> 
<p>注册页面</p> 
<p><img src="https://images2.imgbox.com/f9/1a/9Ra9bwz6_o.png" alt="在这里插入图片描述"></p> 
<p>后台管理首页</p> 
<p><img src="https://images2.imgbox.com/52/3b/ADfxw36g_o.png" alt="在这里插入图片描述"></p> 
<p>用户管理</p> 
<p><img src="https://images2.imgbox.com/44/e4/wR1uao2Q_o.png" alt="在这里插入图片描述"></p> 
<p>公告管理</p> 
<p><img src="https://images2.imgbox.com/b8/3d/E4oZqqIY_o.png" alt="在这里插入图片描述"></p> 
<p>产量数据管理</p> 
<p><img src="https://images2.imgbox.com/cc/8a/4fXspbxl_o.png" alt="在这里插入图片描述"></p> 
<p>气象数据管理</p> 
<p><img src="https://images2.imgbox.com/5c/fe/lLRxZjcE_o.png" alt="在这里插入图片描述"></p> 
<p>产量预测管理</p> 
<p><img src="https://images2.imgbox.com/b4/bd/xsXUQkR6_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_358"></a>七、总结</h3> 
<p>基于XGBoost的算法分析预测具有许多优势，这些优势使得XGBoost成为许多应用场景的首选算法之一。</p> 
<ol><li><strong>高性能：</strong> 
  <ul><li>XGBoost是一种梯度提升算法，它在性能上表现出色。通过使用并行处理和基于特征的分裂方法，XGBoost能够快速、高效地处理大规模数据集。</li></ul> </li><li><strong>强大的正则化：</strong> 
  <ul><li>XGBoost通过正则化项（如L1和L2正则化）提供了对模型的强大控制，有助于防止过拟合。这使得模型更具泛化能力，可以适用于不同的数据集。</li></ul> </li><li><strong>处理缺失值：</strong> 
  <ul><li>XGBoost能够自动处理缺失值。在实际应用中，数据中的缺失值是常见的问题，而XGBoost能够有效地处理这些情况，而不需要进行额外的数据处理。</li></ul> </li><li><strong>可解释性：</strong> 
  <ul><li>XGBoost具有一定的可解释性，可以输出特征的重要性得分。这对于理解模型对农作物产量预测中哪些特征起到关键作用非常有帮助，从而为农业决策提供支持。</li></ul> </li><li><strong>适用于多种任务：</strong> 
  <ul><li>XGBoost不仅可以用于回归问题（如农作物产量预测），还可以用于分类和排序等任务。这种通用性使得XGBoost在不同类型的问题中都能够展现出色的性能。</li></ul> </li><li><strong>可扩展性：</strong> 
  <ul><li>XGBoost具有良好的可扩展性，可以应对大规模数据和高维特征。它支持分布式计算，可以在分布式环境中运行，提高了处理大规模数据时的效率。</li></ul> </li><li><strong>特征重要性评估：</strong> 
  <ul><li>XGBoost可以输出特征的相对重要性，帮助用户理解模型对输入特征的依赖程度。这对于农作物产量预测系统的可解释性和可理解性非常有价值。</li></ul> </li></ol> 
<p>需要源码项目资料可以扫这个二维码<br> <img src="https://images2.imgbox.com/d6/5c/kdB6SWow_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1abd70ed281e2aa6432ce24fe3e91ef7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【AI ChatDev】你当投资人，让AI帮你在几分钟内完成程序开发</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fcee12f7ffaa476a51411b5a326f03c8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于python豆瓣电影爬虫数据可视化分析推荐系统（完整系统源码&#43;数据库&#43;详细文档&#43;论文&#43;详细部署教程）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>