<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【C&#43;&#43;】使用哈希表封装unordered_map与unordered_set - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/85a530d823d15ef47c6e872c96e7e349/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【C&#43;&#43;】使用哈希表封装unordered_map与unordered_set">
  <meta property="og:description" content="文章目录 1. unordered系列关联式容器1.1 unordered_set1.2 unordered_map 2. unordered_set/map的封装2.1 基本接口2.2 迭代器2.2.1 迭代器的结构2.2.2 set迭代器的封装2.2.3 map迭代器的封装 3.完整代码3.1HashTable3.2unordered_set3.3unordered_map 1. unordered系列关联式容器 在C&#43;&#43;98中，STL提供了底层为红黑树结构的一系列关联式容器，在查询时效率可达到 l o g 2 N log_2 N log2​N，即最差情况下需要比较红黑树的高度次，当树中的节点非常多时，查询效率也不理想。最好的查询是，进行很少的比较次数就能够将元素找到，因此在C&#43;&#43;11中，STL又提供了4个unordered系列的关联式容器，这四个容器与红黑树结构的关联式容器使用方式基本类似，只是其底层结构不同，本文中只对unordered_map和unordered_set进行介绍，
1.1 unordered_set unordered_set是以不特定顺序存储唯一元素的容器，并允许根据其值快速检索单个元素。在unordered_set中，元素的值同时是其键，它唯一地标识它。键是不可变的，因此，unordered_set中的元素在容器中不能被修改，但是它们可以入和删除。在内部，unordered_set中的元素不按任何特定顺序排序，而是根据其哈希值放到桶中，以便直接通过其值快速访问各个元素（平均平均时间复杂度恒定）。unordered_set容器通过其键访问单个元素的速度比set容器更快，尽管它们在通过其元素子集进行范围迭代时通常效率较低。 1.2 unordered_map unordered_map是存储&lt;key, value&gt;键值对的关联式容器，其允许通过key快速的索引到与其对应的value。在unordered_map中，键值通常用于唯一地标识元素，而映射值是一个对象，其内容与此键关联。键和映射值的类型可能不同。在内部，unordered_map没有对&lt;kye, value&gt;按照任何特定的顺序排序, 为了能在常数范围内找到key所对应的value，unordered_map将相同哈希值的键值对放在相同的桶中。unordered_map容器通过key访问单个元素要比map快，但它通常在遍历元素子集的范围迭代方面效率较低。unordered_maps实现了直接访问操作符(operator[])，它允许使用key作为参数直接访问value。 2. unordered_set/map的封装 2.1 基本接口 上一篇文章我们模拟实现了哈希表，在这里我们直接对其进行改造，将其封装为unordered_set/map。
由于我们的unordered_map与unordered_set使用的是一个哈希表，所以我们首先对哈希表的模板参数进行改造。
由于map是k、v模型，set是k，所以在哈希表那一层我们统一处理成T。
在哈希表内部使用key进行比较时，需要使用一个函数获得map与set的key。
所以，在哈希表中所有涉及使用T类型的data计算位置与比较的地方都得改。
unordered_map与unordered_set框架对比
由于一般key都是不允许修改的，所以这里set传递的是const K；map传的是pair&lt;const K,V&gt;
2.2 迭代器 2.2.1 迭代器的结构 对于哈希表而言，迭代器&#43;&#43;应该指向当前桶的下一个元素，当前桶走完了就应该到下一个桶。
那如何弄清下一个桶在什么位置呢？
迭代器内部除了要有一个节点的指针，还应该有一个表的指针，在该表中可以找到桶的位置。
此时编译我们的代码，发现找不到node和table
Node和HashTable找不到是因为我们把它们的定义放在了HTIterator的后面，编译器只会向上找，所以我们可以把Node的定义放在它上面，但是HashTable的定义能放在它上面吗？
由于我们后期会在HashTable中使用HTIterator，它们两个是相互依赖的，谁定义在谁上面都不行。所以我们可以前置声明一下，同时注意声明与定义处的缺省参数不能同时有
operator&#43;&#43; 迭代器&#43;&#43;时，要知道当前桶中还有没有元素，如果有元素，则指向下一个元素；如果没有元素，则指向下一个桶的第一个元素。
由于HtIterator内部要访问哈希表成员_table，但由于哈希表的成员_table是私有的，在外部无法访问。所以我们可将HTIterator设置为HahTable的友元类
Self&amp; operator&#43;&#43;() { if (_node-&gt;_next)//当前桶还有元素 { _node = _node-&gt;_next; } else { KeyOfT kot; Hash hs; size_t hashi = hs(kot(_node-&gt;_data)) % _pt-&gt;_table.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-14T16:59:21+08:00">
    <meta property="article:modified_time" content="2024-08-14T16:59:21+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【C&#43;&#43;】使用哈希表封装unordered_map与unordered_set</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1_unordered_3" rel="nofollow">1. unordered系列关联式容器</a></li><li><ul><li><a href="#11_unordered_set_7" rel="nofollow">1.1 unordered_set</a></li><li><a href="#12_unordered_map_14" rel="nofollow">1.2 unordered_map</a></li></ul> 
  </li><li><a href="#2_unordered_setmap_22" rel="nofollow">2. unordered_set/map的封装</a></li><li><ul><li><a href="#21__23" rel="nofollow">2.1 基本接口</a></li><li><a href="#22__39" rel="nofollow">2.2 迭代器</a></li><li><ul><li><a href="#221__41" rel="nofollow">2.2.1 迭代器的结构</a></li><li><a href="#222_set_127" rel="nofollow">2.2.2 set迭代器的封装</a></li><li><a href="#223_map_161" rel="nofollow">2.2.3 map迭代器的封装</a></li></ul> 
  </li></ul> 
  </li><li><a href="#3_201" rel="nofollow">3.完整代码</a></li><li><ul><li><a href="#31HashTable_203" rel="nofollow">3.1HashTable</a></li><li><a href="#32unordered_set_494" rel="nofollow">3.2unordered_set</a></li><li><a href="#33unordered_map_552" rel="nofollow">3.3unordered_map</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p><img src="https://images2.imgbox.com/5a/db/zC9E3QaS_o.gif" alt="在这里插入图片描述"></p> 
<h2><a id="1_unordered_3"></a>1. unordered系列关联式容器</h2> 
<blockquote> 
 <p>在C++98中，STL提供了底层为红黑树结构的一系列关联式容器，在查询时效率可达到<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          l 
         
        
          o 
         
         
         
           g 
          
         
           2 
          
         
        
          N 
         
        
       
         log_2 N 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right: 0.109em;">N</span></span></span></span></span>，即最差情况下需要比较红黑树的高度次，当树中的节点非常多时，查询效率也不理想。最好的查询是，进行很少的比较次数就能够将元素找到，因此在C++11中，STL又提供了4个unordered系列的关联式容器，这四个容器与红黑树结构的关联式容器使用方式基本类似，只是其底层结构不同，本文中只对unordered_map和unordered_set进行介绍，</p> 
</blockquote> 
<h3><a id="11_unordered_set_7"></a>1.1 unordered_set</h3> 
<ol><li>unordered_set是以不特定顺序存储唯一元素的容器，并允许根据其值快速检索单个元素。</li><li>在unordered_set中，<mark>元素的值同时是其键，它唯一地标识它</mark>。<strong>键是不可变的</strong>，因此，unordered_set中的元素在容器中不能被修改，但是它们可以入和删除。</li><li>在内部，unordered_set中的<strong>元素不按任何特定顺序排序</strong>，而是<strong>根据其哈希值放到桶中</strong>，以便直接通过其值快速访问各个元素（平均平均时间复杂度恒定）。</li><li>unordered_set容器通过其键访问单个元素的速度比set容器更快，尽管它们在通过其元素子集进行范围迭代时通常效率较低。</li></ol> 
<h3><a id="12_unordered_map_14"></a>1.2 unordered_map</h3> 
<ol><li>unordered_map是存储&lt;key, value&gt;键值对的关联式容器，其允许通过key快速的索引到与其对应的value。</li><li>在unordered_map中，<mark>键值通常用于唯一地标识元素，而映射值是一个对象，其内容与此键关联</mark>。键和映射值的类型可能不同。</li><li>在内部，unordered_map<strong>没有对&lt;kye, value&gt;按照任何特定的顺序排序</strong>, 为了能在常数范围内找到key所对应的value，unordered_map将相同哈希值的键值对放在相同的桶中。</li><li>unordered_map容器通过key访问单个元素要比map快，但它通常在遍历元素子集的范围迭代方面效率较低。</li><li>unordered_maps实现了直接访问操作符(operator[])，它允许使用key作为参数直接访问value。</li></ol> 
<h2><a id="2_unordered_setmap_22"></a>2. unordered_set/map的封装</h2> 
<h3><a id="21__23"></a>2.1 基本接口</h3> 
<p>上一篇文章我们模拟实现了哈希表，在这里我们直接对其进行改造，将其封装为unordered_set/map。</p> 
<p>由于我们的unordered_map与unordered_set使用的是一个哈希表，所以我们首先对哈希表的模板参数进行改造。<br> 由于map是k、v模型，set是k，所以在哈希表那一层我们统一处理成T。<br> <img src="https://images2.imgbox.com/7e/31/iwDOl0rm_o.png" alt="在这里插入图片描述"></p> 
<p>在哈希表内部使用key进行比较时，需要使用一个函数获得map与set的key。</p> 
<p>所以，在哈希表中<mark>所有涉及使用T类型的data计算位置与比较的地方</mark>都得改。<br> <img src="https://images2.imgbox.com/07/08/j6lzzkK8_o.png" alt="在这里插入图片描述"></p> 
<p><mark>unordered_map与unordered_set框架对比</mark><br> 由于一般key都是不允许修改的，所以<code>这里set传递的是const K；map传的是pair&lt;const K,V&gt;</code><br> <img src="https://images2.imgbox.com/fc/db/UhBj6w0N_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="22__39"></a>2.2 迭代器</h3> 
<h4><a id="221__41"></a>2.2.1 迭代器的结构</h4> 
<p>对于哈希表而言，迭代器++应该指向当前桶的下一个元素，当前桶走完了就应该到下一个桶。<br> 那如何弄清下一个桶在什么位置呢？<br> <mark>迭代器内部除了要有一个节点的指针，还应该有一个表的指针，在该表中可以找到桶的位置</mark>。<br> <img src="https://images2.imgbox.com/09/62/1g7zYSbo_o.png" alt="在这里插入图片描述"></p> 
<p>此时编译我们的代码，发现找不到node和table</p> 
<p><img src="https://images2.imgbox.com/7c/4c/Aj1RtVxA_o.png" alt="在这里插入图片描述"></p> 
<p>Node和HashTable找不到是因为我们把它们的定义放在了HTIterator的后面，编译器只会向上找，所以我们可以把Node的定义放在它上面，但是HashTable的定义能放在它上面吗？</p> 
<p>由于我们后期会在HashTable中使用HTIterator，它们两个是相互依赖的，谁定义在谁上面都不行。所以<mark>我们可以前置声明一下，同时注意声明与定义处的缺省参数不能同时有</mark></p> 
<p><img src="https://images2.imgbox.com/70/7e/DpTPKHcq_o.png" alt="在这里插入图片描述"></p> 
<ol><li>operator++</li></ol> 
<p>迭代器++时，要知道当前桶中还有没有元素，如果有元素，则指向下一个元素；如果没有元素，则指向下一个桶的第一个元素。</p> 
<p>由于HtIterator内部要访问哈希表成员_table，但由于哈希表的成员_table是私有的，在外部无法访问。所以我们<mark>可将HTIterator设置为HahTable的友元类</mark><br> <img src="https://images2.imgbox.com/91/e2/hrnmuiF4_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-cpp">Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>_node<span class="token operator">-&gt;</span>_next<span class="token punctuation">)</span><span class="token comment">//当前桶还有元素</span>
			<span class="token punctuation">{<!-- --></span>
				_node <span class="token operator">=</span> _node<span class="token operator">-&gt;</span>_next<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				KeyOfT kot<span class="token punctuation">;</span>
				Hash hs<span class="token punctuation">;</span>
				size_t hashi <span class="token operator">=</span> <span class="token function">hs</span><span class="token punctuation">(</span><span class="token function">kot</span><span class="token punctuation">(</span>_node<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> _pt<span class="token operator">-&gt;</span>_table<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				hashi<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//指向下一个桶</span>

				<span class="token keyword">while</span> <span class="token punctuation">(</span>hashi <span class="token operator">&lt;</span> _pt<span class="token operator">-&gt;</span>_table<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>_pt<span class="token operator">-&gt;</span>_table<span class="token punctuation">[</span>hashi<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">//“下一个”桶有元素</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span>
					<span class="token punctuation">{<!-- --></span>
						hashi<span class="token operator">++</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>

				<span class="token keyword">if</span> <span class="token punctuation">(</span>hashi <span class="token operator">==</span> _pt<span class="token operator">-&gt;</span>_table<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//若后面没有桶了</span>
				<span class="token punctuation">{<!-- --></span>
					_node <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>  <span class="token comment">//end()</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					_node <span class="token operator">=</span> _pt<span class="token operator">-&gt;</span>_table<span class="token punctuation">[</span>hashi<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>-&gt; 、*、!=</li></ol> 
<pre><code class="prism language-cpp">		T<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _node<span class="token operator">-&gt;</span>_data<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		T<span class="token operator">*</span> <span class="token keyword">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token operator">&amp;</span>_node<span class="token operator">-&gt;</span>_data<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">bool</span> <span class="token keyword">operator</span> <span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Self<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_node <span class="token operator">!=</span> s<span class="token punctuation">.</span>_node<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="222_set_127"></a>2.2.2 set迭代器的封装</h4> 
<ol><li>普通迭代器</li></ol> 
<p>先在哈希表内部封装迭代器</p> 
<p><img src="https://images2.imgbox.com/4a/27/NsILruyL_o.png" alt="在这里插入图片描述"></p> 
<p>再封装set的迭代器</p> 
<p><img src="https://images2.imgbox.com/88/55/ma7iTdpf_o.png" alt="在这里插入图片描述"></p> 
<p>此时我们set的迭代器就可以跑起来了</p> 
<p><img src="https://images2.imgbox.com/c1/ec/UYYLZ0V7_o.png" alt="在这里插入图片描述"><br> 由于我们对模板参数进行传递时，K都使用了const修饰，所以key是不允许修改的。<br> <img src="https://images2.imgbox.com/aa/c2/6fjZFBOC_o.png" alt="在这里插入图片描述"><br> 2. const迭代器</p> 
<p>首先我们要明白，const迭代器是不允许修改的，无论是K还是V。所以我们只需对迭代器的 -&gt; 与 * 操作做修改即可。</p> 
<p>所以我们要给底层迭代器增加两个模板参数，使用普通迭代器时可以对V进行修改；使用const迭代器不允许修改V。</p> 
<p><img src="https://images2.imgbox.com/0e/da/PW4IdQaI_o.png" alt="在这里插入图片描述"><br> 哈希表中的const迭代器</p> 
<p><img src="https://images2.imgbox.com/fd/22/QCwcF1fU_o.png" alt="在这里插入图片描述"></p> 
<p>set的const迭代器</p> 
<p><img src="https://images2.imgbox.com/20/2b/nbNLtqBK_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="223_map_161"></a>2.2.3 map迭代器的封装</h4> 
<p>由于我们已经实现了set，所有哈希表内迭代器的坑已经被我们跳过了，这里我们只需简单的封装map即可。</p> 
<ol><li>普通迭代器</li></ol> 
<p><img src="https://images2.imgbox.com/d5/51/45Gxieum_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/ad/20/5TP3KxvM_o.png" alt="在这里插入图片描述"></p> 
<ol start="2"><li>const迭代器</li></ol> 
<p><img src="https://images2.imgbox.com/58/fa/UlGxjXOt_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/6d/71/BhmMbTLk_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li>operator[ ]</li></ol> 
<p>对于map[key]而言，如果key已经存在，则插入失败，并且返回key所对应位置的迭代器。如果key不存在，则将key插入，value为类型的默认值，并返回其迭代器。</p> 
<p>所以我们要改造find、insert函数，使其返回一个pair&lt;iterator,bool&gt;<br> <img src="https://images2.imgbox.com/53/2b/LhMlZgkD_o.png" alt="在这里插入图片描述"></p> 
<p>map中operator的实现以及find和insert的更改</p> 
<p><img src="https://images2.imgbox.com/72/73/XY7HP3GU_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/9d/de/IDQzE24T_o.png" alt="在这里插入图片描述"></p> 
<p>由于哈希表中的find与insert已经更改，所以我们set中的也得改</p> 
<p><img src="https://images2.imgbox.com/21/62/nBFalxhO_o.png" alt="在这里插入图片描述"></p> 
<p>更改后的find与insert要这样使用：</p> 
<p><img src="https://images2.imgbox.com/d5/f6/2lhZOjok_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3_201"></a>3.完整代码</h2> 
<h3><a id="31HashTable_203"></a>3.1HashTable</h3> 
<pre><code class="prism language-cpp"><span class="token comment">//原模板</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">HashFunc</span>
<span class="token punctuation">{<!-- --></span>
	size_t <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> key<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//特化</span>
<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">HashFunc</span><span class="token operator">&lt;</span>string<span class="token operator">&gt;</span>
<span class="token punctuation">{<!-- --></span>
	size_t <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> string<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		size_t sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> e <span class="token operator">:</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			sum <span class="token operator">*=</span> <span class="token number">31</span><span class="token punctuation">;</span><span class="token comment">//这里使用了直接地址法，避免字符串的key计算后相同</span>
			sum <span class="token operator">+=</span> e<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> sum<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> hash_bucket
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
	<span class="token keyword">struct</span> <span class="token class-name">HashNode</span><span class="token comment">//节点</span>
	<span class="token punctuation">{<!-- --></span>
		T _data<span class="token punctuation">;</span><span class="token comment">//数据域</span>
		HashNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> _next<span class="token punctuation">;</span><span class="token comment">//指针域</span>

		<span class="token function">HashNode</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> data<span class="token punctuation">)</span>
			<span class="token operator">:</span><span class="token function">_data</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
			<span class="token punctuation">,</span> <span class="token function">_next</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">//前置声明</span>
	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KeyOfT</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Hash</span> <span class="token operator">=</span> HashFunc<span class="token operator">&lt;</span>K<span class="token operator">&gt;&gt;</span>
	<span class="token keyword">class</span> <span class="token class-name">HashTable</span><span class="token punctuation">;</span>

	<span class="token comment">//迭代器</span>
	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Ref</span><span class="token punctuation">,</span><span class="token keyword">class</span> <span class="token class-name">Ptr</span><span class="token punctuation">,</span><span class="token keyword">class</span> <span class="token class-name">KeyOfT</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Hash</span> <span class="token operator">=</span> HashFunc<span class="token operator">&lt;</span>K<span class="token operator">&gt;&gt;</span>
	<span class="token keyword">struct</span> <span class="token class-name">HTIterator</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">typedef</span> HTIterator<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> T<span class="token punctuation">,</span>Ref<span class="token punctuation">,</span>Ptr<span class="token punctuation">,</span> KeyOfT<span class="token punctuation">,</span> Hash<span class="token operator">&gt;</span> Self<span class="token punctuation">;</span><span class="token comment">//重命名</span>
		<span class="token keyword">typedef</span> HashNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>

		HashNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> _node<span class="token punctuation">;</span><span class="token comment">//指向节点的指针</span>
		<span class="token keyword">const</span> HashTable<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> T<span class="token punctuation">,</span> KeyOfT<span class="token punctuation">,</span> Hash<span class="token operator">&gt;</span><span class="token operator">*</span> _pt<span class="token punctuation">;</span><span class="token comment">//哈希表指针</span>

		<span class="token function">HTIterator</span><span class="token punctuation">(</span> Node<span class="token operator">*</span> node<span class="token punctuation">,</span> <span class="token keyword">const</span> HashTable<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>T<span class="token punctuation">,</span>KeyOfT<span class="token punctuation">,</span>Hash<span class="token operator">&gt;</span><span class="token operator">*</span> table<span class="token punctuation">)</span>
			<span class="token operator">:</span><span class="token function">_node</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
			<span class="token punctuation">,</span><span class="token function">_pt</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

		Ref <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _node<span class="token operator">-&gt;</span>_data<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		Ptr <span class="token keyword">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token operator">&amp;</span>_node<span class="token operator">-&gt;</span>_data<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		Self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>_node<span class="token operator">-&gt;</span>_next<span class="token punctuation">)</span><span class="token comment">//当前桶还有元素</span>
			<span class="token punctuation">{<!-- --></span>
				_node <span class="token operator">=</span> _node<span class="token operator">-&gt;</span>_next<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				KeyOfT kot<span class="token punctuation">;</span>
				Hash hs<span class="token punctuation">;</span>
				size_t hashi <span class="token operator">=</span> <span class="token function">hs</span><span class="token punctuation">(</span><span class="token function">kot</span><span class="token punctuation">(</span>_node<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> _pt<span class="token operator">-&gt;</span>_table<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				hashi<span class="token operator">++</span><span class="token punctuation">;</span><span class="token comment">//指向下一个桶</span>

				<span class="token keyword">while</span> <span class="token punctuation">(</span>hashi <span class="token operator">&lt;</span> _pt<span class="token operator">-&gt;</span>_table<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>_pt<span class="token operator">-&gt;</span>_table<span class="token punctuation">[</span>hashi<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">//“下一个”桶有元素</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span>
					<span class="token punctuation">{<!-- --></span>
						hashi<span class="token operator">++</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>

				<span class="token keyword">if</span> <span class="token punctuation">(</span>hashi <span class="token operator">==</span> _pt<span class="token operator">-&gt;</span>_table<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//若后面没有桶了</span>
				<span class="token punctuation">{<!-- --></span>
					_node <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>  <span class="token comment">//end()</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					_node <span class="token operator">=</span> _pt<span class="token operator">-&gt;</span>_table<span class="token punctuation">[</span>hashi<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>


		<span class="token keyword">bool</span> <span class="token keyword">operator</span> <span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> Self<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _node <span class="token operator">!=</span> s<span class="token punctuation">.</span>_node<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token comment">//哈希表</span>
	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token keyword">class</span> <span class="token class-name">KeyOfT</span><span class="token punctuation">,</span><span class="token keyword">class</span> <span class="token class-name">Hash</span><span class="token operator">&gt;</span>
	<span class="token keyword">class</span> <span class="token class-name">HashTable</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token keyword">class</span> <span class="token class-name">Ref</span><span class="token punctuation">,</span><span class="token keyword">class</span> <span class="token class-name">Ptr</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KeyOfT</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Hash</span><span class="token operator">&gt;</span>
		<span class="token keyword">friend</span> <span class="token keyword">struct</span> <span class="token class-name">HTIterator</span><span class="token punctuation">;</span>

		<span class="token keyword">typedef</span> HashNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
		
	<span class="token keyword">public</span><span class="token operator">:</span>
		<span class="token keyword">typedef</span> HTIterator<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> T<span class="token punctuation">,</span>T<span class="token operator">&amp;</span><span class="token punctuation">,</span>T<span class="token operator">*</span><span class="token punctuation">,</span> KeyOfT<span class="token punctuation">,</span> Hash<span class="token operator">&gt;</span> Iterator<span class="token punctuation">;</span><span class="token comment">//普通迭代器</span>
		<span class="token keyword">typedef</span> HTIterator<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> T<span class="token punctuation">,</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span><span class="token keyword">const</span> T<span class="token operator">*</span><span class="token punctuation">,</span> KeyOfT<span class="token punctuation">,</span> Hash<span class="token operator">&gt;</span> ConstIterator<span class="token punctuation">;</span><span class="token comment">//const迭代器</span>

		Iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>_n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//没有元素</span>
				<span class="token keyword">return</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _table<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>_table<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">//找到第一个桶</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token keyword">return</span> <span class="token function">Iterator</span><span class="token punctuation">(</span>_table<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//使用当前节点和桶构造一个迭代器返回</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token punctuation">}</span>
		Iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token function">Iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		ConstIterator <span class="token function">cbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> 
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>_n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//没有元素</span>
				<span class="token keyword">return</span> <span class="token function">cend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _table<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>_table<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment">//找到第一个桶</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token keyword">return</span> <span class="token function">ConstIterator</span><span class="token punctuation">(</span>_table<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//使用当前节点和桶构造一个迭代器返回</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token function">cend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		ConstIterator <span class="token function">cend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token function">ConstIterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token function">HashTable</span><span class="token punctuation">(</span>size_t N <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_table<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token operator">~</span><span class="token function">HashTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _table<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Node<span class="token operator">*</span> cur <span class="token operator">=</span> _table<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					Node<span class="token operator">*</span> next <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_next<span class="token punctuation">;</span>
					<span class="token keyword">delete</span> cur<span class="token punctuation">;</span>
					cur <span class="token operator">=</span> next<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				_table<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		pair<span class="token operator">&lt;</span>Iterator<span class="token punctuation">,</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> data<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Hash hs<span class="token punctuation">;</span>
			KeyOfT kot<span class="token punctuation">;</span>
			Iterator it <span class="token operator">=</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token function">kot</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//如果已经存在</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span> it<span class="token operator">!=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			size_t size <span class="token operator">=</span> _table<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//检查扩容</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>_n <span class="token operator">==</span> size<span class="token punctuation">)</span><span class="token comment">//节点个数等于桶的数量时，进行扩容</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token comment">//为了节省开销，不再重新开辟新节点，直接映射原来的节点，将原来的映射取消</span>
				vector<span class="token operator">&lt;</span>Node<span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token function">newtable</span><span class="token punctuation">(</span>size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				size_t newsize <span class="token operator">=</span> newtable<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span>size_t i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					Node<span class="token operator">*</span> cur <span class="token operator">=</span> _table<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
					<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
					<span class="token punctuation">{<!-- --></span>
						size_t hashi <span class="token operator">=</span> <span class="token function">hs</span><span class="token punctuation">(</span><span class="token function">kot</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> newsize<span class="token punctuation">;</span><span class="token comment">//元素对应的新表中的位置</span>

						Node<span class="token operator">*</span> next <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_next<span class="token punctuation">;</span><span class="token comment">//记录当前桶的下一个元素</span>

						<span class="token comment">//头插连接到新桶</span>
						cur<span class="token operator">-&gt;</span>_next <span class="token operator">=</span> newtable<span class="token punctuation">[</span>hashi<span class="token punctuation">]</span><span class="token punctuation">;</span>
						newtable<span class="token punctuation">[</span>hashi<span class="token punctuation">]</span> <span class="token operator">=</span> cur<span class="token punctuation">;</span>

						cur <span class="token operator">=</span> next<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					_table<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token function">swap</span><span class="token punctuation">(</span>_table<span class="token punctuation">,</span> newtable<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			size_t hashi <span class="token operator">=</span> <span class="token function">hs</span><span class="token punctuation">(</span><span class="token function">kot</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> _table<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">//头插连接</span>
			Node<span class="token operator">*</span> newnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
			newnode<span class="token operator">-&gt;</span>_next <span class="token operator">=</span> _table<span class="token punctuation">[</span>hashi<span class="token punctuation">]</span><span class="token punctuation">;</span>
			_table<span class="token punctuation">[</span>hashi<span class="token punctuation">]</span> <span class="token operator">=</span> newnode<span class="token punctuation">;</span>
			<span class="token operator">++</span>_n<span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token function">Iterator</span><span class="token punctuation">(</span>newnode<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		Iterator <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Hash hs<span class="token punctuation">;</span>
			KeyOfT kot<span class="token punctuation">;</span>
			size_t hashi <span class="token operator">=</span> <span class="token function">hs</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">%</span> _table<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _table<span class="token punctuation">[</span>hashi<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">kot</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span> <span class="token operator">==</span> key<span class="token punctuation">)</span>
					<span class="token keyword">return</span> <span class="token function">Iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_next<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">bool</span> <span class="token function">erase</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Hash hs<span class="token punctuation">;</span>
			KeyOfT kot<span class="token punctuation">;</span>
			size_t hashi <span class="token operator">=</span> <span class="token function">hs</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">%</span> _table<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _table<span class="token punctuation">[</span>hashi<span class="token punctuation">]</span><span class="token punctuation">;</span>
			Node<span class="token operator">*</span> prev <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">kot</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span> <span class="token operator">==</span> key<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>prev <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token comment">//桶中只有一个元素</span>
					<span class="token punctuation">{<!-- --></span>
						_table<span class="token punctuation">[</span>hashi<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span>
					<span class="token punctuation">{<!-- --></span>
						prev<span class="token operator">-&gt;</span>_next <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_next<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">delete</span> cur<span class="token punctuation">;</span>
					_n<span class="token operator">--</span><span class="token punctuation">;</span>
					<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					prev <span class="token operator">=</span> cur<span class="token punctuation">;</span>
					cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_next<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token keyword">private</span><span class="token operator">:</span>
		vector<span class="token operator">&lt;</span>Node<span class="token operator">*</span><span class="token operator">&gt;</span> _table<span class="token punctuation">;</span>
		size_t _n<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="32unordered_set_494"></a>3.2unordered_set</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">namespace</span> my
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span><span class="token keyword">class</span> <span class="token class-name">Hash</span> <span class="token operator">=</span> HashFunc<span class="token operator">&lt;</span>K<span class="token operator">&gt;&gt;</span>
	<span class="token keyword">class</span> <span class="token class-name">unordered_set</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">struct</span> <span class="token class-name">SetKeyOfT</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">const</span> K<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> key<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span><span class="token operator">:</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">hash_bucket</span><span class="token double-colon punctuation">::</span>HashTable<span class="token operator">&lt;</span>K<span class="token punctuation">,</span><span class="token keyword">const</span> K<span class="token punctuation">,</span>SetKeyOfT<span class="token punctuation">,</span> Hash<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>Iterator iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">hash_bucket</span><span class="token double-colon punctuation">::</span>HashTable<span class="token operator">&lt;</span>K<span class="token punctuation">,</span><span class="token keyword">const</span> K<span class="token punctuation">,</span>SetKeyOfT<span class="token punctuation">,</span> Hash<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>ConstIterator const_iterator<span class="token punctuation">;</span>
		const_iterator <span class="token function">cbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _ht<span class="token punctuation">.</span><span class="token function">cbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_iterator <span class="token function">cend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _ht<span class="token punctuation">.</span><span class="token function">cend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _ht<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _ht<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _ht<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _ht<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">bool</span> <span class="token function">erase</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _ht<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token keyword">private</span><span class="token operator">:</span>
		hash_bucket<span class="token double-colon punctuation">::</span>HashTable<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> <span class="token keyword">const</span> K<span class="token punctuation">,</span>SetKeyOfT<span class="token punctuation">,</span> Hash<span class="token operator">&gt;</span>  _ht<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="33unordered_map_552"></a>3.3unordered_map</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">namespace</span> my
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token punctuation">,</span><span class="token keyword">class</span> <span class="token class-name">Hash</span> <span class="token operator">=</span> HashFunc<span class="token operator">&lt;</span>K<span class="token operator">&gt;&gt;</span>
	<span class="token keyword">class</span> <span class="token class-name">unordered_map</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">struct</span> <span class="token class-name">MapKeyOfT</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">const</span> K<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span> K<span class="token punctuation">,</span>V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span><span class="token operator">:</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">hash_bucket</span><span class="token double-colon punctuation">::</span>HashTable<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span>V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapKeyOfT<span class="token punctuation">,</span> Hash<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>Iterator iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">hash_bucket</span><span class="token double-colon punctuation">::</span>HashTable<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span>V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapKeyOfT<span class="token punctuation">,</span> Hash<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>ConstIterator const_iterator<span class="token punctuation">;</span>
		
		const_iterator <span class="token function">cbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _ht<span class="token punctuation">.</span><span class="token function">cbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_iterator <span class="token function">cend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _ht<span class="token punctuation">.</span><span class="token function">cend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _ht<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _ht<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		V<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> ret <span class="token operator">=</span> _ht<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token function">make_pair</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token function">V</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//将其对应的值返回</span>
			<span class="token comment">//如果插入前已经存在，则返回其值；否则则返回一个V()</span>
			<span class="token keyword">return</span> ret<span class="token punctuation">.</span>first<span class="token operator">-&gt;</span>second<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span>V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _ht<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _ht<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">bool</span> <span class="token function">erase</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _ht<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token keyword">private</span><span class="token operator">:</span>
		hash_bucket<span class="token double-colon punctuation">::</span>HashTable<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span>V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapKeyOfT<span class="token punctuation">,</span> Hash<span class="token operator">&gt;</span>  _ht<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e80b9c4261a45adc36e418ea68ec8498/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【现代通信技术】第四章 电路交换技术</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/70fa692d6692121df16c5f71f17e4528/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python从入门到精通：基础语法讲解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>