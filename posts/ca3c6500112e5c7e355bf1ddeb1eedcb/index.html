<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Nginx企业级负载均衡：技术详解系列（12）—— 深入解析root、alias及location - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/ca3c6500112e5c7e355bf1ddeb1eedcb/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Nginx企业级负载均衡：技术详解系列（12）—— 深入解析root、alias及location">
  <meta property="og:description" content="你好，我是赵兴晨，97年文科程序员。
在生产服务器的Nginx配置中，我们总会遇到形形色色的配置方案。你是否曾注意到root和alias指令的巧妙应用？是否对那些五花八门的location匹配规则感到好奇？
今天，咱们来聊聊Nginx配置中root和alias以及location的详细使用。
root与alias
root：指定web的跟目录，在定义location的时候，文件的绝对路径等于root&#43;location
server { listen 80; server_name chensir.ink; location / { root /data/nginx/html/pc; } location /about { # 必须要在html目录中创建一个about目录才可以访问，否则报错。 root /opt/html; } } 新建关于 location /about 的静态资源目录
# 创建目录 mkdir -p /opt/html/about # 写入index.html echo about &gt; /opt/html/about/index.html 加载Nginx配置文件并访问
systemctl reload nginx alias：定义路径别名，会把访问的路径重新定义到其指定的路径，文档映射的另一种机制；仅能用于location上下文，此指令使用较少。
示例
server { listen 80; server_name chensir.ink; location / { root /data/nginx/html/pc; } # 注意：about后不要加斜杠。使用alias时，如果URI后面加了斜杠， # 则下面的路径配置必须加斜杠，否则会导致403错误。 location /about { # 当访问/about时，会显示/opt/html/about目录下的内容。 alias /opt/html/about; } } 加载Nginx配置文件并访问">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-28T16:27:23+08:00">
    <meta property="article:modified_time" content="2024-05-28T16:27:23+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Nginx企业级负载均衡：技术详解系列（12）—— 深入解析root、alias及location</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/31/bf/FwWr0Zmv_o.png" alt="在这里插入图片描述"></p> 
<p>你好，我是赵兴晨，97年文科程序员。<br> 在生产服务器的Nginx配置中，我们总会遇到形形色色的配置方案。你是否曾注意到root和alias指令的巧妙应用？是否对那些五花八门的location匹配规则感到好奇？<br> 今天，咱们来聊聊Nginx配置中root和alias以及location的详细使用。</p> 
<p><strong>root与alias</strong><br> <strong>root</strong>：指定web的跟目录，在定义location的时候，文件的绝对路径等于root+location</p> 
<pre><code>server {
  listen 80;
  server_name chensir.ink;

  location / {
      root /data/nginx/html/pc;
  }

  location /about {
      # 必须要在html目录中创建一个about目录才可以访问，否则报错。
      root /opt/html;
  }
}
</code></pre> 
<p>新建关于 location /about 的静态资源目录</p> 
<pre><code># 创建目录
mkdir -p /opt/html/about

# 写入index.html
echo about &gt; /opt/html/about/index.html
</code></pre> 
<p>加载Nginx配置文件并访问</p> 
<pre><code>systemctl reload nginx
</code></pre> 
<p><img src="https://images2.imgbox.com/c5/aa/DMEH9DnP_o.png" alt="在这里插入图片描述"><br> <strong>alias</strong>：定义路径别名，会把访问的路径重新定义到其指定的路径，文档映射的另一种机制；仅能用于location上下文，此指令使用较少。</p> 
<p>示例</p> 
<pre><code>server {
  listen 80;
  server_name chensir.ink;

  location / {
      root /data/nginx/html/pc;
  }
  # 注意：about后不要加斜杠。使用alias时，如果URI后面加了斜杠，
  # 则下面的路径配置必须加斜杠，否则会导致403错误。
  location /about {
      # 当访问/about时，会显示/opt/html/about目录下的内容。
      alias /opt/html/about;
  }
}
</code></pre> 
<p>加载Nginx配置文件并访问</p> 
<pre><code>systemctl reload nginx
</code></pre> 
<p><img src="https://images2.imgbox.com/95/2e/yL6KbSU7_o.png" alt="在这里插入图片描述"></p> 
<p><strong>注意：location中使用root指令和alias指令的意义不同。</strong><br> root：给定的路径对应于location中的/uri 左侧的/。<br> alias：给定的路径对应于location中的/uri 的完整路径。</p> 
<p><strong>location的详细使用</strong><br> 在nginx的配置中，每个server块可以定义多个location段，这些段负责将用户请求的URI映射到文件系统路径。当用户处理请求时，Nginx会按照以下优先级顺序来选择最佳匹配的location：<br> 精确匹配：Nginx首先尝试找到与请求URI完全一致的location。<br> 最长非正则前缀匹配：如果没有找到精确匹配，Nginx会寻找最长的、非正则表达式的URI前缀匹配。<br> 正则表达式匹配：如果配置中包含正则表达式location，Nginx将按照配置文件中定义的顺序进行匹配，一旦找到匹配的正则表达式，就会停止搜索并使用该location处理请求。</p> 
<p>注意：如果location中使用了正则表达式，它将具有较高的优先级，因为Nginx会首先评估所有正则表达式location。此外，location匹配是基于它们在配置文件中出现的顺序，所以配置的顺序也会影响最终匹配的结果。</p> 
<p>location官方帮助<br> https://nginx.org/en/docs/http/ngx_http_core_module.html#location</p> 
<p><strong>Nginx语法规则</strong></p> 
<pre><code>location [ = | ~ | ~* | ^~ ] uri { ... }
</code></pre> 
<ol><li>= 精确匹配：使用=前缀表示精确匹配，请求的uri必须完全等同于指定的uri字符串。这种匹配是大小写敏感的，并且一旦找到精确匹配，Nginx将停止搜索其他location块，并使用匹配的location处理请求。</li></ol> 
<pre><code>location = /exact-match {
  # 配置
}
</code></pre> 
<p>示例：在server部分使用location配置一个web界面，当访问Nginx服务器的/logo.jpg的时候要显示指定html文件的内容。<br> 精确匹配一般用于匹配组织的logo等相对固定的URL，匹配优先级最高</p> 
<pre><code>server {
  listen 80;
  server_name chensir.ink;

  location / {
      root /data/nginx/html/pc;
      index index.html;
  }

  location = /logo.jpg {
      root /data/nginx/images;
  }
}
</code></pre> 
<p>上传logo.jpg图片到 /data/nginx/images目录下，重启Nginx并测试。<br> 访问测试：http://chensir.ink/logo.jpg</p> 
<p><img src="https://images2.imgbox.com/93/f3/eAnMSdtl_o.png" alt="在这里插入图片描述"></p> 
<ol start="2"><li>^~ 最长非正则前缀匹配：使用^~前缀表示Nginx将查找最长的非正则表达式前缀匹配。如果匹配成功，Nginx将继续搜索正则表达式location，但不会考虑没有正则表达式的location。</li></ol> 
<pre><code>location ^~ /prefix {
  # 配置
}
</code></pre> 
<p>示例</p> 
<pre><code>server {
  listen 80;
  server_name chensir.ink;

  # 处理/images请求，映射到/data/nginx/images目录
  location ^~ /images {
      root /data/nginx;
      index index.html;
  }

  # 处理/api请求，使用alias映射到/data/nginx/api目录
  location /api {
      alias /data/nginx/api;
      index index.html;
  }
}
</code></pre> 
<pre><code>mkdir -p /data/nginx/images
echo images web &gt; /data/nginx/images/index.html

mkdir -p /data/nginx/api
echo api web &gt; /data/nginx/api/index.html
</code></pre> 
<p>重新加载Nginx并访问测试，实现效果是访问 /images 和 /api 返回不同结果。<br> <img src="https://images2.imgbox.com/99/cc/RVsT9sPr_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li>~ 正则表达式匹配：使用 ~前缀表示后面的uri是一个正则表达式，并且匹配时区分大小写。</li></ol> 
<pre><code>location ~ /regex/ {
  # 配置
}
</code></pre> 
<p>示例：实现区分大小写的模糊匹配</p> 
<pre><code>server {
  listen 80;
  server_name chensir.ink;

  # 匹配以字母A开头，区分大小写，后面跟着零个或一个任意字符的.jpg图片文件
  location ~ /A.?\.jpg {
      index index.html;
      root /data/nginx/images;
  }
}
</code></pre> 
<p>重新载入Nginx配置并访问测试。<br> <img src="https://images2.imgbox.com/ee/b7/IVtThRSw_o.png" alt="在这里插入图片描述"></p> 
<p>上图中有两个图片，一个含有大写的，一个都是小写的，根据上面的location规则，进行访问测试，分别访问 http://chensir.ink/Aa.jpg 和 http://chensir.ink/aa.jpg<br> <img src="https://images2.imgbox.com/6f/0d/xHoVdTq8_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/fc/11/4Y3edH9k_o.png" alt="在这里插入图片描述"></p> 
<p>访问结果显而易见，location区分大小写配置成功。</p> 
<ol start="4"><li>~* 正则表达式匹配：使用 ~* 前缀同样表示后面的uri是一个正则表达式，但匹配时不区分大小写。</li></ol> 
<pre><code>location ~* /case-insensitive-regex/ {
  # 配置
}
</code></pre> 
<p>示例</p> 
<pre><code>server {
  listen 80;
  server_name chensir.ink;

  # 匹配以字母A开头，区分大小写，后面跟着零个或一个任意字符的.jpg图片文件
  location ~* /A.?\.jpg {
      index index.html;
      root /data/nginx/images;
  }
}
</code></pre> 
<p>重新加载Nginx配置，然后访问测试。<br> <img src="https://images2.imgbox.com/f7/66/5LW6SeGI_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/f8/02/75fjS0N9_o.png" alt="在这里插入图片描述"><br> 5. 无前缀匹配：如果没有任何前缀，Nginx会将此location视为一般匹配。如果有多个location块，Nginx会根据最长匹配原则选择一个匹配项。</p> 
<pre><code>location /generic-match {
  # 配置
}
</code></pre> 
<p>6.转义特殊字符：在正则表达式中，如果需要将特殊字符（如 .,*,?）作为普通字符使用，可以使用反斜杠\进行转义。</p> 
<pre><code>location ~* \.(pdf|doc)$ {
  # 配置
}
</code></pre> 
<p>匹配优先级：</p> 
<ul><li>精确匹配（=）具有最高优先级。</li><li>接下来是最长非正则前缀匹配（^~），但仅在没有正则表达式的情况下。</li><li>正则表达式匹配（<sub>和</sub>*）优先于非正则表达式匹配，但它们之间根据在配置文件中出现的顺序来确定。</li><li>如果存在多个正则表达式location，Nginx将按照它们在配置文件中出现的顺序进行匹配。</li></ul> 
<p>注意：如果<sup>~匹配成功，Nginx将继续搜索正则表达式location，但如果正则表达式location在</sup>~匹配的location之后定义，则不会被考虑。这意味着配置顺序对于确定最终的匹配结果很重要。</p> 
<p>以上就是就是今天的全部分享啦，咱们聊了Nginx配置中的root、alias以及location、希望这些知识能够帮助你在构建和优化Web服务器时更加得心应手。</p> 
<p>在这个由代码编织的世界里，每一个配置细节都可能成为提升性能和稳定性的关键。记住，技术之路永无止境，不断学习和探索才能让我们在这条路上走得更远。</p> 
<p>如果你对Nginx的负载均衡或其他高级特性有更多的兴趣，不妨继续关注我的Nginx技术详解系列。同时，如果你有任何问题或想法，欢迎在评论区留言，我们一起讨论，共同进步。</p> 
<p>感谢你的阅读，期待在下一篇文章中与你再次相遇。保持好奇，继续探索，咱们下次见！</p> 
<hr> 
<p>最后，我为您准备了一份特别的<strong>技术学习礼物</strong>，包括：<br> <strong>Linux学习笔记</strong>：详尽记录了Linux的核心知识点和实用技巧。<br> <strong>Java基础笔记</strong>：为您打下坚实的Java编程基础。<br> <strong>Java面试总结</strong>：十万字的面试经验，助您轻松应对各种技术面试。</p> 
<p><strong>【一键领取】</strong><br> 领取这份资料包，您只需轻松一扫：<br> 按住👇🏻图片，扫描二维码，备注：【大礼包】‍<br> 通过好友验证后，您的的专属资料包就会立即发送给您。</p> 
<p>Linux系统学习笔记、Java基础学习笔记、10万字Java面试总结<br> <img src="https://images2.imgbox.com/17/5d/2yXpyuoz_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cfed15b807b0c12505c585e543d0627e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">大数据基础知识-Hadoop、HBase、Hive一篇搞定</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/906dd19900badee8977d7a28d120edb6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Android】多种方式实现圆角控件View、图片、背景、边框（最全）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>