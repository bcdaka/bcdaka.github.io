<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[Spring] SpringBoot统一功能处理与图书管理系统 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/2c10387a646e22025865fd811ae535fa/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="[Spring] SpringBoot统一功能处理与图书管理系统">
  <meta property="og:description" content="🌸个人主页:https://blog.csdn.net/2301_80050796?spm=1000.2115.3001.5343
🏵️热门专栏:
🧊 Java基本语法(97平均质量分)https://blog.csdn.net/2301_80050796/category_12615970.html?spm=1001.2014.3001.5482
🍕 Collection与数据结构 (92平均质量分)https://blog.csdn.net/2301_80050796/category_12621348.html?spm=1001.2014.3001.5482
🧀线程与网络(96平均质量分) https://blog.csdn.net/2301_80050796/category_12643370.html?spm=1001.2014.3001.5482
🍭MySql数据库(93平均质量分)https://blog.csdn.net/2301_80050796/category_12629890.html?spm=1001.2014.3001.5482
🍬算法(97平均质量分)https://blog.csdn.net/2301_80050796/category_12676091.html?spm=1001.2014.3001.5482
🍃 Spring(97平均质量分)https://blog.csdn.net/2301_80050796/category_12724152.html?spm=1001.2014.3001.5482
感谢点赞与关注~~~
目录 1. 拦截器1.1 概念1.2 拦截器的基本使用1.3 拦截器的执行流程1.5 设计模式: 适配器模式1.5.1 定义 2. 统一数据返回格式3. 统一异常处理4. 图书管理系统(应用)4.1 准备数据库4.2 创建实体类4.3 用户登录接口4.4 添加图书接口4.5 图书列表与翻页请求4.6 修改图书接口4.7 删除图书接口4.8 批量删除接口4.9 强制登录 1. 拦截器 1.1 概念 首先什么是拦截器?拦截器主要用来拦截用户请求,在指定方法前后,根据业务需要执行的预先设定的代码.也就是允许开发人员预先设定一些代码,在用户请求响应前后执行.也可以在用户请求之前组织其执行.
就像小区门口的保安一样,会对外面的形形色色的人进行拦截一样.
1.2 拦截器的基本使用 拦截器的使用分为两步:
定义拦截器注册配置拦截器. 首先,我们设计一个自定义拦截器.这个自定义拦截器需要实现HandlerInterceptor接口,并重写其中的所有方法.
@Component @Slf4j public class Interceptor implements HandlerInterceptor { @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { log.info(&#34;在执行目标方法之前&#34;); return true; } @Override public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception { log.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-07T21:55:42+08:00">
    <meta property="article:modified_time" content="2024-08-07T21:55:42+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[Spring] SpringBoot统一功能处理与图书管理系统</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>🌸个人主页:<a href="https://blog.csdn.net/2301_80050796?spm=1000.2115.3001.5343">https://blog.csdn.net/2301_80050796?spm=1000.2115.3001.5343</a><br> 🏵️热门专栏:<br> 🧊 Java基本语法(97平均质量分)<a href="https://blog.csdn.net/2301_80050796/category_12615970.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12615970.html?spm=1001.2014.3001.5482</a><br> 🍕 Collection与数据结构 (92平均质量分)<a href="https://blog.csdn.net/2301_80050796/category_12621348.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12621348.html?spm=1001.2014.3001.5482</a><br> 🧀线程与网络(96平均质量分) <a href="https://blog.csdn.net/2301_80050796/category_12643370.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12643370.html?spm=1001.2014.3001.5482</a><br> 🍭MySql数据库(93平均质量分)<a href="https://blog.csdn.net/2301_80050796/category_12629890.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12629890.html?spm=1001.2014.3001.5482</a><br> 🍬算法(97平均质量分)<a href="https://blog.csdn.net/2301_80050796/category_12676091.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12676091.html?spm=1001.2014.3001.5482</a><br> 🍃 Spring(97平均质量分)<a href="https://blog.csdn.net/2301_80050796/category_12724152.html?spm=1001.2014.3001.5482">https://blog.csdn.net/2301_80050796/category_12724152.html?spm=1001.2014.3001.5482</a><br> 感谢点赞与关注~~~<br> <img src="https://images2.imgbox.com/40/b2/z2V4Ybcp_o.jpg" alt="在这里插入图片描述"></p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#1__13" rel="nofollow">1. 拦截器</a></li><li><ul><li><a href="#11__14" rel="nofollow">1.1 概念</a></li><li><a href="#12__19" rel="nofollow">1.2 拦截器的基本使用</a></li><li><a href="#13__78" rel="nofollow">1.3 拦截器的执行流程</a></li><li><a href="#15___83" rel="nofollow">1.5 设计模式: 适配器模式</a></li><li><ul><li><a href="#151__85" rel="nofollow">1.5.1 定义</a></li></ul> 
  </li></ul> 
  </li><li><a href="#2__133" rel="nofollow">2. 统一数据返回格式</a></li><li><a href="#3__163" rel="nofollow">3. 统一异常处理</a></li><li><a href="#4__195" rel="nofollow">4. 图书管理系统(应用)</a></li><li><ul><li><a href="#41__196" rel="nofollow">4.1 准备数据库</a></li><li><a href="#42__279" rel="nofollow">4.2 创建实体类</a></li><li><a href="#43__312" rel="nofollow">4.3 用户登录接口</a></li><li><a href="#44__391" rel="nofollow">4.4 添加图书接口</a></li><li><a href="#45__450" rel="nofollow">4.5 图书列表与翻页请求</a></li><li><a href="#46__622" rel="nofollow">4.6 修改图书接口</a></li><li><a href="#47__733" rel="nofollow">4.7 删除图书接口</a></li><li><a href="#48__746" rel="nofollow">4.8 批量删除接口</a></li><li><a href="#49__796" rel="nofollow">4.9 强制登录</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1__13"></a>1. 拦截器</h2> 
<h3><a id="11__14"></a>1.1 概念</h3> 
<p>首先什么是拦截器?拦截器主要用来拦截用户请求,<mark>在指定方法前后,根据业务需要执行的预先设定的代码</mark>.也就是允许开发人员预先设定一些代码,在用户请求响应前后执行.也可以在用户请求之前组织其执行.<br> <img src="https://images2.imgbox.com/aa/e1/732Gd3lc_o.png" alt="在这里插入图片描述"><br> 就像小区门口的保安一样,会对外面的形形色色的人进行拦截一样.</p> 
<h3><a id="12__19"></a>1.2 拦截器的基本使用</h3> 
<p>拦截器的使用分为两步:</p> 
<ol><li>定义拦截器</li><li>注册配置拦截器.</li></ol> 
<p>首先,我们设计一个自定义拦截器.这个自定义拦截器需要<mark>实现<code>HandlerInterceptor</code>接口</mark>,并重写其中的所有方法.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Interceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"在执行目标方法之前"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">ModelAndView</span> modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"在执行目标方法后"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"在视图渲染完成之后"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>第一个<code>preHandle</code>方法就是在目标方法执行前执行的代码,<strong>如果返回true,继续执行后面的操作,如果返回false,拦截当前请求</strong>.</li><li>第二个<code>postHandle</code>表示的是在目标方法执行后要执行的操作.</li><li>第三个<code>afterCompletion</code>表示的是在视图渲染完成之后执行的操作.第三个方法暂时不需要了解.</li></ul> 
<blockquote> 
 <p>定义拦截器就好像定义一个保安要做什么,比如在一些奇奇怪怪的人要进来之前,保安需要在小区门口将其拦截.在业主回家的时候,保安会放行通过,并来上一句"欢迎业主回家".</p> 
</blockquote> 
<p>其次,我们需要注册配置拦截器.<mark>需要在一个类中实现WebMvcConfigurer接口,并重写其中的<code>addInterceptor</code>方法</mark>.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">Interceptor</span> interceptor<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>interceptor<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在重写的方法中,<mark>我们需要为形式参数添加对应的拦截器,之后再在拦截器的后面配置要拦截的路径</mark>,这里的<code>/**</code>代表的是拦截所有路径下的所有请求.<br> 除此之外,还有一些常见的拦截路径设置.</p> 
<table><thead><tr><th>拦截路径</th><th>含义</th><th>举例</th></tr></thead><tbody><tr><td>/*</td><td>⼀级路径 能匹配/user，/book，/login，不能匹配/user/login</td><td></td></tr><tr><td>/**</td><td>任意级路径 能匹配/user，/user/login，/user/reg</td><td></td></tr><tr><td>/book/*</td><td>/book下的⼀级路径 能匹配/book/addBook，不能匹配/book/addBook/1，/book</td><td></td></tr><tr><td>/book/**</td><td>/book下的任意级路径 能匹配/book，/book/addBook，/book/addBook/2，不能匹配/user/login</td><td></td></tr></tbody></table> 
<p>[注意] 以上拦截的规则不仅仅可以是文件路径,还可以是接口的URL.</p> 
<h3><a id="13__78"></a>1.3 拦截器的执行流程</h3> 
<p><img src="https://images2.imgbox.com/05/08/Ea3WPP4M_o.png" alt="在这里插入图片描述"></p> 
<ol><li>添加拦截器后,执行Controller的方法之前,请求会先被拦截器拦截住.执行 preHandle() 方法，这个方法需要返回⼀个布尔类型的值.如果返回true,就表示放行本次操作,继续访问controller中的方法.如果返回false，则不会放行(controller中的⽅法也不会执行).</li><li>controller当中的方法执行完毕后，再回过来执行 postHandle() 这个方法以及afterCompletion() 方法，执行完毕之后，最终给浏览器响应数据.</li></ol> 
<h3><a id="15___83"></a>1.5 设计模式: 适配器模式</h3> 
<p>上面拦截器的实现原理中,源码中的HandlerAdapter在SpringMVC中使用的就是适配器模式.</p> 
<h4><a id="151__85"></a>1.5.1 定义</h4> 
<p>适配器模式,也叫包装器模式,<mark>是将一个类的接口,转换为客户期望的接口</mark>,适配器让原本不兼容的类之间可以合作.<br> 比如下面两个接口,本身就是不兼容的(比如参数类型不一样,参数个数不一样等等)<br> <img src="https://images2.imgbox.com/19/1a/RjnHFoqX_o.png" alt="在这里插入图片描述"><br> 但是我们可以通过适配器使其兼容.<br> <img src="https://images2.imgbox.com/ef/cb/us8be0P6_o.png" alt="在这里插入图片描述"><br> 在我们日常生活中,适配器的例子也非常常见.比如转换插头:这是我们出国旅行前必备的一个装备.<br> <img src="https://images2.imgbox.com/9d/93/2TlCU2Gm_o.png" alt="在这里插入图片描述"><br> 适配器模式的角色:<br> • Target:目标接口(可以是抽象类或接口),<strong>客户希望直接用的接口</strong><br> • Adaptee:适配者,但是与Target不兼容<br> • Adapter:适配器类,此模式的核心.<strong>通过继承或者引用适配者的对象,把适配者转为目标接口</strong><br> • client:需要使用适配器的对象<br> 场景: 我们在前面学习日志的时候,slf4j就使用了适配器模式,slf4j提供的一系列打印日志的API,都是底层调用log4j或者是logback来实现的.我们在调用的时候,只需要调用slf4j的API即可.</p> 
<pre><code class="prism language-java"><span class="token comment">//slf4j的接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Slf4j</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//底层打印日志的log4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Log4j</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//适配器</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Slf4jLog4jAdaptor</span> <span class="token keyword">implements</span> <span class="token class-name">Slf4j</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Log4j</span> log4j<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Slf4jLog4jAdaptor</span><span class="token punctuation">(</span><span class="token class-name">Log4j</span> log4j<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>log4j <span class="token operator">=</span> log4j<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        log4j<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//最核心的是这一步,调用log4j的打印方法,</span>
        <span class="token comment">//在外部调用的时候,调用的是适配器的print方法.</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Slf4j</span> slf4j <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Slf4jLog4jAdaptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Log4j</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//调用方-&gt;适配器-&gt;底层log4j</span>
        slf4j<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"打印日志"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>适配器模式的应用场景</strong>:<br> ⼀般来说，适配器模式可以看作⼀种"补偿模式"，用来补救设计上的缺陷.应用这种模式算是"无奈之举",如果在设计初期，我们就能协调规避接口不兼容的问题,就不需要使用适配器模式了.</p> 
<h2><a id="2__133"></a>2. 统一数据返回格式</h2> 
<p>在一些场景下,我们接口的返回结果的格式是一样的,这时候我们就需要对接口的返回格式的几种不同的类型进行封装,之后在统一返回数据格式中对相应结果进行一些列逻辑判断与处理,最终由统一数据格式返回决定返回该格式中那种类型的数据.</p> 
<p>统一数据返回格式用<code>@ControllerAdvice</code>和实现<code>ResponseBodyAdvice</code>接口来完成.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResponseBody</span> <span class="token keyword">implements</span> <span class="token class-name">ResponseBodyAdvice</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">beforeBodyWrite</span><span class="token punctuation">(</span><span class="token class-name">Object</span> body<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">MediaType</span> selectedContentType<span class="token punctuation">,</span> <span class="token class-name">Class</span> selectedConverterType<span class="token punctuation">,</span> <span class="token class-name">ServerHttpRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServerHttpResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">Class</span> converterType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>support方法: 判断是否需要执行beforeBodyWrite方法,true为执行,false不执行.<strong>通过该方法可以选择哪些类或者那些方法的Response需要进行处理,那些不需要处理</strong>.<br> 我们在获取类名和方法名的时候,需要用到反射机制,从returnType中获取:</li></ul> 
<pre><code class="prism language-java"><span class="token comment">//获取执⾏的类 </span>
<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> declaringClass <span class="token operator">=</span> returnType<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//获取执⾏的⽅法 </span>
<span class="token class-name">Method</span> method <span class="token operator">=</span> returnType<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>deforeBodyWrite方法: 对Response方法进行具体操作处理,决定统一返回结果的内容.</li></ul> 
<h2><a id="3__163"></a>3. 统一异常处理</h2> 
<p>统一异常处理使用的是<code>@ControllerAdvice +@ExceptionHandler </code>来实现的,<code>@ControllerAdvice</code> 表示控制器通知类,<code>@ExceptionHandler</code> 是异常处理器.<br> 具体代码如下:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ErrorAdvice</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@ExceptionHandler</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>当然,我们也可以针对不同类型的异常返回不同的结果:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ErrorAdvice</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@ExceptionHandler</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@ExceptionHandler</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handler1</span><span class="token punctuation">(</span><span class="token class-name">NullPointerException</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"发生空指针异常"</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@ExceptionHandler</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">handler2</span><span class="token punctuation">(</span><span class="token class-name">IndexOutOfBoundsException</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token string">"发生数组越界异常"</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>[注意] 在异常类型进行匹配的时候,<mark>先检查带有<code>@ExceptionHandler</code>注解的有没有与之匹配的异常类型,如果没有,依次向父类检查,直到匹配到对应的父类为止</mark>.</p> 
<h2><a id="4__195"></a>4. 图书管理系统(应用)</h2> 
<h3><a id="41__196"></a>4.1 准备数据库</h3> 
<p>首先,我们需要为这个系统准备数据库和数据表,并为数据库创建一些数据.<br> 数据库表的设计与业务逻辑有关系,数据库表一般分为两种:实体表和关系表.<br> 图书管理系统相对比较简单,只有两个实体:<strong>用户和图书,而且用户和图书之间没有关联关系</strong>.<br> 关于表的字段的设计,也与具体的业务逻辑有关系,但是<mark>三个字段是必不可少的,创建时间,更新时间,id</mark>.<br> 用户表有用户名,密码,删除标志,图书表有图书名称,作者,售价,图书状态(可借阅,不可借阅,删除),库存数量,出版社.</p> 
<ul><li>创建数据库表,并添加对应数据</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> book_test<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> book_test <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4<span class="token punctuation">;</span>
<span class="token comment">-- ⽤⼾表 </span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> user_info<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> user_info <span class="token punctuation">(</span>
 <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>user_name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">128</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">128</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>delete_flag<span class="token punctuation">`</span></span> <span class="token keyword">TINYINT</span> <span class="token punctuation">(</span> <span class="token number">4</span> <span class="token punctuation">)</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">0</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">UNIQUE</span> <span class="token keyword">INDEX</span> <span class="token identifier"><span class="token punctuation">`</span>user_name_UNIQUE<span class="token punctuation">`</span></span> <span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>user_name<span class="token punctuation">`</span></span> <span class="token keyword">ASC</span> <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> 
<span class="token keyword">CHARACTER</span> 
<span class="token keyword">SET</span> <span class="token operator">=</span> utf8mb4 <span class="token keyword">COMMENT</span> <span class="token operator">=</span> <span class="token string">'⽤⼾表'</span><span class="token punctuation">;</span>
<span class="token comment">-- 图书表 </span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> book_info<span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>book_info<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
 <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token punctuation">(</span> <span class="token number">11</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>book_name<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">127</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>author<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">127</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>count<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token punctuation">(</span> <span class="token number">11</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>price<span class="token punctuation">`</span></span> <span class="token keyword">DECIMAL</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>publish<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span> <span class="token number">256</span> <span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">TINYINT</span> <span class="token punctuation">(</span> <span class="token number">4</span> <span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token number">1</span> <span class="token keyword">COMMENT</span> <span class="token string">'0-⽆效, 1-正常, 2-不允许借阅'</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">DATETIME</span> <span class="token keyword">DEFAULT</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span> <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token punctuation">)</span> 
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">INNODB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span> <span class="token operator">=</span> utf8mb4<span class="token punctuation">;</span>
<span class="token comment">-- 初始化数据 </span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> user_info <span class="token punctuation">(</span> user_name<span class="token punctuation">,</span> PASSWORD <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> <span class="token string">"admin"</span><span class="token punctuation">,</span> <span class="token string">"admin"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> user_info <span class="token punctuation">(</span> user_name<span class="token punctuation">,</span> PASSWORD <span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span> <span class="token string">"zhangsan"</span><span class="token punctuation">,</span> <span class="token string">"123456"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 初始化图书数据 </span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>book_info<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>book_name<span class="token punctuation">,</span>author<span class="token punctuation">,</span>count<span class="token punctuation">,</span> price<span class="token punctuation">,</span> publish<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'活
着'</span><span class="token punctuation">,</span> <span class="token string">'余华'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'北京⽂艺出版社'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>book_info<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>book_name<span class="token punctuation">,</span>author<span class="token punctuation">,</span>count<span class="token punctuation">,</span> price<span class="token punctuation">,</span> publish<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'平凡的
世界'</span><span class="token punctuation">,</span> <span class="token string">'路遥'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">98.56</span><span class="token punctuation">,</span> <span class="token string">'北京⼗⽉⽂艺出版社'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>book_info<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>book_name<span class="token punctuation">,</span>author<span class="token punctuation">,</span>count<span class="token punctuation">,</span> price<span class="token punctuation">,</span> publish<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'三
体'</span><span class="token punctuation">,</span> <span class="token string">'刘慈欣'</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">102.67</span><span class="token punctuation">,</span> <span class="token string">'重庆出版社'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>book_info<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>book_name<span class="token punctuation">,</span>author<span class="token punctuation">,</span>count<span class="token punctuation">,</span> price<span class="token punctuation">,</span> publish<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'⾦字塔
原理'</span><span class="token punctuation">,</span> <span class="token string">'⻨肯锡'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">178.00</span><span class="token punctuation">,</span> <span class="token string">'⺠主与建设出版社'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>创建项目,引入MySql驱动依赖和MyBatis依赖.</li></ul> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mybatis.spring.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ul><li>配置数据库信息,数据库日志打印,驼峰转换,MyBatis xml文件路径.</li></ul> 
<pre><code class="prism language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> books
<span class="token comment"># 数据库连接配置</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/books<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> qwe123524
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
<span class="token comment"># 配置 mybatis xml 的⽂件路径，在 resources/mapper 创建所有表的 xml ⽂件</span>
<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">**Mapper.xml</span>
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">map-underscore-to-camel-case</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#配置驼峰⾃动转换</span>
    <span class="token key atrule">log-impl</span><span class="token punctuation">:</span> org.apache.ibatis.logging.stdout.StdOutImpl

</code></pre> 
<h3><a id="42__279"></a>4.2 创建实体类</h3> 
<p>实体类分为两种,一种是用户,一种是图书.定义类属性的时候,<mark>注意把数据库字段的蛇形命名法转换为小驼峰命名法</mark>.</p> 
<ul><li>用户类</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> deleteFlag<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>图书类</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookInfo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> bookName<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> author<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> count<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">BigDecimal</span> price<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> publish<span class="token punctuation">;</span>
    <span class="token comment">//0-无效,1-正常,2-不可借阅</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> status<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> statusCN<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="43__312"></a>4.3 用户登录接口</h3> 
<ul><li>接口文档</li></ul> 
<pre><code>[请求]
/user/login
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
[参数]
name=zhangsan&amp;password=123456
[响应]
true //账号密码验证正确, 否则返回false
</code></pre> 
<p>浏览器给服务器发送 /user/login 这样的HTTP请求,服务器给浏览器返回了⼀个Boolean类型的数据.返回true,表示账号密码验证正确.</p> 
<ul><li>Controller层</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfoController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserInfoService</span> userInfoService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">,</span> <span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//用户名或者密码为空</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> userInfoService<span class="token punctuation">.</span><span class="token function">selectUserByName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//没有查询到用户</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>userInfo <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>userInfo <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> password<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            userInfo<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//先把密码设置为空,以免被抓包</span>
            <span class="token comment">//把用户信息存入session中,session中是以json的格式存储的对象</span>
            session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">SESSION_USER_KEY</span><span class="token punctuation">,</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//密码错误</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Constant</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SESSION_USER_KEY</span> <span class="token operator">=</span> <span class="token string">"SESSION_USER_KEY"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>首先,确保用户输入了用户名和密码,首先判断用户名和密码不为空,如果为空,返回false.<br> 之后,把用户输入的用户名传给Service层,返回一个用户类.<br> 判断返回的用户类是否为null,如果为null,说明该用户不存在,返回false.如果不为null,说明用户存在,用户名存在.<br> 用户存在之后,再判断用户输入的密码与数据库返回的用户密码是否一致,如果一致,把用户的密码设置为空字符串,再在session中存储用户信息.并返回true.否则返回false.<br> 在设置session的时候,<strong>我们建议把session键值对的key拿出来,作为一个静态变量独立封装</strong>.</p> 
<ul><li>Service层</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfoService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">UserInfoMapper</span> userInfoMapper<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">selectUserByName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> userInfoMapper<span class="token punctuation">.</span><span class="token function">selectUserInfo</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在业务逻辑层,我们把Controller层的用户名传给Mapper层(数据库层),之后返回数据库层返回的用户信息.</p> 
<ul><li>Mapper层</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Mapper</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserInfoMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from user_info where user_name = #{name} and delete_flag = 0"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">selectUserInfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在Mapper层,我们根据Service层传过来的用户名在数据库中搜索用户,并返回用户类.<strong>需要注意的是,需要限定有效的用户,已经删除的用户不包含在内</strong>.</p> 
<ul><li>测试接口:data返回true<br> <img src="https://images2.imgbox.com/96/c7/KJJSGmW8_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="44__391"></a>4.4 添加图书接口</h3> 
<ul><li>接口文档</li></ul> 
<pre><code>[请求]
/book/addBook
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
[参数]
bookName=图书1&amp;author=作者1&amp;count=23&amp;price=36&amp;publish=出版社1&amp;status=1
[响应]
true or false
</code></pre> 
<ul><li>Controller层</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">BookInfoService</span> bookInfoService<span class="token punctuation">;</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/addBook"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">addBook</span><span class="token punctuation">(</span><span class="token class-name">BookInfo</span> bookInfo<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//有的图书信息为空</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>bookInfo<span class="token punctuation">.</span><span class="token function">getBookName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>bookInfo<span class="token punctuation">.</span><span class="token function">getAuthor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">||</span> bookInfo<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span>
    <span class="token operator">||</span> bookInfo<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span>
    <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>bookInfo<span class="token punctuation">.</span><span class="token function">getPublish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">||</span> bookInfo<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bookInfoService<span class="token punctuation">.</span><span class="token function">addBook</span><span class="token punctuation">(</span>bookInfo<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"添加图书失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"添加图书成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>首先判断用户在添加图书的时候,图书信息输入全部合法,即不可以有任何一栏是空数据.否则返回false.<br> 之后把图书数据传给Service层,根据Service层返回来的结果做出最终的日志打印和返回结果.</p> 
<ul><li>Service层</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">addBook</span><span class="token punctuation">(</span><span class="token class-name">BookInfo</span> bookInfo<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Integer</span> i <span class="token operator">=</span> bookInfoMapper<span class="token punctuation">.</span><span class="token function">insertBook</span><span class="token punctuation">(</span>bookInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>调用Mapper层,把图书信息传递给Mapper层.<br> 之后看Mapper返回的结果,如果返回的结果是0,说明数据库没有数据改变,插入失败,如果返回结果大于0,说明插入成功,返回true.</p> 
<ul><li>Mapper层</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token string">"insert into book_info "</span> <span class="token operator">+</span>
        <span class="token string">"(book_name, author, count, price, publish,status) "</span> <span class="token operator">+</span>
        <span class="token string">"values (#{bookName},#{author},#{count},#{price},#{publish},#{status})"</span><span class="token punctuation">)</span>
<span class="token class-name">Integer</span> <span class="token function">insertBook</span><span class="token punctuation">(</span><span class="token class-name">BookInfo</span> bookInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>从形式参数的对象中获取对应的参数,插入数据库中.</p> 
<ul><li>测试<br> <img src="https://images2.imgbox.com/33/30/wL8ksnLM_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="45__450"></a>4.5 图书列表与翻页请求</h3> 
<ul><li>需求分析<br> 如果数据库中的图书有成百上千条,我们不可能在一个页面中展示所有的图书,我们需要对图书进行分页.<br> 比如我们一页展示10条数据.如果还想看其他数据,可以通过点击页码进行查询.<br> 分页的时候,数据是这样展示的:<br> 第一页:显示1-10条数据<br> 第二页:显示11-20条数据<br> 第三页:显示21-30条数据<br> …<br> 首先我们需要有更多的数据,我们在数据库中添加更多的数据.</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>book_info<span class="token punctuation">`</span></span> <span class="token punctuation">(</span> book_name<span class="token punctuation">,</span> author<span class="token punctuation">,</span> count<span class="token punctuation">,</span> price<span class="token punctuation">,</span> publish <span class="token punctuation">)</span>
<span class="token keyword">VALUES</span>
<span class="token punctuation">(</span> <span class="token string">'图书2'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版社2'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span> <span class="token string">'图书3'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版社
3'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token string">'图书4'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版社1'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span> <span class="token string">'图书5'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版社
1'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token string">'图书6'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版社1'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span> <span class="token string">'图书7'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版社
1'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token string">'图书8'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版社1'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span> <span class="token string">'图书9'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版社
1'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token string">'图书10'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版社1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span> <span class="token string">'图书11'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版
社1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token string">'图书12'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版社1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span> <span class="token string">'图书13'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版
社1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token string">'图书14'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版社1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span> <span class="token string">'图书15'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版
社1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token string">'图书16'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版社1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span> <span class="token string">'图书17'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版
社1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token string">'图书18'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版社1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span> <span class="token string">'图书19'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版
社1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span> <span class="token string">'图书20'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版社1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span> <span class="token string">'图书21'</span><span class="token punctuation">,</span> <span class="token string">'作者2'</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">,</span> <span class="token number">22.00</span><span class="token punctuation">,</span> <span class="token string">'出版
社1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>前端在发起查询的时候,需要向服务端传递的参数:首先是currentPage 当前页码,默认值为1.其次是PageSize,每页显示的条数,默认值为10.<br> 后端响应时,需要响应给前端的数据,records所查询到的数据列表(存储到List集合中).total总记录数(用于告诉前端显示多少页,显示页数为:<mark>(total + pageSize -1)/pageSize</mark>.其次后端需要计算出每一页的图书id的看开始索引,公式为:<mark>(currentPage-1) * pageSize</mark>.</p> 
<ul><li>返回model<br> 首先是翻页请求对象:<br> 传入的是当前页码和每一页中展示图书的数目.</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PageRequest</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">private</span> <span class="token keyword">int</span> currentPage <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 当前⻚ </span>
	<span class="token keyword">private</span> <span class="token keyword">int</span> pageSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">// 每⻚中的记录数 </span>
<span class="token punctuation">}</span>
</code></pre> 
<p>其次根据当前页码和每页要显示的页数,计算每页开始的索引.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PageRequest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> currentPage <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> pageSize <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>currentPage<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>pageSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>其次是翻页图书列表,用作返回结果:</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> total<span class="token punctuation">;</span><span class="token comment">//图书总数</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> records<span class="token punctuation">;</span><span class="token comment">//每页的图书列表</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在每一页的返回结果中,列表中的参数类型使用泛型.</p> 
<ul><li>接口文档</li></ul> 
<pre><code>[请求]
/book/getListByPage?currentPage=1&amp;pageSize=10
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
[参数] currentPage=1&amp;pageSize=10
[响应]
Content-Type: application/json
{
	 "total": 25,
	 "records": [{
		 "id": 25,
		 "bookName": "图书21",
		 "author": "作者2",
		 "count": 29,
		 "price": 22.00,
		 "publish": "出版社1",
		 "status": 1,
		 "statusCN": "可借阅"
 }, {
 ......
 } ]
}
</code></pre> 
<blockquote> 
 <p>第一页可以不传参数,因为有默认值,为1.</p> 
</blockquote> 
<ul><li>Controller层</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/getListByPage"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BookInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getListByPage</span><span class="token punctuation">(</span><span class="token class-name">PageRequest</span> pageRequest<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"获取图书列表,{}"</span><span class="token punctuation">,</span>pageRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> bookInfoService<span class="token punctuation">.</span><span class="token function">getBookListByPage</span><span class="token punctuation">(</span>pageRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>拿到前端传过来的参数,一个是当前页面,一个是每页的数目,把参数传递给后端,后端拿到参数之后,把参数传递给业务逻辑层,并打印日志.返回的是我们提前封装好的翻页图书列表类.</p> 
<ul><li>Service层</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BookInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getBookListByPage</span><span class="token punctuation">(</span><span class="token class-name">PageRequest</span> pageRequest<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BookInfo</span><span class="token punctuation">&gt;</span></span> bookList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PageResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> total <span class="token operator">=</span> bookInfoMapper<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bookList<span class="token punctuation">.</span>total <span class="token operator">=</span> total<span class="token punctuation">;</span>
    <span class="token comment">//为数据库的图书设置图书状态</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BookInfo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> bookInfoMapper<span class="token punctuation">.</span><span class="token function">selectBookByPage</span><span class="token punctuation">(</span>pageRequest<span class="token punctuation">.</span><span class="token function">getOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pageRequest<span class="token punctuation">.</span><span class="token function">getPageSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BookInfo</span> bookInfo<span class="token operator">:</span>list<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">BookStatus</span> nameByCode <span class="token operator">=</span> <span class="token class-name">BookStatus</span><span class="token punctuation">.</span><span class="token function">getNameByCode</span><span class="token punctuation">(</span>bookInfo<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nameByCode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token string">"book status is unknown"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        bookInfo<span class="token punctuation">.</span><span class="token function">setStatusCN</span><span class="token punctuation">(</span>nameByCode<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    bookList<span class="token punctuation">.</span>records <span class="token operator">=</span> list<span class="token punctuation">;</span>
    <span class="token keyword">return</span> bookList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>创建一个PageResult类型,之后在对象中添加图书总数.之后从对象中获取到每一页开始的索引和每一页展示的个数.获取到图书列表之后,设置图书字符串,字符串是根据每一本书的状态码来设置的.如果状态码是错误的,我们就抛出异常.<br> 针对图书的状态,我们可以<strong>自定义一个枚举类来解决</strong>.设置完图书的状态信息之后,我们就需要把图书列表给bookList中的records信息.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">BookStatus</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">DELETE</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"无效"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">NORMAL</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"正常"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">FORBIDDEN</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"不可借阅"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Getter</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Getter</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> status<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 根据图书的状态码获取枚举对象
     * @param code 图书状态码
     * @return 返回枚举对象
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">BookStatus</span> <span class="token function">getNameByCode</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> code<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BookStatus</span> bookStatus<span class="token operator">:</span><span class="token class-name">BookStatus</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//遍历所有枚举对象</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>bookStatus<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> bookStatus<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>在枚举类中,我们首先要定义枚举对象的属性,一个是状态码(code),一个是状态信息(msg).之后是枚举对象,枚举对象中需要传入枚举对象的属性.<br> 之后我们需要把图书的状态码和枚举对象的状态码对上,我们可以使用<code>BookStatus.values()</code>获取到枚举类中的所有枚举对象,之后进行遍历,只要枚举对象的状态码和图书的状态码对得上,就返回对应枚举对象中的信息.否则返回null.</p> 
<ul><li>Mapper层</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select count(*) from book_info where status != 0"</span><span class="token punctuation">)</span>
<span class="token class-name">Integer</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from book_info where status != 0 order by id desc "</span> <span class="token operator">+</span>
        <span class="token string">"limit #{pageSize} offset #{offset}"</span><span class="token punctuation">)</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BookInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">selectBookByPage</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> offset<span class="token punctuation">,</span><span class="token class-name">Integer</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>Mapper层要做的是,查询图书的总数,根据页码和每一页显示的图书本数,返回查询的图书列表.</p> 
<ul><li>测试<br> <img src="https://images2.imgbox.com/72/94/u2eZvKXR_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="46__622"></a>4.6 修改图书接口</h3> 
<ul><li>接口文档</li></ul> 
<pre><code>[请求]
/book/queryBookById?bookId=25
[参数]
无
[响应]
{
	 "id": 25,
	 "bookName": "图书21",
	 "author": "作者2",
	 "count": 999,
	 "price": 222.00,
	 "publish": "出版社1",
	 "status": 2,
	 "statusCN": null,
	 "createTime": "2023-09-04T04:01:27.000+00:00",
	 "updateTime": "2023-09-05T03:37:03.000+00:00"
}
</code></pre> 
<p>首先我们需要根据图书ID,获取到当前图书的信息.<br> 点击修改按钮之后,修改图书信息.</p> 
<pre><code>[请求]
/book/updateBook
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
[参数]
id=1&amp;bookName=图书1&amp;author=作者1&amp;count=23&amp;price=36&amp;publish=出版社1&amp;status=1
[响应]
true or false
</code></pre> 
<p>我们约定,浏览器给服务器发送⼀个 /book/updateBook 这样的HTTP请求, form表单的形式来提交数据.<br> 这里的参数就和添加图书是一样的.</p> 
<ul><li>Controller层</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/queryBookById"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">BookInfo</span> <span class="token function">getBookById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> bookId<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">BookInfo</span> bookInfo <span class="token operator">=</span> bookInfoService<span class="token punctuation">.</span><span class="token function">getBookById</span><span class="token punctuation">(</span>bookId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bookInfo <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"图书Id有误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BookInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bookInfo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/updateBook"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">updateBook</span><span class="token punctuation">(</span><span class="token class-name">BookInfo</span> bookInfo<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bookInfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//在根据如数id查询图书的时候,有可能返回的是空对象</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"图书Id不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Integer</span> ret <span class="token operator">=</span> bookInfoService<span class="token punctuation">.</span><span class="token function">updateBook</span><span class="token punctuation">(</span>bookInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"添加图书失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>首先根据传入的图书id来查询到图书的信息.如果根据id没有查询到图书信息,则返回空图书类型.查询到则返回查询结果.<br> 之后更新图书信息的时候,如果图书id为空的时候,就返回false,之后把更新后的图书对象传给Service层,如果返回的类型是大于0,则说明更新成功,否则更新失败.</p> 
<ul><li>Service层</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">BookInfo</span> <span class="token function">getBookById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> bookId<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
     <span class="token keyword">return</span> bookInfoMapper<span class="token punctuation">.</span><span class="token function">selectBookById</span><span class="token punctuation">(</span>bookId<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">updateBook</span><span class="token punctuation">(</span><span class="token class-name">BookInfo</span> bookInfo<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
     <span class="token keyword">return</span> bookInfoMapper<span class="token punctuation">.</span><span class="token function">updateBook</span><span class="token punctuation">(</span>bookInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>查询图书的时候,只需要把图书id传给Mapper层即可.更新图书一样,也是直接把图书对象传给Mapper层即可.</p> 
<ul><li>Mapper层</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"select * from book_info where id = #{bookId}"</span><span class="token punctuation">)</span>
<span class="token class-name">BookInfo</span> <span class="token function">selectBookById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> bookId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Integer</span> <span class="token function">updateBook</span><span class="token punctuation">(</span><span class="token class-name">BookInfo</span> bookInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>查询图书的时候,我们使用注解来完成sql语句,但是更新图书的时候,只有id是必备选项,而其他属性都可以选择性更新.所以我们使用xml来完成sql.我们在这里需要使用到标签.</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--    更新的时候可以选择项目更新,不一定全部要更新--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateBook<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    update book_info
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bookName != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            book_name = #{bookName}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>author != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            author = #{author}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>count != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            count = #{count}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>price!= null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            price = #{price}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>publish != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            publish = #{publish}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>status != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            status = #{status}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">&gt;</span></span> where id = #{id}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>在传入的参数给对象中的属性赋值的时候,即对象拥有该属性的时候,就更新该字段,否则不更新.</p> 
<h3><a id="47__733"></a>4.7 删除图书接口</h3> 
<p>我们前面提到,删除分为逻辑删除和物理删除.我们这里使用的是逻辑删除.这里的删除就是把图书的状态(status)修改一下.</p> 
<ul><li>接口文档</li></ul> 
<pre><code>[请求]
/book/updateBook
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
[参数]
id=1&amp;status=0
[响应]
true or false
</code></pre> 
<p>由于这里的逻辑和更新图书的逻辑完全一样,我们不再赘述.</p> 
<h3><a id="48__746"></a>4.8 批量删除接口</h3> 
<p>批量删除图书,其实就是批量修改图书的状态.</p> 
<ul><li>接口文档</li></ul> 
<pre><code>[请求]
/book/batchDeleteBook
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
[参数] 
[响应]
true or false
</code></pre> 
<p>点击[批量删除]按钮时,只需要把复选框选中的图书的ID,发送到后端即可.多个id,我们使用List的形式来传递参数</p> 
<ul><li>Controller层</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/batchDeleteBook"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">beachDeleteBook</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ids <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> ids<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//没有要删除的图书</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Integer</span> ret <span class="token operator">=</span> bookInfoService<span class="token punctuation">.</span><span class="token function">beachDeleteBooks</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"批量删除失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>传入需要删除的图书id,之后判断ids是否为null或者ids为空,说明没有要删除的图书,返回true.之后把ids传给Service层,要是返回结果是0,说名没有图书被删除,返回false.否者返回true.</p> 
<ul><li>Service层</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">beachDeleteBooks</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
   <span class="token keyword">return</span> bookInfoMapper<span class="token punctuation">.</span><span class="token function">beachDeleteBooks</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>直接把id传给Mapper层</p> 
<ul><li>Mapper层<br> Mapper层我们依然使用xml的方式实现.因为需要遍历list,我们需要使用<code>&lt;foreach&gt;</code>标签.</li></ul> 
<pre><code class="prism language-java"><span class="token class-name">Integer</span> <span class="token function">beachDeleteBooks</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> ids<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>beachDeleteBooks<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    update book_info set status = 0 where id in
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ids<span class="token punctuation">"</span></span> <span class="token attr-name">open</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(<span class="token punctuation">"</span></span> <span class="token attr-name">close</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>)<span class="token punctuation">"</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        #{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="49__796"></a>4.9 强制登录</h3> 
<p>虽然我们做了用户登录,但是我们发现,用户不登录,依然可以操作图书.<br> 这是有极大风险的.所以我们需要进行强制登录.<br> 如果用户未登录就访问图书列表或者添加图书等页面,强制跳转到登录页面.</p> 
<ul><li>实现思路<br> 在用户登录的时候,用户把用户的信息存储在了session中,这时候我们<strong>使用统一功能中的拦截器,对除了登录页面的接口统一拦截.判断session中是否存在用户的信息</strong>.存在就说明用户已经登录,没有就说明没用登录.</li><li>返回结果封装<br> 我们不妨对所有后端的数据进行封装为Result.并添加对不同的状态的方法,方法中对Result的属性进行设置.</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Results</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//200-成功 -1-用户未登录 -2后端结果错误</span>
    <span class="token keyword">public</span> <span class="token class-name">Status</span> code<span class="token punctuation">;</span><span class="token comment">//状态码</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span><span class="token comment">//状态信息</span>
    <span class="token keyword">public</span> <span class="token class-name">T</span> data<span class="token punctuation">;</span><span class="token comment">//返回页面的数据</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Results</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">T</span> data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Results</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> results <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Results</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        results<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">Status</span><span class="token punctuation">.</span><span class="token constant">SUCCESS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        results<span class="token punctuation">.</span><span class="token function">setMsg</span><span class="token punctuation">(</span><span class="token string">"正常"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        results<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> results<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Results</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">noLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Results</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> results <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Results</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        results<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">Status</span><span class="token punctuation">.</span><span class="token constant">NOLOGIN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        results<span class="token punctuation">.</span><span class="token function">setMsg</span><span class="token punctuation">(</span><span class="token string">"用户未登录"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> results<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Results</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Results</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> results <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Results</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        results<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span><span class="token class-name">Status</span><span class="token punctuation">.</span><span class="token constant">ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        results<span class="token punctuation">.</span><span class="token function">setMsg</span><span class="token punctuation">(</span><span class="token string">"内部错误"</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> results<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>其中Status是后端逻辑处理的状态码,我们可以通过一个枚举类来封装.</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Status</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">SUCCESS</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">NOLOGIN</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"用户未登录"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ERROR</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"后端返回结果错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Getter</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Getter</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>定义拦截器</li></ul> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 登录拦截器
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>session <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constant</span><span class="token punctuation">.</span><span class="token constant">SESSION_USER_KEY</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"用户未登录"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">Results</span><span class="token punctuation">.</span><span class="token function">noLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>实现<code>HandlerInterceptor</code>接口,重写<code>preHandle</code>方法.<br> 首先从request中拿到session,<strong>其中参数要设置为false</strong>,防止session不存在自动创建.从session中获取用户信息,用户信息存储在<code>SESSION_USER_KEY</code>中,如果该字段的信息为空,或者是session不存在的时候,说明没有登录,返回false进行拦截.设置Response的状态码为401,在Response的字节流中输入错误信息.该错误信息由Result类中的nologin方法生成.<br> 如果获取到了用户信息,则放行.</p> 
<ul><li>注册拦截器</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">LoginInterceptor</span> loginInterceptor<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>loginInterceptor<span class="token punctuation">)</span>
        		<span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/user/login"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/css/**"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/js/**"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/pic/**"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/**/*.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>实现<code>WebMvcConfigurer</code>接口,并重写<code>addInterceptors</code>方法,之后在形式参数中,使用<code>addInterceptor</code>方法添加拦截器,并使用<code>excludePathPatterns</code>和<code>addPathPatterns</code>对该拦截器的进行配置.拦截的可以是url,也可以是文件路径.不拦截登录页面和前端的所有页面.</p> 
<ul><li>统一返回结果</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestControllerAdvice</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResponseAdvice</span> <span class="token keyword">implements</span> <span class="token class-name">ResponseBodyAdvice</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ObjectMapper</span> mapper<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@SneakyThrows</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">beforeBodyWrite</span><span class="token punctuation">(</span><span class="token class-name">Object</span> body<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">MediaType</span> selectedContentType<span class="token punctuation">,</span> <span class="token class-name">Class</span> selectedConverterType<span class="token punctuation">,</span> <span class="token class-name">ServerHttpRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServerHttpResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//如果返回结果是String类型的,需要转换为json格式</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>body <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> mapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span><span class="token class-name">Results</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//返回结果是Results类型,则不需要对结果进行封装</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>body <span class="token keyword">instanceof</span> <span class="token class-name">Results</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> body<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">Results</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">Class</span> converterType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>实现<code>ResponseBodyAdvice</code>接口,重写<code>beforeBodyWrite</code>方法.<br> 这里我们需要注意的是对<strong>返回Body是字符串类型的需要进行特殊处理,需要把返回结果转换为json格式</strong>.要是返回的结果就是Result类型,直接返回body,如果是其他的类型,需要body封装进Result类型中,并调用success方法.</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9ee5be31be2d1e20c9feab2f8243e7ef/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">简述下分布式和集群的区别？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f388653c6b965ad4f9bec44bf742a21a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【力扣】3143.正方形中的最多点数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>