<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>纯前端--原生js将html页面变成pdf文件（html2canvas&#43;jsPDF） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/b649e8d728f0ebd04ad23109ba4f1ea5/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="纯前端--原生js将html页面变成pdf文件（html2canvas&#43;jsPDF）">
  <meta property="og:description" content="一、html2canvas – 将dom变成图片： 下载或者安装html2canvas：官网 1、将文档放在本地，用原生js进行引用和使用。 ① 新建一个名为 html2canvas.min.js 的文件，并且将线上的内容进行复制。
② 引入 js 文件：
// js直接引入 -- 未尝试 &lt;script type=&#34;text/javascript&#34; src=&#34;XXX/html2canvas.js&#34;&gt;&lt;/script&gt; // layui使用 // 首先在html2canvas.js文件中添加exports layui.define([],function(exports){ // 复制的内容... exports(&#39;html2canvas&#39;,html2canvas); }) // 其次进行自定义插件的引入 layui.define([&#39;appsmenu&#39;],function (exports) { exports(&#34;conf&#34;, { // 第三方扩展 extend: { // 引入html转图片的插件 html2canvas: &#34;lay/extends/html2canvas.min&#34;, } } }) 2、使用 npm 进行安装使用： 待续。。。
二、jsPDF – 将图片变成pdf： 下载或者安装jsPDF ： github中文网站CDN Jspdf.es.js：ES 2015 模块格式。Jspdf.umd.js：UMD模块格式，用于 AMD 或脚本标签加载。Jspdf.polyfills.js：Internet Explorer等旧浏览器所需的兼容文件。 1、将文档放在本地，用原生js进行引用和使用。 ① 新建一个名为 jsPDF.min.js 的文件，并且将线上（我找到的都不能用）或者资源 的内容进行复制。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-08-17T10:15:20+08:00">
    <meta property="article:modified_time" content="2023-08-17T10:15:20+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">纯前端--原生js将html页面变成pdf文件（html2canvas&#43;jsPDF）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="html2canvas__dom_0"></a>一、html2canvas – 将dom变成图片：</h2> 
<h3><a id="html2canvashttphtml2canvashertzencom_1"></a>下载或者安装html2canvas：<a href="http://html2canvas.hertzen.com/" rel="nofollow">官网</a></h3> 
<h5><a id="1js_2"></a>1、将文档放在本地，用原生js进行引用和使用。</h5> 
<p>① 新建一个名为 <code>html2canvas.min.js</code> 的文件，并且将<a href="http://html2canvas.hertzen.com/dist/html2canvas.js" rel="nofollow">线上的内容</a>进行复制。<br> ② 引入 js 文件：</p> 
<pre><code class="prism language-javascript"><span class="token comment">// js直接引入 -- 未尝试</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> src<span class="token operator">=</span><span class="token string">"XXX/html2canvas.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>


<span class="token comment">// layui使用</span>
<span class="token comment">// 首先在html2canvas.js文件中添加exports</span>
layui<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 复制的内容...</span>
    <span class="token function">exports</span><span class="token punctuation">(</span><span class="token string">'html2canvas'</span><span class="token punctuation">,</span>html2canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 其次进行自定义插件的引入</span>
layui<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'appsmenu'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">exports</span><span class="token punctuation">(</span><span class="token string">"conf"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
	    <span class="token comment">// 第三方扩展</span>
		<span class="token literal-property property">extend</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 引入html转图片的插件</span>
			<span class="token literal-property property">html2canvas</span><span class="token operator">:</span> <span class="token string">"lay/extends/html2canvas.min"</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="2_npm__27"></a>2、使用 <code>npm</code> 进行安装使用：</h5> 
<p>待续。。。</p> 
<h2><a id="jsPDF__pdf_29"></a>二、jsPDF – 将图片变成pdf：</h2> 
<h3><a id="jsPDF__30"></a>下载或者安装jsPDF ：</h3> 
<ul><li><a href="https://gitcode.net/mirrors/MrRio/jsPDF?utm_source=csdn_github_accelerator" rel="nofollow">github</a></li><li><a href="http://www.rotisedapsales.com/snr/cloud2/website/jsPDF-master/docs/index.html" rel="nofollow">中文网站</a></li><li><a href="http://www.staticfile.org/" rel="nofollow">CDN</a> 
  <ul><li>Jspdf.es.js：ES 2015 模块格式。</li><li>Jspdf.umd.js：UMD模块格式，用于 AMD 或脚本标签加载。</li><li>Jspdf.polyfills.js：Internet Explorer等旧浏览器所需的兼容文件。</li></ul> </li></ul> 
<h5><a id="1js_37"></a>1、将文档放在本地，用原生js进行引用和使用。</h5> 
<p>① 新建一个名为 <code>jsPDF.min.js</code> 的文件，并且将线上（我找到的都不能用）或者<a href="https://download.csdn.net/download/weixin_56718509/87724599">资源</a> 的内容进行复制。<br> ② 引入 js 文件：</p> 
<pre><code class="prism language-javascript"><span class="token comment">// js直接引入 -- 未尝试</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> src<span class="token operator">=</span><span class="token string">"XXX/jsPDF.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token comment">// CDN引入 -- 未尝试</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> src<span class="token operator">=</span><span class="token string">"https://cdn.staticfile.org/jspdf/2.5.1/jspdf.umd.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>


<span class="token comment">// layui使用</span>
<span class="token comment">// 首先在jsPDF.min.js文件中添加exports</span>
layui<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">exports</span><span class="token punctuation">(</span><span class="token string">'jsPDF'</span><span class="token punctuation">,</span>jsPDF<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 其次进行自定义插件的引入</span>
layui<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'appsmenu'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">exports</span><span class="token punctuation">(</span><span class="token string">"conf"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
	    <span class="token comment">// 第三方扩展</span>
		<span class="token literal-property property">extend</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 引入图片转pdf的插件</span>
			<span class="token literal-property property">jsPDF</span><span class="token operator">:</span> <span class="token string">"lay/extends/jsPDF.min"</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="2_npm__63"></a>2、使用 <code>npm</code> 进行安装使用：</h5> 
<p>待续。。。</p> 
<h2><a id="html2canvasjsPDF_65"></a>三、普通使用（html2canvas+jsPDF）：</h2> 
<h5><a id="1_layui_js_66"></a>1、 <code>layui</code> 或者<code>原生js</code>使用：</h5> 
<pre><code class="prism language-javascript"><span class="token comment">// html:</span>
<span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"box"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>下载为pdf<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    内容<span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token comment">// js:</span>
<span class="token comment">// layui引入：</span>
layui<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'html2canvas'</span><span class="token punctuation">,</span> <span class="token string">'jsPDF'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">var</span> html2canvas <span class="token operator">=</span> layui<span class="token punctuation">.</span>html2canvas<span class="token punctuation">;</span> <span class="token comment">// 引入html转图片</span>
	<span class="token keyword">var</span> jsPDF <span class="token operator">=</span> layui<span class="token punctuation">.</span>jsPDF<span class="token punctuation">;</span> <span class="token comment">// 引入图片转pdf</span>
	<span class="token comment">// 初始化</span>
	<span class="token keyword">var</span> <span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 点击下载按钮</span>
		document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"btn"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
				<span class="token function">html2canvas</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"box"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">allowTaint</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否允许跨域图像。会污染画布，导致无法使用canvas.toDataURL 方法</span>
					<span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">'#fff'</span><span class="token punctuation">,</span> <span class="token comment">// 画布背景色（如果未在DOM中指定）。设置null为透明</span>
					<span class="token literal-property property">useCORS</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否尝试使用CORS从服务器加载图像</span>
					<span class="token literal-property property">dpi</span><span class="token operator">:</span> <span class="token number">192</span><span class="token punctuation">,</span> <span class="token comment">// 导出pdf清晰度</span>
					<span class="token literal-property property">scale</span><span class="token operator">:</span> window<span class="token punctuation">.</span>devicePixelRatio <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 用于渲染的比例。默认为浏览器设备像素比率。</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">canvas</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token comment">// html生成图片的数据</span>
					<span class="token keyword">var</span> imageData <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/jpeg'</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// 原本的html页面的宽高</span>
					<span class="token keyword">const</span> canvasWidth <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
					<span class="token keyword">const</span> canvasHeight <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
					<span class="token comment">// 当分辨率是72像素/英寸时，A4纸像素长宽分别是842×595</span>
					<span class="token keyword">var</span> a4Width <span class="token operator">=</span> <span class="token number">595</span><span class="token punctuation">;</span> <span class="token comment">// A4 宽度</span>
					<span class="token keyword">var</span> a4Height <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">595</span> <span class="token operator">/</span> canvasWidth<span class="token punctuation">)</span> <span class="token operator">*</span> canvasHeight<span class="token punctuation">;</span> <span class="token comment">// A4总高度</span>
					<span class="token comment">// 生成pdf的一页显示html的高度</span>
					<span class="token keyword">let</span> pageHeight <span class="token operator">=</span> canvasWidth <span class="token operator">/</span> <span class="token number">595</span> <span class="token operator">*</span> <span class="token number">842</span><span class="token punctuation">;</span>
					<span class="token comment">// 未生成pdf的html页面高度，最初是整体的高度</span>
					<span class="token keyword">let</span> restHeight <span class="token operator">=</span> canvasHeight<span class="token punctuation">;</span>
					<span class="token comment">// 页面上下偏移的大小</span>
					<span class="token keyword">var</span> position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
					<span class="token comment">/**
					 * 参数1：方向：l：横向  p：纵向
					 * 参数2：单位："pt"、"mm"、"cm"、"m"、"in"、"px"
					 * 参数3：格式：默认为a4
					*/</span>
					<span class="token keyword">var</span> pdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">jsPDF</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'pt'</span><span class="token punctuation">,</span> <span class="token string">'a4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// 当内容未超过pdf一页显示的范围，无需分页</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>restHeight <span class="token operator">&lt;</span> pageHeight<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token comment">/**
						 * 将图像添加到PDF中
						 * 参数1：图片的url
						 * 参数2：图片的格式
						 * 参数3：图片上下偏移的大小
						 * 参数4：原始宽度
						 * 参数5：原始高度
						*/</span> 
						pdf<span class="token punctuation">.</span><span class="token function">addImage</span><span class="token punctuation">(</span>imageData<span class="token punctuation">,</span> <span class="token string">'JPEG'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> position<span class="token punctuation">,</span> a4Width<span class="token punctuation">,</span> a4Height <span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">while</span><span class="token punctuation">(</span>restHeight <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
							pdf<span class="token punctuation">.</span><span class="token function">addImage</span><span class="token punctuation">(</span>imageData<span class="token punctuation">,</span> <span class="token string">'JPEG'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> position<span class="token punctuation">,</span> a4Width<span class="token punctuation">,</span> a4Height<span class="token punctuation">)</span>
							restHeight <span class="token operator">-=</span> pageHeight<span class="token punctuation">;</span>
							position <span class="token operator">-=</span> <span class="token number">842</span><span class="token punctuation">;</span>
							<span class="token keyword">if</span><span class="token punctuation">(</span>restHeight <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
								<span class="token comment">// 在PDF文档中添加新页面</span>
								pdf<span class="token punctuation">.</span><span class="token function">addPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 保存为pdf格式的文件</span>
					pdf<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">'生成的pdf文件.pdf'</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">var</span> Class <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function-variable function">init</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">exports</span><span class="token punctuation">(</span><span class="token string">'XXX'</span><span class="token punctuation">,</span> Class<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre> 
<h5><a id="2_vuereact__146"></a>2、 <code>vue/react</code> 框架进行使用：</h5> 
<p>待续。。。</p> 
<h2><a id="html2canvasjsPDF___148"></a>四、模块分割（html2canvas+jsPDF – 文字会截断，除了让后端做，没找到别的解决办法，感觉后端的插件比前端的更好用…）：</h2> 
<p><a href="https://blog.csdn.net/qq_32244819/article/details/109678481">参考链接：https://blog.csdn.net/qq_32244819/article/details/109678481</a></p> 
<h6><a id="_150"></a><code>具体代码：</code></h6> 
<pre><code class="prism language-javascript">	<span class="token comment">// 点击下载按钮</span>
	document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"btn"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">outPutPdfFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 导出方法</span>
	<span class="token keyword">var</span> <span class="token function-variable function">outPutPdfFn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">const</span> <span class="token constant">A4_WIDTH</span> <span class="token operator">=</span> <span class="token number">592.28</span><span class="token punctuation">;</span> <span class="token comment">// A4纸的宽</span>
		<span class="token keyword">const</span> <span class="token constant">A4_HEIGHT</span> <span class="token operator">=</span> <span class="token number">841.89</span><span class="token punctuation">;</span> <span class="token comment">// A4纸的高</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'正在导出pdf，请稍候...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">let</span> target <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'box'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 需要打印的页面的dom</span>
		<span class="token keyword">let</span> pageHeight <span class="token operator">=</span> target<span class="token punctuation">.</span>scrollWidth <span class="token operator">/</span> <span class="token constant">A4_WIDTH</span> <span class="token operator">*</span> <span class="token constant">A4_HEIGHT</span><span class="token punctuation">;</span> <span class="token comment">// 根据比例换算一页的高度</span>
		<span class="token comment">// 获取分割的dom，即class类名为splitItem的dom</span>
		<span class="token keyword">let</span> splitItemAll <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'splitItem'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 进行分割操作，当分块的内容超出a4纸的高度，则在这个块之前插入一个空白的块，将原有的块下移进行分割</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> splitItemAll<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 计算当前模块需要分成几部分</span>
			<span class="token keyword">let</span> modulesNum <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span>splitItemAll<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>offsetTop <span class="token operator">+</span> splitItemAll<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>offsetHeight<span class="token punctuation">)</span> <span class="token operator">/</span> pageHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSplit</span><span class="token punctuation">(</span>splitItemAll<span class="token punctuation">,</span> i<span class="token punctuation">,</span> modulesNum <span class="token operator">*</span> pageHeight<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">let</span> divParent <span class="token operator">=</span> splitItemAll<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span> <span class="token comment">// 获取当前需要分割块的父节点</span>
				<span class="token keyword">let</span> newNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				newNode<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'emptyDiv'</span><span class="token punctuation">;</span>
				newNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">'#ffffff'</span><span class="token punctuation">;</span>
				<span class="token comment">// 计算需要插入块的高度</span>
				<span class="token keyword">let</span> _H <span class="token operator">=</span> modulesNum <span class="token operator">*</span> pageHeight <span class="token operator">-</span> <span class="token punctuation">(</span>splitItemAll<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>offsetTop <span class="token operator">+</span> splitItemAll<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>offsetHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
				newNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> _H <span class="token operator">+</span> <span class="token string">'px'</span><span class="token punctuation">;</span>
				newNode<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token string">'100%'</span><span class="token punctuation">;</span>
				<span class="token keyword">let</span> nextDom <span class="token operator">=</span> splitItemAll<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nextSibling<span class="token punctuation">;</span> <span class="token comment">// 获取当前需要分割块的下一个兄弟节点</span>
				<span class="token comment">// 判断兄弟节点是否存在</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nextDom<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>nextDom<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token comment">// 存在则将新节点插入到下一个兄弟节点的前面</span>
					divParent<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>newNode<span class="token punctuation">,</span> nextDom<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
					<span class="token comment">// 不存在则直接添加</span>
					divParent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token function">getPdf</span><span class="token punctuation">(</span><span class="token string">'导出pdf'</span><span class="token punctuation">,</span> <span class="token string">'box'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/**
	 * 计算当前内容是否跨越了a4大小，以此分割
	 * @params nodes 拿到的所有需要分割的dom
	 * @params index 当前需要分割内容的索引
	 * @params pageHeight A4纸的高度
	*/</span>
	<span class="token keyword">var</span> <span class="token function-variable function">isSplit</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">nodes<span class="token punctuation">,</span> index<span class="token punctuation">,</span> pageHeight</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 当前需要分割的内容：内容高度+内容距离页面定位父元素（/body）的高度 &lt; 页面的高度</span>
		<span class="token comment">// 当前需要分割的内容的下一个兄弟节点：内容高度+内容距离页面定位父元素（/body）的高度 &gt; 页面的高度</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>nodes<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>offsetTop <span class="token operator">+</span> nodes<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">.</span>offsetHeight <span class="token operator">&lt;</span> pageHeight <span class="token operator">&amp;&amp;</span> nodes<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> nodes<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>offsetTop <span class="token operator">+</span> nodes<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>offsetHeight <span class="token operator">&gt;</span> pageHeight<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 导出pdf</span>
	<span class="token keyword">var</span> <span class="token function-variable function">getPdf</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">title<span class="token punctuation">,</span> dom</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">html2canvas</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span>
			<span class="token literal-property property">allowTaint</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否允许跨域图像。会污染画布，导致无法使用canvas.toDataURL 方法</span>
			<span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">'#fff'</span><span class="token punctuation">,</span> <span class="token comment">// 画布背景色（如果未在DOM中指定）。设置null为透明</span>
			<span class="token literal-property property">useCORS</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否尝试使用CORS从服务器加载图像</span>
			<span class="token literal-property property">dpi</span><span class="token operator">:</span> <span class="token number">192</span><span class="token punctuation">,</span> <span class="token comment">// 导出pdf清晰度</span>
			<span class="token literal-property property">scale</span><span class="token operator">:</span> window<span class="token punctuation">.</span>devicePixelRatio <span class="token operator">*</span> <span class="token number">3</span>   <span class="token comment">// 用于渲染的比例。默认为浏览器设备像素比率。增加清晰度</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">canvas</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// html生成图片的数据</span>
			<span class="token keyword">var</span> imageData <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/jpeg'</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 原本的html页面的宽高</span>
			<span class="token keyword">const</span> canvasWidth <span class="token operator">=</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">;</span>
			<span class="token keyword">const</span> canvasHeight <span class="token operator">=</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
			<span class="token comment">// 当分辨率是72像素/英寸时，A4纸像素长宽分别是842×595</span>
			<span class="token keyword">var</span> a4Width <span class="token operator">=</span> <span class="token number">592.28</span><span class="token punctuation">;</span> <span class="token comment">// A4 宽度</span>
			<span class="token keyword">var</span> a4Height <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">592.28</span> <span class="token operator">/</span> canvasWidth<span class="token punctuation">)</span> <span class="token operator">*</span> canvasHeight<span class="token punctuation">;</span> <span class="token comment">// A4总高度</span>
			<span class="token comment">// 生成pdf的一页显示html的高度</span>
			<span class="token keyword">let</span> pageHeight <span class="token operator">=</span> canvasWidth <span class="token operator">/</span> <span class="token number">592.28</span> <span class="token operator">*</span> <span class="token number">841.89</span><span class="token punctuation">;</span>
			<span class="token comment">// 未生成pdf的html页面高度，最初是整体的高度</span>
			<span class="token keyword">let</span> restHeight <span class="token operator">=</span> canvasHeight<span class="token punctuation">;</span>
			<span class="token comment">// 页面上下偏移的大小</span>
			<span class="token keyword">var</span> position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token comment">/**
			 * 参数1：方向：l：横向  p：纵向
			 * 参数2：单位："pt"、"mm"、"cm"、"m"、"in"、"px"
			 * 参数3：格式：默认为a4
			*/</span>
			<span class="token keyword">var</span> pdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">jsPDF</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'pt'</span><span class="token punctuation">,</span> <span class="token string">'a4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 当内容未超过pdf一页显示的范围，无需分页</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>restHeight <span class="token operator">&lt;</span> pageHeight<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">/**
				 * 将图像添加到PDF中
				 * 参数1：图片的url
				 * 参数2：图片的格式
				 * 参数3：图片上下偏移的大小
				 * 参数4：原始宽度
				 * 参数5：原始高度
				*/</span> 
				pdf<span class="token punctuation">.</span><span class="token function">addImage</span><span class="token punctuation">(</span>imageData<span class="token punctuation">,</span> <span class="token string">'JPEG'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> position<span class="token punctuation">,</span> a4Height <span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">while</span><span class="token punctuation">(</span>restHeight <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					pdf<span class="token punctuation">.</span><span class="token function">addImage</span><span class="token punctuation">(</span>imageData<span class="token punctuation">,</span> <span class="token string">'JPEG'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> position<span class="token punctuation">,</span> a4Width<span class="token punctuation">,</span> a4Height<span class="token punctuation">)</span>
					restHeight <span class="token operator">-=</span> pageHeight<span class="token punctuation">;</span>
					position <span class="token operator">-=</span> <span class="token number">841.89</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>restHeight <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token comment">// 在PDF文档中添加新页面</span>
						pdf<span class="token punctuation">.</span><span class="token function">addPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 保存为pdf格式的文件</span>
			pdf<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.pdf</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="echarts_262"></a>五、echarts图表模糊的解决办法：</h2> 
<pre><code class="prism language-javascript"><span class="token comment">// 方法一：初始化echarts的时候，添加清晰度配置 devicePixelRatio</span>
echarts<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>chartDom<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">devicePixelRatio</span><span class="token operator">:</span> window<span class="token punctuation">.</span>devicePixelRatio <span class="token operator">*</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 方法二：使用svg渲染，这个效果更好，就是需要调整grid，不然图表不完整</span>
<span class="token comment">// echarts.init(chartDom, null, { renderer: "svg" })</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/874e92ca7fee287ce4634dd254944a12/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">YOLO训练自己的数据集 | 格式转换 | JSON、TXT、XML文件的相互转换</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5987d7c8619f689589a9460dd9194624/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Python】解决 pip 开了网络代理之后无法安装包的问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>