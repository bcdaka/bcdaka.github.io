<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AI大模型探索之路-实战篇：智能化IT领域搜索引擎之知乎网站数据获取（初步实践） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/c118e14cbde2b2b6d05e8a8573132885/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="AI大模型探索之路-实战篇：智能化IT领域搜索引擎之知乎网站数据获取（初步实践）">
  <meta property="og:description" content="系列篇章💥 No.文章1AI大模型探索之路-实战篇：智能化IT领域搜索引擎的构建与初步实践2AI大模型探索之路-实战篇：智能化IT领域搜索引擎之GLM-4大模型技术的实践探索3AI大模型探索之路-实战篇：智能化IT领域搜索引擎之知乎网站数据获取（初步实践）4AI大模型探索之路-实战篇：智能化IT领域搜索引擎之知乎网站数据获取（函数封装）5AI大模型探索之路-实战篇：智能化IT领域搜索引擎之知乎网站数据获取（流程优化）6AI大模型探索之路-实战篇：智能化IT领域搜索引擎之github网站在线搜索7AI大模型探索之路-实战篇：智能化IT领域搜索引擎之HuggingFace网站在线搜索 目录 系列篇章💥一、前言二、总体概览三、搜索API封装测试1、导入依赖并初始化客户端2、大模型回答问题策略测试3、function calling函数测试4、谷歌搜索API开发 四、知乎网站数据爬取1、数据格式定义2、设置知乎排除的网站3、Google api调用测试4、爬虫之Cookie获取5、爬虫之user-agent6、爬虫之获取PATH7、网络爬虫代码编写8、question类型的网站爬虫测试9、网页数据保存10、question/answer网站爬虫测试11、专栏类网站爬虫测试 结语 一、前言 在先前的文章中，我们完成了智能化IT领域搜索引擎的基础架构设计以及Google Search API的申请等前期准备工作。同时，我们还实践测试了GLM4的Function Calling能力，为后续的开发奠定了坚实的基础。本文将正式进入代码开发阶段，首先从知乎网站的数据搜索开始。
二、总体概览 本文将详细阐述如何逐步实现知乎网站数据获取的整个流程。我们将从知乎网站的结构分析入手，通过编写高效的网络爬虫程序，实现对知乎问题的智能检索，并利用先进的数据分析技术，对获取的数据进行深度挖掘和整合，最终将这些有价值的信息融入我们的智能化IT领域搜索引擎中，为用户提供更全面、准确的搜索结果。这一过程中，我们将不断优化算法，提升数据获取的效率和准确性，确保搜索引擎的智能化水平得到持续提升。
三、搜索API封装测试 1、导入依赖并初始化客户端 导入依赖
! pip install --upgrade zhipuai ! pip install --upgrade google-auth google-auth-httplib2 google-auth-oauthlib google-api-python-client requests 创建客户端
import os import openai from openai import OpenAI import glob import shutil import numpy as np import pandas as pd import json import io import inspect import requests import re import random import string from googleapiclient.discovery import build from google.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-14T09:03:46+08:00">
    <meta property="article:modified_time" content="2024-06-14T09:03:46+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AI大模型探索之路-实战篇：智能化IT领域搜索引擎之知乎网站数据获取（初步实践）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_2"></a>系列篇章💥</h2> 
<table><thead><tr><th align="left">No.</th><th align="left">文章</th></tr></thead><tbody><tr><td align="left">1</td><td align="left"><a href="https://xundaomalu.blog.csdn.net/article/details/139605522" rel="nofollow">AI大模型探索之路-实战篇：智能化IT领域搜索引擎的构建与初步实践</a></td></tr><tr><td align="left">2</td><td align="left"><a href="https://xundaomalu.blog.csdn.net/article/details/139652339" rel="nofollow">AI大模型探索之路-实战篇：智能化IT领域搜索引擎之GLM-4大模型技术的实践探索</a></td></tr><tr><td align="left">3</td><td align="left"><a href="https://xundaomalu.blog.csdn.net/article/details/139668701" rel="nofollow">AI大模型探索之路-实战篇：智能化IT领域搜索引擎之知乎网站数据获取（初步实践）</a></td></tr><tr><td align="left">4</td><td align="left">AI大模型探索之路-实战篇：智能化IT领域搜索引擎之知乎网站数据获取（函数封装）</td></tr><tr><td align="left">5</td><td align="left">AI大模型探索之路-实战篇：智能化IT领域搜索引擎之知乎网站数据获取（流程优化）</td></tr><tr><td align="left">6</td><td align="left">AI大模型探索之路-实战篇：智能化IT领域搜索引擎之github网站在线搜索</td></tr><tr><td align="left">7</td><td align="left">AI大模型探索之路-实战篇：智能化IT领域搜索引擎之HuggingFace网站在线搜索</td></tr></tbody></table> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_2" rel="nofollow">系列篇章💥</a></li><li><a href="#_19" rel="nofollow">一、前言</a></li><li><a href="#_22" rel="nofollow">二、总体概览</a></li><li><a href="#API_24" rel="nofollow">三、搜索API封装测试</a></li><li><ul><li><a href="#1_25" rel="nofollow">1、导入依赖并初始化客户端</a></li><li><a href="#2_72" rel="nofollow">2、大模型回答问题策略测试</a></li><li><a href="#3function_calling_106" rel="nofollow">3、function calling函数测试</a></li><li><a href="#4API_322" rel="nofollow">4、谷歌搜索API开发</a></li></ul> 
  </li><li><a href="#_450" rel="nofollow">四、知乎网站数据爬取</a></li><li><ul><li><a href="#1_451" rel="nofollow">1、数据格式定义</a></li><li><a href="#2_478" rel="nofollow">2、设置知乎排除的网站</a></li><li><a href="#3Google_api_487" rel="nofollow">3、Google api调用测试</a></li><li><a href="#4Cookie_499" rel="nofollow">4、爬虫之Cookie获取</a></li><li><a href="#5useragent_513" rel="nofollow">5、爬虫之user-agent</a></li><li><a href="#6PATH_529" rel="nofollow">6、爬虫之获取PATH</a></li><li><a href="#7_541" rel="nofollow">7、网络爬虫代码编写</a></li><li><a href="#8question_587" rel="nofollow">8、question类型的网站爬虫测试</a></li><li><a href="#9_631" rel="nofollow">9、网页数据保存</a></li><li><a href="#10questionanswer_663" rel="nofollow">10、question/answer网站爬虫测试</a></li><li><a href="#11_690" rel="nofollow">11、专栏类网站爬虫测试</a></li></ul> 
  </li><li><a href="#_715" rel="nofollow">结语</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_19"></a>一、前言</h2> 
<p>在先前的文章中，我们完成了智能化IT领域搜索引擎的基础架构设计以及Google Search API的申请等前期准备工作。同时，我们还实践测试了GLM4的Function Calling能力，为后续的开发奠定了坚实的基础。本文将正式进入代码开发阶段，首先从知乎网站的数据搜索开始。</p> 
<h2><a id="_22"></a>二、总体概览</h2> 
<p>本文将详细阐述如何逐步实现知乎网站数据获取的整个流程。我们将从知乎网站的结构分析入手，通过编写高效的网络爬虫程序，实现对知乎问题的智能检索，并利用先进的数据分析技术，对获取的数据进行深度挖掘和整合，最终将这些有价值的信息融入我们的智能化IT领域搜索引擎中，为用户提供更全面、准确的搜索结果。这一过程中，我们将不断优化算法，提升数据获取的效率和准确性，确保搜索引擎的智能化水平得到持续提升。</p> 
<h2><a id="API_24"></a>三、搜索API封装测试</h2> 
<h3><a id="1_25"></a>1、导入依赖并初始化客户端</h3> 
<p>导入依赖</p> 
<pre><code class="prism language-python">! pip install <span class="token operator">-</span><span class="token operator">-</span>upgrade zhipuai
! pip install <span class="token operator">-</span><span class="token operator">-</span>upgrade google<span class="token operator">-</span>auth google<span class="token operator">-</span>auth<span class="token operator">-</span>httplib2 google<span class="token operator">-</span>auth<span class="token operator">-</span>oauthlib google<span class="token operator">-</span>api<span class="token operator">-</span>python<span class="token operator">-</span>client requests
</code></pre> 
<p>创建客户端</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> openai
<span class="token keyword">from</span> openai <span class="token keyword">import</span> OpenAI
<span class="token keyword">import</span> glob
<span class="token keyword">import</span> shutil

<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token keyword">import</span> json
<span class="token keyword">import</span> io
<span class="token keyword">import</span> inspect
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> re
<span class="token keyword">import</span> random
<span class="token keyword">import</span> string

<span class="token keyword">from</span> googleapiclient<span class="token punctuation">.</span>discovery <span class="token keyword">import</span> build
<span class="token keyword">from</span> google<span class="token punctuation">.</span>oauth2<span class="token punctuation">.</span>credentials <span class="token keyword">import</span> Credentials
<span class="token keyword">from</span> google_auth_oauthlib<span class="token punctuation">.</span>flow <span class="token keyword">import</span> InstalledAppFlow
<span class="token keyword">import</span> base64


<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> dateutil<span class="token punctuation">.</span>parser <span class="token keyword">as</span> parser
<span class="token keyword">import</span> tiktoken
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree

<span class="token comment">## 初始化客户端</span>
api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"ZHIPU_API_KEY"</span><span class="token punctuation">)</span>


<span class="token keyword">from</span> zhipuai <span class="token keyword">import</span> ZhipuAI
client <span class="token operator">=</span> ZhipuAI<span class="token punctuation">(</span>api_key<span class="token operator">=</span>api_key<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="2_72"></a>2、大模型回答问题策略测试</h3> 
<p>测试一</p> 
<pre><code class="prism language-python">response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
  model<span class="token operator">=</span><span class="token string">"glm-4"</span><span class="token punctuation">,</span>
  messages<span class="token operator">=</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"根据用户输入的问题进行回答，如果知道问题的答案，请回答问题答案，如果不知道问题答案，请回复‘抱歉，这个问题我并不知道’"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"请问，什么是机器学习？"</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">)</span>
response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-python"><span class="token string">'机器学习是人工智能的一个核心领域，它让计算机能够模拟人类的学习和思考方式。通过使用大量数据和算法，机器学习可以使计算机学会分类、回归和聚类等任务，从而让计算机能够从数据中提取知识，进行决策和预测。在机器学习的流程中，包括数据获取、特征工程、建立模型、模型评估以及调参等步骤。深度学习和强化学习是机器学习的两个重要分支。深度学习主要用于处理复杂结构数据的建模问题，而强化学习则让机器在探索环境中通过试错进行学习。'</span>
</code></pre> 
<p>测试二</p> 
<pre><code class="prism language-python">response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
  model<span class="token operator">=</span><span class="token string">"glm-4"</span><span class="token punctuation">,</span>
  messages<span class="token operator">=</span><span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"根据用户输入的问题进行回答，如果知道问题的答案，请回答问题答案，如果不知道问题答案，请回复‘抱歉，这个问题我并不知道’"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"介绍一下关于GPT-6的猜想"</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">)</span>
response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content
</code></pre> 
<p>输出</p> 
<pre><code class="prism language-python"><span class="token string">'抱歉，这个问题我并不知道。\n\n到2023为止，GPT-6尚未被公开提及或发布。GPT（Generative Pre-trained Transformer）系列模型由OpenAI开发，至今已发布了多个版本，如GPT-2和GPT-3。关于未来版本的GPT，如GPT-6，可能会有很多猜想和预期，但具体的内容和功能我无法提供，因为那将基于未来尚未公开的技术和信息。如果GPT-6在您提问之后有了新的消息，我可能无法获取那些最新的信息。'</span>
</code></pre> 
<h3><a id="3function_calling_106"></a>3、function calling函数测试</h3> 
<p>增加外部函数测试一下，看大模型回答问题的时候是先去调用外部函数，还是先尝试自己回答。<br> 1）定义函数信息生成器</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">auto_functions</span><span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Chat模型的functions参数编写函数
    :param functions_list: 包含一个或者多个函数对象的列表；
    :return：满足Chat模型functions参数要求的functions对象
    """</span>
    <span class="token keyword">def</span> <span class="token function">functions_generate</span><span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 创建空列表，用于保存每个函数的描述字典</span>
        functions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># 对每个外部函数进行循环</span>
        <span class="token keyword">for</span> function <span class="token keyword">in</span> functions_list<span class="token punctuation">:</span>
            <span class="token comment"># 读取函数对象的函数说明</span>
            function_description <span class="token operator">=</span> inspect<span class="token punctuation">.</span>getdoc<span class="token punctuation">(</span>function<span class="token punctuation">)</span>
            <span class="token comment"># 读取函数的函数名字符串</span>
            function_name <span class="token operator">=</span> function<span class="token punctuation">.</span>__name__

            system_prompt <span class="token operator">=</span> <span class="token string">'以下是某的函数说明：%s,输出结果必须是一个JSON格式的字典，只输出这个字典即可，前后不需要任何前后修饰或说明的语句'</span> <span class="token operator">%</span> function_description
            user_prompt <span class="token operator">=</span> '根据这个函数的函数说明，请帮我创建一个JSON格式的字典，这个字典有如下<span class="token number">5</span>点要求：\
                           <span class="token number">1.</span>字典总共有三个键值对；\
                           <span class="token number">2.</span>第一个键值对的Key是字符串name，value是该函数的名字：<span class="token operator">%</span>s，也是字符串；\
                           <span class="token number">3.</span>第二个键值对的Key是字符串description，value是该函数的函数的功能说明，也是字符串；\
                           <span class="token number">4.</span>第三个键值对的Key是字符串parameters，value是一个JSON Schema对象，用于说明该函数的参数输入规范。\
                           <span class="token number">5.</span>输出结果必须是一个JSON格式的字典，只输出这个字典即可，前后不需要任何前后修饰或说明的语句' <span class="token operator">%</span> function_name

            response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                              model<span class="token operator">=</span><span class="token string">"glm-4"</span><span class="token punctuation">,</span>
                              messages<span class="token operator">=</span><span class="token punctuation">[</span>
                                <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"system"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> system_prompt<span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> user_prompt<span class="token punctuation">}</span>
                              <span class="token punctuation">]</span>
                            <span class="token punctuation">)</span>
            json_str<span class="token operator">=</span>response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"```json"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"```"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span>
            json_function_description<span class="token operator">=</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span>
            json_str<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"function"</span><span class="token punctuation">,</span><span class="token string">"function"</span><span class="token punctuation">:</span>json_function_description<span class="token punctuation">}</span>
            functions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span>
        <span class="token keyword">return</span> functions
    <span class="token comment">## 最大可以尝试4次</span>
    max_attempts <span class="token operator">=</span> <span class="token number">4</span>
    attempts <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">while</span> attempts <span class="token operator">&lt;</span> max_attempts<span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            functions <span class="token operator">=</span> functions_generate<span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span>
            <span class="token keyword">break</span>  <span class="token comment"># 如果代码成功执行，跳出循环</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            attempts <span class="token operator">+=</span> <span class="token number">1</span>  <span class="token comment"># 增加尝试次数</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"发生错误："</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
            <span class="token keyword">if</span> attempts <span class="token operator">==</span> max_attempts<span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"已达到最大尝试次数，程序终止。"</span><span class="token punctuation">)</span>
                <span class="token keyword">raise</span>  <span class="token comment"># 重新引发最后一个异常</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"正在重新运行..."</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> functions
</code></pre> 
<p>2）大模型API调用封装</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">run_conversation</span><span class="token punctuation">(</span>messages<span class="token punctuation">,</span> functions_list<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> model<span class="token operator">=</span><span class="token string">"glm-4"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    能够自动执行外部函数调用的对话模型
    :param messages: 必要参数，字典类型，输入到Chat模型的messages参数对象
    :param functions_list: 可选参数，默认为None，可以设置为包含全部外部函数的列表对象
    :param model: Chat模型，可选参数，默认模型为glm-4
    :return：Chat模型输出结果
    """</span>
    <span class="token comment"># 如果没有外部函数库，则执行普通的对话任务</span>
    <span class="token keyword">if</span> functions_list <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                        model<span class="token operator">=</span>model<span class="token punctuation">,</span>
                        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
                        <span class="token punctuation">)</span>
        response_message <span class="token operator">=</span> response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
        final_response <span class="token operator">=</span> response_message<span class="token punctuation">.</span>content
        
    <span class="token comment"># 若存在外部函数库，则需要灵活选取外部函数并进行回答</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># 创建functions对象</span>
        tools <span class="token operator">=</span> auto_functions<span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span>

        <span class="token comment"># 创建外部函数库字典</span>
        available_functions <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>func<span class="token punctuation">.</span>__name__<span class="token punctuation">:</span> func <span class="token keyword">for</span> func <span class="token keyword">in</span> functions_list<span class="token punctuation">}</span>

        <span class="token comment"># 第一次调用大模型</span>
        response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                        model<span class="token operator">=</span>model<span class="token punctuation">,</span>
                        messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
                        tools<span class="token operator">=</span>tools<span class="token punctuation">,</span>
                        tool_choice<span class="token operator">=</span><span class="token string">"auto"</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
        response_message <span class="token operator">=</span> response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message


        tool_calls <span class="token operator">=</span> response_message<span class="token punctuation">.</span>tool_calls

        <span class="token keyword">if</span> tool_calls<span class="token punctuation">:</span>

            <span class="token comment">#messages.append(response_message)</span>
            messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span>response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>model_dump<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> tool_call <span class="token keyword">in</span> tool_calls<span class="token punctuation">:</span>
                function_name <span class="token operator">=</span> tool_call<span class="token punctuation">.</span>function<span class="token punctuation">.</span>name
                function_to_call <span class="token operator">=</span> available_functions<span class="token punctuation">[</span>function_name<span class="token punctuation">]</span>
                function_args <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>tool_call<span class="token punctuation">.</span>function<span class="token punctuation">.</span>arguments<span class="token punctuation">)</span>
                <span class="token comment">## 真正执行外部函数的就是这儿的代码</span>
                function_response <span class="token operator">=</span> function_to_call<span class="token punctuation">(</span><span class="token operator">**</span>function_args<span class="token punctuation">)</span>
                messages<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"tool"</span><span class="token punctuation">,</span>
                        <span class="token string">"content"</span><span class="token punctuation">:</span> function_response<span class="token punctuation">,</span>
                        <span class="token string">"tool_call_id"</span><span class="token punctuation">:</span> tool_call<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">)</span> 
            <span class="token comment">## 第二次调用模型</span>
            second_response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
                model<span class="token operator">=</span>model<span class="token punctuation">,</span>
                messages<span class="token operator">=</span>messages<span class="token punctuation">,</span>
                tools<span class="token operator">=</span>tools
            <span class="token punctuation">)</span> 
            <span class="token comment"># 获取最终结果</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>second_response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span>
            final_response <span class="token operator">=</span> second_response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message<span class="token punctuation">.</span>content
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            final_response <span class="token operator">=</span> response_message<span class="token punctuation">.</span>content
                
    <span class="token keyword">return</span> final_response
</code></pre> 
<p>3）定义工具函数</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">ml_answer</span><span class="token punctuation">(</span>q<span class="token operator">=</span><span class="token string">'什么是机器学习'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    解释什么是机器学习，返回机器学习的定义和解释
    :param q: 询问的问题，非必要参数，字符串类型对象
    :return：返回机器学习的定义和解释
    """</span>
    <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token string">"机器学习是一种人工智能（AI）的分支领域，旨在使计算机系统通过学习和经验改进性能。"</span><span class="token punctuation">)</span>
</code></pre> 
<p>4）工具函数调用测试</p> 
<pre><code class="prism language-python">ml_answer<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token string">'机器学习是一种人工智能（AI）的分支领域，旨在使计算机系统通过学习和经验改进性能。'</span>
</code></pre> 
<pre><code class="prism language-python">functions_list <span class="token operator">=</span> <span class="token punctuation">[</span>ml_answer<span class="token punctuation">]</span>
tools <span class="token operator">=</span> auto_functions<span class="token punctuation">(</span>functions_list<span class="token punctuation">)</span>
tools
</code></pre> 
<p>查看输出结果可以看到，大模型已经找到了工具函数<br> <img src="https://images2.imgbox.com/88/66/V62EgXD6_o.png" alt="在这里插入图片描述"></p> 
<p>5）大模型调用测试1</p> 
<pre><code class="prism language-python">response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        model<span class="token operator">=</span><span class="token string">"glm-4"</span><span class="token punctuation">,</span>
        messages<span class="token operator">=</span><span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"解释什么是机器学习？"</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        tools<span class="token operator">=</span>tools<span class="token punctuation">,</span>
        tool_choice<span class="token operator">=</span><span class="token string">"auto"</span>
    <span class="token punctuation">)</span>
response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
</code></pre> 
<p><img src="https://images2.imgbox.com/19/c0/182l8nmV_o.png" alt="在这里插入图片描述"></p> 
<p>注意：我们发现，加入了外部函数以后，大模型回答同一个问题，有时候去调外部函数，有时候是自己去回答的。<br> 但是我们想要的效果是，问任何问题的时候，大模型先自己判断一下自己知不知道，如果知道，那就基于自己的知识进行回答<br> 如果自己不知道的时候采取调用外部函数回答问题。<br> 6）大模型调用测试2</p> 
<pre><code class="prism language-python">response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        model<span class="token operator">=</span><span class="token string">"glm-4"</span><span class="token punctuation">,</span>
        messages<span class="token operator">=</span><span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span><span class="token string">"system"</span><span class="token punctuation">,</span><span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"对于用户提的问题，如果知道就直接回答，不知道才通过调用外部函数回答"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"什么是机器学习?"</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        tools<span class="token operator">=</span>tools<span class="token punctuation">,</span>
        tool_choice<span class="token operator">=</span><span class="token string">"auto"</span>
    <span class="token punctuation">)</span>
response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
</code></pre> 
<p><img src="https://images2.imgbox.com/28/87/HzSpaqxq_o.png" alt="在这里插入图片描述"></p> 
<p>7）大模型调用测试3</p> 
<pre><code class="prism language-python">response <span class="token operator">=</span> client<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>completions<span class="token punctuation">.</span>create<span class="token punctuation">(</span>
        model<span class="token operator">=</span><span class="token string">"glm-4"</span><span class="token punctuation">,</span>
        messages<span class="token operator">=</span><span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span><span class="token string">"system"</span><span class="token punctuation">,</span><span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"对于用户提的问题，如果知道就直接回答，不知道才通过调用外部函数回答"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"什么是大模型?"</span><span class="token punctuation">}</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        tools<span class="token operator">=</span>tools<span class="token punctuation">,</span>
        tool_choice<span class="token operator">=</span><span class="token string">"auto"</span>
    <span class="token punctuation">)</span>
response<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>message
</code></pre> 
<p><img src="https://images2.imgbox.com/32/de/U6fI36yE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4API_322"></a>4、谷歌搜索API开发</h3> 
<p>1）API调用测试</p> 
<pre><code class="prism language-python">google_search_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"GOOGLE_SEARCH_API_KEY"</span><span class="token punctuation">)</span>
cse_id <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"CSE_ID"</span><span class="token punctuation">)</span>
search_term <span class="token operator">=</span> <span class="token string">"OpenAI"</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests

<span class="token comment"># Step 1.构建请求</span>
url <span class="token operator">=</span> <span class="token string">"https://www.googleapis.com/customsearch/v1"</span>

<span class="token comment"># Step 2.设置查询参数（还有很多参数）</span>
params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'q'</span><span class="token punctuation">:</span> search_term<span class="token punctuation">,</span>           <span class="token comment"># 搜索关键词</span>
    <span class="token string">'key'</span><span class="token punctuation">:</span> google_search_key<span class="token punctuation">,</span>   <span class="token comment"># 谷歌搜索API Key</span>
    <span class="token string">'cx'</span><span class="token punctuation">:</span> cse_id                <span class="token comment"># CSE ID</span>
<span class="token punctuation">}</span>

<span class="token comment"># Step 3.发送GET请求</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span>

<span class="token comment"># Step 4.解析响应</span>
data <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
data
</code></pre> 
<p><img src="https://images2.imgbox.com/b6/bb/4WEOJy5e_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python">data<span class="token punctuation">[</span><span class="token string">'items'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/19/f2/KFvgZ4Gp_o.png" alt="在这里插入图片描述"></p> 
<p>2）Google API封装</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">google_search</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> num_results<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> site_url<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    
    api_key <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"GOOGLE_SEARCH_API_KEY"</span><span class="token punctuation">)</span>
    cse_id <span class="token operator">=</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"CSE_ID"</span><span class="token punctuation">)</span>
    
    url <span class="token operator">=</span> <span class="token string">"https://www.googleapis.com/customsearch/v1"</span>

    <span class="token comment"># API 请求参数</span>
    <span class="token keyword">if</span> site_url <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'q'</span><span class="token punctuation">:</span> query<span class="token punctuation">,</span>          
        <span class="token string">'key'</span><span class="token punctuation">:</span> api_key<span class="token punctuation">,</span>      
        <span class="token string">'cx'</span><span class="token punctuation">:</span> cse_id<span class="token punctuation">,</span>        
        <span class="token string">'num'</span><span class="token punctuation">:</span> num_results   
        <span class="token punctuation">}</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'q'</span><span class="token punctuation">:</span> query<span class="token punctuation">,</span>         
        <span class="token string">'key'</span><span class="token punctuation">:</span> api_key<span class="token punctuation">,</span>      
        <span class="token string">'cx'</span><span class="token punctuation">:</span> cse_id<span class="token punctuation">,</span>        
        <span class="token string">'num'</span><span class="token punctuation">:</span> num_results<span class="token punctuation">,</span>  
        <span class="token string">'siteSearch'</span><span class="token punctuation">:</span> site_url
        <span class="token punctuation">}</span>

    <span class="token comment"># 发送请求</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span>
    response<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 解析响应</span>
    search_results <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'items'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># 提取所需信息</span>
    results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">'title'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'link'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">'link'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'snippet'</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">'snippet'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> search_results<span class="token punctuation">]</span>

    <span class="token keyword">return</span> results
</code></pre> 
<p>3）API调用测试</p> 
<pre><code class="prism language-python">search_term <span class="token operator">=</span> <span class="token string">"OpenAI"</span>
results <span class="token operator">=</span> google_search<span class="token punctuation">(</span>query<span class="token operator">=</span>search_term<span class="token punctuation">,</span> num_results<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
results
</code></pre> 
<p>输出：<br> <img src="https://images2.imgbox.com/b6/f0/TulxwkEM_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python">results <span class="token operator">=</span> google_search<span class="token punctuation">(</span>query<span class="token operator">=</span><span class="token string">'GLM4大模型有什么新特性？'</span><span class="token punctuation">,</span> num_results<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> site_url<span class="token operator">=</span><span class="token string">'https://www.zhihu.com/'</span><span class="token punctuation">)</span>
results
</code></pre> 
<p>输出：</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'智谱发布GLM-4 基座大模型，性能效果如何？ - 知乎'</span><span class="token punctuation">,</span>
  <span class="token string">'link'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com/question/639753877?write'</span><span class="token punctuation">,</span>
  <span class="token string">'snippet'</span><span class="token punctuation">:</span> <span class="token string">'Jan 16, 2024 ... ... 大小时，路坚终于出现了。「我这边终于有新进展了，你在学校吗？我要当面告诉你！」室友激动坏了，突然高喊了一声「我赢了」，把我吓一跳。这个小镇\xa0...'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'智谱发布GLM-4 基座大模型，性能效果如何？ - 新智元的回答- 知乎'</span><span class="token punctuation">,</span>
  <span class="token string">'link'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com/question/639753877/answer/3364585933'</span><span class="token punctuation">,</span>
  <span class="token string">'snippet'</span><span class="token punctuation">:</span> <span class="token string">'Jan 15, 2024 ... 它能够支持更长的上下文，具备更强的多模态 功能，支持更快的推理，更多并发，推理成本大大降低。 同时，GLM-4也增强了智能体能力。 基础能力. 从众多评测\xa0...'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'智谱发布GLM-4 基座大模型，性能效果如何？ - 杨夕的回答- 知乎'</span><span class="token punctuation">,</span>
  <span class="token string">'link'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com/question/639753877/answer/3364710951'</span><span class="token punctuation">,</span>
  <span class="token string">'snippet'</span><span class="token punctuation">:</span> <span class="token string">'Jan 15, 2024 ... 众所周知，在我国众多大型模型企业中，我一直对智谱AI抱有极高的好感。 这不仅是因为他们浓厚的学术氛围…'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'智谱AI 宣布基座大模型GLM-4 发布，该大模型有何功能？ - 知乎'</span><span class="token punctuation">,</span>
  <span class="token string">'link'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com/question/640050703'</span><span class="token punctuation">,</span>
  <span class="token string">'snippet'</span><span class="token punctuation">:</span> <span class="token string">'Jan 17, 2024 ... 1月16日下午消息，智谱AI首届技术开放日上，智谱AI宣布发布新一代基座大模型GLM-4。据介绍，GLM-4的整体…'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'智谱发布GLM-4 基座大模型，性能效果如何？ - 大林的回答- 知乎'</span><span class="token punctuation">,</span>
  <span class="token string">'link'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com/question/639753877/answer/3364780672'</span><span class="token punctuation">,</span>
  <span class="token string">'snippet'</span><span class="token punctuation">:</span> <span class="token string">'Jan 16, 2024 ... 智谱发布GLM-4 基座大模型，性能效果如何？ 量子位 ... 大模型的微调都是有益处的。 2、更长的上下文 ... 特性的基础之上，ChatGLM2-6B 引入了如下新特性：.'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'智谱发布GLM-4 基座大模型，性能效果如何？ - 数字生命卡兹克的 ...'</span><span class="token punctuation">,</span>
  <span class="token string">'link'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com/question/639753877/answer/3364475601'</span><span class="token punctuation">,</span>
  <span class="token string">'snippet'</span><span class="token punctuation">:</span> <span class="token string">'Jan 15, 2024 ... 再将它们全部打包在了一起。 比如我说一句：“搜索一下过去7天北京的天气，然后给我处理成一张表格让我可以下载”.'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'如何看待智谱AI发布GLM4？国产大模型与GPT-4更加接近了吗？ - 一 ...'</span><span class="token punctuation">,</span>
  <span class="token string">'link'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com/question/639787253/answer/3365580226'</span><span class="token punctuation">,</span>
  <span class="token string">'snippet'</span><span class="token punctuation">:</span> <span class="token string">'Jan 16, 2024 ... ... 新一代基座大模型GLM-4。 ➤GLM-4模型：性能逼近GPT-4. 先看总体的评测数据：. 在大规模多任务语言理解评测中，GLM-4得分远超GPT-3.5，平均达到GPT-4的\xa0...'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'chatGLM和chatGPT的技术区别在哪里？ - 李孟聊AI 的回答- 知乎'</span><span class="token punctuation">,</span>
  <span class="token string">'link'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com/question/604393963/answer/3367583114'</span><span class="token punctuation">,</span>
  <span class="token string">'snippet'</span><span class="token punctuation">:</span> <span class="token string">'Jun 1, 2023 ... \ufeff本文以GLM-4 发布功能作为基准对比ChatGPT4，Claude-2测试。 ... 新一代基座大模型GLM-4。 多模态理解. GLM-4 ... 目前ChatGLM是基于Base 模型进行有监督微调\xa0...'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'如何看待智谱AI发布GLM4？国产大模型与GPT-4更加接近了吗？ - 知乎'</span><span class="token punctuation">,</span>
  <span class="token string">'link'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com/question/639787253'</span><span class="token punctuation">,</span>
  <span class="token string">'snippet'</span><span class="token punctuation">:</span> <span class="token string">'Jan 16, 2024 ... 他立刻下载安装，试用后发现ChatGLM4 All Tools功能强大，使用方便，心中无比高兴。'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'智谱发布GLM-4 基座大模型，性能效果如何？ - GLM大模型的回答- 知乎'</span><span class="token punctuation">,</span>
  <span class="token string">'link'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhihu.com/question/639753877/answer/3365018019'</span><span class="token punctuation">,</span>
  <span class="token string">'snippet'</span><span class="token punctuation">:</span> <span class="token string">'Jan 16, 2024 ... GLMs &amp; MaaS API. GLM-4的全线能力提升使得我们有机会探索真正意义上的GLMs。用户可以下载（更新）智谱清\xa0...'</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre> 
<h2><a id="_450"></a>四、知乎网站数据爬取</h2> 
<h3><a id="1_451"></a>1、数据格式定义</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> json

file_path <span class="token operator">=</span> <span class="token string">'result.json'</span>

<span class="token comment"># 创建包含JSON对象的列表</span>
json_data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"link"</span><span class="token punctuation">:</span> <span class="token string">"https://example.com/article/1"</span><span class="token punctuation">,</span>
        <span class="token string">"title"</span><span class="token punctuation">:</span> <span class="token string">"Sample Article 1"</span><span class="token punctuation">,</span>
        <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"This is the content of the first article..."</span><span class="token punctuation">,</span>
        <span class="token string">"tokens"</span><span class="token punctuation">:</span> <span class="token string">"Number of tokens..."</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment"># 指定保存文件的路径</span>
file_path <span class="token operator">=</span> <span class="token string">"result.json"</span>

<span class="token comment"># 将JSON数据写入本地文件</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> json_file<span class="token punctuation">:</span>
    json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>json_data<span class="token punctuation">,</span> json_file<span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"JSON数据已保存到文件：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>file_path<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="2_478"></a>2、设置知乎排除的网站</h3> 
<p>对搜索引擎设置：https://programmablesearchengine.google.com/ ，设置排除的网址；以下几类是不需要的网页数据：<br> www.zhihu.com/collection 类网站（收藏列表），<br> www.zhihu.com/people 类网站（个人主页），<br> www.zhihu.com/column 类网站（个人文章主页），<br> www.zhihu.com/topic 类网站(主题)<br> <img src="https://images2.imgbox.com/92/99/hEJ16lfY_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3Google_api_487"></a>3、Google api调用测试</h3> 
<pre><code class="prism language-python">results <span class="token operator">=</span> google_search<span class="token punctuation">(</span>query<span class="token operator">=</span><span class="token string">'GLM4大模型有什么新特性？'</span><span class="token punctuation">,</span> num_results<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> site_url<span class="token operator">=</span><span class="token string">'https://www.zhihu.com/'</span><span class="token punctuation">)</span>
results
</code></pre> 
<p>输出：</p> 
<p><img src="https://images2.imgbox.com/f2/5e/adEQ29F8_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4Cookie_499"></a>4、爬虫之Cookie获取</h3> 
<ol><li>手动登录：首先，你需要在浏览器中手动访问目标网站并登录知乎。</li><li>开发者工具：登录后，打开浏览器的开发者工具。在 Chrome 和 Firefox 中，你可以右键点击<br> 页面，然后选择“检查”或“检查元素”。</li><li>网络标签：在开发者工具中，转到“网络”或“Network”标签。</li><li>刷新页面：在开发者工具打开的情况下，刷新页面。这会捕获所有页面加载过程中的网络请求。</li><li>查找请求：在捕获的请求列表中，找到主要的请求（通常是顶部的第一个，或者是与你的目标<br> URL匹配的请求）。</li><li>查看请求头：点击这个请求，然后查找“请求头”或“Request Headers”部分。</li><li>复制Cookie：在“请求头”部分，你应该能看到一个名为 <code>Cookie</code> 的字段。你可以直接复制这个<br> 字段的值。</li><li>使用在爬虫中：将复制的 <code>Cookie</code> 值用于你的爬虫代码中的请求头。<br> 需要注意的是<code>Cookie</code> 通常有有效期，过了有效期它可能会过期。如果你的爬虫在某个时间点突<br> 然无法工作，你可能需要重新获取新的 <code>Cookie</code>。</li></ol> 
<h3><a id="5useragent_513"></a>5、爬虫之user-agent</h3> 
<ol><li>Chrome (Windows 10):<br> Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36</li><li>Firefox (Windows 10):<br> Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:89.0) Gecko/20100101 Firefox/89.0</li><li>Safari (macOS):<br> Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0.3 Safari/605.1.15</li><li>Edge (Windows 10):<br> Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36<br> Edg/91.0.864.59</li><li>Chrome (Android):<br> Mozilla/5.0 (Linux; Android 10; SM-A205U) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.120 Mobile<br> Safari/537.36</li><li>Safari (iPhone):<br> Mozilla/5.0 (iPhone; CPU iPhone OS 14_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1 Mobile/15E148<br> Safari/604.1</li></ol> 
<h3><a id="6PATH_529"></a>6、爬虫之获取PATH</h3> 
<p>以下是使用Google Chrome浏览器查看和获取XPath的步骤，但其他现代浏览器（如Firefox、Edge等）的操作方式也类似：</p> 
<ol><li>打开网页: - 在Chrome中打开你想要查看的网页。</li><li>打开开发者工具: - 右键点击页面上的任意位置，然后选择“检查”（或“Inspect Element”）。</li></ol> 
<ul><li>或者，你可以使用快捷键 <code>Ctrl + Shift + I</code>（Windows/Linux）或 <code>Cmd + Option + I</code>（Mac）。</li></ul> 
<ol start="3"><li>使用元素选择器: - 在开发者工具的左上角，你会看到一个鼠标指针图标，这是“选择元素”工具。点击它。</li></ol> 
<ul><li>然后，将鼠标悬停在页面上的元素上。你会看到元素被高亮显示，并在开发者工具的“Elements”面板中显示其HTML结构。</li></ul> 
<ol start="4"><li>获取XPath: - 当你找到想要的元素后，在“Elements”面板中右键点击它。</li></ol> 
<ul><li>在弹出的菜单中，选择“Copy” &gt; “Copy XPath”。这将元素的XPath复制到剪贴板。</li></ul> 
<ol start="5"><li>粘贴XPath: - 接下来即可将复制的XPath粘贴到你的代码或其他地方。</li></ol> 
<h3><a id="7_541"></a>7、网络爬虫代码编写</h3> 
<p>1）请求头样例</p> 
<pre><code class="prism language-python"><span class="token comment">## 请求头</span>
headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'authority'</span><span class="token punctuation">:</span> <span class="token string">'www.zhihu.com'</span><span class="token punctuation">,</span>
    <span class="token string">'accept'</span><span class="token punctuation">:</span> <span class="token string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7'</span><span class="token punctuation">,</span>
    <span class="token string">'accept-language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.9,en;q=0.8'</span><span class="token punctuation">,</span>
    <span class="token string">'cache-control'</span><span class="token punctuation">:</span> <span class="token string">'max-age=0'</span><span class="token punctuation">,</span>
    <span class="token string">'cookie'</span><span class="token punctuation">:</span> <span class="token string">"Your cookie"</span><span class="token punctuation">,</span>                <span class="token comment"># 需要手动获取cookie</span>
    <span class="token string">'upgrade-insecure-requests'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
    <span class="token string">'user-agent'</span><span class="token punctuation">:</span> <span class="token string">'Your user-agent'</span><span class="token punctuation">,</span>        <span class="token comment"># 手动编写或者选择之后给出的user-agent选项选择其一填写</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol><li><strong>authority</strong>: 通常表示请求的目标主机名。在当前项目中需要视情况填写<code>www.zhihu.com</code>或者<code>zhuanlan.zhihu.com</code>；</li><li><strong>accept</strong>: 告诉服务器客户端能够处理的内容类型。这里列出了多种内容类型，包括HTML、XML和各种图片格式，该参数按照给定内容填写即可；</li><li><strong>accept-language</strong>: 告诉服务器客户端的首选语言。这里，首选语言被设置为简体中文（zh-CN），其次是其他中文版本（zh），然后是英文（en）。同样该参数的内容按照给定内容填写即可；</li><li><strong>cache-control</strong>: 控制缓存的行为。<code>max-age=0</code>通常表示客户端不希望得到缓存的响应，而希望从原始服务器获取一个新的响应。该参数的内容按照给定内容填写即可；</li><li><strong>cookie</strong>: 包含服务器之前发送给客户端的cookie。这些cookie可能用于身份验证、会话跟踪或其他目的。这里需要重点注意，建议大家自行获取对应个人浏览器产生的cookie，以避免cookie滥用导致被识别为机器人从而导致封IP；</li><li><strong>upgrade-insecure-requests</strong>: 这个头部告诉服务器，如果可能的话，客户端希望使用更安全的协议（如HTTPS）进行通信。建议取值为1即可；</li><li><strong>user-agent</strong>: 描述发出请求的客户端的类型。这里，它模拟了一个Chrome浏览器的用户代理字符串。网站有时会根据这个头部提供不同的内容或布局，或者检测是否是爬虫。该参数也需要根据自己实际情况进行编写。</li></ol> 
<p>2）设置cookie和user-agent</p> 
<pre><code class="prism language-python">cookie <span class="token operator">=</span> <span class="token string">"q_c1=3c10baf5bd084b3cbfe7eece648ba243|1704976541000|1704976541000; _zap=086350b3-1588-49c4-9d6d-de88f3faae03; d_c0=AGCYfYvO_RePTvjfB1kZwPLeke_N5AM6nwo=|1704949678; _xsrf=qR1FJHlZ9dvYhhoj4SUj43SAIBUwPOqm; __snaker__id=wNWnamiJKBI0kzkI; q_c1=d44e397edb6740859a7d2a0d4155bfab|1706509753000|1706509753000; Hm_lvt_98beee57fd2ef70ccdd5ca52b9740c49=1706509695,1706589529,1706765465,1708650963; z_c0=2|1:0|10:1713167971|4:z_c0|80:MS4xOGRHQVNnQUFBQUFtQUFBQVlBSlZUYjZqOTJaLXVDSjdRSmJKMHgyVEhxTE13UGN1TUJBdHZnPT0=|15b2c2ece393ac4ea374d9b36cde5af7304f8ee7632e060fe6835bfadb5e4132; KLBRSID=9d75f80756f65c61b0a50d80b4ca9b13|1713170212|1713167958"</span>
user_agent <span class="token operator">=</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"</span>
</code></pre> 
<p>3）设置请求头信息</p> 
<pre><code class="prism language-python"><span class="token comment">## 请求头</span>
headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'authority'</span><span class="token punctuation">:</span> <span class="token string">'www.zhihu.com'</span><span class="token punctuation">,</span>
    <span class="token string">'accept'</span><span class="token punctuation">:</span> <span class="token string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7'</span><span class="token punctuation">,</span>
    <span class="token string">'accept-language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.9,en;q=0.8'</span><span class="token punctuation">,</span>
    <span class="token string">'cache-control'</span><span class="token punctuation">:</span> <span class="token string">'max-age=0'</span><span class="token punctuation">,</span>
    <span class="token string">'cookie'</span><span class="token punctuation">:</span> cookie<span class="token punctuation">,</span>                <span class="token comment"># 需要手动获取cookie</span>
    <span class="token string">'upgrade-insecure-requests'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
    <span class="token string">'user-agent'</span><span class="token punctuation">:</span> user_agent<span class="token punctuation">,</span>        <span class="token comment"># 手动编写或者选择之后给出的user-agent选项选择其一填写</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="8question_587"></a>8、question类型的网站爬虫测试</h3> 
<pre><code class="prism language-python"><span class="token comment">## question类型的网站</span>
url <span class="token operator">=</span> <span class="token string">'https://www.zhihu.com/question/639753877'</span>
res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>text
res 
</code></pre> 
<p>输出：<br> <img src="https://images2.imgbox.com/a4/9f/CRTxIOWU_o.png" alt="在这里插入图片描述"></p> 
<p>1）网页标题解析</p> 
<pre><code class="prism language-python">res_xpath <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>res<span class="token punctuation">)</span>
res_xpath
</code></pre> 
<p><img src="https://images2.imgbox.com/69/96/boqE3jsx_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python">title <span class="token operator">=</span> res_xpath<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div/div[1]/div/h1/text()'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token comment">#%%</span>
title
</code></pre> 
<p><img src="https://images2.imgbox.com/a1/cf/oghh1m9O_o.png" alt="在这里插入图片描述"></p> 
<p>2）网页内容解析</p> 
<pre><code class="prism language-python"><span class="token comment">## 获取回答的正文</span>
<span class="token comment">#//*[@id="root"]/div/main/div/div/div[1]/div[2]/div/div[1]/div[1]/div[6]/div/div/div/div/span/p[1]/text()</span>
text <span class="token operator">=</span> <span class="token string">''</span>
text_d <span class="token operator">=</span> res_xpath<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div/div/div/div[2]/div/div[2]/div/div/div[2]/span[1]/div/div/span/p/text()'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> t <span class="token keyword">in</span> text_d<span class="token punctuation">:</span>
    txt <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span>
    text <span class="token operator">+=</span>txt

<span class="token keyword">print</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2b/27/F9iimzMC_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="9_631"></a>9、网页数据保存</h3> 
<pre><code class="prism language-python">encoding <span class="token operator">=</span> tiktoken<span class="token punctuation">.</span>encoding_for_model<span class="token punctuation">(</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">)</span>
<span class="token builtin">len</span><span class="token punctuation">(</span>encoding<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">json_data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"link"</span><span class="token punctuation">:</span> url<span class="token punctuation">,</span>
        <span class="token string">"title"</span><span class="token punctuation">:</span> title<span class="token punctuation">,</span>
        <span class="token string">"content"</span><span class="token punctuation">:</span> text<span class="token punctuation">,</span>
        <span class="token string">"tokens"</span><span class="token punctuation">:</span> <span class="token builtin">len</span><span class="token punctuation">(</span>encoding<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-python">title<span class="token operator">=</span><span class="token string">"智谱发布GLM-4基座大模型，性能效果如何"</span>
<span class="token comment">#%%</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./auto_search/介绍一下GLM4大模型的特性/%s.json'</span> <span class="token operator">%</span> title<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>json_data<span class="token punctuation">,</span> f<span class="token punctuation">)</span>
<span class="token comment">#%%</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./auto_search/介绍一下GLM4大模型的特性/%s.json'</span> <span class="token operator">%</span> title<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    jd <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token comment">#%%</span>
jd
</code></pre> 
<p><img src="https://images2.imgbox.com/10/3b/FcbFVlaX_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="10questionanswer_663"></a>10、question/answer网站爬虫测试</h3> 
<pre><code class="prism language-python"><span class="token comment">## question/answer网站</span>
url <span class="token operator">=</span> <span class="token string">'https://www.zhihu.com/question/639787253/answer/3365580226'</span>
res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>text
res_xpath <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token comment">#%%</span>
<span class="token comment"># question/answer网站标题</span>
res_xpath<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div/div[1]/div/h1/text()'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/32/46/uRzrhoUY_o.png" alt="在这里插入图片描述"></p> 
<p>回答内容爬取解析</p> 
<pre><code class="prism language-python"><span class="token comment"># question/answer网站置顶回答内容</span>
dic <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
text_d <span class="token operator">=</span> res_xpath<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//*[@id="root"]/div/main/div/div/div[3]/div[1]/div/div[2]/div/div/div/div[2]/span[1]/div/div/span/p/text()'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> t <span class="token keyword">in</span> text_d<span class="token punctuation">:</span>
    txt <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span>
    dic<span class="token punctuation">.</span>append<span class="token punctuation">(</span>txt<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/26/e4/gvqT72OB_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="11_690"></a>11、专栏类网站爬虫测试</h3> 
<pre><code class="prism language-python"><span class="token comment"># 专栏类网站</span>
url <span class="token operator">=</span> <span class="token string">'https://zhuanlan.zhihu.com/p/469793124'</span>
res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>text
res_xpath <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token comment">#%%</span>
<span class="token comment"># 专栏类网站标题</span>
res_xpath<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[1]/div/main/div/article/header/h1/text()'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/86/34/EZrdmU5P_o.png" alt="在这里插入图片描述"></p> 
<p>网页内容解析读取</p> 
<pre><code class="prism language-python"><span class="token comment"># 专栏类网站标题内容</span>
dic <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
text_d <span class="token operator">=</span> res_xpath<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div/main/div/article/div[1]/div/div/div/p/text()'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> t <span class="token keyword">in</span> text_d<span class="token punctuation">:</span>
    txt <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span>
    dic<span class="token punctuation">.</span>append<span class="token punctuation">(</span>txt<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/38/e0/wCEgmP6b_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_715"></a>结语</h2> 
<p>随着本章的结束，我们已经完成了知乎网站数据的智能搜索的基本链路拉通，下一篇章我们将对想要的函数进行封装改造，提高整各项目模块的扩展和复用性。</p> 
<p><img src="https://images2.imgbox.com/64/f4/eqG3B2CZ_o.png" alt="在这里插入图片描述"></p> 
<p>🎯🔖更多专栏系列文章：<a href="https://blog.csdn.net/xiaobing259/category_12628007.html?spm=1001.2014.3001.5482"><strong>AIGC-AI大模型探索之路</strong></a></p> 
<blockquote> 
 <p>😎 <strong>作者介绍</strong>：我是寻道AI小兵，资深程序老猿，从业10年+、互联网系统架构师，目前专注于AIGC的探索。<br> 📖 <strong>技术交流</strong>：建立有技术交流群，可以扫码👇 加入社群，500本各类编程书籍、AI教程、AI工具等你领取！<br> <strong>如果文章内容对您有所触动，别忘了<font color="red"><strong>点赞、⭐关注，收藏</strong></font>！加入我，让我们携手同行AI的探索之旅，一起开启智能时代的大门！</strong></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d780c5758dc840abf07274225655d2fe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">zookeeper的安装</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a7f108abf09165cf7f90a20a9aa01a3e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Wireshark v4 修改版安装教程（免费开源的网络嗅探抓包工具）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>