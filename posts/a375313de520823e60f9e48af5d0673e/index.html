<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java解压缩(上传和下载)zip压缩包[超详细]包含[前后端] - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/a375313de520823e60f9e48af5d0673e/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="java解压缩(上传和下载)zip压缩包[超详细]包含[前后端]">
  <meta property="og:description" content="前言 在日常中，我们想在没有网络的情况下进行将一个项目中的数据，导入另一个项目中，从而实现数据之前的转换和迁移。这时候，我们可以通过生成压缩包，和解压zip压缩包的形式，将数据进行各种迁移，接下来就让我们开始吧。
一、生成(下载)zip压缩包 1、前端代码 因为我使用的是vue2，所以就按照vue2的形式来编写了，其实就是一个点击按钮，对应的点击事件的方法。具体项目具体分析即可
&lt;a-button @click=&#34;sendToThreePlatform&#34; type=&#34;danger&#34; ghost icon=&#34;upload&#34;&gt;生成zip压缩包&lt;/a-button&gt; &lt;!-- 下面的代码就是sendToThreePlatform函数方法，具体项目具体分析--&gt; export default { methods:{ sendToThreePlatform(){ // params理解为参数 let params = { projectId: this.selectedMainId, } this.$message.loading({ content: &#39;请稍等...&#39;, key: &#39;Zip&#39;, duration: 0 }) //自己封装的ajax方法，你可以使用原始的ajax // 参数1：url；参数2：形参 getAction(this.url.deriveThreeStagePlatform, params).then((res) =&gt; { if (res.success) { // window.open(getFileAccessHttpUrl(res.result)) this.$message.success({ content: &#39;下载开始&#39;, key: &#39;Zip&#39;, duration: 1 }) if (typeof window.navigator.msSaveBlob !== &#39;undefined&#39;) { //允许用户在客户端上下载文件 参数1：生成数据，参数2：指定文件名称 //data 和fileName是我自己封装好的数据，具体，你可以在百度上搜索一下msSaveBlob如何使用 window.navigator.msSaveBlob(new Blob([data]), fileName) } else { //下面步骤可以理解为：生成一个下载链接，下载完成之后将改标签删除。 //获取文件服务访问路径 let url = getFileAccessHttpUrl(res.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-10T16:00:00+08:00">
    <meta property="article:modified_time" content="2024-01-10T16:00:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java解压缩(上传和下载)zip压缩包[超详细]包含[前后端]</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2></h2> 
<h2>前言</h2> 
<p>在日常中，我们想在没有网络的情况下进行将一个项目中的数据，导入另一个项目中，从而实现数据之前的转换和迁移。这时候，我们可以通过生成压缩包，和解压zip压缩包的形式，将数据进行各种迁移，接下来就让我们开始吧。</p> 
<h2>一、生成(下载)zip压缩包</h2> 
<h3>1、前端代码</h3> 
<p>因为我使用的是vue2，所以就按照vue2的形式来编写了，其实就是一个点击按钮，对应的点击事件的方法。具体项目具体分析即可</p> 
<pre><code class="language-html">     &lt;a-button  @click="sendToThreePlatform" type="danger" ghost icon="upload"&gt;生成zip压缩包&lt;/a-button&gt;




</code></pre> 
<pre><code class="language-javascript">


&lt;!-- 下面的代码就是sendToThreePlatform函数方法，具体项目具体分析--&gt;

export default {



methods:{

     sendToThreePlatform(){
        // params理解为参数
             let params = {
        projectId: this.selectedMainId,
      }
      this.$message.loading({ content: '请稍等...', key: 'Zip', duration: 0 })
        //自己封装的ajax方法，你可以使用原始的ajax
        // 参数1：url；参数2：形参
       getAction(this.url.deriveThreeStagePlatform, params).then((res) =&gt; {
        if (res.success) {
          // window.open(getFileAccessHttpUrl(res.result))
            
          this.$message.success({ content: '下载开始', key: 'Zip', duration: 1 })
            
          if (typeof window.navigator.msSaveBlob !== 'undefined') {
//允许用户在客户端上下载文件 参数1：生成数据，参数2：指定文件名称
//data 和fileName是我自己封装好的数据，具体，你可以在百度上搜索一下msSaveBlob如何使用
            window.navigator.msSaveBlob(new Blob([data]), fileName)
          } else {
            //下面步骤可以理解为：生成一个下载链接，下载完成之后将改标签删除。
            //获取文件服务访问路径
            let url = getFileAccessHttpUrl(res.result)
            let link = document.createElement('a')
            link.style.display = 'none'
            link.href = url
            link.setAttribute('download', res.result)
            document.body.appendChild(link)
            link.click()
            document.body.removeChild(link) //下载完成移除元素
            window.URL.revokeObjectURL(url) //释放掉blob对象
          }
        } else {
          this.$message.warning({ content: '导出失败！', key: 'Zip', duration: 1 })
        }
      })



    }
}

}</code></pre> 
<h3>2、后端代码</h3> 
<h4>2.1、需要的maven</h4> 
<pre><code class="language-XML">	&lt;dependency&gt;
			&lt;groupId&gt;net.lingala.zip4j&lt;/groupId&gt;
			&lt;artifactId&gt;zip4j&lt;/artifactId&gt;
			&lt;version&gt;1.3.2&lt;/version&gt;
		&lt;/dependency&gt;
    &lt;dependency&gt;
            &lt;groupId&gt;cn.hutool&lt;/groupId&gt;
            &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;
            &lt;version&gt;5.8.16&lt;/version&gt;
        &lt;/dependency&gt;</code></pre> 
<h4> 2.2、代码</h4> 
<pre><code class="language-java">  @GetMapping("/deriveThreeStagePlatform")
 public Result&lt;?&gt; deriveThreeStagePlatform(@RequestParam String projectId, HttpServletRequest request, HttpServletResponse response) {
//我代码中查询出来的数据
 TptProject project = tptProjectService.getById(projectId);
//        //创建压缩文件
        ZipParameters zipParameters = new ZipParameters();
        //设置文件加密
        zipParameters.setEncryptFiles(true);
        //加密
        zipParameters.setEncryptionMethod(Zip4jConstants.ENC_METHOD_STANDARD);
        //设置自定义密码
        zipParameters.setPassword(zipPassword);
        //设置zip文件名
        ZipFile zipFile = getZip(project.getName());

        //将项目的所需信息，查询出来生成JSON字符串；---该方法是自定义封装的方法，我将想要的数据变为一个大的json字符串。
        String jsonString = this.createProjectToJsonString(projectId);

        //生成.txt文件  这个方法在下面会写到
        String JSONStringName = this.createTXTString(jsonString, projectId);
        //获取到该文件
        File txt = new File(upLoadPath + File.separator + JSONStringName);
        if (!txt.exists()) {
            throw new RuntimeException("txt文件生成失败");
        }
        //添加txt文件
        zipFile.addFile(txt, zipParameters);
        
        txt.delete();

        //添加所有文件
        File projectFiles = new File(upLoadPath + File.separator + project.getName() + "_" + project.getId());
        if (projectFiles.exists()) {
            zipFile.addFolder(projectFiles, zipParameters);
        }
        return Result.OK("操作成功!",  "temp"+File.separator + zipFile.getFile().getName());

    }
</code></pre> 
<p><strong> createTXTString方法</strong></p> 
<pre><code class="language-java">  private String createTXTString(String jsonString, String projectId) {
        //被测项目信息 --自己项目中查询的数据
        TptProject project = tptProjectService.getById(projectId);
        //被测项目名称  ---自己项目中查询的数据
        String projectName = project.getName();
        try {

            // 创建file类
            /**
                  upLoadPath：表示指定的路径。---这个自己设置
                    File.separator：---代表/
                    TXT_SUFFIX: 自定义的名称 表示 .txt
        总体表示: xx/xxx/xxx/xxx.txt 
        */
            File file = new File(upLoadPath + File.separator+projectName + TXT_SUFFIX);

            //将jsonString数据写入到指定的file文件中，并且格式为utf-8
            OutputStreamWriter out = new OutputStreamWriter(new FileOutputStream(file),"UTF-8");
            out.write(jsonString);

            out.flush();
            out.close();
        }catch(IOException e){
            e.printStackTrace();
        }

        // 返回一个文件名称
        return File.separator + projectName + TXT_SUFFIX;
    }</code></pre> 
<p><span style="color:#ff9900;"><strong>好了，上述代码就是将一个数据生成.txt文件并且保存到zip压缩包中，并且下载到客户端，上述代码是生成.txt文件，我们还可以生成.sql ;.xml等各种文件，具体代码具体分析。</strong></span></p> 
<h2> 二、java解压(上传)zip压缩包</h2> 
<p>已经下载好的压缩包，我们现在需要在导入到另外一个项目中具体方法如下。</p> 
<h3>1、前端代码</h3> 
<pre><code class="language-html">&lt;!--因为我使用的前端为vue+Ant Design所以就使用这种组件，如果使用的是element-ui那么就去找对应的组件即可。--&gt;

&lt;a-upload
        accept=".zip"
        name="file"
        :showUploadList="false"
        :multiple="false"
        :headers="tokenHeader"
        :action="importProjectZipUrl"
        @change="handleImportExcel"
        :beforeUpload="(file) =&gt; doBeforeUpload(file, 'zip')"
      &gt;
        &lt;a-button type="primary" icon="import"&gt;导入Zip&lt;/a-button&gt;
      &lt;/a-upload&gt;</code></pre> 
<h4>1.1、前端的js文件</h4> 
<p><strong>importProjectZipUrl: </strong> 表示访问后端的路径</p> 
<p><strong>handleImportExcel： 这一块内容复制粘贴即可，全是错误判断条件，如果正确都不会走</strong></p> 
<pre><code class="language-javascript">/* 导入 */
    handleImportExcel(info) {
      this.loading = true
      debugger
      if (info.file.status !== 'uploading') {
        console.log(info.file, info.fileList)
      }
      if (info.file.status === 'done') {
        this.loading = false
        if (info.file.response.success) {
          // this.$message.success(`${info.file.name} 文件上传成功`);
          if (info.file.response.code === 201) {
            let {
              message,
              result: { msg, fileUrl, fileName },
            } = info.file.response
            let href = window._CONFIG['domianURL'] + fileUrl
            this.$warning({
              title: message,
              content: (
                &lt;div&gt;
                  &lt;span&gt;{msg}&lt;/span&gt;
                  &lt;br /&gt;
                  &lt;span&gt;
                    具体详情请{' '}
                    &lt;a href={href} target="_blank" download={fileName}&gt;
                      点击下载
                    &lt;/a&gt;{' '}
                  &lt;/span&gt;
                &lt;/div&gt;
              ),
            })
          } else {
            this.$message.success(info.file.response.message || `${info.file.name} 文件上传成功`)
          }
          this.loadData()
        } else {
          this.$message.error(`${info.file.name} ${info.file.response.message}.`)
        }
      } else if (info.file.status === 'error') {
        this.loading = false
        if (info.file.response.status === 500) {
          let data = info.file.response
          const token = Vue.ls.get(ACCESS_TOKEN)
          if (token &amp;&amp; data.message.includes('Token失效')) {
            this.$error({
              title: '登录已过期',
              content: '很抱歉，登录已过期，请重新登录',
              okText: '重新登录',
              mask: false,
              onOk: () =&gt; {
                store.dispatch('Logout').then(() =&gt; {
                  Vue.ls.remove(ACCESS_TOKEN)
                  window.location.reload()
                })
              },
            })
          }
        } else {
          this.$message.error(`文件上传失败: ${info.file.msg} `)
        }
      }
    }</code></pre> 
<p><strong>doBeforeUpload(parm1,parm2);</strong></p> 
<pre><code class="language-javascript">  doBeforeUpload(file, type) {
      if (file.name.indexOf(type) &lt; 0 &amp;&amp; type == 'xls') {
        this.$message.warning('请上传xls格式的表格')
        setTimeout(() =&gt; {
          this.loading = false
        }, 100)
        return false
      }
      if (file.name.indexOf(type) &lt; 0 &amp;&amp; type == 'zip') {
        this.$message.warning('请上传zip格式的压缩包')
        setTimeout(() =&gt; {
          this.loading = false
        }, 100)
        return false
      }
      if (file.name.indexOf(type) &lt; 0 &amp;&amp; type == 'sql') {
        this.$message.warning('请上传sql格式的文件')
        setTimeout(() =&gt; {
          this.loading = false
        }, 100)
        return false
      }
      return true
    }</code></pre> 
<h3>2、后端代码</h3> 
<pre><code class="language-java"> @PostMapping("/importProjectTXTZipUrl")
	 public Result&lt;?&gt; importProjectZip(@RequestParam("file") MultipartFile file) {
	// 创建一个file文件
		 File f = new File(upLoadPath + File.separator + "temp");
	 // 不存在就创建
		 if (!f.exists()) f.mkdirs();
 // 创建另一个文件 名称不一样
		 File zip = new File(f, System.currentTimeMillis() + "_" + file.getOriginalFilename());
		 InputStream in = file.getInputStream();
		 FileOutputStream os = new FileOutputStream(zip);
		 //复制输入流到输出流
		 StreamUtils.copy(in, os);
		 in.close();
		 os.close();
 // 获取zip压缩包
		 ZipFile zipFile = new ZipFile(zip);
		 try {
			 if (!zipFile.isValidZipFile()) {
				 throw new Exception();
			 }
		 } catch (Exception e) {
			 return Result.error("文件格式错误或已损坏!");
		 }
 // 输入密码：这个密码和导出zip的密码一致
		 zipFile.setPassword("123456.a");
        StringBuilder sb = new StringBuilder();
	 //获取zip压缩包文件中的所有文件头部信息
		 List&lt;FileHeader&gt; headers = zipFile.getFileHeaders();
		 for (FileHeader header : headers) {
			 try (ZipInputStream inputStream = zipFile.getInputStream(header)) {
			
				 	//判断文件名后缀是否为.txt文件
				 if (!header.getFileName().contains("/") &amp;&amp; header.getFileName().endsWith(".txt")) {
							//将字节流变为字符流并保存到buffer缓冲区中 出现乱码
					 BufferedReader reader = new BufferedReader(new InputStreamReader(inputStream, "UTF-8"));
	            //写文件
					 String line;
					 while ((line = reader.readLine()) != null) {
                        sb.append(line);

					 }
					 reader.close();
				 } else {
					 zipFile.extractFile(header, upLoadPath);
				 }
			 } catch (Exception e) {
				 log.error(e.getMessage());
			 }
		 }
        //进行一系列操作，.txt文件中的数据已经全部读取到sb中，调用自己写的方法进行一系列操作即可
 twoProjectService2.analysisJSON(sb);
//最后删除zip
		 zip.delete();
		 return Result.ok("导入成功!");
	 }</code></pre> 
<h2>总结</h2> 
<p>好啦，以上就是基于java和前端代码的zip压缩包的导入和导出啦。超强实战。看完这个之后，希望你能更加激进你的技术，哈哈。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d1bf134dee30f5e5ca5cdfb6a31a1112/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">springboot在线订单管理系统设计与实现-附源码080941</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/99816a69769cfb2d8dae900f50b9d230/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Spark on YARN部署模式保姆级教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>