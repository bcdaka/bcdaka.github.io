<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux中MySQL 双主复制(互为主从)配置指南(详细过程)！ - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/47dfaba8da9a00d6d7fd7c09264956ae/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Linux中MySQL 双主复制(互为主从)配置指南(详细过程)！">
  <meta property="og:description" content="🏡作者主页：点击！ 🐧Linux基础知识(初学)：点击！
🐧Linux高级管理防护和群集专栏：点击！
🔐Linux中firewalld防火墙：点击！
⏰️创作时间：2024年7月24日15点48分
🀄️文章质量：95分
​
目录
前言——
配置基于GTID的复制模式
第一台主服务器配置
主服务器配置
创建具有复制权限的用户
启动从服务
第二台主服务器配置
主服务器配置
创建具有复制权限的用户
启动从服务
测试双主复制配置
第一台主服务器测试
第二台主服务器测试
总结
前言—— 在数据驱动的时代，数据库的高可用性和数据一致性是每个企业必须考虑的重要问题。MySQL 双主复制（Master-Master Replication）提供了一种有效的解决方案，通过配置两台服务器互为主从，保证数据的实时同步和高可用性。本文将详细介绍如何配置基于 GTID 的 MySQL 双主复制，并进行测试验证。
配置基于GTID的复制模式 GTID（全局事务标识符）是 MySQL 提供的一种新型复制方式，它简化了主从复制的配置和管理，确保数据的一致性和完整性。在配置 MySQL 双主复制之前，我们需要确保两台主服务器都启用了 GTID 模式。
第一台主服务器配置 主服务器配置 首先，我们需要修改第一台主服务器的配置文件 /etc/my.cnf，添加以下内容：
server-id = 100 log_bin = mysql-bin gtid_mode = ON enforce_gtid_consistency = true 这些配置项的作用如下：
server-id：设置服务器的唯一标识符。log_bin：启用二进制日志记录。gtid_mode：启用 GTID 模式。enforce_gtid_consistency：强制 GTID 一致性。 修改完配置文件后，重启 MySQL 服务使配置生效：
systemctl restart mysqld 创建具有复制权限的用户 接下来，我们需要创建一个具有复制权限的用户，用于两台服务器之间的同步：
grant replication slave on *.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-26T09:00:00+08:00">
    <meta property="article:modified_time" content="2024-07-26T09:00:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux中MySQL 双主复制(互为主从)配置指南(详细过程)！</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="text-align:center;"> <img alt="" height="80" src="https://images2.imgbox.com/70/fe/UZgVU5Cw_o.gif" width="640"></p> 
<p style="text-align:center;"><strong>🏡作者主页：<strong><strong><strong><strong><strong><strong><strong><a href="https://blog.csdn.net/jxjdhdnd?type=blog" title="点击！">点击！</a></strong></strong></strong></strong></strong></strong></strong> </strong></p> 
<p style="text-align:center;"><strong>🐧Linux基础知识(初学)：<strong><a href="https://blog.csdn.net/jxjdhdnd/category_12527411.html?csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22column%22%2C%22rId%22%3A%2212527411%22%2C%22source%22%3A%22jxjdhdnd%22%7D&amp;fromshare=blogcolumn" title="点击！">点击！</a></strong></strong></p> 
<p style="text-align:center;"><strong>🐧Linux高级管理防护和群集专栏：<strong><strong><strong><strong><strong><strong><strong><a href="https://blog.csdn.net/jxjdhdnd/category_12688607.html" title="点击！">点击！</a></strong></strong></strong></strong></strong></strong></strong></strong></p> 
<p style="text-align:center;"><strong>🔐Linux中firewalld防火墙：<strong><strong><strong><a href="https://blog.csdn.net/jxjdhdnd/category_12719323.html?csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22column%22%2C%22rId%22%3A%2212719323%22%2C%22source%22%3A%22jxjdhdnd%22%7D&amp;fromshare=blogcolumn" title="点击！">点击！</a></strong></strong></strong></strong></p> 
<p style="text-align:center;"><strong>⏰️创作时间：2024年7月24日15点48分</strong></p> 
<p style="text-align:center;"><strong>🀄️文章质量：95分</strong></p> 
<p style="text-align:center;"><img alt="" height="80" src="https://images2.imgbox.com/db/38/Y1vLaG7a_o.gif" width="640">​</p> 
<hr> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E5%89%8D%E8%A8%80%E2%80%94%E2%80%94-toc" style="margin-left:40px;"><a href="#%E5%89%8D%E8%A8%80%E2%80%94%E2%80%94" rel="nofollow">前言——</a></p> 
<p id="%E9%85%8D%E7%BD%AE%E5%9F%BA%E4%BA%8EGTID%E7%9A%84%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F-toc" style="margin-left:40px;"><a href="#%E9%85%8D%E7%BD%AE%E5%9F%BA%E4%BA%8EGTID%E7%9A%84%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F" rel="nofollow">配置基于GTID的复制模式</a></p> 
<p id="%E7%AC%AC%E4%B8%80%E5%8F%B0%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#%E7%AC%AC%E4%B8%80%E5%8F%B0%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE" rel="nofollow">第一台主服务器配置</a></p> 
<p id="%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE" rel="nofollow">主服务器配置</a></p> 
<p id="%E5%88%9B%E5%BB%BA%E5%85%B7%E6%9C%89%E5%A4%8D%E5%88%B6%E6%9D%83%E9%99%90%E7%9A%84%E7%94%A8%E6%88%B7-toc" style="margin-left:80px;"><a href="#%E5%88%9B%E5%BB%BA%E5%85%B7%E6%9C%89%E5%A4%8D%E5%88%B6%E6%9D%83%E9%99%90%E7%9A%84%E7%94%A8%E6%88%B7" rel="nofollow">创建具有复制权限的用户</a></p> 
<p id="%E5%90%AF%E5%8A%A8%E4%BB%8E%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#%E5%90%AF%E5%8A%A8%E4%BB%8E%E6%9C%8D%E5%8A%A1" rel="nofollow">启动从服务</a></p> 
<p id="%E7%AC%AC%E4%BA%8C%E5%8F%B0%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#%E7%AC%AC%E4%BA%8C%E5%8F%B0%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE" rel="nofollow">第二台主服务器配置</a></p> 
<p id="%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE" rel="nofollow">主服务器配置</a></p> 
<p id="%E5%88%9B%E5%BB%BA%E5%85%B7%E6%9C%89%E5%A4%8D%E5%88%B6%E6%9D%83%E9%99%90%E7%9A%84%E7%94%A8%E6%88%B7-toc" style="margin-left:80px;"><a href="#%E5%88%9B%E5%BB%BA%E5%85%B7%E6%9C%89%E5%A4%8D%E5%88%B6%E6%9D%83%E9%99%90%E7%9A%84%E7%94%A8%E6%88%B7" rel="nofollow">创建具有复制权限的用户</a></p> 
<p id="%E5%90%AF%E5%8A%A8%E4%BB%8E%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#%E5%90%AF%E5%8A%A8%E4%BB%8E%E6%9C%8D%E5%8A%A1" rel="nofollow">启动从服务</a></p> 
<p id="-toc" style="margin-left:40px;"></p> 
<p id="%E6%B5%8B%E8%AF%95%E5%8F%8C%E4%B8%BB%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#%E6%B5%8B%E8%AF%95%E5%8F%8C%E4%B8%BB%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE" rel="nofollow">测试双主复制配置</a></p> 
<p id="%E7%AC%AC%E4%B8%80%E5%8F%B0%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B5%8B%E8%AF%95-toc" style="margin-left:80px;"><a href="#%E7%AC%AC%E4%B8%80%E5%8F%B0%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B5%8B%E8%AF%95" rel="nofollow">第一台主服务器测试</a></p> 
<p id="%E7%AC%AC%E4%BA%8C%E5%8F%B0%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B5%8B%E8%AF%95-toc" style="margin-left:80px;"><a href="#%E7%AC%AC%E4%BA%8C%E5%8F%B0%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B5%8B%E8%AF%95" rel="nofollow">第二台主服务器测试</a></p> 
<p id="-toc" style="margin-left:40px;"></p> 
<p id="%E6%80%BB%E7%BB%93-toc" style="margin-left:40px;"><a href="#%E6%80%BB%E7%BB%93" rel="nofollow">总结</a></p> 
<hr id="hr-toc"> 
<p></p> 
<p></p> 
<p></p> 
<h3 id="%E5%89%8D%E8%A8%80%E2%80%94%E2%80%94">前言——</h3> 
<p>在数据驱动的时代，数据库的高可用性和数据一致性是每个企业必须考虑的重要问题。MySQL 双主复制（Master-Master Replication）提供了一种有效的解决方案，<span style="color:#fe2c24;"><strong>通过配置两台服务器互为主从，保证数据的实时同步和高可用性。本文将详细介绍如何配置基于 GTID 的 MySQL 双主复制，并进行测试验证。</strong></span></p> 
<p></p> 
<p></p> 
<h3 id="%E9%85%8D%E7%BD%AE%E5%9F%BA%E4%BA%8EGTID%E7%9A%84%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F">配置基于GTID的复制模式</h3> 
<p><span style="color:#fe2c24;"><strong>GTID（全局事务标识符）</strong></span>是 MySQL 提供的一种新型复制方式，它简化了主从复制的配置和管理，确保数据的一致性和完整性。在配置 MySQL 双主复制之前，我们需要确保两台主服务器都启用了 GTID 模式。</p> 
<h3 id="%E7%AC%AC%E4%B8%80%E5%8F%B0%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE">第一台主服务器配置</h3> 
<h4 id="%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE">主服务器配置</h4> 
<p>首先，我们需要修改第一台主服务器的配置文件 <code>/etc/my.cnf</code>，添加以下内容：</p> 
<div> 
 <pre><code>server-id = 100
log_bin = mysql-bin
gtid_mode = ON
enforce_gtid_consistency = true
</code></pre> 
</div> 
<p>这些配置项的作用如下：</p> 
<ul><li><code>server-id</code>：设置服务器的唯一标识符。</li><li><code>log_bin</code>：启用二进制日志记录。</li><li><code>gtid_mode</code>：启用 GTID 模式。</li><li><code>enforce_gtid_consistency</code>：强制 GTID 一致性。</li></ul> 
<p>修改完配置文件后，重启 MySQL 服务使配置生效：</p> 
<div> 
 <pre><code>systemctl restart mysqld
</code></pre> 
</div> 
<h4 id="%E5%88%9B%E5%BB%BA%E5%85%B7%E6%9C%89%E5%A4%8D%E5%88%B6%E6%9D%83%E9%99%90%E7%9A%84%E7%94%A8%E6%88%B7">创建具有复制权限的用户</h4> 
<p>接下来，我们需要创建一个具有复制权限的用户，用于两台服务器之间的同步：</p> 
<div> 
 <pre><code>grant replication slave on *.* to 'repluser'@'192.168.192.%' identified by 'Abc-1234';
flush privileges;
show master status\G;
</code></pre> 
</div> 
<p>这些 SQL 命令的作用如下：</p> 
<ul><li><code>grant replication slave</code>：授予用户复制权限。</li><li><code>flush privileges</code>：刷新权限，使之生效。</li><li><code>show master status</code>：查看主服务器的状态。</li></ul> 
<h4 id="%E5%90%AF%E5%8A%A8%E4%BB%8E%E6%9C%8D%E5%8A%A1">启动从服务</h4> 
<p>在创建好用户之后，进入 MySQL 数据库执行以下命令，将另一台主服务器配置为从服务器：</p> 
<div> 
 <pre><code>mysql -uroot -pABCabc-123
</code></pre> 
</div> 
<div> 
 <pre><code>change master to
master_host="192.168.192.111",
master_user="repluser",
master_password="Abc-1234",
master_auto_position=1;
</code></pre> 
</div> 
<p>启动从服务：</p> 
<div> 
 <pre><code>start slave;
</code></pre> 
</div> 
<h3 id="%E7%AC%AC%E4%BA%8C%E5%8F%B0%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE">第二台主服务器配置</h3> 
<h4>主服务器配置</h4> 
<p>在第二台主服务器上，同样需要修改配置文件 <code>/etc/my.cnf</code>，添加以下内容：</p> 
<div> 
 <pre><code>server-id = 101
log_bin = mysql-bin
gtid_mode = ON
enforce_gtid_consistency = true
</code></pre> 
</div> 
<p>重启 MySQL 服务：</p> 
<div> 
 <pre><code>systemctl restart mysqld
</code></pre> 
</div> 
<h4>创建具有复制权限的用户</h4> 
<p>创建具有复制权限的用户：</p> 
<div> 
 <pre><code>grant replication slave on *.* to 'repluser'@'192.168.192.%' identified by 'Abc-1234';
flush privileges;
show master status\G;
</code></pre> 
</div> 
<h4>启动从服务</h4> 
<p>进入 MySQL 数据库执行以下命令，将第一台主服务器配置为从服务器：</p> 
<div> 
 <pre><code>mysql -uroot -pABCabc-123
</code></pre> 
</div> 
<div> 
 <pre><code>change master to
master_host="192.168.192.100",
master_user="repluser",
master_password="Abc-1234",
master_auto_position=1;
</code></pre> 
</div> 
<p>启动从服务：</p> 
<div> 
 <pre><code>start slave;
</code></pre> 
</div> 
<h3 id="%E2%80%8B"><img alt="" height="528" src="https://images2.imgbox.com/c0/f9/AmFA9whO_o.png" width="920">​</h3> 
<h3><img alt="" height="510" src="https://images2.imgbox.com/f5/bc/bIMDwglv_o.png" width="936">​</h3> 
<h3></h3> 
<h3></h3> 
<h3></h3> 
<h3 id="%E6%B5%8B%E8%AF%95%E5%8F%8C%E4%B8%BB%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE">测试双主复制配置</h3> 
<h4 id="%E7%AC%AC%E4%B8%80%E5%8F%B0%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B5%8B%E8%AF%95">第一台主服务器测试</h4> 
<p>在第一台主服务器上，向 <code>hello</code> 数据库的 <code>test</code> 表插入数据，并查看数据同步情况：</p> 
<div> 
 <pre><code>mysql&gt; insert into hello.test values(2222);
Query OK, 1 row affected (0.01 sec)

mysql&gt; select * from hello.test;
+--------+
| num    |
+--------+
| 111111 |
|   2222 |
+--------+
2 rows in set (0.00 sec)

mysql&gt; select * from hello.test;
+---------+
| num     |
+---------+
|  111111 |
|    2222 |
| 3333333 |
+---------+
3 rows in set (0.01 sec)
</code></pre> 
</div> 
<h4 id="%E7%AC%AC%E4%BA%8C%E5%8F%B0%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B5%8B%E8%AF%95">第二台主服务器测试</h4> 
<p>在第二台主服务器上，查看刚刚插入的数据，并插入新的数据：</p> 
<div> 
 <pre><code>mysql&gt; select * from hello.test;
+--------+
| num    |
+--------+
| 111111 |
|   2222 |
+--------+
2 rows in set (0.00 sec)

mysql&gt; insert into hello.test values(3333333);
Query OK, 1 row affected (0.02 sec)

mysql&gt; select * from hello.test;
+---------+
| num     |
+---------+
|  111111 |
|    2222 |
| 3333333 |
+---------+
3 rows in set (0.00 sec)
</code></pre> 
</div> 
<h3></h3> 
<p></p> 
<h3 id="%E6%80%BB%E7%BB%93" style="background-color:transparent;">总结</h3> 
<p>通过以上配置和测试，我们成功地实现了 MySQL 双主复制。此配置不仅提高了数据库的可用性，还确保了数据的一致性。在实际生产环境中，这种配置可以极大地减少数据丢失的风险，提升系统的容灾能力。希望本文对您在 MySQL 双主复制的配置上有所帮助。如果有任何问题或建议，欢迎留言讨论。</p> 
<p></p> 
<blockquote> 
 <p>成功的路上没有捷径，只有不断的努力与坚持。如果你和我一样，坚信努力会带来回报，请关注我，点个赞，一起迎接更加美好的明天！你的支持是我继续前行的动力！"</p> 
 <p></p> 
 <p>"每一次创作都是一次学习的过程，文章中若有不足之处，还请大家多多包容。你的关注和点赞是对我最大的支持，也欢迎大家提出宝贵的意见和建议，让我不断进步。"</p> 
 <p style="text-align:center;"></p> 
 <p style="text-align:center;"><strong>神秘泣男子</strong></p> 
 <p style="text-align:center;"><img alt="" height="289" src="https://images2.imgbox.com/bc/f2/OirC1EBI_o.png" width="296"></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3eda8b887fe4a44a2ee6de7936a01397/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Java版数据结构】初识泛型</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d34db407b6706ce9045582fb0e556994/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">直面 AI 裁员危机：未来工程师的需求有增无减，但只有 10% 的 AI 老手能生存下来...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>