<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>H5获取手机相机或相册图片两种方式-Android通过webview传递多张照片给H5 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/3d294015c15094643b8741e79335369c/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="H5获取手机相机或相册图片两种方式-Android通过webview传递多张照片给H5">
  <meta property="og:description" content="需求目的： 手机机通过webView展示H5网页，在特殊场景下，需要使用相机拍照或者从相册获取照片，上传后台。
完整流程效果： 如下图
一、H5界面样例代码 使用html文件格式，文件直接打开就可以展示布局；一会在andriod webview中直接加载
&lt;!DOCTYPE html&gt; &lt;html lang=&#34;en&#34; xmlns:v-on=&#34;http://www.w3.org/1999/xhtml&#34;&gt; &lt;head&gt; &lt;meta charset=&#34;UTF-8&#34;&gt; &lt;meta name=&#34;viewport&#34; content=&#34;width=device-width, initial-scale=1.0&#34;&gt; &lt;title&gt;Document&lt;/title&gt; &lt;/head&gt; &lt;div id=&#34;app&#34;&gt; &lt;h1&gt;alllalalallalal 默认会被覆盖&lt;/h1&gt; &lt;/div&gt; &lt;template id=&#34;why&#34;&gt; &lt;div&gt; &lt;h2&gt;{{message}}&lt;/h2&gt; &lt;h2&gt;{{counter}}&lt;/h2&gt; &lt;button @click=&#34;increment&#34;&gt;&#43;1&lt;/button&gt; &lt;button @click=&#34;decrement&#34;&gt;-1&lt;/button&gt; &lt;h1 style=&#34;text-align: center;&#34;&gt;{{ title }}&lt;/h1&gt; &lt;div&gt; &lt;h2 style=&#34;text-align: center;&#34;&gt;android选中照片H5展示&lt;/h2&gt; &lt;!--HTML5提供了&lt;input type=&#34;file&#34;&gt;元素来实现选取文件的功能,在WebView表现为调用onShowFileChooser--&gt; &lt;input accept=&#34;image/*&#34; capture=&#34;camera&#34; ref=&#34;imgFile&#34; type=&#34;file&#34; multiple @change=&#34;previewFiles&#34;&gt; &lt;div id=&#34;preview&#34;&gt; &lt;img v-for=&#34;imgSrc in imageSources&#34; :src=&#34;imgSrc&#34; :key=&#34;imgSrc&#34; style=&#34;max-width: 100px; max-height: 100px; margin: 10px;&#34;&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/template&gt; &lt;body&gt; &lt;!">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-27T13:44:50+08:00">
    <meta property="article:modified_time" content="2024-03-27T13:44:50+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">H5获取手机相机或相册图片两种方式-Android通过webview传递多张照片给H5</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>需求目的：</strong> 手机机通过webView展示H5网页，在特殊场景下，需要使用相机拍照或者从相册获取照片，上传后台。</p> 
<p><strong>完整流程效果：</strong> 如下图<br> <img src="https://images2.imgbox.com/37/fe/YZVfDSss_o.png" alt="H5调用相机相册使用组件库方式流程"></p> 
<h4><a id="H5_7"></a>一、H5界面样例代码</h4> 
<p>使用html文件格式，文件直接打开就可以展示布局；一会在andriod webview中直接加载</p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">xmlns:</span>v-on</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/1999/xhtml<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>alllalalallalal 默认会被覆盖<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>why<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{<!-- -->{message}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>{<!-- -->{counter}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>increment<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>+1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>decrement<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>-1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{ title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>android选中照片H5展示<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--HTML5提供了&lt;input type="file"&gt;元素来实现选取文件的功能,在WebView表现为调用onShowFileChooser--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>image/*<span class="token punctuation">"</span></span> <span class="token attr-name">capture</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>camera<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>imgFile<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">multiple</span>
                   <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>previewFiles<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preview<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>imgSrc in imageSources<span class="token punctuation">"</span></span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>imgSrc<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>imgSrc<span class="token punctuation">"</span></span>
                     <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">max-width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span> <span class="token property">max-height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>


<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 引入 Vue 3 的 CDN 资源网络加载不了 --&gt;</span>
<span class="token comment">&lt;!-- &lt;script src="https://unpkg.com/vue@next"&gt;&lt;/script&gt; --&gt;</span>
<span class="token comment">&lt;!-- 引入 Vue 3 的 CDN 资源,本地引用 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vue3.2.12global.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        Vue<span class="token punctuation">.</span><span class="token function">createApp</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">'#why'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"功能开发中，敬请期待！"</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">pictureSelectorContent</span><span class="token operator">:</span> <span class="token string">"相机选择结果:"</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">imageSources</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 存储图片的数据URL</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>

            <span class="token comment">// 在你的 Vue 组件中处理 Webview 传递的数据</span>
            <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 设置全局函数，用于接收 WebView 调用</span>
                <span class="token comment">// window.pictureSelectorResult = this.pictureSelectorResult;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>counter<span class="token operator">++</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"点击了+1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>counter<span class="token operator">--</span><span class="token punctuation">;</span>
                    consloe<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"点击了-1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function">startPictureSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    window<span class="token punctuation">.</span>android<span class="token punctuation">.</span><span class="token function">startPictureSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function">previewFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>imgFile<span class="token punctuation">.</span>files<span class="token punctuation">;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>imageSources <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">const</span> file <span class="token operator">=</span> files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                        <span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">this</span><span class="token punctuation">.</span>imageSources<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">;</span>

                        reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>


        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">"#app"</span><span class="token punctuation">)</span>



</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">h1</span> <span class="token punctuation">{<!-- --></span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> 80px<span class="token punctuation">;</span>
            <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>
            <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token selector">h2</span> <span class="token punctuation">{<!-- --></span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
            <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>
            <span class="token property">color</span><span class="token punctuation">:</span> #C8EFD4<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token selector">h3</span> <span class="token punctuation">{<!-- --></span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
            <span class="token property">font-weight</span><span class="token punctuation">:</span> bold<span class="token punctuation">;</span>
            <span class="token property">color</span><span class="token punctuation">:</span> #C8EFD4<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token selector">button1</span> <span class="token punctuation">{<!-- --></span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> 60px<span class="token punctuation">;</span>
            <span class="token property">padding</span><span class="token punctuation">:</span> 10px 20px<span class="token punctuation">;</span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> #007bff<span class="token punctuation">;</span>
            <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
            <span class="token property">border</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
            <span class="token property">border-radius</span><span class="token punctuation">:</span> 4px<span class="token punctuation">;</span>
            <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
            <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
            <span class="token property">margin-top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
            <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
            <span class="token comment">/* 将文字水平居中显示 */</span>
            <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
            <span class="token comment">/* 将按钮设置为flex容器 */</span>
            <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
            <span class="token comment">/* 将文字在垂直方向上居中显示 */</span>
        <span class="token punctuation">}</span>


</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>上述代码是前端代码，使用vue3框架展示一个基础 加减demo界面（不重要的冗余），以及 一个打开文件的按钮以及展示图片<br> <img src="https://images2.imgbox.com/f4/88/1tBvXWEQ_o.png" alt="在这里插入图片描述"></p> 
<p>其中HTML5提供了元素来实现选取文件的功能，当在WebView表现为调用onShowFileChooser后，回调图片uri列表一一获取并展示</p> 
<h4><a id="Android_150"></a>二、Android打开相机以及相册的两种方式</h4> 
<h5><a id="android___151"></a>方式一：android 原生方式</h5> 
<p>实际效果和流程示图<br> <img src="https://images2.imgbox.com/ee/d8/WB5mmFHs_o.png" alt="在这里插入图片描述"></p> 
<p><strong>1.android界面逻辑代码</strong><br> 这边使用的是kotlin语言，使用的fragment界面展示,使用binding加载了布局，以及声明了webview组件，在webview上导入html链接，使本地H5界面展示</p> 
<pre><code class="prism language-kotlin">
<span class="token keyword">class</span> VisitorFragment <span class="token operator">:</span> <span class="token function">Fragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">lateinit</span> <span class="token keyword">var</span> binding<span class="token operator">:</span> FragmentVisitorBinding
    <span class="token keyword">lateinit</span> <span class="token keyword">var</span> mActivity<span class="token operator">:</span> Activity
    <span class="token keyword">private</span> <span class="token keyword">lateinit</span> <span class="token keyword">var</span> mRoot<span class="token operator">:</span> View

    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> <span class="token keyword">val</span> TAG <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"VisitorFragment"</span></span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">var</span> mWebViewUrl<span class="token operator">:</span> String <span class="token operator">=</span> "file<span class="token operator">:</span><span class="token operator">/</span><span class="token comment">//android_asset/vue_android_demo.html"</span>

    <span class="token keyword">var</span> mAppName <span class="token operator">=</span> MainApplication<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span>BASE_APP_LOGIN_IDENTITY
    <span class="token keyword">var</span> mSystemName <span class="token operator">=</span> WebViewConstant<span class="token punctuation">.</span>DEFAULT_SYSTEM_NAME
    <span class="token keyword">private</span> <span class="token keyword">var</span> mVisitorAndroidJs<span class="token operator">:</span> VisitorAndroidJs <span class="token operator">=</span> <span class="token function">VisitorAndroidJs</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>

    <span class="token keyword">private</span> <span class="token keyword">var</span> mWebView<span class="token operator">:</span> WebView<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">var</span> mAndroidId<span class="token operator">:</span> String <span class="token operator">=</span> WebViewConstant<span class="token punctuation">.</span>DEFAULT_DEVICE_SIGN
    <span class="token keyword">var</span> mApiKey<span class="token operator">:</span> String <span class="token operator">=</span> WebViewConstant<span class="token punctuation">.</span>DEFAULT_API_KEY

    <span class="token comment">//回传H5时使用的对象</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> mUploadCallback<span class="token operator">:</span> ValueCallback<span class="token operator">&lt;</span>Array<span class="token operator">&lt;</span>Uri<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">//拍照传递的路径uri</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> mImageUri<span class="token operator">:</span> Uri<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>


    <span class="token comment">/**
     * onCreate方法是Activity生命周期的第一个回调方法
     * ，当Activity被创建时被调用。
     * 在这个方法中，你可以进行一些初始化的操作，比如设置布局、绑定控件、初始化数据等。
     *
     * @param savedInstanceState If the fragment is being re-created from
     * a previous saved state, this is the state.
     */</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        binding <span class="token operator">=</span> FragmentVisitorBinding<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>layoutInflater<span class="token punctuation">)</span>
        mRoot <span class="token operator">=</span> binding<span class="token punctuation">.</span>root
        <span class="token comment">//记录</span>
        <span class="token keyword">val</span> viewModel <span class="token operator">=</span> <span class="token function">ViewModelProvider</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>DashboardViewModel<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">]</span>
        viewModel<span class="token punctuation">.</span><span class="token function">setFragment</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>

        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"onCreate"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * onCreateView方法是Fragment生命周期的回调方法，
     * 当Fragment创建并绘制其用户界面时被调用。
     * 在这个方法中，你可以通过返回一个View对象来定义Fragment的用户界面。
     * 它常用于加载布局文件、查找和初始化控件等操作。
     *
     * @return
     */</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span>
        inflater<span class="token operator">:</span> LayoutInflater<span class="token punctuation">,</span>
        container<span class="token operator">:</span> ViewGroup<span class="token operator">?</span><span class="token punctuation">,</span>
        savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> View <span class="token punctuation">{<!-- --></span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"onCreateView"</span></span><span class="token punctuation">)</span>
        <span class="token function">initView</span><span class="token punctuation">(</span>mRoot<span class="token punctuation">,</span> layoutInflater<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> mRoot
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">initView</span><span class="token punctuation">(</span>parent<span class="token operator">:</span> View<span class="token operator">?</span><span class="token punctuation">,</span> inflater<span class="token operator">:</span> LayoutInflater<span class="token operator">?</span><span class="token punctuation">,</span> container<span class="token operator">:</span> ViewGroup<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//设置当前fragment</span>
        mAndroidId <span class="token operator">=</span> DeviceUtils<span class="token punctuation">.</span><span class="token function">getUniqueId</span><span class="token punctuation">(</span>mActivity<span class="token punctuation">)</span>
        <span class="token function">initWebView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        mWebView<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span>mWebViewUrl<span class="token punctuation">)</span>
        <span class="token comment">//弹出展示链接</span>
        <span class="token function">showToast</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression"><span class="token function">getString</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>current_develop_environment<span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">mWebViewUrl</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token function">initData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onAttach</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onAttach</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
        mActivity <span class="token operator">=</span> context <span class="token keyword">as</span> Activity
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param msg 内容
     */</span>
    <span class="token keyword">fun</span> <span class="token function">showToast</span><span class="token punctuation">(</span>msg<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">val</span> activity<span class="token operator">:</span> Activity<span class="token operator">?</span> <span class="token operator">=</span> activity
        activity<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">runOnUiThread</span> <span class="token punctuation">{<!-- --></span>
            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                activity<span class="token punctuation">,</span>
                msg<span class="token punctuation">,</span>
                Toast<span class="token punctuation">.</span>LENGTH_SHORT
            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">initData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"onResume"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token annotation builtin">@SuppressLint</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"SetJavaScriptEnabled"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">initWebView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"initWebView"</span></span><span class="token punctuation">)</span>
        mWebView <span class="token operator">=</span> binding<span class="token punctuation">.</span>mainWebView

        mWebView<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">requestFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        mWebView<span class="token operator">?</span><span class="token punctuation">.</span>isHorizontalScrollBarEnabled <span class="token operator">=</span> <span class="token boolean">false</span>
        mWebView<span class="token operator">?</span><span class="token punctuation">.</span>isVerticalScrollBarEnabled <span class="token operator">=</span> <span class="token boolean">false</span>


        <span class="token keyword">val</span> setting <span class="token operator">=</span> mWebView<span class="token operator">?</span><span class="token punctuation">.</span>settings
        setting<span class="token operator">?</span><span class="token punctuation">.</span>mixedContentMode <span class="token operator">=</span> WebSettings<span class="token punctuation">.</span>MIXED_CONTENT_ALWAYS_ALLOW<span class="token punctuation">;</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>javaScriptEnabled <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">//用于开启或禁用其 DOM（文档对象模型）存储功能，浏览器缓存这些数据</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>domStorageEnabled <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">//允许访问文件，默认允许</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>allowFileAccess <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">//设置不，会引起webView重新不急，默认NARROW_COLUMNS</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>layoutAlgorithm <span class="token operator">=</span> WebSettings<span class="token punctuation">.</span>LayoutAlgorithm<span class="token punctuation">.</span>NARROW_COLUMNS
        <span class="token comment">//自动缩放</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">setSupportZoom</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>builtInZoomControls <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">//自适应屏幕</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>useWideViewPort <span class="token operator">=</span> <span class="token boolean">true</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>loadWithOverviewMode <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">//支持多窗口</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">setSupportMultipleWindows</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">setAppCacheEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>domStorageEnabled <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">//定位</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">setGeolocationEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token comment">//优先使用缓存数据，在缓存数据不存在的情况下才去获取网络数据</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>cacheMode <span class="token operator">=</span> WebSettings<span class="token punctuation">.</span>LOAD_CACHE_ELSE_NETWORK
        setting<span class="token operator">?</span><span class="token punctuation">.</span>savePassword <span class="token operator">=</span> <span class="token boolean">false</span>

        <span class="token comment">//设置js接口</span>
        mVisitorAndroidJs<span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{<!-- --></span> mWebView<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">addJavascriptInterface</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"android"</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token comment">//页面不跳转浏览器</span>
        mWebView<span class="token operator">?</span><span class="token punctuation">.</span>webViewClient <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> <span class="token function">WebViewClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">shouldOverrideUrlLoading</span><span class="token punctuation">(</span>view<span class="token operator">:</span> WebView<span class="token punctuation">,</span> url<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{<!-- --></span>
                LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"url： </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">url</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                view<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">shouldInterceptRequest</span><span class="token punctuation">(</span>
                view<span class="token operator">:</span> WebView<span class="token punctuation">,</span>
                request<span class="token operator">:</span> WebResourceRequest
            <span class="token punctuation">)</span><span class="token operator">:</span> WebResourceResponse<span class="token operator">?</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">var</span> uri <span class="token operator">=</span> request<span class="token punctuation">.</span>url
                <span class="token keyword">var</span> path <span class="token operator">=</span> uri<span class="token punctuation">.</span>path
                LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"uri: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">uri</span></span><span class="token string">, path: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">path</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">shouldInterceptRequest</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> request<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>


        <span class="token comment">//webView官方打开文件选取方法onShowFileChooser，把网页回传文件</span>
        mWebView<span class="token operator">?</span><span class="token punctuation">.</span>webChromeClient <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> <span class="token function">WebChromeClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//API &gt;=21(android 5.0.1)回调此方法</span>
            <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onShowFileChooser</span><span class="token punctuation">(</span>
                webView<span class="token operator">:</span> WebView<span class="token operator">?</span><span class="token punctuation">,</span>
                filePathCallback<span class="token operator">:</span> ValueCallback<span class="token operator">&lt;</span>Array<span class="token operator">&lt;</span>Uri<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token operator">?</span><span class="token punctuation">,</span>
                fileChooserParams<span class="token operator">:</span> FileChooserParams<span class="token operator">?</span>
            <span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{<!-- --></span>
                mUploadCallback <span class="token operator">=</span> filePathCallback
                <span class="token comment">//使用拍照或者打开文件</span>
                mImageUri <span class="token operator">=</span> ChoosePhotoFile<span class="token punctuation">.</span><span class="token function">takePhoto</span><span class="token punctuation">(</span>mActivity<span class="token punctuation">)</span>

                <span class="token comment">//设置false会IllegalStateException: Duplicate showFileChooser result</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">onActivityResultResponse</span><span class="token punctuation">(</span>requestCode<span class="token operator">:</span> Int<span class="token punctuation">,</span> resultCode<span class="token operator">:</span> Int<span class="token punctuation">,</span> intent<span class="token operator">:</span> Intent<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>
            TAG<span class="token punctuation">,</span>
            <span class="token string-literal singleline"><span class="token string">"onActivityResultResponse requestCode </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">requestCode</span></span><span class="token string">, resultCode：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">resultCode</span></span><span class="token string">"</span></span>
        <span class="token punctuation">)</span>
        <span class="token comment">// 扫描二维码/条码回传</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>requestCode <span class="token operator">==</span> ScanCodeUtils<span class="token punctuation">.</span>REQUEST_CODE_SCAN <span class="token operator">&amp;&amp;</span> resultCode <span class="token operator">==</span> Activity<span class="token punctuation">.</span>RESULT_OK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"onActivityResultResponse </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">intent<span class="token operator">?</span><span class="token punctuation">.</span>extras</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//弹出展示链接</span>
                <span class="token function">showToast</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"扫描结果为空"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//传递给js，格式是"scanCodeResult('${data.extras}')"，其中单引号很重要，可能导致js script error</span>
            <span class="token comment">//codedContent是组件中定义的参数名</span>
            <span class="token function">setEvaluateJavascript</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"scanCodeResult('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"codedContent"</span></span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">')"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>requestCode <span class="token operator">==</span> ChoosePhotoFile<span class="token punctuation">.</span>REQUEST_CODE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//拍照，界面跳回后，结果文件的使用</span>
            ChoosePhotoFile<span class="token punctuation">.</span><span class="token function">takeActivityResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> intent<span class="token punctuation">,</span> mUploadCallback<span class="token punctuation">,</span> mImageUri<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>


    <span class="token annotation builtin">@Override</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//防止更新dialog内存泄漏</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 登录成功后跳转
     */</span>
    <span class="token keyword">open</span> <span class="token keyword">fun</span> <span class="token function">loginSuccessJump</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 给网页传值
     * 传递给js，格式是"scanCodeResult('${data.extras}')"
     * 其中单引号很重要，可能导致js script error
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">setEvaluateJavascript</span><span class="token punctuation">(</span>jspMethodAndValue<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>
            TAG<span class="token punctuation">,</span>
            <span class="token string-literal singleline"><span class="token string">"setEvaluateJavascript mWebView </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">mWebView</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, jspMethodAndValue </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">jspMethodAndValue</span></span><span class="token string">"</span></span>
        <span class="token punctuation">)</span>
        mWebView<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">evaluateJavascript</span><span class="token punctuation">(</span>jspMethodAndValue<span class="token punctuation">,</span> ValueCallback<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"给网页传值为: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">jspMethodAndValue</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>android layout布局</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>androidx.constraintlayout.widget.ConstraintLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>WebView</span>
        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/main_web_view<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>androidx.constraintlayout.widget.ConstraintLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><strong>2.获取照片的主要思路是两个方法：</strong></p> 
<ul><li>webView官方打开文件选取方法onShowFileChooser，把网页回传文件</li></ul> 
<pre><code class="prism language-kotlin">        <span class="token comment">//webView官方打开文件选取方法onShowFileChooser，把网页回传文件</span>
        mWebView<span class="token operator">?</span><span class="token punctuation">.</span>webChromeClient <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> <span class="token function">WebChromeClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//API &gt;=21(android 5.0.1)回调此方法</span>
            <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onShowFileChooser</span><span class="token punctuation">(</span>
                webView<span class="token operator">:</span> WebView<span class="token operator">?</span><span class="token punctuation">,</span>
                filePathCallback<span class="token operator">:</span> ValueCallback<span class="token operator">&lt;</span>Array<span class="token operator">&lt;</span>Uri<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token operator">?</span><span class="token punctuation">,</span>
                fileChooserParams<span class="token operator">:</span> FileChooserParams<span class="token operator">?</span>
            <span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{<!-- --></span>
                mUploadCallback <span class="token operator">=</span> filePathCallback
                <span class="token comment">//使用拍照或者打开文件</span>
                mImageUri <span class="token operator">=</span> ChoosePhotoFile<span class="token punctuation">.</span><span class="token function">takePhoto</span><span class="token punctuation">(</span>mActivity<span class="token punctuation">)</span>

                <span class="token comment">//设置false会IllegalStateException: Duplicate showFileChooser result</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre> 
<ul><li>拍照或者相册选中后界面跳回后，使用ValueCallback&lt;Array&gt;回传</li></ul> 
<pre><code class="prism language-kotlin">    <span class="token keyword">fun</span> <span class="token function">onActivityResultResponse</span><span class="token punctuation">(</span>requestCode<span class="token operator">:</span> Int<span class="token punctuation">,</span> resultCode<span class="token operator">:</span> Int<span class="token punctuation">,</span> intent<span class="token operator">:</span> Intent<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>
            TAG<span class="token punctuation">,</span>
            <span class="token string-literal singleline"><span class="token string">"onActivityResultResponse requestCode </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">requestCode</span></span><span class="token string">, resultCode：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">resultCode</span></span><span class="token string">"</span></span>
        <span class="token punctuation">)</span>
		 <span class="token keyword">if</span> <span class="token punctuation">(</span>requestCode <span class="token operator">==</span> ChoosePhotoFile<span class="token punctuation">.</span>REQUEST_CODE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//拍照或者相册选中后界面跳回后，结果文件的使用</span>
            ChoosePhotoFile<span class="token punctuation">.</span><span class="token function">takeActivityResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> intent<span class="token punctuation">,</span> mUploadCallback<span class="token punctuation">,</span> mImageUri<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
</code></pre> 
<ul><li>以上onActivityResultResponse方法需要在actvity onActivityResult方法中使用<br> （因为我这里是activity嵌套fragment的,如果直接在activity使用webview就不需我这太麻烦）</li></ul> 
<pre><code class="prism language-kotlin">    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onActivityResult</span><span class="token punctuation">(</span>requestCode<span class="token operator">:</span> Int<span class="token punctuation">,</span> resultCode<span class="token operator">:</span> Int<span class="token punctuation">,</span> <span class="token keyword">data</span><span class="token operator">:</span> Intent<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onActivityResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> resultCode<span class="token punctuation">,</span> <span class="token keyword">data</span><span class="token punctuation">)</span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>
            TAG<span class="token punctuation">,</span>
            <span class="token string-literal singleline"><span class="token string">"onActivityResult requestCode11 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">requestCode</span></span><span class="token string">, resultCode：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">resultCode</span></span><span class="token string">"</span></span>
        <span class="token punctuation">)</span>
        <span class="token comment">//设置当前fragment</span>
        <span class="token keyword">val</span> fragment <span class="token operator">=</span> mDashboardViewModel<span class="token punctuation">.</span>fragment<span class="token punctuation">.</span>value
        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"fragment: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">fragment</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"fragment.isResumed: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">fragment<span class="token operator">?</span><span class="token punctuation">.</span>isResumed</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token comment">//界面返回时VisitorFragment还没有Resumed</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fragment <span class="token keyword">is</span> VisitorFragment<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">val</span> visitorFragment<span class="token operator">:</span> VisitorFragment <span class="token operator">=</span> fragment
            visitorFragment<span class="token punctuation">.</span><span class="token function">onActivityResultResponse</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> resultCode<span class="token punctuation">,</span> <span class="token keyword">data</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><strong>3.打开相机和相册的工具类</strong></p> 
<pre><code class="prism language-kotlin"><span class="token keyword">object</span> ChoosePhotoFile <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">const</span> <span class="token keyword">val</span> TAG <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"ChoosePhotoFile"</span></span>
    <span class="token keyword">const</span> <span class="token keyword">val</span> REQUEST_CODE<span class="token operator">:</span> Int <span class="token operator">=</span> <span class="token number">12345</span>

    <span class="token keyword">fun</span> <span class="token function">takePhoto</span><span class="token punctuation">(</span>activity<span class="token operator">:</span> Activity<span class="token punctuation">)</span><span class="token operator">:</span> Uri <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//相机可以访问的公共位置才能存储，获取时需要读取文件权限</span>
        <span class="token keyword">val</span> file<span class="token operator">:</span> String <span class="token operator">=</span>
            Environment<span class="token punctuation">.</span><span class="token function">getExternalStorageDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> File<span class="token punctuation">.</span>separator <span class="token operator">+</span> Environment<span class="token punctuation">.</span>DIRECTORY_PICTURES <span class="token operator">+</span> File<span class="token punctuation">.</span>separator
        <span class="token keyword">val</span> fileName <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"Image_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression"><span class="token function">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"yyyyMMdd_HHmmss"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token function">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.jpg"</span></span>
        <span class="token keyword">val</span> realFile <span class="token operator">=</span> <span class="token function">File</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>
        <span class="token keyword">val</span> imageUri <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">fromFile</span><span class="token punctuation">(</span>realFile<span class="token punctuation">)</span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"realFile：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">realFile</span></span><span class="token string">, imageUri: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">imageUri</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token comment">// 拍照后获取图片需要文件权限，界面跳转直接拿文件不需要权限</span>
        <span class="token comment">//检查申请读文件权限</span>
        CheckPermissionUtils<span class="token punctuation">.</span><span class="token function">requestPermissions</span><span class="token punctuation">(</span>
            activity<span class="token punctuation">,</span>
            <span class="token function">arrayOf</span><span class="token punctuation">(</span>Manifest<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>READ_EXTERNAL_STORAGE<span class="token punctuation">,</span> Manifest<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>CAMERA<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>

        <span class="token comment">//调起相机,拍一张照片</span>
        <span class="token keyword">val</span> captureIntent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>MediaStore<span class="token punctuation">.</span>ACTION_IMAGE_CAPTURE<span class="token punctuation">)</span>
        captureIntent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span>MediaStore<span class="token punctuation">.</span>EXTRA_OUTPUT<span class="token punctuation">,</span> imageUri<span class="token punctuation">)</span>
        <span class="token comment">//调起相册，取一张照片</span>
        <span class="token keyword">val</span> photoIntent <span class="token operator">=</span> <span class="token function">Intent</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>ACTION_PICK<span class="token punctuation">,</span> MediaStore<span class="token punctuation">.</span>Images<span class="token punctuation">.</span>Media<span class="token punctuation">.</span>EXTERNAL_CONTENT_URI<span class="token punctuation">)</span>
        <span class="token comment">//选择方式，拍照或者相册</span>
        <span class="token keyword">val</span> chooserIntent <span class="token operator">=</span> Intent<span class="token punctuation">.</span><span class="token function">createChooser</span><span class="token punctuation">(</span>photoIntent<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"Image Chooser"</span></span><span class="token punctuation">)</span>
        chooserIntent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span>Intent<span class="token punctuation">.</span>EXTRA_INITIAL_INTENTS<span class="token punctuation">,</span> arrayOf<span class="token operator">&lt;</span>Parcelable<span class="token operator">&gt;</span><span class="token punctuation">(</span>captureIntent<span class="token punctuation">)</span><span class="token punctuation">)</span>
        activity<span class="token punctuation">.</span><span class="token function">startActivityForResult</span><span class="token punctuation">(</span>chooserIntent<span class="token punctuation">,</span> REQUEST_CODE<span class="token punctuation">)</span>
        <span class="token keyword">return</span> imageUri
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * H5针对从拍照或者相册中选中的图片做处理
     * @param imageUri 拍照返回的数据，
     */</span>

    <span class="token keyword">fun</span> <span class="token function">takeActivityResult</span><span class="token punctuation">(</span>
        requestCode<span class="token operator">:</span> Int<span class="token punctuation">,</span>
        intent<span class="token operator">:</span> Intent<span class="token operator">?</span><span class="token punctuation">,</span>
        filePathCallback<span class="token operator">:</span> ValueCallback<span class="token operator">&lt;</span>Array<span class="token operator">&lt;</span>Uri<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token operator">?</span><span class="token punctuation">,</span>
        imageUri<span class="token operator">:</span> Uri<span class="token operator">?</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>requestCode <span class="token operator">==</span> REQUEST_CODE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//从相册获取，返回的intent</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> intent<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">var</span> uri<span class="token operator">:</span> Uri <span class="token operator">=</span> intent<span class="token punctuation">.</span>data <span class="token keyword">as</span> Uri
                LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"file uri: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">uri</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                filePathCallback<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">onReceiveValue</span><span class="token punctuation">(</span>arrayOf<span class="token operator">&lt;</span>Uri<span class="token operator">&gt;</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//从拍照中获取图片，已经返回的imageUri</span>
                LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"take photo imageUri: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">imageUri</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>imageUri <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    filePathCallback<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">onReceiveValue</span><span class="token punctuation">(</span>arrayOf<span class="token operator">&lt;</span>Uri<span class="token operator">&gt;</span><span class="token punctuation">(</span>imageUri<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    filePathCallback<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">onReceiveValue</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="android__527"></a>方式二：使用android 组件库是实现-朋友圈获取照片功能</h5> 
<p>实际效果和流程示图<br> <img src="https://images2.imgbox.com/d5/03/PSWPyn4r_o.png" alt="在这里插入图片描述"><br> <strong>1.获取照片的主要思路是两个方法-替换</strong></p> 
<ul><li>webView官方打开文件选取方法onShowFileChooser，把网页回传文件</li></ul> 
<pre><code class="prism language-kotlin">        <span class="token comment">//webView官方打开文件选取方法onShowFileChooser，把网页回传文件</span>
        mWebView<span class="token operator">?</span><span class="token punctuation">.</span>webChromeClient <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> <span class="token function">WebChromeClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//API &gt;=21(android 5.0.1)回调此方法</span>
            <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onShowFileChooser</span><span class="token punctuation">(</span>
                webView<span class="token operator">:</span> WebView<span class="token operator">?</span><span class="token punctuation">,</span>
                filePathCallback<span class="token operator">:</span> ValueCallback<span class="token operator">&lt;</span>Array<span class="token operator">&lt;</span>Uri<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token operator">?</span><span class="token punctuation">,</span>
                fileChooserParams<span class="token operator">:</span> FileChooserParams<span class="token operator">?</span>
            <span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{<!-- --></span>
                mUploadCallback <span class="token operator">=</span> filePathCallback
                <span class="token comment">//使用拍照或者打开文件</span>
<span class="token comment">//                mImageUri = ChoosePhotoFile.takePhoto(mActivity)</span>
                <span class="token comment">//模拟微信朋友圈获取照片模式</span>
                LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span><span class="token string-literal singleline"><span class="token string">"onShowFileChooser"</span></span><span class="token punctuation">)</span>
                PictureSelectorUtils<span class="token punctuation">.</span><span class="token function">startPictureSelector</span><span class="token punctuation">(</span>mActivity<span class="token punctuation">)</span>

                <span class="token comment">//设置false会IllegalStateException: Duplicate showFileChooser result</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre> 
<ul><li>拍照或者相册选中后界面跳回后，使用ValueCallback&lt;Array&gt;回传</li></ul> 
<pre><code class="prism language-kotlin">    <span class="token keyword">fun</span> <span class="token function">onActivityResultResponse</span><span class="token punctuation">(</span>requestCode<span class="token operator">:</span> Int<span class="token punctuation">,</span> resultCode<span class="token operator">:</span> Int<span class="token punctuation">,</span> intent<span class="token operator">:</span> Intent<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>
            TAG<span class="token punctuation">,</span>
            <span class="token string-literal singleline"><span class="token string">"onActivityResultResponse requestCode </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">requestCode</span></span><span class="token string">, resultCode：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">resultCode</span></span><span class="token string">"</span></span>
        <span class="token punctuation">)</span>
		 <span class="token keyword">if</span> <span class="token punctuation">(</span>requestCode <span class="token operator">==</span> PictureSelectorUtils<span class="token punctuation">.</span>REQUEST_PICTURE_SELECTOR<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"onActivityResultResponse REQUEST_PICTURE_SELECTOR"</span></span><span class="token punctuation">)</span>
            PictureSelectorUtils<span class="token punctuation">.</span><span class="token function">takeActivityResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> intent<span class="token punctuation">,</span> mUploadCallback<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
</code></pre> 
<p><strong>2.打开相机和相册的工具类</strong></p> 
<pre><code class="prism language-kotlin"><span class="token keyword">object</span> PictureSelectorUtils <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> <span class="token keyword">val</span> REQUEST_PICTURE_SELECTOR <span class="token operator">=</span> <span class="token number">10012</span>
    <span class="token keyword">const</span> <span class="token keyword">val</span> TAG <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"PictureSelectorUtils"</span></span>

    <span class="token keyword">fun</span> <span class="token function">startPictureSelector</span><span class="token punctuation">(</span>activity<span class="token operator">:</span> Activity<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"startPictureSelector"</span></span><span class="token punctuation">)</span>
        <span class="token comment">// 拍照后获取图片需要文件权限，界面跳转直接拿文件不需要权限</span>
        <span class="token comment">//检查申请读文件权限</span>
<span class="token comment">//        CheckPermissionUtils.requestPermissions(</span>
<span class="token comment">//            activity,</span>
<span class="token comment">//            arrayOf(</span>
<span class="token comment">//                Manifest.permission.CAMERA,</span>
<span class="token comment">//                Manifest.permission.READ_EXTERNAL_STORAGE,</span>
<span class="token comment">//                Manifest.permission.WRITE_EXTERNAL_STORAGE</span>
<span class="token comment">//            )</span>
<span class="token comment">//        )</span>
        <span class="token comment">//插件里自带了静态权限以及权限校验</span>
        PictureSelector<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>activity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openGallery</span><span class="token punctuation">(</span>PictureMimeType<span class="token punctuation">.</span><span class="token function">ofImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">imageEngine</span><span class="token punctuation">(</span>GlideEngine<span class="token punctuation">)</span> <span class="token comment">// Please refer to the Demo GlideEngine.java</span>
            <span class="token punctuation">.</span><span class="token function">isWeChatStyle</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 是否开启微信图片选择风格</span>
            <span class="token punctuation">.</span><span class="token function">selectionMode</span><span class="token punctuation">(</span>PictureConfig<span class="token punctuation">.</span>MULTIPLE<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forResult</span><span class="token punctuation">(</span>REQUEST_PICTURE_SELECTOR<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">getPictures</span><span class="token punctuation">(</span><span class="token keyword">data</span><span class="token operator">:</span> Intent<span class="token punctuation">)</span><span class="token operator">:</span> MutableList<span class="token operator">&lt;</span>Uri<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">val</span> selectList <span class="token operator">=</span> PictureSelector<span class="token punctuation">.</span><span class="token function">obtainMultipleResult</span><span class="token punctuation">(</span><span class="token keyword">data</span><span class="token punctuation">)</span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"getPicture selectList: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">selectList</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token comment">// 将照片路径转换成 Uri 列表</span>
        <span class="token keyword">val</span> imageUris<span class="token operator">:</span> MutableList<span class="token operator">&lt;</span>Uri<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>selectList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"getPicture selectList isEmpty"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> imageUris
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>imagePath <span class="token keyword">in</span> selectList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> path <span class="token operator">=</span> imagePath<span class="token punctuation">.</span>path
            LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"path: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">path</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

            <span class="token keyword">val</span> uri <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
            LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"uri: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">uri</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            imageUris<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"imageUris: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">imageUris<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> imageUris
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * H5针对从文件钟选中的图片做处理
     */</span>
    <span class="token keyword">fun</span> <span class="token function">takeActivityResult</span><span class="token punctuation">(</span>
        requestCode<span class="token operator">:</span> Int<span class="token punctuation">,</span>
        intent<span class="token operator">:</span> Intent<span class="token operator">?</span><span class="token punctuation">,</span>
        filePathCallback<span class="token operator">:</span> ValueCallback<span class="token operator">&lt;</span>Array<span class="token operator">&lt;</span>Uri<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token operator">?</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>requestCode <span class="token operator">==</span> REQUEST_PICTURE_SELECTOR<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

            <span class="token keyword">val</span> selectList <span class="token operator">=</span> PictureSelector<span class="token punctuation">.</span><span class="token function">obtainMultipleResult</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span>
            LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"getPicture selectList: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">selectList</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token comment">// 将照片路径转换成 Uri 列表</span>
            <span class="token keyword">val</span> imageUris<span class="token operator">:</span> MutableList<span class="token operator">&lt;</span>Uri<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">ArrayList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>selectList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"getPicture selectList isEmpty"</span></span><span class="token punctuation">)</span>
                filePathCallback<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">onReceiveValue</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>imagePath <span class="token keyword">in</span> selectList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">var</span> path <span class="token operator">=</span> imagePath<span class="token punctuation">.</span>path
                LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"path: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">path</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

                <span class="token keyword">val</span> uri <span class="token operator">=</span> Uri<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
                LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"uri: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">uri</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                imageUris<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"imageUris: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">imageUris<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            filePathCallback<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">onReceiveValue</span><span class="token punctuation">(</span>imageUris<span class="token punctuation">.</span><span class="token function">toTypedArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>其中使用第三方组件库-实现类似朋友圈获取照片的样式，需要引入一下依赖</p> 
<pre><code class="prism language-groovy">    <span class="token comment">//照片获取类微信朋友圈</span>
    implementation <span class="token string">'com.github.LuckSiege.PictureSelector:picture_library:v2.6.0'</span>
</code></pre> 
<p>拍照后获取图片需要文件权限，界面跳转直接拿文件不需要权限,且第三方插件库里自带了静态权限以及权限请求</p> 
<p><strong>3.我完整的代码——类似朋友圈获取界面逻辑</strong></p> 
<pre><code class="prism language-kotlin"><span class="token keyword">class</span> VisitorFragment <span class="token operator">:</span> <span class="token function">Fragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">lateinit</span> <span class="token keyword">var</span> binding<span class="token operator">:</span> FragmentVisitorBinding
    <span class="token keyword">lateinit</span> <span class="token keyword">var</span> mActivity<span class="token operator">:</span> Activity
    <span class="token keyword">private</span> <span class="token keyword">lateinit</span> <span class="token keyword">var</span> mRoot<span class="token operator">:</span> View

    <span class="token keyword">companion</span> <span class="token keyword">object</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> <span class="token keyword">val</span> TAG <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">"VisitorFragment"</span></span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">var</span> mWebViewUrl<span class="token operator">:</span> String <span class="token operator">=</span> "file<span class="token operator">:</span><span class="token operator">/</span><span class="token comment">//android_asset/vue_android_demo.html"</span>

    <span class="token keyword">var</span> mAppName <span class="token operator">=</span> MainApplication<span class="token punctuation">.</span>instance<span class="token punctuation">.</span>configuration<span class="token punctuation">.</span>BASE_APP_LOGIN_IDENTITY
    <span class="token keyword">var</span> mSystemName <span class="token operator">=</span> WebViewConstant<span class="token punctuation">.</span>DEFAULT_SYSTEM_NAME
    <span class="token keyword">private</span> <span class="token keyword">var</span> mVisitorAndroidJs<span class="token operator">:</span> VisitorAndroidJs <span class="token operator">=</span> <span class="token function">VisitorAndroidJs</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>

    <span class="token keyword">private</span> <span class="token keyword">var</span> mWebView<span class="token operator">:</span> WebView<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">var</span> mAndroidId<span class="token operator">:</span> String <span class="token operator">=</span> WebViewConstant<span class="token punctuation">.</span>DEFAULT_DEVICE_SIGN
    <span class="token keyword">var</span> mApiKey<span class="token operator">:</span> String <span class="token operator">=</span> WebViewConstant<span class="token punctuation">.</span>DEFAULT_API_KEY

    <span class="token comment">//回传H5时使用的对象</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> mUploadCallback<span class="token operator">:</span> ValueCallback<span class="token operator">&lt;</span>Array<span class="token operator">&lt;</span>Uri<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>

    <span class="token comment">//拍照传递的路径uri</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> mImageUri<span class="token operator">:</span> Uri<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span>


    <span class="token comment">/**
     * onCreate方法是Activity生命周期的第一个回调方法
     * ，当Activity被创建时被调用。
     * 在这个方法中，你可以进行一些初始化的操作，比如设置布局、绑定控件、初始化数据等。
     *
     * @param savedInstanceState If the fragment is being re-created from
     * a previous saved state, this is the state.
     */</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span>
        binding <span class="token operator">=</span> FragmentVisitorBinding<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>layoutInflater<span class="token punctuation">)</span>
        mRoot <span class="token operator">=</span> binding<span class="token punctuation">.</span>root
        <span class="token comment">//记录</span>
        <span class="token keyword">val</span> viewModel <span class="token operator">=</span> <span class="token function">ViewModelProvider</span><span class="token punctuation">(</span><span class="token function">requireActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span>DashboardViewModel<span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">.</span>java<span class="token punctuation">]</span>
        viewModel<span class="token punctuation">.</span><span class="token function">setFragment</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>

        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"onCreate"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * onCreateView方法是Fragment生命周期的回调方法，
     * 当Fragment创建并绘制其用户界面时被调用。
     * 在这个方法中，你可以通过返回一个View对象来定义Fragment的用户界面。
     * 它常用于加载布局文件、查找和初始化控件等操作。
     *
     * @return
     */</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span>
        inflater<span class="token operator">:</span> LayoutInflater<span class="token punctuation">,</span>
        container<span class="token operator">:</span> ViewGroup<span class="token operator">?</span><span class="token punctuation">,</span>
        savedInstanceState<span class="token operator">:</span> Bundle<span class="token operator">?</span>
    <span class="token punctuation">)</span><span class="token operator">:</span> View <span class="token punctuation">{<!-- --></span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"onCreateView"</span></span><span class="token punctuation">)</span>
        <span class="token function">initView</span><span class="token punctuation">(</span>mRoot<span class="token punctuation">,</span> layoutInflater<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> mRoot
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">initView</span><span class="token punctuation">(</span>parent<span class="token operator">:</span> View<span class="token operator">?</span><span class="token punctuation">,</span> inflater<span class="token operator">:</span> LayoutInflater<span class="token operator">?</span><span class="token punctuation">,</span> container<span class="token operator">:</span> ViewGroup<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//设置当前fragment</span>
        mAndroidId <span class="token operator">=</span> DeviceUtils<span class="token punctuation">.</span><span class="token function">getUniqueId</span><span class="token punctuation">(</span>mActivity<span class="token punctuation">)</span>
        <span class="token function">initWebView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        mWebView<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span>mWebViewUrl<span class="token punctuation">)</span>
        <span class="token comment">//弹出展示链接</span>
        <span class="token function">showToast</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression"><span class="token function">getString</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>current_develop_environment<span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">mWebViewUrl</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token function">initData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onAttach</span><span class="token punctuation">(</span>context<span class="token operator">:</span> Context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onAttach</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>
        mActivity <span class="token operator">=</span> context <span class="token keyword">as</span> Activity
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param msg 内容
     */</span>
    <span class="token keyword">fun</span> <span class="token function">showToast</span><span class="token punctuation">(</span>msg<span class="token operator">:</span> String<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">val</span> activity<span class="token operator">:</span> Activity<span class="token operator">?</span> <span class="token operator">=</span> activity
        activity<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">runOnUiThread</span> <span class="token punctuation">{<!-- --></span>
            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>
                activity<span class="token punctuation">,</span>
                msg<span class="token punctuation">,</span>
                Toast<span class="token punctuation">.</span>LENGTH_SHORT
            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">initData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"onResume"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token annotation builtin">@SuppressLint</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"SetJavaScriptEnabled"</span></span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">initWebView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"initWebView"</span></span><span class="token punctuation">)</span>
        mWebView <span class="token operator">=</span> binding<span class="token punctuation">.</span>mainWebView

        mWebView<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">requestFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        mWebView<span class="token operator">?</span><span class="token punctuation">.</span>isHorizontalScrollBarEnabled <span class="token operator">=</span> <span class="token boolean">false</span>
        mWebView<span class="token operator">?</span><span class="token punctuation">.</span>isVerticalScrollBarEnabled <span class="token operator">=</span> <span class="token boolean">false</span>


        <span class="token keyword">val</span> setting <span class="token operator">=</span> mWebView<span class="token operator">?</span><span class="token punctuation">.</span>settings
        setting<span class="token operator">?</span><span class="token punctuation">.</span>mixedContentMode <span class="token operator">=</span> WebSettings<span class="token punctuation">.</span>MIXED_CONTENT_ALWAYS_ALLOW<span class="token punctuation">;</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>javaScriptEnabled <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">//用于开启或禁用其 DOM（文档对象模型）存储功能，浏览器缓存这些数据</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>domStorageEnabled <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">//允许访问文件，默认允许</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>allowFileAccess <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">//设置不，会引起webView重新不急，默认NARROW_COLUMNS</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>layoutAlgorithm <span class="token operator">=</span> WebSettings<span class="token punctuation">.</span>LayoutAlgorithm<span class="token punctuation">.</span>NARROW_COLUMNS
        <span class="token comment">//自动缩放</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">setSupportZoom</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>builtInZoomControls <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">//自适应屏幕</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>useWideViewPort <span class="token operator">=</span> <span class="token boolean">true</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>loadWithOverviewMode <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">//支持多窗口</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">setSupportMultipleWindows</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">setAppCacheEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>domStorageEnabled <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token comment">//定位</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">setGeolocationEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token comment">//优先使用缓存数据，在缓存数据不存在的情况下才去获取网络数据</span>
        setting<span class="token operator">?</span><span class="token punctuation">.</span>cacheMode <span class="token operator">=</span> WebSettings<span class="token punctuation">.</span>LOAD_CACHE_ELSE_NETWORK
        setting<span class="token operator">?</span><span class="token punctuation">.</span>savePassword <span class="token operator">=</span> <span class="token boolean">false</span>

        <span class="token comment">//设置js接口</span>
        mVisitorAndroidJs<span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{<!-- --></span> mWebView<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">addJavascriptInterface</span><span class="token punctuation">(</span>it<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"android"</span></span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token comment">//页面不跳转浏览器</span>
        mWebView<span class="token operator">?</span><span class="token punctuation">.</span>webViewClient <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> <span class="token function">WebViewClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">shouldOverrideUrlLoading</span><span class="token punctuation">(</span>view<span class="token operator">:</span> WebView<span class="token punctuation">,</span> url<span class="token operator">:</span> String<span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{<!-- --></span>
                LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"url： </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">url</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                view<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">shouldInterceptRequest</span><span class="token punctuation">(</span>
                view<span class="token operator">:</span> WebView<span class="token punctuation">,</span>
                request<span class="token operator">:</span> WebResourceRequest
            <span class="token punctuation">)</span><span class="token operator">:</span> WebResourceResponse<span class="token operator">?</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">var</span> uri <span class="token operator">=</span> request<span class="token punctuation">.</span>url
                <span class="token keyword">var</span> path <span class="token operator">=</span> uri<span class="token punctuation">.</span>path
                LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"uri: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">uri</span></span><span class="token string">, path: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">path</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">shouldInterceptRequest</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> request<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>


        <span class="token comment">//webView官方打开文件选取方法onShowFileChooser，把网页回传文件</span>
        mWebView<span class="token operator">?</span><span class="token punctuation">.</span>webChromeClient <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">:</span> <span class="token function">WebChromeClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//API &gt;=21(android 5.0.1)回调此方法</span>
            <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onShowFileChooser</span><span class="token punctuation">(</span>
                webView<span class="token operator">:</span> WebView<span class="token operator">?</span><span class="token punctuation">,</span>
                filePathCallback<span class="token operator">:</span> ValueCallback<span class="token operator">&lt;</span>Array<span class="token operator">&lt;</span>Uri<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token operator">?</span><span class="token punctuation">,</span>
                fileChooserParams<span class="token operator">:</span> FileChooserParams<span class="token operator">?</span>
            <span class="token punctuation">)</span><span class="token operator">:</span> Boolean <span class="token punctuation">{<!-- --></span>
                mUploadCallback <span class="token operator">=</span> filePathCallback
                <span class="token comment">//使用拍照或者打开文件</span>
<span class="token comment">//                mImageUri = ChoosePhotoFile.takePhoto(mActivity)</span>
                <span class="token comment">//模拟微信朋友圈获取照片模式</span>
                LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span><span class="token string-literal singleline"><span class="token string">"onShowFileChooser"</span></span><span class="token punctuation">)</span>
                PictureSelectorUtils<span class="token punctuation">.</span><span class="token function">startPictureSelector</span><span class="token punctuation">(</span>mActivity<span class="token punctuation">)</span>

                <span class="token comment">//设置false会IllegalStateException: Duplicate showFileChooser result</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">fun</span> <span class="token function">onActivityResultResponse</span><span class="token punctuation">(</span>requestCode<span class="token operator">:</span> Int<span class="token punctuation">,</span> resultCode<span class="token operator">:</span> Int<span class="token punctuation">,</span> intent<span class="token operator">:</span> Intent<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>
            TAG<span class="token punctuation">,</span>
            <span class="token string-literal singleline"><span class="token string">"onActivityResultResponse requestCode </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">requestCode</span></span><span class="token string">, resultCode：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">resultCode</span></span><span class="token string">"</span></span>
        <span class="token punctuation">)</span>
        <span class="token comment">// 扫描二维码/条码回传</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>requestCode <span class="token operator">==</span> ScanCodeUtils<span class="token punctuation">.</span>REQUEST_CODE_SCAN <span class="token operator">&amp;&amp;</span> resultCode <span class="token operator">==</span> Activity<span class="token punctuation">.</span>RESULT_OK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"onActivityResultResponse </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">intent<span class="token operator">?</span><span class="token punctuation">.</span>extras</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//弹出展示链接</span>
                <span class="token function">showToast</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"扫描结果为空"</span></span><span class="token punctuation">)</span>
                <span class="token keyword">return</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//传递给js，格式是"scanCodeResult('${data.extras}')"，其中单引号很重要，可能导致js script error</span>
            <span class="token comment">//codedContent是组件中定义的参数名</span>
            <span class="token function">setEvaluateJavascript</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"scanCodeResult('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">"codedContent"</span></span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">')"</span></span><span class="token punctuation">)</span>
<span class="token comment">//        } else if (requestCode == ChoosePhotoFile.REQUEST_CODE) {<!-- --></span>
<span class="token comment">//            //拍照，界面跳回后，结果文件的使用</span>
<span class="token comment">//            ChoosePhotoFile.takeActivityResult(requestCode, intent, mUploadCallback, mImageUri)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>requestCode <span class="token operator">==</span> PictureSelectorUtils<span class="token punctuation">.</span>REQUEST_PICTURE_SELECTOR<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"onActivityResultResponse REQUEST_PICTURE_SELECTOR"</span></span><span class="token punctuation">)</span>
            PictureSelectorUtils<span class="token punctuation">.</span><span class="token function">takeActivityResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> intent<span class="token punctuation">,</span> mUploadCallback<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>


    <span class="token annotation builtin">@Override</span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//防止更新dialog内存泄漏</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 登录成功后跳转
     */</span>
    <span class="token keyword">open</span> <span class="token keyword">fun</span> <span class="token function">loginSuccessJump</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 给网页传值
     * 传递给js，格式是"scanCodeResult('${data.extras}')"
     * 其中单引号很重要，可能导致js script error
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">fun</span> <span class="token function">setEvaluateJavascript</span><span class="token punctuation">(</span>jspMethodAndValue<span class="token operator">:</span> String<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>
            TAG<span class="token punctuation">,</span>
            <span class="token string-literal singleline"><span class="token string">"setEvaluateJavascript mWebView </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">mWebView</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, jspMethodAndValue </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">jspMethodAndValue</span></span><span class="token string">"</span></span>
        <span class="token punctuation">)</span>
        mWebView<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">evaluateJavascript</span><span class="token punctuation">(</span>jspMethodAndValue<span class="token punctuation">,</span> ValueCallback<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            LogUtils<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string-literal singleline"><span class="token string">"给网页传值为: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">jspMethodAndValue</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_896"></a>三、总结一下</h4> 
<ul><li>H5调用公共获取图片文件方法，</li><li>在android手机端，H5主要依赖Webview,</li><li>这边在webview声明并重写该方法onShowFileChooser</li><li>使用工具类打开相机或相册，可以两种方式安卓原生方式或者利用第三方组件库方式</li><li>选中图片，返回uri列表给H5</li><li>H5收到uri照片列表，并且使用前端方式展示</li></ul> 
<p>创造价值，乐哉分享！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c5260e0e41c8cea79859831965458fea/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ClickHouse10-ClickHouse中Kafka表引擎</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/83640b7c9dfcc9e2c10199cc485157df/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">web 技术中前端和后端交互过程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>