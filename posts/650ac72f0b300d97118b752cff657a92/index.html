<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何在springboot3.x使用knife4j，以及knife4j无法访问（404）解决办法，微服务项目debug经验分享 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/650ac72f0b300d97118b752cff657a92/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="如何在springboot3.x使用knife4j，以及knife4j无法访问（404）解决办法，微服务项目debug经验分享">
  <meta property="og:description" content="目录
如何在springboot3.x的版本使用knife4j？
解决knife4j无法访问
以下是一些关于怎么找到这个解决办法（微服务项目debug）的经验（吐槽）分享
如何在springboot3.x的版本使用knife4j？ 参考springboot版本：3.2.4
相比于springboot2.x版本，在3.x版本使用knife4j将有较大的不同
关于使用的官方文档：快速开始 | Knife4j (xiaominfo.com)
1. 首先，对于需要使用knife4j的模块，在其pom.xml中添加依赖：
&lt;dependency&gt; &lt;groupId&gt;com.github.xiaoymin&lt;/groupId&gt; &lt;artifactId&gt;knife4j-openapi3-jakarta-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;4.4.0&lt;/version&gt; &lt;/dependency&gt; 2. 然后在模块下的src/main/resources/application.yml文件中配置属性
需要且仅需要更改packages-to-scan:的值，改为你模块下controller包的路径
# springdoc-openapi项目配置 springdoc: swagger-ui: path: /swagger-ui.html tags-sorter: alpha operations-sorter: alpha api-docs: path: /v3/api-docs group-configs: - group: &#39;default&#39; paths-to-match: &#39;/**&#39; packages-to-scan: com.xiaominfo.knife4j.demo.web #这里换成你模块下controller包的路径 # knife4j的增强配置，不需要增强可以不配（建议配置一下） knife4j: enable: true setting: language: zh_cn 3. 在需要的地方添加上注解
拿最重要的两个注解来说：
@Tag(name = &#34;xxx&#34;) 加在controller类前，用于将不同controller类分开，xxx换成你想定义为什么名字 @Operation(summary = &#34;xxx&#34;) 加在controller中各个方法前，用于定义这个方法的名字 实际效果举例：
解决knife4j无法访问 输入{ip}:{port}/doc.html 但无法访问，显示如下：
或者：
idea中有输出，如下：
解决办法：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-02T19:23:17+08:00">
    <meta property="article:modified_time" content="2024-04-02T19:23:17+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何在springboot3.x使用knife4j，以及knife4j无法访问（404）解决办法，微服务项目debug经验分享</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="%E5%A6%82%E4%BD%95%E5%9C%A8springboot3.x%E7%9A%84%E7%89%88%E6%9C%AC%E4%BD%BF%E7%94%A8knife4j%EF%BC%9F-toc" style="margin-left:0px;"><a href="#%E5%A6%82%E4%BD%95%E5%9C%A8springboot3.x%E7%9A%84%E7%89%88%E6%9C%AC%E4%BD%BF%E7%94%A8knife4j%EF%BC%9F" rel="nofollow">如何在springboot3.x的版本使用knife4j？</a></p> 
<p id="%E8%A7%A3%E5%86%B3knife4j%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE-toc" style="margin-left:0px;"><a href="#%E8%A7%A3%E5%86%B3knife4j%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE" rel="nofollow">解决knife4j无法访问</a></p> 
<p id="%E4%BB%A5%E4%B8%8B%E6%98%AF%E4%B8%80%E4%BA%9B%E5%85%B3%E4%BA%8E%E6%80%8E%E4%B9%88%E6%89%BE%E5%88%B0%E8%BF%99%E4%B8%AA%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%E7%9A%84%E7%BB%8F%E9%AA%8C%EF%BC%88%E5%90%90%E6%A7%BD%EF%BC%89%E5%88%86%E4%BA%AB-toc" style="margin-left:0px;"><a href="#%E4%BB%A5%E4%B8%8B%E6%98%AF%E4%B8%80%E4%BA%9B%E5%85%B3%E4%BA%8E%E6%80%8E%E4%B9%88%E6%89%BE%E5%88%B0%E8%BF%99%E4%B8%AA%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%E7%9A%84%E7%BB%8F%E9%AA%8C%EF%BC%88%E5%90%90%E6%A7%BD%EF%BC%89%E5%88%86%E4%BA%AB" rel="nofollow">以下是一些关于怎么找到这个解决办法（微服务项目debug）的经验<s>（吐槽）</s>分享</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E5%A6%82%E4%BD%95%E5%9C%A8springboot3.x%E7%9A%84%E7%89%88%E6%9C%AC%E4%BD%BF%E7%94%A8knife4j%EF%BC%9F">如何在springboot3.x的版本使用knife4j？</h2> 
<p>参考springboot版本：3.2.4</p> 
<p>相比于springboot2.x版本，在3.x版本使用knife4j将有较大的不同</p> 
<p>关于使用的官方文档：<a href="https://doc.xiaominfo.com/docs/quick-start" rel="nofollow" title="快速开始 | Knife4j (xiaominfo.com)">快速开始 | Knife4j (xiaominfo.com)</a></p> 
<p>        <strong>1.</strong> 首先，对于需要使用knife4j的模块，在其pom.xml中添加依赖：</p> 
<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;com.github.xiaoymin&lt;/groupId&gt;
    &lt;artifactId&gt;knife4j-openapi3-jakarta-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;4.4.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre> 
<p>        <strong>2.</strong> 然后在模块下的src/main/resources/application.yml文件中配置属性</p> 
<p><strong>需要且仅需要更改packages-to-scan:的值，改为你模块下controller包的路径</strong></p> 
<pre><code># springdoc-openapi项目配置
springdoc:
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: alpha
  api-docs:
    path: /v3/api-docs
  group-configs:
    - group: 'default'
      paths-to-match: '/**'
      packages-to-scan: com.xiaominfo.knife4j.demo.web    #这里换成你模块下controller包的路径

# knife4j的增强配置，不需要增强可以不配（建议配置一下）
knife4j:
  enable: true
  setting:
    language: zh_cn</code></pre> 
<p>       <strong> 3.</strong> 在需要的地方添加上注解</p> 
<p>拿最重要的两个注解来说：</p> 
<ul><li> <pre>@Tag(name = "xxx")  加在controller类前，用于将不同controller类分开，xxx换成你想定义为什么名字</pre> </li><li> <pre>@Operation(summary = "xxx")  加在controller中各个方法前，用于定义这个方法的名字</pre> </li></ul> 
<p>实际效果举例：</p> 
<p><img alt="" height="522" src="https://images2.imgbox.com/f0/a6/ROAXLRF9_o.png" width="432"></p> 
<p><img alt="" height="767" src="https://images2.imgbox.com/56/6c/m5Gen4sT_o.png" width="1200"></p> 
<h2 id="%E8%A7%A3%E5%86%B3knife4j%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE">解决knife4j无法访问</h2> 
<p>输入<a href="http://localhost:8710/doc.html" rel="nofollow" title="{ip}:{port}/doc.html">{ip}:{port}/doc.html</a> 但无法访问，显示如下：</p> 
<p><img alt="" height="402" src="https://images2.imgbox.com/02/e4/mUwizwhx_o.png" width="886"></p> 
<p>或者：</p> 
<p><img alt="" height="145" src="https://images2.imgbox.com/0c/1e/g23HrpnS_o.png" width="361"></p> 
<p>idea中有输出，如下：</p> 
<p><img alt="" height="173" src="https://images2.imgbox.com/ec/6a/eFIgh8Vm_o.png" width="1200"></p> 
<p><strong>解决办法：</strong></p> 
<p><strong>第一：检查配置，是否配置了如下内容：</strong></p> 
<pre><code>spring:
  web:
    resources:
      add-mappings: false</code></pre> 
<p>如果有，那么<strong>把这个false改成true</strong>，或者<strong>删掉这个配置</strong>（没有配置的话默认是true）</p> 
<p><strong>第二：检查是否使用了响应（返回）结果封装器</strong></p> 
<p>响应结果封装器，即一个实现了Spring MVC中的<code>HandlerMethodReturnValueHandler的方法</code>，通常用于在方法返回值写入HTTP响应体之前进行预处理。</p> 
<p>我定义了响应结果封装器，并通过自定义注解加在了模块的启动类上，这就导致了所有响应结果都会被这个封装器处理（好处是可以偷懒，不需要每个接口都封装返回结果）。</p> 
<p>而<strong>knife4j，将无法识别封装后的响应结果</strong>，导致knife4j请求文档异常。</p> 
<p><img alt="" height="376" src="https://images2.imgbox.com/bb/bf/luXpR5rS_o.png" width="1043"></p> 
<p>解决办法很简单，就是放弃使用结果封装器<s>（啊这……）</s></p> 
<p>我不知道怎么让封装器对knife4j的结果特判，使返回结果不封装直接返回，因此只能弃用，如果有大佬知道怎么搞可以在评论说一下，提前感谢</p> 
<h2 id="%E4%BB%A5%E4%B8%8B%E6%98%AF%E4%B8%80%E4%BA%9B%E5%85%B3%E4%BA%8E%E6%80%8E%E4%B9%88%E6%89%BE%E5%88%B0%E8%BF%99%E4%B8%AA%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95%E7%9A%84%E7%BB%8F%E9%AA%8C%EF%BC%88%E5%90%90%E6%A7%BD%EF%BC%89%E5%88%86%E4%BA%AB"><span style="color:#0d0016;"><span style="background-color:#ffd900;">以下是一些关于怎么找到这个解决办法（微服务项目debug）的经验</span><s><span style="background-color:#ffd900;">（吐槽）</span></s><span style="background-color:#ffd900;">分享</span></span></h2> 
<p><s><span style="color:#0d0016;">其实本文没什么内容，但我因为这个问题搞了两天，网上没有找到这个解决办法（至少我没找到……），因此特来发此文，希望别人遇到这个问题时能看到这个解决办法</span></s></p> 
<p>因为本人以前搞的项目都是用的springboot2.x，最近弄到一个使用3.2.4的项目，因为用knife4j测试接口非常方便，没想到一搞搞了两天……</p> 
<p>首先因为springboot2.x和3.x之间的巨大差异，原来的依赖以及使用方式都不在适用，本人搜索了几个小时后，才“阴差阳错”的发现了这一点……</p> 
<p>当然解决这一点后仍然有其它问题，/doc.html仍然不能使用，然后我<strong>用git做好备份</strong>，然后疯狂删东西：</p> 
<p>首先，我把微服务中其它模块全部删掉，只保留了一个模块，以方便排除模块间影响</p> 
<p>第二，把模块中所有文件删除，只留了一个极其简单的controller类测试，测试后/doc.html仍然未能访问，因此排除了其它模块的影响（比如网关、过滤器、拦截器等）</p> 
<p>第三，因为模块中除了一个controller类和一个启动类没别的东西了，因此怀疑是pom中的问题，开始删除pom中的依赖</p> 
<p>重点：对pom中的依赖，使用二分删除法，删完后跑一遍，不行换着删。</p> 
<p>几次操作后，发现当我删掉nacos相关的依赖后，/doc.html就变得可以访问了，因此确定是nacos中的配置引起问题。</p> 
<p>对nacos中的配置：再次使用二分删除法，最终确定是关于springmvc的一个配置，删掉它就好了，因此再次确定具体的配置项<s>（又是二分……）</s>  终于发现了问题所在……</p> 
<p><strong>关于<code>spring.web.resources.add-mappings</code> 属性（以下为ai的回答）</strong></p> 
<p><code>spring.web.resources.add-mappings</code> 属性用于控制是否应该添加默认的资源映射。资源映射是指将URL路径映射到静态资源位置，如HTML、CSS、JavaScript文件等。</p> 
<p>默认情况下，Spring Boot会自动配置一些资源映射，以便你可以轻松地访问位于<code>classpath:/META-INF/resources/</code>、<code>classpath:/resources/</code>、<code>classpath:/static/</code>和<code>classpath:/public/</code>等目录下的静态资源。</p> 
<p>当你设置<code>spring.web.resources.add-mappings</code>为<code>false</code>时，Spring Boot将不会添加这些默认的资源映射。这在你想要完全自定义资源映射时很有用，例如，如果你想要改变静态资源的默认位置，或者你想要使用不同的URL路径来访问这些资源。</p> 
<p>简而言之，这个配置用于禁用Spring Boot的默认静态资源映射功能。禁用后，你需要手动配置静态资源的映射，如果你没有提供任何映射，那么你的应用程序将无法直接访问这些静态资源。</p> 
<p>（更新）</p> 
<p><strong><span style="background-color:#ffd900;">然而！问题并没有完全解决！</span></strong></p> 
<p>关于上面的配置，那个确实是要改的，但我改完之后回滚项目，发现还是不行</p> 
<p>生无可恋我的又开始又开始排查，因为之前模块内只留了一个controller，太干净了，因此这次怀疑是模块内的问题。</p> 
<p>这次的debug策略是逐步还原模块内容，每次成功做好版本备份，缩小搜索范围。</p> 
<p><strong><span style="background-color:#ffd900;">以下使用一个名叫TortoiseGit的工具，强烈推荐ㄟ(≧◇≦)ㄏ </span></strong></p> 
<p><s>搜了下已经有教程了，我就不介绍了。有不懂的可以在评论区问</s></p> 
<p>还原顺序：</p> 
<p>        1. 还原实体类，配置类，工具类</p> 
<p>        2. 还原mapper包</p> 
<p>        3. 还原service包</p> 
<p>        4.还原其它包，如listener包等</p> 
<p>        5.还原controller包</p> 
<p><img alt="" height="131" src="https://images2.imgbox.com/af/0b/jkrZHrDR_o.png" width="551"></p> 
<p><strong>关于怎么还原部分代码：</strong>选择之前备份的版本，在下面找到需要的代码，shift多选后右键，选“还原到此版本”</p> 
<p><img alt="" height="507" src="https://images2.imgbox.com/67/81/GSpsVkWL_o.png" width="841"></p> 
<p>在将上面所有包还原且没有发现问题后，那么就只剩下启动类了</p> 
<p>关于启动类，使用工具进行找bug会比较方便，我这里将原来的代码和现在的代码进行比对，找bug非常方便（左边的是原来版本，右边是现在版本，会动态更新）</p> 
<p><span style="background-color:#38d8f0;">右键需要比对的文件，点“与工作副本比较”</span></p> 
<p><img alt="" height="403" src="https://images2.imgbox.com/86/f2/xg7hTFpV_o.png" width="355"></p> 
<p><img alt="" height="762" src="https://images2.imgbox.com/08/e8/K61NAIjl_o.png" width="1200"></p> 
<p>通过不断还原部分代码，发现问题在一个名叫EnableDefaultResponseAdvice的注解，按住ctrl点进去看，最终看到了项目中的全局默认封装器。</p> 
<p><img alt="" height="492" src="https://images2.imgbox.com/0d/24/qceMVlrI_o.png" width="906"></p> 
<p>事已至此，情况就比较清晰了，尝试性的将 return RestResult.ok(body); 改为 return body; 后，问题解决。</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ff15affbff7f6390d04af67259076cbf/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Java】java学生管理系统（增删查改）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e2aa6e531cdc4f974b97aad408670883/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">three.js实现3d地图，包含散点，地图背景图片（vue）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>