<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SQL Server命令大全 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/94b52c302ce43278594107876a951178/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="SQL Server命令大全">
  <meta property="og:description" content="文章目录 1. 数据库管理2. 表操作3. 查询数据4. 连接查询5. 存储过程与函数6. 视图7. 索引8. 其他常用命令9. 用户与权限管理10. 数据备份与恢复11. 系统函数与信息查询12. 其他高级特性13. 分区表14. 高级查询操作15. 复制与同步16. 异步处理与作业调度17. 查询执行计划18. 引用外部数据19. 动态SQL20. 自增序列与标识符21. 数据类型转换22. CASE表达式和IIF函数23. 数据库快照 SQL Server 中包含了大量的命令用于数据库的管理、查询和操作。以下是一些主要命令分类及其简要示例： 1. 数据库管理 创建数据库 CREATE DATABASE MyDatabase; 删除数据库 DROP DATABASE MyDatabase; 选择/切换当前数据库 USE MyDatabase; 2. 表操作 创建表 CREATE TABLE Employees ( EmployeeID int PRIMARY KEY, FirstName nvarchar(50), LastName nvarchar(50), HireDate datetime ); 插入数据 INSERT INTO Employees (EmployeeID, FirstName, LastName, HireDate) VALUES (1, &#39;John&#39;, &#39;Doe&#39;, &#39;2023-01-01&#39;); 更新数据 UPDATE Employees SET FirstName = &#39;Jane&#39; WHERE EmployeeID = 1; 删除数据 DELETE FROM Employees WHERE EmployeeID = 1; 修改表结构 ALTER TABLE Employees ADD DepartmentID int FOREIGN KEY REFERENCES Departments(DepartmentID); 3.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-18T10:01:03+08:00">
    <meta property="article:modified_time" content="2024-01-18T10:01:03+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SQL Server命令大全</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><ul><li><a href="#1__3" rel="nofollow">1. 数据库管理</a></li><li><a href="#2__19" rel="nofollow">2. 表操作</a></li><li><a href="#3__55" rel="nofollow">3. 查询数据</a></li><li><a href="#4__83" rel="nofollow">4. 连接查询</a></li><li><a href="#5__91" rel="nofollow">5. 存储过程与函数</a></li><li><a href="#6__120" rel="nofollow">6. 视图</a></li><li><a href="#7__132" rel="nofollow">7. 索引</a></li><li><a href="#8__143" rel="nofollow">8. 其他常用命令</a></li><li><a href="#9__157" rel="nofollow">9. 用户与权限管理</a></li><li><a href="#10__182" rel="nofollow">10. 数据备份与恢复</a></li><li><a href="#11__211" rel="nofollow">11. 系统函数与信息查询</a></li><li><a href="#12__227" rel="nofollow">12. 其他高级特性</a></li><li><a href="#13__248" rel="nofollow">13. 分区表</a></li><li><a href="#14__276" rel="nofollow">14. 高级查询操作</a></li><li><a href="#15__295" rel="nofollow">15. 复制与同步</a></li><li><a href="#16__299" rel="nofollow">16. 异步处理与作业调度</a></li><li><a href="#17__332" rel="nofollow">17. 查询执行计划</a></li><li><a href="#18__345" rel="nofollow">18. 引用外部数据</a></li><li><a href="#19_SQL_362" rel="nofollow">19. 动态SQL</a></li><li><a href="#20__370" rel="nofollow">20. 自增序列与标识符</a></li><li><a href="#21__381" rel="nofollow">21. 数据类型转换</a></li><li><a href="#22_CASEIIF_387" rel="nofollow">22. CASE表达式和IIF函数</a></li><li><a href="#23__404" rel="nofollow">23. 数据库快照</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<br> SQL Server 中包含了大量的命令用于数据库的管理、查询和操作。以下是一些主要命令分类及其简要示例： 
<p></p> 
<h4><a id="1__3"></a>1. 数据库管理</h4> 
<ul><li><strong>创建数据库</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> MyDatabase<span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>删除数据库</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> MyDatabase<span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>选择/切换当前数据库</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">USE</span> MyDatabase<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="2__19"></a>2. 表操作</h4> 
<ul><li><strong>创建表</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Employees <span class="token punctuation">(</span>
    EmployeeID <span class="token keyword">int</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    FirstName nvarchar<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    LastName nvarchar<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    HireDate <span class="token keyword">datetime</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>插入数据</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Employees <span class="token punctuation">(</span>EmployeeID<span class="token punctuation">,</span> FirstName<span class="token punctuation">,</span> LastName<span class="token punctuation">,</span> HireDate<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token string">'Doe'</span><span class="token punctuation">,</span> <span class="token string">'2023-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>更新数据</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">UPDATE</span> Employees
<span class="token keyword">SET</span> FirstName <span class="token operator">=</span> <span class="token string">'Jane'</span>
<span class="token keyword">WHERE</span> EmployeeID <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>删除数据</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> Employees
<span class="token keyword">WHERE</span> EmployeeID <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>修改表结构</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> Employees
<span class="token keyword">ADD</span> DepartmentID <span class="token keyword">int</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token keyword">REFERENCES</span> Departments<span class="token punctuation">(</span>DepartmentID<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="3__55"></a>3. 查询数据</h4> 
<ul><li><strong>基本查询</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Employees<span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>条件查询</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Employees <span class="token keyword">WHERE</span> DepartmentID <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>排序查询</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Employees <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> HireDate <span class="token keyword">DESC</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>聚合函数查询</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> Employees<span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>分组查询</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> DepartmentID<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> CountOfEmployees
<span class="token keyword">FROM</span> Employees
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> DepartmentID<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="4__83"></a>4. 连接查询</h4> 
<ul><li><strong>内连接</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> E<span class="token punctuation">.</span>FirstName<span class="token punctuation">,</span> D<span class="token punctuation">.</span>DepartmentName 
<span class="token keyword">FROM</span> Employees E
<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> Departments D <span class="token keyword">ON</span> E<span class="token punctuation">.</span>DepartmentID <span class="token operator">=</span> D<span class="token punctuation">.</span>DepartmentID<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="5__91"></a>5. 存储过程与函数</h4> 
<ul><li><strong>创建存储过程</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> GetEmployeesByDepartment <span class="token variable">@deptId</span> <span class="token keyword">INT</span>
<span class="token keyword">AS</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Employees <span class="token keyword">WHERE</span> DepartmentID <span class="token operator">=</span> <span class="token variable">@deptId</span><span class="token punctuation">;</span>
<span class="token keyword">END</span>
</code></pre> 
<ul><li><strong>调用存储过程</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">EXEC</span> GetEmployeesByDepartment <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>创建用户定义函数</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> dbo<span class="token punctuation">.</span>GetTotalEmployees<span class="token punctuation">(</span><span class="token variable">@deptId</span> <span class="token keyword">INT</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">INT</span>
<span class="token keyword">AS</span>
<span class="token keyword">BEGIN</span>
    <span class="token keyword">RETURN</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> Employees <span class="token keyword">WHERE</span> DepartmentID <span class="token operator">=</span> <span class="token variable">@deptId</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span>
</code></pre> 
<ul><li><strong>使用函数</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> dbo<span class="token punctuation">.</span>GetTotalEmployees<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> TotalEmpInDept2<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="6__120"></a>6. 视图</h4> 
<ul><li><strong>创建视图</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> EmployeeNames <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> FirstName<span class="token punctuation">,</span> LastName <span class="token keyword">FROM</span> Employees<span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>查询视图</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> EmployeeNames<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="7__132"></a>7. 索引</h4> 
<ul><li><strong>创建索引</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> IX_Employees_DepartmentID <span class="token keyword">ON</span> Employees <span class="token punctuation">(</span>DepartmentID<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>删除索引</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> IX_Employees_DepartmentID <span class="token keyword">ON</span> Employees<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="8__143"></a>8. 其他常用命令</h4> 
<ul><li><strong>事务控制</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">BEGIN</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
<span class="token comment">-- 执行一系列操作...</span>
<span class="token keyword">COMMIT</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>备份还原</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">BACKUP</span> <span class="token keyword">DATABASE</span> MyDatabase <span class="token keyword">TO</span> <span class="token keyword">DISK</span> <span class="token operator">=</span> <span class="token string">'C:\backup\MyDatabase.bak'</span><span class="token punctuation">;</span>
<span class="token keyword">RESTORE</span> <span class="token keyword">DATABASE</span> MyDatabase <span class="token keyword">FROM</span> <span class="token keyword">DISK</span> <span class="token operator">=</span> <span class="token string">'C:\backup\MyDatabase.bak'</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="9__157"></a>9. 用户与权限管理</h4> 
<ul><li><strong>创建登录账户</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> LOGIN NewUser <span class="token keyword">WITH</span> PASSWORD <span class="token operator">=</span> <span class="token string">'StrongPassword!'</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>创建数据库用户并映射到登录名</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> UserForDB <span class="token keyword">FOR</span> LOGIN NewUser<span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> ROLE db_datareader <span class="token keyword">ADD</span> MEMBER UserForDB<span class="token punctuation">;</span> <span class="token comment">-- 给予读权限</span>
<span class="token keyword">ALTER</span> ROLE db_datawriter <span class="token keyword">ADD</span> MEMBER UserForDB<span class="token punctuation">;</span> <span class="token comment">-- 给予写权限</span>
</code></pre> 
<ul><li><strong>撤销用户对数据库的访问</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">USER</span> UserForDB<span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>授予、拒绝或撤销权限</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> Employees <span class="token keyword">TO</span> UserForDB<span class="token punctuation">;</span>
<span class="token keyword">DENY</span> <span class="token keyword">UPDATE</span> <span class="token keyword">ON</span> Employees <span class="token keyword">TO</span> UserForDB<span class="token punctuation">;</span>
<span class="token keyword">REVOKE</span> <span class="token keyword">DELETE</span> <span class="token keyword">ON</span> Employees <span class="token keyword">FROM</span> UserForDB<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="10__182"></a>10. 数据备份与恢复</h4> 
<ul><li><strong>完整数据库备份</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">BACKUP</span> <span class="token keyword">DATABASE</span> MyDatabase
<span class="token keyword">TO</span> <span class="token keyword">DISK</span> <span class="token operator">=</span> <span class="token string">'C:\Backup\MyDatabase.bak'</span>
<span class="token keyword">WITH</span> FORMAT<span class="token punctuation">,</span> MEDIANAME <span class="token operator">=</span> <span class="token string">'MyDatabase_Full'</span><span class="token punctuation">,</span> NAME <span class="token operator">=</span> <span class="token string">'Full Backup'</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>差异备份</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">BACKUP</span> <span class="token keyword">DATABASE</span> MyDatabase
<span class="token keyword">TO</span> <span class="token keyword">DISK</span> <span class="token operator">=</span> <span class="token string">'C:\Backup\MyDatabase_diff.bak'</span>
<span class="token keyword">WITH</span> DIFFERENTIAL<span class="token punctuation">,</span> FORMAT<span class="token punctuation">,</span> MEDIANAME <span class="token operator">=</span> <span class="token string">'MyDatabase_Diff'</span><span class="token punctuation">,</span> NAME <span class="token operator">=</span> <span class="token string">'Differential Backup'</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>事务日志备份</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">BACKUP</span> LOG MyDatabase
<span class="token keyword">TO</span> <span class="token keyword">DISK</span> <span class="token operator">=</span> <span class="token string">'C:\Backup\MyDatabase_log.trn'</span>
<span class="token keyword">WITH</span> NOFORMAT<span class="token punctuation">,</span> NOINIT<span class="token punctuation">,</span> NAME <span class="token operator">=</span> N<span class="token string">'MyDatabase_LogBackup'</span><span class="token punctuation">,</span> SKIP<span class="token punctuation">,</span> NOREWIND<span class="token punctuation">,</span> NOUNLOAD<span class="token punctuation">,</span> STATS <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>还原数据库</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">RESTORE</span> <span class="token keyword">DATABASE</span> MyDatabase
<span class="token keyword">FROM</span> <span class="token keyword">DISK</span> <span class="token operator">=</span> <span class="token string">'C:\Backup\MyDatabase.bak'</span>
<span class="token keyword">WITH</span> <span class="token keyword">FILE</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> NOUNLOAD<span class="token punctuation">,</span> <span class="token keyword">REPLACE</span><span class="token punctuation">,</span> STATS <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="11__211"></a>11. 系统函数与信息查询</h4> 
<ul><li><strong>查询当前数据库版本</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> @<span class="token variable">@VERSION</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>查询表结构信息</strong></li></ul> 
<pre><code class="prism language-sql">sp_help <span class="token string">'Employees'</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>获取当前时间</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> CurrentDateTime<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="12__227"></a>12. 其他高级特性</h4> 
<ul><li><strong>窗口函数</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 
    EmployeeID<span class="token punctuation">,</span> 
    FirstName<span class="token punctuation">,</span> 
    Salary<span class="token punctuation">,</span>
    <span class="token function">AVG</span><span class="token punctuation">(</span>Salary<span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> DepartmentID<span class="token punctuation">)</span> <span class="token keyword">AS</span> AvgSalaryInDept
<span class="token keyword">FROM</span> Employees<span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>CTE（公用表表达式）</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">WITH</span> EmpSalaries <span class="token keyword">AS</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> EmployeeID<span class="token punctuation">,</span> Salary
    <span class="token keyword">FROM</span> Employees
<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> EmpSalaries <span class="token keyword">WHERE</span> Salary <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>Salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> EmpSalaries<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="13__248"></a>13. 分区表</h4> 
<ul><li><strong>创建分区函数</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">PARTITION</span> <span class="token keyword">FUNCTION</span> pf_EmployeesRange <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>
<span class="token keyword">AS</span> RANGE <span class="token keyword">RIGHT</span> <span class="token keyword">FOR</span> <span class="token keyword">VALUES</span> 
<span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">2005</span><span class="token punctuation">,</span> <span class="token number">2010</span><span class="token punctuation">,</span> <span class="token number">2015</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>创建分区方案</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">PARTITION</span> SCHEME ps_Employees 
<span class="token keyword">AS</span> <span class="token keyword">PARTITION</span> pf_EmployeesRange 
<span class="token keyword">TO</span> <span class="token punctuation">(</span>
    <span class="token punctuation">[</span>PrimaryFileGroup<span class="token punctuation">]</span><span class="token punctuation">,</span> 
    <span class="token punctuation">[</span>SecondaryFileGroup1<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>SecondaryFileGroup2<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>SecondaryFileGroup3<span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>创建分区表</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> PartitionedEmployees <span class="token punctuation">(</span>
    EmployeeID <span class="token keyword">int</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    HireDate <span class="token keyword">int</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span>
<span class="token punctuation">)</span> <span class="token keyword">ON</span> ps_Employees<span class="token punctuation">(</span>HireDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="14__276"></a>14. 高级查询操作</h4> 
<ul><li><strong>联合查询（UNION、UNION ALL）</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> FirstName<span class="token punctuation">,</span> LastName <span class="token keyword">FROM</span> Employees <span class="token keyword">WHERE</span> DepartmentID <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">UNION</span> <span class="token keyword">ALL</span>
<span class="token keyword">SELECT</span> FirstName<span class="token punctuation">,</span> LastName <span class="token keyword">FROM</span> Employees <span class="token keyword">WHERE</span> DepartmentID <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>INTERSECT和EXCEPT操作</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> EmployeeID <span class="token keyword">FROM</span> Employees <span class="token keyword">WHERE</span> DepartmentID <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">INTERSECT</span>
<span class="token keyword">SELECT</span> EmployeeID <span class="token keyword">FROM</span> Employees <span class="token keyword">WHERE</span> DepartmentID <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> EmployeeID <span class="token keyword">FROM</span> Employees <span class="token keyword">WHERE</span> DepartmentID <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">EXCEPT</span>
<span class="token keyword">SELECT</span> EmployeeID <span class="token keyword">FROM</span> Employees <span class="token keyword">WHERE</span> DepartmentID <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="15__295"></a>15. 复制与同步</h4> 
<ul><li><strong>使用SQL Server Replication进行数据复制</strong><br> 这涉及到一系列复杂的配置步骤，包括发布设置、订阅设置、代理设置等。</li></ul> 
<h4><a id="16__299"></a>16. 异步处理与作业调度</h4> 
<ul><li><strong>创建SQL Server Agent作业</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">USE</span> msdb<span class="token punctuation">;</span>
GO
<span class="token keyword">EXEC</span> sp_add_job <span class="token variable">@job_name</span><span class="token operator">=</span>N<span class="token string">'MyBackupJob'</span><span class="token punctuation">,</span> 
                <span class="token variable">@enabled</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> 
                <span class="token variable">@description</span><span class="token operator">=</span><span class="token string">'Daily backup job'</span><span class="token punctuation">;</span>
GO

<span class="token comment">-- 添加作业步骤</span>
<span class="token keyword">EXEC</span> sp_add_jobstep <span class="token variable">@job_name</span><span class="token operator">=</span>N<span class="token string">'MyBackupJob'</span><span class="token punctuation">,</span> 
                   <span class="token variable">@step_name</span><span class="token operator">=</span>N<span class="token string">'Backup Database'</span><span class="token punctuation">,</span>
                   <span class="token variable">@subsystem</span><span class="token operator">=</span>N<span class="token string">'TSQL'</span><span class="token punctuation">,</span> 
                   <span class="token variable">@command</span><span class="token operator">=</span>N<span class="token string">'BACKUP DATABASE MyDatabase TO DISK = ''C:\Backup\MyDatabase.bak'';'</span><span class="token punctuation">,</span>
                   <span class="token variable">@retry_attempts</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> 
                   <span class="token variable">@retry_interval</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
GO

<span class="token comment">-- 启用作业调度</span>
<span class="token keyword">EXEC</span> dbo<span class="token punctuation">.</span>sp_add_schedule
    <span class="token variable">@schedule_name</span> <span class="token operator">=</span> N<span class="token string">'DailyAtMidnight'</span><span class="token punctuation">,</span>
    <span class="token variable">@freq_type</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">-- 每日</span>
    <span class="token variable">@freq_interval</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">-- 每天运行一次</span>
    <span class="token variable">@active_start_time</span> <span class="token operator">=</span> <span class="token number">000000</span><span class="token punctuation">;</span> <span class="token comment">-- 在午夜开始</span>

<span class="token comment">-- 将作业与调度关联</span>
<span class="token keyword">EXEC</span> sp_attach_schedule
    <span class="token variable">@job_name</span> <span class="token operator">=</span> N<span class="token string">'MyBackupJob'</span><span class="token punctuation">,</span> 
    <span class="token variable">@schedule_name</span> <span class="token operator">=</span> N<span class="token string">'DailyAtMidnight'</span><span class="token punctuation">;</span>
GO
</code></pre> 
<h4><a id="17__332"></a>17. 查询执行计划</h4> 
<ul><li><strong>查看查询执行计划</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token comment">-- 在查询语句前添加EXPLAIN 或者 SET SHOWPLAN_ALL ON</span>
<span class="token keyword">SET</span> SHOWPLAN_ALL <span class="token keyword">ON</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Employees <span class="token keyword">WHERE</span> DepartmentID <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> SHOWPLAN_ALL <span class="token keyword">OFF</span><span class="token punctuation">;</span>

<span class="token comment">-- 或使用图形化方式查看</span>
<span class="token comment">-- 在SQL Server Management Studio中，运行查询后右键选择"包括实际执行计划"</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Employees <span class="token keyword">WHERE</span> DepartmentID <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="18__345"></a>18. 引用外部数据</h4> 
<ul><li><strong>OPENROWSET函数读取文件</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> <span class="token keyword">OPENROWSET</span><span class="token punctuation">(</span><span class="token string">'Microsoft.ACE.OLEDB.12.0'</span><span class="token punctuation">,</span> <span class="token string">'Text;Database=C:\Data;HDR=YES;FMT=Delimited'</span><span class="token punctuation">,</span> <span class="token string">'SELECT * FROM [Employees.txt]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>链接服务器</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建链接服务器</span>
<span class="token keyword">EXEC</span> sp_addlinkedserver <span class="token variable">@server</span> <span class="token operator">=</span> N<span class="token string">'MyLinkedServer'</span><span class="token punctuation">,</span> <span class="token variable">@srvproduct</span><span class="token operator">=</span>N<span class="token string">'OtherDB'</span><span class="token punctuation">,</span> <span class="token variable">@provider</span><span class="token operator">=</span>N<span class="token string">'SQLNCLI'</span><span class="token punctuation">,</span> <span class="token variable">@datasrc</span><span class="token operator">=</span>N<span class="token string">'ServerName\InstanceName'</span><span class="token punctuation">;</span>

<span class="token comment">-- 使用链接服务器查询数据</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> 
<span class="token keyword">FROM</span> MyLinkedServer<span class="token punctuation">.</span>RemoteDB<span class="token punctuation">.</span>dbo<span class="token punctuation">.</span>Employees<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="19_SQL_362"></a>19. 动态SQL</h4> 
<ul><li><strong>构建并执行动态SQL语句</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">DECLARE</span> <span class="token variable">@DepartmentID</span> <span class="token keyword">INT</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">DECLARE</span> <span class="token variable">@SQL</span> NVARCHAR<span class="token punctuation">(</span>MAX<span class="token punctuation">)</span> <span class="token operator">=</span> N<span class="token string">'SELECT * FROM Employees WHERE DepartmentID = '</span> <span class="token operator">+</span> CAST<span class="token punctuation">(</span><span class="token variable">@DepartmentID</span> <span class="token keyword">AS</span> NVARCHAR<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">EXEC</span> sp_executesql <span class="token variable">@SQL</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="20__370"></a>20. 自增序列与标识符</h4> 
<ul><li><strong>创建带有自增列的表</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> Orders <span class="token punctuation">(</span>
    OrderID <span class="token keyword">INT</span> <span class="token keyword">IDENTITY</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    CustomerID <span class="token keyword">INT</span><span class="token punctuation">,</span>
    OrderDate <span class="token keyword">DATE</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>OrderID<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="21__381"></a>21. 数据类型转换</h4> 
<ul><li><strong>显式转换</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> CAST<span class="token punctuation">(</span><span class="token string">'1234'</span> <span class="token keyword">AS</span> <span class="token keyword">INT</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">CONVERT</span><span class="token punctuation">(</span><span class="token keyword">INT</span><span class="token punctuation">,</span> <span class="token string">'1234'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="22_CASEIIF_387"></a>22. CASE表达式和IIF函数</h4> 
<ul><li><strong>CASE表达式</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> EmployeeID<span class="token punctuation">,</span> FirstName<span class="token punctuation">,</span> LastName<span class="token punctuation">,</span>
    <span class="token keyword">CASE</span> <span class="token keyword">WHEN</span> Salary <span class="token operator">&gt;</span> <span class="token number">50000</span> <span class="token keyword">THEN</span> <span class="token string">'High'</span>
         <span class="token keyword">WHEN</span> Salary <span class="token operator">&gt;</span> <span class="token number">30000</span> <span class="token keyword">THEN</span> <span class="token string">'Medium'</span>
         <span class="token keyword">ELSE</span> <span class="token string">'Low'</span>
    <span class="token keyword">END</span> <span class="token keyword">AS</span> SalaryLevel
<span class="token keyword">FROM</span> Employees<span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>IIF函数（SQL Server 2012及以上版本）</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> EmployeeID<span class="token punctuation">,</span> FirstName<span class="token punctuation">,</span> LastName<span class="token punctuation">,</span>
    IIF<span class="token punctuation">(</span>Salary <span class="token operator">&gt;</span> <span class="token number">50000</span><span class="token punctuation">,</span> <span class="token string">'High'</span><span class="token punctuation">,</span> IIF<span class="token punctuation">(</span>Salary <span class="token operator">&gt;</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token string">'Medium'</span><span class="token punctuation">,</span> <span class="token string">'Low'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> SalaryLevel
<span class="token keyword">FROM</span> Employees<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="23__404"></a>23. 数据库快照</h4> 
<ul><li><strong>创建数据库快照</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> MyDatabase_snapshot <span class="token keyword">ON</span> 
    <span class="token punctuation">(</span>NAME <span class="token operator">=</span> MyDatabase<span class="token punctuation">,</span> FILENAME <span class="token operator">=</span> <span class="token string">'C:\Snapshots\MyDatabase_snapshot.ss'</span><span class="token punctuation">)</span>
<span class="token keyword">AS</span> <span class="token keyword">SNAPSHOT</span> <span class="token keyword">OF</span> MyDatabase<span class="token punctuation">;</span>
</code></pre> 
<ul><li><strong>从快照恢复数据</strong></li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">RESTORE</span> <span class="token keyword">DATABASE</span> MyDatabase <span class="token keyword">FROM</span> DATABASE_SNAPSHOT <span class="token operator">=</span> <span class="token string">'MyDatabase_snapshot'</span><span class="token punctuation">;</span>
</code></pre> 
<p>python推荐学习汇总连接：<br> <a href="https://blog.csdn.net/qqrrjj2011/article/details/135201319">50个开发必备的Python经典脚本(1-10)</a></p> 
<p><a href="https://blog.csdn.net/qqrrjj2011/article/details/135220796">50个开发必备的Python经典脚本(11-20)</a></p> 
<p><a href="https://blog.csdn.net/qqrrjj2011/article/details/135220906">50个开发必备的Python经典脚本(21-30)</a></p> 
<p><a href="https://blog.csdn.net/qqrrjj2011/article/details/135222295">50个开发必备的Python经典脚本(31-40)</a></p> 
<p><a href="https://blog.csdn.net/qqrrjj2011/article/details/135222681">50个开发必备的Python经典脚本(41-50)</a><br> ————————————————</p> 
<p><strong>​最后我们放松一下眼睛</strong><br> <img src="https://images2.imgbox.com/82/a6/xLQwfBvL_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2fe554a8968c1b259470bb3ee4094a1c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">golang面试题大全</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/22a015449e855023497a90c5959f5946/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MySQL java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax 关键字异常处理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>