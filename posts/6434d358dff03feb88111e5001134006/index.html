<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android使用MQTT - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/6434d358dff03feb88111e5001134006/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Android使用MQTT">
  <meta property="og:description" content="目录
MQTT
MQTT通信流程
第三方MQTT服务
使用步骤
使用注意事项
使用MQTT问题
前言
本文是一个学习过程记录。
MQTT MQTT（Message Queuing Telemetry Transport）是一种轻量级的、基于发布/订阅模式的消息传输协议，常用于物联网（IoT）应用中。
MQTT协议中有三种身份：发布者（Publish）、代理（Broker）（服务器）、订阅者（Subscribe）。其中，消息的发布者和订阅者都是客户端，消息代理是服务器，消息发布者可以同时是订阅者。
MQTT传输的消息分为：主题（Topic）和载荷（payload）两部分：
Topic（主题）：消息的类型，订阅者订阅（Subscribe）后，就会收到该主题的消息内容（payload）；它是消息的标识符，用于指定消息的类型或者位置。主题是一个由层级结构组成的字符串，使用斜杠（/）作为分隔符。例如，home/bedroom/temperature 是一个主题，用于表示卧室的温度数据。在MQTT中，发布者发布消息到特定的主题，而订阅者通过订阅主题来接收相关消息。Payload（载荷）：是实际的消息内容。它可以是任何类型的数据，例如文本、JSON、二进制数据等。发布者将消息发送到特定的主题时，将携带一个载荷，订阅者接收到消息后，可以从载荷中提取所需的数据。 当应用数据通过MQTT网络发送时，MQTT会把与之相关的服务质量（QoS）和主题名（Topic）相关连。
QoS（服务质量）：QoS定义了消息传递的可靠性级别。MQTT支持三个QoS级别：
QoS 0（最多一次）：消息尽最多一次传递。消息不会进行确认，也不会重传。适用于实时性要求不高的数据，可能会丢失消息。QoS 1（至少一次）：消息至少传递一次，确保消息至少被接收一次。如果消息未收到确认，会进行重传。适用于需要确保消息不丢失，但可以重复传输的情况。QoS 2（仅一次）：消息只传递一次，确保消息仅被接收一次。会进行两阶段确认，确保消息的准确传递。适用于要求非常高的数据完整性的情况。 使用MQTT参考SDK，一步一步操作来也可以完成，EMQX SDK使用指南：Android 使用 Kotlin 连接 MQTT | EMQ
这篇文章讲的非常清楚：
Android使用MQTT订阅及发布消息（（一）初步了解Mqtt以及实现Android操作mqtt服务）_android mqtt-CSDN博客 ​​​​​​
MQTT通信流程 Publisher发布消息到Broker。Broker接收消息并根据主题将消息路由给相应的Subscriber。Subscriber接收到消息并处理。 第三方MQTT服务 使用EMQX，15天免费，网站：EMQXEMQX SDK使用指南：Android 使用 Kotlin 连接 MQTT | EMQ这里使用 专有版，如果使用 serverless，进行测试连接会报错 Unregister alarmreceiver to 使用步骤 引入依赖先连接订阅发布取消订阅取消连接 使用注意事项 在连接的时候，千万别忘记tcp://，否则会连接失败。
val serverURI = &#34;tcp://b601afc1.ala.dedicated.aliyun.emqxcloud.cn:1883&#34; 使用只需要创建一个【客户端认证】，当作连接账号和密码。其他一概不用操作
使用MQTT问题 这个播客已经解决：Android——Failed resolution of: Landroid/support/v4/content/LocalBroadcastManager-CSDN博客
问题1、java.lang.NoClassDefFoundError: Failed resolution of:Landroid/support/v4/content/LocalBroadcastManager;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-16T08:57:54+08:00">
    <meta property="article:modified_time" content="2024-04-16T08:57:54+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android使用MQTT</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="MQTT-toc" style="margin-left:0px;"><a href="#MQTT" rel="nofollow">MQTT</a></p> 
<p id="MQTT%E9%80%9A%E4%BF%A1%E6%B5%81%E7%A8%8B-toc" style="margin-left:40px;"><a href="#MQTT%E9%80%9A%E4%BF%A1%E6%B5%81%E7%A8%8B" rel="nofollow">MQTT通信流程</a></p> 
<p id="%E7%AC%AC%E4%B8%89%E6%96%B9MQTT%E6%9C%8D%E5%8A%A1-toc" style="margin-left:40px;"><a href="#%E7%AC%AC%E4%B8%89%E6%96%B9MQTT%E6%9C%8D%E5%8A%A1" rel="nofollow">第三方MQTT服务</a></p> 
<p id="%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4-toc" style="margin-left:40px;"><a href="#%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4" rel="nofollow">使用步骤</a></p> 
<p id="%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-toc" style="margin-left:40px;"><a href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" rel="nofollow">使用注意事项</a></p> 
<p id="%E4%BD%BF%E7%94%A8MQTT%E9%97%AE%E9%A2%98-toc" style="margin-left:40px;"><a href="#%E4%BD%BF%E7%94%A8MQTT%E9%97%AE%E9%A2%98" rel="nofollow">使用MQTT问题</a></p> 
<hr id="hr-toc"> 
<p><span style="color:#0d0016;">前言</span></p> 
<p><span style="color:#0d0016;">        本文是一个学习过程记录。</span></p> 
<h2 id="MQTT"><span style="color:#0d0016;">MQTT</span></h2> 
<p><span style="color:#0d0016;">        MQTT（Message Queuing Telemetry Transport）是一种轻量级的、基于发布/订阅模式的消息传输协议，常用于物联网（IoT）应用中。</span></p> 
<p><span style="color:#0d0016;">        MQTT协议中有三种身份：发布者（Publish）、代理（Broker）（服务器）、订阅者（Subscribe）。其中，消息的发布者和订阅者都是客户端，消息代理是服务器，消息发布者可以同时是订阅者。<br> MQTT传输的消息分为：<strong>主题</strong>（Topic）和<strong>载荷</strong>（payload）两部分：</span></p> 
<ul><li><span style="color:#0d0016;"><strong>Topic（主题）</strong>：<strong>消息的类型</strong>，订阅者订阅（Subscribe）后，就会收到该主题的消息内容（payload）；</span>它是消息的标识符，用于指定消息的类型或者位置。主题是一个由层级结构组成的字符串，使用斜杠（<code>/</code>）作为分隔符。例如，<code>home/bedroom/temperature</code> 是一个主题，用于表示卧室的温度数据。在MQTT中，发布者发布消息到特定的主题，而订阅者通过订阅主题来接收相关消息。</li><li><strong>Payload（载荷）</strong>：<strong>是实际的消息内容</strong>。它可以是任何类型的数据，例如文本、JSON、二进制数据等。发布者将消息发送到特定的主题时，将携带一个载荷，订阅者接收到消息后，可以从载荷中提取所需的数据。</li></ul> 
<p><span style="color:#0d0016;">        当应用数据通过MQTT网络发送时，MQTT会把与之相关的服务质量（QoS）和主题名（Topic）相关连。</span></p> 
<p><span style="color:#0d0016;">QoS（服务质量）：QoS定义了消息传递的可靠性级别。MQTT支持三个QoS级别：</span></p> 
<ul><li><span style="color:#0d0016;">QoS 0（最多一次）：消息尽最多一次传递。消息不会进行确认，也不会重传。适用于实时性要求不高的数据，可能会丢失消息。</span></li><li><span style="color:#0d0016;">QoS 1（至少一次）：消息至少传递一次，确保消息至少被接收一次。如果消息未收到确认，会进行重传。适用于需要确保消息不丢失，但可以重复传输的情况。</span></li><li><span style="color:#0d0016;">QoS 2（仅一次）：消息只传递一次，确保消息仅被接收一次。会进行两阶段确认，确保消息的准确传递。适用于要求非常高的数据完整性的情况。</span></li></ul> 
<p></p> 
<p><span style="color:#0d0016;">使用MQTT参考SDK，一步一步操作来也可以完成，</span>EMQX SDK使用指南：<a href="https://www.emqx.com/zh/blog/android-connects-mqtt-using-kotlin" rel="nofollow" title="Android 使用 Kotlin 连接 MQTT | EMQ">Android 使用 Kotlin 连接 MQTT | EMQ</a></p> 
<p><span style="color:#0d0016;">这篇文章讲的非常清楚：</span></p> 
<p><a href="https://blog.csdn.net/Tobey_r1/article/details/125163100?spm=1001.2014.3001.5501" title="Android使用MQTT订阅及发布消息（（一）初步了解Mqtt以及实现Android操作mqtt服务）_android mqtt-CSDN博客 ​​​​​​">Android使用MQTT订阅及发布消息（（一）初步了解Mqtt以及实现Android操作mqtt服务）_android mqtt-CSDN博客 ​​​​​​</a></p> 
<h3></h3> 
<h3 id="MQTT%E9%80%9A%E4%BF%A1%E6%B5%81%E7%A8%8B"><span style="color:#0d0016;">MQTT通信流程</span></h3> 
<ol><li><span style="color:#0d0016;"><strong>Publisher</strong>发布消息到<strong>Broker</strong>。</span></li><li><span style="color:#0d0016;"><strong>Broker</strong>接收消息并根据主题将消息路由给相应的<strong>Subscriber</strong>。</span></li><li><span style="color:#0d0016;"><strong>Subscriber</strong>接收到消息并处理。</span></li></ol> 
<h3 id="%E7%AC%AC%E4%B8%89%E6%96%B9MQTT%E6%9C%8D%E5%8A%A1"><span style="color:#0d0016;">第三方MQTT服务</span></h3> 
<ol><li><span style="color:#0d0016;">使用EMQX，15天免费，网站：</span><a href="https://cloud.emqx.com/console/deployments" rel="nofollow" title="EMQX">EMQX</a></li><li>EMQX SDK使用指南：<a href="https://www.emqx.com/zh/blog/android-connects-mqtt-using-kotlin" rel="nofollow" title="Android 使用 Kotlin 连接 MQTT | EMQ">Android 使用 Kotlin 连接 MQTT | EMQ</a></li><li>这里使用 <strong>专有版，如果使用 serverless，进行测试连接会报错 </strong><strong>Unregister alarmreceiver to</strong><img alt="" height="916" src="https://images2.imgbox.com/15/92/lG2604io_o.png" width="1200"></li></ol> 
<h3 id="%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span style="color:#0d0016;">使用步骤</span></h3> 
<ol><li><span style="color:#0d0016;">引入依赖</span></li><li><span style="color:#0d0016;">先连接</span></li><li><span style="color:#0d0016;">订阅</span></li><li>发布</li><li>取消订阅</li><li>取消连接</li></ol> 
<h3 id="%E4%BD%BF%E7%94%A8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span style="color:#0d0016;">使用注意事项</span></h3> 
<p><span style="color:#0d0016;">        在连接的时候，千万别忘记tcp://，否则会连接失败。</span></p> 
<pre><code class="language-java">val serverURI = "tcp://b601afc1.ala.dedicated.aliyun.emqxcloud.cn:1883"</code></pre> 
<p>        使用只需要创建一个【客户端认证】，当作连接账号和密码。其他一概不用操作</p> 
<p><img alt="" height="578" src="https://images2.imgbox.com/b0/77/kgmoM3r0_o.png" width="1200"></p> 
<h3 id="%E4%BD%BF%E7%94%A8MQTT%E9%97%AE%E9%A2%98"><span style="color:#0d0016;">使用MQTT问题</span></h3> 
<p><a href="https://blog.csdn.net/weixin_51080921/article/details/124418529" title="这个播客已经解决：Android——Failed resolution of: Landroid/support/v4/content/LocalBroadcastManager-CSDN博客">这个播客已经解决：Android——Failed resolution of: Landroid/support/v4/content/LocalBroadcastManager-CSDN博客</a></p> 
<p><span style="color:#0d0016;">问题1、java.lang.NoClassDefFoundError: Failed resolution</span><span style="color:#0d0016;"> of:Landroid/support/v4/content/LocalBroadcastManager;</span></p> 
<pre><code class="language-java">FATAL EXCEPTION: main
Process: com.dfg.mqtt, PID: 5049
java.lang.NoClassDefFoundError: Failed resolution of: Landroid/support/v4/content/LocalBroadcastManager;
at org.eclipse.paho.android.service.MqttAndroidClient.registerReceiver(MqttAndroidClient.java:450)
at org.eclipse.paho.android.service.MqttAndroidClient.connect(MqttAndroidClient.java:428)
at com.dfg.mqtt.MainActivity.connect(MainActivity.kt:74)
at com.dfg.mqtt.MainActivity.onCreate$lambda$0(MainActivity.kt:29)
at com.dfg.mqtt.MainActivity.$r8$lambda$lscMx1wR-Gmz1hZBIc0L-o8IfBI(Unknown Source:0)
at com.dfg.mqtt.MainActivity$$ExternalSyntheticLambda0.onClick(Unknown Source:2)
at android.view.View.performClick(View.java:6599)
at com.google.android.material.button.MaterialButton.performClick(MaterialButton.java:1202)
at android.view.View.performClickInternal(View.java:6576)
at android.view.View.access$3100(View.java:780)
at android.view.View$PerformClick.run(View.java:25899)
at android.os.Handler.handleCallback(Handler.java:873)
at android.os.Handler.dispatchMessage(Handler.java:99)
at android.os.Looper.loop(Looper.java:193)
at android.app.ActivityThread.main(ActivityThread.java:6819)
at java.lang.reflect.Method.invoke(Native Method)
at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:493)
at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:860)
Caused by: java.lang.ClassNotFoundException: Didn't find class "android.support.v4.content.LocalBroadcastManager" on path: DexPathList[[zip file "/data/app/com.dfg.mqtt-J_20_A6NK3ulIe2yTD8PeA==/base.apk"],nativeLibraryDirectories=[/data/app/com.dfg.mqtt-J_20_A6NK3ulIe2yTD8PeA==/lib/x86_64, /system/lib64, /system/vendor/lib64]]
at dalvik.system.BaseDexClassLoader.findClass(BaseDexClassLoader.java:134)
at java.lang.ClassLoader.loadClass(ClassLoader.java:379)
at java.lang.ClassLoader.loadClass(ClassLoader.java:312)</code></pre> 
<p>解决：</p> 
<p>1、往build.gradle引入</p> 
<pre><code class="language-java">implementation "com.android.support:support-v4:30.4.1"</code></pre> 
<p>2、gradle.properties加入</p> 
<pre><code class="language-java">android.enableJetifier=true</code></pre> 
<p>3、Sync编译问题解决</p> 
<p></p> 
<p>我写的功能：<a href="https://github.com/Fugui-Dai/MQTT.git" title="GitHub - Fugui-Dai/MQTT">GitHub - Fugui-Dai/MQTT</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/213028a5cc4084f8ad9ab70a1a204087/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【C&#43;&#43;】explicit关键字详解（explicit关键字是什么? 为什么需要explicit关键字? 如何使用explicit 关键字）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0a6b69a03f8645e3e75548fef2f144d4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解决python调用matplotlib绘制图像只弹出空白无响应窗</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>