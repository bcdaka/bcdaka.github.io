<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C&#43;&#43;和Python混合编程之Pybind11的简单使用 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/8121f6b33ad4cf4ce8e98fd0e7d1ffc0/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="C&#43;&#43;和Python混合编程之Pybind11的简单使用">
  <meta property="og:description" content="C&#43;&#43;和Python混合编程之Pybind11的简单使用 一、简介 Pybind11是C&#43;&#43;/Python混合编程的利器之一，是一个轻量级的只包含头文件的库，用于 Python 和 C&#43;&#43; 之间接口转换，可以为现有的 C&#43;&#43; 代码创建 Python 接口绑定。Pybind11 名字里的“11”表示它完全基于现代 C&#43;&#43; 开发（C&#43;&#43;11 以上），所以没有兼容旧系统的负担。它使用了大量的现代 C&#43;&#43; 特性，不仅代码干净整齐，运行效率也更高。
二、平台环境 1、系统：Windows10
2、Python虚拟环境工具：Anaconda3
3、C&#43;&#43; IDE：Visual Studio 2022
4、Python版本：3.7.16
三、C&#43;&#43;/Python相互调用的方法 简单介绍如何实现两种语言之间相互调用
1、Python调用C&#43;&#43;代码： 通过调用动态库的方式完成，将C&#43;&#43;代码编译生成动态库文件(Win下为.DLL)，Python调用的话需要将库后缀改为（.pyd），然后将动态库拷贝到Python文件主目录，代码内导入库模块即可；
2、C&#43;&#43;代码调用Python： 主要通过调用Python代码解释器来实现。
四、代码实践 用代码实例简单展现Pybind11的功能
1、基础环境搭建 1.1、安装Pybind11库 有多种安装方式，这里通过pip命令来安装，如果使用了虚拟环境，安装前记得激活相应的虚拟环境：
安装命令如下：
(py37) C:\Users\xxx&gt; pip install pybind11 1.2、Visual Studio项目属性配置： 具体路径根据自己项目实际情况而定
1). 通用编译属性设置：
属性–&gt;常规–&gt;常规属性–&gt;配置类型：动态库(.dll)；属性–&gt;高级–&gt;高级属性–&gt;目标文件扩展名：.pyd； 2). C/C&#43;&#43;附加包含目录include：
属性–&gt;C/C&#43;&#43; --&gt;常规–&gt;附加包含目录：D:\Anaconda3\envs\py37\includeD:\Anaconda3\envs\py37\Lib\site-packages\pybind11\include 3). 链接器附加库目录和库文件：
属性–&gt;链接器–&gt;常规–&gt;附加库目录：D:\Anaconda3\envs\py37\libs属性–&gt;链接器–&gt;输入–&gt;附加依赖项：python3.lib，python37.lib 具体操作如下：
1.3、系统环境变量设置 1）、因为在C&#43;&#43;调用Python代码过程中遇到错误，经过查资料找到了解决办法（stackoverflow讨论地址），以下环境具体路径根据自己项目实际情况而定。
2）、要在C&#43;&#43;中调用Python解释器（py::scoped_interpreter guard{};），需要添加两个系统环境变量，以便Pybind11能够找到解释器位置：
PYTHONHOME：D:\Anaconda3\envs\py37PYTHONPATH：D:\Anaconda3\envs\py37\Lib;D:\Anaconda3\envs\py37\Lib\site-packages;D:\Anaconda3\envs\py37\DLLs 3）、如果不设置这两个环境变量会出现以下错误：
Fatal Python error: init_fs_encoding: failed to get the Python codec of the filesystem encoding">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-15T21:30:00+08:00">
    <meta property="article:modified_time" content="2024-04-15T21:30:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C&#43;&#43;和Python混合编程之Pybind11的简单使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="CPythonPybind11_0"></a>C++和Python混合编程之Pybind11的简单使用</h2> 
<h3><a id="_2"></a>一、简介</h3> 
<blockquote> 
 <p><em><strong>Pybind11</strong></em>是C++/Python混合编程的利器之一，是一个轻量级的只包含头文件的库，用于 Python 和 C++ 之间接口转换，可以为现有的 C++ 代码创建 Python 接口绑定。Pybind11 名字里的“11”表示它完全基于现代 C++ 开发（<strong>C++11</strong> 以上），所以没有兼容旧系统的负担。它使用了大量的现代 C++ 特性，不仅代码干净整齐，运行效率也更高。</p> 
</blockquote> 
<hr> 
<h3><a id="_6"></a>二、平台环境</h3> 
<blockquote> 
 <p>1、系统：Windows10<br> 2、Python虚拟环境工具：Anaconda3<br> 3、C++ IDE：Visual Studio 2022<br> 4、Python版本：3.7.16</p> 
</blockquote> 
<hr> 
<h3><a id="CPython_13"></a>三、C++/Python相互调用的方法</h3> 
<blockquote> 
 <p>简单介绍如何实现两种语言之间相互调用</p> 
</blockquote> 
<p><strong>1、Python调用C++代码：</strong> 通过调用动态库的方式完成，将C++代码编译生成动态库文件(Win下为.DLL)，Python调用的话需要将库后缀改为（<strong>.pyd</strong>），然后将动态库拷贝到Python文件主目录，代码内导入库模块即可；</p> 
<p><strong>2、C++代码调用Python：</strong> 主要通过调用Python代码解释器来实现。</p> 
<hr> 
<h3><a id="_21"></a>四、代码实践</h3> 
<blockquote> 
 <p>用代码实例简单展现Pybind11的功能</p> 
</blockquote> 
<h4><a id="1_24"></a>1、基础环境搭建</h4> 
<h5><a id="11Pybind11_25"></a>1.1、安装Pybind11库</h5> 
<blockquote> 
 <p>有多种安装方式，这里通过<em><strong>pip</strong></em>命令来安装，如果使用了虚拟环境，安装前记得激活相应的虚拟环境：</p> 
</blockquote> 
<p><em><strong>安装命令如下：</strong></em></p> 
<pre><code class="prism language-bash"><span class="token punctuation">(</span>py37<span class="token punctuation">)</span> C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>xxx<span class="token operator">&gt;</span> pip <span class="token function">install</span> pybind11
</code></pre> 
<hr> 
<h5><a id="12Visual_Studio_34"></a>1.2、Visual Studio项目属性配置：</h5> 
<blockquote> 
 <p><strong>具体路径根据自己项目实际情况而定</strong><br> <strong>1). 通用编译属性设置：</strong></p> 
 <ul><li>属性–&gt;常规–&gt;常规属性–&gt;配置类型：<strong>动态库(.dll)</strong>；</li><li>属性–&gt;高级–&gt;高级属性–&gt;目标文件扩展名：<strong>.pyd</strong>；</li></ul> 
 <p><strong>2). C/C++附加包含目录include：</strong></p> 
 <ul><li>属性–&gt;C/C++ --&gt;常规–&gt;附加包含目录：</li><li>D:\Anaconda3\envs\py37\include</li><li>D:\Anaconda3\envs\py37\Lib\site-packages\pybind11\include</li></ul> 
 <p><strong>3). 链接器附加库目录和库文件：</strong></p> 
 <ul><li>属性–&gt;链接器–&gt;常规–&gt;附加库目录：D:\Anaconda3\envs\py37\libs</li><li>属性–&gt;链接器–&gt;输入–&gt;附加依赖项：python3.lib，python37.lib</li></ul> 
</blockquote> 
<p><em><strong>具体操作如下：</strong></em><br> <img src="https://images2.imgbox.com/19/d2/6HEZql2p_o.png" alt="配置类型"><br> <img src="https://images2.imgbox.com/a2/4a/0WbVJbVc_o.png" alt="目标文件扩展名"><br> <img src="https://images2.imgbox.com/e6/23/Gd2EvjFR_o.png" alt="附加包含目录"></p> 
<p><img src="https://images2.imgbox.com/fb/27/Rm3jXTnj_o.png" alt="附加库目录"><br> <img src="https://images2.imgbox.com/ac/07/Ra3pYr7q_o.png" alt="附加依赖项"></p> 
<hr> 
<h5><a id="13_58"></a>1.3、系统环境变量设置</h5> 
<blockquote> 
 <p><strong>1）、因为在C++调用Python代码过程中遇到错误，经过查资料找到了解决办法（<a href="https://stackoverflow.com/questions/58075887/pybind11-python-embed-on-windows-10-fatal-python-error-initfsencoding-unable" rel="nofollow">stackoverflow讨论地址</a>），以下环境具体路径根据自己项目实际情况而定。</strong><br> <strong>2）、要在C++中调用Python解释器（py::scoped_interpreter guard{};），需要添加两个系统环境变量，以便Pybind11能够找到解释器位置：</strong></p> 
 <ul><li>PYTHONHOME：D:\Anaconda3\envs\py37</li><li>PYTHONPATH：D:\Anaconda3\envs\py37\Lib;D:\Anaconda3\envs\py37\Lib\site-packages;D:\Anaconda3\envs\py37\DLLs</li></ul> 
 <p><strong>3）、如果不设置这两个环境变量会出现以下错误：</strong></p> 
 <ul><li>Fatal Python error: init_fs_encoding: failed to get the Python codec of the filesystem encoding<br> Python runtime state: core initialized<br> ModuleNotFoundError: No module named ‘encodings’</li></ul> 
 <p><strong>4）、设置完后重启电脑生效</strong></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/66/dd/HilKzbfg_o.png" alt="错位描述"><br> 从打印的错误可以看出[PYTHONHOME，PYTHONPATH]两个系统环境变量未设置。</p> 
<p><em><strong>设置系统变量：</strong></em><br> <img src="https://images2.imgbox.com/17/9b/iqoGNPhn_o.png" alt="PYTHONHOME"><br> <img src="https://images2.imgbox.com/38/4f/jc0N0C49_o.png" alt="PYTHONPATH"><br> <em><strong>注意：</strong></em> 增加这两个环境变量后可能导致Anaconda3虚拟环境命令找不到，进而无法激活虚拟环境，如果出现则删除这两个环境变量即可（暂时没找到好的解决办法），删除后重启电脑。</p> 
<hr> 
<h4><a id="2PythonC_80"></a>2、Python使用C++代码动态库</h4> 
<blockquote> 
 <p><strong>演示两个流程：</strong></p> 
 <ul><li>C++编译动态库；</li><li>Python代码中调用动态库。</li></ul> 
</blockquote> 
<h5><a id="21C_85"></a>2.1、C++编译动态库</h5> 
<blockquote> 
 <p>演示C++编译动态库以供Python调用</p> 
</blockquote> 
<p><em><strong>代码示例：</strong></em></p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;tuple&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;map&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pybind11/pybind11.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pybind11/stl.h&gt;</span>  <span class="token comment">// 转换标准容器必须的头文件</span></span>

<span class="token keyword">namespace</span> py <span class="token operator">=</span> pybind11<span class="token punctuation">;</span>  <span class="token comment">// 名字空间别名，简化代码</span>

<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token keyword">final</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
	<span class="token operator">~</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">default</span><span class="token punctuation">;</span>
	<span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">x</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">int</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> x<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		x <span class="token operator">=</span> a<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 用lambda表达式来测试</span>
<span class="token function">PYBIND11_MODULE</span><span class="token punctuation">(</span>pydemo<span class="token punctuation">,</span> m<span class="token punctuation">)</span>  <span class="token comment">// 定义Python模块pydemo</span>
<span class="token punctuation">{<!-- --></span>
	m<span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"pybind11 demo doc"</span><span class="token punctuation">;</span>
	
	m<span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span><span class="token string">"info"</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			py<span class="token double-colon punctuation">::</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"c++ version: "</span><span class="token punctuation">,</span> __cplusplus<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	m<span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span><span class="token string">"add"</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	m<span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span><span class="token string">"use_str"</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> str<span class="token punctuation">)</span>  <span class="token comment">// 定义python函数，入参是string</span>
		<span class="token punctuation">{<!-- --></span>
			py<span class="token double-colon punctuation">::</span><span class="token function">print</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> str <span class="token operator">+</span> <span class="token string">"!!"</span><span class="token punctuation">;</span>  <span class="token comment">// 返回string</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	m<span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span><span class="token string">"use_tuple"</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>tuple<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span> x<span class="token punctuation">)</span>  <span class="token comment">// 定义python函数，入参是tuple</span>
		<span class="token punctuation">{<!-- --></span>
			std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">;</span>
			std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">;</span>
			std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+=</span> <span class="token string">"??"</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> x<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	m<span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span><span class="token string">"use_list"</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> v<span class="token punctuation">)</span>  <span class="token comment">// 定义python函数，入参是vector</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">auto</span> vv <span class="token operator">=</span> v<span class="token punctuation">;</span>
			py<span class="token double-colon punctuation">::</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"input :"</span><span class="token punctuation">,</span> vv<span class="token punctuation">)</span><span class="token punctuation">;</span>
			vv<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			vv<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> vv<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	m<span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span><span class="token string">"use_map"</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>map<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span><span class="token operator">&amp;</span> m<span class="token punctuation">)</span>  <span class="token comment">// 定义python函数，入参是map</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">auto</span> mm <span class="token operator">=</span> m<span class="token punctuation">;</span>
			py<span class="token double-colon punctuation">::</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"input : "</span><span class="token punctuation">,</span> mm<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mm<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"LiMing"</span><span class="token punctuation">;</span>
			mm<span class="token punctuation">[</span><span class="token string">"gender"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"male"</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> mm<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// C++ 里的类也能够等价地转换到 Python 里面调用，这要用到一个特别的模板类 class_</span>
	py<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">class_</span><span class="token generic class-name"><span class="token operator">&lt;</span>Point<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token string">"Point"</span><span class="token punctuation">)</span>  <span class="token comment">// 定义Python类</span>
		<span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span>py<span class="token double-colon punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>           <span class="token comment">// 导出构造函数</span>
		<span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span>py<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">init</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment">// 导出构造函数</span>
		<span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span><span class="token string">"get"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>Point<span class="token double-colon punctuation">::</span>get<span class="token punctuation">)</span>   <span class="token comment">// 导出成员函数</span>
		<span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span><span class="token string">"set"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>Point<span class="token double-colon punctuation">::</span>set<span class="token punctuation">)</span>   <span class="token comment">// 导出成员函数</span>
		<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token number">0</span></span></span>

<span class="token comment">// 用普通函数来测试</span>
<span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"c++ version: "</span> <span class="token operator">&lt;&lt;</span> __cplusplus <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">PYBIND11_MODULE</span><span class="token punctuation">(</span>pydemo<span class="token punctuation">,</span> m<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	m<span class="token punctuation">.</span><span class="token function">doc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"pybind11 demodoc"</span><span class="token punctuation">;</span>

	m<span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span><span class="token string">"info"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>info<span class="token punctuation">,</span> <span class="token string">"cpp info"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	m<span class="token punctuation">.</span><span class="token function">def</span><span class="token punctuation">(</span><span class="token string">"add"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>add<span class="token punctuation">,</span> <span class="token string">"add func"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token number">0</span></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> 
<p><em><strong>编译输出结果如下：</strong></em></p> 
<pre><code class="prism language-bash">生成开始于 <span class="token number">13</span>:12<span class="token punctuation">..</span>.
<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>------ 已启动生成: 项目: PythonAndCPP, 配置: Release x64 ------
<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>main.cpp
<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>  正在创建库 F:<span class="token punctuation">\</span>code<span class="token punctuation">\</span>CPPdemo<span class="token punctuation">\</span>PythonAndCPP<span class="token punctuation">\</span>x64<span class="token punctuation">\</span>Release<span class="token punctuation">\</span>PythonAndCPP.lib 和对象 F:<span class="token punctuation">\</span>code<span class="token punctuation">\</span>CPPdemo<span class="token punctuation">\</span>PythonAndCPP<span class="token punctuation">\</span>x64<span class="token punctuation">\</span>Release<span class="token punctuation">\</span>PythonAndCPP.exp
<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>正在生成代码
<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span><span class="token number">441</span> of <span class="token number">3091</span> functions <span class="token punctuation">(</span><span class="token number">14.3</span>%<span class="token punctuation">)</span> were compiled, the rest were copied from previous compilation.
<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>  <span class="token number">186</span> functions were new <span class="token keyword">in</span> current compilation
<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>  <span class="token number">391</span> functions had inline decision re-evaluated but remain unchanged
<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>已完成代码的生成
<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>PythonAndCPP.vcxproj -<span class="token operator">&gt;</span> F:<span class="token punctuation">\</span>code<span class="token punctuation">\</span>CPPdemo<span class="token punctuation">\</span>PythonAndCPP<span class="token punctuation">\</span>x64<span class="token punctuation">\</span>Release<span class="token punctuation">\</span>PythonAndCPP.pyd
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> 生成: <span class="token number">1</span> 成功，0 失败，0 最新，0 已跳过 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span> 生成 于 <span class="token number">13</span>:12 完成，耗时 03.362 秒 <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7b/d5/jhVHSEyH_o.png" alt="结果"></p> 
<hr> 
<h5><a id="22Python_239"></a>2.2、在Python中调用动态库</h5> 
<blockquote> 
 <p>首先需要将动态库拷贝到Python项目主目录下，然后才能在python代码中导入模块使用</p> 
</blockquote> 
<p><em><strong>首先需要将动态库拷贝到Python项目主目录下，如下图所示：</strong></em><br> <img src="https://images2.imgbox.com/2b/8f/Ebn0oR9K_o.png" alt="python项目"><br> <em><strong>代码示例：</strong></em></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pydemo  <span class="token comment"># 导入模块，与C++代码中定义的模块名一致</span>

<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    pydemo<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
	
	<span class="token operator">//</span> 调用add函数
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Test add func: "</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>pydemo<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	
	<span class="token operator">//</span> 调用Point类极其成员函数
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Test Point class: "</span><span class="token punctuation">)</span>
    p <span class="token operator">=</span> pydemo<span class="token punctuation">.</span>Point<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token number">88</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	
	<span class="token operator">//</span> 字符串转换测试：std<span class="token punctuation">:</span><span class="token punctuation">:</span>string<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token builtin">str</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Test str: "</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>pydemo<span class="token punctuation">.</span>use_str<span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	
	<span class="token operator">//</span> 元组转换测试：std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token builtin">tuple</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token builtin">tuple</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Test tuple: "</span><span class="token punctuation">)</span>
    t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">22</span><span class="token punctuation">,</span><span class="token string">"No"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>pydemo<span class="token punctuation">.</span>use_tuple<span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span>
	
	<span class="token operator">//</span> 列表转换测试：std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token builtin">list</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Test list: "</span><span class="token punctuation">)</span>
    l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>pydemo<span class="token punctuation">.</span>use_list<span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span>
	
	<span class="token operator">//</span> 键值对转换测试：std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token builtin">map</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token builtin">map</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Test map: "</span><span class="token punctuation">)</span>
    m <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>pydemo<span class="token punctuation">.</span>use_map<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">)</span>
    

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    test<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span><span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
</code></pre> 
<p><em><strong>运行结果如下：</strong></em></p> 
<pre><code class="prism language-bash"><span class="token punctuation">(</span>py37<span class="token punctuation">)</span> F:<span class="token punctuation">\</span>code<span class="token punctuation">\</span>pydemo<span class="token punctuation">\</span>Test<span class="token operator">&gt;</span>python main.py
c++ version:  <span class="token number">199711</span>
Test <span class="token function">add</span> func: 
<span class="token number">3</span>
Test Point class:
<span class="token number">10</span>
<span class="token number">88</span>
Test str:
hello
hello<span class="token operator">!</span><span class="token operator">!</span>
Test tuple:
<span class="token punctuation">(</span><span class="token number">12</span>, <span class="token number">23</span>, <span class="token string">'No??'</span><span class="token punctuation">)</span>
Test list:
input <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">100</span>, <span class="token number">200</span><span class="token punctuation">]</span>
Test map:
input <span class="token builtin class-name">:</span>  <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span><span class="token string">'gender'</span><span class="token builtin class-name">:</span> <span class="token string">'male'</span>, <span class="token string">'name'</span><span class="token builtin class-name">:</span> <span class="token string">'LiMing'</span><span class="token punctuation">}</span>
</code></pre> 
<hr> 
<h4><a id="3CPython_315"></a>3、C++调用Python解释器</h4> 
<blockquote> 
 <p><strong>用两种方式演示如何在C++代码中调用Python代码解释器：</strong></p> 
 <ul><li>直接运行python代码</li><li>导入python外部模块执行代码，更灵活</li></ul> 
 <p><strong>注意细节：</strong></p> 
 <ul><li>需要将python代码文件拷贝至C++项目主目录下；</li><li>将所用python版本的python3.dll，python37.dll两个动态库拷贝至C++可执行文件（.exe）所在目录，否则可能无法运行或运行出错。</li></ul> 
</blockquote> 
<h5><a id="31__324"></a>3.1 拷贝代码运行所需文件</h5> 
<p><strong>1）、拷贝python代码文件</strong><br> <img src="https://images2.imgbox.com/69/65/qgC4VT14_o.png" alt="拷贝python文件"><br> <strong>2）、拷贝DLL文件</strong><br> <img src="https://images2.imgbox.com/f3/57/U0rr4tBw_o.png" alt="拷贝动态库"></p> 
<hr> 
<h5><a id="32_331"></a>3.2、代码演示</h5> 
<p><em><strong>代码示例：</strong></em><br> python代码文件：pydemo.py<br> python代码：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token punctuation">,</span> AnyStr



<span class="token keyword">def</span> <span class="token function">get_files</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span>AnyStr<span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    遍历目录下所有文件并返回结果
    :param path: 目录
    :return: 返回文件列表
    """</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token comment"># 递归遍历文件夹下的所有文件</span>
    files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>dirpath<span class="token punctuation">,</span> dirnames<span class="token punctuation">,</span> filenames<span class="token punctuation">)</span> <span class="token keyword">in</span> os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        files <span class="token operator">+=</span> filenames
    <span class="token keyword">return</span> files



<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre> 
<p>CPP代码：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pybind11/pybind11.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pybind11/stl.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pybind11/embed.h&gt;</span>  <span class="token comment">// 要用解释器需要包含此头文件</span></span>

<span class="token keyword">namespace</span> py <span class="token operator">=</span> pybind11<span class="token punctuation">;</span>  <span class="token comment">// 名字空间别名，简化代码</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token number">1</span></span></span>

<span class="token keyword">void</span> <span class="token function">test_pybind11</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	py<span class="token double-colon punctuation">::</span>scoped_interpreter guard<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// 初始化Python解释器</span>

	<span class="token comment">// 1、直接运行python代码</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"1、测试直接运行python代码："</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	<span class="token keyword">try</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 使用原始字符串R"()"</span>
		py<span class="token double-colon punctuation">::</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token raw-string string">R"(
def pow(a,n):
	return a**n)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">auto</span> func <span class="token operator">=</span> py<span class="token double-colon punctuation">::</span><span class="token keyword">module</span><span class="token double-colon punctuation">::</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"__main__"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"pow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">auto</span> res <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-function"><span class="token function">cast</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"pow(2,3)函数输出结果如下："</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> res <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>exception<span class="token operator">&amp;</span> e<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> e<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	
	<span class="token comment">// 2、导入python模块执行代码(pydemo.py)，此种方法更灵活</span>
	std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"2、测试导入python模块执行外部代码："</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	<span class="token keyword">try</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">auto</span> <span class="token keyword">module</span> <span class="token operator">=</span> py<span class="token double-colon punctuation">::</span><span class="token keyword">module</span><span class="token double-colon punctuation">::</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"pydemo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 导入python外部模块pydemo，python中一个.py文件就是一个模块</span>
		<span class="token keyword">auto</span> res <span class="token operator">=</span> <span class="token keyword">module</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">"get_files"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\xxx\\Pictures\\wallpaper"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"遍历文件如下: "</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">auto</span><span class="token operator">&amp;</span> val <span class="token operator">:</span> res<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> val <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>exception<span class="token operator">&amp;</span> e<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> e<span class="token punctuation">.</span><span class="token function">what</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token number">1</span></span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">test_pybind11</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> 
<p><em><strong>运行结果如下：</strong></em></p> 
<pre><code class="prism language-bash"><span class="token number">1</span>、测试直接运行python代码：
pow<span class="token punctuation">(</span><span class="token number">2,3</span><span class="token punctuation">)</span>函数输出结果如下：
<span class="token number">8</span>

<span class="token number">2</span>、测试导入python模块执行外部代码：
遍历文件如下:
img_1.png
img_10.jpg
img_11.jpg
img_12.jpg
img_13.png
img_14.jpg

F:<span class="token punctuation">\</span>code<span class="token punctuation">\</span>CPPdemo<span class="token punctuation">\</span>PythonAndCPP<span class="token punctuation">\</span>x64<span class="token punctuation">\</span>Release<span class="token punctuation">\</span>PythonAndCPP.pyd <span class="token punctuation">(</span>进程 <span class="token number">17896</span><span class="token punctuation">)</span>已退出，代码为 <span class="token number">0</span>。
按任意键关闭此窗口. <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span>
</code></pre> 
<hr> 
<h3><a id="_451"></a>五、结语</h3> 
<p>本文简单阐述了用Pybind11实现C++/Python混合编程的流程和注意事项，仅使用了Pybind11的一些简单功能，Pybind11功能很强大，需要其它更多功能请自行查询<a href="https://pybind11.readthedocs.io/en/stable/index.html" rel="nofollow">Pybind11官方文档</a>。</p> 
<p>【<strong>参考文章</strong>】：</p> 
<ul><li><a href="https://time.geekbang.org/column/intro/100051801?tab=catalog" rel="nofollow">极客时间专栏-罗剑锋的 C++ 实战笔记之混合系统章节</a></li><li><a href="https://zhuanlan.zhihu.com/p/383572973" rel="nofollow">Python/C++混合编程利器Pybind11实践</a></li><li><a href="https://pybind11.readthedocs.io/en/stable/index.html" rel="nofollow">Pybind11官方文档</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3bedf3bd41388172b81ae2e09b9de46d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">通过AI写作赚钱方法分享</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f81f2aca637b126fbd96af8cbc3dbfac/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vue集成PageOffice实现在线编辑word、excel(前端配置)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>