<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>TimescaleDB 开源时序数据库 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/577159e078dafd6c5161c2d5d9b1e941/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="TimescaleDB 开源时序数据库">
  <meta property="og:description" content="文章目录 1.TimescaleDB介绍2.Hypertable 和 chunk3.Hypertable4.Hypertable操作 开源中间件 # TimescaleDB https://iothub.org.cn/docs/middleware/ https://iothub.org.cn/docs/middleware/timescale/timescale-summary/ 1.TimescaleDB介绍 TimescaleDB是基于PostgreSQL数据库打造的一款时序数据库，插件化的形式，随着PostgreSQL的版本升级而升级。
TimescaleDB具备以下特点
基于时序优化自动分片（按时间、空间自动分片(chunk)）全SQL接口支持垂直于横向扩展支持时间维度、空间维度自动分区。空间维度指属性字段（例如传感器ID，用户ID等）支持多个SERVER，多个CHUNK的并行查询。分区在TimescaleDB中被称为chunk自动调整CHUNK的大小内部写优化（批量提交、内存索引、事务支持、数据倒灌）
内存索引，因为chunk size比较适中，所以索引基本上都不会被交换出去，写性能比较好
数据倒灌，因为有些传感器的数据可能写入延迟，导致需要写以前的chunk，timescaleDB允许这样的事情发生(可配置)复杂查询优化（根据查询条件自动选择chunk，最近值获取优化(最小化的扫描,类似递归收敛)，limit子句pushdown到不同的server,chunks，并行的聚合操作）
《时序数据合并场景加速分析和实现 - 复合索引，窗口分组查询加速，变态递归加速》利用已有的PostgreSQL特性（支持GIS，JOIN等），方便的管理（流复制、PITR）支持自动的按时间保留策略（自动删除过旧数据） # 官网地址 https://www.timescale.com/ # 文档 https://docs.timescale.com/latest/main # 安装 https://docs.timescale.com/latest/getting-started/installation/rhel-centos/installation-yum # github https://github.com/timescale/timescaledb # docker https://hub.docker.com/r/timescale/timescaledb 2.Hypertable 和 chunk TimescaleDB作为PostgreSQL的扩展实现，这意味着Timescale数据库在整个PostgreSQL实例中运行。 该扩展模型允许数据库利用PostgreSQL的许多属性，如可靠性，安全性以及与各种第三方工具的连接性。 同时，TimescaleDB通过在PostgreSQL的查询规划器，数据模型和执行引擎中添加钩子，充分利用扩展可用的高度自定义。
从用户的角度来看，TimescaleDB公开了一些看起来像单数表的称为hypertable的表，它们实际上是一个抽象或许多单独表的虚拟视图，这些表包含称为块的数据。
通过将hypertable的数据划分为一个或多个维度来创建块：所有可编程元素按时间间隔进行分区，并且可以通过诸如设备ID，位置，用户ID等的关键字进行分区。我们有时将此称为分区 横跨“时间和空间”。
Hypertable 与数据交互的主要点是一个可以抽象化的跨越所有空间和时间间隔的单个连续表，从而可以通过标准SQL查询它。
实际上，所有与TimescaleDB的用户交互都是使用可调整的。 创建表格和索引，修改表格，插入数据，选择数据等都可以（也应该）在hypertable上执行。
在TimescaleDB中创建一个超表需要两个简单的SQL命令：创建表（使用标准SQL语法），然后选择CLEATEYHYTABLE（）。
chunk 在内部，TimescaleDB自动将每个可分区块分割成块，每个块对应于特定的时间间隔和分区键空间的一个区域（使用散列）。 这些分区是不相交的（非重叠的），这有助于查询计划人员最小化它必须接触以解决查询的组块集合。
每个块都使用标准数据库表来实现。 （在PostgreSQL内部，这个块实际上是一个“父”可变的“子表”。）
块是正确的大小，确保表的索引的所有B树可以在插入期间驻留在内存中。 这可以避免在修改这些树中的任意位置时发生颠簸。
SELECT show_chunks(&#39;conditions&#39;); SELECT show_chunks(&#39;conditions&#39;, older_than =&gt; INTERVAL &#39;3 months&#39;); SELECT show_chunks(&#39;conditions&#39;, older_than =&gt; DATE &#39;2017-01-01&#39;); 3.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-10T09:56:55+08:00">
    <meta property="article:modified_time" content="2024-03-10T09:56:55+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">TimescaleDB 开源时序数据库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><ul><li><a href="#1TimescaleDB_15" rel="nofollow">1.TimescaleDB介绍</a></li><li><a href="#2Hypertable__chunk_57" rel="nofollow">2.Hypertable 和 chunk</a></li><li><a href="#3Hypertable_89" rel="nofollow">3.Hypertable</a></li><li><a href="#4Hypertable_118" rel="nofollow">4.Hypertable操作</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<ul><li><a href="https://iothub.org.cn/docs/middleware/" rel="nofollow"><strong>开源中间件</strong></a></li></ul> 
<pre><code class="prism language-shell"><span class="token comment"># TimescaleDB</span>

https://iothub.org.cn/docs/middleware/
https://iothub.org.cn/docs/middleware/timescale/timescale-summary/
</code></pre> 
<h4><a id="1TimescaleDB_15"></a>1.TimescaleDB介绍</h4> 
<p>TimescaleDB是基于PostgreSQL数据库打造的一款时序数据库，插件化的形式，随着PostgreSQL的版本升级而升级。</p> 
<p><strong>TimescaleDB具备以下特点</strong></p> 
<ol><li>基于时序优化</li><li>自动分片（按时间、空间自动分片(chunk)）</li><li>全SQL接口</li><li>支持垂直于横向扩展</li><li>支持时间维度、空间维度自动分区。空间维度指属性字段（例如传感器ID，用户ID等）</li><li>支持多个SERVER，多个CHUNK的并行查询。分区在TimescaleDB中被称为chunk</li><li>自动调整CHUNK的大小</li><li>内部写优化（批量提交、内存索引、事务支持、数据倒灌）<br> 内存索引，因为chunk size比较适中，所以索引基本上都不会被交换出去，写性能比较好<br> 数据倒灌，因为有些传感器的数据可能写入延迟，导致需要写以前的chunk，timescaleDB允许这样的事情发生(可配置)</li><li>复杂查询优化（根据查询条件自动选择chunk，最近值获取优化(最小化的扫描,类似递归收敛)，limit子句pushdown到不同的server,chunks，并行的聚合操作）<br> 《时序数据合并场景加速分析和实现 - 复合索引，窗口分组查询加速，变态递归加速》</li><li>利用已有的PostgreSQL特性（支持GIS，JOIN等），方便的管理（流复制、PITR）</li><li>支持自动的按时间保留策略（自动删除过旧数据）</li></ol> 
<pre><code class="prism language-shell"><span class="token comment"># 官网地址</span>
https://www.timescale.com/
 
<span class="token comment"># 文档</span>
https://docs.timescale.com/latest/main
 
<span class="token comment"># 安装</span>
https://docs.timescale.com/latest/getting-started/installation/rhel-centos/installation-yum 
 
<span class="token comment"># github</span>
https://github.com/timescale/timescaledb 
 
<span class="token comment"># docker</span>
https://hub.docker.com/r/timescale/timescaledb
</code></pre> 
<h4><a id="2Hypertable__chunk_57"></a>2.Hypertable 和 chunk</h4> 
<p>TimescaleDB作为PostgreSQL的扩展实现，这意味着Timescale数据库在整个PostgreSQL实例中运行。 该扩展模型允许数据库利用PostgreSQL的许多属性，如可靠性，安全性以及与各种第三方工具的连接性。 同时，TimescaleDB通过在PostgreSQL的查询规划器，数据模型和执行引擎中添加钩子，充分利用扩展可用的高度自定义。<br> 从用户的角度来看，TimescaleDB公开了一些看起来像单数表的称为hypertable的表，它们实际上是一个抽象或许多单独表的虚拟视图，这些表包含称为块的数据。</p> 
<p>通过将hypertable的数据划分为一个或多个维度来创建块：所有可编程元素按时间间隔进行分区，并且可以通过诸如设备ID，位置，用户ID等的关键字进行分区。我们有时将此称为分区 横跨“时间和空间”。</p> 
<ul><li><strong>Hypertable</strong></li></ul> 
<p>与数据交互的主要点是一个可以抽象化的跨越所有空间和时间间隔的单个连续表，从而可以通过标准SQL查询它。<br> 实际上，所有与TimescaleDB的用户交互都是使用可调整的。 创建表格和索引，修改表格，插入数据，选择数据等都可以（也应该）在hypertable上执行。</p> 
<p>在TimescaleDB中创建一个超表需要两个简单的SQL命令：创建表（使用标准SQL语法），然后选择CLEATEYHYTABLE（）。</p> 
<ul><li><strong>chunk</strong></li></ul> 
<p>在内部，TimescaleDB自动将每个可分区块分割成块，每个块对应于特定的时间间隔和分区键空间的一个区域（使用散列）。 这些分区是不相交的（非重叠的），这有助于查询计划人员最小化它必须接触以解决查询的组块集合。<br> 每个块都使用标准数据库表来实现。 （在PostgreSQL内部，这个块实际上是一个“父”可变的“子表”。）<br> 块是正确的大小，确保表的索引的所有B树可以在插入期间驻留在内存中。 这可以避免在修改这些树中的任意位置时发生颠簸。</p> 
<pre><code class="prism language-shell">SELECT show_chunks<span class="token punctuation">(</span><span class="token string">'conditions'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
SELECT show_chunks<span class="token punctuation">(</span><span class="token string">'conditions'</span>, older_than <span class="token operator">=</span><span class="token operator">&gt;</span> INTERVAL <span class="token string">'3 months'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
SELECT show_chunks<span class="token punctuation">(</span><span class="token string">'conditions'</span>, older_than <span class="token operator">=</span><span class="token operator">&gt;</span> DATE <span class="token string">'2017-01-01'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="3Hypertable_89"></a>3.Hypertable</h4> 
<pre><code class="prism language-shell">create_hypertable
 
SELECT * FROM create_hypertable<span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">)</span> 
 
<span class="token comment"># 创建超表</span>
SELECT create_hypertable<span class="token punctuation">(</span><span class="token string">'conditions'</span>, <span class="token string">'time'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment"># 将表条件转换为超表，将chunk_time_interval设置为24小时。 </span>
SELECT create_hypertable<span class="token punctuation">(</span><span class="token string">'conditions'</span>, <span class="token string">'time'</span>, chunk_time_interval <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">86400000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
SELECT create_hypertable<span class="token punctuation">(</span><span class="token string">'conditions'</span>, <span class="token string">'time'</span>, chunk_time_interval <span class="token operator">=</span><span class="token operator">&gt;</span> INTERVAL <span class="token string">'1 day'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
chunk_time_interval 
Interval <span class="token keyword">in</span> event <span class="token function">time</span> that each chunk covers. Must be <span class="token operator">&gt;</span> <span class="token number">0</span>. As of TimescaleDB v0.11.0, default is <span class="token number">7</span> days. For previous versions, default is <span class="token number">1</span> month.  
 
 
<span class="token comment"># 使用时间分区和位置分区（4个分区）将表条件转换为超表： </span>
SELECT create_hypertable<span class="token punctuation">(</span><span class="token string">'conditions'</span>, <span class="token string">'time'</span>, <span class="token string">'location'</span>, <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/50/17/9FgxCdFE_o.png" alt="在这里插入图片描述"></p> 
<ul><li> <p><strong>create_hypertable()</strong><br> <img src="https://images2.imgbox.com/56/3a/DGGJWy6b_o.png" alt="在这里插入图片描述"></p> </li><li> <p><strong>add_dimension()</strong><br> <img src="https://images2.imgbox.com/b0/17/BaFGmkyS_o.png" alt="在这里插入图片描述"></p> </li></ul> 
<h4><a id="4Hypertable_118"></a>4.Hypertable操作</h4> 
<pre><code class="prism language-shell"><span class="token number">1</span>. 创建时序表<span class="token punctuation">(</span>hypertable<span class="token punctuation">)</span>
<span class="token comment"># Create a schema for a new hypertable  </span>
CREATE TABLE sensor_data <span class="token punctuation">(</span>  
<span class="token string">"time"</span> timestamp with <span class="token function">time</span> zone NOT NULL,  
device_id TEXT NOT NULL,  
location TEXT NULL,  
temperature NUMERIC NULL,  
humidity NUMERIC NULL,  
pm25 NUMERIC  
<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
<span class="token comment"># Create a hypertable from this data  </span>
SELECT create_hypertable  
<span class="token punctuation">(</span><span class="token string">'sensor_data'</span>, <span class="token string">'time'</span>, <span class="token string">'device_id'</span>, <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
 
<span class="token number">2</span>. 迁移数据到hyper table
<span class="token comment"># Migrate data from existing Postgres table into  </span>
<span class="token comment"># a TimescaleDB hypertable  </span>
INSERT INTO sensor_data <span class="token punctuation">(</span>SELECT * FROM old_data<span class="token punctuation">)</span><span class="token punctuation">;</span>  
 
<span class="token number">3</span>. 查询hyper table
<span class="token comment"># Query hypertable like any SQL table  </span>
SELECT device_id, AVG<span class="token punctuation">(</span>temperature<span class="token punctuation">)</span> from sensor_data  
WHERE temperature IS NOT NULL AND humidity <span class="token operator">&gt;</span> <span class="token number">0.5</span>  
AND <span class="token function">time</span> <span class="token operator">&gt;</span> now<span class="token punctuation">(</span><span class="token punctuation">)</span> - interval <span class="token string">'7 day'</span>  
GROUP BY device_id<span class="token punctuation">;</span>  
 
<span class="token number">4</span>. 查询最近异常的数据
<span class="token comment"># Metrics about resource-constrained devices  </span>
SELECT time, cpu, freemem, battery FROM devops  
WHERE <span class="token assign-left variable">device_id</span><span class="token operator">=</span><span class="token string">'foo'</span>  
AND cpu <span class="token operator">&gt;</span> <span class="token number">0.7</span> AND freemem <span class="token operator">&lt;</span> <span class="token number">0.2</span>  
ORDER BY <span class="token function">time</span> DESC  
LIMIT <span class="token number">100</span><span class="token punctuation">;</span>  
 
<span class="token number">5</span>. 计算最近7天，每小时的异常次数
<span class="token comment"># Calculate total errors by latest firmware versions  </span>
<span class="token comment"># per hour over the last 7 days  </span>
SELECT date_trunc<span class="token punctuation">(</span><span class="token string">'hour'</span>, <span class="token function">time</span><span class="token punctuation">)</span> as hour, firmware,  
COUNT<span class="token punctuation">(</span>error_msg<span class="token punctuation">)</span> as errno FROM data  
WHERE firmware <span class="token operator">&gt;</span> <span class="token number">50</span>  
AND <span class="token function">time</span> <span class="token operator">&gt;</span> now<span class="token punctuation">(</span><span class="token punctuation">)</span> - interval <span class="token string">'7 day'</span>  
GROUP BY hour, firmware  
ORDER BY hour DESC, errno DESC<span class="token punctuation">;</span>  
 
<span class="token number">6</span>. 计算巴士的每小时平均速度
<span class="token comment"># Find average bus speed in last hour  </span>
<span class="token comment"># for each NYC borough  </span>
SELECT loc.region, AVG<span class="token punctuation">(</span>bus.speed<span class="token punctuation">)</span> FROM bus  
INNER JOIN loc ON <span class="token punctuation">(</span>bus.bus_id <span class="token operator">=</span> loc.bus_id<span class="token punctuation">)</span>  
WHERE loc.city <span class="token operator">=</span> <span class="token string">'nyc'</span>  
AND bus.time <span class="token operator">&gt;</span> now<span class="token punctuation">(</span><span class="token punctuation">)</span> - interval <span class="token string">'1 hour'</span>  
GROUP BY loc.region<span class="token punctuation">;</span>  
 
<span class="token number">7</span>. 展示最近12小时，每小时的平均值
<span class="token operator">=</span><span class="token comment">#  SELECT date_trunc('hour', time) AS hour, AVG(weight)  </span>
    FROM logs  
    WHERE device_type <span class="token operator">=</span> <span class="token string">'pressure-sensor'</span> AND customer_id <span class="token operator">=</span> <span class="token number">440</span>  
      AND <span class="token function">time</span> <span class="token operator">&gt;</span> now<span class="token punctuation">(</span><span class="token punctuation">)</span> - interval <span class="token string">'12 hours'</span>  
    GROUP BY hour<span class="token punctuation">;</span>  
  
 hour               <span class="token operator">|</span> AVG<span class="token punctuation">(</span>weight<span class="token punctuation">)</span>  
--------------------+--------------  
 <span class="token number">2017</span>-01-04 <span class="token number">12</span>:00   <span class="token operator">|</span> <span class="token number">170.0</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">13</span>:00   <span class="token operator">|</span> <span class="token number">174.2</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">14</span>:00   <span class="token operator">|</span> <span class="token number">174.0</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">15</span>:00   <span class="token operator">|</span> <span class="token number">178.6</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">16</span>:00   <span class="token operator">|</span> <span class="token number">173.0</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">17</span>:00   <span class="token operator">|</span> <span class="token number">169.9</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">18</span>:00   <span class="token operator">|</span> <span class="token number">168.1</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">19</span>:00   <span class="token operator">|</span> <span class="token number">170.2</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">20</span>:00   <span class="token operator">|</span> <span class="token number">167.4</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">21</span>:00   <span class="token operator">|</span> <span class="token number">168.6</span>  
 
<span class="token number">8</span>. 监控每分钟过载的设备数量
<span class="token operator">=</span><span class="token comment">#  SELECT date_trunc('minute', time) AS minute, COUNT(device_id)  </span>
    FROM logs  
    WHERE cpu_level <span class="token operator">&gt;</span> <span class="token number">0.9</span> AND free_mem <span class="token operator">&lt;</span> <span class="token number">1024</span>  
      AND <span class="token function">time</span> <span class="token operator">&gt;</span> now<span class="token punctuation">(</span><span class="token punctuation">)</span> - interval <span class="token string">'24 hours'</span>  
    GROUP BY minute  
    ORDER BY COUNT<span class="token punctuation">(</span>device_id<span class="token punctuation">)</span> DESC LIMIT <span class="token number">25</span><span class="token punctuation">;</span>  
  
 minute             <span class="token operator">|</span> heavy_load_devices  
--------------------+---------------------  
 <span class="token number">2017</span>-01-04 <span class="token number">14</span>:59   <span class="token operator">|</span> <span class="token number">1653</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">15</span>:01   <span class="token operator">|</span> <span class="token number">1650</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">15</span>:00   <span class="token operator">|</span> <span class="token number">1605</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">15</span>:02   <span class="token operator">|</span> <span class="token number">1594</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">15</span>:03   <span class="token operator">|</span> <span class="token number">1594</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">15</span>:04   <span class="token operator">|</span> <span class="token number">1561</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">15</span>:06   <span class="token operator">|</span> <span class="token number">1499</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">15</span>:05   <span class="token operator">|</span> <span class="token number">1460</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">15</span>:08   <span class="token operator">|</span> <span class="token number">1459</span>  
 
<span class="token number">9</span>. 最近7天，按固件版本，输出每个固件版本的报错次数
<span class="token operator">=</span><span class="token comment">#  SELECT firmware_version, SUM(error_count) FROM logs  </span>
    WHERE <span class="token function">time</span> <span class="token operator">&gt;</span> now<span class="token punctuation">(</span><span class="token punctuation">)</span> - interval <span class="token string">'7 days'</span>  
    GROUP BY firmware_version  
    ORDER BY SUM<span class="token punctuation">(</span>error_count<span class="token punctuation">)</span> DESC LIMIT <span class="token number">10</span><span class="token punctuation">;</span>  
  
 firmware_version  <span class="token operator">|</span> SUM<span class="token punctuation">(</span>error_count<span class="token punctuation">)</span>  
-------------------+-------------------  
 <span class="token number">1.0</span>.10            <span class="token operator">|</span> <span class="token number">191</span>  
 <span class="token number">1.1</span>.0             <span class="token operator">|</span> <span class="token number">180</span>  
 <span class="token number">1.1</span>.1             <span class="token operator">|</span> <span class="token number">179</span>  
 <span class="token number">1.0</span>.8             <span class="token operator">|</span> <span class="token number">164</span>  
 <span class="token number">1.1</span>.3             <span class="token operator">|</span> <span class="token number">161</span>  
 <span class="token number">1.1</span>.2             <span class="token operator">|</span> <span class="token number">152</span>  
 <span class="token number">1.2</span>.1             <span class="token operator">|</span> <span class="token number">144</span>  
 <span class="token number">1.2</span>.0             <span class="token operator">|</span> <span class="token number">137</span>  
 <span class="token number">1.0</span>.7             <span class="token operator">|</span> <span class="token number">130</span>  
 <span class="token number">1.0</span>.5             <span class="token operator">|</span> <span class="token number">112</span>  
 <span class="token number">1.2</span>.2             <span class="token operator">|</span> <span class="token number">110</span>  
 
<span class="token number">10</span>. 某个范围，每小时，温度高于90度的设备数量。
<span class="token operator">=</span><span class="token comment">#  SELECT date_trunc('hour', time) AS hour, COUNT(logs.device_id)  </span>
    FROM logs  
    JOIN devices ON logs.device_id <span class="token operator">=</span> devices.id  
    WHERE logs.temperature <span class="token operator">&gt;</span> <span class="token number">90</span> AND devices.location <span class="token operator">=</span> <span class="token string">'SITE-1'</span>  
    GROUP BY hour<span class="token punctuation">;</span>  
  
 hour               <span class="token operator">|</span> COUNT<span class="token punctuation">(</span>logs.device_id<span class="token punctuation">)</span>  
--------------------+------------------------  
 <span class="token number">2017</span>-01-04 <span class="token number">12</span>:00   <span class="token operator">|</span> <span class="token number">994</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">13</span>:00   <span class="token operator">|</span> <span class="token number">905</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">14</span>:00   <span class="token operator">|</span> <span class="token number">875</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">15</span>:00   <span class="token operator">|</span> <span class="token number">910</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">16</span>:00   <span class="token operator">|</span> <span class="token number">905</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">17</span>:00   <span class="token operator">|</span> <span class="token number">840</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">18</span>:00   <span class="token operator">|</span> <span class="token number">801</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">19</span>:00   <span class="token operator">|</span> <span class="token number">813</span>  
 <span class="token number">2017</span>-01-04 <span class="token number">20</span>:00   <span class="token operator">|</span> <span class="token number">798</span>  
</code></pre> 
<ul><li><a href="https://iothub.org.cn/docs/middleware/" rel="nofollow"><strong>开源中间件</strong></a></li></ul> 
<pre><code class="prism language-shell"><span class="token comment"># TimescaleDB</span>

https://iothub.org.cn/docs/middleware/
https://iothub.org.cn/docs/middleware/timescale/timescale-summary/
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e787c017df9022322c418474ae5d70f4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【人工智能】本地搭建AI模型Gemma</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/592cf208c525495ba4a31c743369c9e5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【网络原理】使用Java基于TCP搭建简单客户端与服务器通信</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>