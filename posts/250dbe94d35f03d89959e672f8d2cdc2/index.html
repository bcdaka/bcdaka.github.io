<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>大创项目推荐 题目：基于机器视觉opencv的手势检测 手势识别 算法 - 深度学习 卷积神经网络 opencv python - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/250dbe94d35f03d89959e672f8d2cdc2/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="大创项目推荐 题目：基于机器视觉opencv的手势检测 手势识别 算法 - 深度学习 卷积神经网络 opencv python">
  <meta property="og:description" content="文章目录 1 简介2 传统机器视觉的手势检测2.1 轮廓检测法2.2 算法结果2.3 整体代码实现2.3.1 算法流程 3 深度学习方法做手势识别3.1 经典的卷积神经网络3.2 YOLO系列3.3 SSD3.4 实现步骤3.4.1 数据集3.4.2 图像预处理3.4.3 构建卷积神经网络结构3.4.4 实验训练过程及结果 3.5 关键代码 4 最后 1 简介 🔥 优质竞赛项目系列，今天要分享的是
基于机器视觉opencv的手势检测 手势识别 算法
该项目较为新颖，适合作为竞赛课题方向，学长非常推荐！
🧿 更多资料, 项目分享：
https://gitee.com/dancheng-senior/postgraduate
2 传统机器视觉的手势检测 普通机器视觉手势检测的基本流程如下：
其中轮廓的提取，多边形拟合曲线的求法，凸包集和凹陷集的求法都是采用opencv中自带的函数。手势数字的识别是利用凸包点以及凹陷点和手部中心点的几何关系，简单的做了下逻辑判别了（可以肯定的是这种方法很烂），具体的做法是先在手部定位出2个中心点坐标，这2个中心点坐标之间的距离阈值由程序设定，其中一个中心点就是利用OpenNI跟踪得到的手部位置。有了这2个中心点的坐标，在程序中就可以分别计算出在这2个中心点坐标上的凸凹点的个数。当然了，这样做的前提是用人在做手势表示数字的同时应该是将手指的方向朝上（因为没有像机器学习那样通过样本来训练，所以使用时条件要苛刻很多）。利用上面求出的4种点的个数(另外程序中还设置了2个辅助计算点的个数，具体见代码部分)和简单的逻辑判断就可以识别出数字0~5了。其它的数字可以依照具体的逻辑去设计（还可以设计出多位数字的识别），只是数字越多设计起来越复杂，因为要考虑到它们之间的干扰性，且这种不通用的设计方法也没有太多的实际意义。
2.1 轮廓检测法 使用 void convexityDefects(InputArray contour, InputArray convexhull,
OutputArray convexityDefects) 方法
该函数的作用是对输入的轮廓contour，凸包集合来检测其轮廓的凸型缺陷，一个凸型缺陷结构体包括4个元素，缺陷起点坐标，缺陷终点坐标，缺陷中离凸包线距离最远的点的坐标，以及此时最远的距离。参数3即其输出的凸型缺陷结构体向量。
其凸型缺陷的示意图如下所示：
第1个参数虽然写的是contour，字面意思是轮廓，但是本人实验过很多次，发现如果该参数为目标通过轮廓检测得到的原始轮廓的话，则程序运行到onvexityDefects()函数时会报内存错误。因此本程序中采用的不是物体原始的轮廓，而是经过多项式曲线拟合后的轮廓，即多项式曲线，这样程序就会顺利地运行得很好。另外由于在手势识别过程中可能某一帧检测出来的轮廓非常小（由于某种原因），以致于少到只有1个点，这时候如果程序运行到onvexityDefects()函数时就会报如下的错误：
​
int Mat::checkVector(int _elemChannels, int _depth, bool _requireContinuous) const { return (depth() == _depth || _depth &lt;= 0) &amp;&amp; (isContinuous() || !">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-29T10:12:04+08:00">
    <meta property="article:modified_time" content="2024-06-29T10:12:04+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">大创项目推荐 题目：基于机器视觉opencv的手势检测 手势识别 算法 - 深度学习 卷积神经网络 opencv python</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__3" rel="nofollow">1 简介</a></li><li><a href="#2__18" rel="nofollow">2 传统机器视觉的手势检测</a></li><li><ul><li><a href="#21__25" rel="nofollow">2.1 轮廓检测法</a></li><li><a href="#22__70" rel="nofollow">2.2 算法结果</a></li><li><a href="#23__90" rel="nofollow">2.3 整体代码实现</a></li><li><ul><li><a href="#231__92" rel="nofollow">2.3.1 算法流程</a></li></ul> 
  </li></ul> 
  </li><li><a href="#3__591" rel="nofollow">3 深度学习方法做手势识别</a></li><li><ul><li><a href="#31__593" rel="nofollow">3.1 经典的卷积神经网络</a></li><li><a href="#32_YOLO_598" rel="nofollow">3.2 YOLO系列</a></li><li><a href="#33_SSD_607" rel="nofollow">3.3 SSD</a></li><li><a href="#34__613" rel="nofollow">3.4 实现步骤</a></li><li><ul><li><a href="#341__615" rel="nofollow">3.4.1 数据集</a></li><li><a href="#342__628" rel="nofollow">3.4.2 图像预处理</a></li><li><a href="#343__636" rel="nofollow">3.4.3 构建卷积神经网络结构</a></li><li><a href="#344__652" rel="nofollow">3.4.4 实验训练过程及结果</a></li></ul> 
   </li><li><a href="#35__660" rel="nofollow">3.5 关键代码</a></li></ul> 
  </li><li><a href="#4__840" rel="nofollow">4 最后</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1__3"></a>1 简介</h2> 
<p>🔥 优质竞赛项目系列，今天要分享的是</p> 
<p><strong>基于机器视觉opencv的手势检测 手势识别 算法</strong></p> 
<p>该项目较为新颖，适合作为竞赛课题方向，学长非常推荐！</p> 
<p>🧿 <strong>更多资料, 项目分享：</strong></p> 
<p><a href="https://gitee.com/dancheng-senior/postgraduate" rel="nofollow">https://gitee.com/dancheng-senior/postgraduate</a></p> 
<h2><a id="2__18"></a>2 传统机器视觉的手势检测</h2> 
<p>普通机器视觉手势检测的基本流程如下：</p> 
<p><img src="https://images2.imgbox.com/b4/0d/gYeKhvBV_o.png" alt="在这里插入图片描述"><br> 其中轮廓的提取，多边形拟合曲线的求法，凸包集和凹陷集的求法都是采用opencv中自带的函数。手势数字的识别是利用凸包点以及凹陷点和手部中心点的几何关系，简单的做了下逻辑判别了（可以肯定的是这种方法很烂），具体的做法是先在手部定位出2个中心点坐标，这2个中心点坐标之间的距离阈值由程序设定，其中一个中心点就是利用OpenNI跟踪得到的手部位置。有了这2个中心点的坐标，在程序中就可以分别计算出在这2个中心点坐标上的凸凹点的个数。当然了，这样做的前提是用人在做手势表示数字的同时应该是将手指的方向朝上（因为没有像机器学习那样通过样本来训练，所以使用时条件要苛刻很多）。利用上面求出的4种点的个数(另外程序中还设置了2个辅助计算点的个数，具体见代码部分)和简单的逻辑判断就可以识别出数字0~5了。其它的数字可以依照具体的逻辑去设计（还可以设计出多位数字的识别），只是数字越多设计起来越复杂，因为要考虑到它们之间的干扰性，且这种不通用的设计方法也没有太多的实际意义。</p> 
<h3><a id="21__25"></a>2.1 轮廓检测法</h3> 
<p>使用 void convexityDefects(InputArray contour, InputArray convexhull,<br> OutputArray convexityDefects) 方法</p> 
<p>该函数的作用是对输入的轮廓contour，凸包集合来检测其轮廓的凸型缺陷，一个凸型缺陷结构体包括4个元素，缺陷起点坐标，缺陷终点坐标，缺陷中离凸包线距离最远的点的坐标，以及此时最远的距离。参数3即其输出的凸型缺陷结构体向量。</p> 
<p>其凸型缺陷的示意图如下所示：</p> 
<p><img src="https://images2.imgbox.com/0f/8c/klDDgmWq_o.png" alt="在这里插入图片描述"><br> 第1个参数虽然写的是contour，字面意思是轮廓，但是本人实验过很多次，发现如果该参数为目标通过轮廓检测得到的原始轮廓的话，则程序运行到onvexityDefects()函数时会报内存错误。因此本程序中采用的不是物体原始的轮廓，而是经过多项式曲线拟合后的轮廓，即多项式曲线，这样程序就会顺利地运行得很好。另外由于在手势识别过程中可能某一帧检测出来的轮廓非常小（由于某种原因），以致于少到只有1个点，这时候如果程序运行到onvexityDefects()函数时就会报如下的错误：</p> 
<p>​</p> 
<pre><code class="prism language-python"><span class="token builtin">int</span> Mat<span class="token punctuation">:</span><span class="token punctuation">:</span>checkVector<span class="token punctuation">(</span><span class="token builtin">int</span> _elemChannels<span class="token punctuation">,</span> <span class="token builtin">int</span> _depth<span class="token punctuation">,</span> <span class="token builtin">bool</span> _requireContinuous<span class="token punctuation">)</span> const

<span class="token punctuation">{<!-- --></span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>depth<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> _depth <span class="token operator">|</span><span class="token operator">|</span> _depth <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>

        <span class="token punctuation">(</span>isContinuous<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">|</span> !_requireContinuous<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>

        <span class="token punctuation">(</span><span class="token punctuation">(</span>dims <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rows <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span> cols <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> channels<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> _elemChannels<span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token punctuation">(</span>cols <span class="token operator">==</span> _elemChannels<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">|</span>

        <span class="token punctuation">(</span>dims <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> channels<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> size<span class="token punctuation">.</span>p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> _elemChannels <span class="token operator">&amp;</span><span class="token operator">&amp;</span> <span class="token punctuation">(</span>size<span class="token punctuation">.</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span> size<span class="token punctuation">.</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>

         <span class="token punctuation">(</span>isContinuous<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">|</span> step<span class="token punctuation">.</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> step<span class="token punctuation">.</span>p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">*</span>size<span class="token punctuation">.</span>p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    ? <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>total<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span>channels<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span>_elemChannels<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>该函数源码大概意思就是说对应的Mat矩阵如果其深度，连续性，通道数，行列式满足一定条件的话就返回Mat元素的个数和其通道数的乘积，否则返回-1；而本文是要求其返回值大于3，有得知此处输入多边形曲线(即参数1)的通道数为2，所以还需要求其元素的个数大于1.5，即大于2才满足ptnum</p> 
<blockquote></blockquote> 
<p>3。简单的说就是用convexityDefects()函数来对多边形曲线进行凹陷检测时，必须要求参数1曲线本身至少有2个点(也不知道这样分析对不对)。因此本人在本次程序convexityDefects()函数前加入了if(Mat(approx_poly_curve).checkVector(2,<br> CV_32S) &gt; 3)来判断，只有满足该if条件，才会进行后面的凹陷检测。这样程序就不会再出现类似的bug了。</p> 
<p>第2个参数一般是由opencv中的函数convexHull()获得的，一般情况下该参数里面存的是凸包集合中的点在多项式曲线点中的位置索引，且该参数以vector的形式存在，因此参数convexhull中其元素的类型为unsigned<br> int。在本次凹陷点检测函数convexityDefects()里面根据文档，要求该参数为Mat型。因此在使用convexityDefects()的参数2时，一般将vector直接转换Mat型。</p> 
<p>参数3是一个含有4个元素的结构体的集合，如果在c++的版本中，该参数可以直接用vector来代替，Vec4i中的4个元素分别表示凹陷曲线段的起始坐标索引，终点坐标索引，离凸包集曲线最远点的坐标索引以及此时的最远距离值，这4个值都是整数。在c版本的opencv中一般不是保存的索引，而是坐标值。</p> 
<h3><a id="22__70"></a>2.2 算法结果</h3> 
<p><strong>数字“0”的识别结果：</strong><br> <img src="https://images2.imgbox.com/41/87/QGwJROk6_o.png" alt="在这里插入图片描述"><br> <strong>数字“1”的识别结果</strong></p> 
<p><img src="https://images2.imgbox.com/8d/14/JhIcuugJ_o.png" alt="在这里插入图片描述"></p> 
<p><strong>数字“2”的识别结果</strong><br> <img src="https://images2.imgbox.com/21/07/tsb9DajY_o.png" alt="在这里插入图片描述"></p> 
<p><strong>数字“3”的识别结果：</strong><br> <img src="https://images2.imgbox.com/5c/c4/vwPOmOly_o.png" alt="在这里插入图片描述"></p> 
<p><strong>数字“4”的识别结果：</strong><br> <img src="https://images2.imgbox.com/13/1a/TzzXwwpJ_o.png" alt="在这里插入图片描述"></p> 
<p><strong>数字“5”的识别结果：</strong><br> <img src="https://images2.imgbox.com/43/07/V3TUXdo5_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="23__90"></a>2.3 整体代码实现</h3> 
<h4><a id="231__92"></a>2.3.1 算法流程</h4> 
<p>学长实现过程和上面的系统流程图类似，大概过程如下：</p> 
<ul><li> <p>1. 求出手部的掩膜</p> </li><li> <p>2. 求出掩膜的轮廓</p> </li><li> <p>3. 求出轮廓的多变形拟合曲线</p> </li><li> <p>4. 求出多边形拟合曲线的凸包集，找出凸点</p> </li><li> <p>5. 求出多变形拟合曲线的凹陷集，找出凹点</p> </li><li> <p>6. 利用上面的凸凹点和手部中心点的几何关系来做简单的数字手势识别</p> </li></ul> 
<p><strong>(这里用的是C语言写的，这个代码是学长早期写的，同学们需要的话，学长出一个python版本的)</strong></p> 
<p>​</p> 
<pre><code class="prism language-python">

    <span class="token comment">#include </span>
    
    <span class="token comment">#include "opencv2/highgui/highgui.hpp"</span>
    <span class="token comment">#include "opencv2/imgproc/imgproc.hpp"</span>
    <span class="token comment">#include </span>
    <span class="token comment">#include "copenni.cpp"</span>
    
    <span class="token comment">#include </span>
    
    <span class="token comment">#define DEPTH_SCALE_FACTOR 255./4096.</span>
    <span class="token comment">#define ROI_HAND_WIDTH 140</span>
    <span class="token comment">#define ROI_HAND_HEIGHT 140</span>
    <span class="token comment">#define MEDIAN_BLUR_K 5</span>
    <span class="token comment">#define XRES  640</span>
    <span class="token comment">#define YRES  480</span>
    <span class="token comment">#define DEPTH_SEGMENT_THRESH 5</span>
    <span class="token comment">#define MAX_HANDS_COLOR 10</span>
    <span class="token comment">#define MAX_HANDS_NUMBER  10</span>
    <span class="token comment">#define HAND_LIKELY_AREA 2000</span>
    <span class="token comment">#define DELTA_POINT_DISTENCE 25     //手部中心点1和中心点2距离的阈值</span>
    <span class="token comment">#define SEGMENT_POINT1_DISTANCE 27  //凸点与手部中心点1远近距离的阈值</span>
    <span class="token comment">#define SEGMENT_POINT2_DISTANCE 30  //凸点与手部中心点2远近距离的阈值</span>
    
    using namespace cv<span class="token punctuation">;</span>
    using namespace xn<span class="token punctuation">;</span>
    using namespace std<span class="token punctuation">;</span>


    <span class="token builtin">int</span> main <span class="token punctuation">(</span><span class="token builtin">int</span> argc<span class="token punctuation">,</span> char <span class="token operator">**</span>argv<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        unsigned <span class="token builtin">int</span> convex_number_above_point1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        unsigned <span class="token builtin">int</span> concave_number_above_point1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        unsigned <span class="token builtin">int</span> convex_number_above_point2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        unsigned <span class="token builtin">int</span> concave_number_above_point2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        unsigned <span class="token builtin">int</span> convex_assist_above_point1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        unsigned <span class="token builtin">int</span> convex_assist_above_point2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        unsigned <span class="token builtin">int</span> point_y1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        unsigned <span class="token builtin">int</span> point_y2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token builtin">int</span> number_result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token builtin">bool</span> recognition_flag <span class="token operator">=</span> false<span class="token punctuation">;</span>  <span class="token operator">//</span>开始手部数字识别的标志
    
        vector<span class="token operator">&lt;</span>Scalar<span class="token operator">&gt;</span> color_array<span class="token punctuation">;</span><span class="token operator">//</span>采用默认的<span class="token number">10</span>种颜色
        <span class="token punctuation">{<!-- --></span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        vector<span class="token operator">&lt;</span>unsigned <span class="token builtin">int</span><span class="token operator">&gt;</span> hand_depth<span class="token punctuation">(</span>MAX_HANDS_NUMBER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vector<span class="token operator">&lt;</span>Rect<span class="token operator">&gt;</span> hands_roi<span class="token punctuation">(</span>MAX_HANDS_NUMBER<span class="token punctuation">,</span> Rect<span class="token punctuation">(</span>XRES<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> YRES<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> ROI_HAND_WIDTH<span class="token punctuation">,</span> ROI_HAND_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        namedWindow<span class="token punctuation">(</span><span class="token string">"color image"</span><span class="token punctuation">,</span> CV_WINDOW_AUTOSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        namedWindow<span class="token punctuation">(</span><span class="token string">"depth image"</span><span class="token punctuation">,</span> CV_WINDOW_AUTOSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        namedWindow<span class="token punctuation">(</span><span class="token string">"hand_segment"</span><span class="token punctuation">,</span> CV_WINDOW_AUTOSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">//</span>显示分割出来的手的区域
        namedWindow<span class="token punctuation">(</span><span class="token string">"handrecognition"</span><span class="token punctuation">,</span> CV_WINDOW_AUTOSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">//</span>显示<span class="token number">0</span><span class="token operator">~</span><span class="token number">5</span>数字识别的图像
    
        COpenNI openni<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>!openni<span class="token punctuation">.</span>Initial<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    
        <span class="token keyword">if</span><span class="token punctuation">(</span>!openni<span class="token punctuation">.</span>Start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>!openni<span class="token punctuation">.</span>UpdateData<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">*</span>获取并显示色彩图像<span class="token operator">*</span><span class="token operator">/</span>
            Mat color_image_src<span class="token punctuation">(</span>openni<span class="token punctuation">.</span>image_metadata_<span class="token punctuation">.</span>YRes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> openni<span class="token punctuation">.</span>image_metadata_<span class="token punctuation">.</span>XRes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                CV_8UC3<span class="token punctuation">,</span> <span class="token punctuation">(</span>char <span class="token operator">*</span><span class="token punctuation">)</span>openni<span class="token punctuation">.</span>image_metadata_<span class="token punctuation">.</span>Data<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Mat color_image<span class="token punctuation">;</span>
            cvtColor<span class="token punctuation">(</span>color_image_src<span class="token punctuation">,</span> color_image<span class="token punctuation">,</span> CV_RGB2BGR<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Mat hand_segment_mask<span class="token punctuation">(</span>color_image<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_8UC1<span class="token punctuation">,</span> Scalar<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
            <span class="token keyword">for</span><span class="token punctuation">(</span>auto itUser <span class="token operator">=</span> openni<span class="token punctuation">.</span>hand_points_<span class="token punctuation">.</span>cbegin<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> itUser <span class="token operator">!=</span> openni<span class="token punctuation">.</span>hand_points_<span class="token punctuation">.</span>cend<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>itUser<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    
                point_y1 <span class="token operator">=</span> itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>Y<span class="token punctuation">;</span>
                point_y2 <span class="token operator">=</span> itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>Y <span class="token operator">+</span> DELTA_POINT_DISTENCE<span class="token punctuation">;</span>
                circle<span class="token punctuation">(</span>color_image<span class="token punctuation">,</span> Point<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>X<span class="token punctuation">,</span> itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">,</span>
                       <span class="token number">5</span><span class="token punctuation">,</span> color_array<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> color_array<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
                <span class="token operator">/</span><span class="token operator">*</span>设置不同手部的深度<span class="token operator">*</span><span class="token operator">/</span>
                hand_depth<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_COLOR<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>unsigned <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>Z<span class="token operator">*</span> DEPTH_SCALE_FACTOR<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first会导致程序出现bug
    
                <span class="token operator">/</span><span class="token operator">*</span>设置不同手部的不同感兴趣区域<span class="token operator">*</span><span class="token operator">/</span>
                hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span> <span class="token operator">=</span> Rect<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>X <span class="token operator">-</span> ROI_HAND_WIDTH<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>Y <span class="token operator">-</span> ROI_HAND_HEIGHT<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>
                                                   ROI_HAND_WIDTH<span class="token punctuation">,</span> ROI_HAND_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">;</span>
                hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token operator">=</span>  itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>X <span class="token operator">-</span> ROI_HAND_WIDTH<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
                hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">=</span>  itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>Y <span class="token operator">-</span> ROI_HAND_HEIGHT<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
                hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">=</span> ROI_HAND_WIDTH<span class="token punctuation">;</span>
                hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>height <span class="token operator">=</span> ROI_HAND_HEIGHT<span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>x  <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token operator">&gt;</span> XRES<span class="token punctuation">)</span>
                    hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token operator">=</span>  XRES<span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">&gt;</span> YRES<span class="token punctuation">)</span>
                    hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">=</span>  YRES<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            imshow<span class="token punctuation">(</span><span class="token string">"color image"</span><span class="token punctuation">,</span> color_image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
            <span class="token operator">/</span><span class="token operator">*</span>获取并显示深度图像<span class="token operator">*</span><span class="token operator">/</span>
            Mat depth_image_src<span class="token punctuation">(</span>openni<span class="token punctuation">.</span>depth_metadata_<span class="token punctuation">.</span>YRes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> openni<span class="token punctuation">.</span>depth_metadata_<span class="token punctuation">.</span>XRes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                CV_16UC1<span class="token punctuation">,</span> <span class="token punctuation">(</span>char <span class="token operator">*</span><span class="token punctuation">)</span>openni<span class="token punctuation">.</span>depth_metadata_<span class="token punctuation">.</span>Data<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>因为kinect获取到的深度图像实际上是无符号的<span class="token number">16</span>位数据
            Mat depth_image<span class="token punctuation">;</span>
            depth_image_src<span class="token punctuation">.</span>convertTo<span class="token punctuation">(</span>depth_image<span class="token punctuation">,</span> CV_8U<span class="token punctuation">,</span> DEPTH_SCALE_FACTOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
            imshow<span class="token punctuation">(</span><span class="token string">"depth image"</span><span class="token punctuation">,</span> depth_image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
            <span class="token operator">//</span>取出手的mask部分
            <span class="token operator">//</span>不管原图像时多少通道的，mask矩阵声明为单通道就ok
            <span class="token keyword">for</span><span class="token punctuation">(</span>auto itUser <span class="token operator">=</span> openni<span class="token punctuation">.</span>hand_points_<span class="token punctuation">.</span>cbegin<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> itUser <span class="token operator">!=</span> openni<span class="token punctuation">.</span>hand_points_<span class="token punctuation">.</span>cend<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>itUser<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token builtin">int</span> i <span class="token operator">=</span> hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token builtin">min</span><span class="token punctuation">(</span>hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">+</span>hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span> XRES<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>
                    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token builtin">int</span> j <span class="token operator">=</span> hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token builtin">min</span><span class="token punctuation">(</span>hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">+</span>hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>height<span class="token punctuation">,</span> YRES<span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        hand_segment_mask<span class="token punctuation">.</span>at<span class="token operator">&lt;</span>unsigned char<span class="token operator">&gt;</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>hand_depth<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token operator">-</span>DEPTH_SEGMENT_THRESH<span class="token punctuation">)</span> <span class="token operator">&lt;</span> depth_image<span class="token punctuation">.</span>at<span class="token operator">&lt;</span>unsigned char<span class="token operator">&gt;</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
                                                                    <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>hand_depth<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token operator">+</span>DEPTH_SEGMENT_THRESH<span class="token punctuation">)</span> <span class="token operator">&gt;</span> depth_image<span class="token punctuation">.</span>at<span class="token operator">&lt;</span>unsigned char<span class="token operator">&gt;</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
             <span class="token punctuation">}</span>
            medianBlur<span class="token punctuation">(</span>hand_segment_mask<span class="token punctuation">,</span> hand_segment_mask<span class="token punctuation">,</span> MEDIAN_BLUR_K<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Mat hand_segment<span class="token punctuation">(</span>color_image<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_8UC3<span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_image<span class="token punctuation">.</span>copyTo<span class="token punctuation">(</span>hand_segment<span class="token punctuation">,</span> hand_segment_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
            <span class="token operator">/</span><span class="token operator">*</span>对mask图像进行轮廓提取<span class="token punctuation">,</span>并在手势识别图像中画出来<span class="token operator">*</span><span class="token operator">/</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>Point<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> contours<span class="token punctuation">;</span>
            findContours<span class="token punctuation">(</span>hand_segment_mask<span class="token punctuation">,</span> contours<span class="token punctuation">,</span> CV_RETR_LIST<span class="token punctuation">,</span> CV_CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>找出mask图像的轮廓
            Mat hand_recognition_image <span class="token operator">=</span> Mat<span class="token punctuation">:</span><span class="token punctuation">:</span>zeros<span class="token punctuation">(</span>color_image<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> color_image<span class="token punctuation">.</span>cols<span class="token punctuation">,</span> CV_8UC3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token builtin">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> contours<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token operator">//</span>只有在检测到轮廓时才会去求它的多边形，凸包集，凹陷集
                recognition_flag <span class="token operator">=</span> true<span class="token punctuation">;</span>
                <span class="token operator">/</span><span class="token operator">*</span>找出轮廓图像多边形拟合曲线<span class="token operator">*</span><span class="token operator">/</span>
                Mat contour_mat <span class="token operator">=</span> Mat<span class="token punctuation">(</span>contours<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>contourArea<span class="token punctuation">(</span>contour_mat<span class="token punctuation">)</span> <span class="token operator">&gt;</span> HAND_LIKELY_AREA<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>   <span class="token operator">//</span>比较有可能像手的区域
                    std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>Point<span class="token operator">&gt;</span> approx_poly_curve<span class="token punctuation">;</span>
                    approxPolyDP<span class="token punctuation">(</span>contour_mat<span class="token punctuation">,</span> approx_poly_curve<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>找出轮廓的多边形拟合曲线
                    std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>Point<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> approx_poly_curve_debug<span class="token punctuation">;</span>
                    approx_poly_curve_debug<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>approx_poly_curve<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
                     drawContours<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> contours<span class="token punctuation">,</span> i<span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">//</span>画出轮廓
        <span class="token operator">//</span>            drawContours<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> approx_poly_curve_debug<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">//</span>画出多边形拟合曲线
    
                    <span class="token operator">/</span><span class="token operator">*</span>对求出的多边形拟合曲线求出其凸包集<span class="token operator">*</span><span class="token operator">/</span>
                    vector<span class="token operator">&lt;</span><span class="token builtin">int</span><span class="token operator">&gt;</span> hull<span class="token punctuation">;</span>
                    convexHull<span class="token punctuation">(</span>Mat<span class="token punctuation">(</span>approx_poly_curve<span class="token punctuation">)</span><span class="token punctuation">,</span> hull<span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token builtin">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hull<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        circle<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> approx_poly_curve<span class="token punctuation">[</span>hull<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
                        <span class="token operator">/</span><span class="token operator">*</span>统计在中心点<span class="token number">1</span>以上凸点的个数<span class="token operator">*</span><span class="token operator">/</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>approx_poly_curve<span class="token punctuation">[</span>hull<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> point_y1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token operator">/</span><span class="token operator">*</span>统计凸点与中心点<span class="token number">1</span>的y轴距离<span class="token operator">*</span><span class="token operator">/</span>
                            <span class="token builtin">long</span> dis_point1 <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token builtin">long</span><span class="token punctuation">(</span>point_y1 <span class="token operator">-</span> approx_poly_curve<span class="token punctuation">[</span>hull<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token builtin">int</span> dis1 <span class="token operator">=</span> point_y1 <span class="token operator">-</span> approx_poly_curve<span class="token punctuation">[</span>hull<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>dis_point1 <span class="token operator">&gt;</span> SEGMENT_POINT1_DISTANCE <span class="token operator">&amp;</span><span class="token operator">&amp;</span> dis1 <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
                                convex_assist_above_point1<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            convex_number_above_point1<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
    
                        <span class="token operator">/</span><span class="token operator">*</span>统计在中心点<span class="token number">2</span>以上凸点的个数<span class="token operator">*</span><span class="token operator">/</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>approx_poly_curve<span class="token punctuation">[</span>hull<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> point_y2<span class="token punctuation">)</span>    <span class="token punctuation">{<!-- --></span>
                            <span class="token operator">/</span><span class="token operator">*</span>统计凸点与中心点<span class="token number">1</span>的y轴距离<span class="token operator">*</span><span class="token operator">/</span>
                            <span class="token builtin">long</span> dis_point2 <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token builtin">long</span><span class="token punctuation">(</span>point_y2 <span class="token operator">-</span> approx_poly_curve<span class="token punctuation">[</span>hull<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token builtin">int</span> dis2 <span class="token operator">=</span> point_y2 <span class="token operator">-</span> approx_poly_curve<span class="token punctuation">[</span>hull<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>dis_point2 <span class="token operator">&gt;</span> SEGMENT_POINT2_DISTANCE <span class="token operator">&amp;</span><span class="token operator">&amp;</span> dis2 <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
                                convex_assist_above_point2<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            convex_number_above_point2<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
    
        <span class="token operator">//</span>            <span class="token operator">/</span><span class="token operator">*</span>对求出的多边形拟合曲线求出凹陷集<span class="token operator">*</span><span class="token operator">/</span>
                    std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>Vec4i<span class="token operator">&gt;</span> convexity_defects<span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>Mat<span class="token punctuation">(</span>approx_poly_curve<span class="token punctuation">)</span><span class="token punctuation">.</span>checkVector<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> CV_32S<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span>
                        convexityDefects<span class="token punctuation">(</span>approx_poly_curve<span class="token punctuation">,</span> Mat<span class="token punctuation">(</span>hull<span class="token punctuation">)</span><span class="token punctuation">,</span> convexity_defects<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token builtin">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> convexity_defects<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        circle<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> approx_poly_curve<span class="token punctuation">[</span>convexity_defects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
                        <span class="token operator">/</span><span class="token operator">*</span>统计在中心点<span class="token number">1</span>以上凹陷点的个数<span class="token operator">*</span><span class="token operator">/</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>approx_poly_curve<span class="token punctuation">[</span>convexity_defects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> point_y1<span class="token punctuation">)</span>
                            concave_number_above_point1<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">;</span>
    
                        <span class="token operator">/</span><span class="token operator">*</span>统计在中心点<span class="token number">2</span>以上凹陷点的个数<span class="token operator">*</span><span class="token operator">/</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>approx_poly_curve<span class="token punctuation">[</span>convexity_defects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> point_y2<span class="token punctuation">)</span>
                            concave_number_above_point2<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
    
            <span class="token operator">/</span><span class="token operator">**</span>画出手势的中心点<span class="token operator">**</span><span class="token operator">/</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>auto itUser <span class="token operator">=</span> openni<span class="token punctuation">.</span>hand_points_<span class="token punctuation">.</span>cbegin<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> itUser <span class="token operator">!=</span> openni<span class="token punctuation">.</span>hand_points_<span class="token punctuation">.</span>cend<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>itUser<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                circle<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> Point<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>X<span class="token punctuation">,</span> itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                circle<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> Point<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>X<span class="token punctuation">,</span> itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>Y <span class="token operator">+</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
    
            <span class="token operator">/</span><span class="token operator">*</span>手势数字<span class="token number">0</span><span class="token operator">~</span><span class="token number">5</span>的识别<span class="token operator">*</span><span class="token operator">/</span>
            <span class="token operator">//</span><span class="token string">"0"</span>的识别
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>convex_assist_above_point1 <span class="token operator">==</span><span class="token number">0</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_number_above_point2 <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_number_above_point2 <span class="token operator">&lt;=</span> <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>
                    concave_number_above_point2 <span class="token operator">&lt;=</span> <span class="token number">1</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> concave_number_above_point1 <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token punctuation">(</span>concave_number_above_point1 <span class="token operator">==</span><span class="token number">0</span>
                    <span class="token operator">|</span><span class="token operator">|</span> concave_number_above_point2 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> recognition_flag <span class="token operator">==</span> true<span class="token punctuation">)</span>
                number_result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token operator">//</span><span class="token string">"1"</span>的识别
            <span class="token keyword">if</span><span class="token punctuation">(</span>convex_assist_above_point1 <span class="token operator">==</span><span class="token number">1</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_number_above_point1 <span class="token operator">&gt;=</span><span class="token number">1</span>  <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_number_above_point1 <span class="token operator">&lt;=</span><span class="token number">2</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>
                    convex_number_above_point2 <span class="token operator">&gt;=</span><span class="token number">2</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_assist_above_point2 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
                number_result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token operator">//</span><span class="token string">"2"</span>的识别
            <span class="token keyword">if</span><span class="token punctuation">(</span>convex_number_above_point1 <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> concave_number_above_point1 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_assist_above_point2 <span class="token operator">==</span> <span class="token number">2</span>
                    <span class="token operator">/</span><span class="token operator">*</span>convex_assist_above_point1 <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token operator">*</span><span class="token operator">/</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> concave_number_above_point2 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
                number_result <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token operator">//</span><span class="token string">"3"</span>的识别
            <span class="token keyword">if</span><span class="token punctuation">(</span>convex_number_above_point1 <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> concave_number_above_point1 <span class="token operator">&lt;=</span> <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>
                    concave_number_above_point1 <span class="token operator">&gt;=</span><span class="token number">1</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_number_above_point2 <span class="token operator">&gt;=</span> <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_number_above_point2 <span class="token operator">&lt;=</span> <span class="token number">4</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>
                    convex_assist_above_point2 <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
                number_result <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token operator">//</span><span class="token string">"4"</span>的识别
            <span class="token keyword">if</span><span class="token punctuation">(</span>convex_number_above_point1 <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> concave_number_above_point1 <span class="token operator">&lt;=</span><span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> concave_number_above_point1 <span class="token operator">&gt;=</span><span class="token number">2</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>
                    convex_number_above_point2 <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
                number_result <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
            <span class="token operator">//</span><span class="token string">"5"</span>的识别
            <span class="token keyword">if</span><span class="token punctuation">(</span>convex_number_above_point1 <span class="token operator">&gt;=</span><span class="token number">4</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_number_above_point2 <span class="token operator">==</span> <span class="token number">5</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> concave_number_above_point2 <span class="token operator">&gt;=</span> <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>
                    convex_number_above_point2 <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">)</span>
                number_result <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>number_result <span class="token operator">!=</span><span class="token number">0</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> number_result <span class="token operator">!=</span> <span class="token number">1</span>  <span class="token operator">&amp;</span><span class="token operator">&amp;</span> number_result <span class="token operator">!=</span> <span class="token number">2</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> number_result <span class="token operator">!=</span> <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> number_result <span class="token operator">!=</span> <span class="token number">4</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> number_result <span class="token operator">!=</span> <span class="token number">5</span><span class="token punctuation">)</span>
                number_result <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    
            <span class="token operator">/</span><span class="token operator">*</span>在手势识别图上显示匹配的数字<span class="token operator">*</span><span class="token operator">/</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>stringstream number_str<span class="token punctuation">;</span>
            number_str <span class="token operator">&lt;&lt;</span> number_result<span class="token punctuation">;</span>
            putText<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> <span class="token string">"Match: "</span><span class="token punctuation">,</span> Point<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>number_result <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                putText<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">,</span> Point<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                putText<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> number_str<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Point<span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
            imshow<span class="token punctuation">(</span><span class="token string">"handrecognition"</span><span class="token punctuation">,</span> hand_recognition_image<span class="token punctuation">)</span><span class="token punctuation">;</span>
            imshow<span class="token punctuation">(</span><span class="token string">"hand_segment"</span><span class="token punctuation">,</span> hand_segment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
            <span class="token operator">/</span><span class="token operator">*</span>一个循环中对有些变量进行初始化操作<span class="token operator">*</span><span class="token operator">/</span>
            convex_number_above_point1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            convex_number_above_point2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            concave_number_above_point1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            concave_number_above_point2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            convex_assist_above_point1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            convex_assist_above_point2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            number_result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            recognition_flag <span class="token operator">=</span> false<span class="token punctuation">;</span>
            number_str<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
            waitKey<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
    <span class="token punctuation">}</span>



    <span class="token comment">#include "copenni.h"</span>
    <span class="token comment">#include </span>
    <span class="token comment">#include </span>
    <span class="token comment">#include </span>
    
    using namespace xn<span class="token punctuation">;</span>
    using namespace std<span class="token punctuation">;</span>
    
    COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>COpenNI<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
    
    COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">~</span>COpenNI<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
    
    <span class="token builtin">bool</span> COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>Initial<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        status_ <span class="token operator">=</span> context_<span class="token punctuation">.</span>Init<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Context initial failed!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        context_<span class="token punctuation">.</span>SetGlobalMirror<span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>设置镜像
        xmode_<span class="token punctuation">.</span>nXRes <span class="token operator">=</span> <span class="token number">640</span><span class="token punctuation">;</span>
        xmode_<span class="token punctuation">.</span>nYRes <span class="token operator">=</span> <span class="token number">480</span><span class="token punctuation">;</span>
        xmode_<span class="token punctuation">.</span>nFPS <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    
        <span class="token operator">//</span>产生颜色node
        status_ <span class="token operator">=</span> image_generator_<span class="token punctuation">.</span>Create<span class="token punctuation">(</span>context_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Create image generator  error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        <span class="token operator">//</span>设置颜色图片输出模式
        status_ <span class="token operator">=</span> image_generator_<span class="token punctuation">.</span>SetMapOutputMode<span class="token punctuation">(</span>xmode_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"SetMapOutputMdoe error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        <span class="token operator">//</span>产生深度node
        status_ <span class="token operator">=</span> depth_generator_<span class="token punctuation">.</span>Create<span class="token punctuation">(</span>context_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Create depth generator  error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        <span class="token operator">//</span>设置深度图片输出模式
        status_ <span class="token operator">=</span> depth_generator_<span class="token punctuation">.</span>SetMapOutputMode<span class="token punctuation">(</span>xmode_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"SetMapOutputMdoe error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        <span class="token operator">//</span>产生手势node
        status_ <span class="token operator">=</span> gesture_generator_<span class="token punctuation">.</span>Create<span class="token punctuation">(</span>context_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Create gesture generator error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        <span class="token operator">/</span><span class="token operator">*</span>添加手势识别的种类<span class="token operator">*</span><span class="token operator">/</span>
        gesture_generator_<span class="token punctuation">.</span>AddGesture<span class="token punctuation">(</span><span class="token string">"Wave"</span><span class="token punctuation">,</span> NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gesture_generator_<span class="token punctuation">.</span>AddGesture<span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gesture_generator_<span class="token punctuation">.</span>AddGesture<span class="token punctuation">(</span><span class="token string">"RaiseHand"</span><span class="token punctuation">,</span> NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gesture_generator_<span class="token punctuation">.</span>AddGesture<span class="token punctuation">(</span><span class="token string">"MovingHand"</span><span class="token punctuation">,</span> NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token operator">//</span>产生手部的node
        status_ <span class="token operator">=</span> hand_generator_<span class="token punctuation">.</span>Create<span class="token punctuation">(</span>context_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Create hand generaotr error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        <span class="token operator">//</span>产生人体node
        status_ <span class="token operator">=</span> user_generator_<span class="token punctuation">.</span>Create<span class="token punctuation">(</span>context_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Create gesturen generator error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        <span class="token operator">//</span>视角校正
        status_ <span class="token operator">=</span> depth_generator_<span class="token punctuation">.</span>GetAlternativeViewPointCap<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SetViewPoint<span class="token punctuation">(</span>image_generator_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Can't set the alternative view point on depth generator!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        <span class="token operator">//</span>设置与手势有关的回调函数
        XnCallbackHandle gesture_cb<span class="token punctuation">;</span>
        gesture_generator_<span class="token punctuation">.</span>RegisterGestureCallbacks<span class="token punctuation">(</span>CBGestureRecognized<span class="token punctuation">,</span> CBGestureProgress<span class="token punctuation">,</span> this<span class="token punctuation">,</span> gesture_cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token operator">//</span>设置于手部有关的回调函数
        XnCallbackHandle hands_cb<span class="token punctuation">;</span>
        hand_generator_<span class="token punctuation">.</span>RegisterHandCallbacks<span class="token punctuation">(</span>HandCreate<span class="token punctuation">,</span> HandUpdate<span class="token punctuation">,</span> HandDestroy<span class="token punctuation">,</span> this<span class="token punctuation">,</span> hands_cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token operator">//</span>设置有人进入视野的回调函数
        XnCallbackHandle new_user_handle<span class="token punctuation">;</span>
        user_generator_<span class="token punctuation">.</span>RegisterUserCallbacks<span class="token punctuation">(</span>CBNewUser<span class="token punctuation">,</span> NULL<span class="token punctuation">,</span> NULL<span class="token punctuation">,</span> new_user_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        user_generator_<span class="token punctuation">.</span>GetSkeletonCap<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SetSkeletonProfile<span class="token punctuation">(</span>XN_SKEL_PROFILE_ALL<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>设定使用所有关节（共<span class="token number">15</span>个）
    
        <span class="token operator">//</span>设置骨骼校正完成的回调函数
        XnCallbackHandle calibration_complete<span class="token punctuation">;</span>
        user_generator_<span class="token punctuation">.</span>GetSkeletonCap<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>RegisterToCalibrationComplete<span class="token punctuation">(</span>CBCalibrationComplete<span class="token punctuation">,</span> this<span class="token punctuation">,</span> calibration_complete<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> true<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token builtin">bool</span> COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>Start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        status_ <span class="token operator">=</span> context_<span class="token punctuation">.</span>StartGeneratingAll<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Start generating error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> true<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token builtin">bool</span> COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>UpdateData<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        status_ <span class="token operator">=</span> context_<span class="token punctuation">.</span>WaitNoneUpdateAll<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Update date error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token operator">//</span>获取数据
        image_generator_<span class="token punctuation">.</span>GetMetaData<span class="token punctuation">(</span>image_metadata_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        depth_generator_<span class="token punctuation">.</span>GetMetaData<span class="token punctuation">(</span>depth_metadata_<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token keyword">return</span> true<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    ImageGenerator <span class="token operator">&amp;</span>COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>getImageGenerator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> image_generator_<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    DepthGenerator <span class="token operator">&amp;</span>COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>getDepthGenerator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> depth_generator_<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    UserGenerator <span class="token operator">&amp;</span>COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>getUserGenerator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> user_generator_<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    GestureGenerator <span class="token operator">&amp;</span>COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>getGestureGenerator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> gesture_generator_<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    HandsGenerator <span class="token operator">&amp;</span>COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>getHandGenerator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> hand_generator_<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token builtin">bool</span> COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>CheckError<span class="token punctuation">(</span>const char <span class="token operator">*</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>status_ <span class="token operator">!=</span> XN_STATUS_OK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            cerr <span class="token operator">&lt;&lt;</span> error <span class="token operator">&lt;&lt;</span> <span class="token string">": "</span> <span class="token operator">&lt;&lt;</span> xnGetStatusString<span class="token punctuation">(</span> status_ <span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
            <span class="token keyword">return</span> true<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    void COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>CBNewUser<span class="token punctuation">(</span>UserGenerator <span class="token operator">&amp;</span>generator<span class="token punctuation">,</span> XnUserID user<span class="token punctuation">,</span> void <span class="token operator">*</span>p_cookie<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token operator">//</span>得到skeleton的capability<span class="token punctuation">,</span>并调用RequestCalibration函数设置对新检测到的人进行骨骼校正
        generator<span class="token punctuation">.</span>GetSkeletonCap<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>RequestCalibration<span class="token punctuation">(</span>user<span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    void COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>CBCalibrationComplete<span class="token punctuation">(</span>SkeletonCapability <span class="token operator">&amp;</span>skeleton<span class="token punctuation">,</span> XnUserID user<span class="token punctuation">,</span> XnCalibrationStatus calibration_error<span class="token punctuation">,</span> void <span class="token operator">*</span>p_cookie<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>calibration_error <span class="token operator">==</span> XN_CALIBRATION_STATUS_OK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            skeleton<span class="token punctuation">.</span>StartTracking<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>骨骼校正完成后就开始进行人体跟踪了
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            UserGenerator <span class="token operator">*</span>p_user <span class="token operator">=</span> <span class="token punctuation">(</span>UserGenerator<span class="token operator">*</span><span class="token punctuation">)</span>p_cookie<span class="token punctuation">;</span>
            skeleton<span class="token punctuation">.</span>RequestCalibration<span class="token punctuation">(</span>user<span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>骨骼校正失败时重新设置对人体骨骼继续进行校正
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    void COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>CBGestureRecognized<span class="token punctuation">(</span>GestureGenerator <span class="token operator">&amp;</span>generator<span class="token punctuation">,</span> const XnChar <span class="token operator">*</span>strGesture<span class="token punctuation">,</span> const XnPoint3D <span class="token operator">*</span>pIDPosition<span class="token punctuation">,</span> const XnPoint3D <span class="token operator">*</span>pEndPosition<span class="token punctuation">,</span> void <span class="token operator">*</span>pCookie<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        COpenNI <span class="token operator">*</span>openni <span class="token operator">=</span> <span class="token punctuation">(</span>COpenNI<span class="token operator">*</span><span class="token punctuation">)</span>pCookie<span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>hand_generator_<span class="token punctuation">.</span>StartTracking<span class="token punctuation">(</span><span class="token operator">*</span>pEndPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    void COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>CBGestureProgress<span class="token punctuation">(</span>GestureGenerator <span class="token operator">&amp;</span>generator<span class="token punctuation">,</span> const XnChar <span class="token operator">*</span>strGesture<span class="token punctuation">,</span> const XnPoint3D <span class="token operator">*</span>pPosition<span class="token punctuation">,</span> XnFloat fProgress<span class="token punctuation">,</span> void <span class="token operator">*</span>pCookie<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
    
    void COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>HandCreate<span class="token punctuation">(</span>HandsGenerator <span class="token operator">&amp;</span>rHands<span class="token punctuation">,</span> XnUserID xUID<span class="token punctuation">,</span> const XnPoint3D <span class="token operator">*</span>pPosition<span class="token punctuation">,</span> XnFloat fTime<span class="token punctuation">,</span> void <span class="token operator">*</span>pCookie<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        COpenNI <span class="token operator">*</span>openni <span class="token operator">=</span> <span class="token punctuation">(</span>COpenNI<span class="token operator">*</span><span class="token punctuation">)</span>pCookie<span class="token punctuation">;</span>
        XnPoint3D project_pos<span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>depth_generator_<span class="token punctuation">.</span>ConvertRealWorldToProjective<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> pPosition<span class="token punctuation">,</span> <span class="token operator">&amp;</span>project_pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        pair<span class="token operator">&lt;</span>XnUserID<span class="token punctuation">,</span> XnPoint3D<span class="token operator">&gt;</span> hand_point_pair<span class="token punctuation">(</span>xUID<span class="token punctuation">,</span> XnPoint3D<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>在进行pair类型的定义时，可以将第<span class="token number">2</span>个设置为空
        hand_point_pair<span class="token punctuation">.</span>second <span class="token operator">=</span> project_pos<span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>hand_points_<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>hand_point_pair<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>将检测到的手部存入<span class="token builtin">map</span>类型的hand_points_中。
    
        pair<span class="token operator">&lt;</span>XnUserID<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>XnPoint3D<span class="token operator">&gt;&gt;</span> hand_track_point<span class="token punctuation">(</span>xUID<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>XnPoint3D<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hand_track_point<span class="token punctuation">.</span>second<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>project_pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>hands_track_points_<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>hand_track_point<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    void COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>HandUpdate<span class="token punctuation">(</span>HandsGenerator <span class="token operator">&amp;</span>rHands<span class="token punctuation">,</span> XnUserID xUID<span class="token punctuation">,</span> const XnPoint3D <span class="token operator">*</span>pPosition<span class="token punctuation">,</span> XnFloat fTime<span class="token punctuation">,</span> void <span class="token operator">*</span>pCookie<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        COpenNI <span class="token operator">*</span>openni <span class="token operator">=</span> <span class="token punctuation">(</span>COpenNI<span class="token operator">*</span><span class="token punctuation">)</span>pCookie<span class="token punctuation">;</span>
        XnPoint3D project_pos<span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>depth_generator_<span class="token punctuation">.</span>ConvertRealWorldToProjective<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> pPosition<span class="token punctuation">,</span> <span class="token operator">&amp;</span>project_pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>hand_points_<span class="token punctuation">.</span>find<span class="token punctuation">(</span>xUID<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>second <span class="token operator">=</span> project_pos<span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>hands_track_points_<span class="token punctuation">.</span>find<span class="token punctuation">(</span>xUID<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>project_pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    void COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>HandDestroy<span class="token punctuation">(</span>HandsGenerator <span class="token operator">&amp;</span>rHands<span class="token punctuation">,</span> XnUserID xUID<span class="token punctuation">,</span> XnFloat fTime<span class="token punctuation">,</span> void <span class="token operator">*</span>pCookie<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        COpenNI <span class="token operator">*</span>openni <span class="token operator">=</span> <span class="token punctuation">(</span>COpenNI<span class="token operator">*</span><span class="token punctuation">)</span>pCookie<span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>hand_points_<span class="token punctuation">.</span>erase<span class="token punctuation">(</span>openni<span class="token operator">-</span><span class="token operator">&gt;</span>hand_points_<span class="token punctuation">.</span>find<span class="token punctuation">(</span>xUID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>hands_track_points_<span class="token punctuation">.</span>erase<span class="token punctuation">(</span>openni<span class="token operator">-</span><span class="token operator">&gt;</span>hands_track_points_<span class="token punctuation">.</span>find<span class="token punctuation">(</span>xUID <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>



</code></pre> 
<h2><a id="3__591"></a>3 深度学习方法做手势识别</h2> 
<h3><a id="31__593"></a>3.1 经典的卷积神经网络</h3> 
<p>卷积神经网络的优势就在于它能够从常见的视觉任务中自动学习目 标数据的特征， 然后将这些特征用于某种特定任务的模型。 随着时代的发展，<br> 深度学习也形成了一些经典的卷积神经网络。</p> 
<h3><a id="32_YOLO_598"></a>3.2 YOLO系列</h3> 
<p>YOLO 系列的网络模型最早源于 2016 年， 之后几年经过不断改进相继推出YOLOv2、 YOLOv3<br> 等网络，直到今日yoloV5也诞生了，不得不感慨一句，darknet是真的肝。</p> 
<p>最具代表性的yolov3的结构</p> 
<p><img src="https://images2.imgbox.com/fe/4c/wKpm6mcc_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="33_SSD_607"></a>3.3 SSD</h3> 
<p>SSD 作为典型的一阶段网络模型， 具有更高的操作性， 端到端的学习模式同样受到众多研究者的喜爱</p> 
<p><img src="https://images2.imgbox.com/65/e1/eoAwgdx2_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="34__613"></a>3.4 实现步骤</h3> 
<h4><a id="341__615"></a>3.4.1 数据集</h4> 
<p>手势识别的数据集来自于丹成学长实验室，由于中国手势表示3的手势根据地区有略微差异，按照这个数据集的手势训练与测试即可。</p> 
<ul><li>图像大小：100*100 像素</li><li>颜色空间：RGB 种类：</li><li>图片种类：6 种(0,1,2,3,4,5)</li><li>每种图片数量：200 张</li></ul> 
<p><strong>一共6种手势，每种手势200张图片，共1200张图片（100x100RGB）</strong></p> 
<p><img src="https://images2.imgbox.com/07/4d/De9xIaKF_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="342__628"></a>3.4.2 图像预处理</h4> 
<p><img src="https://images2.imgbox.com/9e/03/rYDLfXa0_o.png" alt="在这里插入图片描述"></p> 
<p><strong>实际图片处理展示：resize前先高斯模糊，提取边缘后可以根据实际需要增加一次中值滤波去噪：</strong></p> 
<p><img src="https://images2.imgbox.com/ad/ef/WvMyLuPa_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="343__636"></a>3.4.3 构建卷积神经网络结构</h4> 
<p><strong>使用tensorflow的框架，构建一个简单的网络结构</strong></p> 
<p><img src="https://images2.imgbox.com/6b/77/aaqwgUsH_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/4e/b0/WtJX5jxi_o.png" alt="在这里插入图片描述"></p> 
<p><strong>Dropout： 增加鲁棒性帮助正则化和避免过拟合</strong></p> 
<p>一个相关的早期使用这种技术的论文（（ImageNet Classification with Deep Convolutional Neural<br> Networks, by Alex Krizhevsky, Ilya Sutskever, and Geoffrey Hinton<br> (2012).））中启发性的dropout解释是:</p> 
<p>因为一个神经元不能依赖其他特定的神经元。因此，不得不去学习随机子集神经元间的鲁棒性的有用连接。换句话说。想象我们的神经元作为要给预测的模型，dropout是一种方式可以确保我们的模型在丢失一个个体线索的情况下保持健壮的模型。在这种情况下，可以说他的作用和L1和L2范式正则化是相同的。都是来减少权重连接，然后增加网络模型在缺失个体连接信息情况下的鲁棒性。在提高神经网络表现方面效果较好。</p> 
<h4><a id="344__652"></a>3.4.4 实验训练过程及结果</h4> 
<p>经过约4800轮的训练后，loss基本收敛，在0.6左右，在120份的测试样本上的模型准确率能够达到约96%</p> 
<p><img src="https://images2.imgbox.com/19/78/PS5CWqEX_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/bf/10/IVD2wxac_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="35__660"></a>3.5 关键代码</h3> 
<p>​</p> 
<pre><code class="prism language-python">
    <span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
    IMAGE_SIZE <span class="token operator">=</span> <span class="token number">100</span>
    NUM_CHANNELS <span class="token operator">=</span> <span class="token number">1</span>
    CONV1_SIZE <span class="token operator">=</span> <span class="token number">4</span>
    CONV1_KERNEL_NUM <span class="token operator">=</span> <span class="token number">8</span>
    CONV2_SIZE <span class="token operator">=</span> <span class="token number">2</span>
    CONV2_KERNEL_NUM <span class="token operator">=</span> <span class="token number">16</span>
    FC_SIZE <span class="token operator">=</span> <span class="token number">512</span>
    OUTPUT_NODE <span class="token operator">=</span> <span class="token number">6</span>
    
    <span class="token keyword">def</span> <span class="token function">get_weight</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> regularizer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    	w <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>truncated_normal<span class="token punctuation">(</span>shape<span class="token punctuation">,</span>stddev<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    	<span class="token keyword">if</span> regularizer <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span> tf<span class="token punctuation">.</span>add_to_collection<span class="token punctuation">(</span><span class="token string">'losses'</span><span class="token punctuation">,</span> tf<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>l2_regularizer<span class="token punctuation">(</span>regularizer<span class="token punctuation">)</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span> 
    	<span class="token keyword">return</span> w
    
    <span class="token keyword">def</span> <span class="token function">get_bias</span><span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">:</span> 
    	b <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span>  
    	<span class="token keyword">return</span> b
    
    <span class="token keyword">def</span> <span class="token function">conv2d</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    	<span class="token keyword">return</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>x<span class="token punctuation">,</span> w<span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'SAME'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">max_pool_8x8</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    	<span class="token keyword">return</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>max_pool<span class="token punctuation">(</span>x<span class="token punctuation">,</span> ksize<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'SAME'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">max_pool_4x4</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    	<span class="token keyword">return</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>max_pool<span class="token punctuation">(</span>x<span class="token punctuation">,</span> ksize<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'SAME'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> train<span class="token punctuation">,</span> regularizer<span class="token punctuation">)</span><span class="token punctuation">:</span>
        
        conv1_w <span class="token operator">=</span> get_weight<span class="token punctuation">(</span><span class="token punctuation">[</span>CONV1_SIZE<span class="token punctuation">,</span> CONV1_SIZE<span class="token punctuation">,</span> NUM_CHANNELS<span class="token punctuation">,</span> CONV1_KERNEL_NUM<span class="token punctuation">]</span><span class="token punctuation">,</span> regularizer<span class="token punctuation">)</span> 
        conv1_b <span class="token operator">=</span> get_bias<span class="token punctuation">(</span><span class="token punctuation">[</span>CONV1_KERNEL_NUM<span class="token punctuation">]</span><span class="token punctuation">)</span> 
        conv1 <span class="token operator">=</span> conv2d<span class="token punctuation">(</span>x<span class="token punctuation">,</span> conv1_w<span class="token punctuation">)</span> 
        relu1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>bias_add<span class="token punctuation">(</span>conv1<span class="token punctuation">,</span> conv1_b<span class="token punctuation">)</span><span class="token punctuation">)</span> 
        pool1 <span class="token operator">=</span> max_pool_8x8<span class="token punctuation">(</span>relu1<span class="token punctuation">)</span> 
    
        conv2_w <span class="token operator">=</span> get_weight<span class="token punctuation">(</span><span class="token punctuation">[</span>CONV2_SIZE<span class="token punctuation">,</span> CONV2_SIZE<span class="token punctuation">,</span> CONV1_KERNEL_NUM<span class="token punctuation">,</span> CONV2_KERNEL_NUM<span class="token punctuation">]</span><span class="token punctuation">,</span>regularizer<span class="token punctuation">)</span> 
        conv2_b <span class="token operator">=</span> get_bias<span class="token punctuation">(</span><span class="token punctuation">[</span>CONV2_KERNEL_NUM<span class="token punctuation">]</span><span class="token punctuation">)</span>
        conv2 <span class="token operator">=</span> conv2d<span class="token punctuation">(</span>pool1<span class="token punctuation">,</span> conv2_w<span class="token punctuation">)</span> 
        relu2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>bias_add<span class="token punctuation">(</span>conv2<span class="token punctuation">,</span> conv2_b<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pool2 <span class="token operator">=</span> max_pool_4x4<span class="token punctuation">(</span>relu2<span class="token punctuation">)</span>
    
        pool_shape <span class="token operator">=</span> pool2<span class="token punctuation">.</span>get_shape<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>as_list<span class="token punctuation">(</span><span class="token punctuation">)</span> 
        nodes <span class="token operator">=</span> pool_shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> pool_shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> pool_shape<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> 
        reshaped <span class="token operator">=</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>pool2<span class="token punctuation">,</span> <span class="token punctuation">[</span>pool_shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> nodes<span class="token punctuation">]</span><span class="token punctuation">)</span> 
    
        fc1_w <span class="token operator">=</span> get_weight<span class="token punctuation">(</span><span class="token punctuation">[</span>nodes<span class="token punctuation">,</span> FC_SIZE<span class="token punctuation">]</span><span class="token punctuation">,</span> regularizer<span class="token punctuation">)</span> 
        fc1_b <span class="token operator">=</span> get_bias<span class="token punctuation">(</span><span class="token punctuation">[</span>FC_SIZE<span class="token punctuation">]</span><span class="token punctuation">)</span> 
        fc1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>reshaped<span class="token punctuation">,</span> fc1_w<span class="token punctuation">)</span> <span class="token operator">+</span> fc1_b<span class="token punctuation">)</span> 
        <span class="token keyword">if</span> train<span class="token punctuation">:</span> fc1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>fc1<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
    
        fc2_w <span class="token operator">=</span> get_weight<span class="token punctuation">(</span><span class="token punctuation">[</span>FC_SIZE<span class="token punctuation">,</span> OUTPUT_NODE<span class="token punctuation">]</span><span class="token punctuation">,</span> regularizer<span class="token punctuation">)</span>
        fc2_b <span class="token operator">=</span> get_bias<span class="token punctuation">(</span><span class="token punctuation">[</span>OUTPUT_NODE<span class="token punctuation">]</span><span class="token punctuation">)</span>
        y <span class="token operator">=</span> tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>fc1<span class="token punctuation">,</span> fc2_w<span class="token punctuation">)</span> <span class="token operator">+</span> fc2_b
        <span class="token keyword">return</span> y 


    <span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
    <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
    <span class="token keyword">import</span> gesture_forward
    <span class="token keyword">import</span> gesture_backward
    <span class="token keyword">from</span> image_processing <span class="token keyword">import</span> func5<span class="token punctuation">,</span>func6
    <span class="token keyword">import</span> cv2
    
    <span class="token keyword">def</span> <span class="token function">restore_model</span><span class="token punctuation">(</span>testPicArr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> tf<span class="token punctuation">.</span>Graph<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>as_default<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tg<span class="token punctuation">:</span>
            
            x <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span><span class="token punctuation">[</span>
                <span class="token number">1</span><span class="token punctuation">,</span>
                gesture_forward<span class="token punctuation">.</span>IMAGE_SIZE<span class="token punctuation">,</span>
                gesture_forward<span class="token punctuation">.</span>IMAGE_SIZE<span class="token punctuation">,</span>
                gesture_forward<span class="token punctuation">.</span>NUM_CHANNELS<span class="token punctuation">]</span><span class="token punctuation">)</span>    
            <span class="token comment">#y_ = tf.placeholder(tf.float32, [None, mnist_lenet5_forward.OUTPUT_NODE])</span>
            y <span class="token operator">=</span> gesture_forward<span class="token punctuation">.</span>forward<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span>
            
            preValue <span class="token operator">=</span> tf<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    
            variable_averages <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>ExponentialMovingAverage<span class="token punctuation">(</span>gesture_backward<span class="token punctuation">.</span>MOVING_AVERAGE_DECAY<span class="token punctuation">)</span>
            variables_to_restore <span class="token operator">=</span> variable_averages<span class="token punctuation">.</span>variables_to_restore<span class="token punctuation">(</span><span class="token punctuation">)</span>
            saver <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Saver<span class="token punctuation">(</span>variables_to_restore<span class="token punctuation">)</span>
            
            <span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
                ckpt <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>get_checkpoint_state<span class="token punctuation">(</span>gesture_backward<span class="token punctuation">.</span>MODEL_SAVE_PATH<span class="token punctuation">)</span>
                <span class="token keyword">if</span> ckpt <span class="token keyword">and</span> ckpt<span class="token punctuation">.</span>model_checkpoint_path<span class="token punctuation">:</span>
                    saver<span class="token punctuation">.</span>restore<span class="token punctuation">(</span>sess<span class="token punctuation">,</span> ckpt<span class="token punctuation">.</span>model_checkpoint_path<span class="token punctuation">)</span>
                    <span class="token comment">#global_step = ckpt.model_checkpoint_path.split('/')[-1].split('-')[-1] </span>
                    preValue <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>preValue<span class="token punctuation">,</span> feed_dict<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">:</span>testPicArr<span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> preValue
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"No checkpoint file found"</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>


    <span class="token keyword">def</span> <span class="token function">application01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        testNum <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"input the number of test pictures:"</span><span class="token punctuation">)</span>
        testNum <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>testNum<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>testNum<span class="token punctuation">)</span><span class="token punctuation">:</span>
            testPic <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"the path of test picture:"</span><span class="token punctuation">)</span>
            img <span class="token operator">=</span> func5<span class="token punctuation">(</span>testPic<span class="token punctuation">)</span>
            cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'ttt.jpg'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>   
    <span class="token comment">#        cv2.waitKey(0)</span>
    <span class="token comment">#        cv2.destroyAllWindows()</span>
            img <span class="token operator">=</span> img<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            img <span class="token operator">=</span> img<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
            img <span class="token operator">=</span> np<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">)</span>
    <span class="token comment">#        print(img.shape)</span>
    <span class="token comment">#        print(type(img))        </span>
            preValue <span class="token operator">=</span> restore_model<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
            <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"The prediction number is:"</span><span class="token punctuation">,</span> preValue<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">application02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        
        <span class="token comment">#vc = cv2.VideoCapture('testVideo.mp4')</span>
        vc <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment"># 设置每秒传输帧数</span>
        fps <span class="token operator">=</span> vc<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FPS<span class="token punctuation">)</span>
        <span class="token comment"># 获取视频的大小</span>
        size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>vc<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_WIDTH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>vc<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 生成一个空的视频文件</span>
        <span class="token comment"># 视频编码类型</span>
        <span class="token comment"># cv2.VideoWriter_fourcc('X','V','I','D') MPEG-4 编码类型</span>
        <span class="token comment"># cv2.VideoWriter_fourcc('I','4','2','0') YUY编码类型</span>
        <span class="token comment"># cv2.VideoWriter_fourcc('P','I','M','I') MPEG-1 编码类型</span>
        <span class="token comment"># cv2.VideoWriter_fourcc('T','H','E','O') Ogg Vorbis类型，文件名为.ogv</span>
        <span class="token comment"># cv2.VideoWriter_fourcc('F','L','V','1') Flask视频，文件名为.flv</span>
        <span class="token comment">#vw = cv2.VideoWriter('ges_pro.avi',cv2.VideoWriter_fourcc('X','V','I','D'), fps, size)</span>
        <span class="token comment"># 读取视频第一帧的内容</span>
        success<span class="token punctuation">,</span> frame <span class="token operator">=</span> vc<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#    rows = frame.shape[0]    </span>
    <span class="token comment">#    cols = frame.shape[1]</span>
    <span class="token comment">#    t1 = int((cols-rows)/2)</span>
    <span class="token comment">#    t2 = int(cols-t1)</span>
    <span class="token comment">#    M = cv2.getRotationMatrix2D((cols/2,rows/2),90,1)</span>
    <span class="token comment">#    frame = cv2.warpAffine(frame,M,(cols,rows))</span>
    <span class="token comment">#    frame = frame[0:rows, t1:t2]</span>
    <span class="token comment">#    cv2.imshow('sd',frame)</span>
    <span class="token comment">#    cv2.waitKey(0)</span>
    <span class="token comment">#    cv2.destroyAllWindows()</span>
        <span class="token keyword">while</span> success<span class="token punctuation">:</span>
            
            <span class="token comment">#90度旋转        </span>
    <span class="token comment">#        img = cv2.warpAffine(frame,M,(cols,rows))</span>
    <span class="token comment">#        img = img[0:rows, t1:t2]</span>
            img <span class="token operator">=</span> func6<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
            img <span class="token operator">=</span> img<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            img <span class="token operator">=</span> img<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
            img <span class="token operator">=</span> np<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">)</span>
            preValue <span class="token operator">=</span> restore_model<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
            <span class="token comment"># 写入视频</span>
            cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span><span class="token string">"Gesture:"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>preValue<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>FONT_HERSHEY_PLAIN<span class="token punctuation">,</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token comment">#vw.write(frame)</span>
            cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'gesture'</span><span class="token punctuation">,</span>frame<span class="token punctuation">)</span>
            <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            <span class="token comment"># 读取视频下一帧的内容</span>
            success<span class="token punctuation">,</span> frame <span class="token operator">=</span> vc<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        vc<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>    
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'viedo app over!'</span><span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#application01()</span>
        application02<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
    <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    	main<span class="token punctuation">(</span><span class="token punctuation">)</span>	


</code></pre> 
<h2><a id="4__840"></a>4 最后</h2> 
<p>🧿 <strong>更多资料, 项目分享：</strong></p> 
<p><a href="https://gitee.com/dancheng-senior/postgraduate" rel="nofollow">https://gitee.com/dancheng-senior/postgraduate</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/879972b236d4c6ccf0526728e7ff1bb6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">发现传统之美，AI赋能非遗传承</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4919e40190b1d34a5eaafa950559c1c7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Stable Diffusion【应用篇】【艺术写真】：AI写真看过来，使用IP-Adapter-FaceId插件实现AI写真</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>