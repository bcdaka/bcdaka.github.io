<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>å¤§åˆ›é¡¹ç›®æ¨è é¢˜ç›®ï¼šåŸºäºæœºå™¨è§†è§‰opencvçš„æ‰‹åŠ¿æ£€æµ‹ æ‰‹åŠ¿è¯†åˆ« ç®—æ³• - æ·±åº¦å­¦ä¹  å·ç§¯ç¥ç»ç½‘ç»œ opencv python - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/250dbe94d35f03d89959e672f8d2cdc2/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="å¤§åˆ›é¡¹ç›®æ¨è é¢˜ç›®ï¼šåŸºäºæœºå™¨è§†è§‰opencvçš„æ‰‹åŠ¿æ£€æµ‹ æ‰‹åŠ¿è¯†åˆ« ç®—æ³• - æ·±åº¦å­¦ä¹  å·ç§¯ç¥ç»ç½‘ç»œ opencv python">
  <meta property="og:description" content="æ–‡ç« ç›®å½• 1 ç®€ä»‹2 ä¼ ç»Ÿæœºå™¨è§†è§‰çš„æ‰‹åŠ¿æ£€æµ‹2.1 è½®å»“æ£€æµ‹æ³•2.2 ç®—æ³•ç»“æœ2.3 æ•´ä½“ä»£ç å®ç°2.3.1 ç®—æ³•æµç¨‹ 3 æ·±åº¦å­¦ä¹ æ–¹æ³•åšæ‰‹åŠ¿è¯†åˆ«3.1 ç»å…¸çš„å·ç§¯ç¥ç»ç½‘ç»œ3.2 YOLOç³»åˆ—3.3 SSD3.4 å®ç°æ­¥éª¤3.4.1 æ•°æ®é›†3.4.2 å›¾åƒé¢„å¤„ç†3.4.3 æ„å»ºå·ç§¯ç¥ç»ç½‘ç»œç»“æ„3.4.4 å®éªŒè®­ç»ƒè¿‡ç¨‹åŠç»“æœ 3.5 å…³é”®ä»£ç  4 æœ€å 1 ç®€ä»‹ ğŸ”¥ ä¼˜è´¨ç«èµ›é¡¹ç›®ç³»åˆ—ï¼Œä»Šå¤©è¦åˆ†äº«çš„æ˜¯
åŸºäºæœºå™¨è§†è§‰opencvçš„æ‰‹åŠ¿æ£€æµ‹ æ‰‹åŠ¿è¯†åˆ« ç®—æ³•
è¯¥é¡¹ç›®è¾ƒä¸ºæ–°é¢–ï¼Œé€‚åˆä½œä¸ºç«èµ›è¯¾é¢˜æ–¹å‘ï¼Œå­¦é•¿éå¸¸æ¨èï¼
ğŸ§¿ æ›´å¤šèµ„æ–™, é¡¹ç›®åˆ†äº«ï¼š
https://gitee.com/dancheng-senior/postgraduate
2 ä¼ ç»Ÿæœºå™¨è§†è§‰çš„æ‰‹åŠ¿æ£€æµ‹ æ™®é€šæœºå™¨è§†è§‰æ‰‹åŠ¿æ£€æµ‹çš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š
å…¶ä¸­è½®å»“çš„æå–ï¼Œå¤šè¾¹å½¢æ‹Ÿåˆæ›²çº¿çš„æ±‚æ³•ï¼Œå‡¸åŒ…é›†å’Œå‡¹é™·é›†çš„æ±‚æ³•éƒ½æ˜¯é‡‡ç”¨opencvä¸­è‡ªå¸¦çš„å‡½æ•°ã€‚æ‰‹åŠ¿æ•°å­—çš„è¯†åˆ«æ˜¯åˆ©ç”¨å‡¸åŒ…ç‚¹ä»¥åŠå‡¹é™·ç‚¹å’Œæ‰‹éƒ¨ä¸­å¿ƒç‚¹çš„å‡ ä½•å…³ç³»ï¼Œç®€å•çš„åšäº†ä¸‹é€»è¾‘åˆ¤åˆ«äº†ï¼ˆå¯ä»¥è‚¯å®šçš„æ˜¯è¿™ç§æ–¹æ³•å¾ˆçƒ‚ï¼‰ï¼Œå…·ä½“çš„åšæ³•æ˜¯å…ˆåœ¨æ‰‹éƒ¨å®šä½å‡º2ä¸ªä¸­å¿ƒç‚¹åæ ‡ï¼Œè¿™2ä¸ªä¸­å¿ƒç‚¹åæ ‡ä¹‹é—´çš„è·ç¦»é˜ˆå€¼ç”±ç¨‹åºè®¾å®šï¼Œå…¶ä¸­ä¸€ä¸ªä¸­å¿ƒç‚¹å°±æ˜¯åˆ©ç”¨OpenNIè·Ÿè¸ªå¾—åˆ°çš„æ‰‹éƒ¨ä½ç½®ã€‚æœ‰äº†è¿™2ä¸ªä¸­å¿ƒç‚¹çš„åæ ‡ï¼Œåœ¨ç¨‹åºä¸­å°±å¯ä»¥åˆ†åˆ«è®¡ç®—å‡ºåœ¨è¿™2ä¸ªä¸­å¿ƒç‚¹åæ ‡ä¸Šçš„å‡¸å‡¹ç‚¹çš„ä¸ªæ•°ã€‚å½“ç„¶äº†ï¼Œè¿™æ ·åšçš„å‰ææ˜¯ç”¨äººåœ¨åšæ‰‹åŠ¿è¡¨ç¤ºæ•°å­—çš„åŒæ—¶åº”è¯¥æ˜¯å°†æ‰‹æŒ‡çš„æ–¹å‘æœä¸Šï¼ˆå› ä¸ºæ²¡æœ‰åƒæœºå™¨å­¦ä¹ é‚£æ ·é€šè¿‡æ ·æœ¬æ¥è®­ç»ƒï¼Œæ‰€ä»¥ä½¿ç”¨æ—¶æ¡ä»¶è¦è‹›åˆ»å¾ˆå¤šï¼‰ã€‚åˆ©ç”¨ä¸Šé¢æ±‚å‡ºçš„4ç§ç‚¹çš„ä¸ªæ•°(å¦å¤–ç¨‹åºä¸­è¿˜è®¾ç½®äº†2ä¸ªè¾…åŠ©è®¡ç®—ç‚¹çš„ä¸ªæ•°ï¼Œå…·ä½“è§ä»£ç éƒ¨åˆ†)å’Œç®€å•çš„é€»è¾‘åˆ¤æ–­å°±å¯ä»¥è¯†åˆ«å‡ºæ•°å­—0~5äº†ã€‚å…¶å®ƒçš„æ•°å­—å¯ä»¥ä¾ç…§å…·ä½“çš„é€»è¾‘å»è®¾è®¡ï¼ˆè¿˜å¯ä»¥è®¾è®¡å‡ºå¤šä½æ•°å­—çš„è¯†åˆ«ï¼‰ï¼Œåªæ˜¯æ•°å­—è¶Šå¤šè®¾è®¡èµ·æ¥è¶Šå¤æ‚ï¼Œå› ä¸ºè¦è€ƒè™‘åˆ°å®ƒä»¬ä¹‹é—´çš„å¹²æ‰°æ€§ï¼Œä¸”è¿™ç§ä¸é€šç”¨çš„è®¾è®¡æ–¹æ³•ä¹Ÿæ²¡æœ‰å¤ªå¤šçš„å®é™…æ„ä¹‰ã€‚
2.1 è½®å»“æ£€æµ‹æ³• ä½¿ç”¨ void convexityDefects(InputArray contour, InputArray convexhull,
OutputArray convexityDefects) æ–¹æ³•
è¯¥å‡½æ•°çš„ä½œç”¨æ˜¯å¯¹è¾“å…¥çš„è½®å»“contourï¼Œå‡¸åŒ…é›†åˆæ¥æ£€æµ‹å…¶è½®å»“çš„å‡¸å‹ç¼ºé™·ï¼Œä¸€ä¸ªå‡¸å‹ç¼ºé™·ç»“æ„ä½“åŒ…æ‹¬4ä¸ªå…ƒç´ ï¼Œç¼ºé™·èµ·ç‚¹åæ ‡ï¼Œç¼ºé™·ç»ˆç‚¹åæ ‡ï¼Œç¼ºé™·ä¸­ç¦»å‡¸åŒ…çº¿è·ç¦»æœ€è¿œçš„ç‚¹çš„åæ ‡ï¼Œä»¥åŠæ­¤æ—¶æœ€è¿œçš„è·ç¦»ã€‚å‚æ•°3å³å…¶è¾“å‡ºçš„å‡¸å‹ç¼ºé™·ç»“æ„ä½“å‘é‡ã€‚
å…¶å‡¸å‹ç¼ºé™·çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š
ç¬¬1ä¸ªå‚æ•°è™½ç„¶å†™çš„æ˜¯contourï¼Œå­—é¢æ„æ€æ˜¯è½®å»“ï¼Œä½†æ˜¯æœ¬äººå®éªŒè¿‡å¾ˆå¤šæ¬¡ï¼Œå‘ç°å¦‚æœè¯¥å‚æ•°ä¸ºç›®æ ‡é€šè¿‡è½®å»“æ£€æµ‹å¾—åˆ°çš„åŸå§‹è½®å»“çš„è¯ï¼Œåˆ™ç¨‹åºè¿è¡Œåˆ°onvexityDefects()å‡½æ•°æ—¶ä¼šæŠ¥å†…å­˜é”™è¯¯ã€‚å› æ­¤æœ¬ç¨‹åºä¸­é‡‡ç”¨çš„ä¸æ˜¯ç‰©ä½“åŸå§‹çš„è½®å»“ï¼Œè€Œæ˜¯ç»è¿‡å¤šé¡¹å¼æ›²çº¿æ‹Ÿåˆåçš„è½®å»“ï¼Œå³å¤šé¡¹å¼æ›²çº¿ï¼Œè¿™æ ·ç¨‹åºå°±ä¼šé¡ºåˆ©åœ°è¿è¡Œå¾—å¾ˆå¥½ã€‚å¦å¤–ç”±äºåœ¨æ‰‹åŠ¿è¯†åˆ«è¿‡ç¨‹ä¸­å¯èƒ½æŸä¸€å¸§æ£€æµ‹å‡ºæ¥çš„è½®å»“éå¸¸å°ï¼ˆç”±äºæŸç§åŸå› ï¼‰ï¼Œä»¥è‡´äºå°‘åˆ°åªæœ‰1ä¸ªç‚¹ï¼Œè¿™æ—¶å€™å¦‚æœç¨‹åºè¿è¡Œåˆ°onvexityDefects()å‡½æ•°æ—¶å°±ä¼šæŠ¥å¦‚ä¸‹çš„é”™è¯¯ï¼š
â€‹
int Mat::checkVector(int _elemChannels, int _depth, bool _requireContinuous) const { return (depth() == _depth || _depth &lt;= 0) &amp;&amp; (isContinuous() || !">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-29T10:12:04+08:00">
    <meta property="article:modified_time" content="2024-06-29T10:12:04+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">å¤§åˆ›é¡¹ç›®æ¨è é¢˜ç›®ï¼šåŸºäºæœºå™¨è§†è§‰opencvçš„æ‰‹åŠ¿æ£€æµ‹ æ‰‹åŠ¿è¯†åˆ« ç®—æ³• - æ·±åº¦å­¦ä¹  å·ç§¯ç¥ç»ç½‘ç»œ opencv python</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>æ–‡ç« ç›®å½•</h4> 
 <ul><li><a href="#1__3" rel="nofollow">1 ç®€ä»‹</a></li><li><a href="#2__18" rel="nofollow">2 ä¼ ç»Ÿæœºå™¨è§†è§‰çš„æ‰‹åŠ¿æ£€æµ‹</a></li><li><ul><li><a href="#21__25" rel="nofollow">2.1 è½®å»“æ£€æµ‹æ³•</a></li><li><a href="#22__70" rel="nofollow">2.2 ç®—æ³•ç»“æœ</a></li><li><a href="#23__90" rel="nofollow">2.3 æ•´ä½“ä»£ç å®ç°</a></li><li><ul><li><a href="#231__92" rel="nofollow">2.3.1 ç®—æ³•æµç¨‹</a></li></ul> 
  </li></ul> 
  </li><li><a href="#3__591" rel="nofollow">3 æ·±åº¦å­¦ä¹ æ–¹æ³•åšæ‰‹åŠ¿è¯†åˆ«</a></li><li><ul><li><a href="#31__593" rel="nofollow">3.1 ç»å…¸çš„å·ç§¯ç¥ç»ç½‘ç»œ</a></li><li><a href="#32_YOLO_598" rel="nofollow">3.2 YOLOç³»åˆ—</a></li><li><a href="#33_SSD_607" rel="nofollow">3.3 SSD</a></li><li><a href="#34__613" rel="nofollow">3.4 å®ç°æ­¥éª¤</a></li><li><ul><li><a href="#341__615" rel="nofollow">3.4.1 æ•°æ®é›†</a></li><li><a href="#342__628" rel="nofollow">3.4.2 å›¾åƒé¢„å¤„ç†</a></li><li><a href="#343__636" rel="nofollow">3.4.3 æ„å»ºå·ç§¯ç¥ç»ç½‘ç»œç»“æ„</a></li><li><a href="#344__652" rel="nofollow">3.4.4 å®éªŒè®­ç»ƒè¿‡ç¨‹åŠç»“æœ</a></li></ul> 
   </li><li><a href="#35__660" rel="nofollow">3.5 å…³é”®ä»£ç </a></li></ul> 
  </li><li><a href="#4__840" rel="nofollow">4 æœ€å</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1__3"></a>1 ç®€ä»‹</h2> 
<p>ğŸ”¥ ä¼˜è´¨ç«èµ›é¡¹ç›®ç³»åˆ—ï¼Œä»Šå¤©è¦åˆ†äº«çš„æ˜¯</p> 
<p><strong>åŸºäºæœºå™¨è§†è§‰opencvçš„æ‰‹åŠ¿æ£€æµ‹ æ‰‹åŠ¿è¯†åˆ« ç®—æ³•</strong></p> 
<p>è¯¥é¡¹ç›®è¾ƒä¸ºæ–°é¢–ï¼Œé€‚åˆä½œä¸ºç«èµ›è¯¾é¢˜æ–¹å‘ï¼Œå­¦é•¿éå¸¸æ¨èï¼</p> 
<p>ğŸ§¿ <strong>æ›´å¤šèµ„æ–™, é¡¹ç›®åˆ†äº«ï¼š</strong></p> 
<p><a href="https://gitee.com/dancheng-senior/postgraduate" rel="nofollow">https://gitee.com/dancheng-senior/postgraduate</a></p> 
<h2><a id="2__18"></a>2 ä¼ ç»Ÿæœºå™¨è§†è§‰çš„æ‰‹åŠ¿æ£€æµ‹</h2> 
<p>æ™®é€šæœºå™¨è§†è§‰æ‰‹åŠ¿æ£€æµ‹çš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š</p> 
<p><img src="https://images2.imgbox.com/b4/0d/gYeKhvBV_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> å…¶ä¸­è½®å»“çš„æå–ï¼Œå¤šè¾¹å½¢æ‹Ÿåˆæ›²çº¿çš„æ±‚æ³•ï¼Œå‡¸åŒ…é›†å’Œå‡¹é™·é›†çš„æ±‚æ³•éƒ½æ˜¯é‡‡ç”¨opencvä¸­è‡ªå¸¦çš„å‡½æ•°ã€‚æ‰‹åŠ¿æ•°å­—çš„è¯†åˆ«æ˜¯åˆ©ç”¨å‡¸åŒ…ç‚¹ä»¥åŠå‡¹é™·ç‚¹å’Œæ‰‹éƒ¨ä¸­å¿ƒç‚¹çš„å‡ ä½•å…³ç³»ï¼Œç®€å•çš„åšäº†ä¸‹é€»è¾‘åˆ¤åˆ«äº†ï¼ˆå¯ä»¥è‚¯å®šçš„æ˜¯è¿™ç§æ–¹æ³•å¾ˆçƒ‚ï¼‰ï¼Œå…·ä½“çš„åšæ³•æ˜¯å…ˆåœ¨æ‰‹éƒ¨å®šä½å‡º2ä¸ªä¸­å¿ƒç‚¹åæ ‡ï¼Œè¿™2ä¸ªä¸­å¿ƒç‚¹åæ ‡ä¹‹é—´çš„è·ç¦»é˜ˆå€¼ç”±ç¨‹åºè®¾å®šï¼Œå…¶ä¸­ä¸€ä¸ªä¸­å¿ƒç‚¹å°±æ˜¯åˆ©ç”¨OpenNIè·Ÿè¸ªå¾—åˆ°çš„æ‰‹éƒ¨ä½ç½®ã€‚æœ‰äº†è¿™2ä¸ªä¸­å¿ƒç‚¹çš„åæ ‡ï¼Œåœ¨ç¨‹åºä¸­å°±å¯ä»¥åˆ†åˆ«è®¡ç®—å‡ºåœ¨è¿™2ä¸ªä¸­å¿ƒç‚¹åæ ‡ä¸Šçš„å‡¸å‡¹ç‚¹çš„ä¸ªæ•°ã€‚å½“ç„¶äº†ï¼Œè¿™æ ·åšçš„å‰ææ˜¯ç”¨äººåœ¨åšæ‰‹åŠ¿è¡¨ç¤ºæ•°å­—çš„åŒæ—¶åº”è¯¥æ˜¯å°†æ‰‹æŒ‡çš„æ–¹å‘æœä¸Šï¼ˆå› ä¸ºæ²¡æœ‰åƒæœºå™¨å­¦ä¹ é‚£æ ·é€šè¿‡æ ·æœ¬æ¥è®­ç»ƒï¼Œæ‰€ä»¥ä½¿ç”¨æ—¶æ¡ä»¶è¦è‹›åˆ»å¾ˆå¤šï¼‰ã€‚åˆ©ç”¨ä¸Šé¢æ±‚å‡ºçš„4ç§ç‚¹çš„ä¸ªæ•°(å¦å¤–ç¨‹åºä¸­è¿˜è®¾ç½®äº†2ä¸ªè¾…åŠ©è®¡ç®—ç‚¹çš„ä¸ªæ•°ï¼Œå…·ä½“è§ä»£ç éƒ¨åˆ†)å’Œç®€å•çš„é€»è¾‘åˆ¤æ–­å°±å¯ä»¥è¯†åˆ«å‡ºæ•°å­—0~5äº†ã€‚å…¶å®ƒçš„æ•°å­—å¯ä»¥ä¾ç…§å…·ä½“çš„é€»è¾‘å»è®¾è®¡ï¼ˆè¿˜å¯ä»¥è®¾è®¡å‡ºå¤šä½æ•°å­—çš„è¯†åˆ«ï¼‰ï¼Œåªæ˜¯æ•°å­—è¶Šå¤šè®¾è®¡èµ·æ¥è¶Šå¤æ‚ï¼Œå› ä¸ºè¦è€ƒè™‘åˆ°å®ƒä»¬ä¹‹é—´çš„å¹²æ‰°æ€§ï¼Œä¸”è¿™ç§ä¸é€šç”¨çš„è®¾è®¡æ–¹æ³•ä¹Ÿæ²¡æœ‰å¤ªå¤šçš„å®é™…æ„ä¹‰ã€‚</p> 
<h3><a id="21__25"></a>2.1 è½®å»“æ£€æµ‹æ³•</h3> 
<p>ä½¿ç”¨ void convexityDefects(InputArray contour, InputArray convexhull,<br> OutputArray convexityDefects) æ–¹æ³•</p> 
<p>è¯¥å‡½æ•°çš„ä½œç”¨æ˜¯å¯¹è¾“å…¥çš„è½®å»“contourï¼Œå‡¸åŒ…é›†åˆæ¥æ£€æµ‹å…¶è½®å»“çš„å‡¸å‹ç¼ºé™·ï¼Œä¸€ä¸ªå‡¸å‹ç¼ºé™·ç»“æ„ä½“åŒ…æ‹¬4ä¸ªå…ƒç´ ï¼Œç¼ºé™·èµ·ç‚¹åæ ‡ï¼Œç¼ºé™·ç»ˆç‚¹åæ ‡ï¼Œç¼ºé™·ä¸­ç¦»å‡¸åŒ…çº¿è·ç¦»æœ€è¿œçš„ç‚¹çš„åæ ‡ï¼Œä»¥åŠæ­¤æ—¶æœ€è¿œçš„è·ç¦»ã€‚å‚æ•°3å³å…¶è¾“å‡ºçš„å‡¸å‹ç¼ºé™·ç»“æ„ä½“å‘é‡ã€‚</p> 
<p>å…¶å‡¸å‹ç¼ºé™·çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p> 
<p><img src="https://images2.imgbox.com/0f/8c/klDDgmWq_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> ç¬¬1ä¸ªå‚æ•°è™½ç„¶å†™çš„æ˜¯contourï¼Œå­—é¢æ„æ€æ˜¯è½®å»“ï¼Œä½†æ˜¯æœ¬äººå®éªŒè¿‡å¾ˆå¤šæ¬¡ï¼Œå‘ç°å¦‚æœè¯¥å‚æ•°ä¸ºç›®æ ‡é€šè¿‡è½®å»“æ£€æµ‹å¾—åˆ°çš„åŸå§‹è½®å»“çš„è¯ï¼Œåˆ™ç¨‹åºè¿è¡Œåˆ°onvexityDefects()å‡½æ•°æ—¶ä¼šæŠ¥å†…å­˜é”™è¯¯ã€‚å› æ­¤æœ¬ç¨‹åºä¸­é‡‡ç”¨çš„ä¸æ˜¯ç‰©ä½“åŸå§‹çš„è½®å»“ï¼Œè€Œæ˜¯ç»è¿‡å¤šé¡¹å¼æ›²çº¿æ‹Ÿåˆåçš„è½®å»“ï¼Œå³å¤šé¡¹å¼æ›²çº¿ï¼Œè¿™æ ·ç¨‹åºå°±ä¼šé¡ºåˆ©åœ°è¿è¡Œå¾—å¾ˆå¥½ã€‚å¦å¤–ç”±äºåœ¨æ‰‹åŠ¿è¯†åˆ«è¿‡ç¨‹ä¸­å¯èƒ½æŸä¸€å¸§æ£€æµ‹å‡ºæ¥çš„è½®å»“éå¸¸å°ï¼ˆç”±äºæŸç§åŸå› ï¼‰ï¼Œä»¥è‡´äºå°‘åˆ°åªæœ‰1ä¸ªç‚¹ï¼Œè¿™æ—¶å€™å¦‚æœç¨‹åºè¿è¡Œåˆ°onvexityDefects()å‡½æ•°æ—¶å°±ä¼šæŠ¥å¦‚ä¸‹çš„é”™è¯¯ï¼š</p> 
<p>â€‹</p> 
<pre><code class="prism language-python"><span class="token builtin">int</span> Mat<span class="token punctuation">:</span><span class="token punctuation">:</span>checkVector<span class="token punctuation">(</span><span class="token builtin">int</span> _elemChannels<span class="token punctuation">,</span> <span class="token builtin">int</span> _depth<span class="token punctuation">,</span> <span class="token builtin">bool</span> _requireContinuous<span class="token punctuation">)</span> const

<span class="token punctuation">{<!-- --></span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>depth<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> _depth <span class="token operator">|</span><span class="token operator">|</span> _depth <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>

        <span class="token punctuation">(</span>isContinuous<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">|</span> !_requireContinuous<span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>

        <span class="token punctuation">(</span><span class="token punctuation">(</span>dims <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rows <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span> cols <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> channels<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> _elemChannels<span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token punctuation">(</span>cols <span class="token operator">==</span> _elemChannels<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">|</span>

        <span class="token punctuation">(</span>dims <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> channels<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> size<span class="token punctuation">.</span>p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> _elemChannels <span class="token operator">&amp;</span><span class="token operator">&amp;</span> <span class="token punctuation">(</span>size<span class="token punctuation">.</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">|</span><span class="token operator">|</span> size<span class="token punctuation">.</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>

         <span class="token punctuation">(</span>isContinuous<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">|</span> step<span class="token punctuation">.</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> step<span class="token punctuation">.</span>p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">*</span>size<span class="token punctuation">.</span>p<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    ? <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>total<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span>channels<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">/</span>_elemChannels<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>è¯¥å‡½æ•°æºç å¤§æ¦‚æ„æ€å°±æ˜¯è¯´å¯¹åº”çš„MatçŸ©é˜µå¦‚æœå…¶æ·±åº¦ï¼Œè¿ç»­æ€§ï¼Œé€šé“æ•°ï¼Œè¡Œåˆ—å¼æ»¡è¶³ä¸€å®šæ¡ä»¶çš„è¯å°±è¿”å›Matå…ƒç´ çš„ä¸ªæ•°å’Œå…¶é€šé“æ•°çš„ä¹˜ç§¯ï¼Œå¦åˆ™è¿”å›-1ï¼›è€Œæœ¬æ–‡æ˜¯è¦æ±‚å…¶è¿”å›å€¼å¤§äº3ï¼Œæœ‰å¾—çŸ¥æ­¤å¤„è¾“å…¥å¤šè¾¹å½¢æ›²çº¿(å³å‚æ•°1)çš„é€šé“æ•°ä¸º2ï¼Œæ‰€ä»¥è¿˜éœ€è¦æ±‚å…¶å…ƒç´ çš„ä¸ªæ•°å¤§äº1.5ï¼Œå³å¤§äº2æ‰æ»¡è¶³ptnum</p> 
<blockquote></blockquote> 
<p>3ã€‚ç®€å•çš„è¯´å°±æ˜¯ç”¨convexityDefects()å‡½æ•°æ¥å¯¹å¤šè¾¹å½¢æ›²çº¿è¿›è¡Œå‡¹é™·æ£€æµ‹æ—¶ï¼Œå¿…é¡»è¦æ±‚å‚æ•°1æ›²çº¿æœ¬èº«è‡³å°‘æœ‰2ä¸ªç‚¹(ä¹Ÿä¸çŸ¥é“è¿™æ ·åˆ†æå¯¹ä¸å¯¹)ã€‚å› æ­¤æœ¬äººåœ¨æœ¬æ¬¡ç¨‹åºconvexityDefects()å‡½æ•°å‰åŠ å…¥äº†if(Mat(approx_poly_curve).checkVector(2,<br> CV_32S) &gt; 3)æ¥åˆ¤æ–­ï¼Œåªæœ‰æ»¡è¶³è¯¥ifæ¡ä»¶ï¼Œæ‰ä¼šè¿›è¡Œåé¢çš„å‡¹é™·æ£€æµ‹ã€‚è¿™æ ·ç¨‹åºå°±ä¸ä¼šå†å‡ºç°ç±»ä¼¼çš„bugäº†ã€‚</p> 
<p>ç¬¬2ä¸ªå‚æ•°ä¸€èˆ¬æ˜¯ç”±opencvä¸­çš„å‡½æ•°convexHull()è·å¾—çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¯¥å‚æ•°é‡Œé¢å­˜çš„æ˜¯å‡¸åŒ…é›†åˆä¸­çš„ç‚¹åœ¨å¤šé¡¹å¼æ›²çº¿ç‚¹ä¸­çš„ä½ç½®ç´¢å¼•ï¼Œä¸”è¯¥å‚æ•°ä»¥vectorçš„å½¢å¼å­˜åœ¨ï¼Œå› æ­¤å‚æ•°convexhullä¸­å…¶å…ƒç´ çš„ç±»å‹ä¸ºunsigned<br> intã€‚åœ¨æœ¬æ¬¡å‡¹é™·ç‚¹æ£€æµ‹å‡½æ•°convexityDefects()é‡Œé¢æ ¹æ®æ–‡æ¡£ï¼Œè¦æ±‚è¯¥å‚æ•°ä¸ºMatå‹ã€‚å› æ­¤åœ¨ä½¿ç”¨convexityDefects()çš„å‚æ•°2æ—¶ï¼Œä¸€èˆ¬å°†vectorç›´æ¥è½¬æ¢Matå‹ã€‚</p> 
<p>å‚æ•°3æ˜¯ä¸€ä¸ªå«æœ‰4ä¸ªå…ƒç´ çš„ç»“æ„ä½“çš„é›†åˆï¼Œå¦‚æœåœ¨c++çš„ç‰ˆæœ¬ä¸­ï¼Œè¯¥å‚æ•°å¯ä»¥ç›´æ¥ç”¨vectoræ¥ä»£æ›¿ï¼ŒVec4iä¸­çš„4ä¸ªå…ƒç´ åˆ†åˆ«è¡¨ç¤ºå‡¹é™·æ›²çº¿æ®µçš„èµ·å§‹åæ ‡ç´¢å¼•ï¼Œç»ˆç‚¹åæ ‡ç´¢å¼•ï¼Œç¦»å‡¸åŒ…é›†æ›²çº¿æœ€è¿œç‚¹çš„åæ ‡ç´¢å¼•ä»¥åŠæ­¤æ—¶çš„æœ€è¿œè·ç¦»å€¼ï¼Œè¿™4ä¸ªå€¼éƒ½æ˜¯æ•´æ•°ã€‚åœ¨cç‰ˆæœ¬çš„opencvä¸­ä¸€èˆ¬ä¸æ˜¯ä¿å­˜çš„ç´¢å¼•ï¼Œè€Œæ˜¯åæ ‡å€¼ã€‚</p> 
<h3><a id="22__70"></a>2.2 ç®—æ³•ç»“æœ</h3> 
<p><strong>æ•°å­—â€œ0â€çš„è¯†åˆ«ç»“æœï¼š</strong><br> <img src="https://images2.imgbox.com/41/87/QGwJROk6_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> <strong>æ•°å­—â€œ1â€çš„è¯†åˆ«ç»“æœ</strong></p> 
<p><img src="https://images2.imgbox.com/8d/14/JhIcuugJ_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>æ•°å­—â€œ2â€çš„è¯†åˆ«ç»“æœ</strong><br> <img src="https://images2.imgbox.com/21/07/tsb9DajY_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>æ•°å­—â€œ3â€çš„è¯†åˆ«ç»“æœï¼š</strong><br> <img src="https://images2.imgbox.com/5c/c4/vwPOmOly_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>æ•°å­—â€œ4â€çš„è¯†åˆ«ç»“æœï¼š</strong><br> <img src="https://images2.imgbox.com/13/1a/TzzXwwpJ_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>æ•°å­—â€œ5â€çš„è¯†åˆ«ç»“æœï¼š</strong><br> <img src="https://images2.imgbox.com/43/07/V3TUXdo5_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="23__90"></a>2.3 æ•´ä½“ä»£ç å®ç°</h3> 
<h4><a id="231__92"></a>2.3.1 ç®—æ³•æµç¨‹</h4> 
<p>å­¦é•¿å®ç°è¿‡ç¨‹å’Œä¸Šé¢çš„ç³»ç»Ÿæµç¨‹å›¾ç±»ä¼¼ï¼Œå¤§æ¦‚è¿‡ç¨‹å¦‚ä¸‹ï¼š</p> 
<ul><li> <p>1. æ±‚å‡ºæ‰‹éƒ¨çš„æ©è†œ</p> </li><li> <p>2. æ±‚å‡ºæ©è†œçš„è½®å»“</p> </li><li> <p>3. æ±‚å‡ºè½®å»“çš„å¤šå˜å½¢æ‹Ÿåˆæ›²çº¿</p> </li><li> <p>4. æ±‚å‡ºå¤šè¾¹å½¢æ‹Ÿåˆæ›²çº¿çš„å‡¸åŒ…é›†ï¼Œæ‰¾å‡ºå‡¸ç‚¹</p> </li><li> <p>5. æ±‚å‡ºå¤šå˜å½¢æ‹Ÿåˆæ›²çº¿çš„å‡¹é™·é›†ï¼Œæ‰¾å‡ºå‡¹ç‚¹</p> </li><li> <p>6. åˆ©ç”¨ä¸Šé¢çš„å‡¸å‡¹ç‚¹å’Œæ‰‹éƒ¨ä¸­å¿ƒç‚¹çš„å‡ ä½•å…³ç³»æ¥åšç®€å•çš„æ•°å­—æ‰‹åŠ¿è¯†åˆ«</p> </li></ul> 
<p><strong>(è¿™é‡Œç”¨çš„æ˜¯Cè¯­è¨€å†™çš„ï¼Œè¿™ä¸ªä»£ç æ˜¯å­¦é•¿æ—©æœŸå†™çš„ï¼ŒåŒå­¦ä»¬éœ€è¦çš„è¯ï¼Œå­¦é•¿å‡ºä¸€ä¸ªpythonç‰ˆæœ¬çš„)</strong></p> 
<p>â€‹</p> 
<pre><code class="prism language-python">

    <span class="token comment">#include </span>
    
    <span class="token comment">#include "opencv2/highgui/highgui.hpp"</span>
    <span class="token comment">#include "opencv2/imgproc/imgproc.hpp"</span>
    <span class="token comment">#include </span>
    <span class="token comment">#include "copenni.cpp"</span>
    
    <span class="token comment">#include </span>
    
    <span class="token comment">#define DEPTH_SCALE_FACTOR 255./4096.</span>
    <span class="token comment">#define ROI_HAND_WIDTH 140</span>
    <span class="token comment">#define ROI_HAND_HEIGHT 140</span>
    <span class="token comment">#define MEDIAN_BLUR_K 5</span>
    <span class="token comment">#define XRES  640</span>
    <span class="token comment">#define YRES  480</span>
    <span class="token comment">#define DEPTH_SEGMENT_THRESH 5</span>
    <span class="token comment">#define MAX_HANDS_COLOR 10</span>
    <span class="token comment">#define MAX_HANDS_NUMBER  10</span>
    <span class="token comment">#define HAND_LIKELY_AREA 2000</span>
    <span class="token comment">#define DELTA_POINT_DISTENCE 25     //æ‰‹éƒ¨ä¸­å¿ƒç‚¹1å’Œä¸­å¿ƒç‚¹2è·ç¦»çš„é˜ˆå€¼</span>
    <span class="token comment">#define SEGMENT_POINT1_DISTANCE 27  //å‡¸ç‚¹ä¸æ‰‹éƒ¨ä¸­å¿ƒç‚¹1è¿œè¿‘è·ç¦»çš„é˜ˆå€¼</span>
    <span class="token comment">#define SEGMENT_POINT2_DISTANCE 30  //å‡¸ç‚¹ä¸æ‰‹éƒ¨ä¸­å¿ƒç‚¹2è¿œè¿‘è·ç¦»çš„é˜ˆå€¼</span>
    
    using namespace cv<span class="token punctuation">;</span>
    using namespace xn<span class="token punctuation">;</span>
    using namespace std<span class="token punctuation">;</span>


    <span class="token builtin">int</span> main <span class="token punctuation">(</span><span class="token builtin">int</span> argc<span class="token punctuation">,</span> char <span class="token operator">**</span>argv<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        unsigned <span class="token builtin">int</span> convex_number_above_point1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        unsigned <span class="token builtin">int</span> concave_number_above_point1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        unsigned <span class="token builtin">int</span> convex_number_above_point2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        unsigned <span class="token builtin">int</span> concave_number_above_point2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        unsigned <span class="token builtin">int</span> convex_assist_above_point1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        unsigned <span class="token builtin">int</span> convex_assist_above_point2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        unsigned <span class="token builtin">int</span> point_y1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        unsigned <span class="token builtin">int</span> point_y2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token builtin">int</span> number_result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token builtin">bool</span> recognition_flag <span class="token operator">=</span> false<span class="token punctuation">;</span>  <span class="token operator">//</span>å¼€å§‹æ‰‹éƒ¨æ•°å­—è¯†åˆ«çš„æ ‡å¿—
    
        vector<span class="token operator">&lt;</span>Scalar<span class="token operator">&gt;</span> color_array<span class="token punctuation">;</span><span class="token operator">//</span>é‡‡ç”¨é»˜è®¤çš„<span class="token number">10</span>ç§é¢œè‰²
        <span class="token punctuation">{<!-- --></span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_array<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        vector<span class="token operator">&lt;</span>unsigned <span class="token builtin">int</span><span class="token operator">&gt;</span> hand_depth<span class="token punctuation">(</span>MAX_HANDS_NUMBER<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        vector<span class="token operator">&lt;</span>Rect<span class="token operator">&gt;</span> hands_roi<span class="token punctuation">(</span>MAX_HANDS_NUMBER<span class="token punctuation">,</span> Rect<span class="token punctuation">(</span>XRES<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> YRES<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> ROI_HAND_WIDTH<span class="token punctuation">,</span> ROI_HAND_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        namedWindow<span class="token punctuation">(</span><span class="token string">"color image"</span><span class="token punctuation">,</span> CV_WINDOW_AUTOSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        namedWindow<span class="token punctuation">(</span><span class="token string">"depth image"</span><span class="token punctuation">,</span> CV_WINDOW_AUTOSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        namedWindow<span class="token punctuation">(</span><span class="token string">"hand_segment"</span><span class="token punctuation">,</span> CV_WINDOW_AUTOSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token operator">//</span>æ˜¾ç¤ºåˆ†å‰²å‡ºæ¥çš„æ‰‹çš„åŒºåŸŸ
        namedWindow<span class="token punctuation">(</span><span class="token string">"handrecognition"</span><span class="token punctuation">,</span> CV_WINDOW_AUTOSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">//</span>æ˜¾ç¤º<span class="token number">0</span><span class="token operator">~</span><span class="token number">5</span>æ•°å­—è¯†åˆ«çš„å›¾åƒ
    
        COpenNI openni<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>!openni<span class="token punctuation">.</span>Initial<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    
        <span class="token keyword">if</span><span class="token punctuation">(</span>!openni<span class="token punctuation">.</span>Start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>!openni<span class="token punctuation">.</span>UpdateData<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token operator">/</span><span class="token operator">*</span>è·å–å¹¶æ˜¾ç¤ºè‰²å½©å›¾åƒ<span class="token operator">*</span><span class="token operator">/</span>
            Mat color_image_src<span class="token punctuation">(</span>openni<span class="token punctuation">.</span>image_metadata_<span class="token punctuation">.</span>YRes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> openni<span class="token punctuation">.</span>image_metadata_<span class="token punctuation">.</span>XRes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                CV_8UC3<span class="token punctuation">,</span> <span class="token punctuation">(</span>char <span class="token operator">*</span><span class="token punctuation">)</span>openni<span class="token punctuation">.</span>image_metadata_<span class="token punctuation">.</span>Data<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Mat color_image<span class="token punctuation">;</span>
            cvtColor<span class="token punctuation">(</span>color_image_src<span class="token punctuation">,</span> color_image<span class="token punctuation">,</span> CV_RGB2BGR<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Mat hand_segment_mask<span class="token punctuation">(</span>color_image<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_8UC1<span class="token punctuation">,</span> Scalar<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
            <span class="token keyword">for</span><span class="token punctuation">(</span>auto itUser <span class="token operator">=</span> openni<span class="token punctuation">.</span>hand_points_<span class="token punctuation">.</span>cbegin<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> itUser <span class="token operator">!=</span> openni<span class="token punctuation">.</span>hand_points_<span class="token punctuation">.</span>cend<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>itUser<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    
                point_y1 <span class="token operator">=</span> itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>Y<span class="token punctuation">;</span>
                point_y2 <span class="token operator">=</span> itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>Y <span class="token operator">+</span> DELTA_POINT_DISTENCE<span class="token punctuation">;</span>
                circle<span class="token punctuation">(</span>color_image<span class="token punctuation">,</span> Point<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>X<span class="token punctuation">,</span> itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">,</span>
                       <span class="token number">5</span><span class="token punctuation">,</span> color_array<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> color_array<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
                <span class="token operator">/</span><span class="token operator">*</span>è®¾ç½®ä¸åŒæ‰‹éƒ¨çš„æ·±åº¦<span class="token operator">*</span><span class="token operator">/</span>
                hand_depth<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_COLOR<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>unsigned <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>Z<span class="token operator">*</span> DEPTH_SCALE_FACTOR<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>firstä¼šå¯¼è‡´ç¨‹åºå‡ºç°bug
    
                <span class="token operator">/</span><span class="token operator">*</span>è®¾ç½®ä¸åŒæ‰‹éƒ¨çš„ä¸åŒæ„Ÿå…´è¶£åŒºåŸŸ<span class="token operator">*</span><span class="token operator">/</span>
                hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span> <span class="token operator">=</span> Rect<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>X <span class="token operator">-</span> ROI_HAND_WIDTH<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>Y <span class="token operator">-</span> ROI_HAND_HEIGHT<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span>
                                                   ROI_HAND_WIDTH<span class="token punctuation">,</span> ROI_HAND_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">;</span>
                hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token operator">=</span>  itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>X <span class="token operator">-</span> ROI_HAND_WIDTH<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
                hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">=</span>  itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>Y <span class="token operator">-</span> ROI_HAND_HEIGHT<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>
                hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">=</span> ROI_HAND_WIDTH<span class="token punctuation">;</span>
                hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>height <span class="token operator">=</span> ROI_HAND_HEIGHT<span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>x  <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token operator">&gt;</span> XRES<span class="token punctuation">)</span>
                    hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>x <span class="token operator">=</span>  XRES<span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">&gt;</span> YRES<span class="token punctuation">)</span>
                    hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">=</span>  YRES<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            imshow<span class="token punctuation">(</span><span class="token string">"color image"</span><span class="token punctuation">,</span> color_image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
            <span class="token operator">/</span><span class="token operator">*</span>è·å–å¹¶æ˜¾ç¤ºæ·±åº¦å›¾åƒ<span class="token operator">*</span><span class="token operator">/</span>
            Mat depth_image_src<span class="token punctuation">(</span>openni<span class="token punctuation">.</span>depth_metadata_<span class="token punctuation">.</span>YRes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> openni<span class="token punctuation">.</span>depth_metadata_<span class="token punctuation">.</span>XRes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                CV_16UC1<span class="token punctuation">,</span> <span class="token punctuation">(</span>char <span class="token operator">*</span><span class="token punctuation">)</span>openni<span class="token punctuation">.</span>depth_metadata_<span class="token punctuation">.</span>Data<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>å› ä¸ºkinectè·å–åˆ°çš„æ·±åº¦å›¾åƒå®é™…ä¸Šæ˜¯æ— ç¬¦å·çš„<span class="token number">16</span>ä½æ•°æ®
            Mat depth_image<span class="token punctuation">;</span>
            depth_image_src<span class="token punctuation">.</span>convertTo<span class="token punctuation">(</span>depth_image<span class="token punctuation">,</span> CV_8U<span class="token punctuation">,</span> DEPTH_SCALE_FACTOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
            imshow<span class="token punctuation">(</span><span class="token string">"depth image"</span><span class="token punctuation">,</span> depth_image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
            <span class="token operator">//</span>å–å‡ºæ‰‹çš„maskéƒ¨åˆ†
            <span class="token operator">//</span>ä¸ç®¡åŸå›¾åƒæ—¶å¤šå°‘é€šé“çš„ï¼ŒmaskçŸ©é˜µå£°æ˜ä¸ºå•é€šé“å°±ok
            <span class="token keyword">for</span><span class="token punctuation">(</span>auto itUser <span class="token operator">=</span> openni<span class="token punctuation">.</span>hand_points_<span class="token punctuation">.</span>cbegin<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> itUser <span class="token operator">!=</span> openni<span class="token punctuation">.</span>hand_points_<span class="token punctuation">.</span>cend<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>itUser<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token builtin">int</span> i <span class="token operator">=</span> hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token builtin">min</span><span class="token punctuation">(</span>hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token operator">+</span>hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span> XRES<span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span>
                    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token builtin">int</span> j <span class="token operator">=</span> hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token builtin">min</span><span class="token punctuation">(</span>hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token operator">+</span>hands_roi<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token punctuation">.</span>height<span class="token punctuation">,</span> YRES<span class="token punctuation">)</span><span class="token punctuation">;</span> j<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        hand_segment_mask<span class="token punctuation">.</span>at<span class="token operator">&lt;</span>unsigned char<span class="token operator">&gt;</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>hand_depth<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token operator">-</span>DEPTH_SEGMENT_THRESH<span class="token punctuation">)</span> <span class="token operator">&lt;</span> depth_image<span class="token punctuation">.</span>at<span class="token operator">&lt;</span>unsigned char<span class="token operator">&gt;</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
                                                                    <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>hand_depth<span class="token punctuation">.</span>at<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>first <span class="token operator">%</span> MAX_HANDS_NUMBER<span class="token punctuation">)</span><span class="token operator">+</span>DEPTH_SEGMENT_THRESH<span class="token punctuation">)</span> <span class="token operator">&gt;</span> depth_image<span class="token punctuation">.</span>at<span class="token operator">&lt;</span>unsigned char<span class="token operator">&gt;</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
             <span class="token punctuation">}</span>
            medianBlur<span class="token punctuation">(</span>hand_segment_mask<span class="token punctuation">,</span> hand_segment_mask<span class="token punctuation">,</span> MEDIAN_BLUR_K<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Mat hand_segment<span class="token punctuation">(</span>color_image<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_8UC3<span class="token punctuation">)</span><span class="token punctuation">;</span>
            color_image<span class="token punctuation">.</span>copyTo<span class="token punctuation">(</span>hand_segment<span class="token punctuation">,</span> hand_segment_mask<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
            <span class="token operator">/</span><span class="token operator">*</span>å¯¹maskå›¾åƒè¿›è¡Œè½®å»“æå–<span class="token punctuation">,</span>å¹¶åœ¨æ‰‹åŠ¿è¯†åˆ«å›¾åƒä¸­ç”»å‡ºæ¥<span class="token operator">*</span><span class="token operator">/</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>Point<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> contours<span class="token punctuation">;</span>
            findContours<span class="token punctuation">(</span>hand_segment_mask<span class="token punctuation">,</span> contours<span class="token punctuation">,</span> CV_RETR_LIST<span class="token punctuation">,</span> CV_CHAIN_APPROX_SIMPLE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>æ‰¾å‡ºmaskå›¾åƒçš„è½®å»“
            Mat hand_recognition_image <span class="token operator">=</span> Mat<span class="token punctuation">:</span><span class="token punctuation">:</span>zeros<span class="token punctuation">(</span>color_image<span class="token punctuation">.</span>rows<span class="token punctuation">,</span> color_image<span class="token punctuation">.</span>cols<span class="token punctuation">,</span> CV_8UC3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token builtin">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> contours<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token operator">//</span>åªæœ‰åœ¨æ£€æµ‹åˆ°è½®å»“æ—¶æ‰ä¼šå»æ±‚å®ƒçš„å¤šè¾¹å½¢ï¼Œå‡¸åŒ…é›†ï¼Œå‡¹é™·é›†
                recognition_flag <span class="token operator">=</span> true<span class="token punctuation">;</span>
                <span class="token operator">/</span><span class="token operator">*</span>æ‰¾å‡ºè½®å»“å›¾åƒå¤šè¾¹å½¢æ‹Ÿåˆæ›²çº¿<span class="token operator">*</span><span class="token operator">/</span>
                Mat contour_mat <span class="token operator">=</span> Mat<span class="token punctuation">(</span>contours<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>contourArea<span class="token punctuation">(</span>contour_mat<span class="token punctuation">)</span> <span class="token operator">&gt;</span> HAND_LIKELY_AREA<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>   <span class="token operator">//</span>æ¯”è¾ƒæœ‰å¯èƒ½åƒæ‰‹çš„åŒºåŸŸ
                    std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>Point<span class="token operator">&gt;</span> approx_poly_curve<span class="token punctuation">;</span>
                    approxPolyDP<span class="token punctuation">(</span>contour_mat<span class="token punctuation">,</span> approx_poly_curve<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>æ‰¾å‡ºè½®å»“çš„å¤šè¾¹å½¢æ‹Ÿåˆæ›²çº¿
                    std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>Point<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> approx_poly_curve_debug<span class="token punctuation">;</span>
                    approx_poly_curve_debug<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>approx_poly_curve<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
                     drawContours<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> contours<span class="token punctuation">,</span> i<span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">//</span>ç”»å‡ºè½®å»“
        <span class="token operator">//</span>            drawContours<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> approx_poly_curve_debug<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">//</span>ç”»å‡ºå¤šè¾¹å½¢æ‹Ÿåˆæ›²çº¿
    
                    <span class="token operator">/</span><span class="token operator">*</span>å¯¹æ±‚å‡ºçš„å¤šè¾¹å½¢æ‹Ÿåˆæ›²çº¿æ±‚å‡ºå…¶å‡¸åŒ…é›†<span class="token operator">*</span><span class="token operator">/</span>
                    vector<span class="token operator">&lt;</span><span class="token builtin">int</span><span class="token operator">&gt;</span> hull<span class="token punctuation">;</span>
                    convexHull<span class="token punctuation">(</span>Mat<span class="token punctuation">(</span>approx_poly_curve<span class="token punctuation">)</span><span class="token punctuation">,</span> hull<span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token builtin">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> hull<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        circle<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> approx_poly_curve<span class="token punctuation">[</span>hull<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
                        <span class="token operator">/</span><span class="token operator">*</span>ç»Ÿè®¡åœ¨ä¸­å¿ƒç‚¹<span class="token number">1</span>ä»¥ä¸Šå‡¸ç‚¹çš„ä¸ªæ•°<span class="token operator">*</span><span class="token operator">/</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>approx_poly_curve<span class="token punctuation">[</span>hull<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> point_y1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token operator">/</span><span class="token operator">*</span>ç»Ÿè®¡å‡¸ç‚¹ä¸ä¸­å¿ƒç‚¹<span class="token number">1</span>çš„yè½´è·ç¦»<span class="token operator">*</span><span class="token operator">/</span>
                            <span class="token builtin">long</span> dis_point1 <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token builtin">long</span><span class="token punctuation">(</span>point_y1 <span class="token operator">-</span> approx_poly_curve<span class="token punctuation">[</span>hull<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token builtin">int</span> dis1 <span class="token operator">=</span> point_y1 <span class="token operator">-</span> approx_poly_curve<span class="token punctuation">[</span>hull<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>dis_point1 <span class="token operator">&gt;</span> SEGMENT_POINT1_DISTANCE <span class="token operator">&amp;</span><span class="token operator">&amp;</span> dis1 <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
                                convex_assist_above_point1<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            convex_number_above_point1<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
    
                        <span class="token operator">/</span><span class="token operator">*</span>ç»Ÿè®¡åœ¨ä¸­å¿ƒç‚¹<span class="token number">2</span>ä»¥ä¸Šå‡¸ç‚¹çš„ä¸ªæ•°<span class="token operator">*</span><span class="token operator">/</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>approx_poly_curve<span class="token punctuation">[</span>hull<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> point_y2<span class="token punctuation">)</span>    <span class="token punctuation">{<!-- --></span>
                            <span class="token operator">/</span><span class="token operator">*</span>ç»Ÿè®¡å‡¸ç‚¹ä¸ä¸­å¿ƒç‚¹<span class="token number">1</span>çš„yè½´è·ç¦»<span class="token operator">*</span><span class="token operator">/</span>
                            <span class="token builtin">long</span> dis_point2 <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token builtin">long</span><span class="token punctuation">(</span>point_y2 <span class="token operator">-</span> approx_poly_curve<span class="token punctuation">[</span>hull<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token builtin">int</span> dis2 <span class="token operator">=</span> point_y2 <span class="token operator">-</span> approx_poly_curve<span class="token punctuation">[</span>hull<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>dis_point2 <span class="token operator">&gt;</span> SEGMENT_POINT2_DISTANCE <span class="token operator">&amp;</span><span class="token operator">&amp;</span> dis2 <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token punctuation">{<!-- --></span>
                                convex_assist_above_point2<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            convex_number_above_point2<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
    
        <span class="token operator">//</span>            <span class="token operator">/</span><span class="token operator">*</span>å¯¹æ±‚å‡ºçš„å¤šè¾¹å½¢æ‹Ÿåˆæ›²çº¿æ±‚å‡ºå‡¹é™·é›†<span class="token operator">*</span><span class="token operator">/</span>
                    std<span class="token punctuation">:</span><span class="token punctuation">:</span>vector<span class="token operator">&lt;</span>Vec4i<span class="token operator">&gt;</span> convexity_defects<span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>Mat<span class="token punctuation">(</span>approx_poly_curve<span class="token punctuation">)</span><span class="token punctuation">.</span>checkVector<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> CV_32S<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">3</span><span class="token punctuation">)</span>
                        convexityDefects<span class="token punctuation">(</span>approx_poly_curve<span class="token punctuation">,</span> Mat<span class="token punctuation">(</span>hull<span class="token punctuation">)</span><span class="token punctuation">,</span> convexity_defects<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token builtin">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> convexity_defects<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        circle<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> approx_poly_curve<span class="token punctuation">[</span>convexity_defects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
                        <span class="token operator">/</span><span class="token operator">*</span>ç»Ÿè®¡åœ¨ä¸­å¿ƒç‚¹<span class="token number">1</span>ä»¥ä¸Šå‡¹é™·ç‚¹çš„ä¸ªæ•°<span class="token operator">*</span><span class="token operator">/</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>approx_poly_curve<span class="token punctuation">[</span>convexity_defects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> point_y1<span class="token punctuation">)</span>
                            concave_number_above_point1<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">;</span>
    
                        <span class="token operator">/</span><span class="token operator">*</span>ç»Ÿè®¡åœ¨ä¸­å¿ƒç‚¹<span class="token number">2</span>ä»¥ä¸Šå‡¹é™·ç‚¹çš„ä¸ªæ•°<span class="token operator">*</span><span class="token operator">/</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>approx_poly_curve<span class="token punctuation">[</span>convexity_defects<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> point_y2<span class="token punctuation">)</span>
                            concave_number_above_point2<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
    
            <span class="token operator">/</span><span class="token operator">**</span>ç”»å‡ºæ‰‹åŠ¿çš„ä¸­å¿ƒç‚¹<span class="token operator">**</span><span class="token operator">/</span>
            <span class="token keyword">for</span><span class="token punctuation">(</span>auto itUser <span class="token operator">=</span> openni<span class="token punctuation">.</span>hand_points_<span class="token punctuation">.</span>cbegin<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> itUser <span class="token operator">!=</span> openni<span class="token punctuation">.</span>hand_points_<span class="token punctuation">.</span>cend<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>itUser<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                circle<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> Point<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>X<span class="token punctuation">,</span> itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                circle<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> Point<span class="token punctuation">(</span>itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>X<span class="token punctuation">,</span> itUser<span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>Y <span class="token operator">+</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
    
            <span class="token operator">/</span><span class="token operator">*</span>æ‰‹åŠ¿æ•°å­—<span class="token number">0</span><span class="token operator">~</span><span class="token number">5</span>çš„è¯†åˆ«<span class="token operator">*</span><span class="token operator">/</span>
            <span class="token operator">//</span><span class="token string">"0"</span>çš„è¯†åˆ«
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>convex_assist_above_point1 <span class="token operator">==</span><span class="token number">0</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_number_above_point2 <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_number_above_point2 <span class="token operator">&lt;=</span> <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>
                    concave_number_above_point2 <span class="token operator">&lt;=</span> <span class="token number">1</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> concave_number_above_point1 <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">|</span> <span class="token punctuation">(</span>concave_number_above_point1 <span class="token operator">==</span><span class="token number">0</span>
                    <span class="token operator">|</span><span class="token operator">|</span> concave_number_above_point2 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> recognition_flag <span class="token operator">==</span> true<span class="token punctuation">)</span>
                number_result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token operator">//</span><span class="token string">"1"</span>çš„è¯†åˆ«
            <span class="token keyword">if</span><span class="token punctuation">(</span>convex_assist_above_point1 <span class="token operator">==</span><span class="token number">1</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_number_above_point1 <span class="token operator">&gt;=</span><span class="token number">1</span>  <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_number_above_point1 <span class="token operator">&lt;=</span><span class="token number">2</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>
                    convex_number_above_point2 <span class="token operator">&gt;=</span><span class="token number">2</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_assist_above_point2 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
                number_result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token operator">//</span><span class="token string">"2"</span>çš„è¯†åˆ«
            <span class="token keyword">if</span><span class="token punctuation">(</span>convex_number_above_point1 <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> concave_number_above_point1 <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_assist_above_point2 <span class="token operator">==</span> <span class="token number">2</span>
                    <span class="token operator">/</span><span class="token operator">*</span>convex_assist_above_point1 <span class="token operator">&lt;=</span><span class="token number">1</span><span class="token operator">*</span><span class="token operator">/</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> concave_number_above_point2 <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
                number_result <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token operator">//</span><span class="token string">"3"</span>çš„è¯†åˆ«
            <span class="token keyword">if</span><span class="token punctuation">(</span>convex_number_above_point1 <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> concave_number_above_point1 <span class="token operator">&lt;=</span> <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>
                    concave_number_above_point1 <span class="token operator">&gt;=</span><span class="token number">1</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_number_above_point2 <span class="token operator">&gt;=</span> <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_number_above_point2 <span class="token operator">&lt;=</span> <span class="token number">4</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>
                    convex_assist_above_point2 <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
                number_result <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token operator">//</span><span class="token string">"4"</span>çš„è¯†åˆ«
            <span class="token keyword">if</span><span class="token punctuation">(</span>convex_number_above_point1 <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> concave_number_above_point1 <span class="token operator">&lt;=</span><span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> concave_number_above_point1 <span class="token operator">&gt;=</span><span class="token number">2</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>
                    convex_number_above_point2 <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
                number_result <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
            <span class="token operator">//</span><span class="token string">"5"</span>çš„è¯†åˆ«
            <span class="token keyword">if</span><span class="token punctuation">(</span>convex_number_above_point1 <span class="token operator">&gt;=</span><span class="token number">4</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> convex_number_above_point2 <span class="token operator">==</span> <span class="token number">5</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> concave_number_above_point2 <span class="token operator">&gt;=</span> <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span>
                    convex_number_above_point2 <span class="token operator">&gt;=</span> <span class="token number">4</span><span class="token punctuation">)</span>
                number_result <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>number_result <span class="token operator">!=</span><span class="token number">0</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> number_result <span class="token operator">!=</span> <span class="token number">1</span>  <span class="token operator">&amp;</span><span class="token operator">&amp;</span> number_result <span class="token operator">!=</span> <span class="token number">2</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> number_result <span class="token operator">!=</span> <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> number_result <span class="token operator">!=</span> <span class="token number">4</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> number_result <span class="token operator">!=</span> <span class="token number">5</span><span class="token punctuation">)</span>
                number_result <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    
            <span class="token operator">/</span><span class="token operator">*</span>åœ¨æ‰‹åŠ¿è¯†åˆ«å›¾ä¸Šæ˜¾ç¤ºåŒ¹é…çš„æ•°å­—<span class="token operator">*</span><span class="token operator">/</span>
            std<span class="token punctuation">:</span><span class="token punctuation">:</span>stringstream number_str<span class="token punctuation">;</span>
            number_str <span class="token operator">&lt;&lt;</span> number_result<span class="token punctuation">;</span>
            putText<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> <span class="token string">"Match: "</span><span class="token punctuation">,</span> Point<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>number_result <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                putText<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">,</span> Point<span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                putText<span class="token punctuation">(</span>hand_recognition_image<span class="token punctuation">,</span> number_str<span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Point<span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> Scalar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
            imshow<span class="token punctuation">(</span><span class="token string">"handrecognition"</span><span class="token punctuation">,</span> hand_recognition_image<span class="token punctuation">)</span><span class="token punctuation">;</span>
            imshow<span class="token punctuation">(</span><span class="token string">"hand_segment"</span><span class="token punctuation">,</span> hand_segment<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
            <span class="token operator">/</span><span class="token operator">*</span>ä¸€ä¸ªå¾ªç¯ä¸­å¯¹æœ‰äº›å˜é‡è¿›è¡Œåˆå§‹åŒ–æ“ä½œ<span class="token operator">*</span><span class="token operator">/</span>
            convex_number_above_point1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            convex_number_above_point2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            concave_number_above_point1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            concave_number_above_point2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            convex_assist_above_point1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            convex_assist_above_point2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            number_result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            recognition_flag <span class="token operator">=</span> false<span class="token punctuation">;</span>
            number_str<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
            waitKey<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
    <span class="token punctuation">}</span>



    <span class="token comment">#include "copenni.h"</span>
    <span class="token comment">#include </span>
    <span class="token comment">#include </span>
    <span class="token comment">#include </span>
    
    using namespace xn<span class="token punctuation">;</span>
    using namespace std<span class="token punctuation">;</span>
    
    COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>COpenNI<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
    
    COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">~</span>COpenNI<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
    
    <span class="token builtin">bool</span> COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>Initial<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        status_ <span class="token operator">=</span> context_<span class="token punctuation">.</span>Init<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Context initial failed!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        context_<span class="token punctuation">.</span>SetGlobalMirror<span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>è®¾ç½®é•œåƒ
        xmode_<span class="token punctuation">.</span>nXRes <span class="token operator">=</span> <span class="token number">640</span><span class="token punctuation">;</span>
        xmode_<span class="token punctuation">.</span>nYRes <span class="token operator">=</span> <span class="token number">480</span><span class="token punctuation">;</span>
        xmode_<span class="token punctuation">.</span>nFPS <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
    
        <span class="token operator">//</span>äº§ç”Ÿé¢œè‰²node
        status_ <span class="token operator">=</span> image_generator_<span class="token punctuation">.</span>Create<span class="token punctuation">(</span>context_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Create image generator  error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        <span class="token operator">//</span>è®¾ç½®é¢œè‰²å›¾ç‰‡è¾“å‡ºæ¨¡å¼
        status_ <span class="token operator">=</span> image_generator_<span class="token punctuation">.</span>SetMapOutputMode<span class="token punctuation">(</span>xmode_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"SetMapOutputMdoe error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        <span class="token operator">//</span>äº§ç”Ÿæ·±åº¦node
        status_ <span class="token operator">=</span> depth_generator_<span class="token punctuation">.</span>Create<span class="token punctuation">(</span>context_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Create depth generator  error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        <span class="token operator">//</span>è®¾ç½®æ·±åº¦å›¾ç‰‡è¾“å‡ºæ¨¡å¼
        status_ <span class="token operator">=</span> depth_generator_<span class="token punctuation">.</span>SetMapOutputMode<span class="token punctuation">(</span>xmode_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"SetMapOutputMdoe error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        <span class="token operator">//</span>äº§ç”Ÿæ‰‹åŠ¿node
        status_ <span class="token operator">=</span> gesture_generator_<span class="token punctuation">.</span>Create<span class="token punctuation">(</span>context_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Create gesture generator error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        <span class="token operator">/</span><span class="token operator">*</span>æ·»åŠ æ‰‹åŠ¿è¯†åˆ«çš„ç§ç±»<span class="token operator">*</span><span class="token operator">/</span>
        gesture_generator_<span class="token punctuation">.</span>AddGesture<span class="token punctuation">(</span><span class="token string">"Wave"</span><span class="token punctuation">,</span> NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gesture_generator_<span class="token punctuation">.</span>AddGesture<span class="token punctuation">(</span><span class="token string">"click"</span><span class="token punctuation">,</span> NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gesture_generator_<span class="token punctuation">.</span>AddGesture<span class="token punctuation">(</span><span class="token string">"RaiseHand"</span><span class="token punctuation">,</span> NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        gesture_generator_<span class="token punctuation">.</span>AddGesture<span class="token punctuation">(</span><span class="token string">"MovingHand"</span><span class="token punctuation">,</span> NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token operator">//</span>äº§ç”Ÿæ‰‹éƒ¨çš„node
        status_ <span class="token operator">=</span> hand_generator_<span class="token punctuation">.</span>Create<span class="token punctuation">(</span>context_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Create hand generaotr error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        <span class="token operator">//</span>äº§ç”Ÿäººä½“node
        status_ <span class="token operator">=</span> user_generator_<span class="token punctuation">.</span>Create<span class="token punctuation">(</span>context_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Create gesturen generator error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        <span class="token operator">//</span>è§†è§’æ ¡æ­£
        status_ <span class="token operator">=</span> depth_generator_<span class="token punctuation">.</span>GetAlternativeViewPointCap<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SetViewPoint<span class="token punctuation">(</span>image_generator_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Can't set the alternative view point on depth generator!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    
        <span class="token operator">//</span>è®¾ç½®ä¸æ‰‹åŠ¿æœ‰å…³çš„å›è°ƒå‡½æ•°
        XnCallbackHandle gesture_cb<span class="token punctuation">;</span>
        gesture_generator_<span class="token punctuation">.</span>RegisterGestureCallbacks<span class="token punctuation">(</span>CBGestureRecognized<span class="token punctuation">,</span> CBGestureProgress<span class="token punctuation">,</span> this<span class="token punctuation">,</span> gesture_cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token operator">//</span>è®¾ç½®äºæ‰‹éƒ¨æœ‰å…³çš„å›è°ƒå‡½æ•°
        XnCallbackHandle hands_cb<span class="token punctuation">;</span>
        hand_generator_<span class="token punctuation">.</span>RegisterHandCallbacks<span class="token punctuation">(</span>HandCreate<span class="token punctuation">,</span> HandUpdate<span class="token punctuation">,</span> HandDestroy<span class="token punctuation">,</span> this<span class="token punctuation">,</span> hands_cb<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token operator">//</span>è®¾ç½®æœ‰äººè¿›å…¥è§†é‡çš„å›è°ƒå‡½æ•°
        XnCallbackHandle new_user_handle<span class="token punctuation">;</span>
        user_generator_<span class="token punctuation">.</span>RegisterUserCallbacks<span class="token punctuation">(</span>CBNewUser<span class="token punctuation">,</span> NULL<span class="token punctuation">,</span> NULL<span class="token punctuation">,</span> new_user_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        user_generator_<span class="token punctuation">.</span>GetSkeletonCap<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>SetSkeletonProfile<span class="token punctuation">(</span>XN_SKEL_PROFILE_ALL<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>è®¾å®šä½¿ç”¨æ‰€æœ‰å…³èŠ‚ï¼ˆå…±<span class="token number">15</span>ä¸ªï¼‰
    
        <span class="token operator">//</span>è®¾ç½®éª¨éª¼æ ¡æ­£å®Œæˆçš„å›è°ƒå‡½æ•°
        XnCallbackHandle calibration_complete<span class="token punctuation">;</span>
        user_generator_<span class="token punctuation">.</span>GetSkeletonCap<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>RegisterToCalibrationComplete<span class="token punctuation">(</span>CBCalibrationComplete<span class="token punctuation">,</span> this<span class="token punctuation">,</span> calibration_complete<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> true<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token builtin">bool</span> COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>Start<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        status_ <span class="token operator">=</span> context_<span class="token punctuation">.</span>StartGeneratingAll<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Start generating error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> true<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token builtin">bool</span> COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>UpdateData<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        status_ <span class="token operator">=</span> context_<span class="token punctuation">.</span>WaitNoneUpdateAll<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>CheckError<span class="token punctuation">(</span><span class="token string">"Update date error!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token operator">//</span>è·å–æ•°æ®
        image_generator_<span class="token punctuation">.</span>GetMetaData<span class="token punctuation">(</span>image_metadata_<span class="token punctuation">)</span><span class="token punctuation">;</span>
        depth_generator_<span class="token punctuation">.</span>GetMetaData<span class="token punctuation">(</span>depth_metadata_<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
        <span class="token keyword">return</span> true<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    ImageGenerator <span class="token operator">&amp;</span>COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>getImageGenerator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> image_generator_<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    DepthGenerator <span class="token operator">&amp;</span>COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>getDepthGenerator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> depth_generator_<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    UserGenerator <span class="token operator">&amp;</span>COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>getUserGenerator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> user_generator_<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    GestureGenerator <span class="token operator">&amp;</span>COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>getGestureGenerator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> gesture_generator_<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    HandsGenerator <span class="token operator">&amp;</span>COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>getHandGenerator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> hand_generator_<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token builtin">bool</span> COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>CheckError<span class="token punctuation">(</span>const char <span class="token operator">*</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>status_ <span class="token operator">!=</span> XN_STATUS_OK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            cerr <span class="token operator">&lt;&lt;</span> error <span class="token operator">&lt;&lt;</span> <span class="token string">": "</span> <span class="token operator">&lt;&lt;</span> xnGetStatusString<span class="token punctuation">(</span> status_ <span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
            <span class="token keyword">return</span> true<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    void COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>CBNewUser<span class="token punctuation">(</span>UserGenerator <span class="token operator">&amp;</span>generator<span class="token punctuation">,</span> XnUserID user<span class="token punctuation">,</span> void <span class="token operator">*</span>p_cookie<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token operator">//</span>å¾—åˆ°skeletonçš„capability<span class="token punctuation">,</span>å¹¶è°ƒç”¨RequestCalibrationå‡½æ•°è®¾ç½®å¯¹æ–°æ£€æµ‹åˆ°çš„äººè¿›è¡Œéª¨éª¼æ ¡æ­£
        generator<span class="token punctuation">.</span>GetSkeletonCap<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>RequestCalibration<span class="token punctuation">(</span>user<span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    void COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>CBCalibrationComplete<span class="token punctuation">(</span>SkeletonCapability <span class="token operator">&amp;</span>skeleton<span class="token punctuation">,</span> XnUserID user<span class="token punctuation">,</span> XnCalibrationStatus calibration_error<span class="token punctuation">,</span> void <span class="token operator">*</span>p_cookie<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>calibration_error <span class="token operator">==</span> XN_CALIBRATION_STATUS_OK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            skeleton<span class="token punctuation">.</span>StartTracking<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>éª¨éª¼æ ¡æ­£å®Œæˆåå°±å¼€å§‹è¿›è¡Œäººä½“è·Ÿè¸ªäº†
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            UserGenerator <span class="token operator">*</span>p_user <span class="token operator">=</span> <span class="token punctuation">(</span>UserGenerator<span class="token operator">*</span><span class="token punctuation">)</span>p_cookie<span class="token punctuation">;</span>
            skeleton<span class="token punctuation">.</span>RequestCalibration<span class="token punctuation">(</span>user<span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>éª¨éª¼æ ¡æ­£å¤±è´¥æ—¶é‡æ–°è®¾ç½®å¯¹äººä½“éª¨éª¼ç»§ç»­è¿›è¡Œæ ¡æ­£
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    void COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>CBGestureRecognized<span class="token punctuation">(</span>GestureGenerator <span class="token operator">&amp;</span>generator<span class="token punctuation">,</span> const XnChar <span class="token operator">*</span>strGesture<span class="token punctuation">,</span> const XnPoint3D <span class="token operator">*</span>pIDPosition<span class="token punctuation">,</span> const XnPoint3D <span class="token operator">*</span>pEndPosition<span class="token punctuation">,</span> void <span class="token operator">*</span>pCookie<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        COpenNI <span class="token operator">*</span>openni <span class="token operator">=</span> <span class="token punctuation">(</span>COpenNI<span class="token operator">*</span><span class="token punctuation">)</span>pCookie<span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>hand_generator_<span class="token punctuation">.</span>StartTracking<span class="token punctuation">(</span><span class="token operator">*</span>pEndPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    void COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>CBGestureProgress<span class="token punctuation">(</span>GestureGenerator <span class="token operator">&amp;</span>generator<span class="token punctuation">,</span> const XnChar <span class="token operator">*</span>strGesture<span class="token punctuation">,</span> const XnPoint3D <span class="token operator">*</span>pPosition<span class="token punctuation">,</span> XnFloat fProgress<span class="token punctuation">,</span> void <span class="token operator">*</span>pCookie<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
    
    void COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>HandCreate<span class="token punctuation">(</span>HandsGenerator <span class="token operator">&amp;</span>rHands<span class="token punctuation">,</span> XnUserID xUID<span class="token punctuation">,</span> const XnPoint3D <span class="token operator">*</span>pPosition<span class="token punctuation">,</span> XnFloat fTime<span class="token punctuation">,</span> void <span class="token operator">*</span>pCookie<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        COpenNI <span class="token operator">*</span>openni <span class="token operator">=</span> <span class="token punctuation">(</span>COpenNI<span class="token operator">*</span><span class="token punctuation">)</span>pCookie<span class="token punctuation">;</span>
        XnPoint3D project_pos<span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>depth_generator_<span class="token punctuation">.</span>ConvertRealWorldToProjective<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> pPosition<span class="token punctuation">,</span> <span class="token operator">&amp;</span>project_pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        pair<span class="token operator">&lt;</span>XnUserID<span class="token punctuation">,</span> XnPoint3D<span class="token operator">&gt;</span> hand_point_pair<span class="token punctuation">(</span>xUID<span class="token punctuation">,</span> XnPoint3D<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>åœ¨è¿›è¡Œpairç±»å‹çš„å®šä¹‰æ—¶ï¼Œå¯ä»¥å°†ç¬¬<span class="token number">2</span>ä¸ªè®¾ç½®ä¸ºç©º
        hand_point_pair<span class="token punctuation">.</span>second <span class="token operator">=</span> project_pos<span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>hand_points_<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>hand_point_pair<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">//</span>å°†æ£€æµ‹åˆ°çš„æ‰‹éƒ¨å­˜å…¥<span class="token builtin">map</span>ç±»å‹çš„hand_points_ä¸­ã€‚
    
        pair<span class="token operator">&lt;</span>XnUserID<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>XnPoint3D<span class="token operator">&gt;&gt;</span> hand_track_point<span class="token punctuation">(</span>xUID<span class="token punctuation">,</span> vector<span class="token operator">&lt;</span>XnPoint3D<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hand_track_point<span class="token punctuation">.</span>second<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>project_pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>hands_track_points_<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>hand_track_point<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    void COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>HandUpdate<span class="token punctuation">(</span>HandsGenerator <span class="token operator">&amp;</span>rHands<span class="token punctuation">,</span> XnUserID xUID<span class="token punctuation">,</span> const XnPoint3D <span class="token operator">*</span>pPosition<span class="token punctuation">,</span> XnFloat fTime<span class="token punctuation">,</span> void <span class="token operator">*</span>pCookie<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        COpenNI <span class="token operator">*</span>openni <span class="token operator">=</span> <span class="token punctuation">(</span>COpenNI<span class="token operator">*</span><span class="token punctuation">)</span>pCookie<span class="token punctuation">;</span>
        XnPoint3D project_pos<span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>depth_generator_<span class="token punctuation">.</span>ConvertRealWorldToProjective<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> pPosition<span class="token punctuation">,</span> <span class="token operator">&amp;</span>project_pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>hand_points_<span class="token punctuation">.</span>find<span class="token punctuation">(</span>xUID<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>second <span class="token operator">=</span> project_pos<span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>hands_track_points_<span class="token punctuation">.</span>find<span class="token punctuation">(</span>xUID<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>second<span class="token punctuation">.</span>push_back<span class="token punctuation">(</span>project_pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    void COpenNI<span class="token punctuation">:</span><span class="token punctuation">:</span>HandDestroy<span class="token punctuation">(</span>HandsGenerator <span class="token operator">&amp;</span>rHands<span class="token punctuation">,</span> XnUserID xUID<span class="token punctuation">,</span> XnFloat fTime<span class="token punctuation">,</span> void <span class="token operator">*</span>pCookie<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        COpenNI <span class="token operator">*</span>openni <span class="token operator">=</span> <span class="token punctuation">(</span>COpenNI<span class="token operator">*</span><span class="token punctuation">)</span>pCookie<span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>hand_points_<span class="token punctuation">.</span>erase<span class="token punctuation">(</span>openni<span class="token operator">-</span><span class="token operator">&gt;</span>hand_points_<span class="token punctuation">.</span>find<span class="token punctuation">(</span>xUID<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        openni<span class="token operator">-</span><span class="token operator">&gt;</span>hands_track_points_<span class="token punctuation">.</span>erase<span class="token punctuation">(</span>openni<span class="token operator">-</span><span class="token operator">&gt;</span>hands_track_points_<span class="token punctuation">.</span>find<span class="token punctuation">(</span>xUID <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>



</code></pre> 
<h2><a id="3__591"></a>3 æ·±åº¦å­¦ä¹ æ–¹æ³•åšæ‰‹åŠ¿è¯†åˆ«</h2> 
<h3><a id="31__593"></a>3.1 ç»å…¸çš„å·ç§¯ç¥ç»ç½‘ç»œ</h3> 
<p>å·ç§¯ç¥ç»ç½‘ç»œçš„ä¼˜åŠ¿å°±åœ¨äºå®ƒèƒ½å¤Ÿä»å¸¸è§çš„è§†è§‰ä»»åŠ¡ä¸­è‡ªåŠ¨å­¦ä¹ ç›® æ ‡æ•°æ®çš„ç‰¹å¾ï¼Œ ç„¶åå°†è¿™äº›ç‰¹å¾ç”¨äºæŸç§ç‰¹å®šä»»åŠ¡çš„æ¨¡å‹ã€‚ éšç€æ—¶ä»£çš„å‘å±•ï¼Œ<br> æ·±åº¦å­¦ä¹ ä¹Ÿå½¢æˆäº†ä¸€äº›ç»å…¸çš„å·ç§¯ç¥ç»ç½‘ç»œã€‚</p> 
<h3><a id="32_YOLO_598"></a>3.2 YOLOç³»åˆ—</h3> 
<p>YOLO ç³»åˆ—çš„ç½‘ç»œæ¨¡å‹æœ€æ—©æºäº 2016 å¹´ï¼Œ ä¹‹åå‡ å¹´ç»è¿‡ä¸æ–­æ”¹è¿›ç›¸ç»§æ¨å‡ºYOLOv2ã€ YOLOv3<br> ç­‰ç½‘ç»œï¼Œç›´åˆ°ä»Šæ—¥yoloV5ä¹Ÿè¯ç”Ÿäº†ï¼Œä¸å¾—ä¸æ„Ÿæ…¨ä¸€å¥ï¼Œdarknetæ˜¯çœŸçš„è‚ã€‚</p> 
<p>æœ€å…·ä»£è¡¨æ€§çš„yolov3çš„ç»“æ„</p> 
<p><img src="https://images2.imgbox.com/fe/4c/wKpm6mcc_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="33_SSD_607"></a>3.3 SSD</h3> 
<p>SSD ä½œä¸ºå…¸å‹çš„ä¸€é˜¶æ®µç½‘ç»œæ¨¡å‹ï¼Œ å…·æœ‰æ›´é«˜çš„æ“ä½œæ€§ï¼Œ ç«¯åˆ°ç«¯çš„å­¦ä¹ æ¨¡å¼åŒæ ·å—åˆ°ä¼—å¤šç ”ç©¶è€…çš„å–œçˆ±</p> 
<p><img src="https://images2.imgbox.com/65/e1/eoAwgdx2_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="34__613"></a>3.4 å®ç°æ­¥éª¤</h3> 
<h4><a id="341__615"></a>3.4.1 æ•°æ®é›†</h4> 
<p>æ‰‹åŠ¿è¯†åˆ«çš„æ•°æ®é›†æ¥è‡ªäºä¸¹æˆå­¦é•¿å®éªŒå®¤ï¼Œç”±äºä¸­å›½æ‰‹åŠ¿è¡¨ç¤º3çš„æ‰‹åŠ¿æ ¹æ®åœ°åŒºæœ‰ç•¥å¾®å·®å¼‚ï¼ŒæŒ‰ç…§è¿™ä¸ªæ•°æ®é›†çš„æ‰‹åŠ¿è®­ç»ƒä¸æµ‹è¯•å³å¯ã€‚</p> 
<ul><li>å›¾åƒå¤§å°ï¼š100*100 åƒç´ </li><li>é¢œè‰²ç©ºé—´ï¼šRGB ç§ç±»ï¼š</li><li>å›¾ç‰‡ç§ç±»ï¼š6 ç§(0,1,2,3,4,5)</li><li>æ¯ç§å›¾ç‰‡æ•°é‡ï¼š200 å¼ </li></ul> 
<p><strong>ä¸€å…±6ç§æ‰‹åŠ¿ï¼Œæ¯ç§æ‰‹åŠ¿200å¼ å›¾ç‰‡ï¼Œå…±1200å¼ å›¾ç‰‡ï¼ˆ100x100RGBï¼‰</strong></p> 
<p><img src="https://images2.imgbox.com/07/4d/De9xIaKF_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="342__628"></a>3.4.2 å›¾åƒé¢„å¤„ç†</h4> 
<p><img src="https://images2.imgbox.com/9e/03/rYDLfXa0_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>å®é™…å›¾ç‰‡å¤„ç†å±•ç¤ºï¼šresizeå‰å…ˆé«˜æ–¯æ¨¡ç³Šï¼Œæå–è¾¹ç¼˜åå¯ä»¥æ ¹æ®å®é™…éœ€è¦å¢åŠ ä¸€æ¬¡ä¸­å€¼æ»¤æ³¢å»å™ªï¼š</strong></p> 
<p><img src="https://images2.imgbox.com/ad/ef/WvMyLuPa_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="343__636"></a>3.4.3 æ„å»ºå·ç§¯ç¥ç»ç½‘ç»œç»“æ„</h4> 
<p><strong>ä½¿ç”¨tensorflowçš„æ¡†æ¶ï¼Œæ„å»ºä¸€ä¸ªç®€å•çš„ç½‘ç»œç»“æ„</strong></p> 
<p><img src="https://images2.imgbox.com/6b/77/aaqwgUsH_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><img src="https://images2.imgbox.com/4e/b0/WtJX5jxi_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><strong>Dropoutï¼š å¢åŠ é²æ£’æ€§å¸®åŠ©æ­£åˆ™åŒ–å’Œé¿å…è¿‡æ‹Ÿåˆ</strong></p> 
<p>ä¸€ä¸ªç›¸å…³çš„æ—©æœŸä½¿ç”¨è¿™ç§æŠ€æœ¯çš„è®ºæ–‡ï¼ˆï¼ˆImageNet Classification with Deep Convolutional Neural<br> Networks, by Alex Krizhevsky, Ilya Sutskever, and Geoffrey Hinton<br> (2012).ï¼‰ï¼‰ä¸­å¯å‘æ€§çš„dropoutè§£é‡Šæ˜¯:</p> 
<p>å› ä¸ºä¸€ä¸ªç¥ç»å…ƒä¸èƒ½ä¾èµ–å…¶ä»–ç‰¹å®šçš„ç¥ç»å…ƒã€‚å› æ­¤ï¼Œä¸å¾—ä¸å»å­¦ä¹ éšæœºå­é›†ç¥ç»å…ƒé—´çš„é²æ£’æ€§çš„æœ‰ç”¨è¿æ¥ã€‚æ¢å¥è¯è¯´ã€‚æƒ³è±¡æˆ‘ä»¬çš„ç¥ç»å…ƒä½œä¸ºè¦ç»™é¢„æµ‹çš„æ¨¡å‹ï¼Œdropoutæ˜¯ä¸€ç§æ–¹å¼å¯ä»¥ç¡®ä¿æˆ‘ä»¬çš„æ¨¡å‹åœ¨ä¸¢å¤±ä¸€ä¸ªä¸ªä½“çº¿ç´¢çš„æƒ…å†µä¸‹ä¿æŒå¥å£®çš„æ¨¡å‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥è¯´ä»–çš„ä½œç”¨å’ŒL1å’ŒL2èŒƒå¼æ­£åˆ™åŒ–æ˜¯ç›¸åŒçš„ã€‚éƒ½æ˜¯æ¥å‡å°‘æƒé‡è¿æ¥ï¼Œç„¶åå¢åŠ ç½‘ç»œæ¨¡å‹åœ¨ç¼ºå¤±ä¸ªä½“è¿æ¥ä¿¡æ¯æƒ…å†µä¸‹çš„é²æ£’æ€§ã€‚åœ¨æé«˜ç¥ç»ç½‘ç»œè¡¨ç°æ–¹é¢æ•ˆæœè¾ƒå¥½ã€‚</p> 
<h4><a id="344__652"></a>3.4.4 å®éªŒè®­ç»ƒè¿‡ç¨‹åŠç»“æœ</h4> 
<p>ç»è¿‡çº¦4800è½®çš„è®­ç»ƒåï¼ŒlossåŸºæœ¬æ”¶æ•›ï¼Œåœ¨0.6å·¦å³ï¼Œåœ¨120ä»½çš„æµ‹è¯•æ ·æœ¬ä¸Šçš„æ¨¡å‹å‡†ç¡®ç‡èƒ½å¤Ÿè¾¾åˆ°çº¦96%</p> 
<p><img src="https://images2.imgbox.com/19/78/PS5CWqEX_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><img src="https://images2.imgbox.com/bf/10/IVD2wxac_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="35__660"></a>3.5 å…³é”®ä»£ç </h3> 
<p>â€‹</p> 
<pre><code class="prism language-python">
    <span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
    IMAGE_SIZE <span class="token operator">=</span> <span class="token number">100</span>
    NUM_CHANNELS <span class="token operator">=</span> <span class="token number">1</span>
    CONV1_SIZE <span class="token operator">=</span> <span class="token number">4</span>
    CONV1_KERNEL_NUM <span class="token operator">=</span> <span class="token number">8</span>
    CONV2_SIZE <span class="token operator">=</span> <span class="token number">2</span>
    CONV2_KERNEL_NUM <span class="token operator">=</span> <span class="token number">16</span>
    FC_SIZE <span class="token operator">=</span> <span class="token number">512</span>
    OUTPUT_NODE <span class="token operator">=</span> <span class="token number">6</span>
    
    <span class="token keyword">def</span> <span class="token function">get_weight</span><span class="token punctuation">(</span>shape<span class="token punctuation">,</span> regularizer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    	w <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>truncated_normal<span class="token punctuation">(</span>shape<span class="token punctuation">,</span>stddev<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    	<span class="token keyword">if</span> regularizer <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span> tf<span class="token punctuation">.</span>add_to_collection<span class="token punctuation">(</span><span class="token string">'losses'</span><span class="token punctuation">,</span> tf<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>l2_regularizer<span class="token punctuation">(</span>regularizer<span class="token punctuation">)</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span> 
    	<span class="token keyword">return</span> w
    
    <span class="token keyword">def</span> <span class="token function">get_bias</span><span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">:</span> 
    	b <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span>  
    	<span class="token keyword">return</span> b
    
    <span class="token keyword">def</span> <span class="token function">conv2d</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    	<span class="token keyword">return</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>x<span class="token punctuation">,</span> w<span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'SAME'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">max_pool_8x8</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    	<span class="token keyword">return</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>max_pool<span class="token punctuation">(</span>x<span class="token punctuation">,</span> ksize<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'SAME'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">max_pool_4x4</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>  
    	<span class="token keyword">return</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>max_pool<span class="token punctuation">(</span>x<span class="token punctuation">,</span> ksize<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'SAME'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> train<span class="token punctuation">,</span> regularizer<span class="token punctuation">)</span><span class="token punctuation">:</span>
        
        conv1_w <span class="token operator">=</span> get_weight<span class="token punctuation">(</span><span class="token punctuation">[</span>CONV1_SIZE<span class="token punctuation">,</span> CONV1_SIZE<span class="token punctuation">,</span> NUM_CHANNELS<span class="token punctuation">,</span> CONV1_KERNEL_NUM<span class="token punctuation">]</span><span class="token punctuation">,</span> regularizer<span class="token punctuation">)</span> 
        conv1_b <span class="token operator">=</span> get_bias<span class="token punctuation">(</span><span class="token punctuation">[</span>CONV1_KERNEL_NUM<span class="token punctuation">]</span><span class="token punctuation">)</span> 
        conv1 <span class="token operator">=</span> conv2d<span class="token punctuation">(</span>x<span class="token punctuation">,</span> conv1_w<span class="token punctuation">)</span> 
        relu1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>bias_add<span class="token punctuation">(</span>conv1<span class="token punctuation">,</span> conv1_b<span class="token punctuation">)</span><span class="token punctuation">)</span> 
        pool1 <span class="token operator">=</span> max_pool_8x8<span class="token punctuation">(</span>relu1<span class="token punctuation">)</span> 
    
        conv2_w <span class="token operator">=</span> get_weight<span class="token punctuation">(</span><span class="token punctuation">[</span>CONV2_SIZE<span class="token punctuation">,</span> CONV2_SIZE<span class="token punctuation">,</span> CONV1_KERNEL_NUM<span class="token punctuation">,</span> CONV2_KERNEL_NUM<span class="token punctuation">]</span><span class="token punctuation">,</span>regularizer<span class="token punctuation">)</span> 
        conv2_b <span class="token operator">=</span> get_bias<span class="token punctuation">(</span><span class="token punctuation">[</span>CONV2_KERNEL_NUM<span class="token punctuation">]</span><span class="token punctuation">)</span>
        conv2 <span class="token operator">=</span> conv2d<span class="token punctuation">(</span>pool1<span class="token punctuation">,</span> conv2_w<span class="token punctuation">)</span> 
        relu2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>bias_add<span class="token punctuation">(</span>conv2<span class="token punctuation">,</span> conv2_b<span class="token punctuation">)</span><span class="token punctuation">)</span>
        pool2 <span class="token operator">=</span> max_pool_4x4<span class="token punctuation">(</span>relu2<span class="token punctuation">)</span>
    
        pool_shape <span class="token operator">=</span> pool2<span class="token punctuation">.</span>get_shape<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>as_list<span class="token punctuation">(</span><span class="token punctuation">)</span> 
        nodes <span class="token operator">=</span> pool_shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> pool_shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> pool_shape<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> 
        reshaped <span class="token operator">=</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>pool2<span class="token punctuation">,</span> <span class="token punctuation">[</span>pool_shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> nodes<span class="token punctuation">]</span><span class="token punctuation">)</span> 
    
        fc1_w <span class="token operator">=</span> get_weight<span class="token punctuation">(</span><span class="token punctuation">[</span>nodes<span class="token punctuation">,</span> FC_SIZE<span class="token punctuation">]</span><span class="token punctuation">,</span> regularizer<span class="token punctuation">)</span> 
        fc1_b <span class="token operator">=</span> get_bias<span class="token punctuation">(</span><span class="token punctuation">[</span>FC_SIZE<span class="token punctuation">]</span><span class="token punctuation">)</span> 
        fc1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>reshaped<span class="token punctuation">,</span> fc1_w<span class="token punctuation">)</span> <span class="token operator">+</span> fc1_b<span class="token punctuation">)</span> 
        <span class="token keyword">if</span> train<span class="token punctuation">:</span> fc1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>fc1<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
    
        fc2_w <span class="token operator">=</span> get_weight<span class="token punctuation">(</span><span class="token punctuation">[</span>FC_SIZE<span class="token punctuation">,</span> OUTPUT_NODE<span class="token punctuation">]</span><span class="token punctuation">,</span> regularizer<span class="token punctuation">)</span>
        fc2_b <span class="token operator">=</span> get_bias<span class="token punctuation">(</span><span class="token punctuation">[</span>OUTPUT_NODE<span class="token punctuation">]</span><span class="token punctuation">)</span>
        y <span class="token operator">=</span> tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>fc1<span class="token punctuation">,</span> fc2_w<span class="token punctuation">)</span> <span class="token operator">+</span> fc2_b
        <span class="token keyword">return</span> y 


    <span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
    <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
    <span class="token keyword">import</span> gesture_forward
    <span class="token keyword">import</span> gesture_backward
    <span class="token keyword">from</span> image_processing <span class="token keyword">import</span> func5<span class="token punctuation">,</span>func6
    <span class="token keyword">import</span> cv2
    
    <span class="token keyword">def</span> <span class="token function">restore_model</span><span class="token punctuation">(</span>testPicArr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> tf<span class="token punctuation">.</span>Graph<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>as_default<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tg<span class="token punctuation">:</span>
            
            x <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span><span class="token punctuation">[</span>
                <span class="token number">1</span><span class="token punctuation">,</span>
                gesture_forward<span class="token punctuation">.</span>IMAGE_SIZE<span class="token punctuation">,</span>
                gesture_forward<span class="token punctuation">.</span>IMAGE_SIZE<span class="token punctuation">,</span>
                gesture_forward<span class="token punctuation">.</span>NUM_CHANNELS<span class="token punctuation">]</span><span class="token punctuation">)</span>    
            <span class="token comment">#y_ = tf.placeholder(tf.float32, [None, mnist_lenet5_forward.OUTPUT_NODE])</span>
            y <span class="token operator">=</span> gesture_forward<span class="token punctuation">.</span>forward<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token boolean">None</span><span class="token punctuation">)</span>
            
            preValue <span class="token operator">=</span> tf<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    
            variable_averages <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>ExponentialMovingAverage<span class="token punctuation">(</span>gesture_backward<span class="token punctuation">.</span>MOVING_AVERAGE_DECAY<span class="token punctuation">)</span>
            variables_to_restore <span class="token operator">=</span> variable_averages<span class="token punctuation">.</span>variables_to_restore<span class="token punctuation">(</span><span class="token punctuation">)</span>
            saver <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Saver<span class="token punctuation">(</span>variables_to_restore<span class="token punctuation">)</span>
            
            <span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
                ckpt <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>get_checkpoint_state<span class="token punctuation">(</span>gesture_backward<span class="token punctuation">.</span>MODEL_SAVE_PATH<span class="token punctuation">)</span>
                <span class="token keyword">if</span> ckpt <span class="token keyword">and</span> ckpt<span class="token punctuation">.</span>model_checkpoint_path<span class="token punctuation">:</span>
                    saver<span class="token punctuation">.</span>restore<span class="token punctuation">(</span>sess<span class="token punctuation">,</span> ckpt<span class="token punctuation">.</span>model_checkpoint_path<span class="token punctuation">)</span>
                    <span class="token comment">#global_step = ckpt.model_checkpoint_path.split('/')[-1].split('-')[-1] </span>
                    preValue <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>preValue<span class="token punctuation">,</span> feed_dict<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">:</span>testPicArr<span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> preValue
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"No checkpoint file found"</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>


    <span class="token keyword">def</span> <span class="token function">application01</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        testNum <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"input the number of test pictures:"</span><span class="token punctuation">)</span>
        testNum <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>testNum<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>testNum<span class="token punctuation">)</span><span class="token punctuation">:</span>
            testPic <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"the path of test picture:"</span><span class="token punctuation">)</span>
            img <span class="token operator">=</span> func5<span class="token punctuation">(</span>testPic<span class="token punctuation">)</span>
            cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'ttt.jpg'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span>   
    <span class="token comment">#        cv2.waitKey(0)</span>
    <span class="token comment">#        cv2.destroyAllWindows()</span>
            img <span class="token operator">=</span> img<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            img <span class="token operator">=</span> img<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
            img <span class="token operator">=</span> np<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">)</span>
    <span class="token comment">#        print(img.shape)</span>
    <span class="token comment">#        print(type(img))        </span>
            preValue <span class="token operator">=</span> restore_model<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
            <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"The prediction number is:"</span><span class="token punctuation">,</span> preValue<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">application02</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        
        <span class="token comment">#vc = cv2.VideoCapture('testVideo.mp4')</span>
        vc <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment"># è®¾ç½®æ¯ç§’ä¼ è¾“å¸§æ•°</span>
        fps <span class="token operator">=</span> vc<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FPS<span class="token punctuation">)</span>
        <span class="token comment"># è·å–è§†é¢‘çš„å¤§å°</span>
        size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>vc<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_WIDTH<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>vc<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_FRAME_HEIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># ç”Ÿæˆä¸€ä¸ªç©ºçš„è§†é¢‘æ–‡ä»¶</span>
        <span class="token comment"># è§†é¢‘ç¼–ç ç±»å‹</span>
        <span class="token comment"># cv2.VideoWriter_fourcc('X','V','I','D') MPEG-4 ç¼–ç ç±»å‹</span>
        <span class="token comment"># cv2.VideoWriter_fourcc('I','4','2','0') YUYç¼–ç ç±»å‹</span>
        <span class="token comment"># cv2.VideoWriter_fourcc('P','I','M','I') MPEG-1 ç¼–ç ç±»å‹</span>
        <span class="token comment"># cv2.VideoWriter_fourcc('T','H','E','O') Ogg Vorbisç±»å‹ï¼Œæ–‡ä»¶åä¸º.ogv</span>
        <span class="token comment"># cv2.VideoWriter_fourcc('F','L','V','1') Flaskè§†é¢‘ï¼Œæ–‡ä»¶åä¸º.flv</span>
        <span class="token comment">#vw = cv2.VideoWriter('ges_pro.avi',cv2.VideoWriter_fourcc('X','V','I','D'), fps, size)</span>
        <span class="token comment"># è¯»å–è§†é¢‘ç¬¬ä¸€å¸§çš„å†…å®¹</span>
        success<span class="token punctuation">,</span> frame <span class="token operator">=</span> vc<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#    rows = frame.shape[0]    </span>
    <span class="token comment">#    cols = frame.shape[1]</span>
    <span class="token comment">#    t1 = int((cols-rows)/2)</span>
    <span class="token comment">#    t2 = int(cols-t1)</span>
    <span class="token comment">#    M = cv2.getRotationMatrix2D((cols/2,rows/2),90,1)</span>
    <span class="token comment">#    frame = cv2.warpAffine(frame,M,(cols,rows))</span>
    <span class="token comment">#    frame = frame[0:rows, t1:t2]</span>
    <span class="token comment">#    cv2.imshow('sd',frame)</span>
    <span class="token comment">#    cv2.waitKey(0)</span>
    <span class="token comment">#    cv2.destroyAllWindows()</span>
        <span class="token keyword">while</span> success<span class="token punctuation">:</span>
            
            <span class="token comment">#90åº¦æ—‹è½¬        </span>
    <span class="token comment">#        img = cv2.warpAffine(frame,M,(cols,rows))</span>
    <span class="token comment">#        img = img[0:rows, t1:t2]</span>
            img <span class="token operator">=</span> func6<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>
            img <span class="token operator">=</span> img<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            img <span class="token operator">=</span> img<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
            img <span class="token operator">=</span> np<span class="token punctuation">.</span>multiply<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token operator">/</span><span class="token number">255.0</span><span class="token punctuation">)</span>
            preValue <span class="token operator">=</span> restore_model<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
            <span class="token comment"># å†™å…¥è§†é¢‘</span>
            cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>frame<span class="token punctuation">,</span><span class="token string">"Gesture:"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>preValue<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>FONT_HERSHEY_PLAIN<span class="token punctuation">,</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token comment">#vw.write(frame)</span>
            cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'gesture'</span><span class="token punctuation">,</span>frame<span class="token punctuation">)</span>
            <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">break</span>
            <span class="token comment"># è¯»å–è§†é¢‘ä¸‹ä¸€å¸§çš„å†…å®¹</span>
            success<span class="token punctuation">,</span> frame <span class="token operator">=</span> vc<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        vc<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>    
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'viedo app over!'</span><span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#application01()</span>
        application02<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
    <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    	main<span class="token punctuation">(</span><span class="token punctuation">)</span>	


</code></pre> 
<h2><a id="4__840"></a>4 æœ€å</h2> 
<p>ğŸ§¿ <strong>æ›´å¤šèµ„æ–™, é¡¹ç›®åˆ†äº«ï¼š</strong></p> 
<p><a href="https://gitee.com/dancheng-senior/postgraduate" rel="nofollow">https://gitee.com/dancheng-senior/postgraduate</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/879972b236d4c6ccf0526728e7ff1bb6/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">å‘ç°ä¼ ç»Ÿä¹‹ç¾ï¼ŒAIèµ‹èƒ½éé—ä¼ æ‰¿</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4919e40190b1d34a5eaafa950559c1c7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">Stable Diffusionã€åº”ç”¨ç¯‡ã€‘ã€è‰ºæœ¯å†™çœŸã€‘ï¼šAIå†™çœŸçœ‹è¿‡æ¥ï¼Œä½¿ç”¨IP-Adapter-FaceIdæ’ä»¶å®ç°AIå†™çœŸ</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>