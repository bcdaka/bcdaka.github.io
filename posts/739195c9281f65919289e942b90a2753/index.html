<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python 爬虫入门（四）：使用 pandas 处理和分析数据 「详细介绍」 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/739195c9281f65919289e942b90a2753/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Python 爬虫入门（四）：使用 pandas 处理和分析数据 「详细介绍」">
  <meta property="og:description" content="Python 爬虫入门（四）：使用 pandas 处理和分析数据 「详细介绍」 前言1. pandas简介1.1 什么是pandas?1.2 为什么要使用pandas?1.3 安装 Pandas 2. pandas的核心概念2.1 Series2.2 DataFrame2.3 索引 3. 数据导入和导出3.1 从CSV文件读取数据3.2 从Excel文件读取数据3.3 导出数据到CSV3.4 导出数据到Excel 4. 数据清洗4.1 处理缺失值4.2 删除重复数据4.3 重命名列 5. 数据转换5.1 选择和过滤5.2 排序5.3 分组和聚合5.4 合并数据 6. 时间序列操作6.1 创建日期范围6.2 重采样6.3 移动窗口计算 7. 数据可视化7.1 绘制折线图7.2 绘制柱状图7.3 绘制散点图 8. 高级功能8.1 多层索引8.2 透视表8.3 类别数据 9. 性能优化9.1 使用适当的数据类型9.2 使用迭代器处理大数据集9.3 使用内置的矢量化操作 10. 实战案例：分析爬虫数据10.1 导入数据10.2 数据清洗10.3 数据分析10.4 数据可视化10.5 导出结果 11. 注意事项和最佳实践 总结 前言 欢迎来到&#34;Python 爬虫入门&#34;系列的第四篇文章。在前面的教程中,我们学习了如何抓取网页数据。但是获取数据只是第一步,如何高效地处理和分析这些数据同样重要。这就是我们今天要学习的内容 - 使用pandas库进行数据处理。pandas是Python中最强大的数据分析工具之一。它提供了高性能、易用的数据结构和数据分析工具。不管你是数据科学家、金融分析师,还是网络爬虫开发者,pandas都是一个不可或缺的工具。在这篇文章里,我们会深入探讨pandas的核心概念,学习如何使用pandas处理爬虫获取的数据,以及如何进行数据清洗、转换和分析。即使你是pandas新手,也不用担心,我们会从最基础的知识开始,一步步带你掌握pandas的使用技巧。 1. pandas简介 1.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-30T14:24:43+08:00">
    <meta property="article:modified_time" content="2024-07-30T14:24:43+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python 爬虫入门（四）：使用 pandas 处理和分析数据 「详细介绍」</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Python 爬虫入门（四）：使用 pandas 处理和分析数据 「详细介绍」</h4> 
 <ul><li><a href="#_2" rel="nofollow">前言</a></li><li><ul><li><a href="#1_pandas_8" rel="nofollow">1. pandas简介</a></li><li><ul><li><a href="#11_pandas_10" rel="nofollow">1.1 什么是pandas?</a></li><li><a href="#12_pandas_16" rel="nofollow">1.2 为什么要使用pandas?</a></li><li><a href="#13__Pandas_30" rel="nofollow">1.3 安装 Pandas</a></li></ul> 
   </li><li><a href="#2_pandas_45" rel="nofollow">2. pandas的核心概念</a></li><li><ul><li><a href="#21_Series_47" rel="nofollow">2.1 Series</a></li><li><a href="#22_DataFrame_63" rel="nofollow">2.2 DataFrame</a></li><li><a href="#23__85" rel="nofollow">2.3 索引</a></li></ul> 
   </li><li><a href="#3__95" rel="nofollow">3. 数据导入和导出</a></li><li><ul><li><a href="#31_CSV_97" rel="nofollow">3.1 从CSV文件读取数据</a></li><li><a href="#32_Excel_104" rel="nofollow">3.2 从Excel文件读取数据</a></li><li><a href="#33_CSV_111" rel="nofollow">3.3 导出数据到CSV</a></li><li><a href="#34_Excel_118" rel="nofollow">3.4 导出数据到Excel</a></li></ul> 
   </li><li><a href="#4__125" rel="nofollow">4. 数据清洗</a></li><li><ul><li><a href="#41__127" rel="nofollow">4.1 处理缺失值</a></li><li><a href="#42__137" rel="nofollow">4.2 删除重复数据</a></li><li><a href="#43__144" rel="nofollow">4.3 重命名列</a></li></ul> 
   </li><li><a href="#5__151" rel="nofollow">5. 数据转换</a></li><li><ul><li><a href="#51__153" rel="nofollow">5.1 选择和过滤</a></li><li><a href="#52__163" rel="nofollow">5.2 排序</a></li><li><a href="#53__173" rel="nofollow">5.3 分组和聚合</a></li><li><a href="#54__180" rel="nofollow">5.4 合并数据</a></li></ul> 
   </li><li><a href="#6__190" rel="nofollow">6. 时间序列操作</a></li><li><ul><li><a href="#61__192" rel="nofollow">6.1 创建日期范围</a></li><li><a href="#62__199" rel="nofollow">6.2 重采样</a></li><li><a href="#63__206" rel="nofollow">6.3 移动窗口计算</a></li></ul> 
   </li><li><a href="#7__213" rel="nofollow">7. 数据可视化</a></li><li><ul><li><a href="#71__217" rel="nofollow">7.1 绘制折线图</a></li><li><a href="#72__223" rel="nofollow">7.2 绘制柱状图</a></li><li><a href="#73__229" rel="nofollow">7.3 绘制散点图</a></li></ul> 
   </li><li><a href="#8__235" rel="nofollow">8. 高级功能</a></li><li><ul><li><a href="#81__237" rel="nofollow">8.1 多层索引</a></li><li><a href="#82__249" rel="nofollow">8.2 透视表</a></li><li><a href="#83__263" rel="nofollow">8.3 类别数据</a></li></ul> 
   </li><li><a href="#9__273" rel="nofollow">9. 性能优化</a></li><li><ul><li><a href="#91__275" rel="nofollow">9.1 使用适当的数据类型</a></li><li><a href="#92__285" rel="nofollow">9.2 使用迭代器处理大数据集</a></li><li><a href="#93__296" rel="nofollow">9.3 使用内置的矢量化操作</a></li></ul> 
   </li><li><a href="#10__309" rel="nofollow">10. 实战案例：分析爬虫数据</a></li><li><ul><li><a href="#101__313" rel="nofollow">10.1 导入数据</a></li><li><a href="#102__324" rel="nofollow">10.2 数据清洗</a></li><li><a href="#103__337" rel="nofollow">10.3 数据分析</a></li><li><a href="#104__353" rel="nofollow">10.4 数据可视化</a></li><li><a href="#105__375" rel="nofollow">10.5 导出结果</a></li></ul> 
   </li><li><a href="#11__384" rel="nofollow">11. 注意事项和最佳实践</a></li></ul> 
  </li><li><a href="#_406" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>前言</h2> 
<blockquote> 
 <ul><li>欢迎来到"Python 爬虫入门"系列的第四篇文章。在前面的教程中,我们学习了如何抓取网页数据。但是获取数据只是第一步,如何高效地处理和分析这些数据同样重要。这就是我们今天要学习的内容 - 使用pandas库进行数据处理。</li><li>pandas是Python中最强大的数据分析工具之一。它提供了高性能、易用的数据结构和数据分析工具。不管你是数据科学家、金融分析师,还是网络爬虫开发者,pandas都是一个不可或缺的工具。</li><li>在这篇文章里,我们会深入探讨pandas的核心概念,学习如何使用pandas处理爬虫获取的数据,以及如何进行数据清洗、转换和分析。即使你是pandas新手,也不用担心,我们会从最基础的知识开始,一步步带你掌握pandas的使用技巧。</li></ul> 
</blockquote> 
<h3><a id="1_pandas_8"></a>1. pandas简介</h3> 
<h4><a id="11_pandas_10"></a>1.1 什么是pandas?</h4> 
<blockquote> 
 <p>pandas是一个开源的,BSD许可的库,为Python编程语言提供高性能,易于使用的数据结构和数据分析工具。</p> 
</blockquote> 
<p>pandas的名字来源于"panel data"(面板数据)的缩写,最初是为了处理金融数据而开发的。但是,由于其强大的功能和灵活性,它很快成为了各个领域数据分析的首选工具。</p> 
<h4><a id="12_pandas_16"></a>1.2 为什么要使用pandas?</h4> 
<p>pandas为数据处理提供了许多优势:</p> 
<ol><li> <p><strong>高效的数据结构</strong>: pandas提供了DataFrame和Series等数据结构,可以高效地处理大量数据。</p> </li><li> <p><strong>数据清洗</strong>: pandas提供了丰富的工具来处理缺失数据、重复数据等常见问题。</p> </li><li> <p><strong>数据转换</strong>: 可以轻松地重塑数据,进行聚合、合并等操作。</p> </li><li> <p><strong>时间序列功能</strong>: 对于时间序列数据,pandas提供了专门的处理工具。</p> </li><li> <p><strong>与其他库的集成</strong>: pandas可以很好地与NumPy、Matplotlib等其他科学计算库集成。</p> </li></ol> 
<h4><a id="13__Pandas_30"></a>1.3 安装 Pandas</h4> 
<p>通过 pip 来安装：</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> pandas
</code></pre> 
<p>如果你使用的是 Anaconda 环境，Pandas 可能已经预装好了，如果没有，你也可以使用 conda 来安装：</p> 
<pre><code class="prism language-bash">conda <span class="token function">install</span> pandas
</code></pre> 
<p>如果不确定是否已经安装了 Pandas 或者想要检查其版本，可以使用以下命令：</p> 
<pre><code class="prism language-bash">pip show pandas
</code></pre> 
<h3><a id="2_pandas_45"></a>2. pandas的核心概念</h3> 
<h4><a id="21_Series_47"></a>2.1 Series</h4> 
<p>Series是pandas中的一维标记数组,可以存储各种数据类型(整数、浮点数、字符串等)。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment"># 创建一个Series</span>
s <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
</code></pre> 
<p>输出:<br> <img src="https://images2.imgbox.com/71/98/xuWWjyK7_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="22_DataFrame_63"></a>2.2 DataFrame</h4> 
<p>DataFrame是一个二维标记数据结构,有列和索引。你可以把它看作是一个Excel表格或SQL表。</p> 
<pre><code class="prism language-python"><span class="token comment"># 创建一个DataFrame</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">'B'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Timestamp<span class="token punctuation">(</span><span class="token string">'20130102'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'C'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'float32'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'D'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'int32'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'E'</span><span class="token punctuation">:</span> pd<span class="token punctuation">.</span>Categorical<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token string">"train"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token string">"train"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'F'</span><span class="token punctuation">:</span> <span class="token string">'foo'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>
</code></pre> 
<p>输出:<br> <img src="https://images2.imgbox.com/25/bd/AUPLEW3c_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="23__85"></a>2.3 索引</h4> 
<p>索引是pandas中非常重要的概念。它允许你通过标签来访问数据,而不仅仅是通过位置。</p> 
<pre><code class="prism language-python"><span class="token comment"># 使用索引访问数据</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="3__95"></a>3. 数据导入和导出</h3> 
<h4><a id="31_CSV_97"></a>3.1 从CSV文件读取数据</h4> 
<pre><code class="prism language-python"><span class="token comment"># 从CSV文件读取数据</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'data.csv'</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="32_Excel_104"></a>3.2 从Excel文件读取数据</h4> 
<pre><code class="prism language-python"><span class="token comment"># 从Excel文件读取数据</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">'data.xlsx'</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="33_CSV_111"></a>3.3 导出数据到CSV</h4> 
<pre><code class="prism language-python"><span class="token comment"># 导出数据到CSV</span>
df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'output.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="34_Excel_118"></a>3.4 导出数据到Excel</h4> 
<pre><code class="prism language-python"><span class="token comment"># 导出数据到Excel</span>
df<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span><span class="token string">'output.xlsx'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="4__125"></a>4. 数据清洗</h3> 
<h4><a id="41__127"></a>4.1 处理缺失值</h4> 
<pre><code class="prism language-python"><span class="token comment"># 删除包含缺失值的行</span>
df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 填充缺失值</span>
df<span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="42__137"></a>4.2 删除重复数据</h4> 
<pre><code class="prism language-python"><span class="token comment"># 删除重复行</span>
df<span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="43__144"></a>4.3 重命名列</h4> 
<pre><code class="prism language-python"><span class="token comment"># 重命名列</span>
df<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'old_name'</span><span class="token punctuation">:</span> <span class="token string">'new_name'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="5__151"></a>5. 数据转换</h3> 
<h4><a id="51__153"></a>5.1 选择和过滤</h4> 
<pre><code class="prism language-python"><span class="token comment"># 选择特定的列</span>
df<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token comment"># 根据条件过滤行</span>
df<span class="token punctuation">[</span>df<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span>
</code></pre> 
<h4><a id="52__163"></a>5.2 排序</h4> 
<pre><code class="prism language-python"><span class="token comment"># 按值排序</span>
df<span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">)</span>

<span class="token comment"># 按索引排序</span>
df<span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="53__173"></a>5.3 分组和聚合</h4> 
<pre><code class="prism language-python"><span class="token comment"># 分组并计算平均值</span>
df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="54__180"></a>5.4 合并数据</h4> 
<pre><code class="prism language-python"><span class="token comment"># 合并两个DataFrame</span>
pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>df1<span class="token punctuation">,</span> df2<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 基于键合并</span>
pd<span class="token punctuation">.</span>merge<span class="token punctuation">(</span>df1<span class="token punctuation">,</span> df2<span class="token punctuation">,</span> on<span class="token operator">=</span><span class="token string">'key'</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="6__190"></a>6. 时间序列操作</h3> 
<h4><a id="61__192"></a>6.1 创建日期范围</h4> 
<pre><code class="prism language-python"><span class="token comment"># 创建日期范围</span>
dates <span class="token operator">=</span> pd<span class="token punctuation">.</span>date_range<span class="token punctuation">(</span><span class="token string">'20130101'</span><span class="token punctuation">,</span> periods<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="62__199"></a>6.2 重采样</h4> 
<pre><code class="prism language-python"><span class="token comment"># 将日数据重采样为月数据</span>
df<span class="token punctuation">.</span>resample<span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="63__206"></a>6.3 移动窗口计算</h4> 
<pre><code class="prism language-python"><span class="token comment"># 计算移动平均</span>
df<span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>rolling<span class="token punctuation">(</span>window<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="7__213"></a>7. 数据可视化</h3> 
<p>pandas与Matplotlib无缝集成,可以轻松创建各种图表。</p> 
<h4><a id="71__217"></a>7.1 绘制折线图</h4> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">'line'</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="72__223"></a>7.2 绘制柱状图</h4> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="73__229"></a>7.3 绘制散点图</h4> 
<pre><code class="prism language-python">df<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">'scatter'</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token string">'A'</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token string">'B'</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="8__235"></a>8. 高级功能</h3> 
<h4><a id="81__237"></a>8.1 多层索引</h4> 
<p>多层索引允许你在一个轴上有多个索引级别。</p> 
<pre><code class="prism language-python">arrays <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'qux'</span><span class="token punctuation">,</span> <span class="token string">'qux'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">[</span><span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">,</span> <span class="token string">'one'</span><span class="token punctuation">,</span> <span class="token string">'two'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
index <span class="token operator">=</span> pd<span class="token punctuation">.</span>MultiIndex<span class="token punctuation">.</span>from_arrays<span class="token punctuation">(</span>arrays<span class="token punctuation">,</span> names<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'first'</span><span class="token punctuation">,</span> <span class="token string">'second'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token operator">=</span>index<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'D'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="82__249"></a>8.2 透视表</h4> 
<p>透视表是一种汇总统计的方式,可以快速创建交叉表。</p> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"A"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token string">"foo"</span><span class="token punctuation">,</span> <span class="token string">"bar"</span><span class="token punctuation">,</span> <span class="token string">"bar"</span><span class="token punctuation">,</span> <span class="token string">"bar"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                   <span class="token string">"B"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"one"</span><span class="token punctuation">,</span> <span class="token string">"one"</span><span class="token punctuation">,</span> <span class="token string">"two"</span><span class="token punctuation">,</span> <span class="token string">"two"</span><span class="token punctuation">,</span> <span class="token string">"one"</span><span class="token punctuation">,</span> <span class="token string">"one"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                   <span class="token string">"C"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"x"</span><span class="token punctuation">,</span> <span class="token string">"y"</span><span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token punctuation">,</span> <span class="token string">"y"</span><span class="token punctuation">,</span> <span class="token string">"x"</span><span class="token punctuation">,</span> <span class="token string">"y"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                   <span class="token string">"D"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

table <span class="token operator">=</span> pd<span class="token punctuation">.</span>pivot_table<span class="token punctuation">(</span>df<span class="token punctuation">,</span> values<span class="token operator">=</span><span class="token string">'D'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'C'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="83__263"></a>8.3 类别数据</h4> 
<p>pandas提供了Categorical数据类型,用于处理类别变量。</p> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"id"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"raw_grade"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df<span class="token punctuation">[</span><span class="token string">"grade"</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">"raw_grade"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">"category"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">"grade"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="9__273"></a>9. 性能优化</h3> 
<h4><a id="91__275"></a>9.1 使用适当的数据类型</h4> 
<p>选择正确的数据类型可以显著提高性能和减少内存使用。</p> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'a'</span><span class="token punctuation">:</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
df<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'int8'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>memory_usage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="92__285"></a>9.2 使用迭代器处理大数据集</h4> 
<p>对于非常大的数据集,可以使用迭代器来避免一次性将所有数据加载到内存。</p> 
<pre><code class="prism language-python">chunksize <span class="token operator">=</span> <span class="token number">10000</span>
<span class="token keyword">for</span> chunk <span class="token keyword">in</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'large_file.csv'</span><span class="token punctuation">,</span> chunksize<span class="token operator">=</span>chunksize<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 处理每一个chunk</span>
    process<span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="93__296"></a>9.3 使用内置的矢量化操作</h4> 
<p>尽可能使用pandas的内置函数和方法,而不是Python的循环。</p> 
<pre><code class="prism language-python"><span class="token comment"># 不推荐</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token string">'new_col'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token string">'col1'</span><span class="token punctuation">]</span> <span class="token operator">+</span> df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token string">'col2'</span><span class="token punctuation">]</span>

<span class="token comment"># 推荐</span>
df<span class="token punctuation">[</span><span class="token string">'new_col'</span><span class="token punctuation">]</span> <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'col1'</span><span class="token punctuation">]</span> <span class="token operator">+</span> df<span class="token punctuation">[</span><span class="token string">'col2'</span><span class="token punctuation">]</span>
</code></pre> 
<h3><a id="10__309"></a>10. 实战案例：分析爬虫数据</h3> 
<p>让我们用一个实际的例子来综合运用我们学到的知识。假设我们已经从一个电商网站爬取了一些产品数据,现在要对这些数据进行分析。</p> 
<h4><a id="101__313"></a>10.1 导入数据</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 假设我们的数据保存在products.csv文件中</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'products.csv'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>df<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="102__324"></a>10.2 数据清洗</h4> 
<pre><code class="prism language-python"><span class="token comment"># 删除缺失值</span>
df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 将价格转换为数值类型</span>
df<span class="token punctuation">[</span><span class="token string">'price'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>to_numeric<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'price'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'$'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'coerce'</span><span class="token punctuation">)</span>

<span class="token comment"># 删除重复数据</span>
df<span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="103__337"></a>10.3 数据分析</h4> 
<pre><code class="prism language-python"><span class="token comment"># 计算每个类别的平均价格</span>
category_avg_price <span class="token operator">=</span> df<span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token string">'category'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'price'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sort_values<span class="token punctuation">(</span>ascending<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>category_avg_price<span class="token punctuation">)</span>

<span class="token comment"># 找出评分最高的10个产品</span>
top_rated <span class="token operator">=</span> df<span class="token punctuation">.</span>nlargest<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">'rating'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>top_rated<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'rating'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 计算价格和评分的相关性</span>
correlation <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token string">'price'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>corr<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'rating'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"价格和评分的相关系数: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>correlation<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="104__353"></a>10.4 数据可视化</h4> 
<pre><code class="prism language-python"><span class="token comment"># 绘制类别平均价格的条形图</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
category_avg_price<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>kind<span class="token operator">=</span><span class="token string">'bar'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Average Price by Category'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Category'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Average Price'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>rotation<span class="token operator">=</span><span class="token number">45</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>tight_layout<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 绘制价格和评分的散点图</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'price'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> df<span class="token punctuation">[</span><span class="token string">'rating'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Price vs Rating'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'Price'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'Rating'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="105__375"></a>10.5 导出结果</h4> 
<pre><code class="prism language-python"><span class="token comment"># 将分析结果导出到Excel文件</span>
<span class="token keyword">with</span> pd<span class="token punctuation">.</span>ExcelWriter<span class="token punctuation">(</span><span class="token string">'analysis_results.xlsx'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> writer<span class="token punctuation">:</span>
    category_avg_price<span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>writer<span class="token punctuation">,</span> sheet_name<span class="token operator">=</span><span class="token string">'Category Avg Price'</span><span class="token punctuation">)</span>
    top_rated<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'rating'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to_excel<span class="token punctuation">(</span>writer<span class="token punctuation">,</span> sheet_name<span class="token operator">=</span><span class="token string">'Top Rated Products'</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="11__384"></a>11. 注意事项和最佳实践</h3> 
<ol><li> <p><strong>内存管理</strong>: 处理大数据集时要注意内存使用。使用chunksize参数分批读取数据,或者使用适当的数据类型来减少内存占用。</p> </li><li> <p><strong>性能优化</strong>: 尽量使用向量化操作而不是循环,这样可以显著提高性能。</p> </li><li> <p><strong>数据类型</strong>: 选择合适的数据类型可以提高性能并节省内存。例如,对于整数列,可以使用int8或int16而不是默认的int64。</p> </li><li> <p><strong>索引</strong>: 合理使用索引可以提高查询和排序的性能。但是,过多的索引也会增加内存使用和数据修改的开销。</p> </li><li> <p><strong>处理大文件</strong>: 对于非常大的文件,考虑使用迭代器或分块处理,而不是一次性将整个文件加载到内存中。</p> </li><li> <p><strong>数据清洗</strong>: 在进行任何分析之前,一定要仔细检查和清洗数据。处理缺失值、异常值和重复数据是很重要的步骤。</p> </li><li> <p><strong>文档和注释</strong>: 为你的代码添加清晰的注释和文档,这对于后续的维护和协作非常重要。</p> </li><li> <p><strong>版本兼容性</strong>: 注意pandas的版本兼容性问题。某些函数和方法可能在不同版本中有所变化。</p> </li><li> <p><strong>数据备份</strong>: 在对数据进行修改操作之前,最好先备份原始数据。</p> </li><li> <p><strong>定期保存</strong>: 在处理大量数据或进行长时间运算时,定期保存中间结果是个好习惯。</p> </li></ol> 
<h2><a id="_406"></a>总结</h2> 
<p>通过这篇文章的学习，相信你应该能够更深入地理解pandas的功能，并能够将其应用于自己的项目中，以提高数据处理和分析的效率和效果。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/741b3701103f736a40f8ed46fcbcefa8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java二十三种设计模式-代理模式（8/23）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bb7623bdbf9fcd8e99c7d75947c4d669/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【AI大模型】：结合wxauto实现智能微信聊天机器人</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>