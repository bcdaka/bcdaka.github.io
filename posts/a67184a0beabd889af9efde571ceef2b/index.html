<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Javaå¾®æœåŠ¡åˆ†å¸ƒå¼åˆ†åº“åˆ†è¡¨ShardingSphere - ShardingSphere-JDBC - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/a67184a0beabd889af9efde571ceef2b/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="Javaå¾®æœåŠ¡åˆ†å¸ƒå¼åˆ†åº“åˆ†è¡¨ShardingSphere - ShardingSphere-JDBC">
  <meta property="og:description" content="ğŸŒ¹ä½œè€…ä¸»é¡µï¼šé’èŠ±é” ğŸŒ¹ç®€ä»‹ï¼šJavaé¢†åŸŸä¼˜è´¨åˆ›ä½œè€…ğŸ†ã€Javaå¾®æœåŠ¡æ¶æ„å…¬å·ä½œè€…ğŸ˜„
ğŸŒ¹ç®€å†æ¨¡æ¿ã€å­¦ä¹ èµ„æ–™ã€é¢è¯•é¢˜åº“ã€æŠ€æœ¯äº’åŠ©
ğŸŒ¹æ–‡æœ«è·å–è”ç³»æ–¹å¼ ğŸ“
å¾€æœŸçƒ­é—¨ä¸“æ å›é¡¾ ä¸“æ æè¿°Javaé¡¹ç›®å®æˆ˜ä»‹ç»Javaç»„ä»¶å®‰è£…ã€ä½¿ç”¨ï¼›æ‰‹å†™æ¡†æ¶ç­‰AwsæœåŠ¡å™¨å®æˆ˜Aws LinuxæœåŠ¡å™¨ä¸Šæ“ä½œnginxã€gitã€JDKã€VueJavaå¾®æœåŠ¡å®æˆ˜Java å¾®æœåŠ¡å®æˆ˜ï¼ŒSpring Cloud Netflixå¥—ä»¶ã€Spring Cloud Alibabaå¥—ä»¶ã€Seataã€gatewayã€shadingjdbcç­‰å®æˆ˜æ“ä½œ JavaåŸºç¡€ç¯‡JavaåŸºç¡€é—²èŠï¼Œå·²å‡ºHashMapã€Stringã€StringBufferç­‰æºç åˆ†æï¼ŒJVMåˆ†æï¼ŒæŒç»­æ›´æ–°ä¸­ Springbootç¯‡ä»åˆ›å»ºSpringbooté¡¹ç›®ï¼Œåˆ°åŠ è½½æ•°æ®åº“ã€é™æ€èµ„æºã€è¾“å‡ºRestFulæ¥å£ã€è·¨è¶Šé—®é¢˜è§£å†³åˆ°ç»Ÿä¸€è¿”å›ã€å…¨å±€å¼‚å¸¸å¤„ç†ã€Swaggeræ–‡æ¡£ Spring MVCç¯‡ä»åˆ›å»ºSpring MVCé¡¹ç›®ï¼Œåˆ°åŠ è½½æ•°æ®åº“ã€é™æ€èµ„æºã€è¾“å‡ºRestFulæ¥å£ã€è·¨è¶Šé—®é¢˜è§£å†³åˆ°ç»Ÿä¸€è¿”å› åä¸ºäº‘æœåŠ¡å™¨å®æˆ˜åä¸ºäº‘LinuxæœåŠ¡å™¨ä¸Šæ“ä½œnginxã€gitã€JDKã€Vueç­‰ï¼Œä»¥åŠä½¿ç”¨å®å¡”è¿ç»´æ“ä½œæ·»åŠ Htmlç½‘é¡µã€éƒ¨ç½²Springbooté¡¹ç›®/Vueé¡¹ç›®ç­‰ Javaçˆ¬è™«é€šè¿‡Java&#43;Selenium&#43;GoogleWebDriver æ¨¡æ‹ŸçœŸäººç½‘é¡µæ“ä½œçˆ¬å–èŠ±ç“£ç½‘å›¾ç‰‡ã€bingæœç´¢å›¾ç‰‡ç­‰ Vueå®æˆ˜è®²è§£Vue3çš„å®‰è£…ã€ç¯å¢ƒé…ç½®ï¼ŒåŸºæœ¬è¯­æ³•ã€å¾ªç¯è¯­å¥ã€ç”Ÿå‘½å‘¨æœŸã€è·¯ç”±è®¾ç½®ã€ç»„ä»¶ã€axiosäº¤äº’ã€Element-uiçš„ä½¿ç”¨ç­‰ Springè®²è§£Spring(Bean)æ¦‚å¿µã€IOCã€AOPã€é›†æˆjdbcTemplate/redis/äº‹åŠ¡ç­‰ ç³»åˆ—æ–‡ç« ç›®å½• ç¬¬ä¸€ç«  Javaçº¿ç¨‹æ± æŠ€æœ¯åº”ç”¨
ç¬¬äºŒç«  CountDownLatchå’ŒSemaphoneçš„åº”ç”¨
ç¬¬ä¸‰ç«  Spring Cloud ç®€ä»‹
ç¬¬å››ç«  Spring Cloud Netflix ä¹‹ Eureka
ç¬¬äº”ç«  Spring Cloud Netflix ä¹‹ Ribbon
ç¬¬å…­ç«  Spring Cloud ä¹‹ OpenFeign
ç¬¬ä¸ƒç«  Spring Cloud ä¹‹ GateWay
ç¬¬å…«ç«  Spring Cloud Netflix ä¹‹ Hystrix
ç¬¬ä¹ç«  ä»£ç ç®¡ç†gitlab ä½¿ç”¨
ç¬¬åç«  SpringCloud Alibaba ä¹‹ Nacos discovery">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-25T07:00:00+08:00">
    <meta property="article:modified_time" content="2024-03-25T07:00:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Javaå¾®æœåŠ¡åˆ†å¸ƒå¼åˆ†åº“åˆ†è¡¨ShardingSphere - ShardingSphere-JDBC</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <center> 
 <p> ğŸŒ¹ä½œè€…ä¸»é¡µï¼šé’èŠ±é” ğŸŒ¹ç®€ä»‹ï¼šJavaé¢†åŸŸä¼˜è´¨åˆ›ä½œè€…ğŸ†ã€Javaå¾®æœåŠ¡æ¶æ„å…¬å·ä½œè€…ğŸ˜„</p> 
 <p> ğŸŒ¹ç®€å†æ¨¡æ¿ã€å­¦ä¹ èµ„æ–™ã€é¢è¯•é¢˜åº“ã€æŠ€æœ¯äº’åŠ©</p> 
 <p> ğŸŒ¹æ–‡æœ«è·å–è”ç³»æ–¹å¼ ğŸ“</p> 
</center> 
<p><img src="https://images2.imgbox.com/28/6e/F8dgog6T_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<hr> 
<h2><a id="_11"></a>å¾€æœŸçƒ­é—¨ä¸“æ å›é¡¾</h2> 
<table><thead><tr><th align="left">ä¸“æ </th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">Javaé¡¹ç›®å®æˆ˜</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12345409.html">ä»‹ç»Javaç»„ä»¶å®‰è£…ã€ä½¿ç”¨ï¼›æ‰‹å†™æ¡†æ¶ç­‰</a></td></tr><tr><td align="left">AwsæœåŠ¡å™¨å®æˆ˜</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12492968.html">Aws LinuxæœåŠ¡å™¨ä¸Šæ“ä½œnginxã€gitã€JDKã€Vue</a></td></tr><tr><td align="left">Javaå¾®æœåŠ¡å®æˆ˜</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12439818.html">Java å¾®æœåŠ¡å®æˆ˜ï¼ŒSpring Cloud Netflixå¥—ä»¶ã€Spring Cloud Alibabaå¥—ä»¶ã€Seataã€gatewayã€shadingjdbcç­‰å®æˆ˜æ“ä½œ </a></td></tr><tr><td align="left">JavaåŸºç¡€ç¯‡</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12369312.html">JavaåŸºç¡€é—²èŠï¼Œå·²å‡ºHashMapã€Stringã€StringBufferç­‰æºç åˆ†æï¼ŒJVMåˆ†æï¼ŒæŒç»­æ›´æ–°ä¸­ </a></td></tr><tr><td align="left">Springbootç¯‡</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12273537.html">ä»åˆ›å»ºSpringbooté¡¹ç›®ï¼Œåˆ°åŠ è½½æ•°æ®åº“ã€é™æ€èµ„æºã€è¾“å‡ºRestFulæ¥å£ã€è·¨è¶Šé—®é¢˜è§£å†³åˆ°ç»Ÿä¸€è¿”å›ã€å…¨å±€å¼‚å¸¸å¤„ç†ã€Swaggeræ–‡æ¡£ </a></td></tr><tr><td align="left">Spring MVCç¯‡</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12295009.html">ä»åˆ›å»ºSpring MVCé¡¹ç›®ï¼Œåˆ°åŠ è½½æ•°æ®åº“ã€é™æ€èµ„æºã€è¾“å‡ºRestFulæ¥å£ã€è·¨è¶Šé—®é¢˜è§£å†³åˆ°ç»Ÿä¸€è¿”å› </a></td></tr><tr><td align="left">åä¸ºäº‘æœåŠ¡å™¨å®æˆ˜</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12426609.html">åä¸ºäº‘LinuxæœåŠ¡å™¨ä¸Šæ“ä½œnginxã€gitã€JDKã€Vueç­‰ï¼Œä»¥åŠä½¿ç”¨å®å¡”è¿ç»´æ“ä½œæ·»åŠ Htmlç½‘é¡µã€éƒ¨ç½²Springbooté¡¹ç›®/Vueé¡¹ç›®ç­‰ </a></td></tr><tr><td align="left">Javaçˆ¬è™«</td><td align="left"><a href="https://blog.csdn.net/s445320/category_8863085.html">é€šè¿‡Java+Selenium+GoogleWebDriver æ¨¡æ‹ŸçœŸäººç½‘é¡µæ“ä½œçˆ¬å–èŠ±ç“£ç½‘å›¾ç‰‡ã€bingæœç´¢å›¾ç‰‡ç­‰ </a></td></tr><tr><td align="left">Vueå®æˆ˜</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12278346.html">è®²è§£Vue3çš„å®‰è£…ã€ç¯å¢ƒé…ç½®ï¼ŒåŸºæœ¬è¯­æ³•ã€å¾ªç¯è¯­å¥ã€ç”Ÿå‘½å‘¨æœŸã€è·¯ç”±è®¾ç½®ã€ç»„ä»¶ã€axiosäº¤äº’ã€Element-uiçš„ä½¿ç”¨ç­‰ </a></td></tr><tr><td align="left">Spring</td><td align="left"><a href="https://blog.csdn.net/s445320/category_12283629.html">è®²è§£Spring(Bean)æ¦‚å¿µã€IOCã€AOPã€é›†æˆjdbcTemplate/redis/äº‹åŠ¡ç­‰ </a></td></tr></tbody></table> 
<hr> 
<h2><a id="_28"></a>ç³»åˆ—æ–‡ç« ç›®å½•</h2> 
<p><a href="https://blog.csdn.net/s445320/article/details/132870714">ç¬¬ä¸€ç«  Javaçº¿ç¨‹æ± æŠ€æœ¯åº”ç”¨</a><br> <a href="https://blog.csdn.net/s445320/article/details/132912126">ç¬¬äºŒç«  CountDownLatchå’ŒSemaphoneçš„åº”ç”¨</a><br> <a href="https://blog.csdn.net/s445320/article/details/132939152">ç¬¬ä¸‰ç«  Spring Cloud ç®€ä»‹</a><br> <a href="https://blog.csdn.net/s445320/article/details/133024912">ç¬¬å››ç«  Spring Cloud Netflix ä¹‹ Eureka</a><br> <a href="https://blog.csdn.net/s445320/article/details/133156575">ç¬¬äº”ç«  Spring Cloud Netflix ä¹‹ Ribbon</a><br> <a href="https://blog.csdn.net/s445320/article/details/130624259">ç¬¬å…­ç«  Spring Cloud ä¹‹ OpenFeign</a><br> <a href="https://blog.csdn.net/s445320/article/details/133612365">ç¬¬ä¸ƒç«  Spring Cloud ä¹‹ GateWay</a><br> <a href="https://blog.csdn.net/s445320/article/details/133759729">ç¬¬å…«ç«  Spring Cloud Netflix ä¹‹ Hystrix</a><br> <a href="https://blog.csdn.net/s445320/article/details/133842594">ç¬¬ä¹ç«  ä»£ç ç®¡ç†gitlab ä½¿ç”¨</a><br> <a href="https://blog.csdn.net/s445320/article/details/133977189">ç¬¬åç«  SpringCloud Alibaba ä¹‹ Nacos discovery</a><br> <a href="https://blog.csdn.net/s445320/article/details/133977189">ç¬¬åä¸€ç«  SpringCloud Alibaba ä¹‹ Nacos Config</a><br> <a href="https://blog.csdn.net/s445320/article/details/134149339">ç¬¬åäºŒç«  Spring Cloud Alibaba ä¹‹ Sentinel</a><br> <a href="https://blog.csdn.net/s445320/article/details/134197122">ç¬¬åä¸‰ç«  JWT</a><br> <a href="https://blog.csdn.net/s445320/article/details/134228181">ç¬¬åå››ç«  RabbitMQåº”ç”¨</a><br> <a href="https://blog.csdn.net/s445320/article/details/130823776">ç¬¬åäº”ç«  RabbitMQ å»¶è¿Ÿé˜Ÿåˆ—</a><br> <a href="https://blog.csdn.net/s445320/article/details/134360837">ç¬¬åå…­ç«  spring-cloud-stream</a><br> <a href="https://blog.csdn.net/s445320/article/details/134361033">ç¬¬åä¸ƒç«  Windowsç³»ç»Ÿå®‰è£…Redisã€é…ç½®ç¯å¢ƒå˜é‡</a><br> <a href="https://blog.csdn.net/s445320/article/details/134591045">ç¬¬åå…«ç«  æŸ¥çœ‹ã€ä¿®æ”¹Redisé…ç½®ï¼Œä»‹ç»Redisç±»å‹</a><br> <a href="https://blog.csdn.net/s445320/article/details/136615331">ç¬¬åä¹ç«  Redis RDB AOF</a><br> <a href="https://blog.csdn.net/s445320/article/details/136617602">ç¬¬äºŒåç«  Spring boot æ“ä½œ Redis</a><br> <a href="https://blog.csdn.net/s445320/article/details/136641717">ç¬¬äºŒåä¸€ç«  Javaå¤šçº¿ç¨‹å®‰å…¨ä¸é”</a><br> <a href="https://blog.csdn.net/s445320/article/details/136806573">ç¬¬äºŒåäºŒç«  Javaå¾®æœåŠ¡åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶seata</a><br> <a href="https://blog.csdn.net/s445320/article/details/136928879">ç¬¬äºŒåä¸‰ç«  Javaå¾®æœåŠ¡åˆ†å¸ƒå¼äº‹åŠ¡æ¡†æ¶seataçš„TCCæ¨¡å¼</a><br> <a href="https://blog.csdn.net/s445320/article/details/136995262">ç¬¬äºŒåå››ç«  Javaå¾®æœåŠ¡åˆ†åº“åˆ†è¡¨ShardingSphere - ShardingSphere-JDBC</a></p> 
<hr> 
<h2><a id="_57"></a>å‰è¨€</h2> 
<p>Apache ShardingSphere æ˜¯ä¸€æ¬¾åˆ†å¸ƒå¼çš„æ•°æ®åº“ç”Ÿæ€ç³»ç»Ÿï¼Œ å¯ä»¥å°†ä»»æ„æ•°æ®åº“è½¬æ¢ä¸ºåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œå¹¶é€šè¿‡æ•°æ®åˆ†ç‰‡ã€å¼¹æ€§ä¼¸ç¼©ã€åŠ å¯†ç­‰èƒ½åŠ›å¯¹åŸæœ‰æ•°æ®åº“è¿›è¡Œå¢å¼ºã€‚</p> 
<p>Apache ShardingSphere è®¾è®¡å“²å­¦ä¸º Database Plusï¼Œæ—¨åœ¨æ„å»ºå¼‚æ„æ•°æ®åº“ä¸Šå±‚çš„æ ‡å‡†å’Œç”Ÿæ€ã€‚ å®ƒå…³æ³¨å¦‚ä½•å……åˆ†åˆç†åœ°åˆ©ç”¨æ•°æ®åº“çš„è®¡ç®—å’Œå­˜å‚¨èƒ½åŠ›ï¼Œè€Œå¹¶éå®ç°ä¸€ä¸ªå…¨æ–°çš„æ•°æ®åº“ã€‚ å®ƒç«™åœ¨æ•°æ®åº“çš„ä¸Šå±‚è§†è§’ï¼Œå…³æ³¨å®ƒä»¬ä¹‹é—´çš„åä½œå¤šäºæ•°æ®åº“è‡ªèº«ã€‚</p> 
<h2><a id="1ShardingSphereJDBC_61"></a>1ã€ShardingSphere-JDBC</h2> 
<p>ShardingSphere-JDBC å®šä½ä¸ºè½»é‡çº§ Java æ¡†æ¶ï¼Œåœ¨ Java çš„ JDBC å±‚æä¾›çš„é¢å¤–æœåŠ¡ã€‚</p> 
<h3><a id="11_63"></a>1.1ã€åº”ç”¨åœºæ™¯</h3> 
<p>Apache ShardingSphere-JDBC å¯ä»¥é€šè¿‡Java å’Œ YAML è¿™ 2 ç§æ–¹å¼è¿›è¡Œé…ç½®ï¼Œå¼€å‘è€…å¯æ ¹æ®åœºæ™¯é€‰æ‹©é€‚åˆçš„é…ç½®æ–¹å¼ã€‚</p> 
<ul><li>æ•°æ®åº“è¯»å†™åˆ†ç¦»</li><li>æ•°æ®åº“åˆ†è¡¨åˆ†åº“</li></ul> 
<h3><a id="12_68"></a>1.2ã€åŸç†</h3> 
<ul><li>Sharding-JDBCä¸­çš„è·¯ç”±ç»“æœæ˜¯é€šè¿‡åˆ†ç‰‡å­—æ®µå’Œåˆ†ç‰‡æ–¹æ³•æ¥ç¡®å®šçš„,å¦‚æœæŸ¥è¯¢æ¡ä»¶ä¸­æœ‰ id å­—æ®µçš„æƒ…å†µè¿˜å¥½ï¼ŒæŸ¥è¯¢å°†ä¼šè½åˆ°æŸä¸ªå…·ä½“çš„åˆ†ç‰‡</li><li>å¦‚æœæŸ¥è¯¢æ²¡æœ‰åˆ†ç‰‡çš„å­—æ®µï¼Œä¼šå‘æ‰€æœ‰çš„dbæˆ–è€…æ˜¯è¡¨éƒ½ä¼šæŸ¥è¯¢ä¸€éï¼Œè®©åå°è£…ç»“æœé›†ç»™å®¢æˆ·ç«¯ã€‚<br> <img src="https://images2.imgbox.com/ec/a9/6TV42qez_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></li></ul> 
<h3><a id="13spring_boot_73"></a>1.3ã€spring bootæ•´åˆ</h3> 
<h4><a id="131_74"></a>1.3.1ã€æ·»åŠ ä¾èµ–</h4> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- åˆ†è¡¨åˆ†åº“ä¾èµ– --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-jdbc-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="132_84"></a>1.3.2ã€æ·»åŠ é…ç½®</h4> 
<pre><code class="prism language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">main</span><span class="token punctuation">:</span>
    <span class="token comment"># ä¸€ä¸ªå®ä½“ç±»å¯¹åº”å¤šå¼ è¡¨ï¼Œè¦†ç›–</span>
    <span class="token key atrule">allow-bean-definition-overriding</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">shardingsphere</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
      <span class="token key atrule">ds0</span><span class="token punctuation">:</span>
        <span class="token comment">#é…ç½®æ•°æ®æºå…·ä½“å†…å®¹ï¼ŒåŒ…å«è¿æ¥æ± ï¼Œé©±åŠ¨ï¼Œåœ°å€ï¼Œç”¨æˆ·åå’Œå¯†ç </span>
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/account<span class="token punctuation">?</span>autoReconnect=true<span class="token important">&amp;allowMultiQueries=true</span>
        <span class="token key atrule">password</span><span class="token punctuation">:</span> root
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
      <span class="token key atrule">ds1</span><span class="token punctuation">:</span>
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/account<span class="token punctuation">?</span>autoReconnect=true<span class="token important">&amp;allowMultiQueries=true</span>
        <span class="token key atrule">password</span><span class="token punctuation">:</span> root
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
      <span class="token comment"># é…ç½®æ•°æ®æºï¼Œç»™æ•°æ®æºèµ·åç§°</span>
      <span class="token key atrule">names</span><span class="token punctuation">:</span> ds0<span class="token punctuation">,</span>ds1
    <span class="token key atrule">props</span><span class="token punctuation">:</span>
      <span class="token key atrule">sql</span><span class="token punctuation">:</span>
        <span class="token key atrule">show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">sharding</span><span class="token punctuation">:</span>
      <span class="token key atrule">tables</span><span class="token punctuation">:</span>
        <span class="token key atrule">user_info</span><span class="token punctuation">:</span>
          <span class="token comment">#æŒ‡å®š user_info è¡¨åˆ†å¸ƒæƒ…å†µï¼Œé…ç½®è¡¨åœ¨å“ªä¸ªæ•°æ®åº“é‡Œé¢ï¼Œè¡¨åç§°éƒ½æ˜¯ä»€ä¹ˆ</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> ds0.user_info_$<span class="token punctuation">{<!-- --></span>0..9<span class="token punctuation">}</span>
          <span class="token key atrule">database-strategy</span><span class="token punctuation">:</span>
            <span class="token key atrule">standard</span><span class="token punctuation">:</span>
              <span class="token key atrule">preciseAlgorithmClassName</span><span class="token punctuation">:</span> com.xxxx.store.account.config.PreciseDBShardingAlgorithm
              <span class="token key atrule">rangeAlgorithmClassName</span><span class="token punctuation">:</span> com.xxxx.store.account.config.RangeDBShardingAlgorithm
              <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> id
          <span class="token key atrule">table-strategy</span><span class="token punctuation">:</span>
            <span class="token key atrule">standard</span><span class="token punctuation">:</span>
              <span class="token key atrule">preciseAlgorithmClassName</span><span class="token punctuation">:</span> com.xxxx.store.account.config.PreciseTablesShardingAlgorithm
              <span class="token key atrule">rangeAlgorithmClassName</span><span class="token punctuation">:</span> com.xxxx.store.account.config.RangeTablesShardingAlgorithm
              <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> id
</code></pre> 
<h4><a id="133_127"></a>1.3.3ã€åˆ¶å®šåˆ†ç‰‡ç®—æ³•</h4> 
<h5><a id="1331_128"></a>1.3.3.1ã€ç²¾ç¡®åˆ†åº“ç®—æ³•</h5> 
<pre><code class="prism language-java"><span class="token comment">/**
 * ç²¾ç¡®åˆ†åº“ç®—æ³•
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PreciseDBShardingAlgorithm</span> <span class="token keyword">implements</span> <span class="token class-name">PreciseShardingAlgorithm</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     *
     * @param availableTargetNames é…ç½®æ‰€æœ‰çš„åˆ—è¡¨
     * @param preciseShardingValue åˆ†ç‰‡å€¼
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">doSharding</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> availableTargetNames<span class="token punctuation">,</span> <span class="token class-name">PreciseShardingValue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> preciseShardingValue<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Long</span> value <span class="token operator">=</span> preciseShardingValue<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åç¼€ 0ï¼Œ1</span>
        <span class="token class-name">String</span> postfix <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>value <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> availableTargetName <span class="token operator">:</span> availableTargetNames<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>availableTargetName<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span>postfix<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> availableTargetName<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="1332_157"></a>1.3.3.2ã€èŒƒå›´åˆ†åº“ç®—æ³•</h5> 
<pre><code class="prism language-java"><span class="token comment">/**
 * èŒƒå›´åˆ†åº“ç®—æ³•
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RangeDBShardingAlgorithm</span> <span class="token keyword">implements</span> <span class="token class-name">RangeShardingAlgorithm</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">doSharding</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> collection<span class="token punctuation">,</span> <span class="token class-name">RangeShardingValue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> rangeShardingValue<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> collection<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="1333_171"></a>1.3.3.3ã€ç²¾ç¡®åˆ†è¡¨ç®—æ³•</h5> 
<pre><code class="prism language-java"><span class="token comment">/**
 * ç²¾ç¡®åˆ†è¡¨ç®—æ³•
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PreciseTablesShardingAlgorithm</span> <span class="token keyword">implements</span> <span class="token class-name">PreciseShardingAlgorithm</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     *
     * @param availableTargetNames é…ç½®æ‰€æœ‰çš„åˆ—è¡¨
     * @param preciseShardingValue åˆ†ç‰‡å€¼
     * @return
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">doSharding</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> availableTargetNames<span class="token punctuation">,</span> <span class="token class-name">PreciseShardingValue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> preciseShardingValue<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Long</span> value <span class="token operator">=</span> preciseShardingValue<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//åç¼€</span>
        <span class="token class-name">String</span> postfix <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>value <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> availableTargetName <span class="token operator">:</span> availableTargetNames<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>availableTargetName<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span>postfix<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> availableTargetName<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="1334_200"></a>1.3.3.4ã€èŒƒå›´åˆ†è¡¨ç®—æ³•</h5> 
<pre><code class="prism language-java"><span class="token comment">/**
 * èŒƒå›´åˆ†è¡¨ç®—æ³•
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RangeTablesShardingAlgorithm</span> <span class="token keyword">implements</span> <span class="token class-name">RangeShardingAlgorithm</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">doSharding</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> collection<span class="token punctuation">,</span> <span class="token class-name">RangeShardingValue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> rangeShardingValue<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Range</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> valueRange <span class="token operator">=</span> rangeShardingValue<span class="token punctuation">.</span><span class="token function">getValueRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Long</span> start <span class="token operator">=</span> valueRange<span class="token punctuation">.</span><span class="token function">lowerEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Long</span> end <span class="token operator">=</span> valueRange<span class="token punctuation">.</span><span class="token function">upperEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Long</span> min <span class="token operator">=</span> start <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token class-name">Long</span> max <span class="token operator">=</span> end <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Long</span> i <span class="token operator">=</span> min<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> max <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Long</span> finalI <span class="token operator">=</span> i<span class="token punctuation">;</span>
            collection<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>finalI<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="134_231"></a>1.3.4ã€æ•°æ®åº“å»ºè¡¨</h4> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token identifier"><span class="token punctuation">`</span>user_info_0<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>user_info_0<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>account<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>pwd<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

</code></pre> 
<h4><a id="135_243"></a>1.3.5ã€ä¸šåŠ¡åº”ç”¨</h4> 
<h5><a id="1351_244"></a>1.3.5.1ã€å®šä¹‰å®ä½“ç±»</h5> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"user_info"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * ä¸»é”®
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token comment">/**
     * è´¦å·
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> account<span class="token punctuation">;</span>
    <span class="token comment">/**
     * ç”¨æˆ·å
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
    <span class="token comment">/**
     * å¯†ç 
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> pwd<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="1352_268"></a>1.3.5.2ã€å®šä¹‰æ¥å£</h5> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserInfoService</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * ä¿å­˜
     * @param userInfo
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">saveUserInfo</span><span class="token punctuation">(</span><span class="token class-name">UserInfo</span> userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">getUserInfoById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">listUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<h5><a id="1353_284"></a>1.3.5.3ã€å®ç°ç±»</h5> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfoServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfoMapper</span><span class="token punctuation">,</span> <span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">UserInfoService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">saveUserInfo</span><span class="token punctuation">(</span><span class="token class-name">UserInfo</span> userInfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        userInfo<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">IdUtils</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">getUserInfoById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">listUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> userInfoQueryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userInfoQueryWrapper<span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span><span class="token number">1623695688380448768L</span><span class="token punctuation">,</span><span class="token number">1623695688380448769L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>userInfoQueryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="136ID___312"></a>1.3.6ã€ç”ŸæˆID - é›ªèŠ±ç®—æ³•</h4> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xxxx<span class="token punctuation">.</span>tore<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">Snowflake</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">IdUtil</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * ç”Ÿæˆå„ç§ç»„ä»¶ID
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IdUtils</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * é›ªèŠ±ç®—æ³•
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">long</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Snowflake</span> snowflake <span class="token operator">=</span> <span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">getSnowflake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> id <span class="token operator">=</span> snowflake<span class="token punctuation">.</span><span class="token function">nextId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
</code></pre> 
<h3><a id="14seatashardingjdbc_338"></a>1.4ã€seataä¸sharding-jdbcæ•´åˆ</h3> 
<p>https://github.com/seata/seata-samples/tree/master/springcloud-seata-sharding-jdbc-mybatis-plus-samples</p> 
<h4><a id="141common_341"></a>1.4.1ã€commonä¸­æ·»åŠ ä¾èµ–</h4> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--seataä¾èµ–--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-seata<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2021.0.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- sharding-jdbcæ•´åˆseataåˆ†å¸ƒå¼äº‹åŠ¡--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sharding-transaction-base-seata-at<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2021.0.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>nacos-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>nacos-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="142accountservice_374"></a>1.4.2ã€æ”¹é€ account-serviceæœåŠ¡</h4> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccountServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AccountMapper</span><span class="token punctuation">,</span> <span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">AccountService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StorageService</span> storageService<span class="token punctuation">;</span>

    <span class="token comment">/**
     * å­˜æ”¾å•†å“ç¼–ç åŠå…¶å¯¹åº”çš„ä»·é’±
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"c001"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"c002"</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"c003"</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"c004"</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token annotation punctuation">@ShardingTransactionType</span><span class="token punctuation">(</span><span class="token class-name">TransactionType</span><span class="token punctuation">.</span><span class="token constant">BASE</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">debit</span><span class="token punctuation">(</span><span class="token class-name">OrderDTO</span> orderDTO<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//æ‰£å‡è´¦æˆ·ä½™é¢</span>
        <span class="token keyword">int</span> calculate <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">calculate</span><span class="token punctuation">(</span>orderDTO<span class="token punctuation">.</span><span class="token function">getCommodityCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> orderDTO<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">AccountDTO</span> accountDTO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AccountDTO</span><span class="token punctuation">(</span>orderDTO<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> calculate<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> objectQueryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectQueryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        objectQueryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>accountDTO<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span><span class="token string">"user_id"</span><span class="token punctuation">,</span>accountDTO<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Account</span> account <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getOne</span><span class="token punctuation">(</span>objectQueryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
        account<span class="token punctuation">.</span><span class="token function">setMoney</span><span class="token punctuation">(</span>account<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> accountDTO<span class="token punctuation">.</span><span class="token function">getMoney</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveOrUpdate</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ‰£å‡åº“å­˜</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>storageService<span class="token punctuation">.</span><span class="token function">deduct</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StorageDTO</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>orderDTO<span class="token punctuation">.</span><span class="token function">getCommodityCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>orderDTO<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ç”Ÿæˆè®¢å•</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>orderService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>orderDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>      
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * è®¡ç®—è´­ä¹°å•†å“çš„æ€»ä»·é’±
     * @param commodityCode
     * @param orderCount
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token class-name">String</span> commodityCode<span class="token punctuation">,</span> <span class="token keyword">int</span> orderCount<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//å•†å“ä»·é’±</span>
        <span class="token class-name">Integer</span> price <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>commodityCode<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>commodityCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> price <span class="token operator">*</span> orderCount<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>æ³¨æ„ï¼šè°ƒå•ç”Ÿæˆè°ƒç”¨çš„é€»è¾‘ä¿®æ”¹ï¼Œå‡ä½™é¢-&gt;å‡åº“å­˜-&gt;ç”Ÿæˆè®¢å•ã€‚è°ƒç”¨å…¥å£æ–¹æ³•æ³¨è§£åŠ ä¸Šï¼š<code>@ShardingTransactionType(TransactionType.BASE)</code></p> 
<h4><a id="143businessservice_432"></a>1.4.3ã€ä¿®æ”¹business-serviceæœåŠ¡</h4> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BusinessServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">BusinessService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StorageService</span> storageService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">AccountService</span> accountService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">purchase</span><span class="token punctuation">(</span><span class="token class-name">OrderDTO</span> orderDTO<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//æ‰£å‡è´¦å·ä¸­çš„é’±</span>
        accountService<span class="token punctuation">.</span><span class="token function">debit</span><span class="token punctuation">(</span>orderDTO<span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="144orderservice_451"></a>1.4.4ã€ä¿®æ”¹order-serviceæœåŠ¡</h4> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderMapper</span><span class="token punctuation">,</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * å­˜æ”¾å•†å“ç¼–ç åŠå…¶å¯¹åº”çš„ä»·é’±
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"c001"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"c002"</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"c003"</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"c004"</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token annotation punctuation">@Transactional</span>
    <span class="token annotation punctuation">@ShardingTransactionType</span><span class="token punctuation">(</span><span class="token class-name">TransactionType</span><span class="token punctuation">.</span><span class="token constant">BASE</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Order</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">,</span> <span class="token class-name">String</span> commodityCode<span class="token punctuation">,</span> <span class="token keyword">int</span> orderCount<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> orderMoney <span class="token operator">=</span> <span class="token function">calculate</span><span class="token punctuation">(</span>commodityCode<span class="token punctuation">,</span> orderCount<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Order</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setUserId</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setCommodityCode</span><span class="token punctuation">(</span>commodityCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span>orderCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        order<span class="token punctuation">.</span><span class="token function">setMoney</span><span class="token punctuation">(</span>orderMoney<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//ä¿å­˜è®¢å•</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"å›æ»šæµ‹è¯•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> order<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * è®¡ç®—è´­ä¹°å•†å“çš„æ€»ä»·é’±
     * @param commodityCode
     * @param orderCount
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token class-name">String</span> commodityCode<span class="token punctuation">,</span> <span class="token keyword">int</span> orderCount<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//å•†å“ä»·é’±</span>
        <span class="token class-name">Integer</span> price <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>commodityCode<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>commodityCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> price <span class="token operator">*</span> orderCount<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="145_505"></a>1.4.5ã€é…ç½®æ–‡ä»¶å‚è€ƒ</h4> 
<pre><code class="prism language-yml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8090</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">main</span><span class="token punctuation">:</span>
    <span class="token comment"># ä¸€ä¸ªå®ä½“ç±»å¯¹åº”å¤šå¼ è¡¨ï¼Œè¦†ç›–</span>
    <span class="token key atrule">allow-bean-definition-overriding</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">shardingsphere</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
      <span class="token key atrule">ds0</span><span class="token punctuation">:</span>
        <span class="token comment">#é…ç½®æ•°æ®æºå…·ä½“å†…å®¹ï¼ŒåŒ…å«è¿æ¥æ± ï¼Œé©±åŠ¨ï¼Œåœ°å€ï¼Œç”¨æˆ·åå’Œå¯†ç </span>
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/account<span class="token punctuation">?</span>autoReconnect=true<span class="token important">&amp;allowMultiQueries=true</span>
        <span class="token key atrule">password</span><span class="token punctuation">:</span> root
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
      <span class="token key atrule">ds1</span><span class="token punctuation">:</span>
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
        <span class="token key atrule">jdbc-url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/account<span class="token punctuation">?</span>autoReconnect=true<span class="token important">&amp;allowMultiQueries=true</span>
        <span class="token key atrule">password</span><span class="token punctuation">:</span> root
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.zaxxer.hikari.HikariDataSource
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
      <span class="token comment"># é…ç½®æ•°æ®æºï¼Œç»™æ•°æ®æºèµ·åç§°</span>
      <span class="token key atrule">names</span><span class="token punctuation">:</span> ds0<span class="token punctuation">,</span>ds1
    <span class="token key atrule">props</span><span class="token punctuation">:</span>
      <span class="token key atrule">sql</span><span class="token punctuation">:</span>
        <span class="token key atrule">show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">sharding</span><span class="token punctuation">:</span>
      <span class="token key atrule">tables</span><span class="token punctuation">:</span>
        <span class="token key atrule">account_tbl</span><span class="token punctuation">:</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> ds0.account_tbl_$<span class="token punctuation">{<!-- --></span>0..1<span class="token punctuation">}</span>
          <span class="token key atrule">database-strategy</span><span class="token punctuation">:</span>
            <span class="token key atrule">standard</span><span class="token punctuation">:</span>
              <span class="token key atrule">preciseAlgorithmClassName</span><span class="token punctuation">:</span> com.xxxx.store.account.config.PreciseDBExtShardingAlgorithm
              <span class="token comment">#rangeAlgorithmClassName: com.xxxx.store.account.config.RangeDBShardingAlgorithm</span>
              <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> id
          <span class="token key atrule">table-strategy</span><span class="token punctuation">:</span>
            <span class="token key atrule">standard</span><span class="token punctuation">:</span>
              <span class="token key atrule">preciseAlgorithmClassName</span><span class="token punctuation">:</span> com.xxxx.store.account.config.PreciseTablesExtShardingAlgorithm
              <span class="token comment">#rangeAlgorithmClassName: com.xxxx.store.account.config.RangeTablesShardingAlgorithm</span>
              <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> id

        <span class="token key atrule">user_info</span><span class="token punctuation">:</span>
          <span class="token comment">#æŒ‡å®š user_info è¡¨åˆ†å¸ƒæƒ…å†µï¼Œé…ç½®è¡¨åœ¨å“ªä¸ªæ•°æ®åº“é‡Œé¢ï¼Œè¡¨åç§°éƒ½æ˜¯ä»€ä¹ˆ</span>
          <span class="token key atrule">actual-data-nodes</span><span class="token punctuation">:</span> ds0.user_info_$<span class="token punctuation">{<!-- --></span>0..9<span class="token punctuation">}</span>
          <span class="token key atrule">database-strategy</span><span class="token punctuation">:</span>
            <span class="token key atrule">standard</span><span class="token punctuation">:</span>
              <span class="token key atrule">preciseAlgorithmClassName</span><span class="token punctuation">:</span> com.xxxx.store.account.config.PreciseDBShardingAlgorithm
              <span class="token key atrule">rangeAlgorithmClassName</span><span class="token punctuation">:</span> com.xxxx.store.account.config.RangeDBShardingAlgorithm
              <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> id
          <span class="token key atrule">table-strategy</span><span class="token punctuation">:</span>
            <span class="token key atrule">standard</span><span class="token punctuation">:</span>
              <span class="token key atrule">preciseAlgorithmClassName</span><span class="token punctuation">:</span> com.xxxx.store.account.config.PreciseTablesShardingAlgorithm
              <span class="token key atrule">rangeAlgorithmClassName</span><span class="token punctuation">:</span> com.xxxx.store.account.config.RangeTablesShardingAlgorithm
              <span class="token key atrule">sharding-column</span><span class="token punctuation">:</span> id




  <span class="token comment">#ä»¥ä¸Šæ˜¯sharding-jdbcé…ç½®</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> localhost<span class="token punctuation">:</span><span class="token number">8848</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> 1ff3782d<span class="token punctuation">-</span>b62d<span class="token punctuation">-</span>402f<span class="token punctuation">-</span>8bc4<span class="token punctuation">-</span>ebcf40254d0a
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> account<span class="token punctuation">-</span>service  <span class="token comment">#å¾®æœåŠ¡åç§°</span>
<span class="token comment">#  datasource:</span>
<span class="token comment">#    username: root</span>
<span class="token comment">#    password: root</span>
<span class="token comment">#    url: jdbc:mysql://127.0.0.1:3306/account</span>
<span class="token comment">#    driver-class-name: com.mysql.cj.jdbc.Driver</span>

<span class="token key atrule">seata</span><span class="token punctuation">:</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">enable-auto-data-source-proxy</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">application-id</span><span class="token punctuation">:</span> account<span class="token punctuation">-</span>service
  <span class="token key atrule">tx-service-group</span><span class="token punctuation">:</span> default_tx_group
  <span class="token key atrule">service</span><span class="token punctuation">:</span>
    <span class="token key atrule">vgroup-mapping</span><span class="token punctuation">:</span>
      <span class="token key atrule">default_tx_group</span><span class="token punctuation">:</span> default
    <span class="token key atrule">disable-global-transaction</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> nacos
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">application</span><span class="token punctuation">:</span> seata<span class="token punctuation">-</span>server
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> 1ff3782d<span class="token punctuation">-</span>b62d<span class="token punctuation">-</span>402f<span class="token punctuation">-</span>8bc4<span class="token punctuation">-</span>ebcf40254d0a
      <span class="token key atrule">group</span><span class="token punctuation">:</span> SEATA_GROUP
      <span class="token key atrule">username</span><span class="token punctuation">:</span> nacos
      <span class="token key atrule">password</span><span class="token punctuation">:</span> nacos
  <span class="token key atrule">config</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> 1ff3782d<span class="token punctuation">-</span>b62d<span class="token punctuation">-</span>402f<span class="token punctuation">-</span>8bc4<span class="token punctuation">-</span>ebcf40254d0a
      <span class="token key atrule">group</span><span class="token punctuation">:</span> SEATA_GROUP
      <span class="token key atrule">username</span><span class="token punctuation">:</span> nacos
      <span class="token key atrule">password</span><span class="token punctuation">:</span> nacos
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b428201ea8386ed84387467175960734/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">kafka3.7 é›†ç¾¤ dockeréƒ¨ç½² springboot</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/39825b09730ac28f00ee26fd368cb062/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">Android-Studioä¸‹çš„JNIå¼€å‘ï¼šNDKçš„é…ç½®ï¼ŒandroidéŸ³è§†é¢‘å¼€å‘é¢è¯•</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>