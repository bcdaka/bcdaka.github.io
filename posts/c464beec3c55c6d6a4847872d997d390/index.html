<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>江科大/江协科技 STM32学习笔记P14 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/c464beec3c55c6d6a4847872d997d390/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="江科大/江协科技 STM32学习笔记P14">
  <meta property="og:description" content="文章目录 一、定时器定时中断与定时器有关的库函数1、Timer.c2、main.c 二、定时器外部时钟1、Timer.c外部时钟模式1和外部时钟模式2的区别 2、main.c 一、定时器定时中断 第一步，RCC开启时钟，定时器的基准时钟和整个外设的工作时钟都会同时打开，第二步，选择时基单元的时钟源，对于定时中断选内部时钟源，第三步，配置时基单元，包括这里的预分频器、自动重装器、计数模式等等，这些参数用一个结构体就可以配置好了，第四步，配置输出中断控制，允许更新中断输出到NVIC，第五步，配置NVIC，在NVIC中打开定时器中断的通道，并分配一个优先级，第六步，运行控制，整个模块配置完后使能一下计数器，当定时器使能后计数器开始计数，计数器更新触发中断，最后再写一个定时器的中断函数，中断函数每隔一段时间自动执行一次。
与定时器有关的库函数 void TIM_DeInit(TIM_TypeDef* TIMx); //恢复缺省配置，缺省就是默认 void TIM_TimeBaseInit(TIM_TypeDef* TIMx, TIM_TimeBaseInitTypeDef* TIM_TimeBaseInitStruct); //时基单元初始化，第一个参数选择某个定时器，第二个结构体包含配置时基单元的一些参数 void TIM_OC1Init(TIM_TypeDef* TIMx, TIM_OCInitTypeDef* TIM_OCInitStruct); void TIM_OC2Init(TIM_TypeDef* TIMx, TIM_OCInitTypeDef* TIM_OCInitStruct); void TIM_OC3Init(TIM_TypeDef* TIMx, TIM_OCInitTypeDef* TIM_OCInitStruct); void TIM_OC4Init(TIM_TypeDef* TIMx, TIM_OCInitTypeDef* TIM_OCInitStruct); void TIM_ICInit(TIM_TypeDef* TIMx, TIM_ICInitTypeDef* TIM_ICInitStruct); void TIM_PWMIConfig(TIM_TypeDef* TIMx, TIM_ICInitTypeDef* TIM_ICInitStruct); void TIM_BDTRConfig(TIM_TypeDef* TIMx, TIM_BDTRInitTypeDef *TIM_BDTRInitStruct); void TIM_TimeBaseStructInit(TIM_TimeBaseInitTypeDef* TIM_TimeBaseInitStruct); //把结构体变量赋默认值 void TIM_OCStructInit(TIM_OCInitTypeDef* TIM_OCInitStruct); void TIM_ICStructInit(TIM_ICInitTypeDef* TIM_ICInitStruct); void TIM_BDTRStructInit(TIM_BDTRInitTypeDef* TIM_BDTRInitStruct); void TIM_Cmd(TIM_TypeDef* TIMx, FunctionalState NewState); //使能计数器，第一个参数选择定时器，第二个参数使能或失能 void TIM_CtrlPWMOutputs(TIM_TypeDef* TIMx, FunctionalState NewState); void TIM_ITConfig(TIM_TypeDef* TIMx, uint16_t TIM_IT, FunctionalState NewState); //使能中断输出信号，第二个选择要配置哪个中断输出 void TIM_GenerateEvent(TIM_TypeDef* TIMx, uint16_t TIM_EventSource); void TIM_DMAConfig(TIM_TypeDef* TIMx, uint16_t TIM_DMABase, uint16_t TIM_DMABurstLength); void TIM_DMACmd(TIM_TypeDef* TIMx, uint16_t TIM_DMASource, FunctionalState NewState); void TIM_InternalClockConfig(TIM_TypeDef* TIMx); //选择内部时钟 void TIM_ITRxExternalClockConfig(TIM_TypeDef* TIMx, uint16_t TIM_InputTriggerSource); //选择ITRX其他定时器的时钟 void TIM_TIxExternalClockConfig(TIM_TypeDef* TIMx, uint16_t TIM_TIxExternalCLKSource, uint16_t TIM_ICPolarity, uint16_t ICFilter); //选择TIx捕获通道的时钟，第二个参数选择TIx具体的某个引脚，第三个输入的极性，第四个滤波器 void TIM_ETRClockMode1Config(TIM_TypeDef* TIMx, uint16_t TIM_ExtTRGPrescaler, uint16_t TIM_ExtTRGPolarity, uint16_t ExtTRGFilter); //选择ETR通过外部时钟模式1输入的时钟，第二个参数外部触发预分频器，三四极性和滤波器 void TIM_ETRClockMode2Config(TIM_TypeDef* TIMx, uint16_t TIM_ExtTRGPrescaler, uint16_t TIM_ExtTRGPolarity, uint16_t ExtTRGFilter); //选择ETR通过外部时钟模式2输入的时钟，第二个参数外部触发预分频器，三四极性和滤波器 void TIM_ETRConfig(TIM_TypeDef* TIMx, uint16_t TIM_ExtTRGPrescaler, uint16_t TIM_ExtTRGPolarity, uint16_t ExtTRGFilter); //单独用来配置ETR引脚的预分频器、极性、滤波器 void TIM_PrescalerConfig(TIM_TypeDef* TIMx, uint16_t Prescaler, uint16_t TIM_PSCReloadMode); //在初始化结构体里有很多关键的参数，比如自动重装值和预分频值等等，这些参数可能在初始化后还需要更改 //如果为了改某个参数重新调用初始化参数太麻烦，用一些单独的函数方便更改关键参数 //单独写预分频值，第一个参数写入的预分频值，第二个写入的模式 void TIM_CounterModeConfig(TIM_TypeDef* TIMx, uint16_t TIM_CounterMode); //改变计数器的计数模式 void TIM_SelectInputTrigger(TIM_TypeDef* TIMx, uint16_t TIM_InputTriggerSource); void TIM_EncoderInterfaceConfig(TIM_TypeDef* TIMx, uint16_t TIM_EncoderMode, uint16_t TIM_IC1Polarity, uint16_t TIM_IC2Polarity); void TIM_ForcedOC1Config(TIM_TypeDef* TIMx, uint16_t TIM_ForcedAction); void TIM_ForcedOC2Config(TIM_TypeDef* TIMx, uint16_t TIM_ForcedAction); void TIM_ForcedOC3Config(TIM_TypeDef* TIMx, uint16_t TIM_ForcedAction); void TIM_ForcedOC4Config(TIM_TypeDef* TIMx, uint16_t TIM_ForcedAction); void TIM_ARRPreloadConfig(TIM_TypeDef* TIMx, FunctionalState NewState); //自动重装器预装功能配置 void TIM_SelectCOM(TIM_TypeDef* TIMx, FunctionalState NewState); void TIM_SelectCCDMA(TIM_TypeDef* TIMx, FunctionalState NewState); void TIM_CCPreloadControl(TIM_TypeDef* TIMx, FunctionalState NewState); void TIM_OC1PreloadConfig(TIM_TypeDef* TIMx, uint16_t TIM_OCPreload); void TIM_OC2PreloadConfig(TIM_TypeDef* TIMx, uint16_t TIM_OCPreload); void TIM_OC3PreloadConfig(TIM_TypeDef* TIMx, uint16_t TIM_OCPreload); void TIM_OC4PreloadConfig(TIM_TypeDef* TIMx, uint16_t TIM_OCPreload); void TIM_OC1FastConfig(TIM_TypeDef* TIMx, uint16_t TIM_OCFast); void TIM_OC2FastConfig(TIM_TypeDef* TIMx, uint16_t TIM_OCFast); void TIM_OC3FastConfig(TIM_TypeDef* TIMx, uint16_t TIM_OCFast); void TIM_OC4FastConfig(TIM_TypeDef* TIMx, uint16_t TIM_OCFast); void TIM_ClearOC1Ref(TIM_TypeDef* TIMx, uint16_t TIM_OCClear); void TIM_ClearOC2Ref(TIM_TypeDef* TIMx, uint16_t TIM_OCClear); void TIM_ClearOC3Ref(TIM_TypeDef* TIMx, uint16_t TIM_OCClear); void TIM_ClearOC4Ref(TIM_TypeDef* TIMx, uint16_t TIM_OCClear); void TIM_OC1PolarityConfig(TIM_TypeDef* TIMx, uint16_t TIM_OCPolarity); void TIM_OC1NPolarityConfig(TIM_TypeDef* TIMx, uint16_t TIM_OCNPolarity); void TIM_OC2PolarityConfig(TIM_TypeDef* TIMx, uint16_t TIM_OCPolarity); void TIM_OC2NPolarityConfig(TIM_TypeDef* TIMx, uint16_t TIM_OCNPolarity); void TIM_OC3PolarityConfig(TIM_TypeDef* TIMx, uint16_t TIM_OCPolarity); void TIM_OC3NPolarityConfig(TIM_TypeDef* TIMx, uint16_t TIM_OCNPolarity); void TIM_OC4PolarityConfig(TIM_TypeDef* TIMx, uint16_t TIM_OCPolarity); void TIM_CCxCmd(TIM_TypeDef* TIMx, uint16_t TIM_Channel, uint16_t TIM_CCx); void TIM_CCxNCmd(TIM_TypeDef* TIMx, uint16_t TIM_Channel, uint16_t TIM_CCxN); void TIM_SelectOCxM(TIM_TypeDef* TIMx, uint16_t TIM_Channel, uint16_t TIM_OCMode); void TIM_UpdateDisableConfig(TIM_TypeDef* TIMx, FunctionalState NewState); void TIM_UpdateRequestConfig(TIM_TypeDef* TIMx, uint16_t TIM_UpdateSource); void TIM_SelectHallSensor(TIM_TypeDef* TIMx, FunctionalState NewState); void TIM_SelectOnePulseMode(TIM_TypeDef* TIMx, uint16_t TIM_OPMode); void TIM_SelectOutputTrigger(TIM_TypeDef* TIMx, uint16_t TIM_TRGOSource); void TIM_SelectSlaveMode(TIM_TypeDef* TIMx, uint16_t TIM_SlaveMode); void TIM_SelectMasterSlaveMode(TIM_TypeDef* TIMx, uint16_t TIM_MasterSlaveMode); void TIM_SetCounter(TIM_TypeDef* TIMx, uint16_t Counter); //给计数器写入一个值 void TIM_SetAutoreload(TIM_TypeDef* TIMx, uint16_t Autoreload); //给自动重装器写入一个值 void TIM_SetCompare1(TIM_TypeDef* TIMx, uint16_t Compare1); void TIM_SetCompare2(TIM_TypeDef* TIMx, uint16_t Compare2); void TIM_SetCompare3(TIM_TypeDef* TIMx, uint16_t Compare3); void TIM_SetCompare4(TIM_TypeDef* TIMx, uint16_t Compare4); void TIM_SetIC1Prescaler(TIM_TypeDef* TIMx, uint16_t TIM_ICPSC); void TIM_SetIC2Prescaler(TIM_TypeDef* TIMx, uint16_t TIM_ICPSC); void TIM_SetIC3Prescaler(TIM_TypeDef* TIMx, uint16_t TIM_ICPSC); void TIM_SetIC4Prescaler(TIM_TypeDef* TIMx, uint16_t TIM_ICPSC); void TIM_SetClockDivision(TIM_TypeDef* TIMx, uint16_t TIM_CKD); uint16_t TIM_GetCapture1(TIM_TypeDef* TIMx); uint16_t TIM_GetCapture2(TIM_TypeDef* TIMx); uint16_t TIM_GetCapture3(TIM_TypeDef* TIMx); uint16_t TIM_GetCapture4(TIM_TypeDef* TIMx); uint16_t TIM_GetCounter(TIM_TypeDef* TIMx); //查看当前计数器计到哪里了 uint16_t TIM_GetPrescaler(TIM_TypeDef* TIMx); //获取当前预分频器的值 FlagStatus TIM_GetFlagStatus(TIM_TypeDef* TIMx, uint16_t TIM_FLAG); void TIM_ClearFlag(TIM_TypeDef* TIMx, uint16_t TIM_FLAG); ITStatus TIM_GetITStatus(TIM_TypeDef* TIMx, uint16_t TIM_IT); void TIM_ClearITPendingBit(TIM_TypeDef* TIMx, uint16_t TIM_IT); //上4获取标志位和清除标志位 1、Timer.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-27T11:03:01+08:00">
    <meta property="article:modified_time" content="2024-07-27T11:03:01+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">江科大/江协科技 STM32学习笔记P14</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_2" rel="nofollow">一、定时器定时中断</a></li><li><ul><li><a href="#_5" rel="nofollow">与定时器有关的库函数</a></li><li><a href="#1Timerc_124" rel="nofollow">1、Timer.c</a></li><li><a href="#2mainc_209" rel="nofollow">2、main.c</a></li></ul> 
  </li><li><a href="#_256" rel="nofollow">二、定时器外部时钟</a></li><li><ul><li><a href="#1Timerc_257" rel="nofollow">1、Timer.c</a></li><li><ul><li><a href="#12_348" rel="nofollow">外部时钟模式1和外部时钟模式2的区别</a></li></ul> 
   </li><li><a href="#2mainc_350" rel="nofollow">2、main.c</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_2"></a>一、定时器定时中断</h2> 
<p><img src="https://images2.imgbox.com/c9/da/8rdGoKSL_o.png" alt="在这里插入图片描述"><br> 第一步，RCC开启时钟，定时器的基准时钟和整个外设的工作时钟都会同时打开，第二步，选择时基单元的时钟源，对于定时中断选内部时钟源，第三步，配置时基单元，包括这里的预分频器、自动重装器、计数模式等等，这些参数用一个结构体就可以配置好了，第四步，配置输出中断控制，允许更新中断输出到NVIC，第五步，配置NVIC，在NVIC中打开定时器中断的通道，并分配一个优先级，第六步，运行控制，整个模块配置完后使能一下计数器，当定时器使能后计数器开始计数，计数器更新触发中断，最后再写一个定时器的中断函数，中断函数每隔一段时间自动执行一次。</p> 
<h3><a id="_5"></a>与定时器有关的库函数</h3> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">TIM_DeInit</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//恢复缺省配置，缺省就是默认</span>
<span class="token keyword">void</span> <span class="token function">TIM_TimeBaseInit</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> TIM_TimeBaseInitTypeDef<span class="token operator">*</span> TIM_TimeBaseInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//时基单元初始化，第一个参数选择某个定时器，第二个结构体包含配置时基单元的一些参数</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC1Init</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> TIM_OCInitTypeDef<span class="token operator">*</span> TIM_OCInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC2Init</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> TIM_OCInitTypeDef<span class="token operator">*</span> TIM_OCInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC3Init</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> TIM_OCInitTypeDef<span class="token operator">*</span> TIM_OCInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC4Init</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> TIM_OCInitTypeDef<span class="token operator">*</span> TIM_OCInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ICInit</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> TIM_ICInitTypeDef<span class="token operator">*</span> TIM_ICInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_PWMIConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> TIM_ICInitTypeDef<span class="token operator">*</span> TIM_ICInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_BDTRConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> TIM_BDTRInitTypeDef <span class="token operator">*</span>TIM_BDTRInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_TimeBaseStructInit</span><span class="token punctuation">(</span>TIM_TimeBaseInitTypeDef<span class="token operator">*</span> TIM_TimeBaseInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//把结构体变量赋默认值</span>
<span class="token keyword">void</span> <span class="token function">TIM_OCStructInit</span><span class="token punctuation">(</span>TIM_OCInitTypeDef<span class="token operator">*</span> TIM_OCInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ICStructInit</span><span class="token punctuation">(</span>TIM_ICInitTypeDef<span class="token operator">*</span> TIM_ICInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_BDTRStructInit</span><span class="token punctuation">(</span>TIM_BDTRInitTypeDef<span class="token operator">*</span> TIM_BDTRInitStruct<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_Cmd</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//使能计数器，第一个参数选择定时器，第二个参数使能或失能</span>
<span class="token keyword">void</span> <span class="token function">TIM_CtrlPWMOutputs</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ITConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_IT<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//使能中断输出信号，第二个选择要配置哪个中断输出</span>
<span class="token keyword">void</span> <span class="token function">TIM_GenerateEvent</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_EventSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_DMAConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_DMABase<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_DMABurstLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_DMACmd</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_DMASource<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_InternalClockConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//选择内部时钟</span>
<span class="token keyword">void</span> <span class="token function">TIM_ITRxExternalClockConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_InputTriggerSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//选择ITRX其他定时器的时钟</span>
<span class="token keyword">void</span> <span class="token function">TIM_TIxExternalClockConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_TIxExternalCLKSource<span class="token punctuation">,</span>
                                <span class="token class-name">uint16_t</span> TIM_ICPolarity<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> ICFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//选择TIx捕获通道的时钟，第二个参数选择TIx具体的某个引脚，第三个输入的极性，第四个滤波器</span>
<span class="token keyword">void</span> <span class="token function">TIM_ETRClockMode1Config</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ExtTRGPrescaler<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ExtTRGPolarity<span class="token punctuation">,</span>
                             <span class="token class-name">uint16_t</span> ExtTRGFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//选择ETR通过外部时钟模式1输入的时钟，第二个参数外部触发预分频器，三四极性和滤波器</span>
<span class="token keyword">void</span> <span class="token function">TIM_ETRClockMode2Config</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ExtTRGPrescaler<span class="token punctuation">,</span> 
                             <span class="token class-name">uint16_t</span> TIM_ExtTRGPolarity<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> ExtTRGFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//选择ETR通过外部时钟模式2输入的时钟，第二个参数外部触发预分频器，三四极性和滤波器</span>
<span class="token keyword">void</span> <span class="token function">TIM_ETRConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ExtTRGPrescaler<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ExtTRGPolarity<span class="token punctuation">,</span>
                   <span class="token class-name">uint16_t</span> ExtTRGFilter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//单独用来配置ETR引脚的预分频器、极性、滤波器</span>
<span class="token keyword">void</span> <span class="token function">TIM_PrescalerConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> Prescaler<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_PSCReloadMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//在初始化结构体里有很多关键的参数，比如自动重装值和预分频值等等，这些参数可能在初始化后还需要更改</span>
<span class="token comment">//如果为了改某个参数重新调用初始化参数太麻烦，用一些单独的函数方便更改关键参数</span>
<span class="token comment">//单独写预分频值，第一个参数写入的预分频值，第二个写入的模式</span>
<span class="token keyword">void</span> <span class="token function">TIM_CounterModeConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_CounterMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//改变计数器的计数模式</span>
<span class="token keyword">void</span> <span class="token function">TIM_SelectInputTrigger</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_InputTriggerSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_EncoderInterfaceConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_EncoderMode<span class="token punctuation">,</span>
                                <span class="token class-name">uint16_t</span> TIM_IC1Polarity<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_IC2Polarity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ForcedOC1Config</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ForcedAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ForcedOC2Config</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ForcedAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ForcedOC3Config</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ForcedAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ForcedOC4Config</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ForcedAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ARRPreloadConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//自动重装器预装功能配置</span>
<span class="token keyword">void</span> <span class="token function">TIM_SelectCOM</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SelectCCDMA</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_CCPreloadControl</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC1PreloadConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCPreload<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC2PreloadConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCPreload<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC3PreloadConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCPreload<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC4PreloadConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCPreload<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC1FastConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCFast<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC2FastConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCFast<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC3FastConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCFast<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC4FastConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCFast<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ClearOC1Ref</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCClear<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ClearOC2Ref</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCClear<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ClearOC3Ref</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCClear<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ClearOC4Ref</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCClear<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC1PolarityConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCPolarity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC1NPolarityConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCNPolarity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC2PolarityConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCPolarity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC2NPolarityConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCNPolarity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC3PolarityConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCPolarity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC3NPolarityConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCNPolarity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_OC4PolarityConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCPolarity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_CCxCmd</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_Channel<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_CCx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_CCxNCmd</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_Channel<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_CCxN<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SelectOCxM</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_Channel<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OCMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_UpdateDisableConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_UpdateRequestConfig</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_UpdateSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SelectHallSensor</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> FunctionalState NewState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SelectOnePulseMode</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_OPMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SelectOutputTrigger</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_TRGOSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SelectSlaveMode</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_SlaveMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SelectMasterSlaveMode</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_MasterSlaveMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetCounter</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> Counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//给计数器写入一个值</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetAutoreload</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> Autoreload<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//给自动重装器写入一个值</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetCompare1</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> Compare1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetCompare2</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> Compare2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetCompare3</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> Compare3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetCompare4</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> Compare4<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetIC1Prescaler</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ICPSC<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetIC2Prescaler</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ICPSC<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetIC3Prescaler</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ICPSC<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetIC4Prescaler</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_ICPSC<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_SetClockDivision</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_CKD<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">uint16_t</span> <span class="token function">TIM_GetCapture1</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">uint16_t</span> <span class="token function">TIM_GetCapture2</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">uint16_t</span> <span class="token function">TIM_GetCapture3</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">uint16_t</span> <span class="token function">TIM_GetCapture4</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">uint16_t</span> <span class="token function">TIM_GetCounter</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//查看当前计数器计到哪里了</span>
<span class="token class-name">uint16_t</span> <span class="token function">TIM_GetPrescaler</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//获取当前预分频器的值</span>
FlagStatus <span class="token function">TIM_GetFlagStatus</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_FLAG<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ClearFlag</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_FLAG<span class="token punctuation">)</span><span class="token punctuation">;</span>
ITStatus <span class="token function">TIM_GetITStatus</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_IT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">TIM_ClearITPendingBit</span><span class="token punctuation">(</span>TIM_TypeDef<span class="token operator">*</span> TIMx<span class="token punctuation">,</span> <span class="token class-name">uint16_t</span> TIM_IT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//上4获取标志位和清除标志位</span>

</code></pre> 
<h3><a id="1Timerc_124"></a>1、Timer.c</h3> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stm32f10x.h"</span>                  <span class="token comment">// Device header</span></span>

<span class="token comment">/**
  * 函    数：定时中断初始化
  * 参    数：无
  * 返 回 值：无
  */</span>
<span class="token keyword">void</span> <span class="token function">Timer_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">/*开启时钟*/</span>
	<span class="token function">RCC_APB1PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB1Periph_TIM2<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//开启TIM2的时钟</span>
	
	<span class="token comment">/*配置时钟源*/</span>
	<span class="token function">TIM_InternalClockConfig</span><span class="token punctuation">(</span>TIM2<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//选择TIM2为内部时钟，若不调用此函数，TIM默认也为内部时钟</span>
	
	<span class="token comment">/*时基单元初始化*/</span>
	TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure<span class="token punctuation">;</span>				<span class="token comment">//定义结构体变量</span>
	TIM_TimeBaseInitStructure<span class="token punctuation">.</span>TIM_ClockDivision <span class="token operator">=</span> TIM_CKD_DIV1<span class="token punctuation">;</span>		<span class="token comment">//时钟分频，选择不分频，此参数用于配置滤波器时钟，不影响时基单元功能</span>
	<span class="token comment">//在定时器的外部信号输入引脚，一般都有滤波器，工作原理，在一个固定的时钟频率f下进行采样，</span>
	<span class="token comment">//如果连续N个采样点都为相同的电平，代表输入信号稳定，输出采样值，如果不全相同，说明有抖动</span>
	<span class="token comment">//采样频率f越低，采样点数越多，滤波效果越好，不过信号延迟也越大</span>
	<span class="token comment">//采样频率f从哪来？可以由内部时钟直接而来，或内部时钟加一个时钟分频而来，分频多少由参数ClockDivision决定</span>
	TIM_TimeBaseInitStructure<span class="token punctuation">.</span>TIM_CounterMode <span class="token operator">=</span> TIM_CounterMode_Up<span class="token punctuation">;</span>	<span class="token comment">//计数器模式，选择向上计数</span>
	TIM_TimeBaseInitStructure<span class="token punctuation">.</span>TIM_Period <span class="token operator">=</span> <span class="token number">10000</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>				<span class="token comment">//计数周期，即ARR自动重装寄存器的值</span>
	TIM_TimeBaseInitStructure<span class="token punctuation">.</span>TIM_Prescaler <span class="token operator">=</span> <span class="token number">7200</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>				<span class="token comment">//预分频器，即PSC预分频器的值</span>
	<span class="token comment">//定时1秒，也就是定时频率为1Hz，在10K的频率下计10000个数就是1s</span>
	TIM_TimeBaseInitStructure<span class="token punctuation">.</span>TIM_RepetitionCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>			<span class="token comment">//重复计数器，高级定时器才会用到</span>
	<span class="token function">TIM_TimeBaseInit</span><span class="token punctuation">(</span>TIM2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>TIM_TimeBaseInitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//将结构体变量交给TIM_TimeBaseInit，配置TIM2的时基单元	</span>
	
	<span class="token comment">/*中断输出配置*/</span>
	<span class="token function">TIM_ClearFlag</span><span class="token punctuation">(</span>TIM2<span class="token punctuation">,</span> TIM_FLAG_Update<span class="token punctuation">)</span><span class="token punctuation">;</span>						<span class="token comment">//清除定时器更新标志位</span>
																<span class="token comment">//TIM_TimeBaseInit函数末尾，手动产生了更新事件</span>
																<span class="token comment">//若不清除此标志位，则开启中断后，会立刻进入一次中断</span>
																<span class="token comment">//如果不介意此问题，则不清除此标志位也可</span>
	<span class="token comment">//不清除时，TimeBaseInit函数立刻生成一个更新事件来重新装载预分频器和重复计数器的值</span>
	<span class="token comment">//预分频器有个缓冲寄存器，写的值只有在更新事件时才起作用	，这里为了让值立刻起作用，手动生成了一个更新事件，这样预分配器的值就有效了</span>
	<span class="token comment">//副作用是更新事件和更新中断是同时发生的，更新中断会置更新中断标志位，一旦初始化完成更新中断就立即进入，也就是刚一上电就立刻进中断</span>
	<span class="token comment">//解决方法就是在TimeBaseInit后面、开启中断的前面再手动调用一下TIM_ClearFlag（）				</span>
	
	<span class="token function">TIM_ITConfig</span><span class="token punctuation">(</span>TIM2<span class="token punctuation">,</span> TIM_IT_Update<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>					<span class="token comment">//开启TIM2的更新中断</span>
	<span class="token comment">//使能更新中断，开启更新中断到NVIC的通路</span>
	
	<span class="token comment">/*NVIC中断分组*/</span>
	<span class="token function">NVIC_PriorityGroupConfig</span><span class="token punctuation">(</span>NVIC_PriorityGroup_2<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//配置NVIC为分组2</span>
																<span class="token comment">//即抢占优先级范围：0~3，响应优先级范围：0~3</span>
																<span class="token comment">//此分组配置在整个工程中仅需调用一次</span>
																<span class="token comment">//若有多个中断，可以把此代码放在main函数内，while循环之前</span>
																<span class="token comment">//若调用多次配置分组的代码，则后执行的配置会覆盖先执行的配置</span>
	
	<span class="token comment">/*NVIC配置*/</span>
	NVIC_InitTypeDef NVIC_InitStructure<span class="token punctuation">;</span>						<span class="token comment">//定义结构体变量</span>
	NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannel <span class="token operator">=</span> TIM2_IRQn<span class="token punctuation">;</span>				<span class="token comment">//选择配置NVIC的TIM2线</span>
	NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelCmd <span class="token operator">=</span> ENABLE<span class="token punctuation">;</span>				<span class="token comment">//指定NVIC线路使能</span>
	NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelPreemptionPriority <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>	<span class="token comment">//指定NVIC线路的抢占优先级为2</span>
	NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelSubPriority <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>			<span class="token comment">//指定NVIC线路的响应优先级为1</span>
	<span class="token function">NVIC_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>NVIC_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>								<span class="token comment">//将结构体变量交给NVIC_Init，配置NVIC外设</span>
	
	<span class="token comment">/*TIM使能*/</span>
	<span class="token function">TIM_Cmd</span><span class="token punctuation">(</span>TIM2<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//使能TIM2，定时器开始运行</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 定时器中断函数，可以复制到使用它的地方

//如果不复制到别的地方，就在这里用main文件里的Num++呢？
//要在本文件里函数外部加声明"extern uint16_t Num；"
//疑问：既然是全局变量，任何文件下都可以使用，为何还要加个 “extern int iNum” 的声明？
//全局变量的作用域为其定义位置开始，至文件结尾，也即只有文件作用域。
//为了使全局变量的作用域扩大到多个文件中，C++中提供了extern关键字。 extern关键字的声明，并不分配内存。

void TIM2_IRQHandler(void)
{
	if (TIM_GetITStatus(TIM2, TIM_IT_Update) == SET)
	{
		
		TIM_ClearITPendingBit(TIM2, TIM_IT_Update);
	}
}
*/</span>
<span class="token comment">//启动文件里有所有的中断函数，中断函数不是自己定义的，是系统给的，因为这样才能中断自动执行</span>

</code></pre> 
<h3><a id="2mainc_209"></a>2、main.c</h3> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stm32f10x.h"</span>                  <span class="token comment">// Device header</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Delay.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"OLED.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Timer.h"</span></span>

<span class="token class-name">uint16_t</span> Num<span class="token punctuation">;</span>			<span class="token comment">//定义在定时器中断里自增的变量</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">/*模块初始化*/</span>
	<span class="token function">OLED_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//OLED初始化</span>
	<span class="token function">Timer_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//定时中断初始化</span>
	
	<span class="token comment">/*显示静态字符串*/</span>
	<span class="token function">OLED_ShowString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Num:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//1行1列显示字符串Num:</span>
	
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">OLED_ShowNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> Num<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//不断刷新显示Num变量</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * 函    数：TIM2中断函数
  * 参    数：无
  * 返 回 值：无
  * 注意事项：此函数为中断函数，无需调用，中断触发后自动执行
  *           函数名为预留的指定名称，可以从启动文件复制
  *           请确保函数名正确，不能有任何差异，否则中断函数将不能进入
  */</span>
<span class="token keyword">void</span> <span class="token function">TIM2_IRQHandler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">TIM_GetITStatus</span><span class="token punctuation">(</span>TIM2<span class="token punctuation">,</span> TIM_IT_Update<span class="token punctuation">)</span> <span class="token operator">==</span> SET<span class="token punctuation">)</span>		<span class="token comment">//判断是否是TIM2的更新事件触发的中断</span>
	<span class="token punctuation">{<!-- --></span>
		Num <span class="token operator">++</span><span class="token punctuation">;</span>												<span class="token comment">//Num变量自增，用于测试定时中断</span>
		<span class="token function">TIM_ClearITPendingBit</span><span class="token punctuation">(</span>TIM2<span class="token punctuation">,</span> TIM_IT_Update<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//清除TIM2更新事件的中断标志位</span>
															<span class="token comment">//中断标志位必须清除</span>
															<span class="token comment">//否则中断将连续不断地触发，导致主程序卡死</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<hr> 
<h2><a id="_256"></a>二、定时器外部时钟</h2> 
<h3><a id="1Timerc_257"></a>1、Timer.c</h3> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stm32f10x.h"</span>                  <span class="token comment">// Device header</span></span>

<span class="token comment">/**
  * 函    数：定时中断初始化
  * 参    数：无
  * 返 回 值：无
  * 注意事项：此函数配置为外部时钟，定时器相当于计数器
  */</span>
<span class="token keyword">void</span> <span class="token function">Timer_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">/*开启时钟*/</span>
	<span class="token function">RCC_APB1PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB1Periph_TIM2<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//开启TIM2的时钟</span>
	<span class="token function">RCC_APB2PeriphClockCmd</span><span class="token punctuation">(</span>RCC_APB2Periph_GPIOA<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//开启GPIOA的时钟</span>
	
	<span class="token comment">/*GPIO初始化*/</span>
	GPIO_InitTypeDef GPIO_InitStructure<span class="token punctuation">;</span>
	GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Mode <span class="token operator">=</span> GPIO_Mode_IPU<span class="token punctuation">;</span>
	GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Pin <span class="token operator">=</span> GPIO_Pin_0<span class="token punctuation">;</span>
	GPIO_InitStructure<span class="token punctuation">.</span>GPIO_Speed <span class="token operator">=</span> GPIO_Speed_50MHz<span class="token punctuation">;</span>
	<span class="token function">GPIO_Init</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span> <span class="token operator">&amp;</span>GPIO_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>						<span class="token comment">//将PA0引脚初始化为上拉输入</span>
	
	<span class="token comment">/*外部时钟配置*/</span>
	<span class="token function">TIM_ETRClockMode2Config</span><span class="token punctuation">(</span>TIM2<span class="token punctuation">,</span> TIM_ExtTRGPSC_OFF<span class="token punctuation">,</span> TIM_ExtTRGPolarity_NonInverted<span class="token punctuation">,</span> <span class="token number">0x0F</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//第二个参数是外部触发预分频器，这里选不分频，</span>
	<span class="token comment">//第三个是外部触发的极性，反向是低电平或下降沿均有效，这里不反向</span>
	<span class="token comment">//第四个参数是外部触发滤波器</span>
																<span class="token comment">//选择外部时钟模式2，时钟从TIM_ETR引脚输入</span>
																<span class="token comment">//注意TIM2的ETR引脚固定为PA0，无法随意更改</span>
																<span class="token comment">//最后一个滤波器参数加到最大0x0F，可滤除时钟信号抖动</span>
	
	<span class="token comment">/*时基单元初始化*/</span>
	TIM_TimeBaseInitTypeDef TIM_TimeBaseInitStructure<span class="token punctuation">;</span>				<span class="token comment">//定义结构体变量</span>
	TIM_TimeBaseInitStructure<span class="token punctuation">.</span>TIM_ClockDivision <span class="token operator">=</span> TIM_CKD_DIV1<span class="token punctuation">;</span>		<span class="token comment">//时钟分频，选择不分频，此参数用于配置滤波器时钟，不影响时基单元功能</span>
	TIM_TimeBaseInitStructure<span class="token punctuation">.</span>TIM_CounterMode <span class="token operator">=</span> TIM_CounterMode_Up<span class="token punctuation">;</span>	<span class="token comment">//计数器模式，选择向上计数</span>
	TIM_TimeBaseInitStructure<span class="token punctuation">.</span>TIM_Period <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>					<span class="token comment">//计数周期，即ARR的值</span>
	TIM_TimeBaseInitStructure<span class="token punctuation">.</span>TIM_Prescaler <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>				<span class="token comment">//预分频器，即PSC的值</span>
	TIM_TimeBaseInitStructure<span class="token punctuation">.</span>TIM_RepetitionCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>			<span class="token comment">//重复计数器，高级定时器才会用到</span>
	<span class="token function">TIM_TimeBaseInit</span><span class="token punctuation">(</span>TIM2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>TIM_TimeBaseInitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//将结构体变量交给TIM_TimeBaseInit，配置TIM2的时基单元	</span>
	
	<span class="token comment">/*中断输出配置*/</span>
	<span class="token function">TIM_ClearFlag</span><span class="token punctuation">(</span>TIM2<span class="token punctuation">,</span> TIM_FLAG_Update<span class="token punctuation">)</span><span class="token punctuation">;</span>						<span class="token comment">//清除定时器更新标志位</span>
																<span class="token comment">//TIM_TimeBaseInit函数末尾，手动产生了更新事件</span>
																<span class="token comment">//若不清除此标志位，则开启中断后，会立刻进入一次中断</span>
																<span class="token comment">//如果不介意此问题，则不清除此标志位也可</span>
																
	<span class="token function">TIM_ITConfig</span><span class="token punctuation">(</span>TIM2<span class="token punctuation">,</span> TIM_IT_Update<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>					<span class="token comment">//开启TIM2的更新中断</span>
	
	<span class="token comment">/*NVIC中断分组*/</span>
	<span class="token function">NVIC_PriorityGroupConfig</span><span class="token punctuation">(</span>NVIC_PriorityGroup_2<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//配置NVIC为分组2</span>
																<span class="token comment">//即抢占优先级范围：0~3，响应优先级范围：0~3</span>
																<span class="token comment">//此分组配置在整个工程中仅需调用一次</span>
																<span class="token comment">//若有多个中断，可以把此代码放在main函数内，while循环之前</span>
																<span class="token comment">//若调用多次配置分组的代码，则后执行的配置会覆盖先执行的配置</span>
	
	<span class="token comment">/*NVIC配置*/</span>
	NVIC_InitTypeDef NVIC_InitStructure<span class="token punctuation">;</span>						<span class="token comment">//定义结构体变量</span>
	NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannel <span class="token operator">=</span> TIM2_IRQn<span class="token punctuation">;</span>				<span class="token comment">//选择配置NVIC的TIM2线</span>
	NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelCmd <span class="token operator">=</span> ENABLE<span class="token punctuation">;</span>				<span class="token comment">//指定NVIC线路使能</span>
	NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelPreemptionPriority <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>	<span class="token comment">//指定NVIC线路的抢占优先级为2</span>
	NVIC_InitStructure<span class="token punctuation">.</span>NVIC_IRQChannelSubPriority <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>			<span class="token comment">//指定NVIC线路的响应优先级为1</span>
	<span class="token function">NVIC_Init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>NVIC_InitStructure<span class="token punctuation">)</span><span class="token punctuation">;</span>								<span class="token comment">//将结构体变量交给NVIC_Init，配置NVIC外设</span>
	
	<span class="token comment">/*TIM使能*/</span>
	<span class="token function">TIM_Cmd</span><span class="token punctuation">(</span>TIM2<span class="token punctuation">,</span> ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//使能TIM2，定时器开始运行</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * 函    数：返回定时器CNT的值
  * 参    数：无
  * 返 回 值：定时器CNT的值，范围：0~65535
  */</span>
<span class="token class-name">uint16_t</span> <span class="token function">Timer_GetCounter</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token function">TIM_GetCounter</span><span class="token punctuation">(</span>TIM2<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//返回定时器TIM2的CNT</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 定时器中断函数，可以复制到使用它的地方
void TIM2_IRQHandler(void)
{
	if (TIM_GetITStatus(TIM2, TIM_IT_Update) == SET)
	{
		
		TIM_ClearITPendingBit(TIM2, TIM_IT_Update);
	}
}
*/</span>

</code></pre> 
<h4><a id="12_348"></a>外部时钟模式1和外部时钟模式2的区别</h4> 
<p>外部时钟模式1使用外部输入脚(TIx)作为计数器时钟的时钟源，而外部时钟模式2使用外部触发输入(ETR)或内部触发输入(ITRx)作为计数器时钟的时钟源1。</p> 
<h3><a id="2mainc_350"></a>2、main.c</h3> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stm32f10x.h"</span>                  <span class="token comment">// Device header</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Delay.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"OLED.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Timer.h"</span></span>

<span class="token class-name">uint16_t</span> Num<span class="token punctuation">;</span>			<span class="token comment">//定义在定时器中断里自增的变量</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">/*模块初始化*/</span>
	<span class="token function">OLED_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//OLED初始化</span>
	<span class="token function">Timer_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//定时中断初始化</span>
	
	<span class="token comment">/*显示静态字符串*/</span>
	<span class="token function">OLED_ShowString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Num:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//1行1列显示字符串Num:</span>
	<span class="token function">OLED_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"CNT:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//2行1列显示字符串CNT:</span>
	
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">OLED_ShowNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> Num<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//不断刷新显示Num变量</span>
		<span class="token function">OLED_ShowNum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token function">Timer_GetCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//不断刷新显示CNT的值</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * 函    数：TIM2中断函数
  * 参    数：无
  * 返 回 值：无
  * 注意事项：此函数为中断函数，无需调用，中断触发后自动执行
  *           函数名为预留的指定名称，可以从启动文件复制
  *           请确保函数名正确，不能有任何差异，否则中断函数将不能进入
  */</span>
<span class="token keyword">void</span> <span class="token function">TIM2_IRQHandler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">TIM_GetITStatus</span><span class="token punctuation">(</span>TIM2<span class="token punctuation">,</span> TIM_IT_Update<span class="token punctuation">)</span> <span class="token operator">==</span> SET<span class="token punctuation">)</span>		<span class="token comment">//判断是否是TIM2的更新事件触发的中断</span>
	<span class="token punctuation">{<!-- --></span>
		Num <span class="token operator">++</span><span class="token punctuation">;</span>												<span class="token comment">//Num变量自增，用于测试定时中断</span>
		<span class="token function">TIM_ClearITPendingBit</span><span class="token punctuation">(</span>TIM2<span class="token punctuation">,</span> TIM_IT_Update<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//清除TIM2更新事件的中断标志位</span>
															<span class="token comment">//中断标志位必须清除</span>
															<span class="token comment">//否则中断将连续不断地触发，导致主程序卡死</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/70bde2562d5419322c67295dc3e4382d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【机器学习】-9.十大算法之一朴素贝叶斯（Naive Bayes）算法案例讲解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/83ef151d5bf3bff21401474c2c115fc6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【机器学习】解开反向传播算法的奥秘</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>