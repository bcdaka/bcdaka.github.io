<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[python] 罗技动态链接驱动库DLL 控制 键鼠 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9034220ec929f8b1d8d951e9305c042e/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="[python] 罗技动态链接驱动库DLL 控制 键鼠">
  <meta property="og:description" content="[python] 罗技动态链接驱动库DLL 控制 键鼠 最近在玩搬砖游戏晶核, 每天有很多重复繁琐的&#34;打卡&#34;操作, 得知隔壁御三家游戏就有大佬做了自动收割的辅助工具,我就想模仿写一个.不过大佬们写的开源工具厉害得多,加了神经网络自动识别,实现寻路和点击功能.我目前最多就是实现一个简单连点器加色块识别而已,而且这种原始手动的方法很不方便,我原本还想着写个表格导入操作功能.最后也不了了之了.太懒了. &lt;&lt; Python调用罗技驱动实现功能 &gt;&gt; https://www.python100.com/html/1S27NYQO8H34.html&lt;&lt; FPS游戏自动枪械识别&#43;压枪（以PUBG为例） &gt;&gt; https://blog.csdn.net/weixin_37827742/article/details/124242964&lt;&lt; AimLab OPENCV开源(包含Sendinput &#43; Fov等代码) &gt;&gt; https://www.bilibili.com/video/BV1q34y1e7ic/ 一、准备工作 需要安装python 3.8.10 64位 带 IDLE 的版本. 因为我会使用pyautogui来获取屏幕分辨率等操作,使用tkinter来创建简易弹窗提示操作;如果你只需要控制鼠标的话就不需要上述2个软件包,不然最好和我一样的python版本,32位或是版本太新太久都不支持pyautogui,或者使用其他软件包代替也可以.tkinter软件包是安装IDLE时自带的,不能手动安装,只能通过安装IDLE来安装,很奇怪.我尝试了很久得出这样一个个结论.本教程使用的是动态链接驱动库是罗技的LGS_9.02.65_x64_Logitech.exe版本, 注意不能是其他版本,不然对不上,先安装这个驱动程序,那动态链接库才有效果.安装完成后的软件界面是这样的: 最后在程序中加载dll文件, 就可以驱动键鼠了.该软件只需要开机打开一次即可.打开后退出也会继续生效.但是关机重启后又失效,所以开机后要打开一次,之后关闭退出就行.另外关于dll文件,第一次接触的人可能不懂是什么,没关系,因为我也不懂是啥.不过不影响使用,dll有点像别人打包好的库,具有一些函数,你导入到自己的.py后,就可以直接使用这些函数.使用一些工具depends22_x64可以查看dll打包了什么函数,这里我只会通过名字和实践猜测每个函数的功能. 注意!!! 不同地方下载的dll文件可能是不同人打包的,可能函数名或函数功能不太一样. 二、开始敲代码 1. 框架 先写个基本框架, 里面包含了开头注释, 软件包导入, 打印函数打包, pid函数打包, 主函数打包; 一个等待填写的空类; &#34;&#34;&#34; 时间 : 2023年12月30日 07:34:48 作者 : Lovely_him 说明 : 兴趣使然 &#34;&#34;&#34; #!/usr/bin/env python3 import sys import win32api import os # 获取文件路径 import time # 获取时间和延时 import ctypes # 调用dll文件 import tkinter as tk # python 内置库,需要安装时勾选安装IDE才会安装,坑爹 import threading # 多线程 import pyautogui # 获取屏幕鼠标坐标 import random # 随机数 def print_tkui(strs): &#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-15T19:51:26+08:00">
    <meta property="article:modified_time" content="2024-02-15T19:51:26+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[python] 罗技动态链接驱动库DLL 控制 键鼠</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="python_DLL___0"></a>[python] 罗技动态链接驱动库DLL 控制 键鼠</h2> 
<blockquote> 
 <ul><li>最近在玩搬砖游戏晶核, 每天有很多重复繁琐的"打卡"操作, 得知隔壁御三家游戏就有大佬做了自动收割的辅助工具,我就想模仿写一个.</li><li>不过大佬们写的开源工具厉害得多,加了神经网络自动识别,实现寻路和点击功能.我目前最多就是实现一个简单连点器加色块识别而已,而且这种原始手动的方法很不方便,我原本还想着写个表格导入操作功能.最后也不了了之了.太懒了.</li></ul> 
</blockquote> 
<blockquote> 
 <ol><li>&lt;&lt; <a href="https://www.python100.com/html/1S27NYQO8H34.html" rel="nofollow">Python调用罗技驱动实现功能</a> &gt;&gt; https://www.python100.com/html/1S27NYQO8H34.html</li><li>&lt;&lt; <a href="https://blog.csdn.net/weixin_37827742/article/details/124242964">FPS游戏自动枪械识别+压枪（以PUBG为例）</a> &gt;&gt; https://blog.csdn.net/weixin_37827742/article/details/124242964</li><li>&lt;&lt; <a href="https://www.bilibili.com/video/BV1q34y1e7ic/" rel="nofollow">AimLab OPENCV开源(包含Sendinput + Fov等代码)</a> &gt;&gt; https://www.bilibili.com/video/BV1q34y1e7ic/</li></ol> 
</blockquote> 
<h2><a id="_9"></a>一、准备工作</h2> 
<ul><li>需要安装<code>python 3.8.10 64位</code> 带 <code>IDLE</code> 的版本. 因为我会使用<code>pyautogui</code>来获取屏幕分辨率等操作,使用<code>tkinter</code>来创建简易弹窗提示操作;</li><li>如果你只需要控制鼠标的话就不需要上述2个软件包,不然最好和我一样的python版本,32位或是版本太新太久都不支持<code>pyautogui</code>,或者使用其他软件包代替也可以.<code>tkinter</code>软件包是安装<code>IDLE</code>时自带的,不能手动安装,只能通过安装<code>IDLE</code>来安装,很奇怪.我尝试了很久得出这样一个个结论.</li><li>本教程使用的是动态链接驱动库是罗技的<code>LGS_9.02.65_x64_Logitech.exe</code>版本, 注意不能是其他版本,不然对不上,先安装这个驱动程序,那动态链接库才有效果.安装完成后的软件界面是这样的:</li></ul> 
<p><img src="https://images2.imgbox.com/c0/d4/orkHuGi4_o.png" alt="在这里插入图片描述"></p> 
<ul><li>最后在程序中加载<code>dll</code>文件, 就可以驱动键鼠了.该软件只需要开机打开一次即可.打开后退出也会继续生效.但是关机重启后又失效,所以开机后要打开一次,之后关闭退出就行.</li><li>另外关于<code>dll</code>文件,第一次接触的人可能不懂是什么,没关系,因为我也不懂是啥.不过不影响使用,<code>dll</code>有点像别人打包好的库,具有一些函数,你导入到自己的.py后,就可以直接使用这些函数.使用一些工具<code>depends22_x64</code>可以查看<code>dll</code>打包了什么函数,这里我只会通过名字和实践猜测每个函数的功能.</li></ul> 
<p><img src="https://images2.imgbox.com/3c/e3/4xDhK2ke_o.png" alt="在这里插入图片描述"></p> 
<ul><li><strong>注意!!! 不同地方下载的<code>dll</code>文件可能是不同人打包的,可能函数名或函数功能不太一样.</strong></li></ul> 
<h2><a id="_23"></a>二、开始敲代码</h2> 
<h3><a id="1__25"></a>1. 框架</h3> 
<ul><li>先写个基本框架, 里面包含了开头注释, 软件包导入, 打印函数打包, pid函数打包, 主函数打包; 一个等待填写的空类;</li></ul> 
<pre><code class="prism language-python">
<span class="token triple-quoted-string string">"""
时间 : 2023年12月30日 07:34:48
作者 : Lovely_him
说明 : 兴趣使然
"""</span>

<span class="token comment">#!/usr/bin/env python3</span>
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> win32api
<span class="token keyword">import</span> os <span class="token comment"># 获取文件路径</span>
<span class="token keyword">import</span> time <span class="token comment"># 获取时间和延时</span>
<span class="token keyword">import</span> ctypes <span class="token comment"># 调用dll文件</span>

<span class="token keyword">import</span> tkinter <span class="token keyword">as</span> tk <span class="token comment"># python 内置库,需要安装时勾选安装IDE才会安装,坑爹</span>
<span class="token keyword">import</span> threading <span class="token comment"># 多线程</span>
<span class="token keyword">import</span> pyautogui <span class="token comment"># 获取屏幕鼠标坐标</span>
<span class="token keyword">import</span> random <span class="token comment"># 随机数</span>

<span class="token keyword">def</span> <span class="token function">print_tkui</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 打包控制台输出 """</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>strs<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">PID</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""PID"""</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> P<span class="token operator">=</span><span class="token number">0.35</span><span class="token punctuation">,</span> I<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> D<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""PID"""</span>
        self<span class="token punctuation">.</span>kp <span class="token operator">=</span> P <span class="token comment"># 比例 </span>
        self<span class="token punctuation">.</span>ki <span class="token operator">=</span> I <span class="token comment"># 积分</span>
        self<span class="token punctuation">.</span>kd <span class="token operator">=</span> D <span class="token comment"># 微分</span>
        self<span class="token punctuation">.</span>uPrevious <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># 上一次控制量</span>
        self<span class="token punctuation">.</span>uCurent <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># 这一次控制量</span>
        self<span class="token punctuation">.</span>setValue <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># 目标值</span>
        self<span class="token punctuation">.</span>lastErr <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># 上一次差值</span>
        self<span class="token punctuation">.</span>errSum <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># 所有差值的累加</span>
        self<span class="token punctuation">.</span>errSumLimit <span class="token operator">=</span> <span class="token number">10</span> <span class="token comment"># 近两次的差值累加</span>
        
    <span class="token keyword">def</span> <span class="token function">pidPosition</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> setValue<span class="token punctuation">,</span> curValue<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""位置式 PID 输出控制量"""</span>
        self<span class="token punctuation">.</span>setValue <span class="token operator">=</span> setValue <span class="token comment"># 更新目标值</span>
        err <span class="token operator">=</span> self<span class="token punctuation">.</span>setValue <span class="token operator">-</span> curValue <span class="token comment"># 计算差值, 作为比例项</span>
        dErr <span class="token operator">=</span> err <span class="token operator">-</span> self<span class="token punctuation">.</span>lastErr <span class="token comment"># 计算近两次的差值, 作为微分项</span>
        self<span class="token punctuation">.</span>errSum <span class="token operator">+=</span> err <span class="token comment"># 累加这一次差值,作为积分项</span>
        outPID <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>kp <span class="token operator">*</span> err<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>ki <span class="token operator">*</span> self<span class="token punctuation">.</span>errSum<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>kd <span class="token operator">*</span> dErr<span class="token punctuation">)</span> <span class="token comment"># PID</span>
        self<span class="token punctuation">.</span>lastErr <span class="token operator">=</span> err <span class="token comment"># 保存这一次差值,作为下一次的上一次差值</span>
        <span class="token keyword">return</span> outPID <span class="token comment"># 输出</span>
    
    <span class="token keyword">def</span> <span class="token function">pidIncrease</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> setValue<span class="token punctuation">,</span> curValue<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""增量式 PID 输出控制量的差值"""</span>
        self<span class="token punctuation">.</span>uCurent <span class="token operator">=</span> self<span class="token punctuation">.</span>pidPosition<span class="token punctuation">(</span>setValue<span class="token punctuation">,</span> curValue<span class="token punctuation">)</span> <span class="token comment"># 计算位置式</span>
        outPID <span class="token operator">=</span> self<span class="token punctuation">.</span>uCurent <span class="token operator">-</span> self<span class="token punctuation">.</span>uPrevious <span class="token comment"># 计算差值 </span>
        self<span class="token punctuation">.</span>uPrevious <span class="token operator">=</span> self<span class="token punctuation">.</span>uCurent <span class="token comment"># 保存这一次输出量</span>
        <span class="token keyword">return</span> outPID <span class="token comment"># 输出</span>

<span class="token keyword">class</span> <span class="token class-name">LOGITECH</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""罗技动态链接库"""</span>
    <span class="token keyword">pass</span>
    
<span class="token keyword">def</span> <span class="token function">Mymain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 主函数 """</span>
    <span class="token keyword">pass</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" 主运行 """</span>
    Mymain<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="2__95"></a>2. 导入</h3> 
<ul><li>然后开始往空类里填写内容, 第一步导入<code>dll</code>文件,直接写在类的开头,只要这个类被导入,那就导入文件作准备.注意,我还添加了几个局部的常量,用于判断后续的保护措施.</li><li>记得注意路径是否正确,还有提前打开罗技驱动软件.成功执行运行就会有以下提示</li></ul> 
<p><img src="https://images2.imgbox.com/12/20/umLGBkGo_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">LOGITECH</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""罗技动态链接库"""</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 当前路径</span>
        dll <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>CDLL<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>file_path<span class="token punctuation">}</span></span><span class="token string">/logitech_driver.dll'</span></span><span class="token punctuation">)</span> <span class="token comment"># 打开路径文件</span>
        state <span class="token operator">=</span> <span class="token punctuation">(</span>dll<span class="token punctuation">.</span>device_open<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 启动, 并返回是否成功</span>
        WAIT_TIME <span class="token operator">=</span> <span class="token number">0.5</span> <span class="token comment"># 等待时间</span>
        RANDOM_NUM <span class="token operator">=</span> <span class="token number">0.1</span> <span class="token comment"># 最大时间随机数</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> state<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'错误, 未找到GHUB或LGS驱动程序'</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> FileNotFoundError<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'错误, 找不到DLL文件'</span></span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
</code></pre> 
<h3><a id="3__119"></a>3. 鼠标点击</h3> 
<ul><li>然后开始逐一打包调用<code>dll</code>库内的函数,实现功能; 先是鼠标按下和松开,合并为点击的功能;为了模拟真实点击,我加了按下后随机延时再松开.</li></ul> 
<pre><code class="prism language-python">    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">mouse_down</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">""" 鼠标按下 code: 左 中 右 """</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>state<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        print_tkui<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'按下</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>code<span class="token punctuation">}</span></span><span class="token string">键'</span></span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> code <span class="token operator">==</span> <span class="token string">'左'</span><span class="token punctuation">:</span>
            code <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">elif</span> code <span class="token operator">==</span> <span class="token string">'中'</span><span class="token punctuation">:</span>
            code <span class="token operator">=</span> <span class="token number">2</span>
        <span class="token keyword">elif</span> code <span class="token operator">==</span> <span class="token string">'右'</span><span class="token punctuation">:</span>
            code <span class="token operator">=</span> <span class="token number">3</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token comment"># 默认</span>
            code <span class="token operator">=</span> <span class="token number">1</span> 
        self<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>mouse_down<span class="token punctuation">(</span>code<span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">mouse_up</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">""" 鼠标松开 code: 左 中 右 """</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>state<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        print_tkui<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'松开</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>code<span class="token punctuation">}</span></span><span class="token string">键'</span></span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> code <span class="token operator">==</span> <span class="token string">'左'</span><span class="token punctuation">:</span>
            code <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">elif</span> code <span class="token operator">==</span> <span class="token string">'中'</span><span class="token punctuation">:</span>
            code <span class="token operator">=</span> <span class="token number">2</span>
        <span class="token keyword">elif</span> code <span class="token operator">==</span> <span class="token string">'右'</span><span class="token punctuation">:</span>
            code <span class="token operator">=</span> <span class="token number">3</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token comment"># 默认</span>
            code <span class="token operator">=</span> <span class="token number">1</span> 
        self<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>mouse_up<span class="token punctuation">(</span>code<span class="token punctuation">)</span>
    
    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">mouse_click</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> code<span class="token punctuation">,</span> wait_time<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">""" 鼠标点击 code: 左 中 右 """</span>
        <span class="token keyword">if</span> wait_time <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token comment"># 如果没有规定等待时间</span>
            wait_time <span class="token operator">=</span> self<span class="token punctuation">.</span>WAIT_TIME <span class="token comment"># 默认等待时间</span>
        <span class="token keyword">if</span> wait_time <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token comment"># 如果等待时间不是0</span>
            wait_time <span class="token operator">+=</span> random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>RANDOM_NUM<span class="token punctuation">)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>wait_time<span class="token punctuation">)</span> <span class="token comment"># 延时时间,秒,生成随机小数0~1.0</span>
            
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>state<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        print_tkui<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'等待</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>wait_time<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">秒后, 点击</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>code<span class="token punctuation">}</span></span><span class="token string">键'</span></span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> code <span class="token operator">==</span> <span class="token string">'左'</span><span class="token punctuation">:</span>
            code <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">elif</span> code <span class="token operator">==</span> <span class="token string">'中'</span><span class="token punctuation">:</span>
            code <span class="token operator">=</span> <span class="token number">2</span>
        <span class="token keyword">elif</span> code <span class="token operator">==</span> <span class="token string">'右'</span><span class="token punctuation">:</span>
            code <span class="token operator">=</span> <span class="token number">3</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token comment"># 默认</span>
            code <span class="token operator">=</span> <span class="token number">1</span> 

        self<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>mouse_down<span class="token punctuation">(</span>code<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>RANDOM_NUM<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 延时时间,秒,生成随机小数0~1.0</span>
        self<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>mouse_up<span class="token punctuation">(</span>code<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="4__180"></a>4. 键盘点击</h3> 
<ul><li>和鼠标点击相似, 键盘点击也一样, 有按下和松开组合.</li></ul> 
<pre><code class="prism language-python">    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">key_down</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""键盘下去 code: 'a'-'z':A-Z, '0'-'9':0-9"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>state<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        print_tkui<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'按下</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>code<span class="token punctuation">}</span></span><span class="token string">键'</span></span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>key_down<span class="token punctuation">(</span>code<span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">key_up</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""键盘起来 code: 'a'-'z':A-Z, '0'-'9':0-9"""</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>state<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        print_tkui<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'松开</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>code<span class="token punctuation">}</span></span><span class="token string">键'</span></span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>key_up<span class="token punctuation">(</span>code<span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">key_click</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> code<span class="token punctuation">,</span> wait_time<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> time_down<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""键盘点击 code: 'a'-'z':A-Z, '0'-'9':0-9"""</span>
        <span class="token keyword">if</span> wait_time <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token comment"># 如果没有规定等待时间</span>
            wait_time <span class="token operator">=</span> self<span class="token punctuation">.</span>WAIT_TIME <span class="token comment"># 默认等待时间</span>
        <span class="token keyword">if</span> wait_time <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token comment"># 如果等待时间不是0</span>
            wait_time <span class="token operator">+=</span> random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>RANDOM_NUM<span class="token punctuation">)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>wait_time<span class="token punctuation">)</span> <span class="token comment"># 延时时间,秒,生成随机小数0~1.0</span>
        <span class="token keyword">if</span> time_down <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token comment"># 如果有长按时间,就会变成长按</span>
            wait_time <span class="token operator">=</span> <span class="token number">0</span>
            
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>state<span class="token punctuation">:</span> <span class="token comment"># 保护措施</span>
            <span class="token keyword">return</span>
        print_tkui<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'等待</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>wait_time<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">秒后, 点击</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>code<span class="token punctuation">}</span></span><span class="token string">键, 长按时间</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>time_down<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>key_down<span class="token punctuation">(</span>code<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>wait_time <span class="token operator">+</span> time_down <span class="token operator">+</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>RANDOM_NUM<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 延时时间,秒,生成随机小数0~1.0, 不可以延时, </span>
        self<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>key_up<span class="token punctuation">(</span>code<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="5__219"></a>5. 鼠标移动</h3> 
<ul><li>然后是比较抽象的鼠标移动, 它的函数输入是移动量, 就是模拟实际鼠标的移动距离, 而不是屏幕鼠标的移动距离. 屏幕鼠标的移动距离受电脑设置的鼠标速度, 和实际鼠标的cpi有很大关系. 实际我们使用的时候, 肯定只希望以屏幕作为参考系,在屏幕上以坐标移动.所以我打包了一下,使用pid自动调节的方式,实现输入屏幕坐标,鼠标移动到相应坐标位置;</li></ul> 
<pre><code class="prism language-python">    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">mouse_move</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> end_xy<span class="token punctuation">,</span> wait_time<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> min_xy<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> min_time<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        等待多久后 缓慢移动 \n
        end_x       绝对横坐标 \n
        end_y       绝对纵坐标 \n
        time_s      等待时间 \n
        min_xy      最小移动控制量 \n
        min_time    最小移动时间 \n
        """</span>
        <span class="token keyword">if</span> wait_time <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token comment"># 如果没有规定等待时间</span>
            wait_time <span class="token operator">=</span> self<span class="token punctuation">.</span>WAIT_TIME <span class="token comment"># 默认等待时间</span>
        <span class="token keyword">if</span> wait_time <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token comment"># 如果等待时间不是0</span>
            wait_time <span class="token operator">+=</span> random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>RANDOM_NUM<span class="token punctuation">)</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>wait_time<span class="token punctuation">)</span> <span class="token comment"># 延时时间,秒,生成随机小数0~1.0</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>state<span class="token punctuation">:</span> <span class="token comment"># 保护措施</span>
            <span class="token keyword">return</span>
        
        end_x<span class="token punctuation">,</span> end_y <span class="token operator">=</span> end_xy
        print_tkui<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'等待</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>wait_time<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">秒后, 移动到坐标</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span>end_x<span class="token punctuation">,</span> end_y<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

        pid_x <span class="token operator">=</span> PID<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 创建pid对象</span>
        pid_y <span class="token operator">=</span> PID<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span> <span class="token comment"># 循环控制鼠标直到重合坐标</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>min_time<span class="token punctuation">)</span> <span class="token comment"># 延时时间,秒,生成随机小数0~1.0</span>
            new_x<span class="token punctuation">,</span> new_y <span class="token operator">=</span> pyautogui<span class="token punctuation">.</span>position<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 获取当前鼠标位置</span>

            move_x <span class="token operator">=</span> pid_x<span class="token punctuation">.</span>pidPosition<span class="token punctuation">(</span>end_x<span class="token punctuation">,</span> new_x<span class="token punctuation">)</span> <span class="token comment"># 经过pid计算鼠标运动量</span>
            move_y <span class="token operator">=</span> pid_y<span class="token punctuation">.</span>pidPosition<span class="token punctuation">(</span>end_y<span class="token punctuation">,</span> new_y<span class="token punctuation">)</span>

            <span class="token comment"># print(f'x={new_x}, y={new_y}, xd={move_x}, yd={move_y}')</span>
            <span class="token keyword">if</span> end_x <span class="token operator">==</span> new_x <span class="token keyword">and</span> end_y <span class="token operator">==</span> new_y<span class="token punctuation">:</span> <span class="token comment"># 如果重合就退出循环</span>
                <span class="token keyword">break</span>
            
            <span class="token keyword">if</span> move_x <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> move_x <span class="token operator">&lt;</span> <span class="token punctuation">(</span>min_xy<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 限制正最小值</span>
                move_x <span class="token operator">=</span> <span class="token punctuation">(</span>min_xy<span class="token punctuation">)</span>
            <span class="token keyword">elif</span> move_x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">and</span> move_x <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token punctuation">(</span>min_xy<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 限制负最小值</span>
                move_x <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>min_xy<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                move_x <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>move_x<span class="token punctuation">)</span> <span class="token comment"># 需要输入整数,小数会报错</span>

            <span class="token keyword">if</span> move_y <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">and</span> move_y <span class="token operator">&lt;</span> <span class="token punctuation">(</span>min_xy<span class="token punctuation">)</span><span class="token punctuation">:</span>
                move_y <span class="token operator">=</span> <span class="token punctuation">(</span>min_xy<span class="token punctuation">)</span>
            <span class="token keyword">elif</span> move_y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token keyword">and</span> move_y <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token punctuation">(</span>min_xy<span class="token punctuation">)</span><span class="token punctuation">:</span>
                move_y <span class="token operator">=</span> <span class="token operator">-</span><span class="token punctuation">(</span>min_xy<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                move_y <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>move_y<span class="token punctuation">)</span>

            self<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>moveR<span class="token punctuation">(</span>move_x<span class="token punctuation">,</span> move_y<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># 貌似有第三个参数,但是没试出来什么用</span>
</code></pre> 
<h3><a id="6__274"></a>6. 鼠标滚轮</h3> 
<ul><li>同理, 最后还有一个鼠标滚轮的滚动, 它也是模拟滚动量, 这个就不太好跟踪, 因为不同页面滚动范围不一样, 而且这个功能用得很少. 我考虑的是在有滚动条的情况下,使用鼠标点击滚动条或拖拽滚动条, 是更加稳妥的操作,所以我只写了个简单的调用;</li></ul> 
<pre><code class="prism language-python">    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">mouse_scroll</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">""" 鼠标滚轮 num : 正数向下, 负数向上 """</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>state<span class="token punctuation">:</span>
            <span class="token keyword">return</span>
        <span class="token keyword">if</span> num <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            str_scroll <span class="token operator">=</span> <span class="token string">'下'</span>
        <span class="token keyword">elif</span> num <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            str_scroll <span class="token operator">=</span> <span class="token string">'上'</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token comment"># 保护措施</span>
            <span class="token keyword">return</span>
        print_tkui<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'滚轮</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>str_scroll<span class="token punctuation">}</span></span><span class="token string">转动</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>num<span class="token punctuation">}</span></span><span class="token string">单位'</span></span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>dll<span class="token punctuation">.</span>scroll<span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token comment"># 鼠标滚轮</span>
</code></pre> 
<h3><a id="7__292"></a>7. 总结</h3> 
<ul><li> <p>自此, <code>dll</code>驱动库内的0~9序号,10个函数中, 后8个函数的功能都实现了.第0个<code>delay</code>,应该是延时,使用python自带的更加方便,所以没有用. 第1个<code>device_close</code>应该是和第2个<code>device_open</code>相对应的,属于关闭模块,但我尝试了一下没成功,考虑到别人写的例程,也是一开始就导入了<code>dll</code>并调用了<code>dll.device_open</code>,后续并没有考虑关闭,也不需要关闭,所以我也写在类开头,导入类就导入<code>dll</code>并打开,不考虑关闭.</p> </li><li> <p>大致功能就上面这些了, 然后使用最原始的方式实现连点器功能.我原本还打算写个连点器操作表格导入功能, 将操作罗列,然后执行持续识别表格,开始设置的操作.我尝试一下后就放弃了,这种方法太原始了,现在应该采用更加智能的ai识别才对.而不是输入固定坐标点移动.</p> </li><li> <p>笔记到这里, 结束.</p> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a1455f1f84308bf18f37a05c1c63877d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Web】从零开始的js逆向学习笔记(上)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/135422da85da0a152f53f264dedae01c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">微信小程序介绍、账号申请、开发者工具目录结构详解及小程序配置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>