<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>深度图 &#43; RGB图像 转点云 python - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/ef1cfcc86b379a1504606d6efa4f068a/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="深度图 &#43; RGB图像 转点云 python">
  <meta property="og:description" content="1、深度图（.png）转点云（有内参） import numpy as np import open3d as o3d from PIL import Image def depth_to_point_cloud(depth_map, fx, fy, cx, cy): # h, w = depth_map.shape h, w = 1184, 1600 points = [] for v in range(h): for u in range(w): Z = depth_map[v, u] X = (u - cx) * Z / fx Y = (v - cy) * Z / fy points.append([X, Y, Z]) return np.array(points) depth_path = r&#39;.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-20T14:07:12+08:00">
    <meta property="article:modified_time" content="2024-05-20T14:07:12+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">深度图 &#43; RGB图像 转点云 python</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1png_0"></a>1、深度图（.png）转点云（有内参）</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> open3d <span class="token keyword">as</span> o3d
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image

<span class="token keyword">def</span> <span class="token function">depth_to_point_cloud</span><span class="token punctuation">(</span>depth_map<span class="token punctuation">,</span> fx<span class="token punctuation">,</span> fy<span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># h, w = depth_map.shape</span>
    h<span class="token punctuation">,</span> w <span class="token operator">=</span> <span class="token number">1184</span><span class="token punctuation">,</span> <span class="token number">1600</span>
    points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> v <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> u <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>
            Z <span class="token operator">=</span> depth_map<span class="token punctuation">[</span>v<span class="token punctuation">,</span> u<span class="token punctuation">]</span>
            X <span class="token operator">=</span> <span class="token punctuation">(</span>u <span class="token operator">-</span> cx<span class="token punctuation">)</span> <span class="token operator">*</span> Z <span class="token operator">/</span> fx
            Y <span class="token operator">=</span> <span class="token punctuation">(</span>v <span class="token operator">-</span> cy<span class="token punctuation">)</span> <span class="token operator">*</span> Z <span class="token operator">/</span> fy
            points<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">,</span> Z<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>points<span class="token punctuation">)</span>

depth_path <span class="token operator">=</span> <span class="token string">r'./depth.png'</span>
depth_map <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>depth_path<span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span>  <span class="token comment"># 替换成自己的路径</span>
depth_map <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>depth_map<span class="token punctuation">)</span>

fx <span class="token operator">=</span> <span class="token number">2892.33</span>
fy <span class="token operator">=</span> <span class="token number">2883.18</span>
cx <span class="token operator">=</span> <span class="token number">823.205</span>
cy <span class="token operator">=</span> <span class="token number">619.071</span>

points <span class="token operator">=</span> depth_to_point_cloud<span class="token punctuation">(</span>depth_map<span class="token punctuation">,</span> fx<span class="token punctuation">,</span> fy<span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span>
<span class="token comment"># print(points)</span>
pcd <span class="token operator">=</span> o3d<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>PointCloud<span class="token punctuation">(</span><span class="token punctuation">)</span>
pcd<span class="token punctuation">.</span>points <span class="token operator">=</span> o3d<span class="token punctuation">.</span>utility<span class="token punctuation">.</span>Vector3dVector<span class="token punctuation">(</span>points<span class="token punctuation">)</span>
o3d<span class="token punctuation">.</span>io<span class="token punctuation">.</span>write_point_cloud<span class="token punctuation">(</span><span class="token string">'./output.ply'</span><span class="token punctuation">,</span> pcd<span class="token punctuation">)</span>
<span class="token comment"># o3d.io.write_point_cloud("./output.pcd", pcd)</span>


</code></pre> 
<h3><a id="2pfm_38"></a>2、深度图（.pfm）转点云（有内参）</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> re
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> open3d <span class="token keyword">as</span> o3d

<span class="token keyword">def</span> <span class="token function">read_pfm</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        color <span class="token operator">=</span> <span class="token boolean">None</span>
        width <span class="token operator">=</span> <span class="token boolean">None</span>
        height <span class="token operator">=</span> <span class="token boolean">None</span>
        scale <span class="token operator">=</span> <span class="token boolean">None</span>
        endian <span class="token operator">=</span> <span class="token boolean">None</span>

        header <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> header <span class="token operator">==</span> <span class="token string">'PF'</span><span class="token punctuation">:</span>
            color <span class="token operator">=</span> <span class="token boolean">True</span>
        <span class="token keyword">elif</span> header <span class="token operator">==</span> <span class="token string">'Pf'</span><span class="token punctuation">:</span>
            color <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Not a PFM file.'</span><span class="token punctuation">)</span>

        dim_match <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">r'^(\d+)\s(\d+)\s$'</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> dim_match<span class="token punctuation">:</span>
            width<span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> dim_match<span class="token punctuation">.</span>groups<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Malformed PFM header.'</span><span class="token punctuation">)</span>

        scale <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> scale <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            endian <span class="token operator">=</span> <span class="token string">'&lt;'</span>
            scale <span class="token operator">=</span> <span class="token operator">-</span>scale
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            endian <span class="token operator">=</span> <span class="token string">'&gt;'</span>

        depth_data <span class="token operator">=</span> np<span class="token punctuation">.</span>fromfile<span class="token punctuation">(</span>f<span class="token punctuation">,</span> endian <span class="token operator">+</span> <span class="token string">'f'</span><span class="token punctuation">)</span>
        shape <span class="token operator">=</span> <span class="token punctuation">(</span>height<span class="token punctuation">,</span> width<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">if</span> color <span class="token keyword">else</span> <span class="token punctuation">(</span>height<span class="token punctuation">,</span> width<span class="token punctuation">)</span>

        depth_data <span class="token operator">=</span> np<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>depth_data<span class="token punctuation">,</span> shape<span class="token punctuation">)</span>
        depth_data <span class="token operator">=</span> np<span class="token punctuation">.</span>flipud<span class="token punctuation">(</span>depth_data<span class="token punctuation">)</span>
        <span class="token keyword">return</span> depth_data

<span class="token keyword">def</span> <span class="token function">depth_to_point_cloud</span><span class="token punctuation">(</span>depth_map<span class="token punctuation">,</span> fx<span class="token punctuation">,</span> fy<span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">:</span>
    h<span class="token punctuation">,</span> w <span class="token operator">=</span> depth_map<span class="token punctuation">.</span>shape
    points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> v <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> u <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>
            Z <span class="token operator">=</span> depth_map<span class="token punctuation">[</span>v<span class="token punctuation">,</span> u<span class="token punctuation">]</span>
            X <span class="token operator">=</span> <span class="token punctuation">(</span>u <span class="token operator">-</span> cx<span class="token punctuation">)</span> <span class="token operator">*</span> Z <span class="token operator">/</span> fx
            Y <span class="token operator">=</span> <span class="token punctuation">(</span>v <span class="token operator">-</span> cy<span class="token punctuation">)</span> <span class="token operator">*</span> Z <span class="token operator">/</span> fy
            points<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">,</span> Z<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>points<span class="token punctuation">)</span>

<span class="token comment"># 读取深度图</span>
depth_path <span class="token operator">=</span> <span class="token string">r"./depth.pfm"</span>
depth_map <span class="token operator">=</span> read_pfm<span class="token punctuation">(</span>depth_path<span class="token punctuation">)</span>

fx <span class="token operator">=</span> <span class="token number">2892.33</span>
fy <span class="token operator">=</span> <span class="token number">2883.18</span>
cx <span class="token operator">=</span> <span class="token number">823.205</span>
cy <span class="token operator">=</span> <span class="token number">619.071</span>

<span class="token comment"># 转换为点云</span>
points <span class="token operator">=</span> depth_to_point_cloud<span class="token punctuation">(</span>depth_map<span class="token punctuation">,</span> fx<span class="token punctuation">,</span> fy<span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span>
pcd <span class="token operator">=</span> o3d<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>PointCloud<span class="token punctuation">(</span><span class="token punctuation">)</span>
pcd<span class="token punctuation">.</span>points <span class="token operator">=</span> o3d<span class="token punctuation">.</span>utility<span class="token punctuation">.</span>Vector3dVector<span class="token punctuation">(</span>points<span class="token punctuation">)</span>
o3d<span class="token punctuation">.</span>io<span class="token punctuation">.</span>write_point_cloud<span class="token punctuation">(</span><span class="token string">"./output.ply"</span><span class="token punctuation">,</span> pcd<span class="token punctuation">)</span>
<span class="token comment"># o3d.io.write_point_cloud("./output.pcd", pcd)</span>
</code></pre> 
<h3><a id="3pngRGB_109"></a>3、深度图（.png）+RGB图像转点云（无内参）</h3> 
<pre><code class="prism language-python"><span class="token comment"># 转换需要depth图像和rgb图像尺寸一致，若不一致需要先resize成一样的大小</span>
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./depth.png'</span><span class="token punctuation">)</span>
resized_img <span class="token operator">=</span> img<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1600</span><span class="token punctuation">,</span> <span class="token number">1184</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
resized_img<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'./depth.png'</span><span class="token punctuation">)</span>


<span class="token keyword">import</span> open3d <span class="token keyword">as</span> o3d
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt  <span class="token comment"># plt 用于显示图片</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

rgb_path <span class="token operator">=</span> <span class="token string">r'./rgb.png'</span>
depth_path <span class="token operator">=</span> <span class="token string">r'./depth.png'</span>

color_raw <span class="token operator">=</span> o3d<span class="token punctuation">.</span>io<span class="token punctuation">.</span>read_image<span class="token punctuation">(</span>rgb_path<span class="token punctuation">)</span>
depth_raw <span class="token operator">=</span> o3d<span class="token punctuation">.</span>io<span class="token punctuation">.</span>read_point_cloud<span class="token punctuation">(</span>depth_path<span class="token punctuation">)</span>
rgbd_image <span class="token operator">=</span> o3d<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>RGBDImage<span class="token punctuation">.</span>create_from_color_and_depth<span class="token punctuation">(</span>color_raw<span class="token punctuation">,</span> depth_raw<span class="token punctuation">,</span> depth_scale<span class="token operator">=</span><span class="token number">1000.0</span><span class="token punctuation">,</span>depth_trunc<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> convert_rgb_to_intensity<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'read_depth'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>rgbd_image<span class="token punctuation">.</span>color<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'depth image'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>rgbd_image<span class="token punctuation">.</span>depth<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 若要查看自己的深度图值是多少，使用下面的np函数显示</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>rgbd_image<span class="token punctuation">.</span>depth<span class="token punctuation">)</span><span class="token punctuation">)</span>
pcd <span class="token operator">=</span> o3d<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>PointCloud<span class="token punctuation">.</span>create_from_rgbd_image<span class="token punctuation">(</span>rgbd_image<span class="token punctuation">,</span> o3d<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>PinholeCameraIntrinsic<span class="token punctuation">(</span>
    o3d<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>PinholeCameraIntrinsicParameters<span class="token punctuation">.</span>PrimeSenseDefault<span class="token punctuation">)</span><span class="token punctuation">)</span>
pcd<span class="token punctuation">.</span>transform<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># o3d.visualization.draw_geometries([pcd])</span>
o3d<span class="token punctuation">.</span>io<span class="token punctuation">.</span>write_point_cloud<span class="token punctuation">(</span><span class="token string">'./output.ply'</span><span class="token punctuation">,</span> pcd<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="4pfmRGB_145"></a>4、深度图（.pfm）+RGB图像转点云（有内参）</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> open3d <span class="token keyword">as</span> o3d
<span class="token keyword">import</span> cv2

<span class="token keyword">def</span> <span class="token function">read_pfm</span><span class="token punctuation">(</span>fpath<span class="token punctuation">,</span> expected_identifier<span class="token operator">=</span><span class="token string">"Pf"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># PFM format definition: http://netpbm.sourceforge.net/doc/pfm.html</span>

    <span class="token keyword">def</span> <span class="token function">_get_next_line</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>
        next_line <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># ignore comments</span>
        <span class="token keyword">while</span> next_line<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'#'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            next_line <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> next_line

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fpath<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        <span class="token comment">#  header</span>
        identifier <span class="token operator">=</span> _get_next_line<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
        <span class="token keyword">if</span> identifier <span class="token operator">!=</span> expected_identifier<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Unknown identifier. Expected: "%s", got: "%s".'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>expected_identifier<span class="token punctuation">,</span> identifier<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">try</span><span class="token punctuation">:</span>
            line_dimensions <span class="token operator">=</span> _get_next_line<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
            dimensions <span class="token operator">=</span> line_dimensions<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
            width <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>dimensions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            height <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>dimensions<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Could not parse dimensions: "%s". '</span>
                            <span class="token string">'Expected "width height", e.g. "512 512".'</span> <span class="token operator">%</span> line_dimensions<span class="token punctuation">)</span>

        <span class="token keyword">try</span><span class="token punctuation">:</span>
            line_scale <span class="token operator">=</span> _get_next_line<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
            scale <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>line_scale<span class="token punctuation">)</span>
            <span class="token keyword">assert</span> scale <span class="token operator">!=</span> <span class="token number">0</span>
            <span class="token keyword">if</span> scale <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                endianness <span class="token operator">=</span> <span class="token string">"&lt;"</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                endianness <span class="token operator">=</span> <span class="token string">"&gt;"</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Could not parse max value / endianess information: "%s". '</span>
                            <span class="token string">'Should be a non-zero number.'</span> <span class="token operator">%</span> line_scale<span class="token punctuation">)</span>

        <span class="token keyword">try</span><span class="token punctuation">:</span>
            data <span class="token operator">=</span> np<span class="token punctuation">.</span>fromfile<span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"%sf"</span> <span class="token operator">%</span> endianness<span class="token punctuation">)</span>
            data <span class="token operator">=</span> np<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">(</span>height<span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">)</span>
            data <span class="token operator">=</span> np<span class="token punctuation">.</span>flipud<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            <span class="token keyword">with</span> np<span class="token punctuation">.</span>errstate<span class="token punctuation">(</span>invalid<span class="token operator">=</span><span class="token string">"ignore"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                data <span class="token operator">*=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>scale<span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Invalid binary values. Could not create %dx%d array from input.'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>height<span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> data

<span class="token keyword">def</span> <span class="token function">reconstruct_point_cloud</span><span class="token punctuation">(</span>rgb_image<span class="token punctuation">,</span> depth_image<span class="token punctuation">,</span> fx<span class="token punctuation">,</span> fy<span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 获取图像尺寸</span>
    height<span class="token punctuation">,</span> width <span class="token operator">=</span> depth_image<span class="token punctuation">.</span>shape

    <span class="token comment"># 创建点云坐标</span>
    y_coords<span class="token punctuation">,</span> x_coords <span class="token operator">=</span> np<span class="token punctuation">.</span>indices<span class="token punctuation">(</span><span class="token punctuation">(</span>height<span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">)</span>
    x_coords <span class="token operator">=</span> x_coords<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    y_coords <span class="token operator">=</span> y_coords<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    z_coords <span class="token operator">=</span> depth_image<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    points_x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    points_y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    points_z <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>x_coords<span class="token punctuation">,</span> y_coords<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">[</span>b<span class="token punctuation">,</span> g<span class="token punctuation">,</span> r<span class="token punctuation">]</span> <span class="token operator">=</span> rgb_image<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>  <span class="token comment">#  rgb是三通道的BGR格式图，所以读取顺序要顺序留意。</span>
        <span class="token keyword">if</span> r <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> g <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">and</span> b <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        depth <span class="token operator">=</span> depth_image<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span>
        <span class="token keyword">if</span> depth <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># 如果深度值为 0，表示无效值，跳过当前点</span>
            <span class="token keyword">continue</span>
        X <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> cx<span class="token punctuation">)</span> <span class="token operator">*</span> depth <span class="token operator">/</span> fx
        Y <span class="token operator">=</span> <span class="token punctuation">(</span>y <span class="token operator">-</span> cy<span class="token punctuation">)</span> <span class="token operator">*</span> depth <span class="token operator">/</span> fy
        points_x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>X<span class="token punctuation">)</span>
        <span class="token comment"># points_y.append(1023 - Y)  # 平移y</span>
        points_y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Y<span class="token punctuation">)</span>
        points_z<span class="token punctuation">.</span>append<span class="token punctuation">(</span>depth<span class="token punctuation">)</span>
        color <span class="token operator">=</span> <span class="token punctuation">[</span>r <span class="token operator">/</span> <span class="token number">255.0</span><span class="token punctuation">,</span> g <span class="token operator">/</span> <span class="token number">255.0</span><span class="token punctuation">,</span> b <span class="token operator">/</span> <span class="token number">255.0</span><span class="token punctuation">]</span>
        colors<span class="token punctuation">.</span>append<span class="token punctuation">(</span>color<span class="token punctuation">)</span>

    <span class="token comment"># 创建点云</span>
    points <span class="token operator">=</span> np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span><span class="token punctuation">(</span>points_x<span class="token punctuation">,</span> points_y<span class="token punctuation">,</span> points_z<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># colors = rgb_image.reshape(-1, 3) / 255.0</span>
    <span class="token comment"># print(colors)</span>

    point_cloud <span class="token operator">=</span> o3d<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>PointCloud<span class="token punctuation">(</span><span class="token punctuation">)</span>
    point_cloud<span class="token punctuation">.</span>points <span class="token operator">=</span> o3d<span class="token punctuation">.</span>utility<span class="token punctuation">.</span>Vector3dVector<span class="token punctuation">(</span>points<span class="token punctuation">)</span>
    point_cloud<span class="token punctuation">.</span>colors <span class="token operator">=</span> o3d<span class="token punctuation">.</span>utility<span class="token punctuation">.</span>Vector3dVector<span class="token punctuation">(</span>colors<span class="token punctuation">)</span>

    <span class="token keyword">return</span> point_cloud

fx <span class="token operator">=</span> <span class="token number">2892.33</span>
fy <span class="token operator">=</span> <span class="token number">2883.18</span>
cx <span class="token operator">=</span> <span class="token number">823.205</span>
cy <span class="token operator">=</span> <span class="token number">619.071</span>

rgb_image_path <span class="token operator">=</span> <span class="token string">r'./rgb.png'</span>
depth_image_path <span class="token operator">=</span> <span class="token string">r'./depth.pfm'</span>
save_path <span class="token operator">=</span> <span class="token string">r"./output.ply"</span>

rgb_image <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>rgb_image_path<span class="token punctuation">)</span>
<span class="token comment"># depth_image = cv2.imread(depth_image_path, cv2.IMREAD_GRAYSCALE)</span>
depth_image <span class="token operator">=</span> read_pfm<span class="token punctuation">(</span>depth_image_path<span class="token punctuation">)</span>
point_cloud <span class="token operator">=</span> reconstruct_point_cloud<span class="token punctuation">(</span>rgb_image<span class="token punctuation">,</span> depth_image<span class="token punctuation">,</span> fx<span class="token punctuation">,</span> fy<span class="token punctuation">,</span> cx<span class="token punctuation">,</span> cy<span class="token punctuation">)</span>
point_size <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>point_cloud<span class="token punctuation">.</span>points<span class="token punctuation">)</span><span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>point_size<span class="token punctuation">)</span>
o3d<span class="token punctuation">.</span>io<span class="token punctuation">.</span>write_point_cloud<span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> point_cloud<span class="token punctuation">)</span>
<span class="token comment"># o3d.visualization.draw_geometries([point_cloud])</span>
</code></pre> 
<h3><a id="5_pfmpng_259"></a>5、深度图 pfm格式转为png格式</h3> 
<pre><code class="prism language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> imageio<span class="token punctuation">.</span>v3 <span class="token keyword">as</span> iio
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> open3d <span class="token keyword">as</span> o3d


<span class="token keyword">def</span> <span class="token function">write_pfm</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> fpath<span class="token punctuation">,</span> scale<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> file_identifier<span class="token operator">=</span><span class="token string">b'Pf'</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">"float32"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># PFM format definition: http://netpbm.sourceforge.net/doc/pfm.html</span>

    data <span class="token operator">=</span> np<span class="token punctuation">.</span>flipud<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    height<span class="token punctuation">,</span> width <span class="token operator">=</span> np<span class="token punctuation">.</span>shape<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
    values <span class="token operator">=</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span>np<span class="token punctuation">.</span>asarray<span class="token punctuation">(</span>data<span class="token punctuation">,</span> dtype<span class="token operator">=</span>dtype<span class="token punctuation">)</span><span class="token punctuation">)</span>
    endianess <span class="token operator">=</span> data<span class="token punctuation">.</span>dtype<span class="token punctuation">.</span>byteorder
    <span class="token keyword">print</span><span class="token punctuation">(</span>endianess<span class="token punctuation">)</span>

    <span class="token keyword">if</span> endianess <span class="token operator">==</span> <span class="token string">'&lt;'</span> <span class="token keyword">or</span> <span class="token punctuation">(</span>endianess <span class="token operator">==</span> <span class="token string">'='</span> <span class="token keyword">and</span> sys<span class="token punctuation">.</span>byteorder <span class="token operator">==</span> <span class="token string">'little'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        scale <span class="token operator">*=</span> <span class="token operator">-</span><span class="token number">1</span>

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fpath<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token punctuation">(</span>file_identifier<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'\n%d %d\n'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'%d\n'</span> <span class="token operator">%</span> scale<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>values<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">read_pfm</span><span class="token punctuation">(</span>fpath<span class="token punctuation">,</span> expected_identifier<span class="token operator">=</span><span class="token string">"Pf"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># PFM format definition: http://netpbm.sourceforge.net/doc/pfm.html</span>

    <span class="token keyword">def</span> <span class="token function">_get_next_line</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>
        next_line <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># ignore comments</span>
        <span class="token keyword">while</span> next_line<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'#'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            next_line <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> next_line

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fpath<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        <span class="token comment">#  header</span>
        identifier <span class="token operator">=</span> _get_next_line<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
        <span class="token keyword">if</span> identifier <span class="token operator">!=</span> expected_identifier<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Unknown identifier. Expected: "%s", got: "%s".'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>expected_identifier<span class="token punctuation">,</span> identifier<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">try</span><span class="token punctuation">:</span>
            line_dimensions <span class="token operator">=</span> _get_next_line<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
            dimensions <span class="token operator">=</span> line_dimensions<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
            width <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>dimensions<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            height <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>dimensions<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Could not parse dimensions: "%s". '</span>
                            <span class="token string">'Expected "width height", e.g. "512 512".'</span> <span class="token operator">%</span> line_dimensions<span class="token punctuation">)</span>

        <span class="token keyword">try</span><span class="token punctuation">:</span>
            line_scale <span class="token operator">=</span> _get_next_line<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
            scale <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>line_scale<span class="token punctuation">)</span>
            <span class="token keyword">assert</span> scale <span class="token operator">!=</span> <span class="token number">0</span>
            <span class="token keyword">if</span> scale <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                endianness <span class="token operator">=</span> <span class="token string">"&lt;"</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                endianness <span class="token operator">=</span> <span class="token string">"&gt;"</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Could not parse max value / endianess information: "%s". '</span>
                            <span class="token string">'Should be a non-zero number.'</span> <span class="token operator">%</span> line_scale<span class="token punctuation">)</span>

        <span class="token keyword">try</span><span class="token punctuation">:</span>
            data <span class="token operator">=</span> np<span class="token punctuation">.</span>fromfile<span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"%sf"</span> <span class="token operator">%</span> endianness<span class="token punctuation">)</span>
            data <span class="token operator">=</span> np<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token punctuation">(</span>height<span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">)</span>
            data <span class="token operator">=</span> np<span class="token punctuation">.</span>flipud<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            <span class="token keyword">with</span> np<span class="token punctuation">.</span>errstate<span class="token punctuation">(</span>invalid<span class="token operator">=</span><span class="token string">"ignore"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                data <span class="token operator">*=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>scale<span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'Invalid binary values. Could not create %dx%d array from input.'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>height<span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> data

pfm_path <span class="token operator">=</span> <span class="token string">r'/home/czh/CVP-MVSNet_backup/outputs/dtu_dataset-nsrc2/scan1/rgbd2ply/00000000.pfm'</span>
save_path <span class="token operator">=</span> <span class="token string">'/home/czh/CVP-MVSNet_backup/outputs/dtu_dataset-nsrc2/scan1/rgbd2ply/pfm2png000.png'</span>
data <span class="token operator">=</span> read_pfm<span class="token punctuation">(</span>pfm_path<span class="token punctuation">)</span>
data_max <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
data_min <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Max: "</span><span class="token punctuation">,</span> data_max<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Min: "</span><span class="token punctuation">,</span> data_min<span class="token punctuation">)</span>

depth_instensity <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token number">256</span> <span class="token operator">*</span> <span class="token punctuation">(</span>data<span class="token operator">-</span><span class="token number">463</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">512</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>  <span class="token comment"># 这里是改变深度表示的范围，为了可视化。 463为数据中的最小值，相当于把数据范围最小值变为0； 除512是因为 最大值-最小值 的值约等于500 512的表示可以覆盖掉这500个数据 </span>
iio<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span>save_path<span class="token punctuation">,</span> depth_instensity<span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8213335d38cbe49268e0376514569590/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">rabbitmq问题汇总</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/66ba6b6639468cba3c80688acda58295/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Spring系列一：spring的安装与使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>