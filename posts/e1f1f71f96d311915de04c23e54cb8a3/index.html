<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【C语言】编译与链接：深入理解程序构建过程 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/e1f1f71f96d311915de04c23e54cb8a3/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【C语言】编译与链接：深入理解程序构建过程">
  <meta property="og:description" content="🔥引言
本篇将深入理解程序构建过程，以便于我们在编写程序的过程同时，理解底层是如何从程序的创建到生成可执行程序的。
🌈个人主页：是店小二呀
🌈C语言笔记专栏：C语言笔记
🌈C&#43;&#43;笔记专栏： C&#43;&#43;笔记
🌈初阶数据结构笔记专栏： 初阶数据结构笔记
🌈喜欢的诗句:无人扶我青云志 我自踏雪至山巅
文章目录 一、翻译环境和运行环境二、翻译环境2.1 预处理(预编译)2.2 编译2.2.1 词法分析2.2.2 语法分析2.2.4 语义分析 2.3 汇编2.4 链接三、运行环境 一、翻译环境和运行环境 ANSI C是由美国国家标准协会（ANSI）及国际标准化组织（ISO）推出的关于-&gt;C语言的标准。在ANSI C的任何一种是实现中，存在两个不同的环境。
翻译环境:环境中源代码被转换为可执行的机器指令(二进制指令)执行环境:用于实际执行代码 二、翻译环境 翻译环境是由编译和链接两个大过程组成的，将源代码转换为可执行的机器指令，编译又可以分解成:预处理(预编译)、编译、汇编三个过程。
【说明】:
多个.c文件单独经历编译处理生产对应的目标文件多个目标文件和链接库一起经过链接器处理生成可执行程序链接库是指运行时库(支持程序运行的基本库函数集合)或者第三方库 (目标文件：windows环境下后缀为.obj，Linux环境下后缀为.o)
2.1 预处理(预编译) 在预处理阶段，源文件和头文件会被处理成为.i为后缀的文件
预处理阶段主要处理源文件中如下规则:
将所有的 #define 删除，并展开所有的宏定义。处理所有的条件编译指令，如： #if、#ifdef、#elif、#else、#endif 。处理#include预编译指令，将包含的头文件的内容插⼊到该预编译指令的位置。这个过程是递归进行的，也就是说被包含的头文件也可能包含其他文件。删除所有的注释添加行号和文件名标识，方便后续编译器生成调试信息等。或保留所有的#pragma的编译器指令，编译器后续会使用 【注意】:经过预处理后的.i文件中不再包含宏定义，因为宏已经被展开。并且包含的头文件都被插⼊到.i⽂件中。所以当我们无法知道宏定义或者头⽂件是否包含正确的时候，可以查看预处理后的.i⽂件来确认。
2.2 编译 编译过程：将预处理后的文件进行一系列词法分析、语法分析、语义分析以及优化，生成相应的汇编代码文件
编译过程命令:
gcc -S test.i -o test.s 比如:对下列表达式进行处理:
nums[index] = (index&#43;4)*(2&#43;6); 2.2.1 词法分析 将源代码程序被输入扫描器，扫描器的任务就是简单的进行词法分析，把代码的字符分割成一系列的记号(关键字、标识符、字面量、特殊字符等。)
2.2.2 语法分析 将对扫描产生的记号进行语法分析，从而产生语法树(以表达式为节点的树)。
2.2.4 语义分析 由语义分析器完成语义分析，即对表达式的语法层面分析。编译器所能做的分析是语义的静态分析。静态分析通常包括声明和类型的匹配，类型的转换等。这个阶段会报告错误的语法信息。
2.3 汇编 由汇编器将汇编代码转为机器指令(二进制指令)，每一句汇编语句几乎都对应一条机器指令。按照汇编指令和机器指令的对照表进行一一的进行翻译，不做指令优化。
汇编的命令如下:
gcc -c test.s -0 test.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-11T17:46:07+08:00">
    <meta property="article:modified_time" content="2024-06-11T17:46:07+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【C语言】编译与链接：深入理解程序构建过程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/cb/ed/zUzYsVrI_o.gif" alt="请添加图片描述"><br> 🔥引言</p> 
<blockquote> 
 <p>本篇将深入理解程序构建过程，以便于我们在编写程序的过程同时，理解底层是如何从程序的创建到生成可执行程序的。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/d5/20/nEFg8wwm_o.gif" alt="请添加图片描述" width="600" height="60"><br> <img src="https://images2.imgbox.com/21/b8/m3ohUsqn_o.png" alt="Alt" width="200" height="200"></p> 
<p>🌈个人主页：<a href="https://blog.csdn.net/2302_79177254?type=blog">是店小二呀</a><br> 🌈C语言笔记专栏：<a href="https://blog.csdn.net/2302_79177254/category_12498683.html?spm=1001.2014.3001.5482">C语言笔记</a><br> 🌈C++笔记专栏： <a href="https://blog.csdn.net/2302_79177254/category_12596619.html">C++笔记</a><br> 🌈初阶数据结构笔记专栏： <a href="https://blog.csdn.net/2302_79177254/category_12596619.html">初阶数据结构笔记</a></p> 
<p>🌈喜欢的诗句:无人扶我青云志 我自踏雪至山巅<br> <img src="https://images2.imgbox.com/3e/c2/QiCd2YSb_o.gif" alt="请添加图片描述" width="600" height="60"></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#font_colorcornflowerbluefont_21" rel="nofollow"><font color="cornflowerblue">一、翻译环境和运行环境</font></a></li><li><a href="#font_colorcornflowerbluefont_33" rel="nofollow"><font color="cornflowerblue">二、翻译环境</font></a></li><li><ul><li><a href="#font_colorcornflowerblue21_font_50" rel="nofollow"><font color="cornflowerblue">2.1 预处理(预编译)</font></a></li><li><a href="#font_colorcornflowerblue22_font_68" rel="nofollow"><font color="cornflowerblue">2.2 编译</font></a></li><li><ul><li><a href="#font_colorcornflowerblue221_font_84" rel="nofollow"><font color="cornflowerblue">2.2.1 词法分析</font></a></li><li><a href="#font_colorcornflowerblue222_font_91" rel="nofollow"><font color="cornflowerblue">2.2.2 语法分析</font></a></li><li><a href="#font_colorcornflowerblue224_font_98" rel="nofollow"><font color="cornflowerblue">2.2.4 语义分析</font></a></li></ul> 
   </li><li><a href="#font_colorcornflowerblue23_font_105" rel="nofollow"><font color="cornflowerblue">2.3 汇编</font></a></li><li><a href="#font_colorcornflowerblue24_font_115" rel="nofollow"><font color="cornflowerblue">2.4 链接</font></a></li><li><a href="#font_colorcornflowerbluefont_150" rel="nofollow"><font color="cornflowerblue">三、运行环境</font></a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="font_colorcornflowerbluefont_21"></a><font color="cornflowerblue">一、翻译环境和运行环境</font></h2> 
<p><a href="https://baike.baidu.com/item/ANSI/14955?fromModule=lemma_inlink" rel="nofollow">ANSI</a> C是由<a href="https://baike.baidu.com/item/%E7%BE%8E%E5%9B%BD%E5%9B%BD%E5%AE%B6%E6%A0%87%E5%87%86%E5%8D%8F%E4%BC%9A/5709537?fromModule=lemma_inlink" rel="nofollow">美国国家标准协会</a>（ANSI）及<a href="https://baike.baidu.com/item/%E5%9B%BD%E9%99%85%E6%A0%87%E5%87%86%E5%8C%96%E7%BB%84%E7%BB%87/779832?fromModule=lemma_inlink" rel="nofollow">国际标准化组织</a>（ISO）推出的关于-&gt;<a href="https://baike.baidu.com/item/C%E8%AF%AD%E8%A8%80/105958?fromModule=lemma_inlink" rel="nofollow">C语言</a>的标准。在ANSI C的任何一种是实现中，存在两个不同的环境。</p> 
<ul><li><strong>翻译环境</strong>:环境中源代码被转换为<strong>可执行的机器指令</strong>(二进制指令)</li><li><strong>执行环境</strong>:用于实际执行代码</li></ul> 
<p><img src="https://images2.imgbox.com/a8/be/aYPXaviG_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="font_colorcornflowerbluefont_33"></a><font color="cornflowerblue">二、翻译环境</font></h2> 
<p>翻译环境是由<strong>编译和链接</strong>两个大过程组成的，将源代码转换为可执行的机器指令，编译又可以分解成:<strong>预处理(预编译)、编译、汇编</strong>三个过程。</p> 
<p><img src="https://images2.imgbox.com/48/06/6FxiKRqI_o.png" alt="在这里插入图片描述"></p> 
<p>【<strong>说明</strong>】:</p> 
<ul><li>多个.c文件<strong>单独</strong>经历编译处理生产对应的目标文件</li><li><strong>多个目标文件和链接库</strong>一起经过链接器处理生成可执行程序</li><li>链接库是指运行时库(支持程序运行的基本库函数集合)或者第三方库</li></ul> 
<p>(目标文件：windows环境下后缀为.obj，Linux环境下后缀为.o)</p> 
<hr> 
<h3><a id="font_colorcornflowerblue21_font_50"></a><font color="cornflowerblue">2.1 预处理(预编译)</font></h3> 
<p>在预处理阶段，源文件和头文件会被<strong>处理成为.i为后缀</strong>的文件</p> 
<p><strong>预处理阶段主要处理源文件中如下规则</strong>:</p> 
<ul><li>将所有的 #define 删除，并展开<strong>所有的宏定义</strong>。</li><li>处理所有的条件编译指令，如： #if、#ifdef、#elif、#else、#endif 。</li><li>处理#include预编译指令，将包含的头文件的内容插⼊到该预编译指令的位置。</li><li>这个过程是<strong>递归进行</strong>的，也就是说被包含的头文件也可能包含其他文件。</li><li><strong>删除所有的注释</strong></li><li>添加行号和文件名标识，方便后续编译器生成调试信息等。</li><li>或保留所有的#pragma的编译器指令，编译器后续会使用</li></ul> 
<p>【注意】:<strong>经过预处理后的.i文件中不再包含宏定义</strong>，因为宏已经被展开。并且包含的头文件都被插⼊到.i⽂件中。所以当我们无法知道宏定义或者头⽂件是否包含正确的时候，可以查看<strong>预处理后的.i⽂件来确认</strong>。</p> 
<hr> 
<h3><a id="font_colorcornflowerblue22_font_68"></a><font color="cornflowerblue">2.2 编译</font></h3> 
<p><strong>编译过程</strong>：将预处理后的文件进行一系列<strong>词法分析、语法分析、语义分析</strong>以及优化，生成相应的汇编代码文件</p> 
<p><strong>编译过程命令</strong>:</p> 
<pre><code class="prism language-c">gcc <span class="token operator">-</span>S test<span class="token punctuation">.</span>i <span class="token operator">-</span>o test<span class="token punctuation">.</span>s
</code></pre> 
<p>比如:对下列表达式进行处理:</p> 
<pre><code class="prism language-cpp">nums<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>index<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="font_colorcornflowerblue221_font_84"></a><font color="cornflowerblue">2.2.1 词法分析</font></h4> 
<p>将源代码程序被输入扫描器，扫描器的任务就是简单的进行词法分析，把代码的字符<strong>分割成一系列的记号</strong>(关键字、标识符、字面量、特殊字符等。)</p> 
<p><img src="https://images2.imgbox.com/7d/1c/kusw1dlb_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="font_colorcornflowerblue222_font_91"></a><font color="cornflowerblue">2.2.2 语法分析</font></h4> 
<p>将对<strong>扫描产生的记号进行语法分析</strong>，从而产生语法树(以<strong>表达式为节点</strong>的树)。<img src="https://images2.imgbox.com/6f/f6/7nrc3EcH_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="font_colorcornflowerblue224_font_98"></a><font color="cornflowerblue">2.2.4 语义分析</font></h4> 
<p>由<strong>语义分析器</strong>完成语义分析，即对表达式的语法层面分析。编译器所能做的分析是语义的静态分析。静态分析通常包括声明和类型的匹配，类型的转换等。这个<strong>阶段会报告错误的语法信息</strong>。</p> 
<p><img src="https://images2.imgbox.com/1e/4b/YEv1XnGn_o.png" alt=""></p> 
<h3><a id="font_colorcornflowerblue23_font_105"></a><font color="cornflowerblue">2.3 汇编</font></h3> 
<p>由汇编器将<strong>汇编代码转为机器指令</strong>(二进制指令)，每一句汇编语句几乎都对应一条机器指令。按照汇编指令和机器指令的对照表进行<strong>一一的进行翻译，不做指令优化</strong>。</p> 
<p><strong>汇编的命令如下</strong>:</p> 
<pre><code class="prism language-cpp">gcc <span class="token operator">-</span>c test<span class="token punctuation">.</span>s <span class="token operator">-</span><span class="token number">0</span>  test<span class="token punctuation">.</span>o
</code></pre> 
<h3><a id="font_colorcornflowerblue24_font_115"></a><font color="cornflowerblue">2.4 链接</font></h3> 
<p>将<strong>一堆文件链接在一起生成可执行程序</strong>，为解决一个项目中多文件、多模块之间互相调用的问题。</p> 
<p>主要过程:<strong>地址和空间分配，符号决议和重定位</strong>等步骤</p> 
<pre><code class="prism language-c"><span class="token operator">&lt;</span>test<span class="token punctuation">.</span>c<span class="token operator">&gt;</span>
    <span class="token keyword">extern</span> <span class="token keyword">int</span> g_val<span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span><span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> a<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> b<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">;</span>
    <span class="token function">Add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span>g_val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span>Add<span class="token punctuation">.</span>c<span class="token operator">&gt;</span>
    <span class="token keyword">int</span> g_val<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span><span class="token keyword">int</span> y<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> x<span class="token operator">+</span>y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>【<strong>说明</strong>】:<strong>每个源文件多是单独经过编译器处理</strong>生成对应的目标文件</p> 
<ul><li>test.c经过编译器处理生成test.o</li><li>Add.c经过编译器处理生成Add.o</li></ul> 
<p>其中在<code>test.c</code>文件中使用extern声明其他文件的外部符号。在<code>test.c</code>文件中使用Add函数和g_val变量时，<strong>必须需要知道Add函数和g_val变量的地址，但是由于每个文件是单独编译的，在编译器<code>test.c</code>时并不知道Add函数和g_val变量的地址，所以暂时把调用Add的指令的目标地址和g_val的地址搁置</strong> 。等到最后的链接操作由链接器根据引用符号Add在其他模块中查找Add函数的地址，然后将<code>test.c</code>中所用引用到Add的指令重新修正，让调用Add的指令的目标地址成为真正Add函数的地址，对于全局变量g_val也是类似的方法修改地址。这个地址修改的过程也被称为:重定位。</p> 
<hr> 
<h3><a id="font_colorcornflowerbluefont_150"></a><font color="cornflowerblue">三、运行环境</font></h3> 
<ol><li>程序必须载入内存中，在操作系统的环境下：一般这个由操作系统完成<strong>在独立的环境下</strong>:程序的载入必须由手工安排，也可能是通过可执行代码置入只读内存来完成的</li><li>程序的执行开始–&gt;调用main函数</li><li>开始执行程序代码。程序将使用一个运行时堆栈(stack)，<strong>存储函数的局部变量和返回地址</strong>，程序同时也可以使用静态内存，存储在静态区的变量，生命周期跟程序的整个执行过程一样长。</li><li>终止程序。正常终止main函数，也可能异常终止。</li></ol> 
<hr> 
<p><img src="https://images2.imgbox.com/ad/4f/wjNp1Zwe_o.gif" alt="请添加图片描述"><br> <strong><font color="cornflowerblue">以上就是本篇文章的所有内容，在此感谢大家的观看！这里是店小二C语言笔记，希望对你在学习C语言中有所帮助！接下来，我们将进入初阶数据结构的学习中</font></strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5f7f0783da433fa4da7884f4140ddac2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【初阶数据结构】深入解析顺序表:探索底层逻辑</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2749387fba80c7ce92a27e2d391e0912/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Mac】Premiere Pro 2024 for Mac v24.1软件介绍和安装教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>