<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AI大模型额外学习一：斯坦福AI西部世界小镇笔记（包括部署和源码分析） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/6e270be4cac88ca564bfb9cefebb3935/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="AI大模型额外学习一：斯坦福AI西部世界小镇笔记（包括部署和源码分析）">
  <meta property="og:description" content="文章目录 一、简单介绍1）项目代码介绍2）重新播放模拟3）适当修改分叉模拟 二、部署斯坦福小镇Demo1）准备工作2）解决遇到的bug3）启动服务器和前端 三、源码剖析1）主题顺序 四、总结分析1）缺点2）太吾绘卷是怎么做的(根据年龄去驱动)3）一些思考 github链接
一、简单介绍 ①背景介绍
This repository accompanies our research paper titled “Generative Agents: Interactive Simulacra of Human Behavior.” It contains our core simulation module for generative agents—computational agents that simulate believable human behaviors—and their game environment.
②总体逻辑
让小镇的NPC自由交流、开party、生活有条不紊
③总结：
Ai会感知周边环境，并将视野里发生的事件记录下来，加入自己的记忆流。之后，不论是Ai计划要做的事，还是对外界的反应，都会受到这个记忆的影响，并依靠ChatGPT进行决策，最后决策的事件也会加入记忆流，形成新的记忆。让NPC具备记忆系统，并依靠大语言模型来帮助NPC做出行动决策
https://github.com/joonspk-research/generative_agents/tree/main
https://www.zhihu.com/question/425708656
https://github.com/joonspk-research/generative_agents/tree/main
https://github.com/search?q=generative-agents&amp;type=repositories
1）项目代码介绍 ①项目有后端服务器backend_server和前端服务器frontend_server
②storage会保存程序运行的记录信息
2）重新播放模拟 打开浏览器，输入
http://localhost:8000/replay/&lt;simulation-name&gt;/&lt;starting-time_step&gt; 3）适当修改分叉模拟 这里的模拟是Isabella，scratch.json里面包括人物性格描述、居住地点、生活方式等，
spatial_memory.json里面还有房间布局等等
二、部署斯坦福小镇Demo 1）准备工作 ①安装aneconda
②下载仓库代码
git clone https://github.com/joonspk-research/generative_agents.git cd generative_agents ③用vscode打开generative_agents目录
④在reverie目录的backend_server下载创建文件utils.py文件，填入以下内容
# Copy and paste your OpenAI API Keyopenai_api_key =&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-10T04:11:36+08:00">
    <meta property="article:modified_time" content="2024-08-10T04:11:36+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AI大模型额外学习一：斯坦福AI西部世界小镇笔记（包括部署和源码分析）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_5" rel="nofollow">一、简单介绍</a></li><li><ul><li><a href="#1_21" rel="nofollow">1）项目代码介绍</a></li><li><a href="#2_24" rel="nofollow">2）重新播放模拟</a></li><li><a href="#3_30" rel="nofollow">3）适当修改分叉模拟</a></li></ul> 
   </li><li><a href="#Demo_37" rel="nofollow">二、部署斯坦福小镇Demo</a></li><li><ul><li><a href="#1_39" rel="nofollow">1）准备工作</a></li><li><a href="#2bug_82" rel="nofollow">2）解决遇到的bug</a></li><li><a href="#3_110" rel="nofollow">3）启动服务器和前端</a></li></ul> 
   </li><li><a href="#_150" rel="nofollow">三、源码剖析</a></li><li><ul><li><a href="#1_152" rel="nofollow">1）主题顺序</a></li></ul> 
   </li><li><a href="#_190" rel="nofollow">四、总结分析</a></li><li><ul><li><a href="#1_192" rel="nofollow">1）缺点</a></li><li><a href="#2_197" rel="nofollow">2）太吾绘卷是怎么做的(根据年龄去驱动)</a></li><li><a href="#3_206" rel="nofollow">3）一些思考</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p><a href="https://github.com/joonspk-research/generative_agents/tree/main">github链接</a></p> 
<h3><a id="_5"></a>一、简单介绍</h3> 
<p>①背景介绍<br> This repository accompanies our research paper titled “Generative Agents: Interactive Simulacra of Human Behavior.” It contains our core simulation module for generative agents—computational agents that simulate believable human behaviors—and their game environment.</p> 
<p>②总体逻辑<br> 让小镇的NPC自由交流、开party、生活有条不紊<br> <img src="https://images2.imgbox.com/c5/d5/wGgWOs4k_o.png" alt="在这里插入图片描述"><br> ③总结：<br> Ai会感知周边环境，并将视野里发生的事件记录下来，加入自己的记忆流。之后，不论是Ai计划要做的事，还是对外界的反应，都会受到这个记忆的影响，并依靠ChatGPT进行决策，最后决策的事件也会加入记忆流，形成新的记忆。让NPC具备记忆系统，并依靠大语言模型来帮助NPC做出行动决策</p> 
<p>https://github.com/joonspk-research/generative_agents/tree/main<br> https://www.zhihu.com/question/425708656<br> https://github.com/joonspk-research/generative_agents/tree/main<br> https://github.com/search?q=generative-agents&amp;type=repositories</p> 
<h4><a id="1_21"></a>1）项目代码介绍</h4> 
<p>①项目有后端服务器backend_server和前端服务器frontend_server<br> ②storage会保存程序运行的记录信息</p> 
<h4><a id="2_24"></a>2）重新播放模拟</h4> 
<p>打开浏览器，输入</p> 
<pre><code class="prism language-shell">http://localhost:8000/replay/<span class="token operator">&lt;</span>simulation-name<span class="token operator">&gt;</span>/<span class="token operator">&lt;</span>starting-time_step<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="3_30"></a>3）适当修改分叉模拟</h4> 
<p><img src="https://images2.imgbox.com/0e/53/Jb1HObsC_o.png" alt="在这里插入图片描述"><br> 这里的模拟是Isabella，scratch.json里面包括人物性格描述、居住地点、生活方式等，<br> spatial_memory.json里面还有房间布局等等</p> 
<h3><a id="Demo_37"></a>二、部署斯坦福小镇Demo</h3> 
<h4><a id="1_39"></a>1）准备工作</h4> 
<p>①安装aneconda<br> ②下载仓库代码</p> 
<pre><code>git clone https://github.com/joonspk-research/generative_agents.git

cd    generative_agents
</code></pre> 
<p>③用vscode打开generative_agents目录<br> <img src="https://images2.imgbox.com/a9/ec/FPZGARBo_o.png" alt="在这里插入图片描述"><br> ④在reverie目录的backend_server下载创建文件utils.py文件，填入以下内容<br> <img src="https://images2.imgbox.com/7c/3e/A7f3QTOX_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment"># Copy and paste your OpenAI API </span>
Keyopenai_api_key <span class="token operator">=</span><span class="token string">"&lt;Your OpenAI API&gt;"</span>
<span class="token comment"># Put your name</span>
key_owner <span class="token operator">=</span> <span class="token string">"&lt;Name&gt;"</span>

maze assets loc <span class="token operator">=</span><span class="token string">"../../enviroment/frontend_server/static_dirs/assets"</span>
envircenv_matrix<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>maze_assets_loc<span class="token punctuation">}</span></span><span class="token string">/the_ville/matrix"</span></span>
env_visuals <span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>maze assets loc<span class="token punctuation">}</span></span><span class="token string">/the_ville/visuals"</span></span>

fs_storage <span class="token operator">=</span><span class="token string">"../../environment/frontend server/storage"</span>
fs_temp_storage <span class="token operator">=</span><span class="token string">"../../environment/frontend_server/temp_storage"</span>

collision block <span class="token builtin">id</span> <span class="token operator">=</span>"<span class="token number">32125</span>'

<span class="token comment"># Verbose</span>
debug <span class="token operator">=</span> <span class="token boolean">True</span>
</code></pre> 
<p>⑤填入OPEN AI API Keys和秘钥的名字<br> <img src="https://images2.imgbox.com/32/55/FjXrENbg_o.png" alt="在这里插入图片描述"></p> 
<p>⑥创建新conda环境</p> 
<pre><code>conda create -n genagents python=3.11.4

#激活新环境
conda activate genagents
</code></pre> 
<h4><a id="2bug_82"></a>2）解决遇到的bug</h4> 
<p>①pillow需要更新到最新的从8.4.0改到9.5.0<br> <img src="https://images2.imgbox.com/8b/e7/cjFkR9pr_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-shell">python <span class="token parameter variable">-m</span> pip <span class="token function">install</span> <span class="token parameter variable">-r</span> requirements.txt
</code></pre> 
<p>②AI小镇运行在本机运行起来后，你看不到AI小人在移动<br> 打开backend_server目录下的reverie.py文件，跳转400行<br> <img src="https://images2.imgbox.com/a9/02/z8amDnqI_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python">curr_move_path<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>sim_folder<span class="token punctuation">}</span></span><span class="token string">/movement"</span></span>
<span class="token comment">#If the folder doesn't exist, we create it</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>curr_move_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
	os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>curr_move_path<span class="token punctuation">)</span>
</code></pre> 
<p>③若Django不是配置需求的2.2<br> Django模板中的’staticfiles’标签。在Django 3.0以后，'staticfiles’标签已经被弃用，你应该使用’static’标签来代替。你需要在你的模板文件中把所有的<code> {% load staticfiles %}</code> 或 <code>{% load admin_static %} </code>改为 <code>{% load static %}</code>。</p> 
<p>如果你在你的项目中使用了许多模板，并且它们都使用了’staticfiles’或’admin_static’标签，那么手动一个个修改可能会很繁琐。这种情况下，你可以在项目的根目录下使用以下命令来自动替换：</p> 
<pre><code>grep -rl '{% load staticfiles %}' . | xargs sed -i 's/{% load staticfiles %}/{% load static %}/g'
grep -rl '{% load admin_static %}' . | xargs sed -i 's/{% load admin_static %}/{% load static %}/g'
</code></pre> 
<p>这两条命令会在你的项目中找到所有包含 {% load staticfiles %} 和 {% load admin_static %} 的文件，并将它们替换为 {% load static %}。</p> 
<h4><a id="3_110"></a>3）启动服务器和前端</h4> 
<p>①切换到前端目录，然后运行脚本</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> environment/frontend_server
python   manage.py runserver
</code></pre> 
<p>②打开浏览器，输入</p> 
<pre><code class="prism language-shell"><span class="token number">1.7</span>.0.0.1:8000
</code></pre> 
<p><img src="https://images2.imgbox.com/35/1e/Y0awW05B_o.png" alt="在这里插入图片描述"></p> 
<p>有以上图片则表示启动成功</p> 
<p>可以看到前端url的地址是</p> 
<pre><code>127.0.0.1:8000
</code></pre> 
<p>③启动新终端来开启服务器</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> generative_agents
conda activate genagents
<span class="token builtin class-name">cd</span> reverie/backend_server

<span class="token comment">#准备开启仿真服务器</span>
python reverie.py  
</code></pre> 
<p>④回答要进入的分叉模拟（forked simulation）：<br> 现在是用现有的模板做三个代理（agent）</p> 
<pre><code class="prism language-shell">base_the_ville_sabella_maria_klaus
</code></pre> 
<p><img src="https://images2.imgbox.com/2a/53/R5Ayrp8E_o.png" alt="在这里插入图片描述"><br> 接着命名这个分叉模拟，随意，就叫test，这个test目录会存放这次模拟的数据信息<br> <img src="https://images2.imgbox.com/00/0d/At8DoQ77_o.png" alt="在这里插入图片描述"><br> ⑤先跑3步，注意这里的步数，如果跑太多，token消耗的次数越多，3步就几刀<br> 就可看到输出：<br> <img src="https://images2.imgbox.com/a8/4a/ObnCfYfS_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_150"></a>三、源码剖析</h3> 
<h4><a id="1_152"></a>1）主题顺序</h4> 
<ul><li> <p>简短说明<br> ①根据填入的演变次数，来决定循环的次数<br> ②便利所有的agent，每个agent执行自己的plan函数，也就是每个人作为一个agent<br> ③根据第二步拿到的计划，然后执行计划<br> ④执行计划之后，先看初始地点有那些人，然后利用prompt去跟这些人互动相互交流，跟同地点的人互动之后再用prompt修改当前的做事计划，然后让别人知道我在干嘛<br> ⑤然后根据之前的今日的计划安排把自己以往的记忆用prompt进行评分排序<br> （比如做瑜伽重要，就排前面）<br> ⑥根据自己的计划和这个地方的场所列表，用promopt对要去的地方打分，就可以去那个排名第一的地方了</p> </li><li> <p>详细说明</p> </li></ul> 
<p>①根据填入的演变次数，来决定循环的次数</p> 
<pre><code class="prism language-python"><span class="token keyword">for</span> repeat <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>repeats<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<p>②便利所有的agent，每个agent执行自己的<code>plan函数</code>，也就是每个人作为一个agent</p> 
<pre><code class="prism language-python"><span class="token keyword">for</span> agent <span class="token keyword">in</span> agents<span class="token punctuation">:</span>
	agent<span class="token punctuation">.</span>plan<span class="token punctuation">(</span>global_time<span class="token punctuation">,</span>prompt_meta<span class="token punctuation">)</span>
</code></pre> 
<p>而每个agent都是由每个人的名字、描述、初始出生地点（从simulation_config.json里面读取，team_people都是镇上的人）构造出来<br> <img src="https://images2.imgbox.com/c4/ac/aOw57qJ7_o.png" alt="在这里插入图片描述"><br> 而这个plan函数就是给OpenAI接口一个prompt，如下：<br> <img src="https://images2.imgbox.com/4a/48/qPDysaNn_o.png" alt="在这里插入图片描述"><br> 根据今天时间写下今天的每小时计划安排<br> ③根据第二步拿到的计划，然后执行计划<br> <img src="https://images2.imgbox.com/da/c9/mxhWYW16_o.png" alt="在这里插入图片描述"><br> ④执行计划之后，先看初始地点有那些人，然后利用prompt去跟这些人互动相互交流，跟同地点的人互动之后再用prompt修改当前的做事计划，然后让别人知道我在干嘛<br> <img src="https://images2.imgbox.com/bf/a1/JMmUXS3v_o.png" alt="在这里插入图片描述"><br> ⑤然后根据之前的今日的计划安排把自己以往的记忆用prompt进行评分排序<br> （比如做瑜伽重要，就排前面）<br> <img src="https://images2.imgbox.com/58/c1/0s2lQFO6_o.png" alt="在这里插入图片描述"></p> 
<p>⑥根据自己的计划和这个地方的场所列表，用promopt对要去的地方打分，就可以去那个排名第一的地方了<br> <img src="https://images2.imgbox.com/11/43/9wwoHt42_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_190"></a>四、总结分析</h3> 
<h4><a id="1_192"></a>1）缺点</h4> 
<p>①消耗token比较多，跑3步就几刀了 （官方模板三个agent）<br> ②在实用环境中agent需要实时对当前发生的事情做出反应，但是这是绝对不可能的，从perceive到execute调用的链路极长，且不说真实环境需要感知无数复杂对象，就仅仅感知一个重要对象到执行反应往短了说也需要几分钟的时间，这在应用中是灾难性的</p> 
<h4><a id="2_197"></a>2）太吾绘卷是怎么做的(根据年龄去驱动)</h4> 
<ul><li> <p>根据年龄驱动<br> ① 0-5岁：<code>被动期或跟随期</code>，这个时期的NPC会被动跟随父母，父母在哪里，NPC就在哪里，优先级为<code>母亲&gt;父亲&gt;师傅</code>，跟随期NPC不会和其他NPC交流互动事件，但是可以被动接受父母师傅的送礼/指点；若没有义/亲父母，则有唯一主动交流事件，就可以拜义父母，然后进入跟随期<br> ②6-14岁：<code>半主动期或归属地期</code>，还跟随父母或师傅在外地的，会自动回到本门派、城市，然后<code>以归属地为中心(十格范围)</code>主动活动吗，他们会主动学习，与人交友、谈恋爱、结仇、指点、治疗、送礼、偷窃、挖坟等<br> ③15-逝世：<code>主动期或瞎跑期</code>。NPC会因为思念某人跑去拜访，会给人上坟，会寻找某人报仇，会决心追随某人而去，可以找对象结婚</p> </li><li> <p>特殊情况<br> ①太吾村民不会乱动</p> </li></ul> 
<h4><a id="3_206"></a>3）一些思考</h4> 
<p>①跟NPC聊天若是赞美，则对应NPC好感度增加</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/51fa12c81218b858d9293f2d979c1b78/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">贪心算法总结（3）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6b122934de8e2969c599f46d6b47bcf0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">大数据-76 Kafka 高级特性 稳定性-消费重复 生产者、Broker、消费者 导致的重复消费问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>