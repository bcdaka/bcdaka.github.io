<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>大数据-42 Redis 功能扩展 发布/订阅模式 事务相关的内容 Redis弱事务 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/bc7bc27a3975be987e34d0315f7f6be2/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="大数据-42 Redis 功能扩展 发布/订阅模式 事务相关的内容 Redis弱事务">
  <meta property="og:description" content="点一下关注吧！！！非常感谢！！持续更新！！！ 目前已经更新到了： HadoopHDFSMapReduceHiveFlumeSqoopZookeeperHBaseRedis （正在更新） 章节内容 上一节我们完成了如下的内容：
bitmap 位操作类型geo 空间类型 空间计算 Z阶曲线 Base32编码Stream类型 消息队列 背景介绍 这里是三台公网云服务器，每台 2C4G，搭建一个大数据的学习环境，供我学习。
之前已经在 VM 虚拟机上搭建过一次，但是没留下笔记，这次趁着前几天薅羊毛的3台机器，赶紧尝试在公网上搭建体验一下。
2C4G 编号 h1212C4G 编号 h1222C2G 编号 h123 发布订阅 基本简介 Redis提供了订阅发布的功能，可以用于消息的传输
发布者和订阅者都是Redis的客户端，Channel则为Redis的服务端。发布者将消息发送到某个频道，订阅了这个频道的订阅者就能收到这条消息。 Subscribe Redis客户端1：订阅频道1、订阅频道2
执行完之后，程序会阻塞住。
代码实现如下：
root@h121:/usr/redis/bin# ./redis-cli 127.0.0.1:6379&gt; subscribe ch1 ch2 Reading messages... (press Ctrl-C to quit) 1) &#34;subscribe&#34; 2) &#34;ch1&#34; 3) (integer) 1 1) &#34;subscribe&#34; 2) &#34;ch2&#34; 3) (integer) 2 Publish Redis客户端2：将消息发布到频道1、频道2
root@h121:/usr/redis/bin# ./redis-cli 127.0.0.1:6379&gt; publish ch1 hello! (integer) 1 127.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-22T09:23:28+08:00">
    <meta property="article:modified_time" content="2024-07-22T09:23:28+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">大数据-42 Redis 功能扩展 发布/订阅模式 事务相关的内容 Redis弱事务</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>点一下关注吧！！！非常感谢！！持续更新！！！</h2> 
<h2><a id="_1"></a>目前已经更新到了：</h2> 
<ul><li>Hadoop</li><li>HDFS</li><li>MapReduce</li><li>Hive</li><li>Flume</li><li>Sqoop</li><li>Zookeeper</li><li>HBase</li><li>Redis （正在更新）</li></ul> 
<h2><a id="_12"></a>章节内容</h2> 
<p>上一节我们完成了如下的内容：</p> 
<ul><li>bitmap 位操作类型</li><li>geo 空间类型 空间计算 Z阶曲线 Base32编码</li><li>Stream类型 消息队列</li></ul> 
<h2><a id="_18"></a>背景介绍</h2> 
<p>这里是三台公网云服务器，每台 2C4G，搭建一个大数据的学习环境，供我学习。<br> 之前已经在 VM 虚拟机上搭建过一次，但是没留下笔记，这次趁着前几天薅羊毛的3台机器，赶紧尝试在公网上搭建体验一下。</p> 
<ul><li>2C4G 编号 h121</li><li>2C4G 编号 h122</li><li>2C2G 编号 h123</li></ul> 
<p><img src="https://images2.imgbox.com/58/f5/0Xmm1ZJh_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_28"></a>发布订阅</h2> 
<h3><a id="_29"></a>基本简介</h3> 
<p>Redis提供了<code>订阅发布</code>的功能，可以用于消息的传输<br> <img src="https://images2.imgbox.com/bb/46/yTrJOuAD_o.png" alt="在这里插入图片描述"></p> 
<ul><li><code>发布者</code>和<code>订阅者</code>都是<code>Redis的客户端</code>，<code>Channel则为Redis的服务端</code>。</li><li>发布者将消息发送到某个频道，订阅了这个频道的订阅者就能收到这条消息。</li></ul> 
<h2><a id="Subscribe_36"></a>Subscribe</h2> 
<p>Redis客户端1：订阅频道1、订阅频道2<br> 执行完之后，程序会阻塞住。</p> 
<p>代码实现如下：</p> 
<pre><code class="prism language-shell">root@h121:/usr/redis/bin<span class="token comment"># ./redis-cli</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> subscribe ch1 ch2
Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"subscribe"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"ch1"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"subscribe"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"ch2"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
</code></pre> 
<h2><a id="Publish_53"></a>Publish</h2> 
<p>Redis客户端2：将消息发布到频道1、频道2</p> 
<pre><code class="prism language-shell">root@h121:/usr/redis/bin<span class="token comment"># ./redis-cli</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> publish ch1 hello<span class="token operator">!</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> publish ch2 hellworld<span class="token operator">!</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 
</code></pre> 
<h2><a id="_64"></a>观察结果</h2> 
<p>此时查看客户端1，可以看到消息已经拿到了：</p> 
<pre><code class="prism language-shell"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> subscribe ch1 ch2
Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"subscribe"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"ch1"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"subscribe"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"ch2"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"message"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"ch1"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"hello!"</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"message"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"ch2"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"hellworld!"</span>
</code></pre> 
<h3><a id="_83"></a>使用场景</h3> 
<ul><li><code>哨兵模式</code> 哨兵之间通过发布与订阅的方式与Redis主服务器和从服务器进行通信。</li><li><code>Redisson</code> 是一个<code>分布式框架</code>，分布式锁释放时，是使用发布订阅的方式。</li></ul> 
<h2><a id="_87"></a>事务相关</h2> 
<p>事务（Transaction），是指为单个逻辑工作单元执行一系列的操作。</p> 
<h3><a id="ACID_90"></a>ACID</h3> 
<ul><li><code>Atomic（原子性）</code>：构成事务所有操作必须是一个逻辑单元，要么全部执行，要么全部失败。</li><li><code>Consistency（一致性）</code>：数据库在事务执行前后状态都必须是稳定的或者一致的</li><li><code>Isolation（隔离性）</code>：事务之间不会互相影响</li><li><code>Durability（持久性）</code>：事务执行成功后必须全部写入磁盘</li></ul> 
<h3><a id="Redis_96"></a>Redis事务</h3> 
<ul><li><code>Redis事务</code>通过<code>multi、exec、discard、watch</code>四个命令来完成的</li><li><code>Redis</code>的<code>单个命令</code>都是<code>原子性</code>的，所以这里需要确保事务性的对象是命令集合</li><li><code>Redis</code>将<code>命令集合</code>序列化并确保处于同一个事务的命令集合连续且不被打断的执行</li><li><code>Redis不支持回滚</code>操作</li></ul> 
<h3><a id="_102"></a>事务相关指令</h3> 
<ul><li><code>multi</code>：用于标记事务块的开始，Redis会将后续的命令逐个放入队列中，然后使用exec原子化执行这个命令队列。</li><li><code>exec</code>：执行命令队列</li><li><code>discard</code>：清除命令队列</li><li><code>watch</code>：监视key</li><li><code>unwatch</code>：清除监视key</li></ul> 
<p><img src="https://images2.imgbox.com/cf/61/BdIByc65_o.png" alt="在这里插入图片描述"><br> 实现代码如下：</p> 
<pre><code class="prism language-shell"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> multi
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> s1 <span class="token number">22</span>
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> hset set1 name wzk
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">exec</span>
<span class="token number">1</span><span class="token punctuation">)</span> OK
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> multi
OK
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> s2 <span class="token number">22</span>
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> hset set2 name kangkang
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> discard
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">exec</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR EXEC without MULTI
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 
</code></pre> 
<h3><a id="Redis__134"></a>Redis 弱事务</h3> 
<p>Redis语法错误时，会导致整个任务的命令在队列里都清除</p> 
<pre><code class="prism language-shell"><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> ss <span class="token number">111</span>
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> seta cuowu
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR unknown <span class="token builtin class-name">command</span> <span class="token variable"><span class="token variable">`</span>seta<span class="token variable">`</span></span>, with args beginning with: <span class="token variable"><span class="token variable">`</span>cuowu<span class="token variable">`</span></span>, 
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> m2 <span class="token number">222</span>
QUEUED
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">(</span>TX<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">exec</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> EXECABORT Transaction discarded because of previous errors.
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 
</code></pre> 
<h2><a id="Redis__148"></a>Redis事务 为什么不能回滚</h2> 
<ul><li><code>大多数事务</code>的失败都是<code>语法错误</code>或者<code>类型错误</code>，在<code>开发阶段</code>就可以<code>预料的</code></li><li>为了<code>性能</code>方面就<code>忽略了事务</code> <code>回滚</code>是<code>需要</code>历史<code>版本记录</code>的</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/addd746381c2b456c60d33b23b32e3b4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【OAuth2系列】集成微信小程序登录到 Spring Security OAuth 2.0</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e4e3483d49b454a02f3fed774f94f433/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">你了解你的GD32 MCU系统主频是多少吗 ？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>