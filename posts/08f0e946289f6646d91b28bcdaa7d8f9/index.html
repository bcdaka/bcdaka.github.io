<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python基于opencv和tkinter实现人脸识别【内附完整代码】 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/08f0e946289f6646d91b28bcdaa7d8f9/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="python基于opencv和tkinter实现人脸识别【内附完整代码】">
  <meta property="og:description" content="前言： 人脸识别技术已经在许多领域得到了广泛应用，例如安防、金融、医疗等等。人脸识别可以帮助我们识别和验证一个人的身份，这是一项非常重要的任务。本篇博客将介绍如何使用Python和OpenCV库进行人脸识别。我们将学习如何使用OpenCV中的人脸检测器检测图像中的人脸，如何与一个人的图像进行比较以检测是否属于该人，以及如何在GUI中显示识别结果。你可以嵌入到你的程序、机器上。现在，让我们开始学习人脸识别技术吧！
如果你已有python环境和opencv库可直接跳转到代码解读哦
目录
前言：
环境搭建：
安装Python
安装pip
安装OpenCV
配置环境变量
代码解读
程序的大体流程如下：
加载 Haar Cascade 分类器用于人脸检测。
打开摄像头并捕获实时图像。
循环处理捕获的图像：
关闭摄像头并销毁窗口。
代码解析
与person文件夹中的图像进行比较以检测人脸
cv2AddChineseText方法
完整代码
环境搭建： 安装Python 首先，你需要下载和安装Python。可以在Python官方网站上下载最新版本的Python安装程序：https://www.python.org/downloads/windows/请务必下载并安装3.x版本的Python，因为OpenCV不支持Python 2.x。
安装pip pip是Python的包管理器，可以轻松地安装、升级和删除Python软件包。可以使用以下命令检查是否已经安装了pip：
pip --version 如果pip没有安装，可以在终端中输入以下命令进行安装：
python -m ensurepip --default-pip 安装OpenCV 可以使用pip来安装OpenCV：
pip install opencv-python 配置环境变量 为了让Python能够找到OpenCV，需要将OpenCV的路径添加到系统的环境变量中。
首先，找到OpenCV安装的路径，一般在Python的安装目录下的Lib\site-packages目录中。例如，在我的电脑上，OpenCV安装在以下目录下：
C:\Users\username\AppData\Local\Programs\Python\Python39\Lib\site-packages\cv2
然后，将这个路径添加到系统的环境变量中。在Windows 10中，可以按以下步骤进行操作：
在Windows搜索栏中输入“环境变量”，并点击“编辑系统环境变量”；在“高级”选项卡下，点击“环境变量”按钮；在“系统变量”下方找到“Path”变量，点击“编辑”按钮；在“编辑环境变量”对话框中，点击“新建”按钮，并将OpenCV的路径添加进去。测试OpenCV最后，可以测试一下OpenCV是否已经正确安装。可以在终端中输入以下代码： import cv2 print(cv2.__version__) 如果OpenCV已经成功安装，应该会显示OpenCV的版本号。
希望这个简要的教程可以帮助你在Windows上成功安装和配置OpenCV和Python。
代码解读 这是一个基于 OpenCV 库和 tkinter 库开发的人脸识别程序。它可以从摄像头实时获取视频，并在视频中检测人脸并显示其姓名。
程序的大体流程如下： 加载 Haar Cascade 分类器用于人脸检测。 打开摄像头并捕获实时图像。 循环处理捕获的图像： 将图像转换为灰度图像。使用 Haar Cascade 分类器检测人脸。如果检测到人脸，则查找是否存在与 person 文件夹中的某个人匹配的图像。如果找到匹配的人脸，则在图像中框出人脸并显示姓名。如果未找到匹配的人脸，则在图像中框出人脸但不显示姓名。将图像转换为 PIL Image 格式以在 GUI 中显示。更新标签以显示图像。处理 GUI 事件以避免程序挂起。 关闭摄像头并销毁窗口。 代码中的函数 cv2AddChineseText 用于在图像上添加中文文本。函数 cv2AddChineseText 接受四个参数：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-04-10T16:03:39+08:00">
    <meta property="article:modified_time" content="2023-04-10T16:03:39+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python基于opencv和tkinter实现人脸识别【内附完整代码】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<h2 id="%E5%89%8D%E8%A8%80%EF%BC%9A">前言：</h2> 
<p>人脸识别技术已经在许多领域得到了广泛应用，例如安防、金融、医疗等等。人脸识别可以帮助我们识别和验证一个人的身份，这是一项非常重要的任务。本篇博客将介绍如何使用Python和OpenCV库进行人脸识别。我们将学习如何使用OpenCV中的人脸检测器检测图像中的人脸，如何与一个人的图像进行比较以检测是否属于该人，以及如何在GUI中显示识别结果。你可以嵌入到你的程序、机器上。现在，让我们开始学习人脸识别技术吧！</p> 
<p style="text-align:center;"><span style="color:#fe2c24;"><strong>如果你已有python环境和opencv库可直接跳转到</strong></span><a href="#%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB" rel="nofollow">代码解读</a><span style="color:#fe2c24;"><strong>哦</strong></span></p> 
<hr> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E5%89%8D%E8%A8%80%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E5%89%8D%E8%A8%80%EF%BC%9A" rel="nofollow">前言：</a></p> 
<p id="%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%EF%BC%9A" rel="nofollow">环境搭建：</a></p> 
<p id="%E5%AE%89%E8%A3%85Python-toc" style="margin-left:40px;"><a href="#%E5%AE%89%E8%A3%85Python" rel="nofollow">安装Python</a></p> 
<p id="%E5%AE%89%E8%A3%85pip-toc" style="margin-left:40px;"><a href="#%E5%AE%89%E8%A3%85pip" rel="nofollow">安装pip</a></p> 
<p id="%E5%AE%89%E8%A3%85OpenCV-toc" style="margin-left:40px;"><a href="#%E5%AE%89%E8%A3%85OpenCV" rel="nofollow">安装OpenCV</a></p> 
<p id="%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F-toc" style="margin-left:40px;"><a href="#%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" rel="nofollow">配置环境变量</a></p> 
<p id="%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB-toc" style="margin-left:0px;"><a href="#%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB" rel="nofollow">代码解读</a></p> 
<p id="%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%A4%A7%E4%BD%93%E6%B5%81%E7%A8%8B%E5%A6%82%E4%B8%8B%EF%BC%9A-toc" style="margin-left:40px;"><a href="#%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%A4%A7%E4%BD%93%E6%B5%81%E7%A8%8B%E5%A6%82%E4%B8%8B%EF%BC%9A" rel="nofollow">程序的大体流程如下：</a></p> 
<p id="%E5%8A%A0%E8%BD%BD%20Haar%20Cascade%20%E5%88%86%E7%B1%BB%E5%99%A8%E7%94%A8%E4%BA%8E%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B%E3%80%82-toc" style="margin-left:80px;"><a href="#%E5%8A%A0%E8%BD%BD%20Haar%20Cascade%20%E5%88%86%E7%B1%BB%E5%99%A8%E7%94%A8%E4%BA%8E%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B%E3%80%82" rel="nofollow">加载 Haar Cascade 分类器用于人脸检测。</a></p> 
<p id="%E6%89%93%E5%BC%80%E6%91%84%E5%83%8F%E5%A4%B4%E5%B9%B6%E6%8D%95%E8%8E%B7%E5%AE%9E%E6%97%B6%E5%9B%BE%E5%83%8F%E3%80%82-toc" style="margin-left:80px;"><a href="#%E6%89%93%E5%BC%80%E6%91%84%E5%83%8F%E5%A4%B4%E5%B9%B6%E6%8D%95%E8%8E%B7%E5%AE%9E%E6%97%B6%E5%9B%BE%E5%83%8F%E3%80%82" rel="nofollow">打开摄像头并捕获实时图像。</a></p> 
<p id="%E5%BE%AA%E7%8E%AF%E5%A4%84%E7%90%86%E6%8D%95%E8%8E%B7%E7%9A%84%E5%9B%BE%E5%83%8F%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E5%BE%AA%E7%8E%AF%E5%A4%84%E7%90%86%E6%8D%95%E8%8E%B7%E7%9A%84%E5%9B%BE%E5%83%8F%EF%BC%9A" rel="nofollow">循环处理捕获的图像：</a></p> 
<p id="%E5%85%B3%E9%97%AD%E6%91%84%E5%83%8F%E5%A4%B4%E5%B9%B6%E9%94%80%E6%AF%81%E7%AA%97%E5%8F%A3%E3%80%82-toc" style="margin-left:80px;"><a href="#%E5%85%B3%E9%97%AD%E6%91%84%E5%83%8F%E5%A4%B4%E5%B9%B6%E9%94%80%E6%AF%81%E7%AA%97%E5%8F%A3%E3%80%82" rel="nofollow">关闭摄像头并销毁窗口。</a></p> 
<p id="%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90-toc" style="margin-left:0px;"><a href="#%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90" rel="nofollow">代码解析</a></p> 
<p id="%E4%B8%8Eperson%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E7%9A%84%E5%9B%BE%E5%83%8F%E8%BF%9B%E8%A1%8C%E6%AF%94%E8%BE%83%E4%BB%A5%E6%A3%80%E6%B5%8B%E4%BA%BA%E8%84%B8-toc" style="margin-left:40px;"><a href="#%E4%B8%8Eperson%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E7%9A%84%E5%9B%BE%E5%83%8F%E8%BF%9B%E8%A1%8C%E6%AF%94%E8%BE%83%E4%BB%A5%E6%A3%80%E6%B5%8B%E4%BA%BA%E8%84%B8" rel="nofollow">与person文件夹中的图像进行比较以检测人脸</a></p> 
<p id="%C2%A0cv2AddChineseText%E6%96%B9%E6%B3%95-toc" style="margin-left:40px;"><a href="#%C2%A0cv2AddChineseText%E6%96%B9%E6%B3%95" rel="nofollow"> cv2AddChineseText方法</a></p> 
<p id="%C2%A0%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81-toc" style="margin-left:0px;"><a href="#%C2%A0%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81" rel="nofollow"> 完整代码</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%EF%BC%9A">环境搭建：</h2> 
<h3 id="%E5%AE%89%E8%A3%85Python">安装Python</h3> 
<p>首先，你需要下载和安装Python。可以在Python官方网站上下载最新版本的Python安装程序：<a href="https://www.python.org/downloads/windows/%E3%80%82%E8%AF%B7%E5%8A%A1%E5%BF%85%E4%B8%8B%E8%BD%BD%E5%B9%B6%E5%AE%89%E8%A3%853.x%E7%89%88%E6%9C%AC%E7%9A%84Python%EF%BC%8C%E5%9B%A0%E4%B8%BAOpenCV%E4%B8%8D%E6%94%AF%E6%8C%81Python" rel="nofollow" title="https://www.python.org/downloads/windows/">https://www.python.org/downloads/windows/</a>请务必下载并安装3.x版本的Python，因为OpenCV不支持Python 2.x。</p> 
<h3 id="%E5%AE%89%E8%A3%85pip">安装pip</h3> 
<p>pip是Python的包管理器，可以轻松地安装、升级和删除Python软件包。可以使用以下命令检查是否已经安装了pip：</p> 
<pre><code>pip --version</code></pre> 
<p> 如果pip没有安装，可以在终端中输入以下命令进行安装：</p> 
<pre><code class="language-python">python -m ensurepip --default-pip
</code></pre> 
<h3 id="%E5%AE%89%E8%A3%85OpenCV">安装OpenCV</h3> 
<p>可以使用pip来安装OpenCV：</p> 
<pre><code class="language-python">pip install opencv-python
</code></pre> 
<h3 id="%E9%85%8D%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">配置环境变量</h3> 
<p><span style="color:#fe2c24;">为了让Python能够找到OpenCV，需要将OpenCV的路径添加到系统的环境变量中。</span></p> 
<p>首先，找到OpenCV安装的路径，一般在Python的安装目录下的Lib\site-packages目录中。例如，在我的电脑上，OpenCV安装在以下目录下：</p> 
<blockquote> 
 <p><code>C:\Users\username\AppData\Local\Programs\Python\Python39\Lib\site-packages\cv2</code></p> 
</blockquote> 
<p>然后，将这个路径添加到系统的环境变量中。在Windows 10中，可以按以下步骤进行操作：</p> 
<ol><li>在Windows搜索栏中输入“环境变量”，并点击“编辑系统环境变量”；</li><li>在“高级”选项卡下，点击“环境变量”按钮；</li><li>在“系统变量”下方找到“Path”变量，点击“编辑”按钮；</li><li>在“编辑环境变量”对话框中，点击“新建”按钮，并将OpenCV的路径添加进去。</li><li>测试OpenCV</li><li>最后，可以测试一下OpenCV是否已经正确安装。可以在终端中输入以下代码：</li></ol> 
<pre><code class="language-python">import cv2 
print(cv2.__version__)</code></pre> 
<p>如果OpenCV已经成功安装，应该会显示OpenCV的版本号。</p> 
<p>希望这个简要的教程可以帮助你在Windows上成功安装和配置OpenCV和Python。</p> 
<p></p> 
<p></p> 
<h2 id="%E4%BB%A3%E7%A0%81%E8%A7%A3%E8%AF%BB">代码解读</h2> 
<p>这是一个基于 OpenCV 库和 tkinter 库开发的人脸识别程序。它可以从摄像头实时获取视频，并在视频中检测人脸并显示其姓名。</p> 
<h3 id="%E7%A8%8B%E5%BA%8F%E7%9A%84%E5%A4%A7%E4%BD%93%E6%B5%81%E7%A8%8B%E5%A6%82%E4%B8%8B%EF%BC%9A">程序的大体流程如下：</h3> 
<ol><li> <h4 id="%E5%8A%A0%E8%BD%BD%20Haar%20Cascade%20%E5%88%86%E7%B1%BB%E5%99%A8%E7%94%A8%E4%BA%8E%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B%E3%80%82">加载 Haar Cascade 分类器用于人脸检测。</h4> </li><li> <h4 id="%E6%89%93%E5%BC%80%E6%91%84%E5%83%8F%E5%A4%B4%E5%B9%B6%E6%8D%95%E8%8E%B7%E5%AE%9E%E6%97%B6%E5%9B%BE%E5%83%8F%E3%80%82">打开摄像头并捕获实时图像。</h4> </li><li> <h4 id="%E5%BE%AA%E7%8E%AF%E5%A4%84%E7%90%86%E6%8D%95%E8%8E%B7%E7%9A%84%E5%9B%BE%E5%83%8F%EF%BC%9A">循环处理捕获的图像：</h4> 
  <ol><li>将图像转换为灰度图像。</li><li>使用 Haar Cascade 分类器检测人脸。</li><li>如果检测到人脸，则查找是否存在与 <code>person</code> 文件夹中的某个人匹配的图像。</li><li>如果找到匹配的人脸，则在图像中框出人脸并显示姓名。</li><li>如果未找到匹配的人脸，则在图像中框出人脸但不显示姓名。</li><li>将图像转换为 PIL Image 格式以在 GUI 中显示。</li><li>更新标签以显示图像。</li><li>处理 GUI 事件以避免程序挂起。</li></ol></li><li> <h4 id="%E5%85%B3%E9%97%AD%E6%91%84%E5%83%8F%E5%A4%B4%E5%B9%B6%E9%94%80%E6%AF%81%E7%AA%97%E5%8F%A3%E3%80%82">关闭摄像头并销毁窗口。</h4> </li></ol> 
<p><strong>代码中的函数 <code>cv2AddChineseText</code> 用于在图像上添加中文文本。函数 <code>cv2AddChineseText</code> 接受四个参数：</strong></p> 
<ul><li><code>img</code>：要添加文本的图像。</li><li><code>text</code>：要添加的文本。</li><li><code>position</code>：文本的位置。</li><li><code>textColor</code>：文本颜色，默认为绿色。</li><li><code>textSize</code>：文本大小，默认为 30。</li></ul> 
<p><span style="color:#fe2c24;">代码中的 <code>person_images</code> 列表用于存储 <code>person</code> 文件夹中的人脸图像。<code>person_names</code> 列表用于存储每个人脸图像对应的姓名。在处理捕获的图像时，程序将检查每个人脸图像是否匹配，并在图像中显示姓名。</span></p> 
<h2 id="%E4%BB%A3%E7%A0%81%E8%A7%A3%E6%9E%90">代码解析</h2> 
<p>该程序主要通过计算机视觉技术实现人脸识别。首先，程序使用OpenCV库中的Haar Cascade分类器来检测输入图像中的人脸。然后，它会将人脸与事先保存在“person”文件夹中的图像进行比较，以确定是否存在匹配的人脸。如果存在匹配的人脸，则程序会在图像中框出人脸并显示相应的姓名。如果不存在匹配的人脸，则程序仅在图像中框出人脸。</p> 
<p>下面是程序的主要部分的解释：</p> 
<pre><code class="language-python"># 加载Haar Cascade分类器
face_cascade = cv2.CascadeClassifier('haarcascade_frontalface_default.xml')

# 打开摄像头并捕获实时图像
cap = cv2.VideoCapture(0)

# 读取person文件夹中的图像和姓名
person_images = []
person_names = []
for filename in os.listdir('person'):
    if filename.endswith('.jpg'):
        # 使用utf-8编码打开文件
        with open(os.path.join('person', filename), 'rb') as f:
            person_images.append(cv2.imdecode(np.frombuffer(f.read(), np.uint8), cv2.IMREAD_COLOR))
        person_names.append(os.path.splitext(filename)[0])

while True:
    ret, frame = cap.read()
    if not ret:
        break

    # 转换图像格式以进行人脸检测
    gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)

    # 使用Haar Cascade分类器检测人脸
    faces = face_cascade.detectMultiScale(gray, scaleFactor=1.1, minNeighbors=5)

    # 在图像中框出检测到的人脸
    for (x, y, w, h) in faces:
        # 检查人脸是否属于person文件夹中的某个人
        found_person = False
        for i in range(len(person_images)):
            person_image = person_images[i]
            person_name = person_names[i]
            # 将person图像转换为灰度图像以进行比较
            person_gray = cv2.cvtColor(person_image, cv2.COLOR_BGR2GRAY)
            # 检查是否存在与person图像相匹配的人脸
            match = cv2.matchTemplate(gray[y:y + h, x:x + w], person_gray, cv2.TM_CCOEFF_NORMED)
            if match.max() &gt; 0.8:
                # 如果找到匹配的人脸，则将其标记为“found_person”，并绘制人脸框
                found_person = True
                cv2.rectangle(frame, (x, y), (x + w, y + h), (0, 255, 0), 2)
                # 在人脸框上方写出人名
                cv2.putText(frame, person_name, (x, y - 10), cv2.FONT_HERSHEY_SIMPLEX, 0.9, (0, 255, 0), 2)
                break
        if not found_person:
            # 如果没有找到匹配的人脸，则将其标记为“unknown”，并绘制人脸框
            cv2.rectangle(frame, (x, y), (x + w, y + h), (0, 0, 255), 2)
            cv2.putText(frame, 'unknown', (x, y - 10), cv2.FONT_HERSHEY_SIMPLEX, 0.9, (0, 0, 255), 2)

          
</code></pre> 
<p></p> 
<p></p> 
<h3 id="%E4%B8%8Eperson%E6%96%87%E4%BB%B6%E5%A4%B9%E4%B8%AD%E7%9A%84%E5%9B%BE%E5%83%8F%E8%BF%9B%E8%A1%8C%E6%AF%94%E8%BE%83%E4%BB%A5%E6%A3%80%E6%B5%8B%E4%BA%BA%E8%84%B8">与person文件夹中的图像进行比较以检测人脸</h3> 
<p>我们已经成功地检测出了人脸，并将其框出来。现在我们将探讨如何与person文件夹中的图像进行比较以检测人脸。</p> 
<p>首先，我们需要读取person文件夹中的图像和姓名。我们可以使用os模块中的listdir函数列出person文件夹中的所有文件名，然后使用cv2.imread函数读取每个图像。</p> 
<pre><code class="language-python">import os

person_folder = 'person'
person_images = []
person_names = []

# 获取person文件夹中的所有文件名
for filename in os.listdir(person_folder):
    # 如果文件名以'.jpg'或'.png'结尾，则读取该图像并将其添加到person_images列表中
    if filename.endswith('.jpg') or filename.endswith('.png'):
        image = cv2.imread(os.path.join(person_folder, filename))
        person_images.append(image)
        # 使用文件名中的数字作为该人员的姓名
        person_names.append(filename.split('.')[0])</code></pre> 
<p>接下来，我们需要将每个person图像转换为灰度图像以进行比较。我们可以使用cv2.cvtColor函数将BGR图像转换为灰度图像。</p> 
<pre><code class="language-python">for i in range(len(person_images)):
    person_image = person_images[i]
    # 将person图像转换为灰度图像以进行比较
    person_gray = cv2.cvtColor(person_image, cv2.COLOR_BGR2GRAY)
</code></pre> 
<p>现在，我们可以使用matchTemplate函数将当前人脸与person图像进行比较，以确定当前人脸是否属于person文件夹中的某个人。matchTemplate函数可以将当前人脸的灰度图像与person图像的灰度图像进行比较，并返回一个相似度矩阵。我们可以使用max方法获取相似度矩阵中的最大值，并将其与一个预设的阈值（例如0.8）进行比较，以确定当前人脸是否与person图像匹配。 </p> 
<pre><code class="language-python">    for (x, y, w, h) in faces:
        # 检查人脸是否属于person文件夹中的某个人
        found_person = False
        for i in range(len(person_images)):
            person_image = person_images[i]
            person_name = person_names[i]
            # 将person图像转换为灰度图像以进行比较
            person_gray = cv2.cvtColor(person_image, cv2.COLOR_BGR2GRAY)
            # 检查是否存在与person图像相匹配的人脸
            match = cv2.matchTemplate(gray[y:y + h, x:x + w], person_gray, cv2.TM_CCOEFF_NORMED)
            if match.max() &gt; 0.8:
                found_person = True
                # 将人物名称绘制在检测到的人脸上
                cv2.rectangle(frame, (x, y), (x + w, y + h), (0, 255, 0), 2)
                cv2.putText(frame, person_name, (x, y - 5), cv2.FONT_HERSHEY_SIMPLEX, 0.5, (0, 255, 0), 2)
                break

        # 如果找不到相应的人物，则将“Unknown”绘制在检测到的人脸上
        if not found_person:
            cv2.rectangle(frame, (x, y), (x + w, y + h), (0, 0, 255), 2)
            cv2.putText(frame, 'Unknown', (x, y - 5), cv2.FONT_HERSHEY_SIMPLEX, 0.5, (0, 0, 255), 2)
        
    # 将帧显示在窗口中
    cv2.imshow('Face Recognition', frame)
    
    # 等待退出键
    if cv2.waitKey(1) &amp; 0xFF == ord('q'):
        break

# 释放资源
cap.release()
cv2.destroyAllWindows()
</code></pre> 
<p><span style="color:#fe2c24;">这段代码将每个检测到的人脸与存储在“person”文件夹中的图像进行比较。如果存在与任何一个图像匹配的人脸，则在该人脸上方框和标注该人的名称。否则，将该人脸框在红色方框内，并标注“Unknown”。（完整代码中没有加入这行，如果需要可以加上）</span></p> 
<p>最后，它将帧显示在GUI窗口中，并等待退出键按下后释放资源并关闭窗口。</p> 
<h3 id="%C2%A0cv2AddChineseText%E6%96%B9%E6%B3%95"> cv2AddChineseText方法</h3> 
<p><span style="color:#4da8ee;">在原生的cv2.putText()方法里并不支持中文只能显示英文，在网上查阅了很多方法都不奏效于是我决定重构这个方法：</span></p> 
<pre><code class="language-python">def cv2AddChineseText(img, text, position, textColor=(0, 255, 0), textSize=30):
    if (isinstance(img, np.ndarray)):  # 判断是否OpenCV图片类型
        img = Image.fromarray(cv2.cvtColor(img, cv2.COLOR_BGR2RGB))
    # 创建一个可以在给定图像上绘图的对象
    draw = ImageDraw.Draw(img)
    # 字体的格式
    fontStyle = ImageFont.truetype(
        "simsun.ttc", textSize, encoding="utf-8")
    # 绘制文本
    draw.text(position, text, textColor, font=fontStyle)
    # 转换回OpenCV格式
    return cv2.cvtColor(np.asarray(img), cv2.COLOR_RGB2BGR)</code></pre> 
<h2 id="%C2%A0%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"> 完整代码</h2> 
<pre><code class="language-python">import cv2
import os
import tkinter as tk
from PIL import Image, ImageTk,ImageDraw
import numpy as np

from PIL import ImageFont

def cv2AddChineseText(img, text, position, textColor=(0, 255, 0), textSize=30):
    if (isinstance(img, np.ndarray)):  # 判断是否OpenCV图片类型
        img = Image.fromarray(cv2.cvtColor(img, cv2.COLOR_BGR2RGB))
    # 创建一个可以在给定图像上绘图的对象
    draw = ImageDraw.Draw(img)
    # 字体的格式
    fontStyle = ImageFont.truetype(
        "simsun.ttc", textSize, encoding="utf-8")
    # 绘制文本
    draw.text(position, text, textColor, font=fontStyle)
    # 转换回OpenCV格式
    return cv2.cvtColor(np.asarray(img), cv2.COLOR_RGB2BGR)

# 加载自定义字体
font = ImageFont.truetype(r"C:\Users\ge\Desktop\test1\Cuesor\msyh.ttc", size=30)

# 加载Haar Cascade分类器
face_cascade = cv2.CascadeClassifier('haarcascade_frontalface_default.xml')

# 创建GUI窗口
root = tk.Tk()
root.geometry('640x480')
root.title('人脸识别')

# 创建标签用于显示图像
image_label = tk.Label(root)
image_label.pack()

# 打开摄像头并捕获实时图像
cap = cv2.VideoCapture(0)

# 创建 PhotoImage 对象
photo = None

# 读取person文件夹中的图像和姓名
person_images = []
person_names = []
for filename in os.listdir('person'):
    if filename.endswith('.jpg'):
        # 使用utf-8编码打开文件
        with open(os.path.join('person', filename), 'rb') as f:
            person_images.append(cv2.imdecode(np.frombuffer(f.read(), np.uint8), cv2.IMREAD_COLOR))
        person_names.append(os.path.splitext(filename)[0])


# 循环处理摄像头捕获的图像
while True:
    ret, frame = cap.read()
    if not ret:
        break

    # 转换图像格式以进行人脸检测
    gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)

    # 使用Haar Cascade分类器检测人脸
    faces = face_cascade.detectMultiScale(gray, scaleFactor=1.1, minNeighbors=5)

    # 在图像中框出检测到的人脸
    for (x, y, w, h) in faces:
        # 检查人脸是否属于person文件夹中的某个人
        found_person = False
        for i in range(len(person_images)):
            person_image = person_images[i]
            person_name = person_names[i]
            # 将person图像转换为灰度图像以进行比较
            person_gray = cv2.cvtColor(person_image, cv2.COLOR_BGR2GRAY)
            # 检查是否存在与person图像相匹配的人脸
            match = cv2.matchTemplate(gray[y:y + h, x:x + w], person_gray, cv2.TM_CCOEFF_NORMED)
            if match.max() &gt; 0.8:
                print(person_name)
                found_person = True
                # 在图像中框出人脸并显示姓名
                cv2.rectangle(frame, (x, y), (x + w, y + h), (0, 255, 255), 2)
                # 在图像中框出人脸并显示姓名
                cv2.rectangle(frame, (x, y), (x + w, y + h), (0, 255, 255), 2)
                frame = cv2AddChineseText(frame, person_name, (x + (w/2)-10, y - 30), (0, 255, 255), 30)
                break

        # 如果没有找到匹配的人脸，则在图像中框出人脸但不显示姓名
        if not found_person:
            cv2.rectangle(frame, (x, y), (x + w, y + h), (0, 255, 0), 2)

    # 将图像转换为PIL Image格式以在GUI中显示

    image = Image.fromarray(cv2.cvtColor(frame, cv2.COLOR_BGR2RGB))
    photo = ImageTk.PhotoImage(image)

    # 更新标签以显示图像
    image_label.configure(image=photo)
    image_label.image = photo

    # 处理GUI事件以避免程序挂起
    root.update()
#关闭摄像头并销毁窗口
cap.release()
cv2.destroyAllWindows()</code></pre> 
<p><strong><span style="color:#fe2c24;">人脸识别技术在现代生活中有着广泛的应用，例如人脸解锁手机、人脸识别支付、安防领域等。但是，人脸识别技术还存在一些局限性和改进的空间。</span></strong></p> 
<p><strong><span style="color:#fe2c24;">首先，人脸识别技术的准确性受到许多因素的影响，例如光照、姿势、表情、遮挡等。为了提高人脸识别的准确性，可以采用更先进的算法，例如基于深度学习的人脸识别算法。此外，还可以通过采用更好的硬件设备来提高图像采集的质量。</span></strong></p> 
<p><strong><span style="color:#fe2c24;">其次，当前的人脸识别技术主要针对单个人脸进行识别，对于多个人脸的情况处理较为困难。为了解决这个问题，可以探索如何将多个人脸的特征进行有效地提取和匹配。</span></strong></p> 
<p><strong><span style="color:#fe2c24;">最后，人脸识别技术还涉及到隐私保护等伦理问题。在应用人脸识别技术时，需要注意隐私保护的问题，避免对个人隐私造成侵害。</span></strong></p> 
<p><strong><span style="color:#fe2c24;">总的来说，人脸识别技术在未来还有很大的发展空间，随着科技的不断进步，相信人脸识别技术的应用将更加广泛，也将更加普及化和便利化。</span></strong></p> 
<p><span style="color:#956fe7;">人脸识别技术正在广泛应用于各个领域，例如安全监控、人脸支付、人脸解锁等等。本文介绍的人脸识别应用程序只是冰山一角，随着技术的不断发展，我们可以期待更加高效、准确的人脸识别应用程序的出现。如果您对人脸识别技术感兴趣，不妨关注相关的技术发展和应用案例，为您的职业生涯增添一份技术的底气。感谢阅读本文，如果您觉得有用，请点赞、收藏和关注，谢谢啦！！</span></p> 
<p></p> 
<p><span style="color:#956fe7;">过几天我会在此基础上加上录入人脸信息的功能，感兴趣的小伙伴不要错过哦。</span></p> 
<p></p> 
<p style="text-align:center;"><span style="color:#fe2c24;">再次感谢不离不弃的粉丝，之后仍会不定期更新哦~~</span></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c7e320d0c2f85b7cc135867ea51c5e33/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【C&#43;&#43;】C/C&#43;&#43;内存管理：</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/47d53e6f5fbfed67dd027d23ae8ef026/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;实现：学生管理系统（详细解析）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>