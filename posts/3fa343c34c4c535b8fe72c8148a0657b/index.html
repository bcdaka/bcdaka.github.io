<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java中nginx负载均衡配置 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/3fa343c34c4c535b8fe72c8148a0657b/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="java中nginx负载均衡配置">
  <meta property="og:description" content="负载均衡的配置，是为了实现程序的高并发和可用性进行服务器访问配置
负载均衡是指将用户的请求分配到多个后端服务器上进行处理，以达到优化资源利用率、提高响应速度和增加系统的可靠性的目的。负载均衡器通常位于用户和服务器之间，接收用户的请求，并根据某种算法将请求分发给合适的后端服务器
在nginx中，可以使用upstream模板来配置后端服务器集群组，并使用server指令指定服务器的地址和参数。然后在server配置中使用proxy_pass 指令请求转发到定义好的服务器群组。
http { upstream backend { server backend1.example.com; server backend2.example.com; server backend3.example.com; # 可以设置权重 server backend4.example.com weight=2; } server { listen 80; location / { proxy_pass http://backend; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } } } 在这个upstream 定义了一个名为 backend 的服务器群组。三个服务器通过server指定添加到群组中，第四个服务器有一个额外的weight参数，用于指定更高的权重。意味着负载均衡中将更倾向于分配更多的请求给它。
listen 指令指定了监听的端口。
location / 指定了对于所有请求，使用 proxy_pass 指令转发到定义的服务器群组。
几个 proxy_set_header 指令用于确保正确地转发原始请求信息
轮询算法是最简单的负载均衡算法之一，它按照顺序将请求依次分发给每个后端服务器。当所有服务器都被分配了一次请求后，重新开始下一轮分配。
优点：简单以实现/适应于后端服务器性能相近的情况
缺点：无法考虑服务器的负载情况，不适用于后端服务器性能差异较大的情况。
通过配置， Nginx将以轮询的方式默认分配进入的请求到上面定义的后端服务器，可以通过upstream中添加额外参数来调整负载均衡算法
例如使用：ip_hash保持会话或者使用least_conn进行最少连接数的负载均衡。
配置过程中可以新增健康检查，以确保请求分配给健康的后端服务器，可以使用
ngx_http_upstream_check_module模块实现健康检查 http { upstream backend { server backend1.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-12T11:38:33+08:00">
    <meta property="article:modified_time" content="2024-08-12T11:38:33+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java中nginx负载均衡配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>负载均衡的配置，是为了实现程序的高并发和可用性进行服务器访问配置</p> 
<p>负载均衡是指将用户的请求分配到多个后端服务器上进行处理，以达到优化资源利用率、提高响应速度和增加系统的可靠性的目的。负载均衡器通常位于用户和服务器之间，接收用户的请求，并根据某种算法将请求分发给合适的后端服务器</p> 
<p>在nginx中，可以使用upstream模板来配置后端服务器集群组，并使用server指令指定服务器的地址和参数。然后在server配置中使用proxy_pass 指令请求转发到定义好的服务器群组。</p> 
<pre><code class="hljs">http {
    upstream backend {
        server backend1.example.com;
        server backend2.example.com;
        server backend3.example.com;
        # 可以设置权重
        server backend4.example.com weight=2;
    }
 
    server {
        listen 80;
 
        location / {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}</code></pre> 
<p>在这个<code>upstream</code> 定义了一个名为 <code>backend</code> 的服务器群组。三个服务器通过server指定添加到群组中，第四个服务器有一个额外的weight参数，用于指定更高的权重。意味着负载均衡中将更倾向于分配更多的请求给它。</p> 
<ul><li> <p><code>listen</code> 指令指定了监听的端口。</p> </li><li> <p><code>location /</code> 指定了对于所有请求，使用 <code>proxy_pass</code> 指令转发到定义的服务器群组。</p> </li><li> <p>几个 <code>proxy_set_header</code> 指令用于确保正确地转发原始请求信息</p> </li></ul> 
<p>轮询算法是最简单的负载均衡算法之一，它按照顺序将请求依次分发给每个后端服务器。当所有服务器都被分配了一次请求后，重新开始下一轮分配。</p> 
<p>优点：简单以实现/适应于后端服务器性能相近的情况</p> 
<p>缺点：无法考虑服务器的负载情况，不适用于后端服务器性能差异较大的情况。</p> 
<p>通过配置， Nginx将以轮询的方式默认分配进入的请求到上面定义的后端服务器，可以通过upstream中添加额外参数来调整负载均衡算法</p> 
<p>例如使用：ip_hash保持会话或者使用least_conn进行最少连接数的负载均衡。</p> 
<p>配置过程中可以新增健康检查，以确保请求分配给健康的后端服务器，可以使用</p> 
<h6><code>ngx_http_upstream_check_module</code>模块实现健康检查</h6> 
<pre><code class="hljs">http {
    upstream backend {
        server backend1.example.com;
        server backend2.example.com;
        
        check interval=5000 rise=2 fall=5 timeout=3000;
    }

    server {
        listen 80;
        server_name example.com;

        location / {
            proxy_pass http://backend;
        }
    }
}</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c5c72003a5acf1fe448796fedb9fc93f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">安卓开发- 安卓13 Launcher3 主页布局修改</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9bb1d6e2a5c1dd5709ebc7d1c1fe5584/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">学生必看！如何用OpenAI最新GPT-4o轻松搞定论文写作</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>