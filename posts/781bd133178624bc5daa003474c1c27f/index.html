<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C#进阶-实现基于ADO.NET框架的DBHelper工具类 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/781bd133178624bc5daa003474c1c27f/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="C#进阶-实现基于ADO.NET框架的DBHelper工具类">
  <meta property="og:description" content="在C#开发中，与数据库的交互是常见的需求。通常，我们会使用ADO.NET直接执行SQL查询，虽然这种方法非常灵活，但容易导致代码重复，并且在处理多个SQL语句时容易出错。为了提高代码的可维护性和复用性，封装一个通用的数据库操作助手类（DBHelper）是非常有必要的。本文将详细介绍如何创建和使用一个DBHelper类来简化数据库操作。
一、ADO.NET简介 ADO.NET是.NET框架中用于与数据库交互的核心组件。它提供了一套用于连接数据库、执行SQL查询、插入、更新和删除数据的类库，包括SqlConnection、SqlCommand、SqlDataReader等。这些类提供了对底层数据库操作的直接控制，但同时也要求开发者手动编写SQL语句和管理数据库连接，容易导致代码冗长和重复。正因为如此，在复杂项目中，开发者往往会选择封装这些底层操作，以提高代码的复用性和维护性。
ADO.NET 特色类库
类库名称描述SqlConnection管理与数据库的连接。用于打开和关闭数据库连接。SqlCommand用于执行SQL语句，如查询、插入、更新和删除操作。SqlDataReader用于逐行读取数据查询结果，提供高效的只进读访问。SqlDataAdapter在数据库与DataSet之间桥接数据，支持填充和更新DataSet中的数据。DataSet用于存储内存中数据的离线副本，可以包含多个数据表和关系。DataTable表示内存中数据表的结构，包括表的列、行和约束。SqlParameter用于参数化查询，帮助防止SQL注入攻击并提供对参数化命令的支持。 二、DBHelper类的设计 DBHelper类的核心目标是封装常用的数据库操作，如执行查询、执行命令、获取数据集等。它通过统一的接口和简单的封装，减少了直接与ADO.NET打交道的复杂性，使得数据库操作更加简洁和安全。
DBHelper工具类示例代码如下：
namespace Test { public static class DBHelper { // 请根据实际情况设置数据库连接字符串 private static readonly string connectionString = &#34;your_connection_string_here&#34;; /// &lt;summary&gt; /// 执行一个查询，返回结果集中第一行的第一列。 /// &lt;/summary&gt; public static int GetScalar(string sql, SqlParameter[] parameters = null) { using (SqlConnection conn = new SqlConnection(connectionString)) { using (SqlCommand cmd = new SqlCommand(sql, conn)) { if (parameters != null) { cmd.Parameters.AddRange(parameters); } conn.Open(); object result = cmd.ExecuteScalar(); return result !">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-25T02:20:39+08:00">
    <meta property="article:modified_time" content="2024-08-25T02:20:39+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C#进阶-实现基于ADO.NET框架的DBHelper工具类</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在C#开发中，与数据库的交互是常见的需求。通常，我们会使用ADO.NET直接执行SQL查询，虽然这种方法非常灵活，但容易导致代码重复，并且在处理多个SQL语句时容易出错。为了提高代码的可维护性和复用性，封装一个通用的数据库操作助手类（DBHelper）是非常有必要的。本文将详细介绍如何创建和使用一个DBHelper类来简化数据库操作。</p> 
<hr> 
<h3><a id="ADONET_5"></a>一、ADO.NET简介</h3> 
<p>ADO.NET是.NET框架中用于与数据库交互的核心组件。它提供了一套用于连接数据库、执行SQL查询、插入、更新和删除数据的类库，包括<code>SqlConnection</code>、<code>SqlCommand</code>、<code>SqlDataReader</code>等。这些类提供了对底层数据库操作的直接控制，但同时也要求开发者手动编写SQL语句和管理数据库连接，容易导致代码冗长和重复。正因为如此，在复杂项目中，开发者往往会选择封装这些底层操作，以提高代码的复用性和维护性。</p> 
<p><strong>ADO.NET 特色类库</strong></p> 
<table><thead><tr><th>类库名称</th><th>描述</th></tr></thead><tbody><tr><td><strong>SqlConnection</strong></td><td>管理与数据库的连接。用于打开和关闭数据库连接。</td></tr><tr><td><strong>SqlCommand</strong></td><td>用于执行SQL语句，如查询、插入、更新和删除操作。</td></tr><tr><td><strong>SqlDataReader</strong></td><td>用于逐行读取数据查询结果，提供高效的只进读访问。</td></tr><tr><td><strong>SqlDataAdapter</strong></td><td>在数据库与DataSet之间桥接数据，支持填充和更新DataSet中的数据。</td></tr><tr><td><strong>DataSet</strong></td><td>用于存储内存中数据的离线副本，可以包含多个数据表和关系。</td></tr><tr><td><strong>DataTable</strong></td><td>表示内存中数据表的结构，包括表的列、行和约束。</td></tr><tr><td><strong>SqlParameter</strong></td><td>用于参数化查询，帮助防止SQL注入攻击并提供对参数化命令的支持。</td></tr></tbody></table> 
<hr> 
<h3><a id="DBHelper_23"></a>二、DBHelper类的设计</h3> 
<p>DBHelper类的核心目标是封装常用的数据库操作，如执行查询、执行命令、获取数据集等。它通过统一的接口和简单的封装，减少了直接与ADO.NET打交道的复杂性，使得数据库操作更加简洁和安全。</p> 
<p>DBHelper工具类示例代码如下：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">namespace</span> <span class="token namespace">Test</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DBHelper</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 请根据实际情况设置数据库连接字符串</span>
        <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">string</span></span> connectionString <span class="token operator">=</span> <span class="token string">"your_connection_string_here"</span><span class="token punctuation">;</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 执行一个查询，返回结果集中第一行的第一列。</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">GetScalar</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> sql<span class="token punctuation">,</span> <span class="token class-name">SqlParameter<span class="token punctuation">[</span><span class="token punctuation">]</span></span> parameters <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlCommand</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>parameters <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        cmd<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">AddRange</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    conn<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name"><span class="token keyword">object</span></span> result <span class="token operator">=</span> cmd<span class="token punctuation">.</span><span class="token function">ExecuteScalar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> result <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">?</span> Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 执行一个查询，返回一个数据读取器(SqlDataReader)。</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">SqlDataReader</span> <span class="token function">GetReader</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> sql<span class="token punctuation">,</span> <span class="token class-name">SqlParameter<span class="token punctuation">[</span><span class="token punctuation">]</span></span> parameters <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SqlCommand</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>parameters <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                cmd<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">AddRange</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            conn<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> cmd<span class="token punctuation">.</span><span class="token function">ExecuteReader</span><span class="token punctuation">(</span>CommandBehavior<span class="token punctuation">.</span>CloseConnection<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 执行一个查询，返回一个数据集(DataTable)。</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">DataTable</span> <span class="token function">GetDataSet</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> sql<span class="token punctuation">,</span> <span class="token class-name">SqlParameter<span class="token punctuation">[</span><span class="token punctuation">]</span></span> parameters <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlCommand</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>parameters <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        cmd<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">AddRange</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlDataAdapter</span> da <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlDataAdapter</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token class-name">DataTable</span> dt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DataTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        da<span class="token punctuation">.</span><span class="token function">Fill</span><span class="token punctuation">(</span>dt<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> dt<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 执行一个命令(Insert, Update, Delete)，返回受影响的行数。</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">ExecuteCommand</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> sql<span class="token punctuation">,</span> <span class="token class-name">SqlParameter<span class="token punctuation">[</span><span class="token punctuation">]</span></span> parameters <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlConnection</span> conn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlConnection</span><span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlCommand</span> cmd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlCommand</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> conn<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>parameters <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        cmd<span class="token punctuation">.</span>Parameters<span class="token punctuation">.</span><span class="token function">AddRange</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    conn<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> cmd<span class="token punctuation">.</span><span class="token function">ExecuteNonQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<h3><a id="DBHelper_124"></a>三、DBHelper类的使用</h3> 
<h4><a id="1__126"></a>1. 插入新数据</h4> 
<p>当我们需要向数据库中插入新记录时，可以使用<code>ExecuteCommand</code>方法。这个方法返回受影响的行数，从而让我们知道插入操作是否成功。</p> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">string</span></span> insertSql <span class="token operator">=</span> <span class="token string">"INSERT INTO Users (UserName, Password) VALUES (@UserName, @Password)"</span><span class="token punctuation">;</span>
<span class="token class-name">SqlParameter<span class="token punctuation">[</span><span class="token punctuation">]</span></span> insertParams <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlParameter</span><span class="token punctuation">(</span><span class="token string">"@UserName"</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> Value <span class="token operator">=</span> <span class="token string">"JohnDoe"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlParameter</span><span class="token punctuation">(</span><span class="token string">"@Password"</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> Value <span class="token operator">=</span> <span class="token string">"SecretPassword"</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> rowsAffected <span class="token operator">=</span> DBHelper<span class="token punctuation">.</span><span class="token function">ExecuteCommand</span><span class="token punctuation">(</span>insertSql<span class="token punctuation">,</span> insertParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>此代码段向数据库的Users表中插入了一条新记录，并返回插入操作影响的行数。</p> 
<hr> 
<h4><a id="2__143"></a>2. 条件更新数据</h4> 
<p>更新数据同样可以通过<code>ExecuteCommand</code>方法来实现。以下示例展示了如何更新用户的密码。</p> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">string</span></span> updateSql <span class="token operator">=</span> <span class="token string">"UPDATE Users SET Password = @Password WHERE UserName = @UserName"</span><span class="token punctuation">;</span>
<span class="token class-name">SqlParameter<span class="token punctuation">[</span><span class="token punctuation">]</span></span> updateParams <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlParameter</span><span class="token punctuation">(</span><span class="token string">"@UserName"</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> Value <span class="token operator">=</span> <span class="token string">"JohnDoe"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlParameter</span><span class="token punctuation">(</span><span class="token string">"@Password"</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> Value <span class="token operator">=</span> <span class="token string">"NewPassword"</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> rowsAffected <span class="token operator">=</span> DBHelper<span class="token punctuation">.</span><span class="token function">ExecuteCommand</span><span class="token punctuation">(</span>updateSql<span class="token punctuation">,</span> updateParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>此代码更新了用户名为“JohnDoe”的用户的密码，并返回受影响的行数。</p> 
<hr> 
<h4><a id="3__160"></a>3. 删除指定数据</h4> 
<p>通过<code>ExecuteCommand</code>方法，我们还可以删除数据库中的记录。下面的示例展示了如何删除某个用户。</p> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">string</span></span> deleteSql <span class="token operator">=</span> <span class="token string">"DELETE FROM Users WHERE UserName = @UserName"</span><span class="token punctuation">;</span>
<span class="token class-name">SqlParameter<span class="token punctuation">[</span><span class="token punctuation">]</span></span> deleteParams <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlParameter</span><span class="token punctuation">(</span><span class="token string">"@UserName"</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> Value <span class="token operator">=</span> <span class="token string">"JohnDoe"</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> rowsAffected <span class="token operator">=</span> DBHelper<span class="token punctuation">.</span><span class="token function">ExecuteCommand</span><span class="token punctuation">(</span>deleteSql<span class="token punctuation">,</span> deleteParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这段代码删除了用户名为“JohnDoe”的用户，并返回删除操作影响的行数。</p> 
<hr> 
<h4><a id="4__176"></a>4. 获取数据列表</h4> 
<p>DBHelper类还可以通过<code>GetDataSet</code>方法来返回一个包含查询结果的数据集（DataTable）。这个方法在需要处理大量数据时非常有用。</p> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">string</span></span> sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM Users WHERE UserName LIKE @UserName"</span><span class="token punctuation">;</span>
<span class="token class-name">SqlParameter<span class="token punctuation">[</span><span class="token punctuation">]</span></span> parameters <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlParameter</span><span class="token punctuation">(</span><span class="token string">"@UserName"</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> Value <span class="token operator">=</span> <span class="token string">"%Doe%"</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">DataTable</span> users <span class="token operator">=</span> DBHelper<span class="token punctuation">.</span><span class="token function">GetDataSet</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>通过上面的代码，我们可以获取用户名中包含“Doe”的所有用户的详细信息。</p> 
<hr> 
<h4><a id="5__191"></a>5. 获取单一结果</h4> 
<p>在实际开发中，我们经常需要执行统计查询，例如查询用户表中某个用户名的记录数。通过DBHelper类的<code>GetScalar</code>方法，我们可以轻松实现这一需求。</p> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">string</span></span> sql <span class="token operator">=</span> <span class="token string">"SELECT COUNT(*) FROM Users WHERE UserName = @UserName"</span><span class="token punctuation">;</span>
<span class="token class-name">SqlParameter<span class="token punctuation">[</span><span class="token punctuation">]</span></span> parameters <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlParameter</span><span class="token punctuation">(</span><span class="token string">"@UserName"</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> Value <span class="token operator">=</span> <span class="token string">"JohnDoe"</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">int</span></span> userCount <span class="token operator">=</span> DBHelper<span class="token punctuation">.</span><span class="token function">GetScalar</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>上述代码查询了名为“JohnDoe”的用户记录数量，并返回查询结果。</p> 
<hr> 
<h4><a id="6__207"></a>6. 逐行读取数据</h4> 
<p>在某些情况下，我们可能只需要逐行处理查询结果，而不需要将其全部加载到内存中。这时可以使用<code>GetReader</code>方法。</p> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">string</span></span> sql <span class="token operator">=</span> <span class="token string">"SELECT UserName, Password FROM Users WHERE UserName = @UserName"</span><span class="token punctuation">;</span>
<span class="token class-name">SqlParameter<span class="token punctuation">[</span><span class="token punctuation">]</span></span> parameters <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqlParameter</span><span class="token punctuation">(</span><span class="token string">"@UserName"</span><span class="token punctuation">,</span> SqlDbType<span class="token punctuation">.</span>VarChar<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> Value <span class="token operator">=</span> <span class="token string">"JohnDoe"</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name">SqlDataReader</span> reader <span class="token operator">=</span> DBHelper<span class="token punctuation">.</span><span class="token function">GetReader</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> parameters<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">string</span></span> userName <span class="token operator">=</span> reader<span class="token punctuation">[</span><span class="token string">"UserName"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> password <span class="token operator">=</span> reader<span class="token punctuation">[</span><span class="token string">"Password"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 处理数据</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这段代码逐行读取用户名为“JohnDoe”的用户信息，并逐行处理结果。</p> 
<hr> 
<h3><a id="DBHelper_231"></a>四、DBHelper类的优势</h3> 
<p>使用DBHelper类有以下几个显著优势：</p> 
<table><thead><tr><th>优势</th><th>描述</th></tr></thead><tbody><tr><td><strong>代码复用性高</strong></td><td>通过统一的封装，减少了数据库操作代码的重复编写，提高了代码的复用性。</td></tr><tr><td><strong>简洁易用</strong></td><td>DBHelper类提供了简单的接口，隐藏了复杂的ADO.NET操作，使得数据库操作更加简洁明了。</td></tr><tr><td><strong>安全性提升</strong></td><td>通过使用参数化查询，有效防止了SQL注入攻击，增强了系统的安全性。</td></tr><tr><td><strong>易于维护</strong></td><td>所有的数据库操作都集中在DBHelper类中，若需要修改数据库操作方式，只需修改该类中的方法即可。</td></tr></tbody></table> 
<p>相比于其他类似的数据库访问层封装工具，如Entity Framework和Dapper，DBHelper在灵活性和性能上具有一定优势，特别适合那些对性能有较高要求并且需要直接控制SQL的场景。下表对比了DBHelper与其他常见ORM框架的特点：</p> 
<table><thead><tr><th>特性</th><th>DBHelper</th><th>Entity Framework</th><th>Dapper</th></tr></thead><tbody><tr><td><strong>性能</strong></td><td>高</td><td>中等</td><td>高</td></tr><tr><td><strong>灵活性</strong></td><td>高</td><td>低</td><td>高</td></tr><tr><td><strong>易用性</strong></td><td>中等</td><td>高</td><td>中等</td></tr><tr><td><strong>学习曲线</strong></td><td>低</td><td>高</td><td>低</td></tr><tr><td><strong>LINQ支持</strong></td><td>不支持</td><td>支持</td><td>不支持</td></tr><tr><td><strong>复杂查询支持</strong></td><td>支持</td><td>支持</td><td>支持</td></tr><tr><td><strong>自动迁移</strong></td><td>不支持</td><td>支持</td><td>不支持</td></tr></tbody></table> 
<hr> 
<h3><a id="_256"></a>五、总结</h3> 
<p>本文介绍了如何使用DBHelper类封装数据库操作，以提高代码的可维护性和复用性。通过使用DBHelper类，开发者可以将注意力集中在业务逻辑上，而不是被繁琐的数据库操作细节所困扰。DBHelper在简化数据库操作的同时，也保证了较高的灵活性和性能，特别适合那些对数据库操作有较高要求的项目。希望通过本文的介绍，您能够掌握如何在项目中使用DBHelper类来简化和优化数据库操作，从而提升项目的开发效率和代码质量。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c52bdf6bef35f74af8409bfb2fb50632/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">前端练习小项目——包变脸的，老弟 ！</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/40f34f3f5279363a4928e12d7f94fd12/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">小程序的数据驱动和vue的双向绑定有何异同？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>