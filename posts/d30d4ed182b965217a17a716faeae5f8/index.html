<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于Python&#43;nodeWeb&#43;MongoDB的猫眼电影数据爬取并可视化分析展示系统 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/d30d4ed182b965217a17a716faeae5f8/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="基于Python&#43;nodeWeb&#43;MongoDB的猫眼电影数据爬取并可视化分析展示系统">
  <meta property="og:description" content="目录
实验三 数据库实现设计 1
一、实验目的 1
二、实验内容 1
3. 开展接口设计，其中包括外部接口、内部接口等。 2
5. 进行开展最重要的实现，数据库实现和界面实现。 2
三、实验要求： 2
四．设计流程和实现方案 2
1 引言 2
1.1 编写目的 2
1.2 背景 2
2.1功能 3
2.2性能 4
2.3 安全保密 4
3 运行环境 4
3.1硬件平台 5
3.2支持软件 5
3.3 数据库 5
4 软件设计 5
4.1 数据爬取模块 5
4.2 服务器搭建 9
4.3 电影数据展示 10
4.4 电影推荐 11
5 使用过程 12
5.1 启动服务器 12
5.3 电影推荐 14
一、实验目的">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-17T20:22:00+08:00">
    <meta property="article:modified_time" content="2024-04-17T20:22:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于Python&#43;nodeWeb&#43;MongoDB的猫眼电影数据爬取并可视化分析展示系统</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>目录<br> 实验三 数据库实现设计 1<br> 一、实验目的 1<br> 二、实验内容 1<br> 3. 开展接口设计，其中包括外部接口、内部接口等。 2<br> 5. 进行开展最重要的实现，数据库实现和界面实现。 2<br> 三、实验要求： 2<br> 四．设计流程和实现方案 2<br> 1 引言 2<br> 1.1 编写目的 2<br> 1.2 背景 2<br> 2.1功能 3<br> 2.2性能 4<br> 2.3 安全保密 4<br> 3 运行环境 4<br> 3.1硬件平台 5<br> 3.2支持软件 5<br> 3.3 数据库 5<br> 4 软件设计 5<br> 4.1 数据爬取模块 5<br> 4.2 服务器搭建 9<br> 4.3 电影数据展示 10<br> 4.4 电影推荐 11<br> 5 使用过程 12<br> 5.1 启动服务器 12<br> 5.3 电影推荐 14</p> 
<p>一、实验目的<br> 按照设计要求，把构件、类等组装成为最终可交付使用的信息系统工作。同时，功能的关键都是与数据库的连接，如何正确有效地连接到数据库，查找，添加，修改数据是此软件的关键，是各类数据库应用分析、开发、调试的全过程，并能以一个系统分析和设计员的身份参与项目，提高学生独立分析问题和解决问题的能力。<br> 二、实验内容<br> 1.采用何种方式连接数据库，使数据库能够尽可能的适用于系统，方便开发。目标是正确有效地连接到数据库，能够对数据库进行有效地查询，添加，修改，删除操作。<br> 2.开展类的实现，编写类的程序代码，并放入到构件之中。包括生成类、类属性代码和类操作代码等。<br> 3.开展接口设计，其中包括外部接口、内部接口等。<br> 4.实施数据结构实现，包括逻辑结构实现、物理结构实现、数据结构与程序代码的关系。<br> 5.进行开展最重要的实现，数据库实现和界面实现。<br> 6.最后实现或者集成子系统，按照设计要求，把子系统组装成为最终可交付使用的信息系统工作。<br> 三、实验要求：<br> 包括确定系统的实现结构，子系统、类和接口的实现，单元测试，系统集成等。具体要求是需要确定实现结构，然后再制定实现的迭代计划。接下来通过多次迭代实现各个子系统和每一个子系统中的类和接口，并进行单元测试。并把每次迭代的结果交进行系统集成，通过多次迭代完成实现最终系统。</p> 
<pre><code class="prism language-css">import re
import time
import random
import pymysql
import requests
from bs4 import BeautifulSoup
from fontTools.ttLib import TTFont
import mongodb
import mysqldb

head = <span class="token string">""</span>"
<span class="token property">Accept</span><span class="token punctuation">:</span>text/html<span class="token punctuation">,</span>application/xhtml+xml<span class="token punctuation">,</span>application/xml<span class="token punctuation">;</span>q=0.9<span class="token punctuation">,</span>image/webp<span class="token punctuation">,</span>image/apng<span class="token punctuation">,</span>*/*<span class="token punctuation">;</span>q=0.8
<span class="token property">Accept-Encoding</span><span class="token punctuation">:</span>gzip<span class="token punctuation">,</span> deflate<span class="token punctuation">,</span> br
<span class="token property">Accept-Language</span><span class="token punctuation">:</span>zh-CN<span class="token punctuation">,</span>zh<span class="token punctuation">;</span>q=0.8
<span class="token property">Cache-Control</span><span class="token punctuation">:</span>max-age=0
<span class="token property">Connection</span><span class="token punctuation">:</span>keep-alive
<span class="token property">Host</span><span class="token punctuation">:</span>maoyan.com
<span class="token property">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span>1
<span class="token property">Content-Type</span><span class="token punctuation">:</span>application/x-www-form-urlencoded<span class="token punctuation">;</span> charset=UTF-8
<span class="token property">User-Agent</span><span class="token punctuation">:</span>Mozilla/5.0 <span class="token punctuation">(</span>Windows NT 10.0<span class="token punctuation">;</span> WOW64<span class="token punctuation">)</span> AppleWebKit/537.36 <span class="token punctuation">(</span>KHTML<span class="token punctuation">,</span> like Gecko<span class="token punctuation">)</span> Chrome/59.0.3071.86 Safari/537.36
<span class="token string">""</span>"


def str_to_<span class="token function">dict</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">""</span>"
    构造请求头<span class="token punctuation">,</span>可以在不同函数里构造不同的请求头
    <span class="token selector">"""
    header_dict =</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    header = header.<span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    for h in <span class="token property">header</span><span class="token punctuation">:</span>
        h = h.<span class="token function">strip</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        if <span class="token property">h</span><span class="token punctuation">:</span>
            k<span class="token punctuation">,</span> v = h.<span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">,</span> 1<span class="token punctuation">)</span>
            header_dict[k] = v.<span class="token function">strip</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    return header_dict


def get_<span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">""</span>"
    获取电影详情页链接
    <span class="token string">""</span>"
    for i in <span class="token function">range</span><span class="token punctuation">(</span>150<span class="token punctuation">,</span> 300<span class="token punctuation">,</span> 30<span class="token punctuation">)</span><span class="token punctuation">:</span>

        # 随机一个时间间隔，random（） 返回0-1 的数<span class="token punctuation">,</span>以免IP地址被封
        time.<span class="token function">sleep</span><span class="token punctuation">(</span>random.<span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> * 4<span class="token punctuation">)</span>
        url = <span class="token string">'http://maoyan.com/films?showType=3&amp;yearId=13&amp;sortId=3&amp;offset='</span> + <span class="token function">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        host = <span class="token string">""</span>"<span class="token property">Referer</span><span class="token punctuation">:</span><span class="token property">http</span><span class="token punctuation">:</span>//maoyan.com/films?showType=3&amp;yearId=13&amp;sortId=3&amp;offset=0
        <span class="token selector">"""
        header = head + host
        headers = str_to_dict(header)
        response = requests.get(url=url, headers=headers)


        # soup = BeautifulSoup(html, 'html.parser')
        data_1 = soup.find_all('div',</span> <span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'channel-detail movie-item-title'</span><span class="token punctuation">}</span><span class="token selector">)
        data_2 = soup.find_all('div',</span> <span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'channel-detail channel-detail-orange'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        num = 0
        for item in <span class="token property">data_1</span><span class="token punctuation">:</span>
            num += 1
            time.<span class="token function">sleep</span><span class="token punctuation">(</span>10<span class="token punctuation">)</span>
            url_1 = item.<span class="token function">select</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>[0][<span class="token string">'href'</span>]
            if data_2[num - 1].get_<span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span> != <span class="token string">'暂无评分'</span><span class="token punctuation">:</span>
                url = <span class="token string">'http://maoyan.com'</span> + url_1
                for message in get_<span class="token function">message</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    # <span class="token function">print</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
                    # 向mysql 写数据
                    # to_<span class="token function">mysql</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
                    # 向mongo 写数据
                    to_<span class="token function">mymongo</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
                <span class="token function">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'---------------^^^Film_Message^^^-----------------'</span><span class="token punctuation">)</span>
            <span class="token property">else</span><span class="token punctuation">:</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'The Work Is Done'</span><span class="token punctuation">)</span>
                break


def get_<span class="token function">message</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">""</span>"
    获取电影详情页里的信息
    <span class="token selector">"""
    # time.sleep(10)
    time.sleep(random.random() * 4)
    data =</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    host = <span class="token string">""</span>"<span class="token property">refer</span><span class="token punctuation">:</span> <span class="token property">http</span><span class="token punctuation">:</span>//maoyan.com/news
    <span class="token selector">"""
    header = head + host
    headers = str_to_dict(header)
    response = requests.get(url=url, headers=headers)
    u = response.text
    # 破解猫眼文字反爬
    (maoyan_num_list, utf8last) = get_numbers(u)
    # 获取电影信息
    soup = BeautifulSoup(u, "html.parser")
    mw = soup.find_all('span',</span> <span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'stonefont'</span><span class="token punctuation">}</span><span class="token selector">)
    score = soup.find_all('span',</span> <span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'score-num'</span><span class="token punctuation">}</span><span class="token selector">)
    unit = soup.find_all('span',</span> <span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'unit'</span><span class="token punctuation">}</span><span class="token selector">)
    ell = soup.find_all('li',</span> <span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'ellipsis'</span><span class="token punctuation">}</span><span class="token selector">)
    name = soup.find_all('h3',</span> <span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'name'</span><span class="token punctuation">}</span><span class="token selector">)

    user = soup.find_all('span',</span> <span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'name'</span><span class="token punctuation">}</span><span class="token selector">)
    time_comment = soup.find_all('div',</span> <span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'time'</span><span class="token punctuation">}</span><span class="token selector">)
    score_start = soup.find_all('ul',</span> <span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'score-star clearfix'</span><span class="token punctuation">}</span><span class="token selector">)
    comment_approve = soup.find_all('span',</span> <span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'num'</span><span class="token punctuation">}</span><span class="token selector">)
    comment_content = soup.find_all('div',</span> <span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'comment-content'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    # <span class="token function">print</span><span class="token punctuation">(</span>time_comment[0].<span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span>.get_<span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    # 返回电影信息
    # _id +=1

    data[<span class="token string">"name"</span>] = name[0].get_<span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    data[<span class="token string">"type"</span>] = ell[0].get_<span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    data[<span class="token string">"country"</span>] = ell[1].get_<span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>.<span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>[0].<span class="token function">strip</span><span class="token punctuation">(</span><span class="token punctuation">)</span>.<span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    data[<span class="token string">"length"</span>] = ell[1].get_<span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>.<span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>[1].<span class="token function">strip</span><span class="token punctuation">(</span><span class="token punctuation">)</span>.<span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
    data[<span class="token string">"released"</span>] = ell[2].get_<span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>[<span class="token punctuation">:</span>10]

    # 因为会出现没有票房的电影<span class="token punctuation">,</span>所以这里需要判断
    if <span class="token property">unit</span><span class="token punctuation">:</span>
        bom = [<span class="token string">'分'</span><span class="token punctuation">,</span> score[0].get_<span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>.<span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>.<span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'万'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unit[0].get_<span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>]
        for i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>mw<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            moviewish = mw[i].get_<span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>.<span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
            moviewish = <span class="token function">str</span><span class="token punctuation">(</span>moviewish<span class="token punctuation">,</span> encoding=<span class="token string">'utf-8'</span><span class="token punctuation">)</span>
            # 通过比对获取反爬文字信息
            for j in <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>utf8last<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                moviewish = moviewish.<span class="token function">replace</span><span class="token punctuation">(</span>utf8last[j]<span class="token punctuation">,</span> maoyan_num_list[j]<span class="token punctuation">)</span>
            if i == 0<span class="token punctuation">:</span>
                data[<span class="token string">"score"</span>] = moviewish + bom[i]
            elif i == 1<span class="token punctuation">:</span>
                if <span class="token string">'万'</span> in <span class="token property">moviewish</span><span class="token punctuation">:</span>
                    data[<span class="token string">"people"</span>] = <span class="token function">int</span><span class="token punctuation">(</span><span class="token function">float</span><span class="token punctuation">(</span>moviewish.<span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'万'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span> * 10000<span class="token punctuation">)</span>
                <span class="token property">else</span><span class="token punctuation">:</span>
                    data[<span class="token string">"people"</span>] = <span class="token function">int</span><span class="token punctuation">(</span><span class="token function">float</span><span class="token punctuation">(</span>moviewish<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token property">else</span><span class="token punctuation">:</span>
                if <span class="token string">'万'</span> == bom[i]<span class="token punctuation">:</span>
                    data[<span class="token string">"box_office"</span>] = <span class="token function">int</span><span class="token punctuation">(</span><span class="token function">float</span><span class="token punctuation">(</span>moviewish<span class="token punctuation">)</span> * 10000<span class="token punctuation">)</span>
                <span class="token property">else</span><span class="token punctuation">:</span>
                    data[<span class="token string">"box_office"</span>] = <span class="token function">int</span><span class="token punctuation">(</span><span class="token function">float</span><span class="token punctuation">(</span>moviewish<span class="token punctuation">)</span> * 100000000<span class="token punctuation">)</span>
    <span class="token property">else</span><span class="token punctuation">:</span>
        bom = [<span class="token string">'分'</span><span class="token punctuation">,</span> score[0].get_<span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>.<span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>.<span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'万'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 0]
        for i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>mw<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            moviewish = mw[i].get_<span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>.<span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
            moviewish = <span class="token function">str</span><span class="token punctuation">(</span>moviewish<span class="token punctuation">,</span> encoding=<span class="token string">'utf-8'</span><span class="token punctuation">)</span>
            for j in <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>utf8last<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                moviewish = moviewish.<span class="token function">replace</span><span class="token punctuation">(</span>utf8last[j]<span class="token punctuation">,</span> maoyan_num_list[j]<span class="token punctuation">)</span>
            if i == 0<span class="token punctuation">:</span>
                data[<span class="token string">"score"</span>] = moviewish + bom[i]
            <span class="token property">else</span><span class="token punctuation">:</span>
                if <span class="token string">'万'</span> in <span class="token property">moviewish</span><span class="token punctuation">:</span>
                    data[<span class="token string">"people"</span>] = <span class="token function">int</span><span class="token punctuation">(</span><span class="token function">float</span><span class="token punctuation">(</span>moviewish.<span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'万'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">)</span> * 10000<span class="token punctuation">)</span>
                <span class="token property">else</span><span class="token punctuation">:</span>
                    data[<span class="token string">"people"</span>] = <span class="token function">int</span><span class="token punctuation">(</span><span class="token function">float</span><span class="token punctuation">(</span>moviewish<span class="token punctuation">)</span><span class="token punctuation">)</span>
        data[<span class="token string">"box_office"</span>] = bom[2]

    # 在最后添加用户评论
    # data[<span class="token string">"user"</span>] = []
    # data[<span class="token string">"time_comment"</span>] = []
    # data[<span class="token string">"score_start"</span>] = []
    # data[<span class="token string">"comment_approve"</span>] = []
    # data[<span class="token string">"comment_content"</span>] = []
    #
    # numbre = <span class="token function">len</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    # for i in <span class="token function">range</span><span class="token punctuation">(</span>numbre<span class="token punctuation">)</span><span class="token punctuation">:</span>
    #     data[<span class="token string">"user"</span>].<span class="token function">append</span><span class="token punctuation">(</span>user[i].get_<span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    #     data[<span class="token string">"time_comment"</span>].<span class="token function">append</span><span class="token punctuation">(</span>time_comment[i].<span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span>.get_<span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    #     data[<span class="token string">"score_start"</span>].<span class="token function">append</span><span class="token punctuation">(</span>score_start[i].<span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'data-score'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    #     data[<span class="token string">"comment_approve"</span>].<span class="token function">append</span><span class="token punctuation">(</span>comment_approve[i].get_<span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    #     data[<span class="token string">"comment_content"</span>].<span class="token function">append</span><span class="token punctuation">(</span>comment_content[i].get_<span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    yield data


def to_<span class="token function">mysql</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">""</span>"
    信息写入mysql
    <span class="token string">""</span>"
    # 创建猫眼数据库<span class="token punctuation">,</span>输入你mysql 数据库的用户名，和密码<span class="token punctuation">,</span>创建maoyao 数据库
    maoyandb = <span class="token function">mysqldb</span><span class="token punctuation">(</span>user=<span class="token string">'root'</span><span class="token punctuation">,</span> password=<span class="token string">'111111'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    table1 = <span class="token string">'films'</span>
    # table2 = <span class="token string">'users'</span>
    keys = <span class="token string">', '</span>.<span class="token function">join</span><span class="token punctuation">(</span>data.<span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    # keys = <span class="token string">'name,type,country,length,released,score,people,box office'</span>
    # values1=<span class="token string">'%s'</span>
    values = <span class="token string">', '</span>.<span class="token function">join</span><span class="token punctuation">(</span>[<span class="token string">'%s'</span>] * <span class="token function">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    db = pymysql.<span class="token function">connect</span><span class="token punctuation">(</span>host=<span class="token string">'localhost'</span><span class="token punctuation">,</span> user=<span class="token string">'root'</span><span class="token punctuation">,</span> password=<span class="token string">'111111'</span><span class="token punctuation">,</span> port=3306<span class="token punctuation">,</span> db=<span class="token string">'maoyan'</span><span class="token punctuation">)</span>

    cursor = db.<span class="token function">cursor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    sql = <span class="token selector">'INSERT INTO</span> <span class="token punctuation">{<!-- --></span>table<span class="token punctuation">}</span><span class="token selector">(</span><span class="token punctuation">{<!-- --></span>keys<span class="token punctuation">}</span><span class="token selector">) VALUES (</span><span class="token punctuation">{<!-- --></span>values<span class="token punctuation">}</span><span class="token punctuation">)</span>'.<span class="token function">format</span><span class="token punctuation">(</span>table=table1<span class="token punctuation">,</span> keys=keys<span class="token punctuation">,</span> values=values<span class="token punctuation">)</span>
    # sql1 = <span class="token selector">'INSERT INTO</span> <span class="token punctuation">{<!-- --></span>table<span class="token punctuation">}</span> <span class="token selector">VALUES (</span><span class="token punctuation">{<!-- --></span>values<span class="token punctuation">}</span><span class="token punctuation">)</span>'.<span class="token function">format</span><span class="token punctuation">(</span>table=table1<span class="token punctuation">,</span> keys=keys<span class="token punctuation">,</span> values=values<span class="token punctuation">)</span>
    <span class="token property">try</span><span class="token punctuation">:</span>
        if cursor.<span class="token function">execute</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token function">tuple</span><span class="token punctuation">(</span>data.<span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Successful"</span><span class="token punctuation">)</span>
            db.<span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token property">except</span><span class="token punctuation">:</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Failed'</span><span class="token punctuation">)</span>
        db.<span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    db.<span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


def to_<span class="token function">mymongo</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    # 已经连接到MongoDB数据库了
    # dbname 数据库名字，collectionName 电影表
    dbname = <span class="token string">'maoyan'</span>
    collectionName = <span class="token string">'testmaoyan'</span>
    db = mongodb.<span class="token function">mongoDB</span><span class="token punctuation">(</span>dbname<span class="token punctuation">,</span> collectionName<span class="token punctuation">)</span>

    # 使用默认_id
    item = db.process_<span class="token function">item</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> True<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>


def get_<span class="token function">numbers</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">""</span>"
    对猫眼的文字反爬进行破解
    <span class="token string">""</span>"
    cmp = re.<span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">",\n           url\('(//.*.woff)'\) format\('woff'\)"</span><span class="token punctuation">)</span>
    rst = cmp.<span class="token function">findall</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span>
    ttf = requests.<span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"http:"</span> + rst[0]<span class="token punctuation">,</span> stream=True<span class="token punctuation">)</span>
    with <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"maoyan.woff"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> as <span class="token property">pdf</span><span class="token punctuation">:</span>
        for chunk in ttf.iter_<span class="token function">content</span><span class="token punctuation">(</span>chunk_size=1024<span class="token punctuation">)</span><span class="token punctuation">:</span>
            if <span class="token property">chunk</span><span class="token punctuation">:</span>
                pdf.<span class="token function">write</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
    base_font = <span class="token function">TTFont</span><span class="token punctuation">(</span><span class="token string">'base.woff'</span><span class="token punctuation">)</span>
    maoyanFont = <span class="token function">TTFont</span><span class="token punctuation">(</span><span class="token string">'maoyan.woff'</span><span class="token punctuation">)</span>
    maoyan_unicode_list = maoyanFont[<span class="token string">'cmap'</span>].tables[0].ttFont.<span class="token function">getGlyphOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    maoyan_num_list = []
    base_num_list = [<span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token string">'6'</span>]
    # base_unicode_list = [<span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'uniF561'</span><span class="token punctuation">,</span> <span class="token string">'uniE6E1'</span><span class="token punctuation">,</span> <span class="token string">'uniF125'</span><span class="token punctuation">,</span> <span class="token string">'uniF83F'</span><span class="token punctuation">,</span> <span class="token string">'uniE9E2'</span><span class="token punctuation">,</span> <span class="token string">'uniEEA6'</span><span class="token punctuation">,</span> <span class="token string">'uniEEC2'</span><span class="token punctuation">,</span> <span class="token string">'uniED38'</span><span class="token punctuation">,</span> <span class="token string">'uniE538'</span><span class="token punctuation">,</span> <span class="token string">'uniF8E7'</span>]
    base_unicode_list = [<span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'uniF849'</span><span class="token punctuation">,</span> <span class="token string">'uniE581'</span><span class="token punctuation">,</span> <span class="token string">'uniF178'</span><span class="token punctuation">,</span> <span class="token string">'uniF533'</span><span class="token punctuation">,</span>
                         <span class="token string">'uniEC0F'</span><span class="token punctuation">,</span> <span class="token string">'uniED67'</span><span class="token punctuation">,</span> <span class="token string">'uniEF38'</span><span class="token punctuation">,</span> <span class="token string">'uniE223'</span><span class="token punctuation">,</span> <span class="token string">'uniF7C6'</span><span class="token punctuation">,</span> <span class="token string">'uniF89D'</span>]
    for i in <span class="token function">range</span><span class="token punctuation">(</span>1<span class="token punctuation">,</span> 12<span class="token punctuation">)</span><span class="token punctuation">:</span>
        maoyan_glyph = maoyanFont[<span class="token string">'glyf'</span>][maoyan_unicode_list[i]]
        for j in <span class="token function">range</span><span class="token punctuation">(</span>11<span class="token punctuation">)</span><span class="token punctuation">:</span>
            base_glyph = base_font[<span class="token string">'glyf'</span>][base_unicode_list[j]]
            if maoyan_glyph == <span class="token property">base_glyph</span><span class="token punctuation">:</span>
                maoyan_num_list.<span class="token function">append</span><span class="token punctuation">(</span>base_num_list[j]<span class="token punctuation">)</span>
                break
    maoyan_unicode_list[1] = <span class="token string">'uni0078'</span>
    utf8List = [<span class="token function">eval</span><span class="token punctuation">(</span>r<span class="token string">"'\u"</span> + uni[3<span class="token punctuation">:</span>] + <span class="token string">"'"</span><span class="token punctuation">)</span>.<span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span> for uni in maoyan_unicode_list[1<span class="token punctuation">:</span>]]
    utf8last = []
    for i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>utf8List<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        utf8List[i] = <span class="token function">str</span><span class="token punctuation">(</span>utf8List[i]<span class="token punctuation">,</span> encoding=<span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        utf8last.<span class="token function">append</span><span class="token punctuation">(</span>utf8List[i]<span class="token punctuation">)</span>
    return <span class="token punctuation">(</span>maoyan_num_list<span class="token punctuation">,</span> utf8last<span class="token punctuation">)</span>


def <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time.<span class="token function">sleep</span><span class="token punctuation">(</span>random.<span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> * 3<span class="token punctuation">)</span>
    get_<span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


if __name__ == <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/a8/32/u5vErNus_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/09/e3/Gtkmt2E3_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c5/3b/0yzKzEo2_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e2/d3/ixDYtX8P_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/07/d3/m3kRC7tv_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3c/b4/A0Q4hxLk_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/60/87/zTUZpLH3_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8b/8a/B5FyDVgO_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/49/90/2eZJzbwf_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/9a/e4/7bniFYXR_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/fd/9d/djYC9217_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/74/52/fo0Y5bmK_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/68/1f/PvBDQ9Dr_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b0/c7/oyxrhWRh_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/40/81/lo5LM2ka_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c8/fb/J8E0qWWm_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0a/1f/L7DEkzRG_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ad/61/zyMyjDQA_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ff/76/aopOYqfr_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/63/4b/EIg7VxO5_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/95/76/kkkhfNQR_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/78/c4/mJPoSn6U_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/49/70/mEbnmggV_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/05/bd/ZxFmlrnf_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b8/c4/WBikcFm3_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3a/17/u26ib9DM_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/2a/6b/ZO5TQrIl_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/77/44/0sxZqDRR_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/eb/15/hs3e7Oxc_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f0/f0/uxDk9xiS_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b2/53/n4fyjfDY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/10/83/J5jFX9vv_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0d/7e/IuXRytYU_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/90dc22a604240e5636435d6adccefb3c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用SpringBoot将中国地震台网数据保存PostGIS数据库实践</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b61f793df1409c1c2b19bcaa7d892fef/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">一篇文章详细介绍Stable Diffusion模型原理及实现过程(附常用模型网站、下载方式)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>