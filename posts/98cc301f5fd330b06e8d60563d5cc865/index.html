<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MYSQL原理、设计与应用 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/98cc301f5fd330b06e8d60563d5cc865/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="MYSQL原理、设计与应用">
  <meta property="og:description" content="概述 数据库(Database，DB)是按照数据结构来组织、存储和管理数据的仓库，其本身可被看作电子化的文件柜，用户可以对文件中的数据进行增删改查等操作。
数据库系统是指在计算机系统中引入数据库后的系统，除了数据库，还包括数据库管理系统(Database Management System，DBMS)、数据库应用程序。
数据库技术的发展 🐬人工管理阶段
数据不在计算机中长期保存没有专门的数据管理软件，数据需要应用程序自己管理数据是面向应用程序的，不同的应用程序之间无法共享数据数据不具有独立性，完全依赖于应用程序 🐬文件系统阶段
数据可以在计算机外存设备上长期保存，可以对数据反复进行操作通过文件系统管理数据，文件系统提供了文件管理功能和存取方法在一定程度上实现了数据独立性和共享性，但非常的薄弱 🐬数据库系统阶段
数据结构化数据共享数据独立性高数据统一管理与控制 三级模式 美国国家标准协会(American National Standards Institute，ANSI)所属的标准计划与需求委员会(Standards Planning and Requirements Committee，SPARC)在1971年公布的研究报告中提出了 ANSI-SPARC体系结构，即三级模式结构(或三层体系结构)。
ANSI-SPARC最终没有成为正式标准，但它仍然是理解数据库管理系统的基础。
三级模式是指数据库管理系统从三个层次来管理数据，分别是外部层(External Level)、概念层(Conceptual Level)和内部层(Internal Level)。
这三个层次分别对应三种不同的模式，分别是外模式、概念模式和内模式。
在外模式与概念模式之间，以及概念模式与内模式之间，还存在映像，即二级映像。
外模式面向应用程序，描述用户的数据视图；内模式(又称物理模式、存储模式)面向物理上的数据库，描述数据在磁盘中如何存储；概念模式(又称为模式、逻辑模式)面向数据库设计人员，描述数据的整体逻辑结构。
由于三级模式比较抽象，为了好理解，假设有一个电子表格来保存商品信息表，如下：
🐬概念模式
概念模式类似于表格的列标题，他描述了商品表中包含哪些信息。
概念模式在数据库中描述的信息还有很多，如多张表之间的联系，表中每一列的数据类型和长度等。
🐬内模式
Excel表格另存为文件时，可以选择保存的文件路径、保存类型等，这些与存储想关的描述信息相当于内模式。
在数据库中内模式描述数据的物理结构和存储方式，如堆文件、索引文件、散列(Hash)文件等。
🐬外模式
在打开一个电子表格会显示表格中全部的数据，将数据提供给用户时，出于权限，安全控制等因素考虑，只允许用户看到一部分数据，或不同用户看到不同的数据，这样的需求就可以用视图来实现。视图和基本表的关系如下：
基本表中的数据是实际储存在数据库中的，而视图中的数据是查询或计算出来的。由此可见，外模式可以为不同的用户需求创建不同的视图，由于不同的用户需求不同，数据显示方式也会多种多样。
一个数据库中会有多个外模式，而概念模式和内模式则只有一个
二级映像 三级模式是数据的三个抽象级别，每个级别关系的重点不同。为了使三级模式之间产生关联，数据库管理系统在三级模式之间提供了二级映像功能。
二级映像是一种规则，它规定了映像双方如何进行转换。通过二级映像，体现了逻辑和物理两个层面的数据独立性。
🐬逻辑独立性
外模式/概念模式映像体现了逻辑独立性。逻辑独立性是指当修改了概念模式，不影响上一层的外模式。
例如，将表库存和销量拆分到另一张表中，此时概念模式发生了更改，但可以通过改变外模式/概念模式的映像，继续为用户提供原有视图。
由此可见，逻辑独立性能够让使用视图的用户感觉不到基本表的改变。
🐬物理独立性
概念模式/内模式映像体现了物理独立性。物理独立性是指修改了内模式，不影响上层的概念模式和外模式。
例如，在 Excel 中将 .xls 文件另存为 .xlsx 文件，虽然文件格式变了，但打开文件后显示的表格内容一般不会发生改变。
在数据中，更换了更先进的存储结构，或者创建索引来加快查询速度，内模式会发生改变。此时，只需要改变概念模式/内模式映像，就不会影响到原有的概念模式。
物理独立性使得用户不必了解数据库内部的存储原理，即可正常使用数据库来保存数据。数据库管理系统会自动将用户的操作转换成物理级数据库的操作。
数据库相关的人员 数据库系统涉及一些人员，主要包括数据库管理员(Database Administrator,DBA)、应用程序员(Application Programmer)和最终用户(End User)。
🐬数据库管理员
数据库管理员负责管理和维护数据库，参与数据库的设计、测试和部暑。
🐬应用程序员
应用程序员负责为最终用户设计和编写程序，并进行调试和安装，以便最终用户利用应用程序来对数据库进行存取操作。
🐬最终用户">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-05-15T22:18:52+08:00">
    <meta property="article:modified_time" content="2023-05-15T22:18:52+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MYSQL原理、设计与应用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/ff/45/fUeixfM0_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/bd/64/y2O4ZzeD_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_2"></a>概述</h3> 
<p>数据库(Database，DB)是按照数据结构来组织、存储和管理数据的仓库，其本身可被看作电子化的文件柜，用户可以对文件中的数据进行增删改查等操作。</p> 
<p>数据库系统是指在计算机系统中引入数据库后的系统，除了数据库，还包括数据库管理系统(Database Management System，DBMS)、数据库应用程序。</p> 
<p><img src="https://images2.imgbox.com/b7/40/J6t0vQua_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_9"></a>数据库技术的发展</h3> 
<p>🐬<strong>人工管理阶段</strong></p> 
<ul><li>数据不在计算机中长期保存</li><li>没有专门的数据管理软件，数据需要应用程序自己管理</li><li>数据是面向应用程序的，不同的应用程序之间无法共享数据</li><li>数据不具有独立性，完全依赖于应用程序</li></ul> 
<p>🐬<strong>文件系统阶段</strong></p> 
<ul><li>数据可以在计算机外存设备上长期保存，可以对数据反复进行操作</li><li>通过文件系统管理数据，文件系统提供了文件管理功能和存取方法</li><li>在一定程度上实现了数据独立性和共享性，但非常的薄弱</li></ul> 
<p>🐬<strong>数据库系统阶段</strong></p> 
<ul><li>数据结构化</li><li>数据共享</li><li>数据独立性高</li><li>数据统一管理与控制</li></ul> 
<p><img src="https://images2.imgbox.com/0d/d0/7RrREiuM_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_33"></a>三级模式</h3> 
<p>美国国家标准协会(American National Standards Institute，ANSI)所属的标准计划与需求委员会(Standards Planning and Requirements Committee，SPARC)在1971年公布的研究报告中提出了 ANSI-SPARC体系结构，即三级模式结构(或三层体系结构)。</p> 
<p>ANSI-SPARC最终没有成为正式标准，但它仍然是理解数据库管理系统的基础。</p> 
<p>三级模式是指数据库管理系统从三个层次来管理数据，分别是外部层(External Level)、概念层(Conceptual Level)和内部层(Internal Level)。</p> 
<p>这三个层次分别对应三种不同的模式，分别是外模式、概念模式和内模式。</p> 
<p>在外模式与概念模式之间，以及概念模式与内模式之间，还存在映像，即二级映像。</p> 
<p><img src="https://images2.imgbox.com/46/11/kgvoV8xD_o.png" alt="在这里插入图片描述"></p> 
<p>外模式面向应用程序，描述用户的数据视图；内模式(又称物理模式、存储模式)面向物理上的数据库，描述数据在磁盘中如何存储；概念模式(又称为模式、逻辑模式)面向数据库设计人员，描述数据的整体逻辑结构。</p> 
<p>由于三级模式比较抽象，为了好理解，假设有一个电子表格来保存商品信息表，如下：</p> 
<p><img src="https://images2.imgbox.com/1b/f6/x5wBxJfN_o.png" alt="在这里插入图片描述"><br> 🐬<strong>概念模式</strong></p> 
<p>概念模式类似于表格的列标题，他描述了商品表中包含哪些信息。</p> 
<p>概念模式在数据库中描述的信息还有很多，如多张表之间的联系，表中每一列的数据类型和长度等。</p> 
<p>🐬<strong>内模式</strong></p> 
<p>Excel表格另存为文件时，可以选择保存的文件路径、保存类型等，这些与存储想关的描述信息相当于内模式。</p> 
<p>在数据库中内模式描述数据的物理结构和存储方式，如堆文件、索引文件、散列(Hash)文件等。</p> 
<p>🐬<strong>外模式</strong></p> 
<p>在打开一个电子表格会显示表格中全部的数据，将数据提供给用户时，出于权限，安全控制等因素考虑，只允许用户看到一部分数据，或不同用户看到不同的数据，这样的需求就可以用视图来实现。视图和基本表的关系如下：</p> 
<p><img src="https://images2.imgbox.com/57/3c/fzeJXVv8_o.png" alt="在这里插入图片描述"></p> 
<p>基本表中的数据是实际储存在数据库中的，而视图中的数据是查询或计算出来的。由此可见，外模式可以为不同的用户需求创建不同的视图，由于不同的用户需求不同，数据显示方式也会多种多样。</p> 
<blockquote> 
 <p>一个数据库中会有多个外模式，而概念模式和内模式则只有一个</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/1d/0c/9FQXquhq_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_76"></a>二级映像</h3> 
<p>三级模式是数据的三个抽象级别，每个级别关系的重点不同。为了使三级模式之间产生关联，数据库管理系统在三级模式之间提供了二级映像功能。</p> 
<p>二级映像是一种规则，它规定了映像双方如何进行转换。通过二级映像，体现了逻辑和物理两个层面的数据独立性。</p> 
<p>🐬<strong>逻辑独立性</strong></p> 
<p>外模式/概念模式映像体现了逻辑独立性。逻辑独立性是指当修改了概念模式，不影响上一层的外模式。</p> 
<p>例如，将表库存和销量拆分到另一张表中，此时概念模式发生了更改，但可以通过改变外模式/概念模式的映像，继续为用户提供原有视图。</p> 
<p><img src="https://images2.imgbox.com/a2/17/53qsBe8t_o.png" alt="在这里插入图片描述"></p> 
<p>由此可见，逻辑独立性能够让使用视图的用户感觉不到基本表的改变。</p> 
<p>🐬<strong>物理独立性</strong></p> 
<p>概念模式/内模式映像体现了物理独立性。物理独立性是指修改了内模式，不影响上层的概念模式和外模式。</p> 
<p>例如，在 Excel 中将 .xls 文件另存为 .xlsx 文件，虽然文件格式变了，但打开文件后显示的表格内容一般不会发生改变。</p> 
<p>在数据中，更换了更先进的存储结构，或者创建索引来加快查询速度，内模式会发生改变。此时，只需要改变概念模式/内模式映像，就不会影响到原有的概念模式。</p> 
<p>物理独立性使得用户不必了解数据库内部的存储原理，即可正常使用数据库来保存数据。数据库管理系统会自动将用户的操作转换成物理级数据库的操作。</p> 
<p><img src="https://images2.imgbox.com/d3/00/vuWta7qE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_103"></a>数据库相关的人员</h3> 
<p>数据库系统涉及一些人员，主要包括数据库管理员(Database Administrator,DBA)、应用程序员(Application Programmer)和最终用户(End User)。</p> 
<p>🐬<strong>数据库管理员</strong></p> 
<p>数据库管理员负责管理和维护数据库，参与数据库的设计、测试和部暑。</p> 
<p>🐬<strong>应用程序员</strong></p> 
<p>应用程序员负责为最终用户设计和编写程序，并进行调试和安装，以便最终用户利用应用程序来对数据库进行存取操作。</p> 
<p>🐬<strong>最终用户</strong></p> 
<p>最终用户一般为非计算机专业人员，通过应用程序访问数据库。</p> 
<p><img src="https://images2.imgbox.com/e6/a7/xAP9pzjV_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_121"></a>数据模型</h3> 
<p><img src="https://images2.imgbox.com/8e/36/AMeJwA0a_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_124"></a>数据建模</h4> 
<p>数据建模是对现实世界中的各类数据的抽象组织，以确定数据库的管辖范围、数据的组织形式等。</p> 
<p>数据建模大致分为3个阶段，分别是概念建模阶段、逻辑建模阶段、物理建模阶段，相应的产物分别是概念模型、逻辑模型和物理模型。</p> 
<p><img src="https://images2.imgbox.com/7f/40/30ME4Fo8_o.png" alt="在这里插入图片描述"></p> 
<p>概念模型是现实世界到机器世界的中间层，它将现实世界中的客观对象(如学生、班级、课程）抽象成信息世界的数据。</p> 
<p>逻辑模型是指数据的逻辑结构，可以选择层次模型、网状模型或关系模型。</p> 
<p>在完成逻辑模型后，最后使用物理模型描述数据如何进行实际存储，也就是将逻辑模型转换成计算机能够识别的模型。</p> 
<p><img src="https://images2.imgbox.com/86/58/ibqNpSMb_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_141"></a>概念模型的术语</h4> 
<p>在概念模型中可以通过一些术语来对现实世界进行抽象。</p> 
<p>🐬<strong>实体</strong></p> 
<p>实体(Entity)是指客观存在并可相互区分的事物，如学生、班级、课程。</p> 
<p>🐬<strong>属性</strong></p> 
<p>属性(Attribute)是指实体所具有的某一特性，一个实体可以由若干个属性来描述。</p> 
<p>例如，学生实体的属性有学号、学生姓名和学生性别。属性由两部分组成，分别是属性名和属性值。</p> 
<p>🐬<strong>联系</strong></p> 
<p>联系(Relationship)是指实体与实体之间的联系，有一对一、一对多、对多对三种情况。</p> 
<p>例如，每个学生都有一个学生证，学生和学生证之间是一对一的联系；一个班级有多个学生，班级和学生是一对多的联系；一个学生可以选修多门课程，一门课程又可以被多个学生选修，学生和课程之间就形成了多对多的联系。</p> 
<p>🐬<strong>实体型</strong></p> 
<p>实体型(EntityType)即实体类型，通过实体名(如学生)及其属性名集合(如“学号、学生姓名、学生性别”)来抽象描述同类实体。</p> 
<p>🐬<strong>实体集</strong></p> 
<p>实体集(Entity Set)是指同一类型的实体集合，如全校学生就是一个实体集。</p> 
<p><img src="https://images2.imgbox.com/93/d3/AbBBBtwT_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="ER_170"></a>E-R图</h4> 
<p>E-R图也称为实体-联系图(Entity Relationship Diagram)，是一种用图形表示的实体联系模型，由Peter Chen于1976年提出。</p> 
<p>E-R图提供了表示实体型、属性和联系的方法，用来描述现实世界的概念模型。其通用的表示方式如下:</p> 
<p><strong>实体：</strong> 用矩形框表示，将实体名写在框内。</p> 
<p><strong>属性：</strong> 用椭圆框表示，将属性名写在框内，用连线将实体与属性连接。</p> 
<p><strong>联系：</strong> 用菱形框表示，将联系名写在框内，用连线将相关的实体连接，并在连线旁标注联系类型(一 0 对 一 “1：1”、一对多 “1：n”、多对多 “n：m”)。</p> 
<p><img src="https://images2.imgbox.com/bd/a1/X4j90Gn1_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_184"></a>关系模型</h4> 
<p>关系模型由IBM公司研究员 Edgar Frank Codd 于1970年发表的论文中提出，经过多年的发展，已经成为目前最常用、最重要的模型之一。在关系模型中有一些基本的概念。</p> 
<p>🐬<strong>关系</strong></p> 
<p>关系(Relation)一词与数学领域有关，它是集合基础上的一个重要的概念，用于反映元素之间的联系和性质。</p> 
<p>从用户角度来看，关系模型的数据结构是二维表，即通过二维表来组织数据。一个关系对应一张二维表，表中的数据包括实体本身的数据和实体间的联系。</p> 
<p>🐬<strong>属性</strong></p> 
<p>二维表中的列称为属性(Attribute)，每个属性都有一个属性名。</p> 
<p>🐬<strong>元组</strong></p> 
<p>二维表中的每一行数据称为一个元组(Tuple)。</p> 
<blockquote> 
 <p>根据不同的习惯，属性也可以称为字段(Field），元组也可以称为记录(Record)。</p> 
</blockquote> 
<p>🐬<strong>域</strong></p> 
<p>域(Domain)是指属性的取值范围。</p> 
<p>🐬<strong>关系模式</strong></p> 
<p>关系模式(Relation Schema)是关系的描述，通常可以简记为“关系名（属性1，属性2，…，属性n)。</p> 
<p>🐬<strong>键</strong></p> 
<p>在二维表中，若要唯一标识某一条记录，需要用到键（又称为关键字、码）。</p> 
<p><img src="https://images2.imgbox.com/3c/92/arw8YK1V_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_217"></a>关系模型的完整性</h4> 
<p>为了保证数据库中数据的正确性和相容性，需要对关系模型进行完整性约束。完整性通常包括实体完整性、参照完整性和用户自定义完整性。</p> 
<p>🐬<strong>实体完整性</strong></p> 
<p>实体完整性要求关系中的主键不能重复，且不能取空值。</p> 
<p>空值是指不知道、不存在或无意义的值。</p> 
<p>由于关系中的元组对应现实世界中互相之间可区分的个体，这些个体使用主键来唯一标识，若主键为空或重复，则无法唯一标识每个个体。</p> 
<p>🐬<strong>参照完整性</strong></p> 
<p>参照完整性要求关系中的外键要么取空值，要么取被参照关系中的某个元组的主键值。</p> 
<p>例如，通过学生所属的班级号可以找到对应的班级，这就符合参照完整性；而如果对应的班级被删除了，学生通过班级号找不到班级，就不符合参照完整性。</p> 
<p>🐬<strong>用户自定义完整性</strong></p> 
<p>用户自定义完整性是用户针对具体的应用环境定义的完整性约束条件，由DBMS检查用户自定义的完整性</p> 
<p><img src="https://images2.imgbox.com/5b/d2/bAQtG4Xk_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_241"></a>关系运算</h3> 
<p>关系模型可以使用关系代数(Relational Algebra)来进行关系运算。关系代数是一种抽象的查询语言，是研究关系模型的数学工具。关系代数运算符主要包括并、差、交、笛卡儿积、选择、投影、连接和除。</p> 
<p><img src="https://images2.imgbox.com/31/e5/6rlSB8Y0_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_246"></a>并、差、交</h4> 
<p>并(Union)、差(Difference)、交(Intersection)运算要求参与运算的两个关系具有相同数量的属性，其运算结果是一个具有相同数量属性的新关系。</p> 
<p><img src="https://images2.imgbox.com/cb/23/mLVOMMah_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/56/e6/zMryC6w0_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_253"></a>笛卡尔积</h4> 
<p><img src="https://images2.imgbox.com/d4/1c/ot7cx3s5_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/af/0f/ZCUMoEfB_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_258"></a>选择、投影</h4> 
<p>选择(Selection)是在一个关系中将满足条件的元组找出来，即水平方向筛选。</p> 
<p>投影(Projection)是在一个关系中去掉不需要的属性，保留需要的属性，即垂直方向筛选。</p> 
<p><img src="https://images2.imgbox.com/71/d9/Y6L0uOiP_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/46/af/mqXsvk0B_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_268"></a>连接</h4> 
<p>连接是在两个关系的笛卡儿积中选取属性间满足一定条件的元组。</p> 
<p>由于笛卡儿积的结果可能会包含很多没有意义的元组，所以相比之下连接运算更为实用。</p> 
<p>常用的连接方式有等值连接(Equi-Join)和自然连接(Natural Join)。</p> 
<p>自然连接是一种特殊的等值连接，要求R和S必须有相同的属性组，进行等值连接后再去除重复的属性组。</p> 
<p><img src="https://images2.imgbox.com/ca/b6/ltda917N_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_279"></a>除</h4> 
<p>如果把笛卡儿积看作乘法运算，则除法是笛卡儿积的逆运算。</p> 
<p><img src="https://images2.imgbox.com/47/54/PXMObwwh_o.png" alt="在这里插入图片描述"><br> R÷S1 表示查询学号为2的学生所选的课程；R÷S2 表示查询学号为2和3的学生共同选择的课程。</p> 
<p><img src="https://images2.imgbox.com/a2/c4/KDUPQYe2_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="SQL_288"></a>SQL语言</h3> 
<p>SQL (Structured Query Language,结构化查询语言) 是一种数据库查询语言和程序设计语言，主要用于管理数据库中的数据，如存取数据、查询数据、更新数据等。</p> 
<p>SQL是IBM公司于1975-1979年开发出来的，在20世纪80年代，SQL被美国国家标准学会（ANSI）和国际标准化组织（International Organization for Standardization,ISO）定义为关系数据库语言的标准。</p> 
<p>SQL是由4部分组成的。</p> 
<p>🐬<strong>数据定义语言</strong></p> 
<p>数据库定义语言(Data Definition Language,DDL)主要用于定义数据库、表等。</p> 
<p>例如，CREATE语句用于创建数据库、数据表等，ALTER语句用于修改表的定义等，DROP语句用于删除数据库、删除表等。</p> 
<p>🐬<strong>数据操作语言</strong></p> 
<p>数据操作语言(Data Manipulation Language,DML)主要用于对数据库进行添加、修改和删除操作。</p> 
<p>例如，INSERT语句用于插入数据，UPDATE语句用于修改数据，DELETE语句用于删除数据。</p> 
<p>🐬<strong>数据查询语言</strong></p> 
<p>数据查询语言(Data Query Language,DQL)主要用于查询数据。</p> 
<p>例如，使用SELECT语句可以查询数据库中的一条数据或多条数据。</p> 
<p>🐬<strong>数据控制语言</strong></p> 
<p>数据控制语言(Data Control Language，DCL)主要用于控制用户的访问权限。</p> 
<p>例如，GRANT语句用于给用户增加权限，REVOKE语句用于收回用户的权限，COMMIT语句用于提交事务，ROLLBACK语句用于回滚事务。</p> 
<p><img src="https://images2.imgbox.com/cd/1d/ovB7ug4g_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="MYSQL_321"></a>安装MYSQL</h3> 
<p><strong>下载地址：</strong> <a href="https://dev.mysql.com/downloads/mysql/" rel="nofollow">https://dev.mysql.com/downloads/mysql/</a></p> 
<p>本文安装的是mysql5.7.22版作为演示。</p> 
<p>0️⃣解压下载好的mysql压缩包，我这里解压到C:\mysql5.7目录。</p> 
<p>1️⃣打开命令提示符窗口，在命令模式下，切换到 MYSQL 安装目录下的bin目录</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> C:<span class="token punctuation">\</span>mysql5.7<span class="token punctuation">\</span>bin
</code></pre> 
<p>2️⃣输入安装命令</p> 
<pre><code class="prism language-shell">mysqld -install
</code></pre> 
<p>🐬<strong>在安装MySQL时，还有一些常见的问题需要注意</strong></p> 
<p>MySQL安装的服务名默认为 “MySQL”，如果该名称已经存在，则会安装失败，提示The service already exists!</p> 
<p>此时可能是系统中已经安装了MySQL，可以通过如下命令进行卸载，卸载后再进行安装。</p> 
<pre><code class="prism language-shell">mysqld -remove
</code></pre> 
<p>MySQL允许在安装或卸载时指定服务名称，从而实现多个MySQL服务共存。</p> 
<p>例如，当需要同时安装MySQL5.7和8.0时，分别指定不同的服务名称即可实现。</p> 
<pre><code class="prism language-shell">mysqld -install <span class="token string">"服务名称"</span>
</code></pre> 
<pre><code class="prism language-shell">mysqld -remove <span class="token string">"服务名称"</span>
</code></pre> 
<p>MySQL服务默认监听3306端口，如果该端口被其他服务占用，会导致客户端无法连接服务器。</p> 
<p>在命令行中可用 <code>netstat -ano</code> 命令查看端口占用情况。</p> 
<p>为了获知该进程是哪一个程序，执行 <code>tasklist | findstr "4204”</code> 命令</p> 
<p>当前是 mysqld.exe 占用了3306端口，说明MySQL服务正在工作。如果是其他程序占用了3306端口，只需将对应的服务停止即可。</p> 
<p>3️⃣使用文本编辑器创建配置文件 C:\mysql5.7\my.ini，编写如下：</p> 
<pre><code class="prism language-xml">[mysqld]
basedir=C:\mysql5.7
datadir=C:\mysql5.7\data
port=3306
</code></pre> 
<p>basedir 表示MySQL的安装目录；datadir 表示数据库文件的保存目录；port 表示MySQL服务的端口号。</p> 
<p>在没有配置文件的情况下，MySQL会自动检测安装目录、数据文件目录。</p> 
<p>但由于不同MySQL版本的路径可能有区别，所以建议通过配置文件来指定。</p> 
<p>另外，Linux系统中通常使用 my.cnf 作为配置文件的文件名，在Windows系统中也可以使用该文件名。</p> 
<p>4️⃣初始化数据库</p> 
<p>创建my.ini配置文件后，数据库文件目录 C:\mysql5.7\data 还没有创建。接下来需要通过MySQL的初始化功能，自动创建数据文件目录</p> 
<pre><code class="prism language-shell">mysqld --initialize-insecure
</code></pre> 
<p>“-initialize”表示初始化数据库，“-insecure”表示忽略安全性。</p> 
<p>当省略 “insecure” 时，MySQL将自动为默认用户 “root” 生成一个随机的复杂密码，而加上 “insecure” 时，“root”用户的密码为空。由于自动生成的密码输人比较麻烦，因此这里选择忽略安全性。</p> 
<blockquote> 
 <p>MySQL5.5和5.6版本中已经提供了data目录，不需要初始化数据库。只有安装5.7和8.0版本时需要执行上述命令。</p> 
</blockquote> 
<p>5️⃣管理MySQL服务</p> 
<p>MySQL安装完成后，需要启动服务进程，否则客户端无法连接数据库。在前面的配置过程中，已经将MySQL安装为Windows服务。</p> 
<p>MySQL服务不仅可以通过Windows服务管理器启动，还可以通过命令行来启动。</p> 
<p>使用管理员身份打开命令提示符，输人如下命令启动名称为 MySQL 的服务。</p> 
<pre><code class="prism language-shell">net start MySQL
</code></pre> 
<p>停止服务</p> 
<pre><code class="prism language-shell">net stop MySQL
</code></pre> 
<p>6️⃣登录MYSQL</p> 
<p>在 MySQL 的 bin 目录中，mysql.exe 是 MySQL 提供的命令行客户端工具，用于访问数据库。</p> 
<p>该程序不能直接双击运行，需要打开命令行窗口，执行 cd C:\mysql5.7\bin 命令切换工作目录，然后执行如下命令登录MySQL服务器。</p> 
<pre><code class="prism language-shell">mysql -u root
</code></pre> 
<p>“mysql”表示运行当前目录下的 mysql.exe。</p> 
<p>“-u root” 表示以root用户的身份登录，其中，“-u”和“root”之间的空格可以省略。</p> 
<p>如果需要退出MySQL，可以直接使用 exit 或 quit 命令。</p> 
<blockquote> 
 <p>命令行客户端工具还有一些常用选项。其中，“-h” 用于指定登录的MySQL服务器地址（域名或IP)，如“-hlocalhost” 或 “-h 127.0.0.1” 表示登录本地服务器。选项“-P”（必须用大写字母P）用于指定连接的端口号，如“-P3306”表示连接3306端口。</p> 
</blockquote> 
<p>7️⃣设置密码</p> 
<p>为了保护数据库的安全，需要为登录MvSQL服务器的用户设置密码。</p> 
<p>下面以设置root用户的密码为例，登录MySQL后，执行如下命令即可。</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">'root'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre> 
<p>上述命令表示为 localhost 主机中的 root 用户设置密码，密码为“123456”。</p> 
<p>当设置密码后，退出MySQL，然后重新登录时，就需要输入刚才设置的密码。</p> 
<p>在登录有密码的用户时，需要使用的命令如下。</p> 
<pre><code class="prism language-sql">mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>p123456
</code></pre> 
<p>在上述命令中，“-p123456” 表示使用密码 “123456” 进行登录。如果在登录时不希望密码被直接看到，可以省略“-p”后面的密码，然后按回车键，会提示输入密码。</p> 
<p>在设置密码后，如果需要取消密码，可以使用如下命令。</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">'root'</span>@ <span class="token string">'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">''</span>
</code></pre> 
<p>上述命令将密码设为空，即可免密码登录。</p> 
<p>8️⃣设置环境变量</p> 
<p>在启动 MYSQL 客户端前，确保命令提示符当前位于 C:\mysql5.7\bin 目录，执行命令将 bin 目录添加到环境变量。</p> 
<pre><code class="prism language-sql">setx PATH <span class="token string">"%PATH%;C:\mysql5.7\bin"</span>
</code></pre> 
<p>执行上述命令后，关闭当前命令行窗口，重新打开一个新的命令行窗口即可生效。</p> 
<p><img src="https://images2.imgbox.com/27/22/hJQI70Uq_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_479"></a>数据库操作</h3> 
<p><img src="https://images2.imgbox.com/5f/ec/kMs2OMnt_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_483"></a>创建数据库</h4> 
<p>创建数据库就是在数据库系统中划分一块存储数据的空间。</p> 
<p>🐬<strong>语法格式</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> 数据库名称<span class="token punctuation">[</span>库选项<span class="token punctuation">]</span>
</code></pre> 
<p>CREATE DATABASE 表示创建数据库；</p> 
<p>数据库名称可以是字母、数字和下划线组成的任意字符串；</p> 
<p>“库选项” 用于设置此数据库的相关特性，如字符集CHARSET，校对集COLLATE。</p> 
<blockquote> 
 <p>语法内使用 “[ ]” 括起来的选项表示可选参数。</p> 
</blockquote> 
<p>下面创建一个名称为 mydb 的数据库，具体SQL语句与执行结果如下。</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> mydb<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span><span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<p>在创建数据库后，MySQL.会在存储数据的data目录中创建一个与数据库同名的子目录（即mydb），同时会在mydb目录下生成一个 db.opt 文件，保存数据库选项，打开data\mydb\db.opt文件，如下所示。</p> 
<pre><code class="prism language-sql"><span class="token keyword">default</span><span class="token operator">-</span><span class="token keyword">character</span><span class="token operator">-</span><span class="token keyword">set</span><span class="token operator">=</span>latin1
<span class="token keyword">default</span><span class="token operator">-</span>collation<span class="token operator">-</span>Latin1——swedish_ci
</code></pre> 
<p>mydb 数据库的默认字符集为 latin1，校对集为 Latin1_swedish_ci。</p> 
<p>创建的数据库已存在，则程序会报错，可以在创建数据库名称前添加 <code>IN NOT EXISTS</code> 。表示指定的数据库不存在时执行创建，否则忽略此操作。</p> 
<p><img src="https://images2.imgbox.com/bd/99/B2c5oPEG_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_520"></a>查看数据库</h4> 
<p>🐬<strong>查看所有的数据库</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">DATABASES</span>
</code></pre> 
<p>MySQL服务器已有4个数据库，这些数据库都是MySQL安装时自动创建的。</p> 
<pre><code class="prism language-sql"><span class="token operator">+</span><span class="token comment">-------------------+</span>
<span class="token operator">|</span>information_schema <span class="token operator">|</span>
<span class="token operator">|</span>performance_schema <span class="token operator">|</span>
<span class="token operator">|</span>mysql				<span class="token operator">|</span>
<span class="token operator">|</span>sys 				<span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------+</span>
</code></pre> 
<p>information_schema 和 performance_schema 数据库分别是 MySQL 服务器的数据字典（保存所有数据表和库的结构信息）和性能字典（保存全局变量等的设置）。</p> 
<p>“mysql” 数据库主要负责MySQL服务器自己需要使用的控制和管理信息，如用户的权限关系等。</p> 
<p>sys 是系统数据库，包括了存储过程、自定义函数等信息。</p> 
<p>🐬<strong>查看指定数据库的创建信息</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> 数据库名称；
</code></pre> 
<p><img src="https://images2.imgbox.com/e6/da/DPuvfV6x_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_553"></a>选择数据库</h4> 
<p>由于MySQL服务器中的数据需要存储到数据表中，而数据表需要存储到对应的数据库下，并且MYSQL服务器中又可以同时存在多个数据库，因此，在对数据和数据表进行操作前，首先需要选择数据库。</p> 
<pre><code class="prism language-sql"><span class="token keyword">USE</span> 数据库名称；
</code></pre> 
<p>🐬<strong>登录 MYSQL 时选择数据库</strong></p> 
<pre><code class="prism language-sql">mysql <span class="token operator">-</span>u 用户名 <span class="token operator">-</span>p 密码 数据库名
</code></pre> 
<p><img src="https://images2.imgbox.com/8f/10/3hf5FLdn_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_568"></a>删除数据库</h4> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> 数据库名称<span class="token punctuation">;</span>
</code></pre> 
<p>若删除数据库不存在，mysql服务器会报错，可以在数据库名前添加 <code>IF EXISTS</code> 来判断删除的数据库是否存在，存在就删，不存在就不执行删除操作。</p> 
<p><img src="https://images2.imgbox.com/3b/fe/IzNt5VuM_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_578"></a>数据表操作</h3> 
<p><img src="https://images2.imgbox.com/11/c4/nSXHSmhX_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_581"></a>创建数据表</h4> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token punctuation">[</span><span class="token keyword">TEMPORARY</span><span class="token punctuation">]</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> 表名
<span class="token punctuation">(</span>字段名 字段类型 <span class="token punctuation">[</span>字段属性<span class="token punctuation">]</span> …<span class="token punctuation">)</span> <span class="token punctuation">[</span>表选项<span class="token punctuation">]</span>
</code></pre> 
<p>TEMPORARY： 表示临时表，仅在当前会话中可见，并且在会话关闭时自动删除。</p> 
<p>字段名：指的是数据表的列名。</p> 
<p>字段类型：设置字段中保存的数据类型，如时间日期类型等。</p> 
<p>字段属性：指的是字段的某些特殊约束条件。</p> 
<p>表选项：用于设置表的相关特性，如存储引擎（ENGINE）、字符集（CHARSET）和校对集(COLLATE)。</p> 
<p>在操作数据表之前，应该使用 <code>USE 数据库名</code> 指定操作是在哪个数据库中进行，否则会抛出 <code>No database selected</code> 错误。</p> 
<p>🐬<strong>例如：创建名为 goods 的数据表</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> goods <span class="token punctuation">(</span>
	id <span class="token keyword">int</span> <span class="token keyword">comment</span> <span class="token string">'编号'</span><span class="token punctuation">,</span>
	name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">comment</span> <span class="token string">'商品名'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>INT用于设置字段数据类型是整型。</p> 
<p>VARCHAR(L)表示可变长度的字符串，L表示字符数，如VARCHAR(32)表示可变的字符数是32。</p> 
<p>COMMENT用于在创建表时添加注释内容，并将其保存到表结构中。</p> 
<p><img src="https://images2.imgbox.com/6f/b4/DvYWcb3C_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_616"></a>查看数据表</h4> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span> <span class="token punctuation">[</span><span class="token operator">LIKE</span> 匹配模式<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p>若不添加可选项 <code>LIKE匹配模式</code>，表示查看当前数据库中的所有数据表；</p> 
<p>若添加则按照 <code>匹配模式</code> 查看数据表。其中，匹配模式符有两种，分别为 <code>%</code> 和 <code>_</code>。前者表示匹配一个或多个字符，代表任意长度的字符串，长度也可以为0，后者仅可以匹配一个字符。</p> 
<blockquote> 
 <p>LIKE 后的匹配模式必须使用单引号或双引号包裹</p> 
</blockquote> 
<p>🐬<strong>查看数据表的相关信息</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">TABLES</span> <span class="token keyword">STATUS</span> <span class="token punctuation">[</span><span class="token keyword">FROM</span> 数据库名<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">LIKE</span> 匹配模式<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9a/98/ticq2Xfx_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_636"></a>修改数据表</h4> 
<p>🐬<strong>修改数据表名称</strong></p> 
<p>语法格式1：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 旧表名 <span class="token keyword">RENAME</span> <span class="token punctuation">[</span><span class="token keyword">TO</span><span class="token operator">|</span><span class="token keyword">AS</span><span class="token punctuation">]</span> 新表名<span class="token punctuation">;</span>
</code></pre> 
<p>语法格式2：</p> 
<pre><code class="prism language-sql"><span class="token keyword">RENAME</span> <span class="token keyword">TABLE</span> 旧表名<span class="token number">1</span> <span class="token keyword">TO</span> 新表名<span class="token number">1</span> <span class="token punctuation">[</span>旧表名<span class="token number">2</span> <span class="token keyword">TO</span> 新表名<span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>修改表选项</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 表选项 <span class="token operator">=</span> 值<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/35/5f/e4zYfG02_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_657"></a>查看表结构</h4> 
<p>🐬<strong>查看数据表的字段信息</strong></p> 
<p>查看所有字段的信息</p> 
<pre><code class="prism language-sql">{<!-- --><span class="token keyword">DESCRIBE</span> <span class="token operator">|</span> <span class="token keyword">DESC</span>} 数据表名<span class="token punctuation">;</span>
</code></pre> 
<p>查看指定字段信息</p> 
<pre><code class="prism language-sql">{<!-- --><span class="token keyword">DESCRIBE</span> <span class="token operator">|</span> <span class="token keyword">DESC</span>} 数据表名 字段名<span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>查看数据的创建语句</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 表名<span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>查看数据表结构</strong></p> 
<p>语法格式1：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token punctuation">[</span><span class="token keyword">FULL</span><span class="token punctuation">]</span> <span class="token keyword">COLUMNS</span> <span class="token keyword">FROM</span> 数据表名 <span class="token punctuation">[</span><span class="token keyword">FROM</span> 数据库名<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p>语法格式2：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token punctuation">[</span><span class="token keyword">FULL</span><span class="token punctuation">]</span> <span class="token keyword">COLUMNS</span> <span class="token keyword">FROM</span> 数据库名<span class="token punctuation">.</span>数据表名<span class="token punctuation">;</span>
</code></pre> 
<p>可选项 FULL 表示显示详细内容，在不添加的情况下查询结果与 DESC 的结果相同。</p> 
<p>在添加 FULL 选项时此语句不仅可以查看到 DESC 语句查看的信息，还可以查看到字段的权限、COMMENT字段的注释信息等。</p> 
<p><img src="https://images2.imgbox.com/ab/d2/QFzBbvwn_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_698"></a>修改表结构</h4> 
<p>🐬<strong>修改字段名</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 数据表名 CHANGE <span class="token punctuation">[</span><span class="token keyword">COLUMN</span><span class="token punctuation">]</span> 旧字段名 新字段名 字段类型 <span class="token punctuation">[</span>字段属性<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>数据类型表示新字段名的数据类型，不能为空，即使与旧字段的数据类型相同，也必须重新设置。</p> 
</blockquote> 
<p>🐬<strong>修改字段类型</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 数据表名 <span class="token keyword">MODIFY</span> <span class="token punctuation">[</span><span class="token keyword">COLUMN</span><span class="token punctuation">]</span> 字段名 新字段类型 <span class="token punctuation">[</span>字段属性<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>修改字段的位置</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 数据表名 <span class="token keyword">MODIFY</span> <span class="token punctuation">[</span><span class="token keyword">COLUMN</span><span class="token punctuation">]</span> 字段名<span class="token number">1</span> 数据类型 <span class="token punctuation">[</span>字段属性<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">FIRST</span> <span class="token operator">|</span> <span class="token keyword">AFTER</span> 字段名<span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>新增字段</strong></p> 
<p>语法格式1：新增一个字段，并可指定其位置</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 数据表名 <span class="token keyword">ADD</span> <span class="token punctuation">[</span><span class="token keyword">COLUMN</span><span class="token punctuation">]</span> 新字段名 字段类型 <span class="token punctuation">[</span><span class="token keyword">FIRST</span> <span class="token operator">|</span> <span class="token keyword">AFTER</span>字段名<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p>语法格式2：同时新增多个字段</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 数据表名 <span class="token keyword">ADD</span> <span class="token punctuation">[</span><span class="token keyword">COLUMN</span><span class="token punctuation">]</span> <span class="token punctuation">(</span>新字段名<span class="token number">1</span> 字段类型<span class="token number">1</span><span class="token punctuation">,</span> 新字段名<span class="token number">2</span> 字段类型<span class="token number">2</span><span class="token punctuation">,</span>…<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>在不指定位置的情况下，新增的字段默认添加到表的最后。另外，同时新增多个字段时不能指定字段的位置。</p> 
</blockquote> 
<p>🐬<strong>删除字段</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 数据表名 <span class="token keyword">DROP</span> <span class="token punctuation">[</span><span class="token keyword">COLUMN</span><span class="token punctuation">]</span> 字段名<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2d/d1/2cbtLWJQ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_743"></a>删除数据表</h4> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token punctuation">[</span><span class="token keyword">TEMPORARY</span><span class="token punctuation">]</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> 数据表 <span class="token number">1</span> <span class="token punctuation">[</span><span class="token punctuation">,</span>数据表<span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/37/37/WaNWGvQR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_751"></a>数据操作</h3> 
<p><img src="https://images2.imgbox.com/16/7f/jwC4SCp6_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_755"></a>添加数据</h4> 
<p>🐬<strong>为所有的字段添加数据</strong></p> 
<p>严格按照数据表结构(字段的位置)插入对应的值。</p> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token punctuation">[</span><span class="token keyword">INTO</span><span class="token punctuation">]</span> 数据表名 {<!-- --><span class="token keyword">VALUES</span> <span class="token operator">|</span> <span class="token keyword">VALUE</span>} <span class="token punctuation">(</span>值<span class="token number">1</span> <span class="token punctuation">[</span><span class="token punctuation">,</span>值<span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>在MySQL中，若创建的数据表未指定字符集，则数据表及表中的字段将使用默认的字符集latin1。</p> 
<p>因此，若用户插入的数据中含有中文，则会出现错误提示。</p> 
<p>为为了解决以上中文插入的问题，通常在创建数据表时添加表选项，设置数据表的字符集。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token punctuation">[</span><span class="token keyword">TEMPORARY</span><span class="token punctuation">]</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> 表名 <span class="token punctuation">(</span>字段名 字段类型<span class="token punctuation">[</span>字段属性<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token keyword">DEFAULT</span><span class="token punctuation">]</span> {<!-- --><span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span><span class="token punctuation">[</span><span class="token keyword">CHARSET</span>} <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> utf8<span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>为部分字段添加数据</strong></p> 
<p>除了为数据表中所有字段添加数据外，还可以通过指定字段名的方式增加数据。</p> 
<p>其中指定的字段名可以是数据表中全部的字段，也可以是部分的字段。</p> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token punctuation">[</span><span class="token keyword">INTO</span><span class="token punctuation">]</span> 数据表名<span class="token punctuation">(</span>字段名<span class="token number">1</span> <span class="token punctuation">[</span><span class="token punctuation">,</span>字段名<span class="token number">2</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> {<!-- --><span class="token keyword">VALUES</span> <span class="token operator">|</span> <span class="token keyword">VALUE</span>} <span class="token punctuation">(</span>值<span class="token number">1</span><span class="token punctuation">[</span><span class="token punctuation">,</span> 值<span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>除此之外，MySQL中还提供了另外一种使用 INSERT 语句为指定字段添加数据的方式。</p> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token punctuation">[</span><span class="token keyword">INTO</span><span class="token punctuation">]</span> 数据表名 <span class="token keyword">SET</span> 字段名<span class="token number">1</span> <span class="token operator">=</span> 值<span class="token number">1</span> <span class="token punctuation">[</span><span class="token punctuation">,</span>字段名<span class="token number">2</span> <span class="token operator">=</span> 值<span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>一次添加多行数据</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token punctuation">[</span><span class="token keyword">INTO</span><span class="token punctuation">]</span> 数据表名 <span class="token punctuation">[</span><span class="token punctuation">(</span>字段列表<span class="token punctuation">)</span><span class="token punctuation">]</span> {<!-- --><span class="token keyword">VALUES</span> <span class="token operator">|</span> <span class="token keyword">VALUE</span>} <span class="token punctuation">(</span>值列表<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span>值列表<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>在多数据插入时，若一条数据插人失败，则整个插人语句都会失败。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/dd/c6/w0nbpotJ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_801"></a>查询数据</h4> 
<p>🐬<strong>查询表中全部数据</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> 数据表名<span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>查询表中部分字段</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">(</span>字段名<span class="token number">1</span><span class="token punctuation">,</span> 字段名<span class="token number">2</span><span class="token punctuation">,</span> 字段名<span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> 数据表名<span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>简单条件查询数据</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">(</span>字段名<span class="token number">1</span><span class="token punctuation">,</span> 字段名<span class="token number">2</span><span class="token punctuation">,</span> 字段名<span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> 数据表名 <span class="token keyword">WHERE</span> 字段名 <span class="token operator">=</span> 值<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/49/de/jyhIqweF_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_823"></a>修改数据</h4> 
<pre><code class="prism language-sql"><span class="token keyword">UPDATE</span> 数据表名 <span class="token keyword">SET</span> 字段名<span class="token number">1</span> <span class="token operator">=</span> 值<span class="token number">1</span><span class="token punctuation">[</span><span class="token punctuation">,</span>字段名<span class="token number">2</span> <span class="token operator">=</span> 值<span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">WHERE</span> 条件表达式<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>若没有where条件，那么表中对应的字段全部都会被修改</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/4c/05/MmY6e02W_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_833"></a>删除数据</h4> 
<pre><code class="prism language-sql"><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> 数据表名 <span class="token punctuation">[</span><span class="token keyword">WHERE</span> 条件表达式<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/92/9c/ojJwdiTu_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_841"></a>常用转义字符</h3> 
<table><thead><tr><th>转义字符</th><th>含义</th><th>转义字符</th><th>含义</th></tr></thead><tbody><tr><td>\0</td><td>空字符（NULL）</td><td>\t</td><td>制表符（HT）</td></tr><tr><td>\r</td><td>回车符（CR）</td><td>\b</td><td>退格（BS）</td></tr><tr><td>\n</td><td>换行符（LE）</td><td>\’</td><td>单引号</td></tr><tr><td>\"</td><td>双引号</td><td>\%</td><td>%（常用于LIKE条件）</td></tr><tr><td>\\</td><td>反斜线</td><td>\_</td><td>_（常用于LIKE条件）</td></tr></tbody></table> 
<p><img src="https://images2.imgbox.com/15/86/EjSJvqLc_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_851"></a>数据类型</h3> 
<p><img src="https://images2.imgbox.com/aa/22/gPKbyCUn_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_854"></a>数字类型</h4> 
<p>🐬<strong>整数类型</strong></p> 
<table><thead><tr><th>数据类型</th><th>字节数</th><th>无符号数的取值范围</th><th>有符号数的取值范围</th></tr></thead><tbody><tr><td>TINYINT</td><td>1</td><td>0~255</td><td>- 128 ~ 127</td></tr><tr><td>SMALLINT</td><td>2</td><td>0~65 535</td><td>- 32 768 ~ 32 767</td></tr><tr><td>MEDIUMINT</td><td>3</td><td>0~16 777 215</td><td>- 8 388 608 ~ 8 388 607</td></tr><tr><td>INT</td><td>4</td><td>0~4 294 967 295</td><td>- 2 147 483 648 ~ 2 147 483 647</td></tr><tr><td>BIGINT</td><td>8</td><td>0 ~ 18 446 744 073 709 551 615</td><td>- 9 223 372 036 854 775 808 ~ 9 223 372 036 854 775 807</td></tr></tbody></table> 
<p>不同整数类型所占用的字节数和取值范围都是不同的。</p> 
<p>占用字节数最小的是TINYINT，占用字节数最大的是BIGINT。</p> 
<p>不同整数类型的取值范围可以根据字节数计算出来。例如，TINYINT 类型的整数占用1字节，1字节是8位，那么，TINYINT 类型无符号数的最大值就是 <code>2^8 - 1</code>（即255）， 有符号数的最大值就是 <code>2^7 - 1</code>（即127）。</p> 
<p>若使用无符号数据类型，需要在数据类型右边加上 <code>UNSIGNED</code> 关键字来修饰，例如，<code>INT UNSIGNED</code> 表示无符号 INT 类型。</p> 
<hr> 
<pre><code class="prism language-sql"><span class="token operator">+</span><span class="token comment">------+-----------------+----+----+--------+------+</span>
<span class="token operator">|</span>Field <span class="token operator">|</span><span class="token keyword">TYPE</span> 			 <span class="token operator">|</span><span class="token boolean">NUll</span><span class="token operator">|</span><span class="token keyword">KEY</span> <span class="token operator">|</span><span class="token keyword">Default</span> <span class="token operator">|</span>Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-----------------+----+----+--------+------+</span>
<span class="token operator">|</span>int_1 <span class="token operator">|</span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>			 <span class="token operator">|</span>YES <span class="token operator">|</span>	   <span class="token operator">|</span><span class="token boolean">NULL</span>    <span class="token operator">|</span>	   <span class="token operator">|</span>
<span class="token operator">|</span>int_2 <span class="token operator">|</span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">|</span>YES <span class="token operator">|</span>    <span class="token operator">|</span><span class="token boolean">NULL</span>    <span class="token operator">|</span>	   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+-----------------+----+----+--------+------+</span>
</code></pre> 
<p>数据类型右边使用小括号数字标注了显示宽度。默认情况下，显示宽度是取值范围所能表示的最大宽度。对于有符号类型，符号也占用一个宽度。</p> 
<p>例如，255的显示宽度为3，一128的显示宽度为4。</p> 
<p>❗显示宽度与取值范围无关，若数值的位数小于显示宽度，会填充空格，若大于显示宽度，则不影响显示结果。</p> 
<p>为字段设置零填充(ZEROFILL)时，若数值宽度小于显示宽度，会在左侧填充0。</p> 
<p>例如，在 my_Int 表中设置零填充和宽度</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> my_Int <span class="token punctuation">(</span>
	int_1 <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> ZEROFILL<span class="token punctuation">,</span>
	int_2 <span class="token keyword">TINYINT</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> ZEROFILL
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>设置零填充后，字段自动设为无符号类型，这是因为负数不能使用负填充。</p> 
</blockquote> 
<p>🐬<strong>浮点数类型</strong></p> 
<table><thead><tr><th>数据类型</th><th>字节数</th><th>负数的取值范围</th><th>非负数的取值范围</th></tr></thead><tbody><tr><td>FLOAT</td><td>4</td><td>－3.402 823 466E + 38 ～－1.175 494 351E－38</td><td>0 和 1.175 494 351E－38～3.402 823 466E+38</td></tr><tr><td>DOUBLE</td><td>8</td><td>－1.797 693 134 862 315 7E + 308 ~ －2. 225 073 858 507 201 4E－308</td><td>0 和 2.225 073 858 507 201 4E－308～1.797 693 134 862 315 7E + 308</td></tr></tbody></table> 
<p>列举的取值范围是理论上的极限值，但根据不同的硬件或操作系统，实际范围可能会小。</p> 
<p>当浮点数类型使用 <code>UNSIGNED</code> 修饰为无符号时，取值范围将不包含负数。</p> 
<p>浮点数类型虽然取值范围很大，但是精度并不高。FLOAT的精度为6位或7位，DOUBLE 的精度大约为15位。如果超出精度，可能会导致给定的数值与实际保存的数值不一致，发生精度损失。</p> 
<p>🐬<strong>定点数类型</strong></p> 
<p>定点数类型(DECIMAL) 通过 DECIMAL(M,D) 设置位数和精度，其中，M表示数字总位数（不包括“.”和“—”)，最大值为65，默认值为10；D表示小数点后的位数，最大值为30，默认值为0。</p> 
<p>例如，DECIMAL(5，2) 表示的取值范围是 －999.99～999.99。</p> 
<p>若小数部分超出范围，会进行四舍五人，并出现 Data truncated(数据截断) 警告。</p> 
<p>若整数部分超出范围，数据会插人失败，提示 Out of range value(超出取值范围）错误。</p> 
<p>浮点数类型也可以设置位数和精度，如 float(8,2)，但仍有可能损失精度。在实际使用时应避免使用浮点数类型，以免出现不能人为控制的问题。因此，对于小数类型的设置，推荐使用定点数类型并设置合理的范围可以使计算更为准确。</p> 
<p>🐬<strong>BIT类型</strong></p> 
<p>BIT(位) 类型用于存储二进制数据，语法为BIT(M)，M表示位数，范围为1~64。</p> 
<p><img src="https://images2.imgbox.com/dd/54/3yax0ecx_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_934"></a>时间和日期类型</h4> 
<table><thead><tr><th>数据类型</th><th>取值范围</th><th>日期格式</th><th>零 值</th></tr></thead><tbody><tr><td>YEAR</td><td>1901 ~ 2155</td><td>YYYY</td><td>0000</td></tr><tr><td>DATE</td><td>1000-01-01 ~ 9999-12-3</td><td>YYYY-MM-DD</td><td>0000-00-00</td></tr><tr><td>TIME</td><td>－838:59:59 ~ 838:59:59</td><td>HH:MM:SS</td><td>00:00:00</td></tr><tr><td>DATETIME</td><td>1000-01-01 00:00:00 ~ 9999-12-31 23:59:59</td><td>YYYY-MM-DD HH:MM:SS</td><td>0000-00-00 00:00:00</td></tr><tr><td>TIMESTAMP</td><td>1970-01-01 00:00:01 ~ 2038-01-19 03:14:07</td><td>YYYY-MM-DD HH:MM:SS</td><td>0000-00-00 00:00:00</td></tr></tbody></table> 
<p>YYYY：表示年，MM：表示月，DD：表示日，每种日期和时间类型的取值范围都是不同的。</p> 
<p>❗如果插入的数值不合法，系统会自动将对应的零值插人数据库中。</p> 
<p>🐬<strong>YEAR类型</strong></p> 
<p>YEAR 类型用于表示年份。</p> 
<p>在 MySQL 中，可以使用以下 3 种格式指定 YEAR 类型的值。</p> 
<ul><li>使用 4 位字符串或数字表示，为 <code>'1901'~'2155'</code> 或 <code>1901~2155</code>。 
  <ul><li>例如，输入 ‘2020’ 或 2020 ，插入到数据库中的值均为 2020。</li></ul> </li><li>使用两位字符串表示为<code> '00'~'99'</code>，其中，<code>'00'~'69'</code> 的值会被转换为 <code>2000~2069</code> 的YEAR值，<code>'70'~'99'</code> 的值会被转换为 <code>1970~1999</code> 的YEAR值。 
  <ul><li>例如，输入 ‘20’，插入到数据库中的值为 2020。</li></ul> </li><li>使用两位数字表示为 <code>1~99</code> ，其中，<code>1~69</code> 的值会被转换为 <code>2001~2069</code> 的YEAR值，<code>70~99</code>的值会被转换为 <code>1970~1999</code> 的YEAR值。 
  <ul><li>例如，输入 20 ，插入到数据库中的值为 2020。</li></ul> </li></ul> 
<p>❗当使用 YEAR 类型时，一定要区分 <code>'0'</code> 和 <code>0</code>。因为字符串格式的 <code>'0'</code> 表示的 YEAR 值是 <code>2000</code>，而数字格式的 <code>0</code>表示的 YEAR 值是 <code>0000</code> 。</p> 
<p>🐬<strong>DATE类型</strong></p> 
<p>DATE 类型用于表示日期值，不包含时间部分。</p> 
<p>在 MySQL 中，可以使用以下 4 种格式指定 DATE 类型的值。</p> 
<ul><li>以 <code>'YYYY-MM-DD'</code> 或者 <code>'YYYYMMDD'</code> 字符串格式表示。 
  <ul><li>例如，输入 ‘2020-01-21’ 或 ‘20200121’，插入数据库中的日期都为 2020-01-21。</li></ul> </li><li>以 <code>'YY-MM-DD'</code> 或者 <code>'YYMMDD'</code> 字符串格式表示。YY表示的是年，为 <code>'00'~'99'</code>，其中 <code>'00'~'69'</code> 的值会被转换为<code>2000~2069</code>的值，<code>70'~'99'</code> 的值会被转换为 <code>1970~1999</code> 的值。 
  <ul><li>例如，输入’20-01-21’或 ‘200121’，插入数据库中的日期都为2020-01-21。</li></ul> </li><li>以 <code>YY-MM-DD</code> 或者 <code>YYMMDD</code> 数字格式表示。 
  <ul><li>例如，输入 20-01-21 或 200121，插入数据库中的日期都为 2020-01-21。</li></ul> </li><li>使用 <code>CURRENT_DATE</code> 或者 <code>NOW()</code> 输入当前系统日期。</li></ul> 
<p>通过 <code>SELECT CURRENT_DATE</code> 或 <code>SELECT NOW()</code> 可查看当前日期。</p> 
<p>日期中的分隔符 <code>-</code> 还可以用 <code>.</code> <code>，</code> <code>/</code> 等符号替代。</p> 
<p>🐬<strong>TIME类型</strong></p> 
<p>TIME类型用于表示时间值，它的显示形式一般为 <code>HH:MM:SS</code>，其中，HH表示小时，MM表示分，SS表示秒。</p> 
<p>在 MySQL 中，可以使用以下 3 种格式指定 TIME 类型的值。</p> 
<ul><li>以 <code>'HHMMSS'</code> 字符串或者 <code>HHMMSS</code> 数字格式表示。 
  <ul><li>例如，输入 <code>'345454'</code> 或 <code>345454</code> ，插入数据库中的时间为 34:54:54(34小时54分54秒)。</li></ul> </li><li>以 <code>D HH:MM:SS</code> 字符串格式表示。其中，<code>D</code> 表示日，可以取 <code>0～34</code> 之间的值，插入数据时，小时的值等于(D×24+HH)。 
  <ul><li>例如，输入<code>'2 11:30:50'</code>，插入数据库中的时间为 <code>59:30:50</code>；输入 <code>'11:30:50'</code>，插入数据库中的时间为11：30：50。</li></ul> </li><li>使用 <code>CURRENT_TIME</code> 或 <code>NOW()</code>输入当前系统时间。</li></ul> 
<p>🐬<strong>DATETIME类型</strong></p> 
<p>DATETIME 类型用于表示日期和时间，它的显示形式为 <code>'YYYY-MM-DD HH:MM:SS'</code>，其中，YYYY表示年，MM表示月，DD表示日，HH表示小时，MM表示分，SS表示秒。</p> 
<p>在MySQL中，可以使用以下 4 种格式指定 DATETIME 类型的值。</p> 
<ul><li> <p>以 <code>'YYYY-MM-DD HH:MM:SS'</code> 或者 <code>'YYYYMMDDHHMMSS'</code> 字符串格式表示的日期和时间，取值范围为<code>'1000-01-01 00:00:00'</code>~<code>'9999-12-31 23:59:59'</code> 。</p> 
  <ul><li>例如，输入 <code>'2014-01-22 09:01:23'</code> 或 <code>20140122090123</code> ，插入数据库中的 DATETIME 值都为 2014-01-22 09:01:23。</li></ul> </li><li> <p>以 <code>'YYYY-MM-DD HH:MM:SS'</code> 或者 <code>'YYMMDDHHMMSS'</code> 字符串格式表示的日期和时间，其中 YY 表示年，取值范围为 <code>'00'～'99'</code>。与 DATE 类型中的 YY 相同，<code>'00'～'69'</code> 范围的值会被转换为 <code>2000～2069</code>范围的值，<code>'70'~'99'</code> 范围的值会被转换为 <code>1970~1999</code> 范围。</p> </li><li> <p>以 <code>YYYYMMDDHHMMSS</code> 或者 YYMMDDHHMMSS 数字格式表示的日期和时间。</p> 
  <ul><li>插人 20140122090123 或者 140122090123 ，插入数据库中的 DATETIME 值都为 2014-01-22 09:01:23。</li></ul> </li><li> <p>使用 <code>NOW()</code> 来输入当前系统的日期和时间。</p> </li></ul> 
<p>🐬<strong>TIMESTAMP类型</strong></p> 
<p>TIMESTAMP(时间戳) 类型用于表示日期和时间，它的显示形式与 DATETIME 相同、但取值范围比DATETIME小。</p> 
<p>TIMESTAMP 类型与DATATIME类型不同的形式：</p> 
<ul><li>使用 <code>CURRENT_TIMESTAMP</code> 来输入系统当前日期和时间。</li><li>无任何输入，或输入 <code>NULL</code> 时，实际保存的是系统当前日期和时间。</li></ul> 
<p>在MySQL中，TIMFSTAMP 字段默认情况下会自动设置 <code>NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP</code> 属性。</p> 
<ul><li><code>NOT NULL</code> 表示非空约束，该字段将不允许保存 <code>NULL</code> 值。</li><li><code>DEFAULT</code>表示默认约束，当字段无任何输入时，自动设置某个值作为默认值。此处设为<code>CURRENT_TIMESTAMP</code> 表示使用系统当前日期和时间作为默认值。</li><li><code>ON UPDATE</code> 用于当一条记录中的其他字段被 <code>UPDATE</code> 语句修改时，自动更改该字段为某个值。此处设为 <code>CURRENT_TIMESTAMP</code> 表示每次修改时保存修改时的系统日期和时间。</li></ul> 
<blockquote> 
 <p>若为 <code>TIMESTAMP</code> 字段手动设置 <code>DEFAULT</code> 属性时，该字段将不会自动设置 <code>ON UPDATE</code> 属性。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/ff/79/ukBV9STZ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1025"></a>字符串类型</h4> 
<table><thead><tr><th>数据类型</th><th>类型说明</th></tr></thead><tbody><tr><td>CHAR</td><td>固定长度字符串</td></tr><tr><td>VARCHAR</td><td>可变长度字符串</td></tr><tr><td>TEXT</td><td>大文本数据</td></tr><tr><td>ENUM</td><td>枚举类型</td></tr><tr><td>SET</td><td>字符串对象</td></tr><tr><td>BINARY</td><td>固定长度的二进制数据</td></tr><tr><td>VARBINARY</td><td>可变长度的二进制数据</td></tr><tr><td>BLOB</td><td>二进制大对象（Binary Large Object）</td></tr></tbody></table> 
<p>🐬<strong>CHAR和VARCHAR类型</strong></p> 
<p>CHAR 和 VARCHAR 类型都用来保存字符串数据。不同的是，VARCHAR 可以存储可变长度的字符串。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CHAR</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token keyword">VARCHAR</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span>
</code></pre> 
<p>M指的是字符串的最大长度。为了对比 CHAR 和 VARCHAR 之间的区别，下面以 CHAR(4) 和VARCHAR(4) 为例进行说明。</p> 
<table><thead><tr><th>插入值</th><th>CHAR(4) 存储需求</th><th>VARCHAR(4) 存储需求</th></tr></thead><tbody><tr><td>‘’</td><td>4字节</td><td>1字节</td></tr><tr><td>‘ab’</td><td>4字节</td><td>3字节</td></tr><tr><td>‘abc’</td><td>4字节</td><td>4字节</td></tr><tr><td>‘abcd’</td><td>4字节</td><td>5字节</td></tr></tbody></table> 
<p>对于 CHAR(4) 无论插入值的长度是多少，所占用的存储空间都是4字节，而 VARCHAR(4) 占用的字节数为实际长度加1。</p> 
<p>🐬<strong>TEXT类型</strong></p> 
<p>TEXT类型用于保存大文本数据，例如，文章内容、评论等比较长的文本。</p> 
<table><thead><tr><th>数据类型</th><th>存储范围</th><th>数据类型</th><th>存储范围</th></tr></thead><tbody><tr><td>TINYTEXT</td><td>0～2^8 - 1 字节</td><td>MEDIUMTEXT</td><td>0~2^24-1 字节</td></tr><tr><td>TEXT</td><td>0～2^16 - 1 字节</td><td>LONGTEXT</td><td>0～2^32-1 字节</td></tr></tbody></table> 
<p>❗TEXT类型所能保存的最大字符数量取决于字符串实际占用的字节数。</p> 
<p>🐬<strong>ENUM类型</strong></p> 
<p>ENUM 类型又称为枚举类型。</p> 
<pre><code class="prism language-sql"><span class="token keyword">ENUM</span><span class="token punctuation">(</span><span class="token string">'值1'</span><span class="token punctuation">,</span> <span class="token string">'值2'</span><span class="token punctuation">,</span> <span class="token string">'值3'</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token string">'值n'</span><span class="token punctuation">)</span>
</code></pre> 
<p><code>('值1', '值2', '值3', ...,'值n')</code> 称为枚举列表，ENUM类型的数据只能从枚举列表中取，并且只能取一个。</p> 
<p>在MySQL中，枚举列表最多可以有 <code>65535</code> 个值，每个值都有一个顺序编号，实际保存在记录中的是顺序编号，而不是列表中的值，因此不必担心过长的值占用空间。但在使用 SELECT、INSERT 等语句进行操作时，仍然使用列表中的值。</p> 
<p>🐬<strong>SET类型</strong></p> 
<p>SET类型用于保存字符串对象，其定义格式与ENUM类型类似。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span><span class="token punctuation">(</span><span class="token string">'值1'</span><span class="token punctuation">,</span> <span class="token string">'值2'</span><span class="token punctuation">,</span> <span class="token string">'值3'</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">,</span><span class="token string">'值n'</span><span class="token punctuation">)</span>
</code></pre> 
<p>SET类型的列表中最多可以有 <code>64</code> 个值，且列表中的每个值都有一个顺序编号，为了节省空间，实际保存在记录中的也是顺序编号，但在使用 SELECT、INSERT 等语句进行操作时，仍然要使用列表中的值。</p> 
<p>SET类型与ENUM的区别在于，它可以从列表中选择一个或多个值来保存，多个值之间用逗号 <code>,</code> 分隔。</p> 
<blockquote> 
 <p>1️⃣ENUM 类型类似于单选框，SET 类型类似于复选框。<br> 2️⃣ENUM 和 SET 类型的优势在于规范数据本身，限定只能插入规定的数据项，节省了存储空间，查询速度比 CHAR、VARCHAR 类型快。<br> 3️⃣ENUM 和 SET 类型列表中的值都可以使用中文，但必须设置支持中文的字符集，例如 <code>CREATE TABLE my_enum (gender ENUM('男', '女')) CHARSET=GBK;</code>。<br> 4️⃣ENUM 和 SET 类型在填写列表、插入值、查找值等操作时，都会自动忽略末尾的空格。</p> 
</blockquote> 
<p>🐬<strong>BINARY和VARBINARY类型</strong></p> 
<p>BINARY 和 VARBINARY 类型类似于 CHAR 和 VARCHAR，不同的是，它们所表示的是二进制数据。</p> 
<pre><code class="prism language-sql"><span class="token keyword">BINARY</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token keyword">VARBINARY</span><span class="token punctuation">(</span>M<span class="token punctuation">)</span>
</code></pre> 
<p>M 是指二进制数据的最大字节长度。</p> 
<p>BINARY 类型的长度是固定的，如果数据的长度不足最大长度，将在数据的后面用 <code>\0</code> 补齐，最终达到指定长度。</p> 
<p>例如，指定数据类型为 <code>BINARY(3)</code> ，当插入<code>a</code> 时，实际存储的数据为 <code>a\0\0</code> ，当插入 <code>ab</code> 时，实际存储的数据为 <code>ab\0</code> 。</p> 
<p>在查询 BINARY 类型时，查询条件字符串也需要加上 <code>\0</code> 填充符，否则查询不到该记录，并且BINARY 和 VARBINARY 都区分大小写。</p> 
<p>例如，指定数据类型为 <code>BINARY(3)</code> ，当查询 <code>a</code> 时，WHERE条件值要输入 <code>a\0\0</code>，否则查询不到该记录。</p> 
<p>🐬<strong>BLOB类型</strong></p> 
<p>BLOB类型用于保存数据量很大的二进制数据，如图片、PDF文档等。</p> 
<table><thead><tr><th>数据类型</th><th>存储范围</th><th>数据类型</th><th>存储范围</th></tr></thead><tbody><tr><td>TINYBLOB</td><td>0～2^8-1字节</td><td>MEDIUMBLOB</td><td>0～2^24-1字节</td></tr><tr><td>BLOB</td><td>0～2^16-1字节</td><td>LONGBLOB</td><td>0～2^32-1字节</td></tr></tbody></table> 
<p>BLOB 类型与 TEXT 类型很相似，但 BLOB 类型数据是根据二进制编码进行比较和排序，而 TEXT 类型数据是根据文本模式进行比较和排序。</p> 
<p><img src="https://images2.imgbox.com/c2/f9/7F9yoF3b_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="JSON_1135"></a>JSON数据类型</h4> 
<p>MySQL从 5.7.8 版本开始提供了JSON 数据类型。</p> 
<p>JSON是一种轻量级的数据交换格式，由 JavaScript 语言发展而来，其本质是一个字符串。</p> 
<p>MySQL中 JSON 类型值常见的表现方式有两种，分别为 JSON数组 和 JSON对象。</p> 
<pre><code class="prism language-sql"><span class="token comment"># 1. JSON 数组</span>
<span class="token punctuation">[</span><span class="token string">"abc"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token boolean">null</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">]</span>

<span class="token comment"># 2.JSON对象</span>
<span class="token punctuation">[</span><span class="token string">"k1"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token punctuation">,</span> <span class="token string">"k2"</span><span class="token punctuation">,</span> <span class="token string">"10"</span><span class="token punctuation">]</span>
</code></pre> 
<p>JSON数组中保存的数据可以是任意类型。</p> 
<p>与直接使用 MySQL 字符串类型相比，JSON 数据类型具有自动验证格式、优化存储格式的优点。</p> 
<p>JSON 数据类型所需的空间大致与 LONGBLOB 或 LONGTEXT 相同，且不能有默认值。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> myjson <span class="token punctuation">(</span>j1 JSON<span class="token punctuation">,</span> j2 JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> myjson <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>
	<span class="token string">'{"k1", "value", "k2", "10"}, ["run", "sing"]'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/2b/63/2mUJJI0G_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1165"></a>二进制方式比较字符串</h4> 
<p>若要在 CHAR、VARCHAR、TEXT 类型的字符串比较时严格区分大小写，有多种实现方式。下面两种比较常见的方式。</p> 
<p>🐬<strong>使用 BINARY 关键字</strong></p> 
<p>在字段名或某个值的前面加上 BINARY 关键字可以将类型转换为二进制，转换后进行比较就可以严格区分大小写和空格。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token string">'a '</span> <span class="token operator">=</span> <span class="token string">'A'</span><span class="token punctuation">;</span>									<span class="token comment">#比较结果：1（相等）</span>
<span class="token keyword">SELECT</span> <span class="token keyword">BINARY</span> <span class="token string">'a'</span> <span class="token operator">=</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'a'</span> <span class="token operator">=</span> <span class="token keyword">BINARY</span> <span class="token string">'A'</span><span class="token punctuation">;</span>			<span class="token comment">#比较结果：0（不相等）</span>
<span class="token keyword">SELECT</span> <span class="token keyword">BINARY</span> <span class="token string">'A '</span> <span class="token operator">=</span> <span class="token string">'A'</span><span class="token punctuation">;</span>							<span class="token comment">#比较结果：0（不相等）</span>
<span class="token keyword">SELECT</span> <span class="token keyword">BINARY</span> <span class="token string">'A'</span> <span class="token operator">=</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'A'</span> <span class="token operator">=</span> <span class="token keyword">BINARY</span> <span class="token string">'A'</span><span class="token punctuation">;</span>			<span class="token comment">#比较结果：1（相等）</span>
</code></pre> 
<p>🐬<strong>设置字段的校对集</strong></p> 
<p>latin1、gbk、utf8 编码默认的校对集分别为 latin1_swedish_ci、gbk_chinese_ci、utf8_general_ci，将其分别改为 latin1_bin、gbk_bin、utf8_bin 即可区分大小写，但在比较时仍会忽略字符串末尾的空格。</p> 
<pre><code class="prism language-sql"><span class="token comment"># 1.创建表时设置字段的校对集</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mychar <span class="token punctuation">(</span>
	c1 <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> latin1 <span class="token keyword">COLLATE</span> latin1_bin<span class="token punctuation">,</span>
	c2 <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> gbk <span class="token keyword">COLLATE</span> gbk_bin<span class="token punctuation">,</span>
	c3 <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 2.插入测试数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mychar <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">)</span>

<span class="token comment"># 3.查询数据</span>
<span class="token keyword">SELECT</span> c1 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">,</span> c2 <span class="token operator">=</span> <span class="token string">'a'</span><span class="token punctuation">,</span> c3 <span class="token operator">=</span> <span class="token string">'a'</span> <span class="token keyword">FROM</span> mychar<span class="token punctuation">;</span>			<span class="token comment">#结果：0（不想等）</span>
<span class="token keyword">SELECT</span> c1 <span class="token operator">=</span> <span class="token string">'A'</span><span class="token punctuation">,</span> c2 <span class="token operator">=</span> <span class="token string">'A'</span><span class="token punctuation">,</span> c3 <span class="token operator">=</span> <span class="token string">'A'</span> <span class="token keyword">FROM</span> mychar<span class="token punctuation">;</span>			<span class="token comment">#结果：1（想等）</span>
<span class="token keyword">SELECT</span> c1 <span class="token operator">=</span> <span class="token string">'A '</span><span class="token punctuation">,</span> c2 <span class="token operator">=</span> <span class="token string">'A '</span><span class="token punctuation">,</span> c3 <span class="token operator">=</span> <span class="token string">'A '</span> <span class="token keyword">FROM</span> mychar<span class="token punctuation">;</span>			<span class="token comment">#结果：1（想等）</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/de/75/3OGY3taQ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1202"></a><strong>注意</strong></h4> 
<p>1️⃣CHAR 和 VARCHAR 类型在插入数据时，若字符串末尾有空格，CHAR 类型会自动去掉空格后保存，而VARCHAR、TEXT 类型会保留空格。</p> 
<p>2️⃣在使用 “=” 等运算符对 CHAR 、VARCHAR 、TEXT 进行比较时，字符串末尾的空格会被忽略。</p> 
<p>例如，使用 WHERE 查询 ‘a’ 字符串，查询结果中可能包含 a 后面有空格的情况，反之，若查询条件字符串末尾有空格（如 'a ')，空格也会被忽略。</p> 
<p>3️⃣由于默认情况下创建的数据库和表使用的校对集 (latin1_swedish_ci) 对大小写不敏感，因此CHAR、VARCHAR、TEXT、ENUM、SET 类型都不区分大小写。</p> 
<p>例如，使用 WHERE 查询 ‘a’ 字符串，则 “a” 和 “A” 都会被查询出来。而 BINARY、VARBINARY、BLOB类型区分大小写，这是因为它们使用二进制方式保存数据。</p> 
<p>4️⃣MySQL 默认规定一条记录的最大长度是 65535 字节，一般来说，字段分配的存储空间和额外开销加在一起不能超过 65535 字节，如果超过了这个限制，在SQL 严格模式下表会创建失败，提示 Row size too large。但 TEXT 和 BLOB 类型字段的存储空间不受此限制，它们只占用额外开销（大约12字节)。</p> 
<p>5️⃣在没有超过 65535 限制的情况下，CHAR 字段的 M 最大值为255，VARCHAR字段的 M 的最大值取决于字符集，常用的字符集有 latin1(默认）、gbk 和 utf8，对应的M最大值分别为 65533、32766 和 21844，若表中只有一个字段且设置了非空约束，M 可达到最大值，否则 M 的最大值会减小。</p> 
<p>6️⃣从执行效率上来说，TEXT 和 BLOB 不如 CHAR、VARCHAR 类型，建议只有当需要保存大量数据时，才选择使用 TEXT 或 BLOB 类型。</p> 
<p><img src="https://images2.imgbox.com/ef/9b/X531M6kp_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_1221"></a>表的约束</h3> 
<p>为了防止数据表中插入错误的数据，MySQL定义了一些维护数据库完整性的规则，即表的约束。</p> 
<p><img src="https://images2.imgbox.com/63/37/5iaR39Gm_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1226"></a>默认约束</h4> 
<p>默认约束用于为数据表中的字段指定默认值，即当在表中插人一条新记录时，如果没有给这个字段赋值，那么，数据库系统会自动为这个字段插入默认值。</p> 
<pre><code class="prism language-sql">字段名 数据类型 <span class="token keyword">DEFAULT</span> 默认值<span class="token punctuation">;</span>
</code></pre> 
<p>使用 ALTER TABLE 修改列属性即可添加或删除默认约束。</p> 
<blockquote> 
 <p>BLOB、TEXT 数据类型不支持默认约束。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/27/6f/jg2UJjQq_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1238"></a>非空约束</h4> 
<p>非空约束指的是字段的值不能为NULL。</p> 
<pre><code class="prism language-sql">字段名 数据类型 <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>为现有的表添加或删除非空约束的方式与默认约束类似，使用ALTER TABLE修改列属性即可。<br> 若目标列中已经保存了NULL值，添加非空约束会失败，提示 “Invalid use of NULL value”，只要将NULL值改为其他值即可解决。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/e2/a0/ZXbvnVst_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1250"></a>唯一约束</h4> 
<p>唯一约束用于保证数据表中字段的唯一性，即表中字段的值不能重复出现。</p> 
<pre><code class="prism language-sql"><span class="token comment">#列级约束</span>
字段名 数据类型 <span class="token keyword">UNIQUE</span><span class="token punctuation">;</span>

<span class="token comment">#表级约束</span>
<span class="token keyword">UNIQUE</span><span class="token punctuation">(</span>字段名<span class="token number">1</span><span class="token punctuation">,</span>字段名<span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>列级约束定义在一个列上，只对该列起约束作用；表级约束是独立于列的定义，可以应用在一个表的多个列上。</p> 
<blockquote> 
 <p>当表级约束仅建立在一个字段上时，其作用效果与列级约束相同。</p> 
</blockquote> 
<p>若为一个现有的表添加或删除唯一约束，无法通过修改字段属性的方式操作，而是按照索引的方式来操作。</p> 
<p>添加唯一约束的完整语法</p> 
<pre><code class="prism language-sql"><span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> 索引名<span class="token punctuation">(</span>字段列表<span class="token punctuation">)</span>
</code></pre> 
<p>添加唯一约束时创建索引，用于加快查询速度。</p> 
<p>索引名可以自己指定，也可以省略，MySQL会自动使用字段作为索引名。当需要对索引进行删除时，需要指定这个索引名。</p> 
<p>在表级唯一性约束创建时，UNIQUE() 的字段列表中，可以添加多个字段，组成复合唯一键，其特点是只有多个字段的值相同时才视为重复记录。</p> 
<p><img src="https://images2.imgbox.com/cf/09/Uc4aptAL_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1281"></a>主键约束</h4> 
<p>为了快速查找表中的某条信息，可以通过设置主键来实现。主键可以唯一标识表中的记录，类似身份证用于标识人的身份一样。</p> 
<p>主键约束通过 PRIMARY KEY 定义，它相当于<code>唯一约束</code>和<code>非空约束</code>的组合，要求被约束字段不允许重复，也<code>不允许出现 NULL 值</code>，每个表最多<code>只允许含有一个主键</code>。</p> 
<pre><code class="prism language-sql"><span class="token comment"># 列级约束</span>
字段名 数据类型 <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>

<span class="token comment">#表级约束</span>
<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span>（字段名<span class="token number">1</span><span class="token punctuation">,</span>字段名<span class="token number">2</span><span class="token punctuation">,</span>…）
</code></pre> 
<p>表级约束的字段若只有一个，则为单字段主键与列级约束添加的效果相同；若有多个，则为复合主键。复合主键需要用多个字段来确定一条记录的唯一性，类似于复合唯一键。</p> 
<pre><code class="prism language-sql"><span class="token comment"># 1.删除主键约束</span>
mysql<span class="token operator">&gt;</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> my_primary <span class="token keyword">DROP</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">;</span>

<span class="token comment"># 2.删除id字段的非空约束</span>
mysql<span class="token operator">&gt;</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> my_primary <span class="token keyword">MODIFY</span> id <span class="token keyword">INT</span> <span class="token keyword">UNSIGNED</span><span class="token punctuation">;</span>

<span class="token comment"># 3.添加主键约束</span>
mysql<span class="token operator">&gt;</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> my_primary <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>删除 id 字段的主键约束后，该字段的非空约束并没有被同时删除。若需要删除 id 字段的非空约束，执行第2步删除操作即可。</p> 
<p><img src="https://images2.imgbox.com/19/42/QLsryyru_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1311"></a>自动增长</h4> 
<p>为数据表设置主键约束后，每次插入记录时，都需要检查主键的值，防止插入的值重复导致插入失败，可以利用MySQL提供的自动增长功能来自动生成主键的值。</p> 
<pre><code class="prism language-sql">字段名 数据类型 <span class="token keyword">AUTO_INCREMENT</span>
</code></pre> 
<p>🐬<strong>在使用 AUTO_INCREMENT 时，需要注意以下4点：</strong></p> 
<p>    👉 一个表中只能有一个自动增长字段，该字段的数据类型是整数类型，且必须定义为键，如 <code>UNIQUE KEY</code> 、<code>PRIMARY KEY</code>。</p> 
<p>    👉 若为自动增长字段插入 <code>NULL</code>、<code>0</code>、<code>DEFAULT</code> 或在插入时省略该字段，则该字段就会使用自动增长值；若插入的是一个具体值，则不会使用自动增长值。</p> 
<p>    👉 自动增长值从 1 开始自增，每次加 1。若插入的值大于自动增长的值，则下次插入的自动增长值会自动使用最大值加 1；若插入的值小于自动增长值，则不会对自动增长值产生影响。</p> 
<p>    👉 使用 DELETE 删除记录时，自动增长值不会减小或填补空缺。</p> 
<p>🐬<strong>查看自动增长值</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 数据库名\G
</code></pre> 
<p>🐬<strong>修改自动增长</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 数据库名 <span class="token keyword">AUTO_INCREMENT</span> <span class="token operator">=</span> 值<span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>删除自动增长</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 数据库名 <span class="token keyword">MODIFY</span> 字段名 字段类型 <span class="token punctuation">[</span>字段属性<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>添加自动增长</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 数据库名 <span class="token keyword">MODIFY</span> 字段名 字段类型 <span class="token punctuation">[</span>字段属性<span class="token punctuation">]</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>通过 <code>SHOW VARIABLES LIKE 'auto_increment%';</code> 可以查看 MySQL 中用于维护自动增长的变量分别是 <code>auto increment_ increment(默认值1)</code> 和 <code>auto_increment_offset(默认值为1)</code>，通过更改这两个变量可以改变自动增长的计算方式，可以参考官方手册中的详细说明。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/bf/87/pdZCTATR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_1356"></a>字符集与校对集</h3> 
<p>MySQL默认使用的字符集为latin1(ISO-8859-1的别名)，这是一种单字节编码的字符集。</p> 
<p>由于中文汉字属于多字节编码的字符，若要保存中文，需要设置成其他支持中文的字符集，如GBK、UTF8。</p> 
<p>校对集是字符之间的比较关系，在比较、排序等操作时都会用到校对集。</p> 
<p><img src="https://images2.imgbox.com/d8/e1/5w0DFwnD_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1365"></a>字符集与校对集概述</h4> 
<p>🐬<strong>字符集</strong></p> 
<p>字符(character)指计算机中保存的各种文字和符号，包括各种国家的文字、标点符号、图形符号、数字等。</p> 
<p>由于计算机采用二进制保存数据，用户输入的字符将会按照一定的规则转换为二进制后保存，这个过程就是字符编码(character encoding)，将一系列字符的编码规则组合起来就形成了字符集(character set，charset)。</p> 
<p>MySQL提供了各种字符集的支持，通过 <code>SHOW CHARACTER SET;</code> 可以查看可用字符集。</p> 
<p>常用字符集</p> 
<table><thead><tr><th>字符集</th><th>单字符最大长度</th><th>支持的语言</th></tr></thead><tbody><tr><td>latin1</td><td>1字节</td><td>西欧字符、希腊字符等</td></tr><tr><td>gbk</td><td>2字节</td><td>简体和繁体中文、日文、韩文等</td></tr><tr><td>utf8</td><td>3字节</td><td>世界上大部分国家的文字</td></tr></tbody></table> 
<p>单字符占用的存储空间越多，所支持的语言越多。</p> 
<p>表中列举的字符集都向下兼容 <code>ASCII(美国信息交换标准代码)</code>，若输入的字符在 ASCII 范围内(0x00~0x7F)，则编码结果是完全相同的。</p> 
<blockquote> 
 <p>由于历史原因，MySQL 中的 utf8 编码与标准的 UTF-8(RFC3629) 存在一些差别。标准的 UTF-8 规定一个字符最多使用 4 字节，而 MySQL 中的 utf8 编码一个字符最多使用 3 字节，这导致 UTF-8 中的一些特殊字符（如emoji符号）无法在 MySQL 的 utf8 编码中使用。为了解决这个问题，MySQL从5.5.3版本开始新增了 utf8mb4 编码，将一个字符扩展到4字节。因此，如果要考虑支持 RFC3629 规范，应使用 utf8mb4 编码。</p> 
</blockquote> 
<p>🐬<strong>校对集</strong></p> 
<p>MySQL中提供了许多校对集，用于为不同字符集指定比较和排序规则。</p> 
<p>例如，latin1字符集默认的校对集为 <code>latin1_swedish_ci</code>。</p> 
<p>校对集的名称由 <code>_</code> 分隔的3部分组成，开头是对应的字符集，中间是国家名或 general，结尾是 ci、cs或bin。其中，ci 表示不区分大小写，cs 表示区分大小写，bin 表示以二进制方式比较。</p> 
<p>通过 <code>SHOW COLLATION;</code> 可以查看 MySQL 可用的校对集。</p> 
<p><img src="https://images2.imgbox.com/38/ea/W1dtGEgQ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1400"></a>字符集与校对集的设置</h4> 
<p>🐬<strong>MySQL环境</strong></p> 
<p>使用 MySQL 命令 <code>SHOW VARIABLES LIKE 'character%';</code>可以查看与字符集相关的变量。</p> 
<pre><code class="prism language-sql"><span class="token operator">+</span><span class="token comment">-------------------------------+--------------------------------+</span>
<span class="token operator">|</span> Variable_name          		<span class="token operator">|</span><span class="token keyword">Value</span>							 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------------+--------------------------------+</span>
<span class="token operator">|</span> character_set_client			<span class="token operator">|</span> gbk							 <span class="token operator">|</span>
<span class="token operator">|</span> character_set_connection		<span class="token operator">|</span> gbk							 <span class="token operator">|</span>
<span class="token operator">|</span> character_set_database		<span class="token operator">|</span> latin1						 <span class="token operator">|</span>
<span class="token operator">|</span> character_set_filesystem		<span class="token operator">|</span> <span class="token keyword">binary</span>						 <span class="token operator">|</span>
<span class="token operator">|</span> character_set_results			<span class="token operator">|</span> gbk							 <span class="token operator">|</span>
<span class="token operator">|</span> character_set_server			<span class="token operator">|</span> latin1						 <span class="token operator">|</span>
<span class="token operator">|</span> character_set_system			<span class="token operator">|</span> utf8							 <span class="token operator">|</span>
<span class="token operator">|</span> character_sets_dir		    <span class="token operator">|</span> C:\mysql5<span class="token punctuation">.</span><span class="token number">7</span>\<span class="token keyword">share</span>\charsets\    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------------+--------------------------------+</span>
</code></pre> 
<p>上述结果表示当前会话(Session)使用的字符集，在不同客户端环境中的输出结果可能不同。</p> 
<p>这里所说的会话，是指从客户端登录服务器到退出的整个过程。例如，依次打开两个客户端并登录服务器，就产生了两个会话，不同客户端属于不同的会话。</p> 
<p>不同的客户端可以指定不同的字符集环境配置，服务器会按照不同的配置进行处理。</p> 
<table><thead><tr><th>变量名</th><th>说 明</th></tr></thead><tbody><tr><td>character_set_client</td><td>客户端字符集</td></tr><tr><td>character_set_connection</td><td>客户端与服务器连接使用的字符集</td></tr><tr><td>character_set_database</td><td>默认数据库使用的字符集（从5.7.6版本开始不推荐使用）</td></tr><tr><td>character_set_filesystem</td><td>文件系统字符集</td></tr><tr><td>character_set_results</td><td>将查询结果（如结果集或错误消息）返回给客户端的字符集</td></tr><tr><td>character_set_server</td><td>服务器默认字符集</td></tr><tr><td>character_set_system</td><td>服务器用来存储标识符的字符集</td></tr><tr><td>character_sets_dir</td><td>安装字符集的目录</td></tr></tbody></table> 
<p>重点关注的变量是 <code>character_set_client</code>、 <code>character_set_connection</code>、<code>character_set_results</code> 和 <code>character_set_server</code>。</p> 
<p>character_set_server 决定了新创建的数据库默认使用的字符集。数据库的字符集决定了数据表的默认字符集，数据表的字符集决定了字段的默认字符集。</p> 
<p>character_set_client、character_set_connection 和character_set_results 分别对应客户端、连接层和查询结果的字符集。</p> 
<p>通常情况下，这3个变量的值是相同的，具体值由客户端的编码而定，从而使客户端输入的字符和输出的查询结果都不会出现乱码。</p> 
<p>通过 <code>set 变量名 = 值;</code> 命令可以更改变量的值。</p> 
<pre><code class="prism language-sql"><span class="token keyword">set</span> character_set_client<span class="token operator">=</span>gbk<span class="token punctuation">;</span>
<span class="token keyword">set</span> character_set_connection<span class="token operator">=</span>gbk<span class="token punctuation">;</span>
<span class="token keyword">set</span> character_set_results<span class="token operator">=</span>gbk<span class="token punctuation">;</span>
</code></pre> 
<p>上述命令输入比较麻烦，在 MySQL 中还可以通过 <code>set names 字符集;</code> 直接修改上述3个变量的值，即<code>set names gbk;</code>。</p> 
<p>🐬<strong>注意：</strong></p> 
<p>    👉 使用 set或 set names 修改字符集只对当前会话有效，不影响其他会话，且会话结束后，下次会话仍然使用默认值。</p> 
<p>    👉 与 character_set_connection、character_set_database、character_set_server 对应的校对集分别通过变量 collation_connection、collation_database、collation_server来指定。</p> 
<p>    👉 若字段使用 utf8 字符集，而客户端使用 gbk 字符集，MySQL 会自动进行编码转换。由于 utf8 和 gbk 本质上是不同的字符集，虽然大部分常见的字符可以转换成功，但若遇到其中一个字符集中没有的特殊字符，则可能会出现乱码。</p> 
<p>🐬<strong>数据库</strong></p> 
<p>在创建数据库时设定字符集和校对集。</p> 
<pre><code class="prism language-sql"><span class="token punctuation">[</span><span class="token keyword">DEFAULT</span><span class="token punctuation">]</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> charset_name
<span class="token punctuation">[</span><span class="token keyword">DEFAULT</span><span class="token punctuation">]</span> <span class="token keyword">COLLATE</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> collation_name
</code></pre> 
<p>CHARACTER SET 用于指定字符集，COLLATE 用于指定校对集。</p> 
<p>若仅指定字符集，表示使用该字符集的默认校对集；若仅指定校对集，表示使用该校对集对应的字符集。</p> 
<p><strong>示例</strong></p> 
<pre><code class="prism language-sql"><span class="token comment"># 创建数据库，指定字符集为 utf8，使用默认校对集 utf8_general_ci</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> 数据库名 <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8<span class="token punctuation">;</span>
<span class="token comment"># 创建数据库，指定字符集为 utf8，校对集为 utf8_bin</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> 数据库名 <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin<span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>数据表</strong></p> 
<p>数据表的字符集与校对集在表选项中设定。</p> 
<pre><code class="prism language-sql"><span class="token punctuation">[</span><span class="token keyword">DEFAULT</span><span class="token punctuation">]</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> charset_name
<span class="token punctuation">[</span><span class="token keyword">DEFAULT</span><span class="token punctuation">]</span> <span class="token keyword">COLLATE</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span> collation_name
</code></pre> 
<p>若没有为数据表指定字符集，则自动使用数据库的字符集。</p> 
<p>🐬<strong>字段</strong></p> 
<p>字段的字符集与校对集在字段属性中设定。</p> 
<pre><code class="prism language-sql"><span class="token punctuation">[</span><span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> charset_name<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">COLLATE</span> collation_name<span class="token punctuation">]</span>
</code></pre> 
<p>若没有为字段设定字符集与校对集，则会自动使用数据表的字符集与校对集。</p> 
<p><strong>示例</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 数据表名 <span class="token punctuation">(</span>
	username <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8 <span class="token keyword">COLLATE</span> utf8_bin
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0b/3d/J65aAo0G_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_1516"></a>数据库设计</h3> 
<p>数据库设计要求设计人员对数据库有深入的理解，才能设计出高质量的数据库。数据库设计一般分为 6 个阶段，分别是需求分析、概念数据库设计、逻辑数据库设计、物理数据库设计、数据库实施、数据库运行和维护。</p> 
<p>🐬<strong>需求分析</strong></p> 
<p>需求分析阶段，数据库设计人员需要分析用户的需求，将分析结果记录下来，形成需求分析报告。</p> 
<p>在这个阶段中，双方需要进行深入的沟通，以避免理解不准确导致后续的工作出现问题。</p> 
<p>在需求分析中有许多琐碎、耗时的工作，常见的工作如下：</p> 
<ul><li>收集数据</li><li>解决冲突，包括命名冲突(同名异义、异名同义）、属性冲突、结构冲突</li><li>为数据形成一些标准</li></ul> 
<p>🐬<strong>概念数据库设计</strong></p> 
<p>在概念数据库设计阶段，将对用户的需求进行综合、归纳、抽象，形成概念模型。</p> 
<p>概念模型使设计人员摆脱数据库系统的具体技术问题，将精力集中在分析数据及数据之间联系等方面。一般通过绘制E-R图，直观呈现数据库设计人员对用户需求的理解。</p> 
<p>🐬<strong>逻辑数据库设计</strong></p> 
<p>逻辑数据库设计面向数据库系统，在概念数据库设计中完成 E-R 图等成果后，将其转换为 DBMS 支持的数据模型(如关系模型)，完成实体、属性和联系的转换。</p> 
<p>在进行逻辑数据库设计时，应遵循一些规范化理论，如范式。不规范的设计可能会导致数据库出现大量冗余、插入异常、删除异常等问题。</p> 
<p>🐬<strong>物理数据库设计</strong></p> 
<p>物理数据库设计阶段需要确定数据库的存储结构、文件类型等。</p> 
<p>通常DBMS为了保证其独立性与可移植性，承担了大部分任务，数据库设计人员只需要考虑硬件、操作系统的特性，为数据表选择合适的存储引擎，为字段选择合适的数据类型等，以及评估磁盘空间需求等工作。</p> 
<p>🐬<strong>数据库实施</strong></p> 
<p>数据库实施就是将前面那些工作的成果实施起来，比如使用SQL语句创建数据库、数据表，编写与调试应用程序等。</p> 
<p>🐬<strong>数据库运行和维护</strong></p> 
<p>数据库运行和维护就是将数据库系统正式投入运行，在运行后进行一些维护、调整、备份、升级等工作。</p> 
<p><img src="https://images2.imgbox.com/1b/40/IZHM4mys_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_1558"></a>数据库设计范式</h3> 
<p>数据库设计对数据的存储性能、数据的操作都有很大的关系。为了避免不规范的数据库出现数据冗余，造成插入、删除、更新操作异常等情况，就要满足一定的规范化要求，这就是范式(Normal Form)。</p> 
<p>根据要求的程度不同，范式有多种级别，最常用的有第一范式(1NF)、第二范式(2NF) 和 第三范式(3NF)，它们由 Edgar Frank Codd 于1971年相继提出。后来，又有人提出了 Boyce-Codd 范式(BCNF)、第四范式(4NF) 和 第五范式(5NF)等。</p> 
<p>一般来说，数据库设计只需满足第三范式(3NF)就可以了。</p> 
<p><img src="https://images2.imgbox.com/38/fc/RReNuJOM_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1567"></a>第一范式</h4> 
<p>第一范式(1NF) 是指数据库表的每一列都是不可分割的基本数据项，同一列中不能有多个值，即实体中的某个属性不能有多个值，或不能有重复的属性。</p> 
<p>简而言之，第一范式遵从原子性，属性不可再分。</p> 
<p>🐬<strong>演示</strong></p> 
<p>❌不满足第一范式的情况。</p> 
<p><img src="https://images2.imgbox.com/0f/2b/8ulJ9N59_o.png" alt="在这里插入图片描述"><br> 👉表格中倾斜的字体为主键。</p> 
<p>👉表1 的问题在于 “联系方式” 包含了多个值，可以再细分；表2 的问题在于 “手机号” 属性重复。</p> 
<p>✔️为了满足第一范式，应将用户和联系方式分成两个表保存，两个表是一对多的联系，如下图所示。</p> 
<p><img src="https://images2.imgbox.com/c0/1e/ky1xWRy5_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/63/b5/13WZ1cOA_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1587"></a>第二范式</h4> 
<p>第二范式(2NF) 是在第一范式的基础上建立起来的，满足第二范式必须先满足第一范式。</p> 
<p>第二范式要求实体的属性完全依赖于主键，不能仅依赖主键的一部分(对于复合主键而言)。</p> 
<p>简而言之，第二范式遵从唯一性，非主键字段需完全依赖主键。</p> 
<p>🐬<strong>演示</strong></p> 
<p>❌不满足第二范式的情况。</p> 
<p><img src="https://images2.imgbox.com/de/f0/VhTWF1qV_o.png" alt="在这里插入图片描述"></p> 
<p>👉表格中倾斜的字体为主键。</p> 
<p>👉在表6中，用户编号和订单编号组成了复合主键，付款状态完全依赖复合主键，而用户名只依赖用户编号。</p> 
<p>👉采用上述方式设计的用户表存在如下问题：</p> 
<ul><li>插入异常：如果一个用户没有下过订单，则该用户无法插入；</li><li>删除异常：如果删除一个用户所有的订单，则该用户也会被删除；</li><li>更新异常：由于用户名冗余，修改一个用户时需要修改多条记录。如果稍有不慎，漏改某些记录，会出现更新异常。</li></ul> 
<p>✔️为了满足第二范式，将复合主键移动到订单表中，如下图所示。</p> 
<p><img src="https://images2.imgbox.com/04/70/EmHtXlR9_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/ec/90/yNBUoW7U_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1617"></a>第三范式</h4> 
<p>第三范式(3NF)是在第二范式的基础上建立起来的，即满足第三范式必须先满足第二范式。</p> 
<p>第三范式要求一个数据表中每一列数据都和主键直接相关，而不能间接相关。</p> 
<p>简而言之，第三范式就是非主键字段不能相互依赖。</p> 
<p>🐬<strong>演示</strong></p> 
<p>❌不满足第三范式的情况。</p> 
<p><img src="https://images2.imgbox.com/b9/fe/0SIddM8e_o.png" alt="在这里插入图片描述"><br> 👉表格中倾斜的字体为主键。</p> 
<p>👉在表9中，用户享受的折扣与用户等级相关，两者存在依赖关系。</p> 
<p>👉采用这种方式设计的用户表存在如下问题：</p> 
<ul><li>插入异常：新插入用户的等级如果在1、2之外，其享受的折扣无处参考；</li><li>删除异常：如果删除某个等级下所有的用户，该等级对应的折扣也被删除；</li><li>更新异常：如果修改某个用户的等级，折扣也必须随之修改；如果修改某个等级的折扣，又因为折扣存在冗余，容易发生漏改。</li></ul> 
<p>✔️为了满足第三范式，将等级与折扣拆分到单独的表中，如下图所示。</p> 
<p><img src="https://images2.imgbox.com/bb/f7/dsRHs9PC_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/1f/fc/vIOlKBLa_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_1646"></a>单表操作</h3> 
<p><img src="https://images2.imgbox.com/00/bd/nkEV79S2_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1650"></a>复制表结构和数据</h4> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token punctuation">[</span><span class="token keyword">TEMPORARY</span><span class="token punctuation">]</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> 表名 <span class="token operator">LIKE</span> 旧表名<span class="token punctuation">;</span>
</code></pre> 
<p>在上述语法中，仅能从 <code>旧表名</code> 中复制一份<code>相同</code>的表结构，但不会复制表中保存的数据。</p> 
<p>🐬<strong>复制已有的表数据</strong></p> 
<p>数据复制也可称为蠕虫复制，是新增数据的一种方式，它是从已有的数据中获取数据，并且将获取到的数据插入到对应的数据表中，实现成倍的增加。</p> 
<p>此种方式获取数据与插入数据的表结构要相同，否则可能会遇到插入不成功的情况。</p> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token punctuation">[</span><span class="token keyword">INTO</span><span class="token punctuation">]</span> 数据表名<span class="token number">1</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>字段列表<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">SELECT</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>字段列表<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">FROM</span> 数据表名<span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> 
<p>❗若数据表中含有主键，而主键又具有唯一性，所以在数据复制时还要考虑主键冲突的问题。</p> 
<p><img src="https://images2.imgbox.com/40/ea/LFBIzph4_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1672"></a>临时表的使用</h4> 
<p>临时表指的是一种仅在当前会话中可见，并在当前会话关闭时自动删除的数据表。它主要用于临时存储数据。</p> 
<p>临时表的语法很简单，只需在CREATE与TABLE关键宇中间添加 <code>TEMPORARY</code> 即可。</p> 
<pre><code class="prism language-sql"><span class="token comment"># 方式1：创建临时表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLE</span> mydb<span class="token punctuation">.</span>tem1 <span class="token punctuation">(</span>id <span class="token keyword">INT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#方式2：创建临时表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLE</span> mydb<span class="token punctuation">.</span>tem2 <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> mydb<span class="token punctuation">.</span>goods <span class="token punctuation">;</span>
</code></pre> 
<p>在上迷语句中，创建临时表时指定的数据库可以是 MySQL 服务器中存在的数据库，也可以是不存在的数据库。</p> 
<p>若数据库不存在，操作临时表时必须使用 <code>数据库.临时表名</code> 指定临时表所在的数据库。</p> 
<p>临时表中数据的操作与普通表相同，都可以进行 SELECT、INSERT、UPDATE 和 DELETE 操作。</p> 
<p>SHOW TABLES 不能查看指定数据库下有哪些临时表，并且临时表的表名必须使用 ALTER TABLE 修改，而不能使用 RENAME TABLE … TO 修改。</p> 
<p><img src="https://images2.imgbox.com/ef/48/XE94fgCw_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1696"></a>解决主键冲突</h4> 
<p>在对数据表插人数据时，若表中的主键含有实际的业务意义，因此在插入数据时若不能确定对应的主键是否存在，往往会出现主键冲突的情况。</p> 
<p>例如，mydb.my_goods 表经过数据复制以后，再插入编号为 20 的商品信息(橡皮，文具类，用于修正书写错误），具体SQL语句及执行结果如下。</p> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mydb<span class="token punctuation">.</span>my_goods<span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> content<span class="token punctuation">,</span> keyword<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'橡皮'</span><span class="token punctuation">,</span> <span class="token string">'用于修正书写错误'</span><span class="token punctuation">,</span> <span class="token string">'文具'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ERROR <span class="token number">1062</span> <span class="token punctuation">(</span><span class="token number">23000</span><span class="token punctuation">)</span>: <span class="token keyword">Duplicate</span> entry <span class="token string">'20'</span> <span class="token keyword">for</span> <span class="token keyword">key</span> <span class="token string">'PRIMARY'</span> 
</code></pre> 
<p>从上述的执行结果可知，系统提示插入数据的主键发生冲突。若要解决这类问题，MySQL中提供了两种方式，分别为主键冲突更新和主键冲突替换。</p> 
<p>🐬<strong>主键冲突更新</strong></p> 
<p>主键冲突更新操作指的是，当插人数据的过程中若发生主键冲突，则插入数据操作利用更新的方式实现。</p> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token punctuation">[</span><span class="token keyword">INTO</span><span class="token punctuation">]</span> 数据表名 <span class="token punctuation">[</span><span class="token punctuation">(</span>字段列表<span class="token punctuation">)</span><span class="token punctuation">]</span> {<!-- --><span class="token keyword">VALUES</span> <span class="token operator">|</span> <span class="token keyword">VALUE</span>} <span class="token punctuation">(</span>值列表<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DUPLICATE</span> <span class="token keyword">KEY</span> <span class="token keyword">UPDATE</span> 字段名<span class="token number">1</span> <span class="token operator">=</span> 新值<span class="token number">1</span> <span class="token punctuation">[</span><span class="token punctuation">,</span>字段名<span class="token number">2</span> <span class="token operator">=</span> 新值<span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre> 
<p>在 <code>INSERT</code> 语句后添加 <code>ON DUPLICATE KEY UPDATE</code> 可在发生主键冲突时，更新此条记录中通过 <code>字段名1 = 新值1 [,字段名2 = 新值2] ...</code> 设置的字段名对应的新值。</p> 
<p>例如，修改以上发生主键冲突的插入语句。</p> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mydb<span class="token punctuation">.</span>my_goods<span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> content<span class="token punctuation">,</span> keyword<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'橡皮'</span><span class="token punctuation">,</span> <span class="token string">'用于修正书写错误'</span><span class="token punctuation">,</span> <span class="token string">'文具'</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DUPLICATE</span> <span class="token keyword">KEY</span> <span class="token keyword">UPDATE</span> name <span class="token operator">=</span> <span class="token string">'橡皮'</span><span class="token punctuation">,</span> content <span class="token operator">=</span> <span class="token string">'用于修正书写错误'</span><span class="token punctuation">,</span> keyword <span class="token operator">=</span> <span class="token string">'文具'</span><span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>主键冲突替换</strong></p> 
<p>主键冲突替换操作指的是，当插入数据的过程中若发生主键冲突，则删除此条记录，并重新插入。</p> 
<pre><code class="prism language-sql"><span class="token keyword">REPLACE</span> <span class="token punctuation">[</span><span class="token keyword">INTO</span><span class="token punctuation">]</span> 数据表名 <span class="token punctuation">[</span><span class="token punctuation">(</span>字段列表<span class="token punctuation">)</span><span class="token punctuation">]</span> {<!-- --><span class="token keyword">VALUES</span> <span class="token operator">|</span> <span class="token keyword">VALUE</span>} <span class="token punctuation">(</span>值列表<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">(</span>值列表<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre> 
<p>REPLACE 语句与 INSERT 语句的使用类似，区别在于前者每执行一次就会发生两个操作(删除记录和插入记录)。</p> 
<p>具体SQL语句及执行结果如下。</p> 
<pre><code class="prism language-sql"><span class="token keyword">REPLACE</span> <span class="token keyword">INTO</span> mydb<span class="token punctuation">.</span>my_goods<span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> content<span class="token punctuation">,</span> keyword<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'橡皮'</span><span class="token punctuation">,</span> <span class="token string">'用于修正书写错误'</span><span class="token punctuation">,</span> <span class="token string">'文具'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/93/9c/FGfig3uN_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1743"></a>清空数据</h4> 
<pre><code class="prism language-sql"><span class="token keyword">TRUNCATE</span> <span class="token punctuation">[</span><span class="token keyword">TABLE</span><span class="token punctuation">]</span> 表名<span class="token punctuation">;</span>
</code></pre> 
<p>TRUNCATE 操作虽然与 DELETE 语句的使用非常相似，但是两者在本质上有一定的区别，具体如下。</p> 
<ul><li> <p>实现方式不同</p> 
  <ul><li>TRUNCATE 本质上先执行删除 (DROP) 数据表的操作，然后再根据有效的表结构文件 (.frm) 重新创建数据表的方式来实现数据清空操作。</li><li>DELETE 语句则是逐条地删除数据表中保存的记录。</li></ul> </li><li> <p>执行效率不同</p> 
  <ul><li>在针对大型数据表(如千万级的数据记录)时，TRUNCATE 清空数据的实现方式决定了它比 DELETE 语句删除数据的方式执行效率更高。</li></ul> </li><li> <p>对 AUTO_INCREMENT 的字段影响不同</p> 
  <ul><li>TRUNCATE 清空数据后，再次向表中添加数据，自动增长字段会从默认的初始值重新开始。</li><li>使用DELETE 语句删除表中的记录时，则不影响自动增长值。</li></ul> </li><li> <p>删除数据的范围不同</p> 
  <ul><li>TRUNCATE 语句只能用于清空表中的所有记录，而 DELETE 语句可通过 WHERE 指定删除满足条件的部分记录。</li></ul> </li><li> <p>返回值含义不同</p> 
  <ul><li>TRUNCATE 操作的返回值一般是无意义的，而 DELETE 语句则会返回符合条件被删除的记录数。</li></ul> </li><li> <p>所属SQL语言的不同组成部分<br> -DELETE语句属于DML数据操作语句，而 TRUNCATE 通常被认为是 DDL 数据定义语句。</p> </li></ul> 
<blockquote> 
 <p>当删除的数据量很小时，DELETE 的执行效率要比 TRUNCATE 高；只有删除的数据量很大时，才能看出 TRUNCATE 的执行效率比 DELETE 高。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/28/e5/89aCaJrE_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1775"></a>去除重复记录</h4> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">select</span>选项 字段列表 <span class="token keyword">FROM</span> 数据表
</code></pre> 
<p>select选项 默认值为 <code>All</code>，表示保存所有查询到的记录；当设置为 <code>DISTINCT</code> 时，表示去除重复记录，只保留一条。</p> 
<p>❗当查询记录的字段有多个时，必须所有字段的值完全相同才被认为是重复记录。</p> 
<p><img src="https://images2.imgbox.com/9e/26/yuZnPGBw_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1787"></a>排序</h4> 
<p>🐬<strong>单字段排序</strong></p> 
<p>单字段排序指的是查询时仅按照一个指定字段进行升序或降序排序。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">[</span><span class="token operator">*</span> <span class="token operator">|</span> <span class="token punctuation">(</span>字段列表<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">FROM</span> 数据表名 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 字段名 <span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token operator">|</span> <span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>ASC</code> 表示升序，<code>DESC</code> 表示降序，而 <code>ORDER BY</code> 默认值为 <code>ASC</code>。</p> 
<p>🐬<strong>多字段排序</strong></p> 
<p>当在开发中需要根据多个条件对查询的数据进行排序时，可以采用多字段排序。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">[</span><span class="token operator">*</span> <span class="token operator">|</span> <span class="token punctuation">(</span>字段列表<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">FROM</span> 数据表名 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 字段名<span class="token number">1</span> <span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token operator">|</span> <span class="token keyword">DESC</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> 字段名<span class="token number">2</span> <span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token operator">|</span> <span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p>多字段排序首先按照 字段名1 进行排序，当字段1 的值相同时，再按照 字段名2 进行排序，依此类推。</p> 
<p>数据表的字符集是 <code>utf8</code>，当排序的字段为中文时，默认不会按照中文拼音的顺序排序。那么在不改变数据表结构的情况下，可以使用 <code>CONVERT(字段名 USING gbk)</code> 函数强制让指定的字段按中文排序。</p> 
<p>在按照指定字段进行升序排列时，如果某条记录的字段值为 <code>NULL</code>，则系统会将 <code>NULL</code> 看作是最小的值，从而将其显示在查询结果中的 <code>第一条</code> 记录的位置。</p> 
<p><img src="https://images2.imgbox.com/38/3e/PSsuffIg_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1816"></a>限量</h4> 
<p>对于一次性查询出的大量记录，不仅不便于阅读查看，MySQL中提供了一个关键字 <code>LIMIT</code>，可以限定记录的数量，也可以指定查询从哪一条记录开始。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">[</span><span class="token keyword">select</span>选项<span class="token punctuation">]</span> 字段列表 <span class="token keyword">FROM</span> 数据表名 <span class="token punctuation">[</span><span class="token keyword">WHERE</span>条件表达式<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 字段 <span class="token keyword">ASC</span> <span class="token operator">|</span> <span class="token keyword">DESC</span><span class="token punctuation">]</span> <span class="token keyword">LIMIT</span> <span class="token punctuation">[</span><span class="token keyword">OFFSET</span><span class="token punctuation">,</span><span class="token punctuation">]</span> 记录数<span class="token punctuation">;</span>
</code></pre> 
<p>记录数 表示限定获取的最大记录数量，也就是说，在记录数大于数据表符合要求的实际记录数量时，以实际记录数为准。</p> 
<p>当 LIMIT 后仅含有此参数时，表示从第1条记录开始获取。</p> 
<p>OFFSET 表示偏移量，用于设置从哪条记录开始，MySQL中默认第1条记录的偏移量值为0，第2条记录的偏移量值为1，依此类推。</p> 
<p>🐬<strong>排序后限量更新或删除数据</strong></p> 
<p>在MySQL中除了对查询记录进行排序和限量外，对数据表中记录的更新与删除操作也可以进行排序和限量。</p> 
<pre><code class="prism language-sql"><span class="token comment"># 数据更新的排序与限量</span>
<span class="token keyword">UPDATE</span> 数据表名 <span class="token keyword">SET</span> 字段 <span class="token operator">=</span> 新值<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token keyword">WHERE</span> 条件表达式<span class="token punctuation">]</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 字段 <span class="token keyword">ASC</span><span class="token operator">|</span><span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> 记录数<span class="token punctuation">;</span>

<span class="token comment">#数据删除的排序与限量</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> 数据表名<span class="token punctuation">[</span><span class="token keyword">WHERE</span> 条件表达式<span class="token punctuation">]</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 字段 <span class="token keyword">ASC</span><span class="token operator">|</span><span class="token keyword">DESC</span> <span class="token keyword">LIMIT</span> 记录数<span class="token punctuation">;</span>
</code></pre> 
<p>UPDATE和 DELETE 操作中添加 ORDER BY 表示根据指定的字段，按顺序更新或删除符合条件的记录。如果 UPDATE 和 DELETE 操作没有添加 WHERE 条件，则可以使用 LIMIT 来限制更新和删除的数量。</p> 
<p>例如，为sh_goods表中价格最便宜的两种商品库存设置为500。</p> 
<pre><code class="prism language-sql"><span class="token keyword">UPDATE</span> sh_goods <span class="token keyword">SET</span> stock <span class="token operator">=</span> <span class="token number">500</span> <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> price <span class="token keyword">ASC</span> <span class="token keyword">LIMIT</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/89/c2/s8J7y5aw_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1852"></a>别名</h4> 
<p>在MySQL中执行查询操作时，可以根据具体情况为获取的字段设置别名。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 字段<span class="token number">1</span> <span class="token punctuation">[</span><span class="token keyword">AS</span><span class="token punctuation">]</span> 别名<span class="token number">1</span><span class="token punctuation">,</span> 字段<span class="token number">2</span> <span class="token punctuation">[</span><span class="token keyword">AS</span><span class="token punctuation">]</span> 别名<span class="token number">2</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token keyword">FROM</span> 表名<span class="token punctuation">;</span>
</code></pre> 
<p>AS 用于为其前面的字段、表达式、函数等设置别名。也可以省略AS使用空格代替。</p> 
<p>在MySQL中还可以使用 AS 为数据表设置别名。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 表别名<span class="token punctuation">.</span>字段 <span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token keyword">FROM</span> 表名 <span class="token punctuation">[</span><span class="token keyword">AS</span><span class="token punctuation">]</span> 表别名
</code></pre> 
<p>同样地，在为数据表设置别名时，AS也可以省略，使用空格代替。</p> 
<p>字段与表设置别名后，在排序和分组中可以使用原来的字段名等，也可以使用别名。表的别名主要在多表查询中使用。</p> 
<p><img src="https://images2.imgbox.com/fe/f3/Xk0JZxlM_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1874"></a>聚合函数</h4> 
<p>常用的聚合函数</p> 
<table><thead><tr><th>函 数 名</th><th>描 述</th></tr></thead><tbody><tr><td>COUNT()</td><td>返回参数字段的数量，不统计为NULL的记录</td></tr><tr><td>SUM()</td><td>返回参数字段之和</td></tr><tr><td>AVG()</td><td>返回参数字段的平均值</td></tr><tr><td>MAX()</td><td>返回参数字段的最大值</td></tr><tr><td>MIN()</td><td>返回参数字段的最小值</td></tr><tr><td>GROUP_CONCAT()</td><td>返回符合条件的参数字段值的连接字符串</td></tr><tr><td>JSON_ARRAYAGG()</td><td>将符合条件的参数字段值作为单个JSON数组返回，MySQL5.7.22新增</td></tr><tr><td>JSON_OBJECTAGG()</td><td>将符合条件的参数字段值作为单个JSON对象返回，MySQL5.7.22新增</td></tr></tbody></table> 
<p>COUNT()、SUM()、AVG()、MAX()、MIN() 和 GROUP_CONCAT() 函数中可以在参数前添加DISTINCT，表示对不重复的记录进行相关操作。</p> 
<p>COUNT() 的参数设置为 <code>*</code> 时，表示统计符合条件的所有记录（包含NULL)。</p> 
<p><img src="https://images2.imgbox.com/55/86/BA8CGa8n_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_1894"></a>分组</h3> 
<p><img src="https://images2.imgbox.com/19/59/8DB8Kahh_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1898"></a>分组统计</h4> 
<p>在查询数据时，在 WHERE 条件后添加 GROUP BY 即可根据指定的字段进行分组。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">[</span><span class="token keyword">select</span>选项<span class="token punctuation">]</span> 字段列表 <span class="token keyword">FROM</span> 数据表名 <span class="token punctuation">[</span><span class="token keyword">WHERE</span> 条件表达式<span class="token punctuation">]</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 字段名<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/78/f1/AXxbsIbV_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1907"></a>分组排序</h4> 
<p>在MySQL中，默认情况下为分组操作的字段提供了升序排序的功能，因此在分组时可以为指定的字段进行升序或降序排序。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">[</span><span class="token keyword">select</span>选项<span class="token punctuation">]</span> 字段列表 <span class="token keyword">FROM</span> 数据表名 <span class="token punctuation">[</span><span class="token keyword">WHERE</span> 条件表达式<span class="token punctuation">]</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 字段名<span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token operator">|</span> <span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p>GROUP BY 分组排序的实现不需要使用 ORDER BY，直接在分组字段后添加 ASC(升序，默认值可省略) 或 DESC(降序) 即可。</p> 
<p><img src="https://images2.imgbox.com/59/ba/yqW9IvxE_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1919"></a>多分组统计</h4> 
<p>在对数据进行分组统计时，MySQL中还支持数据按照某个字段进行分组后，对已经分组的数据进行再次分组的操作，以实现多分组统计。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">[</span><span class="token keyword">select</span>选项<span class="token punctuation">]</span> 字段列表 <span class="token keyword">FROM</span> 数据表名 <span class="token punctuation">[</span><span class="token keyword">WHERE</span> 条件表达式<span class="token punctuation">]</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 字段名<span class="token number">1</span> <span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token operator">|</span> <span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>字段名<span class="token number">2</span> <span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token operator">|</span><span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre> 
<p>查询出的数据首先按照字段1进行分组排序，再将字段1相同的结果按照字段2进行分组排序，依此类推。</p> 
<p><img src="https://images2.imgbox.com/42/bc/IknGKUjI_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1930"></a>回溯统计</h4> 
<p>回溯统计可以简单地理解为在根据指定字段分组后，系统又自动对分组的字段向上进行了一次新的统计并产生一个新的统计数据，且该数据对应的分组字段值为 NULL。</p> 
<p>回溯统计的实现很简单，只需要在 <code>GROUP BY 字段</code> 后添加 <code>WITH ROLLUP</code> 即可。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">[</span><span class="token keyword">select</span> 选项<span class="token punctuation">]</span> 字段列表 <span class="token keyword">FROM</span> 数据表名 <span class="token punctuation">[</span><span class="token keyword">WHERE</span> 条件表达式<span class="token punctuation">]</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 字段名<span class="token number">1</span> <span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token operator">|</span><span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>字段名<span class="token number">2</span> <span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token operator">|</span> <span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">WITH ROLLUP</span><span class="token punctuation">;</span>
</code></pre> 
<p>下面查看 sh_goods 表中每个分类 category_id 下的商品数量为例演示回溯统计的使用。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> category_id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> sh_goods <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> category_id <span class="token keyword">WITH ROLLUP</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+---------+</span>
<span class="token operator">|</span> category_id <span class="token operator">|</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+---------+</span>
<span class="token operator">|</span>		<span class="token number">3</span>     <span class="token operator">|</span>		<span class="token number">3</span>   <span class="token operator">|</span>
<span class="token operator">|</span>		<span class="token number">6</span>	  <span class="token operator">|</span>		<span class="token number">1</span>   <span class="token operator">|</span>
<span class="token operator">|</span>	   <span class="token boolean">NUll</span>   <span class="token operator">|</span>     <span class="token number">4</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+---------+</span>
</code></pre> 
<p>从上述执行结果可知，在获取每种商品分类 category_id 下的商品数量后，系统又自动对获取的数量进行了一次累加统计，并且此累加的新数据(如4)对应的分组字段(如category_id)的值为NULL。此行的记录就是对category_id分组的一次回溯统计。</p> 
<p>在了解了单字段的分组回溯统计后，演示如何在MySQL中对多分组进行回溯统计。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> score<span class="token punctuation">,</span> comment_count<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> sh_goods <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> score<span class="token punctuation">,</span> comment_count <span class="token keyword">WITH ROLLUP</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------+---------------+----------+</span>
<span class="token operator">|</span> score <span class="token operator">|</span> comment_count <span class="token operator">|</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+---------------+----------+</span>
<span class="token operator">|</span> <span class="token number">2.5</span>   <span class="token operator">|</span>		<span class="token number">200</span>     <span class="token operator">|</span>	 <span class="token number">1</span>     <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">2.5</span>   <span class="token operator">|</span>		<span class="token boolean">NUll</span>  	<span class="token operator">|</span> 	 <span class="token number">1</span>	   <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3.9</span>   <span class="token operator">|</span>		<span class="token number">500</span>		<span class="token operator">|</span>    <span class="token number">2</span>     <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token number">3.9</span>   <span class="token operator">|</span>		<span class="token boolean">NUll</span> 	<span class="token operator">|</span>    <span class="token number">2</span>     <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token boolean">NUll</span>  <span class="token operator">|</span>		<span class="token boolean">NUll</span> 	<span class="token operator">|</span>    <span class="token number">3</span>     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------+---------------+----------+</span>
</code></pre> 
<p>在上述SQL语句中，分组操作根据 GROUP BY 后的字段从前往后依次执行，即先按 score 分组，然后再按 comment_count 分组；</p> 
<p>数据分组后系统再进行回溯统计，它与分组的操作正好相反，从 GROUP BY 后最后一个指定的分组字段开始回溯统计，并将结果上报，然后根据上报结果依次向前一个分组的字段进行回溯统计，即先回溯统计 comment_count 分组的结果，再根据 comment_count 的回溯结果对 score 分组进行回溯统计。</p> 
<p>从执行结果可看出，score 值相同的情况下，按 comment_count 分组后，实现了 2 次回溯统计，对应的分组字段 comment_count 含有 2 个 NULL 值，统计结果分别进行了累加；接着按上次的结果对score 分组字段进行了1次回溯统计，对应的分组字段 score 中含有一个NULL值，然后又对上一次的统计结果再次进行累加。</p> 
<p>虽然回溯统计对数据的分析很有帮助，但是MySQL的同一个查询语句中回溯统计(WITH ROLLUP) 与排序(ORDER BY) 仅能出现一个。</p> 
<p><img src="https://images2.imgbox.com/1d/85/9lezc2KU_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_1979"></a>统计筛选</h4> 
<p>当对查询的数据执行分组操作时，可以利用 HAVING 根据条件进行数据筛选，与WHERE功能相同，但是在实际运用时两者有一定的区别。</p> 
<p>    👉 WHERE 操作是从数据表中获取数据，将数据从磁盘存储到内存中，而 HAVING 是对已存放到内存中的数据进行操作。</p> 
<p>    👉 HAVING 位于GROUP BY 子句后，而 WHERE 位于 GROUP BY 子句之前。</p> 
<p>    👉 HAVING 关键字后可以使用聚合函数，而 WHERE 则不可以。通常情况下，HAVING 关键字与GROUP BY 一起使用，对分组后的结果进行过滤。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token punctuation">[</span><span class="token keyword">select</span>选项<span class="token punctuation">]</span> 字段列表 <span class="token keyword">FROM</span> 数据表名 <span class="token punctuation">[</span><span class="token keyword">WHERE</span> 条件表达式<span class="token punctuation">]</span> <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 字段名 <span class="token punctuation">[</span><span class="token keyword">ASC</span> <span class="token operator">|</span> <span class="token keyword">DESC</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token keyword">WITH ROLLUP</span><span class="token punctuation">]</span> <span class="token keyword">HAVING</span> 条件表达式<span class="token punctuation">;</span>
</code></pre> 
<p>WHERE 条件之后的所有语句都是对内存中的数据进行操作。而 HAVING 则根据条件表达式对分组后的内容进行过滤。</p> 
<p><img src="https://images2.imgbox.com/46/65/iKXwtqot_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_1995"></a>运算符</h3> 
<p>在数据库操作中，数据的 SELECT、UPDATE 和 DELETE 等操作都可以使用条件表达式，用于获取、更新 或 删除 给定条件的数据。</p> 
<p><img src="https://images2.imgbox.com/08/ed/VoHTg36C_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2001"></a>算术运算符</h4> 
<p>算术运算符适用于数值类型的数据，通常应用在 SELECT 查询结果的字段中，在 WHERE 条件表达式中应用较少。</p> 
<table><thead><tr><th>运算符</th><th>描 述</th><th>运算符</th><th>描 述</th></tr></thead><tbody><tr><td>+</td><td>加运算</td><td>/</td><td>除运算</td></tr><tr><td>-</td><td>减运算</td><td>%</td><td>取模运算</td></tr><tr><td>*</td><td>乘运算</td><td></td><td></td></tr></tbody></table> 
<p>运算符两端的数据可以是真实的数据(如5)，或数据表中的字段(如price)，而参与运算的数据一般称之为操作数，操作数与运算符组合在一起统称为表达式(如5+2)。</p> 
<p>在MySQL中可以直接利用SELECT查看数据的运算结果。</p> 
<p>🐬<strong>无符号的加减乘法运算</strong></p> 
<p>在MySQL中，若运算符 <code>+</code> <code>－</code> 和 <code>*</code> 的操作数都是无符号整型，则运算结果也是无符号整型。</p> 
<p>例如，商品表 sh_goods 中的 id 字段就是无符号整型，下面对 sh_goods 表中前2条记录的 id 进行加1、减1 以及 乘2 操作。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> id<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> id<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> id<span class="token operator">*</span><span class="token number">2</span> <span class="token keyword">FROM</span> sh_goods <span class="token keyword">LIMIT</span> <span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----+------+------+------+</span>
<span class="token operator">|</span> id <span class="token operator">|</span> id<span class="token operator">+</span><span class="token number">1</span> <span class="token operator">|</span> id<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">|</span> id<span class="token operator">*</span><span class="token number">2</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+------+------+------+</span>
<span class="token operator">|</span>  <span class="token number">1</span> <span class="token operator">|</span>  <span class="token number">2</span>   <span class="token operator">|</span>  <span class="token number">0</span>   <span class="token operator">|</span>   <span class="token number">2</span>  <span class="token operator">|</span>
<span class="token operator">|</span>  <span class="token number">2</span> <span class="token operator">|</span>  <span class="token number">3</span>   <span class="token operator">|</span>  <span class="token number">1</span>   <span class="token operator">|</span>   <span class="token number">4</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----+------+------+------+</span>
</code></pre> 
<p>🐬<strong>有符号的减法运算结果</strong></p> 
<p>MySQL中，默认情况下运算符 <code>－</code> 的操作数若都为无符号整型，则结果一定是无符号的整型、若操作数的差值为负数，那么系统就会报错。</p> 
<p>例如，对 sh_ goods 表中前2条记录的id执行减3操作。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> id<span class="token operator">-</span><span class="token number">3</span> <span class="token keyword">FROM</span> sh_goods <span class="token keyword">LIMIT</span> <span class="token number">2</span><span class="token punctuation">;</span>
ERROR <span class="token number">1690</span> <span class="token punctuation">(</span><span class="token number">22003</span><span class="token punctuation">)</span>: BIGINI <span class="token keyword">UNSIGNED</span> <span class="token keyword">value</span> <span class="token operator">is</span> <span class="token keyword">out</span> <span class="token keyword">of</span> range <span class="token operator">in</span> <span class="token string">'('</span>shop<span class="token string">'.'</span>sh_goods<span class="token string">'.'</span>id<span class="token string">' -3)'</span>
</code></pre> 
<p>从上述执行结果可知，减法运算的结果已经超出了无符号 BIGINT 的最大范围。因此，无论运算符 <code>－</code> 的操作数是否含有符号，若要获得一个有符号的运算结果，可以使用 <code>CAST(... AS SIGNED）</code> 将无符号整型 id 强制转换为有符号的整型数据。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> CAST<span class="token punctuation">(</span>id <span class="token keyword">AS</span> SIGNED<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">3</span> <span class="token keyword">FROM</span> sh_goods <span class="token keyword">LIMIT</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------------+</span>
<span class="token operator">|</span> CAST<span class="token punctuation">(</span>id <span class="token keyword">AS</span> SIGNED<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">3</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+</span>
<span class="token operator">|</span>  					<span class="token operator">-</span><span class="token number">2</span> <span class="token operator">|</span>
<span class="token operator">|</span>					<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------------+</span>
</code></pre> 
<p>上述执行结果，<code>-2</code> 和 <code>－1</code> 中的符号 <code>－</code>，表示负号，它是一个一元操作符，仅有一个操作数，如2。而运算符 <code>－</code> 表示减法运算时，是一个二元操作符，有两个操作数，如 <code>id-3</code> 中的 <code>id</code> 和<code>3</code>。</p> 
<p>🐬<strong>含有精度的运算</strong></p> 
<p>算术运算除了可以对整数运算外，还可以对浮点数进行运算。</p> 
<p>在对浮点数进行加减运算时，运算结果中的精度(小数点后的位数)等于参与运算的操作数的最大精度。</p> 
<p>例如 1.2+1.400，1.400 的精度最大为 3，则运算结果的精度就为 3；在对浮点数进行乘法运算时，运算结果中的精度，以参与运算的操作数的精度和为准。例如 1.2*1.400，1.2 的精度为 1，1.400 的精度为3，则运算结果中的精度就为4(1+3)。</p> 
<p>🐬<b>/ 运算</b></p> 
<p>运算符 <code>/</code> 在MySQL中用于除法操作，且运算结果使用浮点数表示，浮点数的精度等于被除数( <code>/</code> 运算符左侧的操作数) 的精度加上系统变量 div_precision_increment 设置的除法精度增长值，读者可通过以下SQL语句查找其默认值。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'div_precision_increment'</span>
<span class="token operator">+</span><span class="token comment">-------------------------+-------+</span>
<span class="token operator">|</span> Variable_name           <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------+-------+</span>
<span class="token operator">|</span> div_precision_increment <span class="token operator">|</span>   <span class="token number">4</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------------------+-------+</span>
</code></pre> 
<p>🐬<strong>NULL参与算术运算</strong></p> 
<p>在算术运算中，NULL是一个特殊的值，它参与的算术运算结果均为NULL。</p> 
<p>🐬<strong>DIV与MOD运算符</strong></p> 
<p>在MySQL中，运算符<code>DIV</code> 与 <code>/</code> 都能实现除法运算，区别在于前者的除法运算结果会去掉小数部分，只返回整数部分。</p> 
<p>MySQL中的运算符 <code>MOD</code> 与 <code>%</code> 功能相同，都用于取模运算。</p> 
<p>❗取模运算结果的正负与被模数(%左边的操作数)的符号相同，与模数(%右边的操作数)符号无关。</p> 
<p>MySQL中还提供了很多进行数学运算的函数，常用的数学函数如下。</p> 
<table><thead><tr><th>运 算 符</th><th>描 述</th></tr></thead><tbody><tr><td>CEIL(x)</td><td>返回大于等于 x 的最小整数</td></tr><tr><td>FLOOR(x)</td><td>返回小于等于 x 的最大整数</td></tr><tr><td>FORMAT(x,y)</td><td>返回小数点后保留 y 位的 x(进行四舍五入)</td></tr><tr><td>ROUND(x [,y])</td><td>计算离x最近的整数；若设置参数y，与FORMAT(x,y)功能相同</td></tr><tr><td>TRUNCATE(x,y)</td><td>返回小数点后保留 y 位的 x(舍弃多余小数位，不进行四舍五入)</td></tr><tr><td>ABS(x)</td><td>获取x的绝对值</td></tr><tr><td>MOD(x,y)</td><td>求模运算，与x%y的功能相同</td></tr><tr><td>PI()</td><td>计算圆周率</td></tr><tr><td>SQRT(×)</td><td>求x的平方根</td></tr><tr><td>POW(x,y)</td><td>幂运算函数，计算x的y次方，与POWER(x,y)功能相同</td></tr><tr><td>RAND()</td><td>默认返回 0 到 1 之间的随机数，包括0和1</td></tr></tbody></table> 
<p>RAND() 函数用于返回 0 到 1 之间的随机数，若要获取指定区间 <code>(min≤num&lt;max)</code> 内的随机数时,使用表达式 <code>FLOOR(min+RAND()*(max-min))</code> 获取。</p> 
<p>若要获取相同的随机数，可以为 RAND(）函数添加整数参数。</p> 
<p>RAND() 函数还可与 ORDER BY 结合使用，用于随机获取指定的数据。</p> 
<p>例如，根据商品分类进行分组，然后使用 <code>ORDER BY RAND()</code> 实现分组后记录的随机排序。</p> 
<p><img src="https://images2.imgbox.com/81/76/2TQfxMC9_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2117"></a>比较运算符</h4> 
<p>比较运算符是MySQL常用运算符之一，通常应用在条件表达式中对结果进行限定。</p> 
<p>MySQL中比较运算符的结果值有3种，分别为1(TRUE，表示为真)、0(FALSE，表示为假) 或 NULL。</p> 
<table><thead><tr><th>运 算 符</th><th>描 述</th></tr></thead><tbody><tr><td>=</td><td>用于相等比较</td></tr><tr><td>&lt;=&gt;</td><td>可以进行 NULL 值比较的相等运算符</td></tr><tr><td>&gt;</td><td>表示大于比较</td></tr><tr><td>&lt;</td><td>表示小于比较</td></tr><tr><td>&gt;=</td><td>表示大于等于比较</td></tr><tr><td>&lt;=</td><td>表示小于等于比较</td></tr><tr><td>&lt;＞、!=</td><td>表示不等于比较</td></tr><tr><td>BETWEEN … AND …</td><td>比较一个数据是否在指定的闭区间范围内，若在则返回1，若不在则返回0</td></tr><tr><td>NOT BETWEEN … AND …</td><td>比较一个数据是否不在指定的闭区间范围内，若不在则返回1，若在则返回0</td></tr><tr><td>IS</td><td>比较一个数据是否是TRUE、FALSE 或 UNKNOWN，若是则返回1，否则返回0</td></tr><tr><td>IS NOT</td><td>比较一个数据是否不是TRUE、FALSE 或 UNKNOWN，若不是则返回1，否则返回0</td></tr><tr><td>IS NULL</td><td>比较一个数据是否是NULL，若是则返回1，否则返回0</td></tr><tr><td>IS NOT NULL</td><td>比较一个数据是否不是NULL，若不是则返回1，否则返回0</td></tr><tr><td>LIKE ‘匹配模式’</td><td>获取匹配到的数据</td></tr><tr><td>NOT LIKE ‘匹配模式’</td><td>获取匹配不到的数据</td></tr></tbody></table> 
<p>所有运算符都可以对数字和字符串进行比较，若参与比较的操作数的数据类型不同，则MySQL会自动将其转换为同类型的数据后再进行比较。</p> 
<p>MySQL中比较运算符 =、&gt;、&lt;、&gt;=、&lt;=、&lt;&gt;、!= 在与NULL进行比较时，结果均为NULL。</p> 
<p>在MySQL中运算符 <code>=</code> 与 <code>&lt;=&gt;</code> 均可以用于比较数据是否相等，两者的区别在于后者可以对 NULL 值进行比较。</p> 
<p>在条件表达式中若需要对指定区间的数据进行判断时，可使用 <code>BETWEEN…AND…</code> 实现。</p> 
<pre><code class="prism language-sql"><span class="token operator">BETWEEN</span> 条件<span class="token number">1</span> <span class="token operator">AND</span> 条件<span class="token number">2</span>
</code></pre> 
<p>条件1 到 条件2 之间的范围(包含条件1和条件2)，并且在设置时，条件1必须小于等于条件2。</p> 
<p><img src="https://images2.imgbox.com/2d/59/eQ0IuK8u_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2155"></a>正则匹配查询</h4> 
<p>MySQL中查询数据时，除了可以使用 LIKE 实现模糊查询，还可以利用 REGEXP 关键字指定正则匹配模式轻松完成更为复杂的查询。</p> 
<p>其中，正则表达式的语法与其他编程语言相同，可自行查看相关的资料进行学习，这里不再赘述。</p> 
<p>例如，获取 sh_goods 表中描述字段内含有 <code>人</code> 或 <code>必备</code> 词语的商品 id、name 和 content 字段内容。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token keyword">FROM</span> sh_goods <span class="token keyword">WHERE</span> content <span class="token operator">REGEXP</span> <span class="token string">'人|必备'</span><span class="token punctuation">;</span>
</code></pre> 
<p>在上述SQL语句中，REGEXP 关键字用于标识正则匹配，<code>人 | 必备</code> 为正则匹配模式。其中，符号 <code>|</code> 在正则中表示分隔符，用于分隔多种条件，在匹配时只要指定字段满足分隔符左右两边条件中的一个，就表示匹配成功。</p> 
<p>除了比较运算符外，MySQL中还提供了很多进行比较运算的函数，常用的比较函数如下。</p> 
<table><thead><tr><th>函 数</th><th>描 述</th></tr></thead><tbody><tr><td>IN()</td><td>比较一个值是否在一组给定的集合内</td></tr><tr><td>NOT IN()</td><td>比较一个值是否不在一组给定的集合内</td></tr><tr><td>GREATEST()</td><td>返回最大的一个参数值，至少两个参数</td></tr><tr><td>LEAST()</td><td>返回最小的一个参数值，至少两个参数</td></tr><tr><td>IS NULL()</td><td>测试参数是否为空</td></tr><tr><td>COALESCE()</td><td>返回第一个非空参数</td></tr><tr><td>INTERVAL()</td><td>返回小于第一个参数的参数索引</td></tr><tr><td>STRCMP()</td><td>比较两个字符串</td></tr></tbody></table> 
<p>函数 GREATEST() 和 LEAST() 的参数至少有两个，用于比较后返回一个最大或最小的参数值。</p> 
<p>IN() 只要比较的字段或数据在给定的集合内，那么比较结果就为真，NOT IN() 正好与 IN() 的功能相反。</p> 
<p><img src="https://images2.imgbox.com/ae/77/5dLuolj7_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2188"></a>逻辑运算符</h4> 
<p>逻辑运算符也是MySQL常用运算符之一，通常应用在条件表达式中的逻辑判断，与比较运算符结合使用。</p> 
<p>参与逻辑运算的操作数以及逻辑判断的结果只有3种，分别为1(TRUE,表示为真)、0(FALSE,表示为假)或NULL。</p> 
<table><thead><tr><th>运 算 符</th><th>描 述</th></tr></thead><tbody><tr><td>AND 或 &amp;&amp;</td><td>逻辑与。操作数全部为真，则结果为1，否则为0</td></tr><tr><td>OR 或 II</td><td>逻辑或。操作数中只要有一个为真，则结果为1，否则为0</td></tr><tr><td>NOT 或 !</td><td>逻辑非。操作数为0，则结果为1，操作数为1，则结果为0</td></tr><tr><td>XOR</td><td>逻辑异或。操作数一个为真，一个为假，则结果为1；若操作数全部为真或全部为假，则结果为0</td></tr></tbody></table> 
<p>仅有逻辑非(NOT或!)是一元运算符，其余均为二元运算符。另外，<code>NOT</code> 和 <code>!</code> 虽然功能相同，但是在一个表达式中同时出现时，先运算 <code>!</code>，再运算 <code>NOT</code> 。</p> 
<p>🐬<strong>逻辑与</strong></p> 
<p>例，查询 sh_goods 表中关键字为 “电子产品” 的5星商品</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> price <span class="token keyword">FROM</span> sh_goods <span class="token keyword">WHERE</span> keyword <span class="token operator">=</span> <span class="token string">'电子产品'</span> <span class="token operator">&amp;&amp;</span> score <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre> 
<p>若使用“&amp;&amp;”连接多个相等比较的条件时，可以使用（a,b）= (x,y) 的方式简化条件表达式 (a=x&amp;&amp;b=y)的书写。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> price <span class="token keyword">FROM</span> sh_goods <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>keyword<span class="token punctuation">,</span> score<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'电子产品'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>❗在进行逻辑与操作时，若操作数中含有NULL，而另一个操作数若为1(真)，则结果为 NULL；若另一个操作数为0(假)，则结果为0。</p> 
<p>🐬<strong>逻辑或</strong></p> 
<p>❗在进行逻辑或操作时，若操作数中含有NULL，而另一个操作数若为1(真)，则结果为1；若另一个操作数为0(假)，则结果为NULL。</p> 
<p>🐬<strong>逻辑非</strong></p> 
<p>❗逻辑非的操作数仅有一个，当操作数为0(假)时，则运算结果为1；当操作数为1(真)时，则运算结果为0；当操作数为NULL时，运算结果为NULL。</p> 
<p>🐬<strong>逻辑异或</strong></p> 
<p>❗逻辑异或操作，表示两个操作数同时都为1或0，则结果为0；若两个操作数一个为1，一个为0，则结果为1；当操作数为NULL时，则结果为NULL。</p> 
<p><img src="https://images2.imgbox.com/37/57/A3Ytd1uq_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2231"></a>赋值运算符</h4> 
<p>MySQL中 <code>=</code> 是一个比较特殊的运算符，既可以用于比较数据是否相等，又可以表示赋值。</p> 
<p>因此，MySQL为了避免系统分不清楚运算符 <code>=</code> 表示赋值还是比较的含义，特意增加一个符号 <code>:=</code> 用于表示赋值运算。</p> 
<p>在MySQL中，INSERT…SET 和 UPDATE…SET 中出现的运算符 <code>=</code> 都会被认为是赋值运算符。因此，建议除此之外的其他情况，若需要赋值运算符，推荐使用 <code>:=</code>，如为变量赋值。</p> 
<p><img src="https://images2.imgbox.com/33/6c/sM7A9ABn_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2242"></a>位运算符</h4> 
<p>位运算符是针对二进制数的每一位进行运算的符号，运算的结果类型为 BIGINT，最大范围可以是64位。</p> 
<table><thead><tr><th>运 算 符</th><th>描 述</th><th>示 例</th></tr></thead><tbody><tr><td>&amp;</td><td>按位与</td><td>SELECT b’1001’ &amp; b’1011’；结果为 9</td></tr><tr><td>|</td><td>按位或</td><td>SELECT b’1001’ | b’1011’；结果为 11</td></tr><tr><td>^</td><td>按位异或</td><td>SELECT b’1001’ ^ b’1011’；结果为 2</td></tr><tr><td>&lt;&lt;</td><td>按位左移</td><td>SELECT b’1001’ &lt;&lt;2；结果为 36</td></tr><tr><td>&gt;&gt;</td><td>按位右移</td><td>SELECTb’1001’ &gt;&gt;2；结果为 2</td></tr><tr><td>~</td><td>按位取反</td><td>SELECT～b’1001’ &amp; b’1011’；结果为2</td></tr></tbody></table> 
<p>MySQL 5.7 中参与位运算的数据只能是 BIGINT 类型(64位的整数)，而在 MySQL 8.0 中则允许二进制字符串类型的参数，如 BINARY、VARBINARY 和 BLOB。因此，MySQL5.7中二进制类型字段的位运算可能在MySQL8.0中产生不同结果，系统也会报相关的警告信息。</p> 
<p>除了位运算符外，MySQL中还提供了进行位运算的函数，常用的运算相关函数如下。</p> 
<table><thead><tr><th>函 数</th><th>描 述</th></tr></thead><tbody><tr><td>BIT_COUNT(N)</td><td>返回在参数N中设置的比特位（二进制位为1）的数量</td></tr><tr><td>BIT_AND()</td><td>按位返回与的结果</td></tr><tr><td>BIT_OR()</td><td>按位返回或的结果</td></tr><tr><td>BIT_XOR()</td><td>按位返回异或的结果</td></tr></tbody></table> 
<p><img src="https://images2.imgbox.com/fe/c6/tqCb40Z1_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2268"></a>运算符优先级</h4> 
<p>运算符优先级可以理解为运算符在一个表达式中参与运算的先后顺序，优先级别越高，则越早参与运算；优先级别越低，则越晚参与运算。</p> 
<table><tbody><tr><th>运算符(从高到低)</th></tr><tr><td>INTERVAL</td></tr><tr><td>BINARY, COLLATE</td></tr><tr><td>!</td></tr><tr><td> －(一元，负号)、~(一元，按位取反)</td></tr><tr><td>^</td></tr><tr><td>*、/、DIV、%、MOD</td></tr><tr><td> －(相减运算符号)、+ </td></tr><tr><td>&lt;&lt;、&gt;&gt;</td></tr><tr><td>&amp;</td></tr><tr><td>|</td></tr><tr><td> =(比较运算符）、&lt;=&gt;、&gt;=、&gt;、&lt;=、&lt;、&lt;&gt;、!=、IS、LIKE、REGEXP、IN </td></tr><tr><td>BETWEEN、CASE、WHEN、THEN、ELSE </td></tr><tr><td>NOT</td></tr><tr><td>AND、&amp;&amp;</td></tr><tr><td>XOR</td></tr><tr><td>OR、||</td></tr><tr><td> =(赋值运算符)、:= </td></tr></tbody></table> 
<p>同行的运算符具有相同的优先级，除赋值运算符从右到左运算外，其余相同级别的运算符，在同一个表达式中出现时，运算的顺序为从左到右依次进行。</p> 
<p>若要提升运算符的优先级别，可以使用圆括号 <code>()</code> ，当表达式中同时出现多个圆括号时，最内层的圆括号中的表达式优先级最高。</p> 
<p><img src="https://images2.imgbox.com/87/35/taLYuysR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_2334"></a>多表操作</h3> 
<p><img src="https://images2.imgbox.com/d9/0c/3SynLlxn_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2337"></a>联合查询</h4> 
<p>联合查询是多表查询的一种方式，在保证<code>多个SELECT语句</code>的查询<code>字段数相同</code>的情况下，<code>合并多个查询的结果</code>。</p> 
<pre><code class="prism language-sql">SELEC <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">UNION</span> <span class="token punctuation">[</span><span class="token keyword">ALL</span> <span class="token operator">|</span> <span class="token keyword">DISTINCT</span><span class="token punctuation">]</span> <span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token keyword">UNION</span> <span class="token punctuation">[</span><span class="token keyword">ALL</span> <span class="token operator">|</span> <span class="token keyword">DISTINCT</span><span class="token punctuation">]</span> <span class="token keyword">SELECT</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>UNION</code> 是实现联合查询的关键字，<code>ALL</code>和 <code>DISTINCT</code> 是联合查询的选项。</p> 
<p>其中，<code>ALL</code> 表示<code>保留所有</code>的查询结果；<code>DISTINCT</code>是默认值，<code>可以省略</code>，表示去除完全重复的记录。</p> 
<p>SELECT 查询的<code>字段个数</code> <code>必须相同</code>，且联合查询的<code>结果</code>中<code>只保留第一个</code> SELEC语句<code>对应的字段名称</code>，即使 UNION 后 SELECT 查询的字段与第一个 SELECT 查询的字段表达含义或数据类型不同，MySQL也仅会根据查询字段出现的顺序，对<code>结果</code>进行<code>合并</code>。</p> 
<p>若要对联合查询的记录进行排序等操作，需要使用圆括号 <code>()</code> 包裹<code>每一个</code> SELECT语句，在 SELECT语句内 或 在联合查询的<code>最后添加 ORDER BY 语句</code>。并且<code>若要排序生效</code>，必须在 ORDER BY 后<code>添加LIMIT 限定</code>联合查询排序的数量，通常推荐使用<code>大于表记录数</code>的<code>任意值</code>。</p> 
<p><img src="https://images2.imgbox.com/02/b0/U9o6gWcy_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2354"></a>交叉连接</h4> 
<p>交叉连接返回的结果是被连接的两个表中<code>所有</code>数据行的<code>笛卡儿积</code>。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 查询字段 <span class="token keyword">FROM</span> 表<span class="token number">1</span> <span class="token keyword">CROSS</span> <span class="token keyword">JOIN</span> 表<span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> 
<p>CROSS JOIN 用于连接两个要查询的表，通过该语句可以查询两个表中所有的数据组合。</p> 
<p><img src="https://images2.imgbox.com/a9/87/w4nnSzMi_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2365"></a>内连接</h4> 
<p>内连接是一种常见的连接查询，它根据<code>匹配条件</code>返回<code>第1个表</code>与<code>第2个表</code> <code>所有匹配成功</code>的记录。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 查询字段 <span class="token keyword">FROM</span> 表<span class="token number">1</span> <span class="token punctuation">[</span><span class="token keyword">INNER</span><span class="token punctuation">]</span> <span class="token keyword">JOIN</span> 表<span class="token number">2</span> <span class="token keyword">ON</span> 匹配条件<span class="token punctuation">;</span>
</code></pre> 
<p><code>ON</code> 用于指定内连接的查询条件，在<code>不设置ON</code>时，与<code>交叉连接</code> <code>等价</code>。此时，可以使用 <code>WHERE</code> 完成条件的限定，效果<code>与ON</code>一样。但由于 WHERE 是限定<code>已全部查询</code>出来的记录，那么在数据量很大的情况下，此操作会浪费很多性能。</p> 
<p><code>自然连接</code>查询是内连接中的一种特殊查询。它是指相互连接的表在<code>物理上</code>为<code>同一个表</code>，但<code>逻辑上</code>分为<code>两个表</code>。</p> 
<p><img src="https://images2.imgbox.com/16/86/vWyLX3Lc_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2378"></a>左外连接</h4> 
<p>左外连接是外连接查询中的一种，也可以将其称为左连接。它用于<code>返回连接关键字</code> <code>左表</code>中<code>所有的记录</code>，以及<code>右表</code>中<code>符合连接条件</code>的记录。当左表的某行记录在右表中<code>没有匹配</code>的记录时，右表中相关的记录将<code>设为NULL</code>。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 查询字段 <span class="token keyword">FROM</span> 表<span class="token number">1</span> <span class="token keyword">LEFT</span> <span class="token punctuation">[</span><span class="token keyword">OUTER</span><span class="token punctuation">]</span> <span class="token keyword">JOIN</span> 表<span class="token number">2</span> <span class="token keyword">ON</span> 匹配条件<span class="token punctuation">;</span>
</code></pre> 
<p>关键字 <code>LEFT [OUTER] JOIN </code> 左边的表(表1)被称为左表，也可称为<code>主表</code>；关键字右边的表(表2）被称为右表，也可称为<code>从表</code>。其中，<code>OUTER</code>在查询时<code>可以省略</code>。</p> 
<p><img src="https://images2.imgbox.com/81/9d/W2iJx2AR_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2390"></a>右外连接</h4> 
<p>右外连接也是外连接查询中的一种，可以将其称为右连接。它用于 <code>返回连接关键字右表(主表)</code> 中<code>所有</code>的记录，以及<code>左表(从表)</code> 中<code>符合连接条件</code>的记录。当右表的某行记录在左表中<code>没有匹配</code>的记录时，左表中相关的记录将<code>设为NULL</code>。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 查询字段 <span class="token keyword">FROM</span> 表<span class="token number">1</span> <span class="token keyword">RIGHT</span> <span class="token punctuation">[</span><span class="token keyword">OUTER</span><span class="token punctuation">]</span> <span class="token keyword">JOIN</span> 表<span class="token number">2</span> <span class="token keyword">ON</span> 匹配条件<span class="token punctuation">;</span>
</code></pre> 
<p>外连接是<code>最常用</code>的一种查询数据的方式，分<code>左外</code>连接和<code>右外</code>连接。它与内连接的区别是，内连接只能<code>获取符合连接条件</code>的记录，而外连接不仅可以获取符合连接条件的记录，还可以<code>保留主表与从表不能匹配</code>的记录。</p> 
<p><img src="https://images2.imgbox.com/31/88/HrxPdKC3_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="USING_2402"></a>USING关键字</h4> 
<p>在连接查询时，若<code>数据表连接的字段同名</code>，则连接时的<code>匹配条件</code>可以使用 <code>USING</code> 代替ON。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 查询字段 <span class="token keyword">FROM</span> 表<span class="token number">1</span> <span class="token punctuation">[</span><span class="token keyword">CROSS</span> <span class="token operator">|</span> <span class="token keyword">INNER</span> <span class="token operator">|</span> <span class="token keyword">LEFT</span> <span class="token operator">|</span> <span class="token keyword">RIGHT</span><span class="token punctuation">]</span> <span class="token keyword">JOIN</span> 表<span class="token number">2</span> <span class="token keyword">USING</span><span class="token punctuation">(</span>同名的联结字段<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>多个同名</code>的连接<code>字段</code>之间使用<code>逗号</code>分隔。</p> 
<p>USING关键字在<code>实际开发</code>中并<code>不常使用</code>，原因在于设计表的时候不能确定使用相同的字段名称保存对应的数据。</p> 
<p><img src="https://images2.imgbox.com/89/e6/SGmQq9Ja_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_2416"></a>子查询</h3> 
<p>子查询可以理解为，在一个SQL语句A(SELECT、INSERT、UPDATE等)中<code>嵌入</code>一个查询语句B，作为执行的条件或查询的<code>数据源(代替FROM后的数据表)</code>，那么B就是子查询语句，它是一条完整的SELECT 语句，能够<code>独立地执行</code>。</p> 
<p>在含有子查询的语句中，子查询必须书写在<code>圆括号</code>内。SQL语句首先会执行子查询中的语句，然后再将返回的结果作为外层SQL语句的过滤条件，当遇到同一个SQL语句中含有多层子查询时，它们执行的顺序是从<code>最里层</code>的子查询开始执行。</p> 
<p>子查询的划分方式有多种，最常见的是以<code>功能和位置</code>进行划分。按子查询的功能可以分为<code>标量子查询</code>、<code>列子查询</code>、<code>行子查询</code>和<code>表子查询</code>。</p> 
<p>按子查询<code>出现的位置</code>可以分为 <code>WHERE子查询</code> 和 <code>FROM子查询</code>。</p> 
<p><code>标量子查询</code>、<code>列子查询</code> 和 <code>行子查询</code> 都属于<code>WHERE子查询</code>，而<code>表子查询</code>属于<code>FROM子查询</code>。</p> 
<p><img src="https://images2.imgbox.com/a0/c7/DLYOE96r_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2431"></a>标量子查询</h4> 
<p>标量子查询指的是子查询返回的结果是一个数据，即<code>一行一列</code>。</p> 
<pre><code class="prism language-sql"><span class="token keyword">WHERE</span> 条件判断 {<!-- --><span class="token operator">=</span> <span class="token operator">|</span> <span class="token operator">&lt;&gt;</span>} <span class="token punctuation">(</span><span class="token keyword">SELECT</span> 字段名 <span class="token keyword">FROM</span> 数据源 <span class="token punctuation">[</span><span class="token keyword">WHERE</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">GROUP</span> <span class="token keyword">BY</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">HAVING</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">LIMIT</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>标量子查询利用比较运算符 <code>=</code> 或 <code>&lt;&gt;</code>，判断子查询语句返回的数据是否与指定的条件相等或不等，然后根据比较结果完成相关需求的操作。其中，数据源表示一个符合二维表结构的数据，如数据表。</p> 
<p><img src="https://images2.imgbox.com/2e/89/BiGqn2Tw_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2443"></a>列子查询</h4> 
<p>列子查询指的是子查询返回的结果是一个字段符合条件的所有数据，即<code>一列多行</code>。</p> 
<pre><code class="prism language-sql"><span class="token keyword">WHERE</span> 条件判断 {<!-- --><span class="token operator">IN</span> <span class="token operator">|</span> <span class="token operator">NOT</span> <span class="token operator">IN</span>} <span class="token punctuation">(</span><span class="token keyword">SELECT</span> 字段名 <span class="token keyword">FROM</span> 数据源 <span class="token punctuation">[</span><span class="token keyword">WHERE</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">GROUP</span> <span class="token keyword">BY</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">HAVING</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">LIMIT</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>列子查询利用比较运算函数 <code>IN()</code> 或 <code>NOTIN()</code>，判断指定的条件是否在子查询语句返回的结果集中，然后根据比较结果完成相关需求的操作。</p> 
<p><img src="https://images2.imgbox.com/b3/50/h06AUxiS_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2454"></a>行子查询</h4> 
<p>当子查询的<code>结果</code>是<code>一条包含多个字段</code>的记录(一行多列)时，称为行子查询。</p> 
<pre><code class="prism language-sql"><span class="token keyword">WHERE</span> <span class="token punctuation">(</span>指定字段名<span class="token number">1</span><span class="token punctuation">,</span> 指定字段名<span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token operator">=</span>
<span class="token punctuation">(</span><span class="token keyword">SELECT</span> 字段名<span class="token number">1</span><span class="token punctuation">,</span> 字段名<span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">FROM</span> 数据源 <span class="token punctuation">[</span><span class="token keyword">WHERE</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">GROUP</span> <span class="token keyword">BY</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">HAVING</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">LIMIT</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>行子查询返回的一条记录与<code>指定</code>的<code>条件</code>进行<code>比较</code>，比较的运算符通常使用 <code>=</code>，表示子查询的结果必须全部与<code>指定的字段相等</code>才满足WHERE指定的条件。除此之外，还可以使用MySQL中其他的比较运算符，如 <code>&lt;&gt;</code> <code>&gt;</code>等，它们表示的含义如下表。</p> 
<table><thead><tr><th>不同运算符的行比较</th><th>描 述</th></tr></thead><tbody><tr><td>(a, b) = (x, y)</td><td>表达的含义等价于 (a=x)AND(b=y)</td></tr><tr><td>(a, b) &lt; = &gt; (x, y)</td><td>表达的含义等价于 (a&lt; = &gt; x)AND(b&lt; = &gt;y)</td></tr><tr><td>(a, b) &lt; &gt; (x, y)</td><td>表达的含义等价于 (a&lt; &gt;x)OR(b &lt; &gt; y)</td></tr><tr><td>(a, b) &gt; (x, y)</td><td>表达的含义等价于 (a&gt;x) OR ((a=x)AND(b&gt;y))</td></tr><tr><td>(a, b) &gt;= (x, y)</td><td>表达的含义等价于 (a&gt;x) OR ((a=x)AND(b&gt;=y))</td></tr><tr><td>(a, b) &lt; (x, y)</td><td>表达的含义等价于 (a&lt;x) OR ((a=x)AND(b&lt;y))</td></tr><tr><td>(a, b) &lt;= (x, y)</td><td>表达的含义等价于 (a&lt;x) OR ((a=x)AND(b&lt;=y))</td></tr></tbody></table> 
<p>从表中可知，<code>行</code>在<code>相等比较(=或&lt;=&gt;)</code>时，各条件之间是<code>与</code>的逻辑关系；在<code>不等</code>比较（&lt;&gt;或！)时，各条件之间是<code>或</code>的逻辑关系；在进行<code>其他</code>方式比较时，各条件之间的逻辑关系包含<code>两种情况</code>。</p> 
<p><img src="https://images2.imgbox.com/49/99/0Y8RdmF9_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2479"></a>表子查询</h4> 
<p>表子查询指的是<code>子查询的返回结果用于FROM数据源</code>，它是一个符合二维表结构的数据，可以是<code>一行一列</code>、<code>一列多行</code>、<code>一行多列</code> 或 <code>多行多列</code>。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> 字段列表 <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> 语句<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token keyword">AS</span><span class="token punctuation">]</span> 别名 <span class="token punctuation">[</span><span class="token keyword">WHERE</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">GROUP</span> <span class="token keyword">BY</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">HAVING</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">LIMIT</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p>FROM 后的数据源都是表名。因此，当<code>数据源是子查询</code>时<code>必须</code>为其<code>设置别名</code>，同时也是为了将查询结果作为一个表使用时，可以进行条件判断、分组、排序以及限量等操作。</p> 
<p><img src="https://images2.imgbox.com/01/a4/RBQtypp8_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2490"></a>子查询关键字</h4> 
<p>在 WHERE 子查询中，不仅可以使用比较运算符，还可以使用MySQL提供的一些特定关键字，如<code>IN</code>。除此之外，常用的子查询关键字还有 <code>EXISTS</code>、<code>ANY</code> 和 <code>ALL</code>。</p> 
<p>🐬<strong>带EXISTS关键字的子查询</strong></p> 
<p>带 EXISTS 关键字的子查询返回的结果只有<code>0</code>和<code>1</code>两个值。其中，0代表<code>不成立</code>，1代表<code>成立</code>。</p> 
<pre><code class="prism language-sql"><span class="token keyword">WHERE</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span>子查询语句<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>EXISTS关键字用于判断子查询语句是否有返回的结果，若存在则返回1，否则返回0。</p> 
<p>🐬<strong>带ANY关键字的子查询</strong></p> 
<p>ANY关键字的子查询时，表示给定的判断条件，只要符合ANY子查询结果中的<code>任意一个</code>，就返回1，否则返回0。</p> 
<pre><code class="prism language-sql"><span class="token keyword">WHERE</span> 表达式 比较运算符 <span class="token keyword">ANY</span> <span class="token punctuation">(</span>子查询语句<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>当比较运算符为 <code>=</code> 时，其执行的效果等价于 <code>IN</code> 关键字。</p> 
<blockquote> 
 <p>MySQL中还有一个关键字SOME,与ANY的功能完全相同。MySQL在设计时添加SOME的原因在于，英文语法中虽然SOME和ANY的语法含义相同，但是NOTANY和NOTSOME的含义区别很大。前者表示一点也不，相当于NOTALL，而后者仅用于否定部分内容。因此，为了便于以英文为母语的开发者理解，设计出了带SOME和ANY关键字的子查询。</p> 
</blockquote> 
<p>🐬<strong>带ALL关键字的子查询</strong></p> 
<p>ALL关键字的子查询时，表示给定的<code>判断条件</code>只有<code>全部符合</code>ALL子查询的结果时，才返回1，否则返回0。</p> 
<pre><code class="prism language-sql"><span class="token keyword">WHERE</span> 表达式 比较运算符 <span class="token keyword">ALL</span><span class="token punctuation">(</span>子查询语句<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>带 <code>ANY</code>、<code>SOME</code> 或 <code>ALL</code> 关键字的子查询，不能使用 <code>&lt;=&gt;</code> 比较运算符。另外，若子查询结果与条件匹配时有NULL，那么此条记录不参与匹配。</p> 
<p><img src="https://images2.imgbox.com/c2/91/kPQvFZaD_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_2528"></a>外键约束</h3> 
<p>在数据库设计时，为了保证不同表中相同含义数据的一致性和完整性，可为数据表添加外键约束。</p> 
<p>例如，员工表中添加了部门表中不存在的部门id，此时就会出现数据信息保存不对等的情况，若在员工表中将部门id设置为外键，即可对相关的操作产生约束。例如，员工表只能插人部门表中含有的记录id。</p> 
<p><img src="https://images2.imgbox.com/a9/c4/u4V6ITDD_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2535"></a>添加外键约束</h4> 
<p>外键指的是在一个表中引用另一个表中的一列或多列，被引用的列应该具有<code>主键约束</code>或<code>唯一性约束</code>，从而保证数据的<code>一致性</code>和<code>完整性</code>。其中，被引用的表称为主表；引用外键的表称为从表。</p> 
<p>要想在创建数据表或修改数据结构时添加外键约束，在相应的位置添加以下SQL语句即可。</p> 
<pre><code class="prism language-sql"><span class="token punctuation">[</span><span class="token keyword">CONSTRAINT</span> symbol<span class="token punctuation">]</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">[</span>index_name<span class="token punctuation">]</span> <span class="token punctuation">(</span>index_col_name<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token keyword">REFERENCES</span> tbl_name <span class="token punctuation">(</span>index_col_name<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token keyword">ON</span> <span class="token keyword">DELETE</span> {<!-- --><span class="token keyword">RESTRICT</span> <span class="token operator">|</span> <span class="token keyword">CASCADE</span> <span class="token operator">|</span> <span class="token keyword">SET</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token keyword">NO</span> <span class="token keyword">ACTION</span> <span class="token operator">|</span> <span class="token keyword">SET</span> <span class="token keyword">DEFAULT</span>}<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> {<!-- --><span class="token keyword">RESTRICT</span> <span class="token operator">|</span> <span class="token keyword">CASCADE</span> <span class="token operator">|</span> <span class="token keyword">SET</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token keyword">NO</span> <span class="token keyword">ACTION</span> <span class="token operator">|</span> <span class="token keyword">SET</span> <span class="token keyword">DEFAULT</span>}<span class="token punctuation">]</span>
</code></pre> 
<p>MySQL可以通过 <code>FOREIGN KEY...REFERENCES</code> 关键字向数据表中添加外键约束。</p> 
<p>可选关键字 <code>CONSTRAINT</code> 用于定义外键约束的名称 <code>symbol</code>，如果省略，MySQL 将会自动生成一个名字。</p> 
<p>可选关键字 <code>index_name</code> ，表示外键索引名称，如果省略，MySQL也会在建立外键时自动创建一个外键索引，加快查询速度。</p> 
<p><code>index_col_name, ...</code> 表示从表中外键名称列表；<code>tbl_name</code> 表示主表，主表后的参数列表<code>index_col_name, ...</code>表示主键约束或唯一性约束字段。</p> 
<p><code>ON DELETE</code> 与 <code>ON UPDATE</code> 用于设置主表中的数据被删除或修改时，从表对应数据的处理办法，其后的各参数具体说明如下表所示。</p> 
<table><thead><tr><th>参数名称</th><th>功能描述</th></tr></thead><tbody><tr><td>RESTRICT</td><td>默认值。拒绝主表删除或修改外键关联字段</td></tr><tr><td>CASCADE</td><td>主表中删除或更新记录时，同时自动删除或更新从表中对应的记录</td></tr><tr><td>SET NULL</td><td>主表中删除或更新记录时，使用NULL值替换从表中对应的记录（不适用于 NOT NULL字段）</td></tr><tr><td>NO ACTION</td><td>与默认值RESTRICT相同，拒绝主表删除或修改外键关联字段</td></tr><tr><td>SET DEFAULT</td><td>设默认值，但InnoDB目前不支持</td></tr></tbody></table> 
<p>建立外键关系的两个数据表的相关字段数据类型必须相似，也就是要求字段的数据类型可以相互转换。</p> 
<p>例如，INT 和 TINYINT 类型的字段可以建立外键关系，而 INT 和 CHAR 类型的字段则不可以建立外键关系。下面在mydb数据库中，以员工表employees和部门表department为例，演示如何在CREATE TABLE和ALTER TABLE时添加外键约束的两种方式。</p> 
<p>🐬<strong>CREATETABLE时添加外键约束</strong></p> 
<p>为从表创建外键约束时，首先要保证数据库中已存在主表，否则程序会报 <code>不能添加外键约束</code> 的错误。</p> 
<pre><code class="prism language-sql"><span class="token comment"># 1.在mydb数据库下创建主表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mydb<span class="token punctuation">.</span>department <span class="token punctuation">(</span>
	id <span class="token keyword">INT</span> <span class="token keyword">UNSIGNED</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'部门编号'</span><span class="token punctuation">,</span> 
	name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span><span class="token string">'部门名称'</span>
<span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>

<span class="token comment"># 2.在mydb数据库下创建从表，添加外键约束</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mydb<span class="token punctuation">.</span>employees <span class="token punctuation">(</span>
	id <span class="token keyword">INT</span> <span class="token keyword">UNSIGNED</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'员工编号'</span><span class="token punctuation">,</span> 
	name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'员工姓名'</span><span class="token punctuation">,</span> 
	dept_id <span class="token keyword">INT</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'部门分类编号'</span><span class="token punctuation">,</span>
	<span class="token keyword">CONSTRAINT</span> FK_ID <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>dept_id<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> department <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">RESTRICT</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span>
<span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
</code></pre> 
<p>在上述SQL语句中，为 employees 表中的 dept_id 字段添加外键约束，与主表 department 中的主键 id相关联。</p> 
<p>同时，利用 ON DELETE 指定从表此关联字段含有数据时，拒绝主表 department 执行删除操作，利用 ON UPDATE 设置主表 department 执行更新操作时，从表 employees 中的相关字段也执行更新操作。</p> 
<p>❗定义外键约束名称(如FK_ID)时，不能加单引号和双引号。</p> 
<p>🐬<strong>ALTER TABLE时添加外键约束</strong></p> 
<p>对于已经创建的数据表，则可以通过 ALTER TABLE 的方式添加外键约束。</p> 
<p>例如，若mydb数据库中已有两个数据表department和employees，employees表在创建时未添加外键约束，此时就可以通过以下的 ALTER TABLE 方式实现。</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> mydb<span class="token punctuation">.</span>employees
<span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> FK_ID <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span>dept_id<span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> department <span class="token punctuation">(</span>id<span class="token punctuation">)</span> 
<span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">RESTRICT</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b9/a9/rGpwiIpz_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2610"></a>查看外键约束</h4> 
<p>在添加完外键约束后，可以利用 DESC 查看数据表 employees 中添加了外键约束的字段信息。</p> 
<pre><code class="prism language-sql"><span class="token keyword">DESC</span> mydb<span class="token punctuation">.</span>employees dept_id<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+------------------+------+-----+---------+-------+</span>
<span class="token operator">|</span>  Field  <span class="token operator">|</span>       <span class="token keyword">Type</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> dept_id <span class="token operator">|</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">|</span>  <span class="token keyword">NO</span>  <span class="token operator">|</span> MUL <span class="token operator">|</span>   <span class="token boolean">NULL</span>  <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------------------+------+-----+---------+-------+</span>
</code></pre> 
<p>添加了外键约束的 dept_id 字段的 Key(索引) 值为MUL，表示非唯一性索引(MUL TIPLE KEY)，值可以重复。由此可见，在创建外键约束时，MySQL会自动为没有索引的外键字段创建索引。</p> 
<p>在MySQL中使用 <code>SHOW CREATE TABLE</code> 查看 employees 表的详细结构。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mydb<span class="token punctuation">.</span>employees\G
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1.</span><span class="token keyword">row</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token keyword">Table</span>: employees
<span class="token keyword">Create</span> <span class="token keyword">Table</span>: <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">'employees'</span> <span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'员工编号'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'员工姓名'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>dept_id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'商品分类编号'</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>FK_ID<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>dept_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">CONSTRAINT</span> FK_ID <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>dept_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token identifier"><span class="token punctuation">`</span>department<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<p>在上述结果中，为 dept_id 字段添加外键约束后，当 dept_id 没有索引时，服务器就会自动为其创建与外键同名的索引。数据表的默认存储引擎为 InnoDB。</p> 
<p>由于 ON DELETE RESTRICT 设置的拒绝主表的删除操作属于默认值，因此显示表创建语句时省略了此设置。若设置为删除主表记录，则从表对应字段设置为NULL，即可在表的详细结构中显示到 ON DELETE SETNULL的设置。</p> 
<p><img src="https://images2.imgbox.com/b4/91/wtZffzzQ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2647"></a>关联表操作</h4> 
<p>实体之间具有一对一、一对多和多对多的联系，而具有关联的表中的数据，可以通过连接查询的方式获取，并且在没有添加外键约束时，关联表中的数据插入、更新和删除操作互不影响。但是对于添加了外键约束的关联表而言，数据的插入、更新和删除操作就会受到一定的约束。</p> 
<p>🐬<strong>添加数据</strong></p> 
<p>一个具有外键约束的从表在插入数据时，外键字段的值会受主表数据的约束，保证从表插人的数据必须符合约束规范的要求。如从表外键字段不能插入主表中不存在的数据。</p> 
<p>🐬<strong>更新数据</strong></p> 
<p>对于建立外键约束的关联数据表来说，若对主表进行更新操作，从表将按照其建立外键约束时设置的ON UPDATE 参数自动执行相应的操作。例如，当参数设置为 CASCADE 时，如果主表发生更新，则从表也会对相应的字段进行更新。</p> 
<p>外键约束在使用时既有一定的优势，同时又会带来一定的问题，具体如下。</p> 
<p>✔️优势</p> 
<ul><li> <p>外键可节省开发量。</p> </li><li> <p>外键能约束数据有效性，防止非法数据的插入。</p> </li></ul> 
<p>❌劣势。</p> 
<ul><li> <p>使用外键约束，会带来额外的开销。</p> </li><li> <p>主表被锁定时，会引发从表也被锁定。</p> </li><li> <p>删除主表的数据时，需先删除从表的数据。</p> </li><li> <p>含有外键约束的从表字段不能修改表结构。</p> </li></ul> 
<p>🐬<strong>删除数据</strong></p> 
<p>对于已建立外键约束的关联数据表来说，若要对主表执行删除操作，从表将按照其建立外键约束时设置的 ON DELETE 参数自动执行相应的操作。例如，当参数设置为 RESTRICT 时，如果主表进行删除操作，同时从表中的外键字段有关联记录，就会阻止主表的删除操作。</p> 
<p>关联表在删除操作时体用 DISTRICT 严格模式，主表中每条记录的删除，都要保证从表中没有相关记录的对应数据，这会对开发造成很大的不便。因此，对于添加外键约束的 ON DELETE 一般都使用SET NULL模式，即删除主表记录时，将从表中对应的记录设置为NULL，同时要保证从表中对应的外键字段允许为空，否则不允许设置该模式。</p> 
<p><img src="https://images2.imgbox.com/8f/db/VoSZS0I6_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2685"></a>删除外键约束</h4> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">DROP</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> 外键名<span class="token punctuation">;</span>
</code></pre> 
<p>下面以解除员工表 employees 与部门表 department 之间的外键约束为例进行演示。</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> mydb<span class="token punctuation">.</span>employees  <span class="token keyword">DROP</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> FK_ID<span class="token punctuation">;</span>
</code></pre> 
<p>在删除employees表的外键约束后，下面利用 DESC 查询 employees 表中删除了外键约束的字段信息。</p> 
<pre><code class="prism language-sql"><span class="token keyword">DESC</span> mydb<span class="token punctuation">.</span>employees dept_id<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+------------------+------+-----+---------+-------+</span>
<span class="token operator">|</span>  Field  <span class="token operator">|</span>       <span class="token keyword">Type</span>       <span class="token operator">|</span> <span class="token boolean">NULL</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------------------+------+-----+---------+-------+</span>
<span class="token operator">|</span> dept_id <span class="token operator">|</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">|</span>  <span class="token keyword">NO</span>  <span class="token operator">|</span> MUL <span class="token operator">|</span>   <span class="token boolean">NULL</span>  <span class="token operator">|</span>       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+------------------+------+-----+---------+-------+</span>
</code></pre> 
<p>从上述执行结果可知，在删除 dept_id 的外键约束后，dept_id 的 Key 值依然为 MUL，这是由于删除外键约束时并不会自动删除系统创建的普通索引，此时可以通过 <code>SHOW CREATE TABLE</code> 查看。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> mydb<span class="token punctuation">.</span>employees\G
<span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token number">1.</span><span class="token keyword">row</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span><span class="token operator">*</span>
<span class="token keyword">Table</span>: employees
<span class="token keyword">Create</span> <span class="token keyword">Table</span>: <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token string">'employees'</span> <span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'员工编号'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'员工姓名'</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">`</span>dept_id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'商品分类编号'</span><span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>FK_ID<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>dept_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">CONSTRAINT</span> FK_ID <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>dept_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token identifier"><span class="token punctuation">`</span>department<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CASCADE</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<p>若要在删除外键约束后，同时删除系统为外键创建的普通索引，则需要通过手动删除索引的方式完成。</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> mydb<span class="token punctuation">.</span>employees  <span class="token keyword">DROP</span> <span class="token keyword">KEY</span> FK_ID<span class="token punctuation">;</span>
</code></pre> 
<p>完成上述操作后，可再次利用 DESC 查看已删除的外键字段的 Key 值为空，SHOW CREATE TABLE时表中的外键约束以及普通索引全部已删除。</p> 
<p><img src="https://images2.imgbox.com/d4/5e/jcwcBRCq_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_2733"></a>用户与权限概述</h3> 
<p>在正常的工作环境中，为了保证数据库的安全，数据库的管理员会对需要操作数据库的人员分配用户名、密码以及可操作的权限范围，让其仅能在自己权限范围内操作。</p> 
<p>用户是数据库的使用者和管理者，MySQL通过用户的设置来控制数据库操作人员的访问与操作范围。</p> 
<p>在安装MySQL时，系统会自动安装一个名为 mysql 的数据库，该数据库主要用于维护数据库的用户以及权限的控制和管理。</p> 
<p>MySQL中的所有用户信息都保存在 mysql.user 数据表中。</p> 
<p>使用 DESC 即可查看 user 表含有的45个字段，下面以表格的形式列举 user 表中的一些常用字段。</p> 
<table><thead><tr><th>字 段 名</th><th>数 据 类 型</th><th>默认值</th></tr></thead><tbody><tr><td>Host</td><td>char(60)</td><td></td></tr><tr><td>User</td><td>char(60)</td><td></td></tr><tr><td>Select_priv</td><td>enum(‘N’, ‘Y’)</td><td>N</td></tr><tr><td>Insert_priv</td><td>enum(‘N’, ‘Y’)</td><td>N</td></tr><tr><td>Update_priv</td><td>enum(‘N’, ‘Y’)</td><td>N</td></tr><tr><td>Delete_priv</td><td>enum(‘N’, ‘Y’)</td><td>N</td></tr><tr><td>Create_priv</td><td>enum(‘N’, ‘Y’)</td><td>N</td></tr><tr><td>Drop_priv</td><td>enum(‘N’, ‘Y’)</td><td>N</td></tr><tr><td>Reload_priv</td><td>enum(‘N’, ‘Y’)</td><td>N</td></tr><tr><td>Shutdown_priv</td><td>enum(‘N’, ‘Y’)</td><td>N</td></tr><tr><td>Process_priv</td><td>enum(‘N’, ‘Y’)</td><td>N</td></tr><tr><td>File_priv</td><td>enum(‘N’, ‘Y’)</td><td>N</td></tr><tr><td>Grant_priv</td><td>enum(‘N’, ‘Y’)</td><td>N</td></tr><tr><td>ssl_tupe</td><td>enum(‘’, ‘ANY’, ‘X509’, SPECIFIED)</td><td></td></tr><tr><td>ssl_cipher</td><td>blob</td><td>NULL</td></tr><tr><td>x509_issure</td><td>blob</td><td>NULL</td></tr><tr><td>x509_subject</td><td>blob</td><td>NULL</td></tr><tr><td>max_questions</td><td>int(11) unsigned</td><td>0</td></tr><tr><td>max_updates</td><td>int(11) unsigned</td><td>0</td></tr><tr><td>max_connections</td><td>int(11) unsigned</td><td>0</td></tr><tr><td>max_user_connections</td><td>int(11) unsigned</td><td>0</td></tr><tr><td>plugin</td><td>char(64)</td><td>mysql_native_password</td></tr><tr><td>authentication_string</td><td>text</td><td>NULL</td></tr><tr><td>password_expired</td><td>enum(‘N’, ‘Y’)</td><td>N</td></tr><tr><td>password_last_changed</td><td>timestamp</td><td>NULL</td></tr><tr><td>password_lifetime</td><td>smallint(5) unsigned</td><td>NULL</td></tr><tr><td>account_locked</td><td>enum(‘N’, ‘Y’)</td><td>N</td></tr></tbody></table> 
<p>在表中，根据字段的功能可将其分为6类，分别为客户端访问服务器的账号字段、验证用户身份的字段、安全连接的字段、资源限制的字段、权限字段以及账户是否锁定的字段。</p> 
<p><img src="https://images2.imgbox.com/42/1f/oSSBqKTS_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2779"></a>账号字段</h4> 
<p>Host 和 User 字段共同组成的复合主键用于区分 MySQL 中的账户，User 字段用于代表用户的名称，Host 字段表示允许访问的客户端 IP 地址或主机地址，当 Host 的值为 <code>*</code> 时，表示所有客户端的用户都可以访问。</p> 
<p>下面通过SELECT查询user表中默认用户的Host和User值，具体SQL语句及执行结果如下。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> host<span class="token punctuation">,</span> <span class="token keyword">user</span> <span class="token keyword">FROM</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span>
<span class="token operator">+</span><span class="token comment">-----------+----------------+</span>
<span class="token operator">|</span> host      <span class="token operator">|</span> <span class="token keyword">user</span>           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+----------------+</span>
<span class="token operator">|</span> localhost <span class="token operator">|</span> mysql<span class="token punctuation">.</span><span class="token keyword">session</span>  <span class="token operator">|</span>
<span class="token operator">|</span> localhost <span class="token operator">|</span> mysql<span class="token punctuation">.</span>sys      <span class="token operator">|</span>
<span class="token operator">|</span> localhost <span class="token operator">|</span> root			 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+----------------+</span>
</code></pre> 
<p>从上述执行结果可知，在 user 表中，除了默认的 root 超级用户外，在MySQL5.7开始还额外地新增了两个用户 mysql.session 和 mysql.sys。前者用于用户身份验证，后者用于系统模式对象的定义，防止DBA(数据库管理员)重命名或删除root用户时发生错误。</p> 
<p>默认情况下，用户 mysql.session 和 mysql.sys 已被锁定，使得数据库操作人员无法使用这两个用户通过客户端连接MySQL服务器。建议不要随意解锁和使用 mysql.session 和 mysql.sys 用户。</p> 
<p><img src="https://images2.imgbox.com/38/a6/Xo8IH8SQ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2802"></a>身份验证字段</h4> 
<p>在MySQL 5.7中，mysql.user 表中已不再包含 Password 字段，而是使用 plugin 和authentication_string 字段保存用户身份验证的信息。</p> 
<p>其中，plugin 字段用于指定用户的验证插件名称，authentication_string 字段是根据 plugin 指定的插件算法对账户明文密码加密后的字符串。</p> 
<p>下面通过SELECT 查询 user表中 root 用户默认的 plugin 和 authentication_string 值。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> plugin<span class="token punctuation">,</span> authentication_string <span class="token keyword">FROM</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span> <span class="token keyword">WHERE</span> <span class="token keyword">user</span> <span class="token operator">=</span> <span class="token string">'root'</span>
<span class="token operator">+</span><span class="token comment">-----------------------+-------------------------------------------+</span>
<span class="token operator">|</span> plugin			    <span class="token operator">|</span> authentication_string 					<span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------+-------------------------------------------+</span>
<span class="token operator">|</span> mysql_native_password <span class="token operator">|</span> <span class="token operator">*</span><span class="token number">6</span>BB4837EB74329105EE4568DDA7DC67ED2CA2AD9 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------+-------------------------------------------+</span>
</code></pre> 
<p>MySQL中 root 用户的默认验证插件名为 mysql_native_password。</p> 
<p>authentication_string 字段保存的则是一串不能看出具体含义的值，相对于能够直接看懂的明文密码，它是经过加密处理的暗码。</p> 
<p>除此之外，与身份验证的账号密码相关的字段还有 password_expired(密码是否过期)、password_last_changed(密码最后一次修改的时间)以及password_lifetime(密码的有效期)。</p> 
<p><img src="https://images2.imgbox.com/59/c8/BtJlxN0I_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2826"></a>安全连接字段</h4> 
<p>在客户端与 MySQL 服务器连接时，除了可以基于账户名以及密码的常规验证外，还可以判断当前连接是否符合SSL安全协议，与其相关的字段有以下几种。</p> 
<ul><li> <p>ssl_type：用于保存安全连接的类型，它的可选值有"(空）、ANY(任意类型)、X509(X509证书)、SPECIFIED(规定的)4种。</p> </li><li> <p>ssl_cipher：用于保存安全加密连接的特定密码。</p> </li><li> <p>x509_issuer：保存由CA签发的有效的X509证书。</p> </li><li> <p>x509_subject：保存包含主题的有效的X509证书。</p> </li></ul> 
<p>通常标准的发行版MySQL默认未启用SSL加密连接，可以通过以下SQL语句查看。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'have_openssl'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------+</span>
<span class="token operator">|</span> Variable_name <span class="token operator">|</span> <span class="token keyword">Value</span>     <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------+</span>
<span class="token operator">|</span> have_openssl  <span class="token operator">|</span> DISABLED  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------+</span>
</code></pre> 
<p>have_openssl 的取值为 DISABLED 表示已禁用加密</p> 
<p><img src="https://images2.imgbox.com/27/1e/U5g9fAVP_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2853"></a>资源限制字段</h4> 
<p>在 mysql.user 表中提供的以 <code>max_</code> 开头的字段，保存对用户可使用的服务器资源的限制，用来防止用户登录MySQL服务器后的不法或不合规范的操作浪费服务器的资源，各字段的具体含义如下所示。</p> 
<ul><li> <p>max_questions：保存每小时允许用户执行查询操作的最多次数。</p> </li><li> <p>max_updates：保存每小时允许用户执行更新操作的最多次数。</p> </li><li> <p>max_connections：保存每小时允许用户建立连接的最多次数。</p> </li><li> <p>max_user_connections：保存允许单个用户同时建立连接的最多数量。</p> </li></ul> 
<p>以上列举的用户资源限制字段默认值均为0，表示对此用户没有任何的资源限制。</p> 
<p><img src="https://images2.imgbox.com/82/78/DexJkRkW_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2868"></a>权限字段</h4> 
<p>在 mysql.user 表中提供的以 <code>_priv</code> 结尾的字段一共有29个，这些字段保存了用户的全局权限，如 Select_priv 查询权限、Insert_priv 插入权限、Update_priv 更新权限等。</p> 
<p>其中，user 表对应的权限字段的数据类型都是 ENUM 枚举类型，取值只有N或Y两种。N表示该用户没有对应权限，Y表示该用户有对应权限。为了保证数据库的安全，这些字段的默认值都为N，如果需要可以对其进行修改。</p> 
<p><img src="https://images2.imgbox.com/8c/7b/WwXM4twh_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2876"></a>账户锁定字段</h4> 
<p>在mysql.user表中提供的 account_locked 字段用于保存当前用户是锁定还是解锁状态。该字段是一个枚举类型，当其值为N时表示解锁，此用户可以用于连接服务器；当其值为Y时表示该用户已被锁定，不能用于连接服务器使用。</p> 
<p><img src="https://images2.imgbox.com/c5/39/qZMIEjof_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_2881"></a>用户管理</h3> 
<p><img src="https://images2.imgbox.com/48/1c/Oi4DJLaX_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_2885"></a>创建用户</h4> 
<p>由于MySQL中所有用户的信息都保存在 mysql.user 表中，因此，创建用户可以直接利用 root 用户登录MySQL服务器后，向 mysql.user 表中插入记录，但是在开发中为保证数据的安全，并不推荐使用此方式创建用户。而是采用MySQL提供的 <code>CREATE USER</code> 和 <code>GRANT</code> 语句创建用户。其中，GRANT语句在创建用户的同时还可以完成权限的设置。</p> 
<p>使用 <code>CREATE USER</code> 语句每创建一个新用户，都会在 mysql.user 表中添加一条记录，同时服务器会自动修改相应的授权表。但需要注意的是，该语句创建的新用户默认情况下没有任何权限，需要使用GRANT进行授权。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span>
账户名 <span class="token punctuation">[</span>用户身份验证选项<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> 账户名 <span class="token punctuation">[</span>用户身份验证选项<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token keyword">WITH</span> 资源控制选项<span class="token punctuation">]</span> <span class="token punctuation">[</span>密码管理选项 <span class="token operator">|</span> 账户锁定选项<span class="token punctuation">]</span>
</code></pre> 
<p><code>CREATE USER</code> 可以一次创建多个用户，多个用户之间使用逗号分隔。其中，账户名是由 <code>用户名@主机地址</code> 组成的，其余选项在创建用户时，若未设置则使用默认值，具体如下表所示。</p> 
<table><thead><tr><th>选 项</th><th>默 认 值</th></tr></thead><tbody><tr><td>用户身份验证选项</td><td>由 default_authentication_plugin 系统变量定义的插件进行身份验证</td></tr><tr><td>加密连接协议选项</td><td>NONE</td></tr><tr><td>资源控制选项</td><td>N(表示无限制)</td></tr><tr><td>密码管理选项</td><td>PASSWORD EXPIRE DEFAULT</td></tr><tr><td>用户锁定选项</td><td>ACCOUNT UNLOCK</td></tr></tbody></table> 
<p>在上表中，用户身份验证选项的设置仅适用于其前面的用户名，可将其理解为某个用户的私有属性；其余的选项对声明中的所有用户都有效，可以将其理解为全局属性。</p> 
<blockquote> 
 <p>创建用户时，用户名的设置不能超过32个字符，且区分大小写，但是主机地址不区分大小写。</p> 
</blockquote> 
<p>🐬<strong>创建最简单的用户</strong></p> 
<p>在创建用户时，若不指定主机地址、密码以及相关的用户选项，则表示此用户在访问 MySQL服务器时，不限定客户端，不需要密码并且没有任何限制。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'test1'</span><span class="token punctuation">;</span>
</code></pre> 
<p>使用 SELECT查看 mysql 数据库下的 user 表，查看创建的用户是否已添加到 user 表中保存。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> host<span class="token punctuation">,</span> <span class="token keyword">user</span> <span class="token keyword">FROM</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span>
<span class="token operator">+</span><span class="token comment">-----------+----------------+</span>
<span class="token operator">|</span> host      <span class="token operator">|</span> <span class="token keyword">user</span>           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+----------------+</span>
<span class="token operator">|</span> <span class="token operator">%</span>         <span class="token operator">|</span> text1          <span class="token operator">|</span>
<span class="token operator">|</span> localhost <span class="token operator">|</span> mysql<span class="token punctuation">.</span><span class="token keyword">session</span>  <span class="token operator">|</span>
<span class="token operator">|</span> localhost <span class="token operator">|</span> mysql<span class="token punctuation">.</span>sys      <span class="token operator">|</span>
<span class="token operator">|</span> localhost <span class="token operator">|</span> root			 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------+----------------+</span>
</code></pre> 
<p>在上述执行结果中，host 的值为 <code>%</code> 时表示当前的用户可以在任何主机中连接 MySQL 服务器；当其值为 <code>localhost</code> 时，表示当前的用户只能从本地主机连接 MySQL 服务器。另外，host 的值为空字符串（")同样也可表示匹配所有客户端。</p> 
<blockquote> 
 <p>用户名和主机名在设置时，若不包含空格、<code>-</code> 等特殊字符，则可以省略引号。另外，当创建的用户名称为空字符串（"）时，表示创建的是一个匿名用户，即登录MySQL服务器时不需要输入用户名和密码，这种操作会给MySQL服务器带来极大的安全隐患，因此不推荐用户创建并使用匿名用户操作MySQL服务器。</p> 
</blockquote> 
<p>🐬<strong>创建含有密码的用户</strong></p> 
<p>若要在创建用户的同时完成用户密码的设置，则可以选取用户身份验证选项的 IDENTIFIED BY 关键字。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'test2'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre> 
<p>IDENTIFIED BY 后指定的是字符串形式的明文密码。</p> 
<p>通过 SELECT 查询存储在 user 表中 test2 用户的密码。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> plugin<span class="token punctuation">,</span> authentication_string <span class="token keyword">FROM</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------------+-------------------------------------------+</span>
<span class="token operator">|</span> plugin			    <span class="token operator">|</span> authentication_string 					<span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------+-------------------------------------------+</span>
<span class="token operator">|</span> mysql_native_password <span class="token operator">|</span> <span class="token operator">*</span><span class="token number">6</span>BB4837EB74329105EE4568DDA7DC67ED2CA2AD9 <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------+-------------------------------------------+</span>
</code></pre> 
<p>创建用户时设置的明文密码 “123456”，在 use r表中以默认的算法插性 <code>mysql_native_password </code>将其转换为暗码。</p> 
<p>除此之外，在设置用户密码时还可以指定对密码加密的插件，只需将 <code>IDENTIFIED BY 明文密码</code> 修改为指定的选项即可，具体如下表所示。</p> 
<table><thead><tr><th>选 项</th><th>描 述</th></tr></thead><tbody><tr><td>IDENTIFIED WITH 验证插件名</td><td>使用指定的身份验证插件对空凭证（未设置用户密码）进行加密</td></tr><tr><td>IDENTIFIED WITH 验证插件名 BY 明文密码</td><td>利用指定的身份验证插件对明文密码进行加密</td></tr><tr><td>IDENTIFIED WITH 验证插件名 AS 哈希字符串</td><td>指定身份验证的插件，并存储哈希加密字符串</td></tr><tr><td>IDENTIFIED BY PASSWORD 哈希字符串</td><td>身份验证插件为默认，并存储哈希加密字符串</td></tr></tbody></table> 
<p>下面利用 IDENTIFIED WITH验证插件名 BY ‘明文密码’ 修改以上创建test2用户的SQL语句。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'test2'</span><span class="token variable">@'localhost'</span>
IDENTIFIED <span class="token keyword">WITH</span> <span class="token string">'mysql_native_password'</span> <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre> 
<p>在上述SQL语句中，IDENTIFIED WITH关键字指明验证密码的插件名，关键字BY后跟明文的密码。通过上述设置，明文密码 “123456” 将采用指定的插件算法，存储在user表中的对应字段中。</p> 
<p>🐬<strong>同时创建多个用户</strong></p> 
<p>MySQL中创建用户时，还可以一次创建多个。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> 
	<span class="token string">'test2'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'333333'</span><span class="token punctuation">;</span>
	<span class="token string">'test3'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'444444'</span><span class="token punctuation">;</span>
</code></pre> 
<p>在一个CREATE USER 语句中可同时创建多个用户，多个用户之间使用逗号分隔，并且在创建每个用户时可以单独为其设置密码，省略用户身份验证选项时，表明此用户在登录服务器时可以免密登录，但为了保证数据安全，不推荐用户这样做。</p> 
<p>🐬<strong>设置用户可操作资源范围</strong></p> 
<p>在创建用户时，可以添加 WITH 直接为用户指定可操作的资源范围，如登录的用户在一小时内可以查询数据的次数等，具体的参数选项如下表所示。</p> 
<table><thead><tr><th>选 项</th><th>描 述</th></tr></thead><tbody><tr><td>MAX_QUERIES_PER_HOUR</td><td>在任何一个小时内，允许此用户执行多少次查询</td></tr><tr><td>MAX_UPDATES_PER_HOUR</td><td>在任何一个小时内，允许此用户执行多少次更新</td></tr><tr><td>MAX_CONNECTIONS_PER_HOUR</td><td>在任何一个小时内，允许此用户执行多少次服务器连接</td></tr><tr><td>MAX_USER_CONNECTIONS</td><td>限制用户同时连接服务器的最大数量</td></tr></tbody></table> 
<p>在上表中，MAX_USER_CONNECTIONS 选项的值为 0 时，服务器将根据 max_userconnections 系统变量的值确定用户的同时连接数，若此变量值也为0，表示对该用户没有限制。另外MAX_QUERIES_PER_HOUR 选项不会计算从缓存中查询数据的次数。</p> 
<p>例如，创建一个名为test5的本地用户，限制其每小时最多可以更新10次。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> 
	<span class="token string">'test5'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'555555'</span>
	<span class="token keyword">WITH</span> MAX_UPDATES_PER_HOUR <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre> 
<p>创建完成后，可以查看 user 表中的 max_updates 字段。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> max_updates <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> <span class="token keyword">user</span><span class="token operator">=</span><span class="token string">'test5'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span> max_updates <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
<span class="token operator">|</span>		  <span class="token number">10</span>  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-------------+</span>
</code></pre> 
<p>🐬<strong>设置有密码期限的用户</strong></p> 
<p>在创建用户时，不仅可以为用户设置密码，还可以为密码设置有效时间，具体参数如下表所示。</p> 
<table><thead><tr><th>选 项</th><th>描 述</th></tr></thead><tbody><tr><td>PASSWORD EXPIRE</td><td>将密码标记为过期</td></tr><tr><td>PASSWORD EXPIRE DEFAULT</td><td>根据 default_password_lifetime 系统变量的指定设置密码的有效性</td></tr><tr><td>PASSWORD EXPIRE NEVER</td><td>密码永不过期</td></tr><tr><td>PASSWORD EXPIRE INTERVAL n DAY</td><td>将账户密码生存期设置为n天</td></tr></tbody></table> 
<p>PASSWORD EXPIRE 选项表示在创建用户时含有此选项的用户在登录后，执行任何SQL语句操作前，都需要重置用户的密码，否则会给出一个 “在执行此语句之前，必须使用 ALTER USER 语句重置密码” 的错误提示信息。</p> 
<p>在重置用户密码时，操作的用户必须要有全局的 CREATE USER 权限或 mysql 数据库的 UPDATE 特权。</p> 
<p>下面创建一个名为 test6 的用户，并设置其密码每 180 天更改一次。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'test6'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'666666'</span> 
PASSWORD EXPIRE <span class="token keyword">INTERVAL</span> <span class="token number">180</span> <span class="token keyword">DAY</span><span class="token punctuation">;</span>
</code></pre> 
<p>为了确保MySQL客户端用户本身的安全，通常情况下推荐每3~6个月变更一次数据库用户密码。</p> 
<p>🐬<strong>设置用户是否锁定</strong></p> 
<p>利用 ACCOUNT 关键字可以为创建的用户设置是否被锁定，它有两个可选值，分别为 LOCK(锁定)和UNLOCK(解锁)。被锁定的用户不能在客户端登录MySQL服务器。</p> 
<p>下面创建一个锁定的用户test 7。具体SQL语句及执行结果如下。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">USER</span> <span class="token string">'test7'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'777777'</span> 
PASSWORD EXPIRE ACCOUNT <span class="token keyword">LOCK</span><span class="token punctuation">;</span>
</code></pre> 
<p>此时，利用 SELECT 查看 mysql.user 表中名为 test7 的 account_ locked 字段，若其值为Y，则表示当前创建的用户已被锁定。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> account_locked <span class="token keyword">FROM</span> mysql<span class="token punctuation">.</span><span class="token keyword">user</span> <span class="token keyword">WHERE</span> <span class="token keyword">user</span> <span class="token operator">=</span> <span class="token string">'test7'</span><span class="token punctuation">;</span>
</code></pre> 
<p>此时若利用 test7 在客户端登录MySQL服务器，会报 “账户被锁定，拒绝访问test7@localhost” 用户的提示信息。</p> 
<p><img src="https://images2.imgbox.com/58/d3/d9Uu5bW7_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3066"></a>设置密码</h4> 
<p>在对MySQL中的用户进行管理时，除了创建用户的同时设置密码外，还可为没有密码的用户、密码过期的用户或为指定用户修改密码。</p> 
<pre><code class="prism language-sql"><span class="token comment"># 第1种语法</span>
<span class="token keyword">ALTER</span> <span class="token keyword">USER</span> 账户名 IDENTIFIED <span class="token keyword">BY</span> <span class="token string">'明文密码'</span><span class="token punctuation">;</span>
<span class="token comment"># 第2种语法</span>
<span class="token keyword">SET</span> PASSWORD <span class="token punctuation">[</span><span class="token keyword">FOR</span> 账户名<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'明文密码'</span><span class="token punctuation">;</span>
</code></pre> 
<p>在以上2种语法中，ALTER USER是更改密码的首选SQL语句，推荐使用。第2种语法可能会被记录到服务器的日志或客户端的历史文件中，会有密码泄露的风险，因此建议用户尽量少地使用此方式设置密码。</p> 
<p>🐬<strong>为指定用户设置密码</strong></p> 
<p>mysql.user 表中的 test1 用户是一个可在任何主机中连接MySQL服务器的用户，但此用户在创建时未设置密码，下面将 test1 的密码设置为123456。</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">'test1'</span><span class="token variable">@'%'</span> IDENTFIED <span class="token keyword">BY</span> <span class="token string">'123456'</span><span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>为登录用户设置密码</strong></p> 
<p>若当前通过客户端连接 MySQL 服务器的用户是非匿名用户，则可以使用 USER() 函数更改自己的密码，而无须直接为自己的账户命名。</p> 
<p>例如，修改当前正在连接 MySQL 服务器的 root 用户密码，将其设置为000000。</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token keyword">USER</span><span class="token punctuation">(</span><span class="token punctuation">)</span> IDENTFIED <span class="token keyword">BY</span> <span class="token string">'000000'</span><span class="token punctuation">;</span>
</code></pre> 
<p>USER() 函数获取的是客户端提供的用户和主机地址，它可能与当前通过 MySQL 服务器验证的用户与主机名不同，此时可以利用 MySQL 提供 CURRENT USER() 函数获取。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">CURRENT_USER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------------+</span>
<span class="token operator">|</span> <span class="token keyword">CURRENT_USER</span>   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+</span>
<span class="token operator">|</span> root<span class="token variable">@localhost</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------------+</span>
</code></pre> 
<p>🐬<strong>mysqladmin修改用户密码</strong></p> 
<p>在MySQL的安装目录 bin 下还有一个 mysqladmin.exe 应用程序，它通常用于执行一些管理性的工作，以及显示服务器状态等。同时，在 MySQL中也可以使用该命令修改用户的密码。</p> 
<pre><code class="prism language-sql">mysqladmin <span class="token operator">-</span>u 用户名 <span class="token punctuation">[</span><span class="token operator">-</span>h主机地址<span class="token punctuation">]</span> <span class="token operator">-</span>p password 新密码
</code></pre> 
<p>-u 用于指定待要修改的用户名，通常情况下指的是 root 用户；-h 用于指定对应的主机地址，省略时默认值为 localhost；-p 后面的 password 为关键字，而不是待修改用户的原密码。</p> 
<p>例如，在命令行窗口中，使用 mysqladmin 命令，将 root 用户的密码修改为 123456。</p> 
<pre><code class="prism language-sql">mysqladmin <span class="token operator">-</span>u root <span class="token operator">-</span>p password <span class="token number">123456</span>
Enter password: 
</code></pre> 
<p>在上述命令行中，“-p password” 后指定的是 root 用户修改后的新密码；而 “Enter password" 提示输入的密码指的是 root 用户的旧密码，只有此密码输入正确，才能完成用户密码的修改。</p> 
<p>值得一提的是，通过 mysqladmin 完成用户密码的设置时，会有两个安全警告提示。因此，为了确保密码安全应以安全连接方式连接MySQL服务器。在开发中一般<code>不推荐</code>使用此种方式修改用户密码。</p> 
<p>🐬<strong>SET PASSWORD 与 PASSWORD() 函数</strong></p> 
<p>在前面为用户设置密码的语法中可以看出，SET PASSWORD 在设置密码时，一种是添加PASSWORD() 函数，一种是不添加，两者的区别在于含有 PASSWORD() 函数的密码根据old_passwords 系统变量值 (0 表示 mysql_native_password 插件，2 表示 sha256_password插件）对指定的明文密码加密并验证；而不含有 PASSWORD() 函数的 SET PASSWORD 语句是将明文密码字符串传递给用户的验证插件，并将插件返回的结果保存到mysql.user表的字段中。</p> 
<p>🐬<strong>root 密码丢失找回</strong></p> 
<p>如果忘记MySQL服务的root用户密码，就不能通过以上设置密码的方式找回或重置。此时可以在MySQL的配置文件 my.ini 中添加 skip-grant-tables 选项，然后重启 MySQL 服务后再次利用 root 用户登录，就可以跳过密码的输入直接登录MySQL服务，为 root 用户设置密码。但是此种方式存在非常大的安全风险。因此，建议要慎重使用。</p> 
<p><img src="https://images2.imgbox.com/d3/13/wdE413gM_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3139"></a>修改用户</h4> 
<p>用户创建完成后，管理员可以通过 MySQL 提供的专门SQL语句修改用户的密码、身份验证的方式、资源限制、密码的属性，以及账户的锁定和解锁的状态。</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span>
账户名 <span class="token punctuation">[</span>用户身份验证选项<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>账户名 <span class="token punctuation">[</span>用户身份验证选项<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token keyword">WITH</span> 资源限制选项<span class="token punctuation">]</span> <span class="token punctuation">[</span>密码管理选项 <span class="token operator">|</span> 账户锁定选项<span class="token punctuation">]</span>
</code></pre> 
<p>ALTER USER 可以同时修改一个或多个用户，多个用户之间使用逗号分隔，并且语法中选项的可选值与创建用户时的选项完全相同。对于每个修改的用户，都会更新其在 mysql.user 表中对应的字段值，而未修改的字段仍然保留它原来的值。</p> 
<p>🐬<strong>修改验证插件</strong></p> 
<p>例如，将 mysql.user 表中名为 test1 的用户验证插件修改为 sha256_password，密码修改为111111，并将密码设置为立刻过期。</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> test1
	IDENTIFIED <span class="token keyword">WITH</span> sha256_password <span class="token keyword">BY</span> <span class="token string">'111111'</span> 
	PASSWORD EXPIRE<span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>解锁用户</strong></p> 
<p>解锁 mysql.user 表中被锁定的用户 test7。</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">'test'</span><span class="token variable">@'localhost'</span> ACCOUNT <span class="token keyword">UNLOCK</span><span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>同时修改多个用户的资源限定</strong></p> 
<p>例如，修改 mysql. user 表中的 test1 和 test2 用户，限定单个用户最多可同时建立两个连接，同时将test1 的验证插件修改为MySQL的默认值，test2用户的密码修改为 222222。</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">USER</span>
	<span class="token string">'test1'</span> IDENTFIED <span class="token keyword">WITH</span> mysql_native_password<span class="token punctuation">,</span>
	<span class="token string">'test2'</span><span class="token variable">@'localhost'</span> IDENTFIED <span class="token keyword">BY</span> <span class="token string">'222222'</span><span class="token punctuation">,</span>
	<span class="token keyword">WITH</span> max_user_connections <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>为用户重命名</strong></p> 
<p>在利用 ALTER USER 修改用户时只能修改指定账户的相关选项，如密码、验证插件、资源控制选项等，而不能够为用户重新命名，此时可以使用 MySQL 专门提供的RENAME USER语句实现。</p> 
<pre><code class="prism language-sql"><span class="token keyword">RENAME</span> <span class="token keyword">USER</span> 旧用户名<span class="token number">1</span> <span class="token keyword">TO</span> 新用户名<span class="token number">1</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> 旧用户名<span class="token number">2</span> <span class="token keyword">TO</span> 新用户名<span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<p>RENAME USER 在为用户重命名时，旧用户名与新用户名之间使用 TO 关键字连接，同时为多个用户重命名时使用逗号（，）进行分隔。</p> 
<p><img src="https://images2.imgbox.com/fd/42/P87afxWw_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3192"></a>删除用户</h4> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">USER</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> 账户名 <span class="token punctuation">[</span><span class="token punctuation">,</span> 账户名<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
</code></pre> 
<p>在 MySQL5.x 版本之后 DROP USER 语句可以同时删除一个或多个MySQL中的指定用户，并会同时从授权表中删除账户对应的权限行。在 MySQL5.x 之前的版本中，在删除用户前必须先回收用户的权限。其中，账户名与创建用户的格式相同，由 <code>用户名@主机地址</code> 组成。</p> 
<p>下面以删除 mysql.user 中test7用户为例进行演示。</p> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">USER</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> test7<span class="token punctuation">;</span>
</code></pre> 
<p>在不添加 IF EXISTS 关键字时，若删除了一个不存在的用户，则该语句的执行会发生错误；在添加后，会在删除不存在的用户时生成一个警告作为提示。其中，在删除账户时，如果省略主机地址，则默认为“%”。</p> 
<p>当 DROP USER 语句删除当前正在打开的用户时，则该用户的会话不会被自动关闭。只有在该用户会话关闭后，删除操作才会生效，再次登录将会失败。另外，利用已删除的用户登录服务器创建的数据库或对象不会因此删除操作而失效。</p> 
<p><img src="https://images2.imgbox.com/75/e8/3F1yAYag_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_3212"></a>权限管理</h3> 
<p>在实际项目开发中，为了保证数据的安全，数据库管理员需要为不同层级的操作人员分配不同的权限，限制登录MySQL服务器的用户只能在其权限范围内操作。同时管理员还可以根据不同的情况为用户增加权限或回收权限，从而控制数据操作人员的权限。</p> 
<p><img src="https://images2.imgbox.com/ce/06/7MejJu6u_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3218"></a>授予权限</h4> 
<p>MySQL中的权限信息根据其作用范围，分别存储在mysql数据库中的不同数据表中。当MySQL启动时会自动加载这些权限信息，并将这些权限信息读取到内存中。与权限相关的数据表如下表所示。</p> 
<table><thead><tr><th>数 据 表</th><th>描 述</th></tr></thead><tbody><tr><td>user</td><td>保存用户被授予的全局权限</td></tr><tr><td>db</td><td>保存用户被授予的数据库权限</td></tr><tr><td>tables_priv</td><td>保存用户被授予的表权限</td></tr><tr><td>columns_priv</td><td>保存用户被授予的列权限</td></tr><tr><td>procs_priv</td><td>保存用户被授予的存储过程权限</td></tr><tr><td>proxies_priv</td><td>保存用户被授予的代理权限</td></tr></tbody></table> 
<p>上表中保存权限的数据表，根据权限的操作内容可将权限大致分为数据权限、结构权限以及管理权限(通常只有管理员有管理权限)。</p> 
<p>列举MySQL中可以授予和取消的权限，如下所示。</p> 
<p>🐬<strong>数据权限</strong></p> 
<table><thead><tr><th>权 限</th><th>权 限 级 别</th><th>描 述</th></tr></thead><tbody><tr><td>SELECT</td><td>全局、数据库、表、列</td><td>SELECT</td></tr><tr><td>UPDATE</td><td>全局、数据库、表、列</td><td>UPDATE</td></tr><tr><td>DELETE</td><td>全局、数据库、表</td><td>DELETE</td></tr><tr><td>INSERT</td><td>全局、数据库、表、列</td><td>INSERT</td></tr><tr><td>SHOW DATABASES</td><td>全局</td><td>SHOW DATABASES</td></tr><tr><td>SHOW VIEW</td><td>全局、数据库、表</td><td>SHOW CREATE VIEW</td></tr><tr><td>PROCESS</td><td>全局</td><td>SHOW PROCESSLIST</td></tr></tbody></table> 
<p>🐬<strong>结构权限</strong></p> 
<table><thead><tr><th>权 限</th><th>权 限 级 别</th><th>描 述</th></tr></thead><tbody><tr><td>DROP</td><td>全局、数据库、表</td><td>允许删除数据库、表和视图</td></tr><tr><td>CREATE</td><td>全局、数据库、表</td><td>创建数据库、表</td></tr><tr><td>CREATE ROUTINE</td><td>全局、数据库</td><td>创建存储过程</td></tr><tr><td>CREATE TABLESPACE</td><td>全局</td><td>允许创建、修改或删除表空间和日志文件组</td></tr><tr><td>CREATE TEMPORARY TABLES</td><td>全局、数据库</td><td>CREATE TEMPORARY TABLE</td></tr><tr><td>CREATE VIEW</td><td>全局、数据库、表</td><td>允许创建或修改视图</td></tr><tr><td>ALTER</td><td>全局、数据库、表</td><td>ALTER TABLE</td></tr><tr><td>ALTER ROUTINE</td><td>全局、数据库、存储过程</td><td>允许删除或修改存储过程</td></tr><tr><td>INDEX</td><td>全局、数据库、表</td><td>允许创建或删除索引</td></tr><tr><td>TRIGGER</td><td>全局、数据库、表</td><td>允许触发器的所有操作</td></tr><tr><td>REFERENCES</td><td>全局、数据库、表、列</td><td>允许创建外键</td></tr></tbody></table> 
<p>🐬<strong>管理权限</strong></p> 
<table><thead><tr><th>权 限</th><th>权 限 级 别</th><th>描 述</th></tr></thead><tbody><tr><td>SUPER</td><td>全局</td><td>允许使用其他管理操作，如CHANGE MASTER TO等</td></tr><tr><td>CREATE USER</td><td>全局</td><td>CREATE USER、DROP USER、 RENAME USER 和 REVOKEALL PRIVILEGES</td></tr><tr><td>GRANT OPTION</td><td>全局、数据库、表、存储过程、代理</td><td>允许授予或删除用户权限</td></tr><tr><td>RELOAD</td><td>全局</td><td>FLUSH操作</td></tr><tr><td>PROXY</td><td></td><td>与代理的用户权限相同</td></tr><tr><td>REPLICATION CLIENT</td><td>全局</td><td>允许用户访问主服务器或从服务器</td></tr><tr><td>REPLICATION SLAVE</td><td>全局</td><td>允许复制从服务器读取的主服务器二进制日志事件</td></tr><tr><td>SHUTDOWN</td><td>全局</td><td>允许使用mysqladmin_shutdown</td></tr><tr><td>LOCK TABLES</td><td>全局、数据库</td><td>允许在有SELECT表权限上使用 LOCK TABLES</td></tr></tbody></table> 
<p>MySQL提供的 GRANT 用于实现用户权限的授予。</p> 
<pre><code class="prism language-sql"><span class="token keyword">GRANT</span>
权限类型 <span class="token punctuation">[</span>字段列表<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> 权限类型 <span class="token punctuation">[</span>字段列表<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
<span class="token keyword">ON</span> <span class="token punctuation">[</span>目标类型<span class="token punctuation">]</span> 权限级别
<span class="token keyword">TO</span> 账户名 <span class="token punctuation">[</span>用户身份验证选项<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> 账户名<span class="token punctuation">[</span>用户身份验证选项<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token keyword">REQUIRE</span> 连接方式<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">WITH</span> <span class="token punctuation">[</span><span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span> <span class="token operator">|</span> 资源控制选项}<span class="token punctuation">]</span>
</code></pre> 
<p>权限类型指的就是上表中的权限列，字段列表用于设置列权限，ON 后的目标类型默认为 TABLE，表示将全局、数据库、表或列中的某些权限授予给指定的用户。另外，其值还可以是 FUNCTION(函数) 或 PROCEDURE(存储过程)。</p> 
<p>权限级别用于定义全局权限、数据库权限和表权限，添加GRANT OPTION 表示当前账户可以为其他账户进行授权。其余各参数均与 CREATE USER 中的用户选项相同。</p> 
<p>下面首先使用 SHOW GRANTS [FOR账户] 查看一下 root 和 test1 用户被授权的情况。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> <span class="token string">'root'</span><span class="token variable">@'localhost'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------------------------------------+</span>
<span class="token operator">|</span>Grants <span class="token keyword">for</span> root<span class="token variable">@localhost</span>                                           <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------------------------------------+</span>
<span class="token operator">|</span><span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'root'</span><span class="token variable">@'localhost'</span> <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token keyword">GRANT</span> PROXY <span class="token keyword">ON</span> <span class="token string">''</span>@'<span class="token string">' TO '</span>root<span class="token string">'@'</span>localhost' <span class="token keyword">WITH</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span>        <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------------------------------------+</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> GRANTS <span class="token keyword">FOR</span> <span class="token string">'test1'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>		
<span class="token operator">+</span><span class="token comment">------------------------------------------+</span>
<span class="token operator">|</span>Grants <span class="token keyword">for</span> test1@<span class="token operator">%</span>  					   <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------+</span>
<span class="token operator">|</span><span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span> <span class="token keyword">ON</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> <span class="token string">'test'</span><span class="token variable">@'%'</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------------------------------------------+</span>
</code></pre> 
<p>在上述SQL语句中，若在客户端使用的是 root 用户登录MySQL服务器，则此处在查看root用户权限时,可以省略 FOR ‘root’@localhost’。</p> 
<p>在查询结果中 ALL PRIVILEGES 表示除 GRANT OPTION(授权权限) 和 PROXY(代理权限) 外的所有权限，USAGE 表示没有任何权限。ON后的 <code>*.*</code> 表示全局级别的权限，即MySQL服务器下的所有数据库下的所有表，<code>''@''</code>表示任何主机中的匿名用户。</p> 
<p>在为用户授予权限时，可以分为6个不同的级别，具体的实现在于 ON 子句以及权限列表的不同，如下表所示。</p> 
<table><thead><tr><th>权 限 级 别</th><th>实 现 语 法</th></tr></thead><tbody><tr><td>全局权限</td><td>GRANT 权限列表 <code>ON</code> *.* TO 账户名 [WITH GRANT OPTION];</td></tr><tr><td>数据库级权限</td><td>GRANT 权限列表 <code>ON 数据库名.*</code> TO 账户名 [WITH GRANT OPTION];</td></tr><tr><td>表级权限</td><td>GRANT 权限列表 <code>ON 数据库名.表名</code> TO 账户名 [WITH GRANT OPTION];</td></tr><tr><td>列级权限</td><td>GRANT <code>权限类型（字段列表）[, ...] ON 数据库名.表名</code> TO 账户名 [WITH GRANT OPTION];</td></tr><tr><td>存储过程权限</td><td>GRANT <code>EXECUTE | ALTER ROUTINE | CREATE ROUTINE ON {[*.* | 数据库名.*] | PROCEDURE 数据库名.存储过程}</code> TO 账户名 [WITH GRANT OPTION];</td></tr><tr><td>代理权限</td><td>GRANT <code>PROXY ON 账户名</code> TO 账户名1 [, 账户名2 ] … [WITH GRANT OPTION];</td></tr></tbody></table> 
<p>需要注意的是，要想使用GRANT语句为用户授权，必须要拥有GRANT OPTION 权限；且在启用read_only 系统变量时，还必须要拥有 SUPER 权限。</p> 
<p>下面以授予 test1 用户 shop.sh_goods 表的 SELECT 权限，以及对name和price字段的插入权限为例。</p> 
<pre><code class="prism language-sql"><span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span><span class="token punctuation">,</span> <span class="token keyword">INSERT</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> price<span class="token punctuation">)</span> <span class="token keyword">ON</span> shop<span class="token punctuation">.</span>sh_goods <span class="token keyword">TO</span> <span class="token string">'test1'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
</code></pre> 
<p>SELECT 权限是表级权限(shop.sh_goods表)，INSERT是列级权限(shop.sh_goods表中的name和price字段)。</p> 
<p>在SQL语句执行成功后，若要查看 test1 的权限，可以到 mysql.tables_priv 中查看表权限，到mysql.columns_priv 中查看列权限。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> db<span class="token punctuation">,</span> table_name<span class="token punctuation">,</span> table_priv<span class="token punctuation">,</span> column_priv <span class="token keyword">FROM</span> mysql<span class="token punctuation">.</span>tables_priv <span class="token keyword">WHERE</span> <span class="token keyword">user</span> <span class="token operator">=</span> <span class="token string">'test1'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+-----------+------------+</span>
<span class="token operator">|</span>db   <span class="token operator">|</span>table_name <span class="token operator">|</span>table_priv <span class="token operator">|</span>column_priv <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+-----------+------------+</span>
<span class="token operator">|</span>shop <span class="token operator">|</span>sh_goods   <span class="token operator">|</span><span class="token keyword">Select</span>     <span class="token operator">|</span><span class="token keyword">Insert</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+-----------+------------+</span>
</code></pre> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> db<span class="token punctuation">,</span> table_name<span class="token punctuation">,</span> column_priv<span class="token punctuation">,</span> column_priv <span class="token keyword">FROM</span> mysql<span class="token punctuation">.</span>tables_priv <span class="token keyword">WHERE</span> <span class="token keyword">user</span> <span class="token operator">=</span> <span class="token string">'test1'</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+------------+------------+</span>
<span class="token operator">|</span>db   <span class="token operator">|</span>table_name <span class="token operator">|</span>column_priv <span class="token operator">|</span>column_priv <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+------------+------------+</span>
<span class="token operator">|</span>shop <span class="token operator">|</span>sh_goods   <span class="token operator">|</span>name        <span class="token operator">|</span><span class="token keyword">Insert</span>      <span class="token operator">|</span>
<span class="token operator">|</span>shop <span class="token operator">|</span>sh_goods   <span class="token operator">|</span>price       <span class="token operator">|</span><span class="token keyword">Insert</span>      <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----+-----------+------------+------------+</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0b/83/pUQ2ZB87_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3360"></a>回收权限</h4> 
<p>在MySQL中，为了保证数据库的安全，需要将用户不必要的权限回收。</p> 
<p>例如，数据管理员发现某个用户不应该具有 DELETE 权限，就应该及时将其收回。为此，MySQL专门提供了一个 REVOKE 语句用于回收指定用户的权限。</p> 
<pre><code class="prism language-sql"><span class="token keyword">REVOKE</span> 权限类型 <span class="token punctuation">[</span><span class="token punctuation">(</span>字段列表<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> 权限类型<span class="token punctuation">[</span><span class="token punctuation">(</span>字段列表<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">ON</span> <span class="token punctuation">[</span>目标类型<span class="token punctuation">]</span> 权限级别 <span class="token keyword">FROM</span> 账户名<span class="token punctuation">[</span><span class="token punctuation">,</span> 账户名<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<p>权限类型、目标类型以及权限级别与授予权限 GRANT 的参数相同。</p> 
<p>下面以删除test1用户对 shop.sh_goods 表的 name 和 price 字段的插入权限为例。</p> 
<pre><code class="prism language-sql"><span class="token keyword">REVOKE</span> <span class="token keyword">INSERT</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> price<span class="token punctuation">)</span> <span class="token keyword">ON</span> shop<span class="token punctuation">.</span>sh_goods <span class="token keyword">FROM</span> <span class="token string">'test'</span><span class="token variable">@'%'</span><span class="token punctuation">;</span>
</code></pre> 
<p>当用户的权限比较多，并且想要一次性将其全部收回时，使用上述语句就会比较麻烦，为此，可以使用以下的方式回收权限。</p> 
<pre><code class="prism language-sql"><span class="token comment"># 回收数据、结构、管理所有的权限以及可为其他用户授权的权限</span>
<span class="token keyword">REVOKE</span> <span class="token keyword">ALL</span> <span class="token punctuation">[</span><span class="token keyword">PRIVILEGES</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">GRANT</span> <span class="token keyword">OPTION</span> <span class="token keyword">FROM</span> 账户名 <span class="token punctuation">[</span><span class="token punctuation">,</span> 账户名<span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment">#回收用户的代理权限</span>
<span class="token keyword">REVOKE</span> PROXY <span class="token keyword">ON</span> 账户名 <span class="token keyword">FROM</span> 账户名<span class="token number">1</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> 账户名<span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<p>“ALL [PRIVILEGES]” 中的 PRIVILEGES 在使用时可以省略，它表示除去GRANT OPTION(授予权限)和 PROXY(代理权限)外的所有权限。</p> 
<p><img src="https://images2.imgbox.com/df/d1/uUTNUg2b_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3393"></a>刷新权限</h4> 
<p>刷新权限指的是从系统数据库mysql中的权限表中重新加载用户的权限。原因在于GRANT、CREAT EUSER 等操作会将服务器的缓存信息保存到内存中，而 REVOKE、DROP USER 操作并不会同步到内存中，因此可能会造成服务器内存的消耗，所以在 REVOKE、DROP USER 后推荐读者使用MySQL 提供的 FLUSH PRIVILEGES 重新加载用户的权限。</p> 
<pre><code class="prism language-sql">FLUSH <span class="token keyword">PRIVILEGES</span><span class="token punctuation">;</span>
</code></pre> 
<p>另外，刷新权限也可以利用msyqladmin命令完成。</p> 
<pre><code class="prism language-shell"><span class="token comment"># 方式1</span>
msyqladmin -uroot -p reload

<span class="token comment">#方式2</span>
msyqladmin -uroot -p flush-privileges
</code></pre> 
<p>上述操作命令在执行时，首先会提示输入root用户的密码。其中，reload 与 flush-privileges 都可以用于重载权限信息。</p> 
<p><img src="https://images2.imgbox.com/e8/87/7wZRa9m9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_3414"></a>视图</h3> 
<p>视图是从一个或多个表中导出来的表，它是一种虚拟存在的表，表的结构和数据都依赖于基本表。</p> 
<p>通过视图不仅可以看到存放在基本表中的数据，还可以像操作基本表一样，对数据进行查询、添加、修改和删除。</p> 
<p>与直接操作基本表相比，视图具有如下优点。</p> 
<ul><li> <p>简化查询语句。</p> 
  <ul><li>通过视图可以简化查询语句，简化用户的查询操作，使查询更加快捷。日常开发中可以将经常使用的查询定义为视图，从而避免大量重复的操作。</li></ul> </li><li> <p>安全性。</p> 
  <ul><li>通过视图可以更方便地进行权限控制，能够使特定用户只能查询和修改他们所能见到的数据，数据库中的其他数据则既看不到也取不到。</li></ul> </li><li> <p>逻辑数据独立性。</p> 
  <ul><li>视图可以屏蔽真实表结构变化带来的影响。</li><li>例如，当其他应用程序查询数据时，若直接查询数据表，一旦表结构发生改变，查询的SQL语句就会发生改变，应用程序也必须随之更改。但若为应用程序提供视图，修改表结构后只需修改视图对应的SELECT语句，就无须更改应用程序。</li></ul> </li></ul> 
<p><img src="https://images2.imgbox.com/ee/7a/YL6W7Tlb_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3434"></a>语法格式</h4> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token punctuation">[</span><span class="token operator">OR</span> <span class="token keyword">REPLACE</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">ALGORITHM</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">UNDEFINED</span> <span class="token operator">|</span> <span class="token keyword">MERGE</span> <span class="token operator">|</span> <span class="token keyword">TEMPTABLE</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>DEEINER <span class="token operator">=</span> { <span class="token keyword">user</span> <span class="token operator">|</span> <span class="token keyword">CURRENT_USER</span> }<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">SQL</span> SECURITY { <span class="token keyword">DEFINER</span> <span class="token operator">|</span> <span class="token keyword">INVOKER</span> }<span class="token punctuation">]</span>
<span class="token keyword">VIEW</span> view_name <span class="token punctuation">[</span><span class="token punctuation">(</span>column_list<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">AS</span> select_statement
<span class="token punctuation">[</span><span class="token keyword">WITH</span> <span class="token punctuation">[</span><span class="token keyword">CASCADED</span> <span class="token operator">|</span> <span class="token keyword">LOCAL</span><span class="token punctuation">]</span> <span class="token keyword">CHECK</span> <span class="token keyword">OPTION</span><span class="token punctuation">]</span>
</code></pre> 
<p>🐬<strong>说明：</strong></p> 
<p>CREATE：表示创建视图的关键字。</p> 
<p>OR REPLACE：可选，表示替换已有视图。</p> 
<p>ALGORITHM：可选，表示视图算法，会影响查询语句的解析方式，它的取值有如下3个，一般情况下使用UNDEFINED即可。</p> 
<ul><li> <p>UNDEFINED（默认）：由MySQL自动选择算法。</p> </li><li> <p>MERGE：将select_statement和查询视图时的SELECT语句合并起来查询。</p> </li><li> <p>TEMPTABLE：先将select_statement的查询结果存入临时表，然后用临时表进行查询。</p> </li></ul> 
<p>DEFINER：可选，表示定义视图的用户，与安全控制有关，默认为当前用户。</p> 
<p>SQL SECURITY：可选，用于视图的安全控制，它的取值有如下两个。</p> 
<ul><li> <p>DEFINER(默认)：由定义者指定的用户的权限来执行。</p> </li><li> <p>INVOKER：由调用视图的用户的权限来执行。</p> </li></ul> 
<p>view_name：表示要创建的视图名称。</p> 
<p>column_list：可选，用于指定视图中的各个列的名称。默认情况下，与SELECT语句查询的列相同。</p> 
<p>AS：表示视图要执行的操作。</p> 
<p>select_statement：一个完整的查询语句，表示从某些表或视图中查出某些满足条件的记录，将这些记录导入视图中。</p> 
<p>WITH CHECK OPTION：可选，用于视图数据操作时的检查条件。若省略此子句，则不进行检查。它的取值有如下两个。</p> 
<ul><li> <p>CASCADED(默认）：操作数据时要满足所有相关视图和表定义的条件。例如，当在一个视图的基础上创建另一个视图时，进行级联检查。</p> </li><li> <p>LOCAL：操作数据时满足该视图本身定义的条件即可。</p> </li><li></ul> 
<p>🐬<strong>提示：</strong></p> 
<p>在默认情况下，新创建的视图保存在当前选择的数据库中。若要明确指定在某个数据库中创建视图，在创建时应将名称指定为 <code>数据库名.视图名</code>。</p> 
<p>在 SHOW TABLES 的查询结果中会包含已经创建的视图。</p> 
<p>创建视图要求用户具有CREATE VIEW 权限，以及查询涉及的列的 SELECT 权限。如果还有OR REPLACE 子句，必须具有视图的 DROP 权限。</p> 
<p>在同一个数据库中，视图名称和已经存在的表名称不能相同，为了区分，建议在命名时添加 <code>view_</code> 前缀或 <code>_view</code> 后缀。</p> 
<p>视图创建后，MySQL就会在数据库目录中创建一个 <code>视图名.frm</code> 文件。</p> 
<p><img src="https://images2.imgbox.com/25/46/Q9BdjaOh_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3494"></a>创建视图</h4> 
<p>🐬<strong>在多表上创建视图</strong></p> 
<p>除了在单表上创建视图，还可以在两个或者两个以上的基本表上创建视图。下面通过案例演示在sh_goods 和 sh_goods_category 两张表上创建视图。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> view_goods_cate <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> g<span class="token punctuation">.</span>id<span class="token punctuation">,</span> g<span class="token punctuation">.</span>name<span class="token punctuation">,</span> c<span class="token punctuation">.</span>name category_name <span class="token keyword">FROM</span> sh_goods
<span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> sh_goods_category c
<span class="token keyword">ON</span> g<span class="token punctuation">.</span>category_id <span class="token operator">=</span> c<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre> 
<p>当在创建视图时指定的 SELECT 语句涉及多张表的查询时，创建的视图就是多表视图。</p> 
<p>🐬<strong>自定义列名称</strong></p> 
<p>通过创建视图的语法格式可知，视图的列名称可以自定义。下面通过案例演示在创建视图时自定义列名称，具体SQL语句和运行结果如下。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> view_goods_promo <span class="token punctuation">(</span>sn<span class="token punctuation">,</span> title<span class="token punctuation">,</span> promotion_price<span class="token punctuation">)</span> <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> price <span class="token operator">*</span> <span class="token number">0.8</span> <span class="token keyword">FROM</span> sh_goods<span class="token punctuation">;</span>
</code></pre> 
<p>从上述结果可以看出，在创建视图时，自定义列名称的顺序与 AS 后 SELECT 字段列表的顺序一致，即 sn 对应 id，title 对应 name，promotion_price 对应 price * 0.8。</p> 
<p>❗自定义列名称的数量必须与SELECT字段列表的数量一致，若不一致，MySQL会报错，视图将无法创建。</p> 
<p>🐬<strong>视图安全控制</strong></p> 
<p>从创建视图的语法格式可知，在创建视图时指定 DEFINER 和 SQL SECURITY 可以控制视图的安全。</p> 
<p>下面通过案例演示它们的作用。</p> 
<pre><code class="prism language-sql"><span class="token comment"># 创建测试用户 shop_test</span>
<span class="token keyword">CREATE</span> <span class="token keyword">USER</span> shop_test<span class="token punctuation">;</span>

<span class="token comment"># 创建第1个视图，权限控制使用默认值</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> view_goods_t1 <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> sh_goods <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment"># 创建第2个视图，设置 DEFINER 为 shop_test 用户</span>
<span class="token keyword">CREATE</span> <span class="token keyword">DEFINER</span> <span class="token operator">=</span> <span class="token string">'shop_test'</span> <span class="token keyword">VIEW</span> view_goods_t2 <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> sh_goods <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment"># 创建第3个视图，设置 SQL SECURITY 为 INVOKER</span>
<span class="token keyword">CREATE</span> <span class="token keyword">SQL</span> SECURITY <span class="token keyword">INVOKER</span> <span class="token keyword">VIEW</span> view_goods_t3 <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> sh_goods <span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>


<span class="token comment"># 为shop_test用户赋予前面创建的3个视图的SELECT权限</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> view_goods_t1 <span class="token keyword">TO</span> <span class="token string">'shop_test'</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> view_goods_t2 <span class="token keyword">TO</span> <span class="token string">'shop_test'</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> view_goods_t3 <span class="token keyword">TO</span> <span class="token string">'shop_test'</span><span class="token punctuation">;</span>
</code></pre> 
<p>在上述操作创建的3个视图中，view_goods_t1 的 DEFINER 为当前用户root，SQL SECURITY为DEFINER；view_goods_t2 的 DEFINER 为 shop_test 用户，SQL SECURITY 同样也是DEFINER；view_goods_t3 的 DEFINER 为当前用户 root，但SQL SECURITY 为 INVOKER。</p> 
<p><img src="https://images2.imgbox.com/40/d3/II4cj3As_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3552"></a>查看视图</h4> 
<p>查看视图，是指查看数据库中已经存在的视图的定义。查看视图必须要有SHOW VIEW的权限。</p> 
<p>🐬<strong>查看视图的字段信息</strong></p> 
<p>MySQL提供的 <code>DESCRIBE(DESC) 视图名</code> 语句不仅可以查看数据表的字段信息，还可以查看视图的字段信息。</p> 
<p>🐬<strong>查看视图状态信息</strong></p> 
<p>MySQL提供的 <code>SHOW TABLE STATUS '视图名 \G'</code> 语句不仅可以查看数据表的状态信息，还可以查看视图的状态信息。</p> 
<p>🐬<strong>查看视图的创建语句</strong></p> 
<p>使用 <code>SHOW CREATE VIEW</code> 或 <code>SHOW CREATE TABLE 视图名 \G</code> 语句可以查看创建视图时的定义语句以及视图的字符编码。</p> 
<p><img src="https://images2.imgbox.com/a0/f5/L5hGGyap_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3570"></a>修改视图</h4> 
<p>修改视图是指修改数据库中存在的视图的定义。当基本表中的某些字段发生变化时，视图必须修改才能正常使用。在MySQL中修改视图的方式有两种，具体如下。</p> 
<p>🐬<strong>替换已有的视图</strong></p> 
<p>通过 <code>CREATE OR REPLACE VIEW</code> 语句可以在创建视图时替换已有的同名视图，如果视图不存在，则创建一个视图。</p> 
<pre><code class="prism language-sql"><span class="token comment"># 创建视图</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> view_goods <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> price <span class="token keyword">FROM</span> sh_goods<span class="token punctuation">;</span>

<span class="token comment">#修改以有视图</span>
<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> view_goods <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name <span class="token keyword">FROM</span> sh_goods<span class="token punctuation">;</span>
</code></pre> 
<p>🐬<strong>使用 ALTER VIEW 语句修改视图</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token punctuation">[</span><span class="token keyword">ALGORITHM</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">UNDEFINED</span> <span class="token operator">|</span> <span class="token keyword">MERGE</span> <span class="token operator">|</span> <span class="token keyword">TEMPTABLE</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>DEEINER <span class="token operator">=</span> { <span class="token keyword">user</span> <span class="token operator">|</span> <span class="token keyword">CURRENT_USER</span> }<span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token keyword">SQL</span> SECURITY { <span class="token keyword">DEFINER</span> <span class="token operator">|</span> <span class="token keyword">INVOKER</span> }<span class="token punctuation">]</span>
<span class="token keyword">VIEW</span> view_name <span class="token punctuation">[</span><span class="token punctuation">(</span>column_list<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">AS</span> select_statement
<span class="token punctuation">[</span><span class="token keyword">WITH</span> <span class="token punctuation">[</span><span class="token keyword">CASCADED</span> <span class="token operator">|</span> <span class="token keyword">LOCAL</span><span class="token punctuation">]</span> <span class="token keyword">CHECK</span> <span class="token keyword">OPTION</span><span class="token punctuation">]</span>
</code></pre> 
<p>ALTER 后面内容的各部分子句与 CREATE VIEW 语句中的子句含义相同。</p> 
<p><img src="https://images2.imgbox.com/c7/08/6f5zlEqe_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3601"></a>删除视图</h4> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> <span class="token keyword">VIEW</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> 视图名<span class="token number">1</span> <span class="token punctuation">[</span><span class="token punctuation">,</span>视图名<span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7e/3d/8SuQc60u_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3609"></a>数据操作</h4> 
<p>视图数据操作就是通过视图来查询、添加、修改、删除基本表中的数据。</p> 
<p>视图是一个虚拟表，不保存数据，当通过视图来操作数据时，实际操作的是基本表中的数据</p> 
<p>使用 INSERT 语句可以通过视图向基本表中添加数据 。</p> 
<p>使用 UPADTE 语句可以通过视图修改基本表中的数据。</p> 
<p>使用 DELETE 语句可以通过视图删除基本表中的数据。</p> 
<p>这些语句使用方法与前面讲解添加数据的方式一样，只需将数据表名换成视图表名即可。</p> 
<p>🐬<strong>视图检查条件</strong></p> 
<p>在创建视图的语法格式中，WITH CHECK OPTION 子句用于在视图数据操作时进行条件检查。</p> 
<pre><code class="prism language-sql"><span class="token comment"># 创建第一个视图</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> view_cate_t1 <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token keyword">FROM</span> sh_goods_category <span class="token keyword">WHERE</span> id <span class="token operator">&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span>

<span class="token comment"># 创建第二个视图，使用CASCADED(级联)检查</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> view_cate_t2 <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token keyword">FROM</span> view_cate_t1 <span class="token keyword">WHERE</span> id <span class="token operator">&gt;</span> <span class="token number">20</span> 
<span class="token keyword">WITH</span> <span class="token keyword">CHECK</span> <span class="token keyword">OPTION</span><span class="token punctuation">;</span>  <span class="token comment">#相当于 WITH CASCADED CHECK OPTION</span>

<span class="token comment"># 插入数据，id必须大于20小于30才可以插入成功</span>

<span class="token comment"># 创建第三个视图，使用LOCAL(本视图，非级联)检查</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> view_cate_t3 <span class="token keyword">AS</span> <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token keyword">FROM</span> view_cate_t1 <span class="token keyword">WHERE</span> id <span class="token operator">&gt;</span> <span class="token number">20</span> 
<span class="token keyword">WITH</span> <span class="token keyword">LOCAL</span> <span class="token keyword">CHECK</span> <span class="token keyword">OPTION</span><span class="token punctuation">;</span> 

<span class="token comment"># 插入数据，只需满足id大于20即可插入</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d9/68/ZpojEYeE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_3645"></a>事务</h3> 
<p>在MySQL中，事务就是针对数据库的一组操作，它可以由一条或多条SQL语句组成，且每个SQL语句是相互依赖的。只要在程序执行过程中有一条SQL语句执行失败或发生错误，则其他语句都不会执行。也就是说，事务的执行要么成功，要么就返回到事务开始前的状态，这就保证了同一事务操作的同步性和数据的完整性。</p> 
<p>MySQL中的事务必须满足A、C、I、D这4个基本特性，具体如下。</p> 
<ul><li> <p>原子性</p> 
  <ul><li> <p>原子性(Atomicity)是指一个事务必须被视为一个不可分割的最小工作单元，只有事务中所有的数据库操作都执行成功，才算整个事务执行成功。</p> </li><li> <p>事务中如果有任何一个SQL语句执行失败，已经执行成功的SQL语句也必须撤销，数据库的状态退回到执行事务前的状态。</p> </li></ul> </li><li> <p>一致性</p> 
  <ul><li> <p>一致性(Consistency)是指在事务处理时，无论执行成功还是失败，都要保证数据库系统处于一致的状态，保证数据库系统不会返回到一个未处理的事务中。</p> </li><li> <p>MySQL中的一致性主要由日志机制实现，通过日志记录数据库的所有变化，为事务恢复提供了跟踪记录。</p> </li></ul> </li><li> <p>隔离性</p> 
  <ul><li> <p>隔离性（Isolation)是指当一个事务在执行时，不会受到其他事务的影响。保证了未完成事务的所有操作与数据库系统的隔离，直到事务完成为止，才能看到事务的执行结果。</p> </li><li> <p>隔离性相关的技术有并发控制、可串行化、锁等。当多个用户并发访问数据库时，数据库为每一个用户开启的事务，不能被其他事务的操作数据所干扰，多个并发事务之间要相互隔离。</p> </li></ul> </li><li> <p>持久性</p> </li><li> <p>持久性(Durability)是指事务一旦提交，其对数据库的修改就是永久性的。需要注意的是，事务的持久性不能做到百分百的持久，只能从事务本身的角度来保证永久性，而一些外部原因导致数据库发生故障，如硬盘损坏，那么所有提交的数据可能都会丢失。</p> </li></ul> 
<p><img src="https://images2.imgbox.com/83/4a/6sJsNay8_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3674"></a>基本操作</h4> 
<p>在默认情况下，用户执行的每一条SQL语句都会被当成单独的事务自动提交。如果要将一组SQL语句作为一个事务，则需要先执行以下语句显式地开启一个事务。</p> 
<pre><code class="prism language-sql"><span class="token keyword">START</span> <span class="token keyword">TRANSACTION</span><span class="token punctuation">;</span>
</code></pre> 
<p>上述语句执行后，每一条SQL语句不再自动提交，用户需要使用以下语句手动提交，只有事务提交后，其中的操作才会生效。</p> 
<pre><code class="prism language-sql"><span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
</code></pre> 
<p>如果不想提交当前事务，可以使用如下语句取消事务（即回滚）。</p> 
<pre><code class="prism language-sql"><span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span>
</code></pre> 
<p>需要注意的是，ROLLBACK 只能针对未提交的事务回滚，已提交的事务无法回滚。当执行COMMIT或ROLLBACK后，当前事务就会自动结束。</p> 
<p>MySQL中的事务不允许嵌套，若在执行 START TRANSACTION 语句前上一个事务还未提交，会隐式地执行提交操作。</p> 
<p>事务处理主要是针对数据表中数据的处理，不包括创建或删除数据库、数据表，修改表结构等操作，而且执行这类操作时会隐式地提交事务。</p> 
<p><img src="https://images2.imgbox.com/5b/c8/RcwSuVC2_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3702"></a>事务的自动提交</h4> 
<p>MySQL默认是自动提交模式，如果没有显式开启事务（START TRANSACTION），每一条SQL语句都会自动提交（COMMIT）。如果用户想要控制事务的自动提交方式，可以通过更改AUTOCOMMIT变量来实现，将其值设为1表示开启自动提交，设为0表示关闭自动提交。若要查看当前会话的AUTOCOMMIT值，使用如下语句。</p> 
<pre><code class="prism language-sql"> <span class="token keyword">SELECT</span>  @<span class="token variable">@autocommit</span><span class="token punctuation">;</span>
</code></pre> 
<p>若要关闭当前会话的事务自动提交，可以使用如下语句。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> AUTOCOMMIT <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/60/6f/K1jBt4tf_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3718"></a>事务的保存点</h4> 
<p>在回滚事务时，事务内所有的操作都将撤销。而若希望只撤销一部分，可以用保存点来实现。使用以下语句可以在事务中设置一个保存点。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SAVEPOINT</span> 保存点名<span class="token punctuation">;</span>
</code></pre> 
<p>在设置保存点后，使用以下语句可以将事务回滚到指定保存点。</p> 
<pre><code class="prism language-sql"><span class="token keyword">ROLLBACK</span> <span class="token keyword">TO</span> <span class="token keyword">SAVEPOINT</span> 保存点名<span class="token punctuation">;</span>
</code></pre> 
<p>使用时若不再需要一个保存点，可以使用如下语句删除保存点。</p> 
<pre><code class="prism language-sql"><span class="token keyword">RELEASE</span> <span class="token keyword">SAVEPOINT</span> 保存点名<span class="token punctuation">;</span>
</code></pre> 
<p>一个事务中可以创建多个保存点，在提交事务后，事务中的保存点就会被删除。另外，在回滚到某个保存点后，在该保存点之后创建过的保存点也会消失。</p> 
<p><img src="https://images2.imgbox.com/db/2d/AdoRVrUj_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3742"></a>控制事务结束后的行为</h4> 
<p>事务的提交（COMMIT）和回滚（ROLLBACK）还有一些可选子句，如下所示。</p> 
<pre><code class="prism language-sql"><span class="token keyword">COMMIT</span> <span class="token punctuation">[</span><span class="token operator">AND</span> <span class="token punctuation">[</span><span class="token keyword">NO</span><span class="token punctuation">]</span> <span class="token keyword">CHAIN</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">NO</span><span class="token punctuation">]</span> <span class="token keyword">RELEASE</span><span class="token punctuation">]</span>
<span class="token keyword">ROLLBACK</span> <span class="token punctuation">[</span><span class="token operator">AND</span> <span class="token punctuation">[</span><span class="token keyword">NO</span><span class="token punctuation">]</span> <span class="token keyword">CHAIN</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token keyword">NO</span><span class="token punctuation">]</span> <span class="token keyword">RELEASE</span><span class="token punctuation">]</span>

</code></pre> 
<p>AND CHAIN 用于在当前事务结束时，立即启动一个新事务，并且新事务与刚结束的事务有相同的隔离级；</p> 
<p>RELEASE用于在终止当前事务后，让服务器断开与客户端的连接。若添加NO，则表示抑制 CHAIN 和 RELEASE 完成。</p> 
<p><img src="https://images2.imgbox.com/8c/0a/KHSJezJC_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3758"></a>事务隔离级别</h4> 
<p>由于数据库是一个多用户的共享资源，MySQL允许多线程并发访问，因此用户可以通过不同的线程执行不同的事务。为了保证这些事务之间不受影响，对事务设置隔离级是十分必要的。</p> 
<p>🐬<strong>查看隔离级别</strong></p> 
<pre><code class="prism language-sql"><span class="token comment"># 查看全局隔离级</span>
<span class="token keyword">SELECT</span> <span class="token variable">@global.transaction_isolation</span><span class="token punctuation">;</span>
<span class="token comment"># 查看当前会话中的隔离级</span>
<span class="token keyword">SELECT</span> @<span class="token variable">@session.transaction_isolation</span><span class="token punctuation">;</span>
<span class="token comment"># 查看下一个事务的隔离级</span>
<span class="token keyword">SELECT</span> @<span class="token variable">@transaction_isolation</span><span class="token punctuation">;</span>
</code></pre> 
<p>在以上语句中，全局的隔离级影响的是所有连接MySQL的用户，而当前会话的隔离级别只影响当前正在登录MySQL服务器的用户，不会影响其他用户。而下一个事务的隔离级别仅对当前用户的下一个事务操作有影响。</p> 
<p>在默认情况下，上述3种方式返回的结果都是REPEATABLE-READ，表示隔离级别为可重复读。</p> 
<p>🐬<strong>修改隔离级别</strong></p> 
<p>在MySQL中，事务的隔离级别可以通过SET语句进行设置，具体语法如下。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> <span class="token punctuation">[</span><span class="token keyword">SESSION</span> <span class="token operator">|</span> <span class="token keyword">GLOBAL</span><span class="token punctuation">]</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> 参数值
</code></pre> 
<p>SET 后的 SESSION 表示当前会话，GLOBAL表示全局，若省略表示设置下一个事务的隔离级。</p> 
<p>TRANSACTION 表示事务，ISOLATION 表示隔离，LEVEL 表示级别。参数值可以是 <code>READ UNCOMMITTED</code>、<code>READ COMMITTED</code>、<code>REPEATABLE READ</code> 或 <code>SERIALIZABLE</code> 中的一种。</p> 
<p>🐬<strong>只读事务</strong></p> 
<p>默认情况下，事务的访问模式为 READ WRITE(读/写模式)，表示事务可以执行读(查询) 或写(更改、插入、删除等)操作。若开发需要，可以将事务的访问模式设置为 READ ONLY(只读模式)，禁止对表进行更改。</p> 
<pre><code class="prism language-sql"><span class="token comment"># 设置只读事务</span>
<span class="token keyword">SET</span> <span class="token punctuation">[</span><span class="token keyword">SESSION</span> <span class="token operator">|</span> <span class="token keyword">GLOBAL</span><span class="token punctuation">]</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">READ</span> ONLY
<span class="token comment"># 恢复成读写事务</span>
<span class="token keyword">SET</span> <span class="token punctuation">[</span><span class="token keyword">SESSION</span> <span class="token operator">|</span> <span class="token keyword">GLOBAL</span><span class="token punctuation">]</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">READ</span> <span class="token keyword">WRITE</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/3d/2c/IYfdF12b_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3804"></a>四种隔离级别</h4> 
<p>🐬<strong>读取未提交</strong></p> 
<p>READ UNCOMMITTED 是事务中最低的级别，在该级别下的事务可以读取到其他事务中未提交的数据，这种读取的方式也被称为脏读（Dirty Read）。简而言之，脏读是指一个事务读取了另外一个事务未提交的数据。</p> 
<p>例如，Alex 要给 Bill 转账100元购买商品，Alex开启事务后转账，但不提交事务，通知Bill来查询，如果Bill的隔离级别较低，就会读取到Alex的事务中未提交的数据，发现Alex确实给自己转了100元，就给Alex发货。等Bill发货成功后，Alex将事务回滚，Bill就会受到损失，这就是脏读造成的。</p> 
<p>🐬<strong>读取提交</strong></p> 
<p>READ COMMITTED 是大多数 DBMS (如 SQL Server、Oracle) 的默认隔离级，但不包括MySQL。</p> 
<p>在该隔离级下只能读取其他事务已经提交的数据，避免了脏读数据的现象。但是在该隔离级别下，会出现不可重复读（NON-REPEATABLE READ）的问题。</p> 
<p>不可重复读是指在一个事务中多次查询的结果不一致，原因是查询的过程中数据发生了改变。</p> 
<p>例如，在网站后台统计所有用户的总金额，第1次查询Alex有900元，为了验证查询结果，第2次查询Alex有800元，两次查询结果不同，原因是第2次查询前Alex取出了100元。</p> 
<p>🐬<strong>可重复读</strong></p> 
<p>REPEATABLE READ 是MySQL的默认事务隔离级，它解决了脏读和不可重复读的问题，确保了同一事务的多个实例在并发读取数据时，会看到同样的结果。但在理论上，该隔离级会出现幻读（PHANTOM READ)的现象。</p> 
<p>幻读又被称为虚读，是指在一个事务内两次查询中数据条数不一致，幻读和不可重复读有些类似，同样发生在两次查询过程中。不同的是，幻读是由于其他事务做了插入记录的操作，导致记录数有所增加。不过，MySQL的InnoDB存储引擎通过多版本并发控制机制解决了幻读的问题。</p> 
<p>例如，在网站后台统计所有用户的总金额时，当前只有两个用户，总金额为2000元，若在此时新增一个用户，并且存入1000元，再次统计时发现总金额变为3000元，造成了幻读的情况。</p> 
<p>🐬<strong>可串行化</strong></p> 
<p>SERIALIZABLE 是最高级别的隔离级，它在每个读的数据行上加锁，使之不会发生冲突，从而解决了脏读、不可重复读和幻读的问题。但是由于加锁可能导致超时（Timeout) 和 锁竞争（Lock Contention)现象，因此 SERIALIZABLE 也是性能最低的一种隔离级。除非为了数据的稳定性，需要强制减少并发的情况时，才会选择此种隔离级。</p> 
<p><img src="https://images2.imgbox.com/fe/30/DeJHZQH1_o.png" alt="在这里插入图片描述"></p> 
<p>数据库编程，引擎，索引，锁，分区等内容有时间在更新。。。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2295194b4300a33d76bdfc5ff7011405/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">『新星计划 • 数据结构与算法』数据结构学习指南以及在校招中的重要性</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/35ceab98b7b167a49f732980b8b32cc2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">2023最新pytorch安装（超详细版）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>