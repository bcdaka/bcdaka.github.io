<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Nginx&#43;KeepAlived高可用负载均衡集群的部署 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/05b04d911a0c1d6ab7ac8cac01b6e7fc/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Nginx&#43;KeepAlived高可用负载均衡集群的部署">
  <meta property="og:description" content="目录
一.KeepAlived补充知识
1.一个合格的群集应该具备的特点
2.健康检查（探针）常用的工作方式
3.相关面试问题
问题1
问题2
二.Keepealived脑裂现象
1.现象
2.原因
硬件原因
运用配置原因
3.解决
4.预防
方法1
方法2
方法3
方法4
三.实验部署
1.两台nginx做初始化操作并安装nginx
2.四层反向代理配置
2.1.修改主调度器配置
2.2.修改备调度器配置
2.3.浏览器测试两台nginx服务器
3.配置高可用
4.准备检查nginx运行状态脚本
4.1.主服务器
4.2.备服务器
5.开启keepalived服务并测试
5.1.分别开启主备两台服务器keepalived
5.2.浏览器测试
一.KeepAlived补充知识 1.一个合格的群集应该具备的特点 负载均衡 用于提高群集的性能 LVS Nginx HAProxy SLB F5健康检查（探针） 针对于调度器和节点服务器 Keepalived Heartbeat故障转移 通过VIP漂移实现主备切换 VRRP 脚本 2.健康检查（探针）常用的工作方式 发送心跳消息 vrrp报文 ping/pongTCP端口检查 向目标主机的 IP:PORT 发起TCP连接请求，如果TCP连接三次握手成功则认为健康检查正常，否则认为健康检查异常HTTP URL检查 向目标主机的URL路径（比如http://IP:PORT/URI路径）发起 HTTP GET 请求方法如果响应消息的状态码为 2XX 或 3XX，则认为健康检查正常如果响应消息的状态码为 4XX 或 5XX，则认为健康检查异常 3.相关面试问题 问题1 Keepalived通过什么判断哪台主机为主服务器,通过什么方式配置浮动IP
答案
Keepalived首先做初始化先检查state状态，master为主服务器，backup为备服务器然后再对比所有服务器的priority，谁的优先级高谁是最终的主服务优先级高的服务器会通过ip命令为自己的电脑配置一个提前定义好的浮动IP地址 问题2 keepalived的抢占与非抢占模式">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-12T23:18:44+08:00">
    <meta property="article:modified_time" content="2024-06-12T23:18:44+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Nginx&#43;KeepAlived高可用负载均衡集群的部署</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80.KeepAlived%E8%A1%A5%E5%85%85%E7%9F%A5%E8%AF%86-toc" style="margin-left:0px;"><a href="#%E4%B8%80.KeepAlived%E8%A1%A5%E5%85%85%E7%9F%A5%E8%AF%86" rel="nofollow">一.KeepAlived补充知识</a></p> 
<p id="1.%E4%B8%80%E4%B8%AA%E5%90%88%E6%A0%BC%E7%9A%84%E7%BE%A4%E9%9B%86%E5%BA%94%E8%AF%A5%E5%85%B7%E5%A4%87%E7%9A%84%E7%89%B9%E7%82%B9-toc" style="margin-left:40px;"><a href="#1.%E4%B8%80%E4%B8%AA%E5%90%88%E6%A0%BC%E7%9A%84%E7%BE%A4%E9%9B%86%E5%BA%94%E8%AF%A5%E5%85%B7%E5%A4%87%E7%9A%84%E7%89%B9%E7%82%B9" rel="nofollow">1.一个合格的群集应该具备的特点</a></p> 
<p id="2.%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%EF%BC%88%E6%8E%A2%E9%92%88%EF%BC%89%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F-toc" style="margin-left:40px;"><a href="#2.%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%EF%BC%88%E6%8E%A2%E9%92%88%EF%BC%89%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F" rel="nofollow">2.健康检查（探针）常用的工作方式</a></p> 
<p id="3.%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98-toc" style="margin-left:40px;"><a href="#3.%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98" rel="nofollow">3.相关面试问题</a></p> 
<p id="%E9%97%AE%E9%A2%981-toc" style="margin-left:80px;"><a href="#%E9%97%AE%E9%A2%981" rel="nofollow">问题1</a></p> 
<p id="%E9%97%AE%E9%A2%982-toc" style="margin-left:80px;"><a href="#%E9%97%AE%E9%A2%982" rel="nofollow">问题2</a></p> 
<p id="%E4%BA%8C.Keepealived%E8%84%91%E8%A3%82%E7%8E%B0%E8%B1%A1-toc" style="margin-left:0px;"><a href="#%E4%BA%8C.Keepealived%E8%84%91%E8%A3%82%E7%8E%B0%E8%B1%A1" rel="nofollow">二.Keepealived脑裂现象</a></p> 
<p id="1.%E7%8E%B0%E8%B1%A1-toc" style="margin-left:40px;"><a href="#1.%E7%8E%B0%E8%B1%A1" rel="nofollow">1.现象</a></p> 
<p id="2.%E5%8E%9F%E5%9B%A0-toc" style="margin-left:40px;"><a href="#2.%E5%8E%9F%E5%9B%A0" rel="nofollow">2.原因</a></p> 
<p id="%E7%A1%AC%E4%BB%B6%E5%8E%9F%E5%9B%A0-toc" style="margin-left:80px;"><a href="#%E7%A1%AC%E4%BB%B6%E5%8E%9F%E5%9B%A0" rel="nofollow">硬件原因</a></p> 
<p id="%E8%BF%90%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E5%9B%A0-toc" style="margin-left:80px;"><a href="#%E8%BF%90%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E5%9B%A0" rel="nofollow">运用配置原因</a></p> 
<p id="3.%E8%A7%A3%E5%86%B3-toc" style="margin-left:40px;"><a href="#3.%E8%A7%A3%E5%86%B3" rel="nofollow">3.解决</a></p> 
<p id="4.%E9%A2%84%E9%98%B2-toc" style="margin-left:40px;"><a href="#4.%E9%A2%84%E9%98%B2" rel="nofollow">4.预防</a></p> 
<p id="%E6%96%B9%E6%B3%951-toc" style="margin-left:80px;"><a href="#%E6%96%B9%E6%B3%951" rel="nofollow">方法1</a></p> 
<p id="%E6%96%B9%E6%B3%952-toc" style="margin-left:80px;"><a href="#%E6%96%B9%E6%B3%952" rel="nofollow">方法2</a></p> 
<p id="%E6%96%B9%E6%B3%953-toc" style="margin-left:80px;"><a href="#%E6%96%B9%E6%B3%953" rel="nofollow">方法3</a></p> 
<p id="%E6%96%B9%E6%B3%954-toc" style="margin-left:80px;"><a href="#%E6%96%B9%E6%B3%954" rel="nofollow">方法4</a></p> 
<p id="%E4%B8%89.%E5%AE%9E%E9%AA%8C%E9%83%A8%E7%BD%B2-toc" style="margin-left:0px;"><a href="#%E4%B8%89.%E5%AE%9E%E9%AA%8C%E9%83%A8%E7%BD%B2" rel="nofollow">三.实验部署</a></p> 
<p id="1.%E4%B8%A4%E5%8F%B0nginx%E5%81%9A%E5%88%9D%E5%A7%8B%E5%8C%96%E6%93%8D%E4%BD%9C%E5%B9%B6%E5%AE%89%E8%A3%85nginx-toc" style="margin-left:40px;"><a href="#1.%E4%B8%A4%E5%8F%B0nginx%E5%81%9A%E5%88%9D%E5%A7%8B%E5%8C%96%E6%93%8D%E4%BD%9C%E5%B9%B6%E5%AE%89%E8%A3%85nginx" rel="nofollow">1.两台nginx做初始化操作并安装nginx</a></p> 
<p id="2.%E5%9B%9B%E5%B1%82%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#2.%E5%9B%9B%E5%B1%82%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE" rel="nofollow">2.四层反向代理配置</a></p> 
<p id="2.1.%E4%BF%AE%E6%94%B9%E4%B8%BB%E8%B0%83%E5%BA%A6%E5%99%A8%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#2.1.%E4%BF%AE%E6%94%B9%E4%B8%BB%E8%B0%83%E5%BA%A6%E5%99%A8%E9%85%8D%E7%BD%AE" rel="nofollow">2.1.修改主调度器配置</a></p> 
<p id="2.2.%E4%BF%AE%E6%94%B9%E5%A4%87%E8%B0%83%E5%BA%A6%E5%99%A8%E9%85%8D%E7%BD%AE-toc" style="margin-left:80px;"><a href="#2.2.%E4%BF%AE%E6%94%B9%E5%A4%87%E8%B0%83%E5%BA%A6%E5%99%A8%E9%85%8D%E7%BD%AE" rel="nofollow">2.2.修改备调度器配置</a></p> 
<p id="2.3.%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B5%8B%E8%AF%95%E4%B8%A4%E5%8F%B0nginx%E6%9C%8D%E5%8A%A1%E5%99%A8-toc" style="margin-left:80px;"><a href="#2.3.%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B5%8B%E8%AF%95%E4%B8%A4%E5%8F%B0nginx%E6%9C%8D%E5%8A%A1%E5%99%A8" rel="nofollow">2.3.浏览器测试两台nginx服务器</a></p> 
<p id="3.%E9%85%8D%E7%BD%AE%E9%AB%98%E5%8F%AF%E7%94%A8-toc" style="margin-left:40px;"><a href="#3.%E9%85%8D%E7%BD%AE%E9%AB%98%E5%8F%AF%E7%94%A8" rel="nofollow">3.配置高可用</a></p> 
<p id="4.%E5%87%86%E5%A4%87%E6%A3%80%E6%9F%A5nginx%E8%BF%90%E8%A1%8C%E7%8A%B6%E6%80%81%E8%84%9A%E6%9C%AC-toc" style="margin-left:40px;"><a href="#4.%E5%87%86%E5%A4%87%E6%A3%80%E6%9F%A5nginx%E8%BF%90%E8%A1%8C%E7%8A%B6%E6%80%81%E8%84%9A%E6%9C%AC" rel="nofollow">4.准备检查nginx运行状态脚本</a></p> 
<p id="4.1.%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8-toc" style="margin-left:80px;"><a href="#4.1.%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8" rel="nofollow">4.1.主服务器</a></p> 
<p id="4.2.%E5%A4%87%E6%9C%8D%E5%8A%A1%E5%99%A8-toc" style="margin-left:80px;"><a href="#4.2.%E5%A4%87%E6%9C%8D%E5%8A%A1%E5%99%A8" rel="nofollow">4.2.备服务器</a></p> 
<p id="5.%E5%BC%80%E5%90%AFkeepalived%E6%9C%8D%E5%8A%A1%E5%B9%B6%E6%B5%8B%E8%AF%95-toc" style="margin-left:40px;"><a href="#5.%E5%BC%80%E5%90%AFkeepalived%E6%9C%8D%E5%8A%A1%E5%B9%B6%E6%B5%8B%E8%AF%95" rel="nofollow">5.开启keepalived服务并测试</a></p> 
<p id="5.1.%E5%88%86%E5%88%AB%E5%BC%80%E5%90%AF%E4%B8%BB%E5%A4%87%E4%B8%A4%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8keepalived-toc" style="margin-left:80px;"><a href="#5.1.%E5%88%86%E5%88%AB%E5%BC%80%E5%90%AF%E4%B8%BB%E5%A4%87%E4%B8%A4%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8keepalived" rel="nofollow">5.1.分别开启主备两台服务器keepalived</a></p> 
<p id="5.2.%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B5%8B%E8%AF%95-toc" style="margin-left:80px;"><a href="#5.2.%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B5%8B%E8%AF%95" rel="nofollow">5.2.浏览器测试</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 style="background-color:transparent;">一.KeepAlived补充知识</h2> 
<h3 id="1.%E4%B8%80%E4%B8%AA%E5%90%88%E6%A0%BC%E7%9A%84%E7%BE%A4%E9%9B%86%E5%BA%94%E8%AF%A5%E5%85%B7%E5%A4%87%E7%9A%84%E7%89%B9%E7%82%B9" style="background-color:transparent;">1.一个合格的群集应该具备的特点</h3> 
<ul><li>负载均衡          用于提高群集的性能   LVS  Nginx  HAProxy  SLB  F5</li><li>健康检查（探针）  针对于调度器和节点服务器    Keepalived   Heartbeat</li><li>故障转移          通过VIP漂移实现主备切换     VRRP   脚本</li></ul> 
<h3 id="2.%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5%EF%BC%88%E6%8E%A2%E9%92%88%EF%BC%89%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F" style="background-color:transparent;">2.健康检查（探针）常用的工作方式</h3> 
<ul><li>发送心跳消息    vrrp报文    ping/pong</li><li>TCP端口检查     向目标主机的 IP:PORT 发起TCP连接请求，如果TCP连接三次握手成功则认为健康检查正常，否则认为健康检查异常</li><li>HTTP URL检查    向目标主机的URL路径（比如http://IP:PORT/URI路径）发起 HTTP GET 请求方法</li><li>如果响应消息的状态码为 2XX 或 3XX，则认为健康检查正常</li><li>如果响应消息的状态码为 4XX 或 5XX，则认为健康检查异常</li></ul> 
<h3 id="3.%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98" style="background-color:transparent;"><span style="color:#fe2c24;">3.相关面试问题</span></h3> 
<h4 id="%E9%97%AE%E9%A2%981" style="background-color:transparent;">问题1</h4> 
<p><span style="color:#0d0016;"><strong>Keepalived通过什么判断哪台主机为主服务器,通过什么方式配置浮动IP</strong></span></p> 
<p><strong>答案</strong></p> 
<ol><li>Keepalived首先做初始化先检查state状态，master为主服务器，backup为备服务器</li><li>然后再对比所有服务器的priority，谁的优先级高谁是最终的主服务</li><li>优先级高的服务器会通过ip命令为自己的电脑配置一个提前定义好的浮动IP地址</li></ol> 
<h4 id="%E9%97%AE%E9%A2%982" style="background-color:transparent;">问题2</h4> 
<p><strong>keepalived的抢占与非抢占模式</strong></p> 
<p><strong>答案</strong></p> 
<ol><li>抢占模式即MASTER从故障中恢复后，会将VIP从BACKUP节点中抢占过来。非抢占模式即MASTER恢复后不抢占BACKUP升级为MASTER后的VIP</li><li>非抢占式俩节点state必须为bakcup，且必须配置nopreempt</li></ol> 
<p><span style="color:#fe2c24;">注意：这样配置后，我们要注意启动服务的顺序，优先启动的获取master权限，与优先级没有关系了</span></p> 
<h2 id="%E4%BA%8C.Keepealived%E8%84%91%E8%A3%82%E7%8E%B0%E8%B1%A1" style="background-color:transparent;">二.Keepealived脑裂现象</h2> 
<h3 id="1.%E7%8E%B0%E8%B1%A1" style="background-color:transparent;">1.现象</h3> 
<p><strong>主服务器和备服务器都同时拥有相同的VIP</strong></p> 
<p>在"双机热备"高可用（HA）系统中，当联系两个节点的"心跳线"断开时(即两个节点断开联系时)，</p> 
<p>本来为一个整体、动作协调的HA系统，就分裂成为两个独立的节点(即两个独立的个体)。由于相互</p> 
<p>失去了联系，都以为是对方出了故障，此时备用调度器会运转起来争做主调度器的工作，而主调度</p> 
<p>器依然保持着调度工作，两个调度的同时运转导致整个系统的紊乱。就会发生严重后果：</p> 
<ul><li>共享资源被瓜分、两边"服务"都起不来</li><li>或者两边"服务"都起来了，但同时读写"共享存储"，导致数据损坏（常见如数据库轮询着的联机日志出错）</li></ul> 
<h3 id="2.%E5%8E%9F%E5%9B%A0" style="background-color:transparent;">2.原因</h3> 
<p><strong>因为主服务器和备服务器的通信中断，导致备服务器无法收到主服务器发送的VRRP报文，备服务</strong></p> 
<p><strong>器误认为主服务器已经故障了并通过ip命令生成VIP</strong></p> 
<h4 id="%E7%A1%AC%E4%BB%B6%E5%8E%9F%E5%9B%A0" style="background-color:transparent;">硬件原因</h4> 
<ul><li>高可用服务器各节点之间心跳线链路发生故障，导致无法正常通信</li><li>因心跳线坏了（包括断了，老化）</li><li>因网卡及相关驱动坏了，ip配置及冲突问题（网卡直连）</li><li>因心跳线间连接的设备故障（网卡及交换机）</li><li>因仲裁的机器出问题（采用仲裁的方案）</li></ul> 
<h4 id="%E8%BF%90%E7%94%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E5%9B%A0" style="background-color:transparent;">运用配置原因</h4> 
<ul><li>高可用服务器上开启了iptables防火墙阻挡了心跳消息传输</li><li>高可用服务器上心跳网卡地址等信息配置不正确，导致发送心跳失败</li><li>其他服务配置不当等原因，如心跳方式不同，心跳广插冲突、软件Bug等</li><li>Keepalived配置里同一VRRP实例如果virtual_router_id两端参数配置不一致也会导致裂脑问题发生</li></ul> 
<h3 id="3.%E8%A7%A3%E5%86%B3">3.解决</h3> 
<p>关闭主服务器或备服务器其中一个的keepalived服务</p> 
<h3 id="4.%E9%A2%84%E9%98%B2" style="background-color:transparent;">4.预防</h3> 
<h4 id="%E6%96%B9%E6%B3%951">方法1</h4> 
<p>如果是系统防火墙导致，则关闭防火墙或添加防火墙规则放通VRRP组播地址(224.0.0.18)的传输</p> 
<h4 id="%E6%96%B9%E6%B3%952">方法2</h4> 
<p>如果是主备服务器之间的通信链路中断导致，则可以在主备服务器之间添加双链路通信</p> 
<h4 id="%E6%96%B9%E6%B3%953">方法3</h4> 
<p>在主服务器使用脚本定时判断与备服务器通信链路是否中断，如果判断是主备服务器之间的链接中</p> 
<p>断则自行关闭主服务器上的keepalived服务</p> 
<h4 id="%E6%96%B9%E6%B3%954">方法4</h4> 
<p>利用第三方应用或监控系统检测是否发生了脑裂故障现象，如果确认发生了脑裂故障则通过第三方</p> 
<p>应用或监控系统来关闭主服务器或备服务器其中一个的keepalived服务</p> 
<h2 id="%E4%B8%89.%E5%AE%9E%E9%AA%8C%E9%83%A8%E7%BD%B2" style="background-color:transparent;">三.实验部署</h2> 
<p><strong>此实验基于以上 LVS+KeepAlived高可用负载均衡群集的部署实验为基础，将两台调度器改为</strong></p> 
<p><strong>nginx服务器，其余不变</strong></p> 
<p><strong>准备虚拟机</strong></p> 
<p>192.168.80.104（nginx服务器四层代理）</p> 
<p>192.168.80.105（nginx服务器四层代理）</p> 
<p>192.168.80.106（web1）</p> 
<p>192.168.80.107（web2）</p> 
<p>192.168.80.108（nfs共享存储）</p> 
<h3 id="1.%E4%B8%A4%E5%8F%B0nginx%E5%81%9A%E5%88%9D%E5%A7%8B%E5%8C%96%E6%93%8D%E4%BD%9C%E5%B9%B6%E5%AE%89%E8%A3%85nginx">1.<strong>两台nginx做初始化操作并安装nginx</strong></h3> 
<p><strong><span style="color:#fe2c24;">nginx镜像网址：</span></strong><img alt="" height="83" src="https://images2.imgbox.com/7c/a5/2LGKyLaZ_o.png" width="480"></p> 
<p><img alt="" height="674" src="https://images2.imgbox.com/eb/bd/M7jLExJ0_o.png" width="1152"></p> 
<h3 id="2.%E5%9B%9B%E5%B1%82%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE" style="background-color:transparent;">2.四层反向代理配置</h3> 
<h4 id="2.1.%E4%BF%AE%E6%94%B9%E4%B8%BB%E8%B0%83%E5%BA%A6%E5%99%A8%E9%85%8D%E7%BD%AE" style="background-color:transparent;"><strong>2.1.修改主调度器配置</strong></h4> 
<pre><code class="hljs">stream {
    upstream backends {
         server 192.168.80.106:80;
         server 192.168.80.107:80;
     }
    server {
         listen 8080;
         proxy_pass backends;
    }
}</code></pre> 
<p><img alt="" height="817" src="https://images2.imgbox.com/aa/cb/P91eU3Pw_o.png" width="1200"></p> 
<h4 id="%E2%80%8B%E7%BC%96%E8%BE%91"><img alt="" height="178" src="https://images2.imgbox.com/0d/1a/FeKAj6AX_o.png" width="1200"></h4> 
<h4 id="2.2.%E4%BF%AE%E6%94%B9%E5%A4%87%E8%B0%83%E5%BA%A6%E5%99%A8%E9%85%8D%E7%BD%AE"><strong>2.2.修改备调度器配置</strong></h4> 
<p>将主调度器的nginx.conf复制过来</p> 
<p><img alt="" height="237" src="https://images2.imgbox.com/2b/9d/qgFPm15n_o.png" width="1148"></p> 
<h4><img alt="" height="79" src="https://images2.imgbox.com/fa/86/ryf8ZxBn_o.png" width="1200"></h4> 
<h4 id="2.3.%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B5%8B%E8%AF%95%E4%B8%A4%E5%8F%B0nginx%E6%9C%8D%E5%8A%A1%E5%99%A8"><strong>2.3.浏览器测试两台nginx服务器</strong></h4> 
<p><strong>192.168.80.104/192.168.80.105</strong></p> 
<p><img alt="" height="95" src="https://images2.imgbox.com/6c/08/9ITlVY5w_o.png" width="645"></p> 
<h3><img alt="" height="119" src="https://images2.imgbox.com/f6/fd/F7DZl9vF_o.png" width="716"></h3> 
<h3 id="3.%E9%85%8D%E7%BD%AE%E9%AB%98%E5%8F%AF%E7%94%A8"><strong>3.</strong>配置高可用</h3> 
<p><strong>两台nginx服务器安装keepalived</strong></p> 
<p><img alt="" height="633" src="https://images2.imgbox.com/a5/56/I7qb46XT_o.png" width="1062"></p> 
<h3 id="4.%E5%87%86%E5%A4%87%E6%A3%80%E6%9F%A5nginx%E8%BF%90%E8%A1%8C%E7%8A%B6%E6%80%81%E8%84%9A%E6%9C%AC">4.准备检查nginx运行状态脚本</h3> 
<h4 id="4.1.%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8">4.1.主服务器</h4> 
<pre><code class="hljs">#!/bin/bash
 
if ! killall -0 nginx &amp;&gt; /dev/null
   then
   systemctl stop keepalived
fi</code></pre> 
<h4><img alt="" height="407" src="https://images2.imgbox.com/25/44/wDj1GC0u_o.png" width="925"></h4> 
<p><img alt="" height="206" src="https://images2.imgbox.com/49/60/5igZIjyO_o.png" width="908"></p> 
<p><img alt="" height="614" src="https://images2.imgbox.com/f7/1f/DrtSs7QR_o.png" width="968"></p> 
<p><img alt="" height="519" src="https://images2.imgbox.com/31/d4/tmKyhTG6_o.png" width="601"></p> 
<h4 id="4.2.%E5%A4%87%E6%9C%8D%E5%8A%A1%E5%99%A8">4.2.备服务器</h4> 
<p><img alt="" height="250" src="https://images2.imgbox.com/ec/4d/Qp8UZq8b_o.png" width="1161"></p> 
<p>将主里的复制到备里</p> 
<p><img alt="" height="138" src="https://images2.imgbox.com/23/9d/UfWHfUbj_o.png" width="1173"></p> 
<p><img alt="" height="109" src="https://images2.imgbox.com/e3/8e/FLf6mYOM_o.png" width="941"></p> 
<p><img alt="" height="1004" src="https://images2.imgbox.com/4d/92/DhJ1Z35B_o.png" width="1200"></p> 
<h3 id="5.%E5%BC%80%E5%90%AFkeepalived%E6%9C%8D%E5%8A%A1%E5%B9%B6%E6%B5%8B%E8%AF%95">5.开启keepalived服务并测试</h3> 
<h4 id="5.1.%E5%88%86%E5%88%AB%E5%BC%80%E5%90%AF%E4%B8%BB%E5%A4%87%E4%B8%A4%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8keepalived">5.1.<strong>分别开启主备两台服务器keepalived</strong></h4> 
<p><img alt="" height="124" src="https://images2.imgbox.com/d9/14/jJ4lJBH2_o.png" width="1200"></p> 
<h4 id="5.2.%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B5%8B%E8%AF%95"><strong>5.2.浏览器测试</strong></h4> 
<p><img alt="" height="95" src="https://images2.imgbox.com/58/84/gwMyVx6C_o.png" width="679"></p> 
<p><img alt="" height="87" src="https://images2.imgbox.com/48/f9/HbFR0LAj_o.png" width="738"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f6febfbc47aff284d225bc5627e3d8e8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">计算机网络(5) ARP协议</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/777ee1e163e35c42337ba3f61b1f87e1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【2024年最新】Bilibili/B站视频/动态评论爬虫</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>