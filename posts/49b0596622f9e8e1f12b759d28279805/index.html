<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[深度学习] 生成对抗网络GAN - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/49b0596622f9e8e1f12b759d28279805/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="[深度学习] 生成对抗网络GAN">
  <meta property="og:description" content="生成对抗网络（Generative Adversarial Networks，GANs）是一种由 Ian Goodfellow 等人在2014年提出的深度学习模型Generative Adversarial Networks。GANs的基本思想是通过两个神经网络（生成器和判别器）的对抗过程，生成与真实数据分布相似的新数据。以下是对GANs的详细介绍。
1. 基本结构 GANs由两个主要组件构成：
1.1 生成器（Generator） 生成器的任务是从一个随机噪声（通常是高斯噪声）中生成逼真的数据样本。生成器是一个神经网络，它接受一个随机向量作为输入，并输出一个与真实数据分布相似的样本。目标是欺骗判别器，使其认为生成的数据是真实的。
1.2 判别器（Discriminator） 判别器是另一个神经网络，用于区分真实数据和生成器生成的假数据。它的输入是一个数据样本，输出是一个标量值，表示输入数据是真实的概率。判别器的目标是最大化区分真实数据和生成数据的准确性。
2. 工作原理 GANs通过生成器和判别器的对抗训练来实现目标。训练过程中，两者的目标是相反的：
生成器试图最大限度地欺骗判别器，使其无法区分生成数据和真实数据。判别器则尽量提高区分真实数据和生成数据的能力。 这种对抗训练可以形式化为一个极小极大（minimax）问题：
其中，D(x) 是判别器对真实数据 x 的输出， G(z) 是生成器对随机噪声 z 的输出。
3. 训练过程 初始化：随机初始化生成器和判别器的参数。训练判别器：在固定生成器的情况下，用一批真实数据和生成数据训练判别器，更新判别器的参数。训练生成器：在固定判别器的情况下，用生成器生成的假数据训练生成器，更新生成器的参数。循环：重复上述步骤，直到生成器生成的数据足够逼真。 下面是一个使用TensorFlow和Keras实现简单生成对抗网络（GAN）的示例代码。该代码使用MNIST手写数字数据集来训练生成器生成类似手写数字的图像。
import tensorflow as tf from tensorflow.keras import layers, models import numpy as np import matplotlib.pyplot as plt # 加载MNIST数据集 (train_images, _), (_, _) = tf.keras.datasets.mnist.load_data() train_images = train_images.reshape(train_images.shape[0], 28, 28, 1).astype(&#39;float32&#39;) train_images = (train_images - 127.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-26T12:01:45+08:00">
    <meta property="article:modified_time" content="2024-06-26T12:01:45+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[深度学习] 生成对抗网络GAN</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>生成对抗网络（Generative Adversarial Networks，GANs）是一种由 Ian Goodfellow 等人在2014年提出的深度学习模型<a href="https://arxiv.org/abs/1406.2661" rel="nofollow">Generative Adversarial Networks</a>。GANs的基本思想是通过两个神经网络（生成器和判别器）的对抗过程，生成与真实数据分布相似的新数据。以下是对GANs的详细介绍。</p> 
<h4><a id="1__2"></a>1. 基本结构</h4> 
<p>GANs由两个主要组件构成：</p> 
<h5><a id="11_Generator_5"></a>1.1 生成器（Generator）</h5> 
<p>生成器的任务是从一个随机噪声（通常是高斯噪声）中生成逼真的数据样本。生成器是一个神经网络，它接受一个随机向量作为输入，并输出一个与真实数据分布相似的样本。目标是欺骗判别器，使其认为生成的数据是真实的。</p> 
<h5><a id="12_Discriminator_8"></a>1.2 判别器（Discriminator）</h5> 
<p>判别器是另一个神经网络，用于区分真实数据和生成器生成的假数据。它的输入是一个数据样本，输出是一个标量值，表示输入数据是真实的概率。判别器的目标是最大化区分真实数据和生成数据的准确性。</p> 
<h4><a id="2__11"></a>2. 工作原理</h4> 
<p>GANs通过生成器和判别器的对抗训练来实现目标。训练过程中，两者的目标是相反的：</p> 
<ul><li>生成器试图最大限度地欺骗判别器，使其无法区分生成数据和真实数据。</li><li>判别器则尽量提高区分真实数据和生成数据的能力。</li></ul> 
<p>这种对抗训练可以形式化为一个极小极大（minimax）问题：</p> 
<p><img src="https://images2.imgbox.com/a6/7f/8HZkSbos_o.png" alt="在这里插入图片描述"><br> 其中，D(x) 是判别器对真实数据 x 的输出， G(z) 是生成器对随机噪声 z 的输出。</p> 
<h4><a id="3__22"></a>3. 训练过程</h4> 
<ol><li><strong>初始化</strong>：随机初始化生成器和判别器的参数。</li><li><strong>训练判别器</strong>：在固定生成器的情况下，用一批真实数据和生成数据训练判别器，更新判别器的参数。</li><li><strong>训练生成器</strong>：在固定判别器的情况下，用生成器生成的假数据训练生成器，更新生成器的参数。</li><li><strong>循环</strong>：重复上述步骤，直到生成器生成的数据足够逼真。</li></ol> 
<p>下面是一个使用TensorFlow和Keras实现简单生成对抗网络（GAN）的示例代码。该代码使用MNIST手写数字数据集来训练生成器生成类似手写数字的图像。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras <span class="token keyword">import</span> layers<span class="token punctuation">,</span> models
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

<span class="token comment"># 加载MNIST数据集</span>
<span class="token punctuation">(</span>train_images<span class="token punctuation">,</span> _<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>mnist<span class="token punctuation">.</span>load_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
train_images <span class="token operator">=</span> train_images<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>train_images<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
train_images <span class="token operator">=</span> <span class="token punctuation">(</span>train_images <span class="token operator">-</span> <span class="token number">127.5</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">127.5</span>  <span class="token comment"># 将图像标准化到 [-1, 1] 区间</span>
BUFFER_SIZE <span class="token operator">=</span> <span class="token number">60000</span>
BATCH_SIZE <span class="token operator">=</span> <span class="token number">256</span>

<span class="token comment"># 创建数据集</span>
train_dataset <span class="token operator">=</span> tf<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">.</span>from_tensor_slices<span class="token punctuation">(</span>train_images<span class="token punctuation">)</span><span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">.</span>batch<span class="token punctuation">(</span>BATCH_SIZE<span class="token punctuation">)</span>

<span class="token comment"># 生成器模型</span>
<span class="token keyword">def</span> <span class="token function">make_generator_model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> models<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">256</span><span class="token punctuation">,</span> use_bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> input_shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>BatchNormalization<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>LeakyReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>Reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> model<span class="token punctuation">.</span>output_shape <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span>  <span class="token comment"># 注意：None 是批量大小</span>

    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>Conv2DTranspose<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span> use_bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> model<span class="token punctuation">.</span>output_shape <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>BatchNormalization<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>LeakyReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>Conv2DTranspose<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span> use_bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> model<span class="token punctuation">.</span>output_shape <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>BatchNormalization<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>LeakyReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>Conv2DTranspose<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span> use_bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'tanh'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> model<span class="token punctuation">.</span>output_shape <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> model

<span class="token comment"># 判别器模型</span>
<span class="token keyword">def</span> <span class="token function">make_discriminator_model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> models<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>Conv2D<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span> input_shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>LeakyReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>Conv2D<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> strides<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>LeakyReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> model

<span class="token comment"># 定义损失函数和优化器</span>
cross_entropy <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>losses<span class="token punctuation">.</span>BinaryCrossentropy<span class="token punctuation">(</span>from_logits<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">discriminator_loss</span><span class="token punctuation">(</span>real_output<span class="token punctuation">,</span> fake_output<span class="token punctuation">)</span><span class="token punctuation">:</span>
    real_loss <span class="token operator">=</span> cross_entropy<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>real_output<span class="token punctuation">)</span><span class="token punctuation">,</span> real_output<span class="token punctuation">)</span>
    fake_loss <span class="token operator">=</span> cross_entropy<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>fake_output<span class="token punctuation">)</span><span class="token punctuation">,</span> fake_output<span class="token punctuation">)</span>
    total_loss <span class="token operator">=</span> real_loss <span class="token operator">+</span> fake_loss
    <span class="token keyword">return</span> total_loss

<span class="token keyword">def</span> <span class="token function">generator_loss</span><span class="token punctuation">(</span>fake_output<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> cross_entropy<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>fake_output<span class="token punctuation">)</span><span class="token punctuation">,</span> fake_output<span class="token punctuation">)</span>

generator <span class="token operator">=</span> make_generator_model<span class="token punctuation">(</span><span class="token punctuation">)</span>
discriminator <span class="token operator">=</span> make_discriminator_model<span class="token punctuation">(</span><span class="token punctuation">)</span>

generator_optimizer <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>optimizers<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span><span class="token number">1e-4</span><span class="token punctuation">)</span>
discriminator_optimizer <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>optimizers<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span><span class="token number">1e-4</span><span class="token punctuation">)</span>

<span class="token comment"># 训练步骤</span>
<span class="token decorator annotation punctuation">@tf<span class="token punctuation">.</span>function</span>
<span class="token keyword">def</span> <span class="token function">train_step</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token punctuation">:</span>
    noise <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span>BATCH_SIZE<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">with</span> tf<span class="token punctuation">.</span>GradientTape<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> gen_tape<span class="token punctuation">,</span> tf<span class="token punctuation">.</span>GradientTape<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> disc_tape<span class="token punctuation">:</span>
        generated_images <span class="token operator">=</span> generator<span class="token punctuation">(</span>noise<span class="token punctuation">,</span> training<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

        real_output <span class="token operator">=</span> discriminator<span class="token punctuation">(</span>images<span class="token punctuation">,</span> training<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        fake_output <span class="token operator">=</span> discriminator<span class="token punctuation">(</span>generated_images<span class="token punctuation">,</span> training<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

        gen_loss <span class="token operator">=</span> generator_loss<span class="token punctuation">(</span>fake_output<span class="token punctuation">)</span>
        disc_loss <span class="token operator">=</span> discriminator_loss<span class="token punctuation">(</span>real_output<span class="token punctuation">,</span> fake_output<span class="token punctuation">)</span>

    gradients_of_generator <span class="token operator">=</span> gen_tape<span class="token punctuation">.</span>gradient<span class="token punctuation">(</span>gen_loss<span class="token punctuation">,</span> generator<span class="token punctuation">.</span>trainable_variables<span class="token punctuation">)</span>
    gradients_of_discriminator <span class="token operator">=</span> disc_tape<span class="token punctuation">.</span>gradient<span class="token punctuation">(</span>disc_loss<span class="token punctuation">,</span> discriminator<span class="token punctuation">.</span>trainable_variables<span class="token punctuation">)</span>

    generator_optimizer<span class="token punctuation">.</span>apply_gradients<span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>gradients_of_generator<span class="token punctuation">,</span> generator<span class="token punctuation">.</span>trainable_variables<span class="token punctuation">)</span><span class="token punctuation">)</span>
    discriminator_optimizer<span class="token punctuation">.</span>apply_gradients<span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>gradients_of_discriminator<span class="token punctuation">,</span> discriminator<span class="token punctuation">.</span>trainable_variables<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 训练过程</span>
<span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>epochs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> image_batch <span class="token keyword">in</span> dataset<span class="token punctuation">:</span>
            train_step<span class="token punctuation">(</span>image_batch<span class="token punctuation">)</span>

        <span class="token comment"># 每个epoch结束时生成并保存一些图像</span>
        generate_and_save_images<span class="token punctuation">(</span>generator<span class="token punctuation">,</span> epoch <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> seed<span class="token punctuation">)</span>

    <span class="token comment"># 最后一个epoch生成图像</span>
    generate_and_save_images<span class="token punctuation">(</span>generator<span class="token punctuation">,</span> epochs<span class="token punctuation">,</span> seed<span class="token punctuation">)</span>

<span class="token comment"># 生成并保存图像的辅助函数</span>
<span class="token keyword">def</span> <span class="token function">generate_and_save_images</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> epoch<span class="token punctuation">,</span> test_input<span class="token punctuation">)</span><span class="token punctuation">:</span>
    predictions <span class="token operator">=</span> model<span class="token punctuation">(</span>test_input<span class="token punctuation">,</span> training<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>predictions<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>predictions<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">127.5</span> <span class="token operator">+</span> <span class="token number">127.5</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">)</span>
        plt<span class="token punctuation">.</span>axis<span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>

    plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'image_at_epoch_{:04d}.png'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>epoch<span class="token punctuation">)</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 训练模型</span>
EPOCHS <span class="token operator">=</span> <span class="token number">50</span>
noise_dim <span class="token operator">=</span> <span class="token number">100</span>
num_examples_to_generate <span class="token operator">=</span> <span class="token number">16</span>

seed <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>normal<span class="token punctuation">(</span><span class="token punctuation">[</span>num_examples_to_generate<span class="token punctuation">,</span> noise_dim<span class="token punctuation">]</span><span class="token punctuation">)</span>

train<span class="token punctuation">(</span>train_dataset<span class="token punctuation">,</span> EPOCHS<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_160"></a>说明</h5> 
<ol><li><strong>数据预处理</strong>: 加载MNIST数据集并进行归一化处理。</li><li><strong>模型构建</strong>: 
  <ul><li><strong>生成器</strong>: 从随机噪声生成图像。</li><li><strong>判别器</strong>: 区分真实图像和生成图像。</li></ul> </li><li><strong>损失函数</strong>: 使用二元交叉熵损失函数。</li><li><strong>优化器</strong>: 使用Adam优化器。</li><li><strong>训练过程</strong>: 每个训练步骤包含生成图像、判别图像，并计算和应用梯度更新。</li><li><strong>结果可视化</strong>: 在训练过程中生成并保存图像。</li></ol> 
<p>运行上述代码后，会看到生成的手写数字图像，这些图像与真实的MNIST数据集中的手写数字非常相似。</p> 
<h4><a id="4__172"></a>4. 常见问题与改进</h4> 
<p>生成对抗网络（GANs）虽然在许多领域取得了显著成果，但也存在一些显著的缺点和挑战。这些缺点主要源于其对抗训练的复杂性和网络设计的固有特性。</p> 
<h5><a id="1__174"></a>1. 训练不稳定</h5> 
<p><strong>原因</strong>: GANs的训练是一个极小极大（minimax）优化问题，生成器和判别器的目标是相反的，这导致了训练过程的不稳定性。</p> 
<ul><li><strong>对抗失衡</strong>: 如果判别器太强，它会很容易区分生成的数据和真实数据，使生成器无法学习。如果生成器太强，它会欺骗判别器，使其失去鉴别能力。</li><li><strong>梯度消失或爆炸</strong>: 在训练过程中，梯度可能会消失或爆炸，尤其是在深层网络中，这使得训练过程更加困难。</li></ul> 
<h5><a id="2_Mode_Collapse_179"></a>2. 模式崩溃（Mode Collapse）</h5> 
<p><strong>原因</strong>: 生成器可能会找到一些特定模式的生成样本，这些样本能很好地欺骗判别器，但缺乏多样性。</p> 
<ul><li><strong>单一输出</strong>: 生成器可能会倾向于生成几种特定的输出模式，而忽略其他可能的输出，导致生成样本缺乏多样性。</li><li><strong>判别器反馈不足</strong>: 如果判别器未能有效反馈生成样本的多样性问题，生成器将持续生成相同或相似的样本。</li></ul> 
<p>这些缺点和挑战使得GANs在实际应用中需要进行细致的调整和改进，但也促使研究者不断提出新的方法和变体，以改善GANs的性能和稳定性：</p> 
<h5><a id="1_GANConditional_GANscGANs_187"></a>1 条件GAN（Conditional GANs，cGANs）</h5> 
<p>通过在生成器和判别器中加入条件变量，使得生成的样本能够受控于特定的条件。例如，可以生成特定类别的图像。</p> 
<h5><a id="2_Wasserstein_GANsWGANs_190"></a>2 Wasserstein GANs（WGANs）</h5> 
<p>通过使用Wasserstein距离替代原始GAN中的Jensen-Shannon散度，解决了训练不稳定的问题，使得训练过程更加平滑。</p> 
<h5><a id="3_GANDeep_Convolutional_GANsDCGANs_193"></a>3 深度卷积GAN（Deep Convolutional GANs，DCGANs）</h5> 
<p>利用卷积神经网络（CNN）来构建生成器和判别器，提高了生成图像的质量。</p> 
<h4><a id="5__196"></a>5. 应用场景</h4> 
<p>GANs在许多领域都有广泛的应用，包括但不限于：</p> 
<ul><li><strong>图像生成</strong>：生成高质量的图像，例如人脸、风景等。</li><li><strong>图像修复</strong>：修复受损图像或填补缺失部分。</li><li><strong>图像超分辨率</strong>：提高低分辨率图像的分辨率。</li><li><strong>数据增强</strong>：在数据不足的情况下生成更多训练样本。</li><li><strong>视频生成</strong>：生成逼真的视频序列。</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/526bff6371cffa13156496e6e330c1e9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Docker三分钟部署ElasticSearch平替MeiliSearch轻量级搜索引擎</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/093acce6b426d0102ee5248ec348b5e7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【从0实现React18】 (四) 如何触发更新 带你了解react触发更新的流程以及更新后如何触发render</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>