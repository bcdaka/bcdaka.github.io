<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kafka中的Topic - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/7a8e7e0fc32280df945e17b4517c518b/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Kafka中的Topic">
  <meta property="og:description" content="在Kafka中，Topic是消息的逻辑容器，用于组织和分类消息。本文将深入探讨Kafka Topic的各个方面，包括创建、配置、生产者和消费者，以及一些实际应用中的示例代码。
1. 介绍 在Kafka中，Topic是消息的逻辑通道，生产者将消息发布到Topic，而消费者从Topic订阅消息。每个Topic可以有多个分区（Partitions），每个分区可以在不同的服务器上，以实现横向扩展。
2. 创建和配置Topic 2.1 创建Topic 使用Kafka提供的命令行工具（kafka-topics.sh）或Kafka的API来创建Topic。下面是一个使用命令行工具创建Topic的示例：
bin/kafka-topics.sh --create --topic my_topic --partitions 3 --replication-factor 2 --bootstrap-server localhost:9092 这将创建一个名为my_topic的Topic，有3个分区，复制因子为2。
2.2 配置Topic Kafka的Topic有各种配置选项，可以通过修改Topic的属性来满足不同的需求。例如，可以设置消息保留时间、清理策略等。以下是一个配置Topic属性的示例：
bin/kafka-configs.sh --zookeeper localhost:2181 --entity-type topics --entity-name my_topic --alter --add-config max.message.bytes=1048576 这将修改my_topic的配置，将最大消息字节数设置为1 MB。
3. 生产者和消费者 3.1 生产者 生产者负责将消息发布到Topic。使用Kafka的Producer API，可以轻松地创建一个生产者。以下是一个简单的Java示例代码：
Properties properties = new Properties(); properties.put(&#34;bootstrap.servers&#34;, &#34;localhost:9092&#34;); properties.put(&#34;key.serializer&#34;, &#34;org.apache.kafka.common.serialization.StringSerializer&#34;); properties.put(&#34;value.serializer&#34;, &#34;org.apache.kafka.common.serialization.StringSerializer&#34;); Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(properties); producer.send(new ProducerRecord&lt;&gt;(&#34;my_topic&#34;, &#34;key1&#34;, &#34;value1&#34;)); producer.close(); 3.2 消费者 消费者从Topic中读取消息。Kafka的Consumer API提供了强大而灵活的方式来实现消费者。
以下是一个简单的Java示例代码：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-05T08:17:34+08:00">
    <meta property="article:modified_time" content="2023-12-05T08:17:34+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Kafka中的Topic</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/73/01/Xn5Cnjl2_o.png" alt=""></p> 
<p>在Kafka中，Topic是消息的逻辑容器，用于组织和分类消息。本文将深入探讨Kafka Topic的各个方面，包括创建、配置、生产者和消费者，以及一些实际应用中的示例代码。</p> 
<h3><a id="1__4"></a>1. 介绍</h3> 
<p>在Kafka中，Topic是消息的逻辑通道，生产者将消息发布到Topic，而消费者从Topic订阅消息。每个Topic可以有多个分区（Partitions），每个分区可以在不同的服务器上，以实现横向扩展。</p> 
<h3><a id="2_Topic_8"></a>2. 创建和配置Topic</h3> 
<h4><a id="21_Topic_10"></a>2.1 创建Topic</h4> 
<p>使用Kafka提供的命令行工具（kafka-topics.sh）或Kafka的API来创建Topic。下面是一个使用命令行工具创建Topic的示例：</p> 
<pre><code class="prism language-bash">bin/kafka-topics.sh <span class="token parameter variable">--create</span> <span class="token parameter variable">--topic</span> my_topic <span class="token parameter variable">--partitions</span> <span class="token number">3</span> --replication-factor <span class="token number">2</span> --bootstrap-server localhost:9092
</code></pre> 
<p>这将创建一个名为<code>my_topic</code>的Topic，有3个分区，复制因子为2。</p> 
<h4><a id="22_Topic_20"></a>2.2 配置Topic</h4> 
<p>Kafka的Topic有各种配置选项，可以通过修改Topic的属性来满足不同的需求。例如，可以设置消息保留时间、清理策略等。以下是一个配置Topic属性的示例：</p> 
<pre><code class="prism language-bash">bin/kafka-configs.sh <span class="token parameter variable">--zookeeper</span> localhost:2181 --entity-type topics --entity-name my_topic <span class="token parameter variable">--alter</span> --add-config <span class="token assign-left variable">max.message.bytes</span><span class="token operator">=</span><span class="token number">1048576</span>
</code></pre> 
<p>这将修改<code>my_topic</code>的配置，将最大消息字节数设置为1 MB。</p> 
<h3><a id="3__30"></a>3. 生产者和消费者</h3> 
<h4><a id="31__32"></a>3.1 生产者</h4> 
<p>生产者负责将消息发布到Topic。使用Kafka的Producer API，可以轻松地创建一个生产者。以下是一个简单的Java示例代码：</p> 
<pre><code class="prism language-java"><span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"bootstrap.servers"</span><span class="token punctuation">,</span> <span class="token string">"localhost:9092"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key.serializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringSerializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"value.serializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringSerializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Producer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>

producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">"my_topic"</span><span class="token punctuation">,</span> <span class="token string">"key1"</span><span class="token punctuation">,</span> <span class="token string">"value1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
producer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="32__48"></a>3.2 消费者</h4> 
<p>消费者从Topic中读取消息。Kafka的Consumer API提供了强大而灵活的方式来实现消费者。</p> 
<p>以下是一个简单的Java示例代码：</p> 
<pre><code class="prism language-java"><span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"bootstrap.servers"</span><span class="token punctuation">,</span> <span class="token string">"localhost:9092"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"group.id"</span><span class="token punctuation">,</span> <span class="token string">"my_group"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key.deserializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringDeserializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"value.deserializer"</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringDeserializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token string">"my_topic"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ConsumerRecords</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ConsumerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> record <span class="token operator">:</span> records<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Offset = %d, Key = %s, Value = %s%n"</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4__72"></a>4. 实际应用示例</h3> 
<h4><a id="41__74"></a>4.1 实时日志处理</h4> 
<p>在实时日志处理的场景中，Kafka的Topic可以按照日志类型进行划分，每个Topic代表一种日志类型。这样的设计可以使得系统更具可维护性、可扩展性，并且允许不同类型的日志通过独立的消费者进行处理。以下是一个更详细的示例代码，展示如何在实时日志处理中使用Kafka Topic：</p> 
<h5><a id="411_Topic_78"></a>4.1.1 创建日志类型Topic</h5> 
<p>首先，为不同的日志类型创建各自的Topic。以错误日志和访问日志为例：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 创建错误日志Topic</span>
bin/kafka-topics.sh <span class="token parameter variable">--create</span> <span class="token parameter variable">--topic</span> error_logs <span class="token parameter variable">--partitions</span> <span class="token number">3</span> --replication-factor <span class="token number">2</span> --bootstrap-server localhost:9092

<span class="token comment"># 创建访问日志Topic</span>
bin/kafka-topics.sh <span class="token parameter variable">--create</span> <span class="token parameter variable">--topic</span> access_logs <span class="token parameter variable">--partitions</span> <span class="token number">3</span> --replication-factor <span class="token number">2</span> --bootstrap-server localhost:9092
</code></pre> 
<h5><a id="412__90"></a>4.1.2 生产者发布日志消息</h5> 
<p>在应用中，生成错误日志和访问日志的代码可能如下：</p> 
<pre><code class="prism language-java"><span class="token comment">// 错误日志生产者</span>
<span class="token class-name">Producer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> errorLogProducer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>errorLogProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
errorLogProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">"error_logs"</span><span class="token punctuation">,</span> <span class="token string">"Error message"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 访问日志生产者</span>
<span class="token class-name">Producer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> accessLogProducer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>accessLogProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
accessLogProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">"access_logs"</span><span class="token punctuation">,</span> <span class="token string">"Access log message"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="413__104"></a>4.1.3 消费者实时处理日志</h5> 
<p>创建独立的消费者来处理错误日志和访问日志：</p> 
<pre><code class="prism language-java"><span class="token comment">// 错误日志消费者</span>
<span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> errorLogConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>errorLogProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
errorLogConsumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token string">"error_logs"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ConsumerRecords</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> errorLogConsumer<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ConsumerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> record <span class="token operator">:</span> records<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理错误日志</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Error Log - Offset = %d, Value = %s%n"</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 访问日志消费者</span>
<span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> accessLogConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>accessLogProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
accessLogConsumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token string">"access_logs"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ConsumerRecords</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> accessLogConsumer<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ConsumerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> record <span class="token operator">:</span> records<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理访问日志</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Access Log - Offset = %d, Value = %s%n"</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="414__134"></a>4.1.4 实时监控和分析</h5> 
<p>消费者可以通过实时处理日志来进行监控和分析。例如，可以使用流处理框架（如Kafka Streams）对日志进行聚合、过滤或转换。以下是一个简化的示例：</p> 
<pre><code class="prism language-java"><span class="token class-name">KStreamBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KStreamBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">KStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> errorLogsStream <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token string">"error_logs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">KStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> accessLogsStream <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token string">"access_logs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在这里进行实时处理，如聚合、过滤等</span>

<span class="token comment">// 通过输出Topic将处理结果发送到下游系统</span>
errorLogsStream<span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token string">"processed_error_logs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
accessLogsStream<span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token string">"processed_access_logs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">KafkaStreams</span> streams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaStreams</span><span class="token punctuation">(</span>builder<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
streams<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>通过这种设计，可以根据实际需要扩展不同类型的日志处理，同时确保系统具有高度的灵活性和可扩展性。在实际应用中，可能需要更详细的配置和处理逻辑，以满足具体的监控和分析需求。</p> 
<h4><a id="42__155"></a>4.2 事件溯源</h4> 
<p>在事件驱动的架构中，事件溯源是一种强大的方式，通过创建一个专门的Kafka Topic来记录每个业务事件的发生，以便随时追踪和回溯整个系统的状态。以下是一个基于Kafka的事件溯源的详细示例代码：</p> 
<h5><a id="421_Topic_159"></a>4.2.1 创建事件Topic</h5> 
<p>首先，为每个关键的业务事件创建一个专用的Kafka Topic，例如<code>order_created</code>、<code>order_shipped</code>等：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 创建订单创建事件Topic</span>
bin/kafka-topics.sh <span class="token parameter variable">--create</span> <span class="token parameter variable">--topic</span> order_created <span class="token parameter variable">--partitions</span> <span class="token number">3</span> --replication-factor <span class="token number">2</span> --bootstrap-server localhost:9092

<span class="token comment"># 创建订单发货事件Topic</span>
bin/kafka-topics.sh <span class="token parameter variable">--create</span> <span class="token parameter variable">--topic</span> order_shipped <span class="token parameter variable">--partitions</span> <span class="token number">3</span> --replication-factor <span class="token number">2</span> --bootstrap-server localhost:9092
</code></pre> 
<h5><a id="422__171"></a>4.2.2 发布业务事件</h5> 
<p>在应用中，当业务事件发生时，将事件发布到相应的Topic。以下是一个订单创建事件和订单发货事件的示例：</p> 
<pre><code class="prism language-java"><span class="token comment">// 订单创建事件生产者</span>
<span class="token class-name">Producer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> orderCreatedProducer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>orderCreatedProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
orderCreatedProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">"order_created"</span><span class="token punctuation">,</span> <span class="token string">"order_id"</span><span class="token punctuation">,</span> <span class="token string">"Order created - Order ID: 123"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 订单发货事件生产者</span>
<span class="token class-name">Producer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> orderShippedProducer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>orderShippedProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
orderShippedProducer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">"order_shipped"</span><span class="token punctuation">,</span> <span class="token string">"order_id"</span><span class="token punctuation">,</span> <span class="token string">"Order shipped - Order ID: 123"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="423__185"></a>4.2.3 事件溯源消费者</h5> 
<p>为了实现事件溯源，我们需要一个专用的消费者来订阅所有的事件Topic，并将事件记录到一个持久化存储中（如数据库、日志文件等）：</p> 
<pre><code class="prism language-java"><span class="token comment">// 事件溯源消费者</span>
<span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> eventTraceConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>eventTraceProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
eventTraceConsumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"order_created"</span><span class="token punctuation">,</span> <span class="token string">"order_shipped"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ConsumerRecords</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> eventTraceConsumer<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ConsumerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> record <span class="token operator">:</span> records<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 处理事件，可以将事件记录到数据库或日志文件中</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Event Trace - Offset = %d, Key = %s, Value = %s%n"</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 持久化处理逻辑</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="424__204"></a>4.2.4 事件回溯和分析</h5> 
<p>通过上述设置，可以在任何时候回溯系统中的每个事件，了解事件的发生时间、顺序和内容。通过将事件存储到持久化存储中，可以建立一个事件溯源系统，支持系统状态的分析、回滚和审计。</p> 
<p>还可以使用流处理来实时分析事件，例如计算每个订单的处理时间、统计每个事件类型的发生频率等。以下是一个简单的流处理示例：</p> 
<pre><code class="prism language-java"><span class="token class-name">KStreamBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KStreamBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">KStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> eventStream <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"order_created"</span><span class="token punctuation">,</span> <span class="token string">"order_shipped"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在这里进行实时处理，如计算处理时间、统计频率等</span>

<span class="token comment">// 通过输出Topic将处理结果发送到下游系统</span>
eventStream<span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span><span class="token string">"processed_events"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">KafkaStreams</span> streams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaStreams</span><span class="token punctuation">(</span>builder<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
streams<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>通过这种方式，可以在事件溯源系统中实现强大的监控、分析和管理功能，提高系统的可观察性和可维护性。</p> 
<h3><a id="5__225"></a>5. 消息处理语义</h3> 
<p>Kafka支持不同的消息处理语义，包括最多一次、最少一次和正好一次。这些语义由消费者的配置决定，可以根据应用的要求进行选择。以下是一个使用最多一次语义的消费者示例代码：</p> 
<pre><code class="prism language-java">properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"enable.auto.commit"</span><span class="token punctuation">,</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 禁用自动提交偏移量</span>
properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"auto.offset.reset"</span><span class="token punctuation">,</span> <span class="token string">"earliest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置偏移量重置策略为最早</span>

<span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token string">"my_topic"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ConsumerRecords</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> records <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMillis</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ConsumerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> record <span class="token operator">:</span> records<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 处理消息</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Offset = %d, Key = %s, Value = %s%n"</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        consumer<span class="token punctuation">.</span><span class="token function">commitSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 手动提交偏移量</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
    consumer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="6__250"></a>6. 安全性和权限控制</h3> 
<p>Kafka提供了安全性特性，包括SSL加密、SASL认证等。在生产环境中，确保适当的安全性设置是至关重要的。</p> 
<p>以下是一个使用SSL连接的生产者示例：</p> 
<pre><code class="prism language-java">properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"security.protocol"</span><span class="token punctuation">,</span> <span class="token string">"SSL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"ssl.truststore.location"</span><span class="token punctuation">,</span> <span class="token string">"/path/to/truststore"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"ssl.truststore.password"</span><span class="token punctuation">,</span> <span class="token string">"truststore_password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Producer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="7__264"></a>7. 故障容忍和可伸缩性</h3> 
<h4><a id="71__266"></a>7.1 多节点分布和分区</h4> 
<p>在Kafka中，分布式的设计允许数据分布在多个节点上，这提供了高度的可伸缩性。每个Topic可以分成多个分区，而这些分区可以分布在不同的服务器上。这种分布式设计使得Kafka可以轻松地处理大规模数据，并实现水平扩展。</p> 
<h5><a id="711__270"></a>7.1.1 增加分区数</h5> 
<p>要增加Topic的分区数，可以使用以下命令：</p> 
<pre><code class="prism language-bash">bin/kafka-topics.sh <span class="token parameter variable">--alter</span> <span class="token parameter variable">--topic</span> my_topic <span class="token parameter variable">--partitions</span> <span class="token number">5</span> --bootstrap-server localhost:9092
</code></pre> 
<p>这将把<code>my_topic</code>的分区数增加到5，从而提高系统的吞吐量和可伸缩性。</p> 
<h4><a id="72__280"></a>7.2 复制因子</h4> 
<p>Kafka通过数据的复制来实现容错性。每个分区可以有多个副本，这些副本分布在不同的节点上。在节点发生故障时，其他副本可以继续提供服务。</p> 
<h5><a id="721__284"></a>7.2.1 增加复制因子</h5> 
<p>要增加Topic的复制因子，可以使用以下命令：</p> 
<pre><code class="prism language-bash">bin/kafka-topics.sh <span class="token parameter variable">--alter</span> <span class="token parameter variable">--topic</span> my_topic <span class="token parameter variable">--partitions</span> <span class="token number">3</span> --replication-factor <span class="token number">3</span> --bootstrap-server localhost:9092
</code></pre> 
<p>这将把<code>my_topic</code>的复制因子增加到3，确保每个分区有3个副本。增加复制因子提高了系统的容错性，因为每个分区都有多个副本，即使一个节点发生故障，其他节点上的副本仍然可用。</p> 
<h4><a id="73__294"></a>7.3 节点故障处理</h4> 
<p>Kafka能够处理节点故障，确保系统的可用性。当一个节点发生故障时，Kafka会自动将该节点上的分区重新分配到其他可用节点上，以保持分区的复制因子。</p> 
<h5><a id="731__298"></a>7.3.1 节点故障模拟</h5> 
<p>为了模拟节点故障，你可以通过停止一个Kafka broker进程来模拟。Kafka会自动感知到该节点的故障，并进行分区的重新分配。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 停止一个Kafka broker进程</span>
bin/kafka-server-stop.sh config/server-1.properties
</code></pre> 
<h4><a id="74__307"></a>7.4 性能调优</h4> 
<p>在实际应用中，通过监控系统的性能指标，你可以调整Kafka的配置以满足不同的性能需求。例如，调整日志刷写频率、调整内存和磁盘的配置等，都可以对系统的性能产生影响。</p> 
<h3><a id="_311"></a>总结</h3> 
<p>Kafka的Topic是构建实时流数据处理系统的核心组件之一。通过深入了解Topic的创建、配置、生产者和消费者，以及实际应用中的示例代码，可以更好地理解和应用Kafka。在实际项目中，根据具体需求和场景进行灵活配置，以确保系统的可靠性、性能和安全性。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/57d49c71f7b8c2239f275af3d26309d0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java中三种定时任务总结（schedule，quartz，xxl-job）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/edaf137edc75c8f9b948647092e77f90/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python GUI 新手入门教程：轻松构建图形用户界面</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>