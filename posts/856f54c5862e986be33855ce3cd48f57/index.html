<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Streamlit项目：基于讯飞星火认知大模型开发Web智能对话应用 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/856f54c5862e986be33855ce3cd48f57/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Streamlit项目：基于讯飞星火认知大模型开发Web智能对话应用">
  <meta property="og:description" content="文章目录 1 前言2 API获取3 官方文档的调用代码4 Streamlit 网页的搭建4.1 代码及效果展示4.2 Streamlit相关知识点 5 结语 1 前言 科大讯飞公司于2023年8月15日发布了讯飞认知大模型V2.0，这是一款集跨领域知识和语言理解能力于一体的新一代认知智能大模型。前日，博主对讯飞认知大模型进行了详细的分析，详情请至博文《星星之火：国产讯飞星火大模型的实际使用体验（与GPT对比）》了解。
总的来说，讯飞星火认知大模型表现出卓越的整体性能，在多个领域展现出优秀水平，并且独具多模交互的能力，使其适用的领域更为广泛。特别值得关注的是其中的语义测试、常识性测试以及事件分类测试，这些测试项目揭示了讯飞认知大模型与GPT之间的差异。在常识和事件分类测试中，讯飞认知大模型展示出更出色的表现，而在语义测试中，GPT在准确识别讽刺意味方面更为优秀！
本篇博文聚焦于利用讯飞星火认知大模型的API，基于Streamlit构建个人Web智能对话应用的实践案例。
在本文中，我们将深入探讨如何利用讯飞星火认知大模型的强大功能，为个人Web应用赋予智能对话的能力。我们将介绍整个开发过程的步骤和技术细节，并分享一些关键的使用经验和优化策略。无论您是对智能对话应用开发感兴趣的开发者，还是想要了解讯飞星火认知大模型在实际应用中的表现的研究者，本文都将为您提供宝贵的参考和实践经验。
如果您对Streamlit感兴趣，并且希望深入了解更多相关知识，我强烈推荐您关注我的专栏——《最全Streamlit教程》。
在这个专栏中，我将分享一系列深入而详尽的Streamlit教程和实战案例。我们将探索Streamlit在Web应用开发中的广泛应用，从基本概念到高级功能的全方位覆盖。
通过这些教程，您将深入了解Streamlit的核心原理、工作流程和常见用法。我将解析Streamlit的各个组件和功能，并提供实用的示例代码和技巧，助您快速上手并构建出令人惊叹的交互式应用程序。
2 API获取 要使用讯飞星火认知大模型的功能，您需要向讯飞官方提交申请表单（官网地址）。
在页面上点击&#34;API测试申请&#34;，按照指示填写并创建应用，填写正确的信息后，您只需稍等一两天，便可收到讯飞发来的短信通知。随后，您可以登录到开发者工作台，获取所需的appid、api_secret、api_key等关键信息。
3 官方文档的调用代码 为了在Python环境下使用Streamlit工具，博主下载了讯飞官方文档中的Python调用示例，以便更好地理解和应用该工具。您可以通过以下链接下载官方文档：下载链接
在解压后的文件夹中，您将找到两个Python文件：SparkApi.py和test.py。其中，SparkApi.py是讯飞官方提供的库文件，无需进行任何修改。而我们的重点将放在对test.py文件的研究和修改上。
在您的环境中，为了确保能够成功搭建本篇博文所介绍的项目，您至少需要安装以下必要的库：
pip install streamlit pip install websocket-client pip install streamlit_chat 我们来看看test.py文件中的代码：
import SparkApi #以下密钥信息从控制台获取 appid = &#34;XXXXXXXX&#34; #填写控制台中获取的 APPID 信息 api_secret = &#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34; #填写控制台中获取的 APISecret 信息 api_key =&#34;XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX&#34; #填写控制台中获取的 APIKey 信息 #用于配置大模型版本，默认“general/generalv2” domain = &#34;general&#34; # v1.5版本 # domain = &#34;generalv2&#34; # v2.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-08-21T10:00:00+08:00">
    <meta property="article:modified_time" content="2023-08-21T10:00:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Streamlit项目：基于讯飞星火认知大模型开发Web智能对话应用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__5" rel="nofollow">1 前言</a></li><li><a href="#2_API_23" rel="nofollow">2 API获取</a></li><li><a href="#3__30" rel="nofollow">3 官方文档的调用代码</a></li><li><a href="#4_Streamlit__113" rel="nofollow">4 Streamlit 网页的搭建</a></li><li><ul><li><a href="#41__114" rel="nofollow">4.1 代码及效果展示</a></li><li><a href="#42_Streamlit_233" rel="nofollow">4.2 Streamlit相关知识点</a></li></ul> 
  </li><li><a href="#5__244" rel="nofollow">5 结语</a></li></ul> 
</div> 
<p></p> 
<p><img src="https://images2.imgbox.com/b9/9d/yojb4rCk_o.jpg" alt="在这里插入图片描述"></p> 
<h2><a id="1__5"></a>1 前言</h2> 
<p>科大讯飞公司于2023年8月15日发布了<a href="https://xinghuo.xfyun.cn/" rel="nofollow">讯飞认知大模型V2.0</a>，这是一款集跨领域知识和语言理解能力于一体的新一代认知智能大模型。前日，博主对讯飞认知大模型进行了详细的分析，详情请至博文《<a href="https://blog.csdn.net/weixin_46043195/article/details/132325927?spm=1001.2014.3001.5501">星星之火：国产讯飞星火大模型的实际使用体验（与GPT对比）</a>》了解。</p> 
<p>总的来说，讯飞星火认知大模型表现出卓越的整体性能，在多个领域展现出优秀水平，并且独具多模交互的能力，使其适用的领域更为广泛。特别值得关注的是其中的语义测试、常识性测试以及事件分类测试，这些测试项目揭示了讯飞认知大模型与GPT之间的差异。在常识和事件分类测试中，讯飞认知大模型展示出更出色的表现，而在语义测试中，GPT在准确识别讽刺意味方面更为优秀！</p> 
<p><code>本篇博文聚焦于利用讯飞星火认知大模型的API，基于Streamlit构建个人Web智能对话应用的实践案例。</code></p> 
<p>在本文中，我们将深入探讨如何利用讯飞星火认知大模型的强大功能，为个人Web应用赋予智能对话的能力。我们将介绍整个开发过程的步骤和技术细节，并分享一些关键的使用经验和优化策略。无论您是对智能对话应用开发感兴趣的开发者，还是想要了解讯飞星火认知大模型在实际应用中的表现的研究者，本文都将为您提供宝贵的参考和实践经验。</p> 
<p>如果您对Streamlit感兴趣，并且希望深入了解更多相关知识，我强烈推荐您关注我的专栏——《<a href="https://blog.csdn.net/weixin_46043195/category_12202237.html">最全Streamlit教程</a>》。</p> 
<p>在这个专栏中，我将分享一系列深入而详尽的Streamlit教程和实战案例。我们将探索Streamlit在Web应用开发中的广泛应用，从基本概念到高级功能的全方位覆盖。</p> 
<p>通过这些教程，您将深入了解Streamlit的核心原理、工作流程和常见用法。我将解析Streamlit的各个组件和功能，并提供实用的示例代码和技巧，助您快速上手并构建出令人惊叹的交互式应用程序。</p> 
<p><img src="https://images2.imgbox.com/73/80/5Up5i0sB_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2_API_23"></a>2 API获取</h2> 
<p>要使用讯飞星火认知大模型的功能，您需要向讯飞官方提交申请表单（<a href="https://www.xfyun.cn/solutions/xinghuoAPI" rel="nofollow">官网地址</a>）。</p> 
<p><img src="https://images2.imgbox.com/4a/bf/6GYTxf9R_o.png" alt="在这里插入图片描述"></p> 
<p>在页面上点击"API测试申请"，按照指示填写并创建应用，填写正确的信息后，您只需稍等一两天，便可收到讯飞发来的短信通知。随后，您可以登录到开发者工作台，获取所需的appid、api_secret、api_key等关键信息。</p> 
<h2><a id="3__30"></a>3 官方文档的调用代码</h2> 
<p>为了在Python环境下使用Streamlit工具，博主下载了讯飞官方文档中的Python调用示例，以便更好地理解和应用该工具。您可以通过以下链接下载官方文档：<a href="https://xfyun-doc.cn-bj.ufileos.com/static/16919367030710594/SparkApi_Python.zip" rel="nofollow">下载链接</a></p> 
<p>在解压后的文件夹中，您将找到两个Python文件：SparkApi.py和test.py。其中，SparkApi.py是讯飞官方提供的库文件，无需进行任何修改。而我们的重点将放在对test.py文件的研究和修改上。<br> <img src="https://images2.imgbox.com/81/40/yqE5o0yb_o.png" alt="在这里插入图片描述"><br> 在您的环境中，为了确保能够成功搭建本篇博文所介绍的项目，您至少需要安装以下必要的库：</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> streamlit
pip <span class="token function">install</span> websocket-client
pip <span class="token function">install</span> streamlit_chat
</code></pre> 
<p>我们来看看test.py文件中的代码：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> SparkApi
<span class="token comment">#以下密钥信息从控制台获取</span>
appid <span class="token operator">=</span> <span class="token string">"XXXXXXXX"</span>     <span class="token comment">#填写控制台中获取的 APPID 信息</span>
api_secret <span class="token operator">=</span> <span class="token string">"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"</span>   <span class="token comment">#填写控制台中获取的 APISecret 信息</span>
api_key <span class="token operator">=</span><span class="token string">"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"</span>    <span class="token comment">#填写控制台中获取的 APIKey 信息</span>

<span class="token comment">#用于配置大模型版本，默认“general/generalv2”</span>
domain <span class="token operator">=</span> <span class="token string">"general"</span>   <span class="token comment"># v1.5版本</span>
<span class="token comment"># domain = "generalv2"    # v2.0版本</span>
<span class="token comment">#云端环境的服务地址</span>
Spark_url <span class="token operator">=</span> <span class="token string">"ws://spark-api.xf-yun.com/v1.1/chat"</span>  <span class="token comment"># v1.5环境的地址</span>
<span class="token comment"># Spark_url = "ws://spark-api.xf-yun.com/v2.1/chat"  # v2.0环境的地址</span>


text <span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment"># length = 0</span>

<span class="token keyword">def</span> <span class="token function">getText</span><span class="token punctuation">(</span>role<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    jsoncon <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    jsoncon<span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span> <span class="token operator">=</span> role
    jsoncon<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">=</span> content
    text<span class="token punctuation">.</span>append<span class="token punctuation">(</span>jsoncon<span class="token punctuation">)</span>
    <span class="token keyword">return</span> text

<span class="token keyword">def</span> <span class="token function">getlength</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    length <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> content <span class="token keyword">in</span> text<span class="token punctuation">:</span>
        temp <span class="token operator">=</span> content<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span>
        leng <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
        length <span class="token operator">+=</span> leng
    <span class="token keyword">return</span> length

<span class="token keyword">def</span> <span class="token function">checklen</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>getlength<span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">del</span> text<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> text
    


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    text<span class="token punctuation">.</span>clear
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        Input <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span><span class="token string">"我:"</span><span class="token punctuation">)</span>
        question <span class="token operator">=</span> checklen<span class="token punctuation">(</span>getText<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span>Input<span class="token punctuation">)</span><span class="token punctuation">)</span>
        SparkApi<span class="token punctuation">.</span>answer <span class="token operator">=</span><span class="token string">""</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"星火:"</span><span class="token punctuation">,</span>end <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span>
        SparkApi<span class="token punctuation">.</span>main<span class="token punctuation">(</span>appid<span class="token punctuation">,</span>api_key<span class="token punctuation">,</span>api_secret<span class="token punctuation">,</span>Spark_url<span class="token punctuation">,</span>domain<span class="token punctuation">,</span>question<span class="token punctuation">)</span>
        getText<span class="token punctuation">(</span><span class="token string">"assistant"</span><span class="token punctuation">,</span>SparkApi<span class="token punctuation">.</span>answer<span class="token punctuation">)</span>
        <span class="token comment"># print(str(text))</span>


</code></pre> 
<p><code>在上述代码中，我们需要从控制台获取以下信息：appid、api_secret、api_key。为了确保代码顺利运行，我们需要将 domain 和 Spark_url 更改为 V2.0 版本。</code></p> 
<p><code>此外，确保 SparkApi.py 文件与 test.py 文件在同一目录下，以便能够轻松地进行导入操作。同样，在将此功能嵌入到 Streamlit 网页项目时，也需要遵循同样的文件路径规则和导入方式。</code></p> 
<p>这些信息是访问讯飞API所必需的凭证和身份验证信息。您可以在讯飞的开发者控制台中获取这些信息。确保您输入的凭证信息正确无误，这样才能够正常连接到讯飞API并获取所需的数据和结果。</p> 
<p>以下是运行结果：</p> 
<p><img src="https://images2.imgbox.com/89/95/8mOvqCl7_o.png" alt="在这里插入图片描述"></p> 
<p>很好！已经成功地调用了讯飞API并获得所需的结果。现在，我们可以将这个功能嵌入到一个 Streamlit 网页中，以方便用户使用和体验。</p> 
<h2><a id="4_Streamlit__113"></a>4 Streamlit 网页的搭建</h2> 
<h3><a id="41__114"></a>4.1 代码及效果展示</h3> 
<p>在基于官方提供的示例代码的基础上，我们成功搭建了一个使用 Streamlit 的网页。以下是完整的网页源码（注释很详细）：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> streamlit <span class="token keyword">as</span> st
<span class="token keyword">from</span> streamlit_chat <span class="token keyword">import</span> message

<span class="token keyword">import</span> SparkApi

<span class="token comment"># 以下密钥信息从控制台获取</span>
appid <span class="token operator">=</span> <span class="token string">"XXXXXXXX"</span>  <span class="token comment"># 填写控制台中获取的 APPID 信息</span>
api_secret <span class="token operator">=</span> <span class="token string">"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"</span>  <span class="token comment"># 填写控制台中获取的 APISecret 信息</span>
api_key <span class="token operator">=</span> <span class="token string">"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"</span>  <span class="token comment"># 填写控制台中获取的 APIKey 信息</span>

<span class="token comment"># 用于配置大模型版本，默认“general/generalv2”</span>
<span class="token comment"># domain = "general"   # v1.5版本</span>
domain <span class="token operator">=</span> <span class="token string">"generalv2"</span>  <span class="token comment"># v2.0版本</span>
<span class="token comment"># 云端环境的服务地址</span>
<span class="token comment"># Spark_url = "ws://spark-api.xf-yun.com/v1.1/chat"  # v1.5环境的地址</span>
Spark_url <span class="token operator">=</span> <span class="token string">"ws://spark-api.xf-yun.com/v2.1/chat"</span>  <span class="token comment"># v2.0环境的地址</span>

text <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 用于存储对话内容的列表</span>

<span class="token keyword">def</span> <span class="token function">getText</span><span class="token punctuation">(</span>role<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    构造包含角色和内容的对话信息，并添加到对话列表中
    
    参数：
    role (str): 对话角色，可以是 "user"（用户）或 "assistant"（助手）
    content (str): 对话内容
    
    返回值：
    text (list): 更新后的对话列表
    """</span>
    jsoncon <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    jsoncon<span class="token punctuation">[</span><span class="token string">"role"</span><span class="token punctuation">]</span> <span class="token operator">=</span> role
    jsoncon<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span> <span class="token operator">=</span> content
    text<span class="token punctuation">.</span>append<span class="token punctuation">(</span>jsoncon<span class="token punctuation">)</span>
    <span class="token keyword">return</span> text

<span class="token keyword">def</span> <span class="token function">getlength</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    计算对话列表中所有对话内容的字符长度之和
    
    参数：
    text (list): 对话列表
    
    返回值：
    length (int): 对话内容的字符长度之和
    """</span>
    length <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> content <span class="token keyword">in</span> text<span class="token punctuation">:</span>
        temp <span class="token operator">=</span> content<span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span>
        leng <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
        length <span class="token operator">+=</span> leng
    <span class="token keyword">return</span> length

<span class="token keyword">def</span> <span class="token function">checklen</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    检查对话列表中的对话内容字符长度是否超过限制（8000个字符）
    如果超过限制，删除最早的对话内容，直到满足字符长度限制
    
    参数：
    text (list): 对话列表
    
    返回值：
    text (list): 更新后满足字符长度限制的对话列表
    """</span>
    <span class="token keyword">while</span> getlength<span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">8000</span><span class="token punctuation">:</span>
        <span class="token keyword">del</span> text<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> text

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># 在 Streamlit 网页上显示欢迎文本</span>
    st<span class="token punctuation">.</span>markdown<span class="token punctuation">(</span><span class="token string">"#### 我是讯飞星火认知模型机器人，我可以回答您的任何问题！"</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 初始化对话历史和生成的响应列表</span>
    <span class="token keyword">if</span> <span class="token string">'generated'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">[</span><span class="token string">'generated'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token string">'past'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">:</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">[</span><span class="token string">'past'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    
    <span class="token comment"># 获取用户输入的问题</span>
    user_input <span class="token operator">=</span> st<span class="token punctuation">.</span>text_input<span class="token punctuation">(</span><span class="token string">"请输入您的问题:"</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token string">'input'</span><span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> user_input<span class="token punctuation">:</span>
        <span class="token comment"># 构造用户输入的对话信息</span>
        question <span class="token operator">=</span> checklen<span class="token punctuation">(</span>getText<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> user_input<span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 调用 SparkApi 中的函数进行问题回答</span>
        SparkApi<span class="token punctuation">.</span>answer <span class="token operator">=</span> <span class="token string">""</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"星火:"</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
        SparkApi<span class="token punctuation">.</span>main<span class="token punctuation">(</span>appid<span class="token punctuation">,</span> api_key<span class="token punctuation">,</span> api_secret<span class="token punctuation">,</span> Spark_url<span class="token punctuation">,</span> domain<span class="token punctuation">,</span> question<span class="token punctuation">)</span>
        output <span class="token operator">=</span> getText<span class="token punctuation">(</span><span class="token string">"assistant"</span><span class="token punctuation">,</span> SparkApi<span class="token punctuation">.</span>answer<span class="token punctuation">)</span>
        
        <span class="token comment"># 将用户输入和生成的响应添加到对话历史和生成的响应列表中</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">[</span><span class="token string">'past'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>user_input<span class="token punctuation">)</span>
        st<span class="token punctuation">.</span>session_state<span class="token punctuation">[</span><span class="token string">'generated'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>output<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
    <span class="token keyword">if</span> st<span class="token punctuation">.</span>session_state<span class="token punctuation">[</span><span class="token string">'generated'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token comment"># 在网页上显示对话历史和生成的响应</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>st<span class="token punctuation">.</span>session_state<span class="token punctuation">[</span><span class="token string">'generated'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            message<span class="token punctuation">(</span>st<span class="token punctuation">.</span>session_state<span class="token punctuation">[</span><span class="token string">"generated"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
            message<span class="token punctuation">(</span>st<span class="token punctuation">.</span>session_state<span class="token punctuation">[</span><span class="token string">'past'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> is_user<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'_user'</span><span class="token punctuation">)</span>
</code></pre> 
<p>在代码中，将以下变量替换为您从讯飞开放平台获得的信息：</p> 
<ul><li>appid：替换为您的APPID。</li><li>api_secret：替换为您的APISecret。</li><li>api_key：替换为您的APIKey。</li></ul> 
<p>终端运行 Streamlit 应用程序：</p> 
<pre><code class="prism language-bash">streamlit run your_app.py
</code></pre> 
<p><img src="https://images2.imgbox.com/c0/04/5kCLzbNg_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="42_Streamlit_233"></a>4.2 Streamlit相关知识点</h3> 
<ol><li>st.markdown()：用于在Streamlit应用程序中显示Markdown格式的文本。</li><li>st.text_input()：用于在Streamlit应用程序中创建一个文本输入框，用来获取用户的输入。</li><li>st.session_state：用于在Streamlit应用程序中存储和访问会话状态，可以在不同的函数之间传递数据。在这段代码中，使用st.session_state来保存和获取对话历史和生成的响应。</li><li>st.session_state[‘generated’]和st.session_state[‘past’]：这些变量用于存储对话历史和生成的响应的列表。</li><li>message()函数：这是一个自定义的Streamlit组件，用于显示消息。在这段代码中，使用message()函数来显示对话历史和生成的响应。</li></ol> 
<blockquote> 
 <p>如果您对Streamlit感兴趣，并且希望深入了解更多相关知识，我强烈推荐您关注我的专栏——《<a href="https://blog.csdn.net/weixin_46043195/category_12202237.html">最全Streamlit教程</a>》。</p> 
</blockquote> 
<h2><a id="5__244"></a>5 结语</h2> 
<p>本博文介绍了如何使用Streamlit和讯飞星火认知模型机器人构建一个问答应用程序。通过集成讯飞开放平台的API和自定义的Streamlit组件，我们可以实现实时的问答功能，并在网页上显示对话历史和生成的响应。</p> 
<p>在使用这段代码前，需要完成一些准备工作，包括在讯飞开放平台注册账号、创建应用程序并获取相关信息。然后，需要安装所需的Python库，并将提供的源代码修改为适用于自己的API密钥和地址信息。最后，运行Streamlit应用程序并在浏览器中访问生成的URL即可。</p> 
<p>在实现问答功能的过程中，我们学习了一些与Streamlit相关的知识点，包括显示Markdown文本、创建文本输入框、存储会话状态等。这些功能使得构建交互式的Web应用程序变得简单易用。</p> 
<p>通过本博文的介绍，您现在可以开始使用讯飞星火认知模型机器人构建自己的问答应用程序了。希望这对您有帮助，祝您在开发过程中顺利前进！</p> 
<p><img src="https://images2.imgbox.com/7e/4e/C3jRzOo6_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ae97d9d97faf1de1b6ccf54ecf715416/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用chatgpt实现微信聊天小程序(秒回复)，github开源(附带链接)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/12508e9650e5b4a48c3126aa49251d4c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">sql中的替换函数replace()总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>