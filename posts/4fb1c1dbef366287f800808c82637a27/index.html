<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>微信公众号 - Java推送小程序订阅消息给用户_java 通过微信公众号发送订阅通知 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/4fb1c1dbef366287f800808c82637a27/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="微信公众号 - Java推送小程序订阅消息给用户_java 通过微信公众号发送订阅通知">
  <meta property="og:description" content="难道这样就够了吗？不，远远不够！ 提前多熟悉阿里往年的面试题肯定是对面试有很大的帮助的，但是作为技术性职业，手里有实打实的技术才是你面对面试官最有用的利器，这是从内在散发出来的自信。
备战阿里时我花的最多的时间就是在学习技术上，占了我所有学习计划中的百分之70，这是一些我学习期间觉得还是很不错的一些学习笔记
我为什么要写这篇文章呢，其实我觉得学习是不能停下脚步的，在网络上和大家一起分享，一起讨论，不单单可以遇到更多一样的人，还可以扩大自己的眼界，学习到更多的技术，我还会在csdn、博客、掘金等网站上分享技术，这也是一种学习的方法。
今天就分享到这里了，谢谢大家的关注，以后会分享更多的干货给大家！
本文已被CODING开源项目：【一线大厂Java面试题解析&#43;核心总结学习笔记&#43;最新讲解视频&#43;实战项目源码】收录
需要这份系统化的资料的朋友，可以点击这里获取
官方文档
注意低版本订阅消息api必须在点击事件中触发，一般可做成显示一个按钮，友好的提示用户，然后再让用户点击按钮去手动触发订阅。
我这里就随便找了个页面在一个点击事件上添加了授权弹窗，不要纠结命名，页面是前端做的（疯狂甩锅ing）。
事件定义
微信开发者工具中的效果
真机效果
三、引用第三方sdk，集成订阅消息推送 我这儿是集成订阅消息推送到已有的系统消息中，通过配置是否发送订阅消息进行分发，具体实现各工程不一样，我这儿就不展示了。
1、pom引入第三方sdk 引入第三方sdk，我们就只需要封装好消息发送的核心代码，微信相关的token及其他信息的维护就交给sdk，我们不用关注（但是原理要知道）。
sdk的作者：GitHub
com.github.binarywang
weixin-java-miniapp
4.1.0
2、核心代码（有注释） import cn.binarywang.wx.miniapp.api.WxMaService; import cn.binarywang.wx.miniapp.api.impl.WxMaServiceImpl; import cn.binarywang.wx.miniapp.bean.WxMaSubscribeMessage; import cn.binarywang.wx.miniapp.config.impl.WxMaDefaultConfigImpl; import com.coyee.core.log.Logger; import org.springframework.stereotype.Component; import java.util.ArrayList; @Component public class WeChatMessageHelperTest { private static WxMaService wxMaService = new WxMaServiceImpl(); /** * 发送小程序订阅消息 * @param appletsSubType 小程序类型（developer为开发版、trial为体验版、formal为正式版） * @param appSubTempId 订阅消息模板id * @param appSubPagePath 跳转小程序地址 * @param appletsAppid 小程序appId * @param appletsSecret 小程序secret * @param appletsSubToken 小程序token * @param appletsSubAesKey 小程序EncodingAESKey * @param appletsSubDataFormat 数据格式 * @param wxMaSubMsgList 消息列表 * @param userIds 接收用户id * @return void * @version V1.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-13T02:45:19+08:00">
    <meta property="article:modified_time" content="2024-05-13T02:45:19+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">微信公众号 - Java推送小程序订阅消息给用户_java 通过微信公众号发送订阅通知</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_2"></a>难道这样就够了吗？不，远远不够！</h2> 
<p>提前多熟悉阿里往年的面试题肯定是对面试有很大的帮助的，但是作为技术性职业，手里有实打实的技术才是你面对面试官最有用的利器，这是从内在散发出来的自信。</p> 
<p>备战阿里时我花的最多的时间就是在学习技术上，占了我所有学习计划中的百分之70，这是一些我学习期间觉得还是很不错的一些学习笔记</p> 
<p>我为什么要写这篇文章呢，其实我觉得学习是不能停下脚步的，在网络上和大家一起分享，一起讨论，不单单可以遇到更多一样的人，还可以扩大自己的眼界，学习到更多的技术，我还会在csdn、博客、掘金等网站上分享技术，这也是一种学习的方法。</p> 
<p>今天就分享到这里了，谢谢大家的关注，以后会分享更多的干货给大家！</p> 
<p><img src="https://images2.imgbox.com/3f/53/pO3wPphi_o.png" alt="阿里一面就落马，恶补完这份“阿里面试宝典”后，上岸蚂蚁金服"></p> 
<p><img src="https://images2.imgbox.com/fd/0b/9PXU5IRt_o.png" alt="阿里一面就落马，恶补完这份“阿里面试宝典”后，上岸蚂蚁金服"></p> 
<p><img src="https://images2.imgbox.com/87/3c/bVpr37ZM_o.png" alt="image.png"></p> 
<blockquote> 
 <p><strong>本文已被<a href="https://bbs.csdn.net/forums/4f45ff00ff254613a03fab5e56a57acb">CODING开源项目：【一线大厂Java面试题解析+核心总结学习笔记+最新讲解视频+实战项目源码】</a>收录</strong></p> 
</blockquote> 
<p><strong><a href="https://bbs.csdn.net/forums/4f45ff00ff254613a03fab5e56a57acb">需要这份系统化的资料的朋友，可以点击这里获取</a></strong></p> 
<p><a href="" rel="nofollow">官方文档</a></p> 
<p>注意低版本订阅消息api必须在点击事件中触发，一般可做成显示一个按钮，友好的提示用户，然后再让用户点击按钮去手动触发订阅。</p> 
<p>我这里就随便找了个页面在一个点击事件上添加了授权弹窗，不要纠结命名，页面是前端做的（疯狂甩锅ing）。</p> 
<p><img src="https://images2.imgbox.com/03/53/7iOWFq7U_o.png" alt=""></p> 
<p>事件定义</p> 
<p><img src="https://images2.imgbox.com/43/bd/qKvDqqch_o.png" alt=""></p> 
<p>微信开发者工具中的效果</p> 
<p><img src="https://images2.imgbox.com/67/a4/HHQjUCG2_o.png" alt=""></p> 
<p>真机效果</p> 
<p><img src="https://images2.imgbox.com/3e/01/hWODM7Lk_o.png" alt=""></p> 
<h3><a id="sdk_57"></a>三、引用第三方sdk，集成订阅消息推送</h3> 
<p>我这儿是集成订阅消息推送到已有的系统消息中，通过配置是否发送订阅消息进行分发，具体实现各工程不一样，我这儿就不展示了。</p> 
<h4><a id="1pomsdk_63"></a>1、pom引入第三方sdk</h4> 
<p>引入第三方sdk，我们就只需要封装好消息发送的核心代码，微信相关的token及其他信息的维护就交给sdk，我们不用关注（但是原理要知道）。</p> 
<p>sdk的作者：<a href="" rel="nofollow">GitHub</a></p> 
<p> 
 <br> <br>     com.github.binarywang<br>     weixin-java-miniapp<br>     4.1.0<br> </p> 
<h4><a id="2_80"></a>2、核心代码（有注释）</h4> 
<pre><code>import cn.binarywang.wx.miniapp.api.WxMaService;
import cn.binarywang.wx.miniapp.api.impl.WxMaServiceImpl;
import cn.binarywang.wx.miniapp.bean.WxMaSubscribeMessage;
import cn.binarywang.wx.miniapp.config.impl.WxMaDefaultConfigImpl;
import com.coyee.core.log.Logger;
import org.springframework.stereotype.Component;

import java.util.ArrayList;

@Component
public class WeChatMessageHelperTest {

    private static WxMaService wxMaService = new WxMaServiceImpl();

    /**
     * 发送小程序订阅消息
     * @param appletsSubType 小程序类型（developer为开发版、trial为体验版、formal为正式版）
     * @param appSubTempId 订阅消息模板id
     * @param appSubPagePath 跳转小程序地址
     * @param appletsAppid 小程序appId
     * @param appletsSecret 小程序secret
     * @param appletsSubToken 小程序token
     * @param appletsSubAesKey 小程序EncodingAESKey
     * @param appletsSubDataFormat 数据格式
     * @param wxMaSubMsgList 消息列表
     * @param userIds 接收用户id
     * @return void
     * @version V1.0
     * modify history
     */
    public static void sendWechatAppSubMessage(String appletsSubType, String appSubTempId, String appSubPagePath, String appletsAppid, String appletsSecret, String appletsSubToken, String appletsSubAesKey, String appletsSubDataFormat, ArrayList&lt;WxMaSubscribeMessage.MsgData&gt; wxMaSubMsgList, String... userIds) throws Exception {

        /*
        // wxMaSubMsgList组装示例，在业务里组装好，再调用系统消息发送工具，系统消息判断是否需要发送小程序订阅消息进行分发，此处不做展示
        ArrayList&lt;WxMaSubscribeMessage.MsgData&gt; wxMaSubscribeData = new ArrayList&lt;&gt;();
        WxMaSubscribeMessage.MsgData characterString1 = new WxMaSubscribeMessage.MsgData();
        characterString1.setName("character_string1");
        characterString1.setValue("DR15325419846198615651");
        wxMaSubscribeData.add(characterString1);
        WxMaSubscribeMessage.MsgData thing3 = new WxMaSubscribeMessage.MsgData();
        thing3.setName("thing3");
        thing3.setValue("请XXXXXXXX");
        wxMaSubscribeData.add(thing3);
        WxMaSubscribeMessage.MsgData time5 = new WxMaSubscribeMessage.MsgData();
        time5.setName("time5");
        time5.setValue(DateUtil.format(new Date(),DateUtil.DATE_TIME_FORMAT));
        wxMaSubscribeData.add(time5);
        */

        WxMaDefaultConfigImpl config = new WxMaDefaultConfigImpl();
        // 小程序appId
        config.setAppid(appletsAppid);
        // 小程序secret
        config.setSecret(appletsSecret);
        // 小程序token
        config.setToken(appletsSubToken);
        // 小程序EncodingAESKey
        config.setAesKey(appletsSubAesKey);
        // 数据格式
        config.setMsgDataFormat(appletsSubDataFormat);
        wxMaService.setWxMaConfig(config);

        for (String userId : userIds) {
            // TODO：根据用户id获取OpenId,测试时写死
            WxMaSubscribeMessage subscribeMessage = new WxMaSubscribeMessage();
            // 要推送的用户openid
            subscribeMessage.setToUser("openId");
            // 小程序类型（developer为开发版、trial为体验版、formal为正式版）,默认为formal（正式版）
            subscribeMessage.setMiniprogramState(appletsSubType);
            // 订阅消息模板id
            subscribeMessage.setTemplateId(appSubTempId);
            // 跳转小程序地址
            subscribeMessage.setPage(appSubPagePath);
            // 消息列表（组装示例请看方法开始注释部分）
            subscribeMessage.setData(wxMaSubMsgList);

            try {
                // 发送订阅消息
                wxMaService.getMsgService().sendSubscribeMsg(subscribeMessage);
            } catch (Exception e) {
                Logger.error("微信小程序订阅消息推送失败，接收userId: " + userId, e);
            }
        }
    }
}
</code></pre> 
<p>订阅消息每个参数都有相关限制，具体以官网的为准：<a href="" rel="nofollow">订阅消息参数值内容限制说明</a></p> 
<p><img src="https://images2.imgbox.com/34/ea/OLZGP3vl_o.png" alt=""></p> 
<h4><a id="_179"></a>最后</h4> 
<p>小编利用空余时间整理了一份《MySQL性能调优手册》，初衷也很简单，就是希望能够帮助到大家，减轻大家的负担和节省时间。</p> 
<p>关于这个，给大家看一份学习大纲（PDF）文件，每一个分支里面会有详细的介绍。</p> 
<p><img src="https://images2.imgbox.com/b4/52/gGR2cUbf_o.png" alt="image"></p> 
<p><strong>这里都是以图片形式展示介绍，如要下载原文件以及更多的性能调优笔记（MySQL+Tomcat+JVM）！</strong></p> 
<blockquote> 
 <p><strong>本文已被<a href="https://bbs.csdn.net/forums/4f45ff00ff254613a03fab5e56a57acb">CODING开源项目：【一线大厂Java面试题解析+核心总结学习笔记+最新讲解视频+实战项目源码】</a>收录</strong></p> 
</blockquote> 
<p><strong><a href="https://bbs.csdn.net/forums/4f45ff00ff254613a03fab5e56a57acb">需要这份系统化的资料的朋友，可以点击这里获取</a></strong></p> 
<p>面试题解析+核心总结学习笔记+最新讲解视频+实战项目源码】](https://bbs.csdn.net/forums/4f45ff00ff254613a03fab5e56a57acb)收录**</p> 
<p><strong><a href="https://bbs.csdn.net/forums/4f45ff00ff254613a03fab5e56a57acb">需要这份系统化的资料的朋友，可以点击这里获取</a></strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d06c02d7855154fbf92d7b34356763e3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">已解决java.lang.AbstractMethodError: 抽象方法错误的正确解决方法，亲测有效！！！</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/820545d0e466a3abb86286fb2608de7d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">一文实现Llama 3 图片理解能力微调（XTuner&#43;LLaVA 版）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>