<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>helm系列之-使用helm部署应用 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/aa3376f3d1df305857322a513262a1f6/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="helm系列之-使用helm部署应用">
  <meta property="og:description" content="使用helm部署应用 Helm 是一个 Kubernetes 的包管理工具，用于简化应用的部署和管理。下面是用helm在k8s上部署应用的一般流程。
添加helm仓库 # 添加仓库 root@master1:~# helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts root@master1:~# helm repo add bitnami https://charts.bitnami.com/bitnami # 更新 root@master1:~# helm repo update Hang tight while we grab the latest from your chart repositories... ...Successfully got an update from the &#34;aliyun&#34; chart repository ...Successfully got an update from the &#34;harbor&#34; chart repository ...Successfully got an update from the &#34;gitlab-jh&#34; chart repository ... # 仓库列表 root@master1:~# helm repo list NAME URL ingress-nginx https://kubernetes.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-13T22:54:11+08:00">
    <meta property="article:modified_time" content="2024-07-13T22:54:11+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">helm系列之-使用helm部署应用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="helm_0"></a>使用helm部署应用</h2> 
<p>Helm 是一个 Kubernetes 的包管理工具，用于简化应用的部署和管理。下面是用helm在k8s上部署应用的一般流程。</p> 
<ol><li>添加helm仓库</li></ol> 
<pre><code class="prism language-shell"><span class="token comment"># 添加仓库</span>
root@master1:~<span class="token comment"># helm repo add aliyun  https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span>
root@master1:~<span class="token comment"># helm repo add bitnami https://charts.bitnami.com/bitnami</span>

<span class="token comment"># 更新</span>
root@master1:~<span class="token comment"># helm repo update</span>
Hang tight <span class="token keyword">while</span> we grab the latest from your chart repositories<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.Successfully got an update from the <span class="token string">"aliyun"</span> chart repository
<span class="token punctuation">..</span>.Successfully got an update from the <span class="token string">"harbor"</span> chart repository
<span class="token punctuation">..</span>.Successfully got an update from the <span class="token string">"gitlab-jh"</span> chart repository
<span class="token punctuation">..</span>.

<span class="token comment"># 仓库列表</span>
root@master1:~<span class="token comment"># helm repo list</span>
NAME            URL
ingress-nginx   https://kubernetes.github.io/ingress-nginx
openebs         https://openebs.github.io/openebs
harbor          https://helm.goharbor.io
jenkins         https://charts.jenkins.io
gitlab          https://charts.gitlab.io/
gitlab-jh       https://charts.gitlab.cn
bitnami         https://charts.bitnami.com/bitnami
aliyun          https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts

<span class="token comment"># 删除</span>
helm repo remove xxx
</code></pre> 
<ol start="2"><li>搜索应用</li></ol> 
<pre><code class="prism language-shell">root@master1:~<span class="token comment"># helm search repo nginx</span>
NAME                                    CHART VERSION   APP VERSION     DESCRIPTION
aliyun/nginx-ingress                    <span class="token number">0.9</span>.5           <span class="token number">0.10</span>.2          An nginx Ingress controller that uses ConfigMap<span class="token punctuation">..</span>.
aliyun/nginx-lego                       <span class="token number">0.3</span>.1                           Chart <span class="token keyword">for</span> nginx-ingress-controller and kube-lego
bitnami/nginx                           <span class="token number">18.1</span>.4          <span class="token number">1.27</span>.0          NGINX Open Source is a web server that can be a<span class="token punctuation">..</span>.
bitnami/nginx-ingress-controller        <span class="token number">11.3</span>.12         <span class="token number">1.11</span>.0          NGINX Ingress Controller is an Ingress controll<span class="token punctuation">..</span>.
bitnami/nginx-intel                     <span class="token number">2.1</span>.15          <span class="token number">0.4</span>.9           DEPRECATED NGINX Open Source <span class="token keyword">for</span> Intel is a lig<span class="token punctuation">..</span>.
ingress-nginx/ingress-nginx             <span class="token number">4.11</span>.0          <span class="token number">1.11</span>.0          Ingress controller <span class="token keyword">for</span> Kubernetes using NGINX a<span class="token punctuation">..</span>.
aliyun/gcloud-endpoints                 <span class="token number">0.1</span>.0                           Develop, deploy, protect and monitor your APIs <span class="token punctuation">..</span>.
</code></pre> 
<p>默认情况下可以直接部署官方发布的chart，也可以下拉取到本地后进行修改。</p> 
<ol start="3"><li>修改chart</li></ol> 
<pre><code class="prism language-shell"><span class="token comment"># 拉取chart</span>
root@master1:~<span class="token comment"># helm pull bitnami/nginx --version 18.1.4</span>

<span class="token comment"># 解压缩chart</span>
root@master1:~<span class="token comment"># tar xf nginx-18.1.4.tgz</span>
root@master1:~<span class="token comment"># cd nginx/</span>
root@master1:~/nginx<span class="token comment"># ls</span>
Chart.lock  charts  Chart.yaml  README.md  templates  values.schema.json  values.yaml
root@master1:~/nginx<span class="token comment"># vim values.yaml</span>

global:
  imageRegistry: <span class="token string">"harbor.test.com"</span>  <span class="token comment"># 改为私有的helm仓库，此处为本地的harbor服务器</span>
  <span class="token comment">## E.g.</span>
  <span class="token comment">## imagePullSecrets:</span>
  <span class="token comment">##   - myRegistryKeySecretName</span>
<span class="token punctuation">..</span>.
image:
  registry: docker.io
  repository: bitnami/nginx
  tag: <span class="token number">1.27</span>.0-debian-12-r3    <span class="token comment"># 根据本地harbor仓库的nginx镜像，修改repository和tag。registry可以不用修改，使用global配置。</span>
  digest: <span class="token string">""</span>
  <span class="token comment">## Specify a imagePullPolicy</span>

<span class="token punctuation">..</span>.
service:
  <span class="token comment">## @param service.type Service type</span>
  <span class="token comment">##</span>
  type: LoadBalancer  <span class="token comment"># 默认为LoadBalancer，如果没有LB可以修改为NodePort或ClusterIP等。</span>
  <span class="token comment">## @param service.ports.http Service HTTP port</span>
  <span class="token comment">## @param service.ports.https Service HTTPS port</span>
  <span class="token comment">##</span>
  ports:
</code></pre> 
<blockquote> 
 <p>备注</p> 
 <ol><li>Helm chart 通常包含一个 <code>values.yaml</code> 文件，用于配置应用的参数。</li><li>也可以使用 <code>--values</code> 参数指定一个自定义的 <code>values.yaml</code> 文件。</li><li>也可以通过 <code>--set</code> 参数在命令行中设置参数：</li></ol> 
 <p><code>helm install my-nginx stable/nginx --set service.type=LoadBalancer</code></p> 
</blockquote> 
<ol start="4"><li>将nginx镜像下载后推送到本地harbor仓库</li></ol> 
<pre><code class="prism language-shell"><span class="token comment"># 从docker hub下载nginx镜像</span>
nerdctl pull bitnami/nginx:1.27.0-debian-12-r3

<span class="token comment"># 重新打tag推送到本地的harbor</span>
nerdctl tag bitnami/nginx:1.27.0-debian-12-r3 harbor.test.com/bitnami/nginx:1.27.0-debian-12-r3
<span class="token comment"># 推送之前需要在harbor上创建bitnami的项目</span>
nerdctl push harbor.test.com/bitnami/nginx:1.27.0-debian-12-r3
</code></pre> 
<ol start="5"><li>此时部署chart，镜像默认会从本地的harbor去拉取</li></ol> 
<pre><code class="prism language-shell">root@master1:~/nginx/nginx<span class="token comment"># ls</span>
Chart.lock  charts  Chart.yaml  README.md  templates  values.schema.json  values.yaml

root@master1:~/nginx/nginx<span class="token comment"># helm install webapp .</span>
root@master1:~/nginx/nginx<span class="token comment"># helm status webapp</span>
</code></pre> 
<ol start="6"><li>检查部署的nginx</li></ol> 
<pre><code class="prism language-shell">root@master1:~/nginx/nginx<span class="token comment"># kubectl get pod</span>
NAME                              READY   STATUS    RESTARTS       AGE
webapp-nginx-7958699dc-45stm      <span class="token number">1</span>/1     Running   <span class="token number">0</span>              10m
root@master1:~/nginx/nginx<span class="token comment"># kubectl get svc</span>
NAME             TYPE           CLUSTER-IP    EXTERNAL-IP     PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                      AGE
kubernetes       ClusterIP      <span class="token number">10.96</span>.0.1     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>          <span class="token number">443</span>/TCP                      21d
webapp-nginx     LoadBalancer   <span class="token number">10.98</span>.11.69   <span class="token number">192.168</span>.0.242   <span class="token number">80</span>:32079/TCP,443:32506/TCP   17m
</code></pre> 
<p>本文使用的环境有LB，访问<code>http://192.168.0.242</code>即可看到nginx页面。</p> 
<ol start="7"><li>升级部署的应用</li></ol> 
<p><code>helm upgrade webapp . --values values.yaml</code></p> 
<ol start="8"><li>删除部署的应用</li></ol> 
<p><code>helm uninstall webapp</code></p> 
<p>默认为default，删除指定命名空间需要指定<code>-n &lt;ns-name&gt;</code>。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/704b1fd9afd3e6e6f4f38f082ddc5a74/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">百日筑基第二十天-一头扎进消息队列3-RabbitMQ</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c0590bb6932348968211c3a00df5637c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">7-4、5、6 react&#43;ipfs上传文件数据及相关配置（react&#43;区块链实战）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>