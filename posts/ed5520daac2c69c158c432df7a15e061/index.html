<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CVE-2024-21006-weblogic远程命令执行漏洞 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/ed5520daac2c69c158c432df7a15e061/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="CVE-2024-21006-weblogic远程命令执行漏洞">
  <meta property="og:description" content="目录
前言
一、漏洞利用原理
二、影响范围
三、环境搭建及漏洞复现
四、检测与修复
前言 Oracle WebLogic Server 存在远程命令执行漏洞（CVE-2024-21006）,该漏洞源于T3/IIOP协议存在缺陷，未经身份验证的攻击者可通过T3/IIOP协议受影响的服务器发送恶意的请求，利用LDAP工具执行任意代码。
一、漏洞利用原理 该漏洞存在于在weblogic.application.naming中。MessageDestination引用实例会调用weblogic.application.naming，可以控制MessageDestinationObjectFactory#getObjectInstance方法的obj参数，最终在MessageDestinationReference#lookupMessageDestination方法中进行JNDI攻击。攻击者通过ldap服务向weblogic注入经过base64编码恶意代码，后续对context.lookup（“xxx”）进行调用，此操作将触发在 JNDI 上下文中查找绑定对象 （messageDestinationReference），该查找操作经由恶意LDAP服务器处理则会触发任意代码执行。
二、影响范围 Weblogic 12.2.1.4.0,14.1.1.0.0
三、环境搭建及漏洞复现 构建weblogic漏洞环境 准备java环境,所需java版本为&lt;=jdk 1.8_191 （版本过高无法利用成功） 官网下载weblogic 14.1.1.0.0/12.2.1.4.0安装文件或拉取docker镜像（部署过程参考Weblogic部署项目三种方式 - 疯子110 - 博客园 (cnblogs.com)）
下载IDEA，构建环境，用于运行exp 将运行该exp需要weblogic源码的jar包，若单独将weblogic.jar添加为依赖执行不成功，需要下载整个weblogic源码。
exp下载链接：https://pan.baidu.com/s/1gaP2SK-b9pJ5AT7XWuhk_w?pwd=68tg 提取码：68tg
打开exp项目，将weblogic.jar添加为项目依赖
修改攻击目标
可修改需要执行的命令，当前命令为calc.exe，base64编码。修改LDAP恶意服务器IP
下载LDAP恶意服务器工具（链接：https://github.com/WhiteHSBG/JNDIExploit） 运行工具，同时在IDEA启动exp项目
java -jar JNDIExploit-1.4-SNAPSHOT.jar -i &lt;监听IP&gt; 成功在目标机器弹出计算器，攻击结果如下：
四、检测与修复 本地检测：
使用如下命令对 WebLogic 版本和补丁安装的情况进行排查：
$ cd /Oracle/Middleware/wlserver_10.3/server/lib $ java -cp weblogic.jar weblogic.version 在显示结果中，如果没有补丁安装的信息，则说明存在风险。
升级系统，参考官网：https://www.oracle.com/security-alerts/cpuapr2024.html">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-25T16:32:17+08:00">
    <meta property="article:modified_time" content="2024-04-25T16:32:17+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CVE-2024-21006-weblogic远程命令执行漏洞</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E5%89%8D%E8%A8%80-toc" style="margin-left:0px;"><a href="#%E5%89%8D%E8%A8%80" rel="nofollow">前言</a></p> 
<p id="%E4%B8%80%E3%80%81%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%8E%9F%E7%90%86-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%8E%9F%E7%90%86" rel="nofollow">一、漏洞利用原理</a></p> 
<p id="%E4%BA%8C%E3%80%81%E5%BD%B1%E5%93%8D%E8%8C%83%E5%9B%B4-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E5%BD%B1%E5%93%8D%E8%8C%83%E5%9B%B4" rel="nofollow">二、影响范围</a></p> 
<p id="%E4%B8%89%E3%80%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%8F%8A%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%8F%8A%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0" rel="nofollow">三、环境搭建及漏洞复现</a></p> 
<p id="%E4%BA%94%E3%80%81%E6%A3%80%E6%B5%8B%E4%B8%8E%E4%BF%AE%E5%A4%8D-toc" style="margin-left:0px;"><a href="#%E4%BA%94%E3%80%81%E6%A3%80%E6%B5%8B%E4%B8%8E%E4%BF%AE%E5%A4%8D" rel="nofollow">四、检测与修复</a></p> 
<hr> 
<h2 id="%E5%89%8D%E8%A8%80"><a id="_7"></a>前言</h2> 
<p>        Oracle WebLogic Server 存在远程命令执行漏洞（CVE-2024-21006）,该漏洞源于T3/IIOP协议存在缺陷，未经身份验证的攻击者可通过T3/IIOP协议受影响的服务器发送恶意的请求，利用LDAP工具执行任意代码。</p> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E5%8E%9F%E7%90%86"><a id="pandas_16"></a>一、漏洞利用原理</h2> 
<p>        该漏洞存在于在weblogic.application.naming中。MessageDestination引用实例会调用weblogic.application.naming，可以控制MessageDestinationObjectFactory#getObjectInstance方法的obj参数，最终在MessageDestinationReference#lookupMessageDestination方法中进行JNDI攻击。攻击者通过ldap服务向weblogic注入经过base64编码恶意代码，后续对context.lookup（“xxx”）进行调用，此操作将触发在 JNDI 上下文中查找绑定对象 （messageDestinationReference），该查找操作经由恶意LDAP服务器处理则会触发任意代码执行。</p> 
<h2 id="%E4%BA%8C%E3%80%81%E5%BD%B1%E5%93%8D%E8%8C%83%E5%9B%B4"><a id="_19"></a>二、影响范围</h2> 
<p style="text-align:justify;">Weblogic 12.2.1.4.0,14.1.1.0.0</p> 
<h2 id="%E4%B8%89%E3%80%81%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%8F%8A%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0">三、环境搭建及漏洞复现</h2> 
<ol><li style="text-align:justify;">构建weblogic漏洞环境 
  <ol><li>准备java环境,所需java版本为&lt;=jdk 1.8_191 （版本过高无法利用成功）</li><li> <p style="margin-left:.0001pt;text-align:justify;">官网下载weblogic 14.1.1.0.0/12.2.1.4.0安装文件或拉取docker镜像（部署过程参考<a href="https://www.cnblogs.com/telwanggs/p/7137125.html" rel="nofollow" title="Weblogic部署项目三种方式 - 疯子110 - 博客园 (cnblogs.com)">Weblogic部署项目三种方式 - 疯子110 - 博客园 (cnblogs.com)</a>）</p> </li></ol></li><li style="text-align:justify;">下载IDEA，构建环境，用于运行exp 
  <ol><li style="text-align:justify;"> <p style="margin-left:.0001pt;text-align:justify;">将运行该exp需要weblogic源码的jar包，若单独将weblogic.jar添加为依赖执行不成功，需要下载整个weblogic源码。</p> </li><li style="text-align:justify;"> <p style="margin-left:.0001pt;text-align:justify;">exp下载链接：https://pan.baidu.com/s/1gaP2SK-b9pJ5AT7XWuhk_w?pwd=68tg <br> 提取码：68tg</p> </li><li style="text-align:justify;"> <p style="margin-left:.0001pt;text-align:left;">打开exp项目，将weblogic.jar添加为项目依赖<img alt="" height="797" src="https://images2.imgbox.com/21/f2/WGw8PO2C_o.png" width="1107"></p> </li><li style="text-align:justify;"> <p style="margin-left:.0001pt;text-align:left;">修改攻击目标<img alt="" height="414" src="https://images2.imgbox.com/07/86/V8AUekyw_o.png" width="686"></p> </li><li style="text-align:justify;"> <p style="margin-left:.0001pt;text-align:left;">可修改需要执行的命令，当前命令为calc.exe，base64编码。修改LDAP恶意服务器IP<img alt="" height="456" src="https://images2.imgbox.com/28/9f/aBuM1vO1_o.png" width="1062"></p> </li></ol></li><li style="text-align:justify;">下载LDAP恶意服务器工具（链接：<a href="https://github.com/WhiteHSBG/JNDIExploit" title="https://github.com/WhiteHSBG/JNDIExploit">https://github.com/WhiteHSBG/JNDIExploit</a>）</li><li style="text-align:justify;"> <p style="margin-left:.0001pt;text-align:justify;">运行工具，同时在IDEA启动exp项目</p> <pre><code class="language-bash">java -jar JNDIExploit-1.4-SNAPSHOT.jar -i &lt;监听IP&gt;</code></pre> <p style="margin-left:.0001pt;text-align:justify;">成功在目标机器弹出计算器，攻击结果如下：</p> </li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="359" src="https://images2.imgbox.com/67/ec/KZ9t3Wvv_o.png" width="692"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="524" src="https://images2.imgbox.com/1e/e9/rglvIOWG_o.png" width="692"></p> 
<p></p> 
<h2 id="%E4%BA%94%E3%80%81%E6%A3%80%E6%B5%8B%E4%B8%8E%E4%BF%AE%E5%A4%8D">四、检测与修复</h2> 
<p>本地检测：</p> 
<p style="text-align:justify;">使用如下命令对 WebLogic 版本和补丁安装的情况进行排查：</p> 
<pre><code class="language-bash">$ cd /Oracle/Middleware/wlserver_10.3/server/lib

$ java -cp weblogic.jar weblogic.version</code></pre> 
<p style="text-align:justify;">在显示结果中，如果没有补丁安装的信息，则说明存在风险。</p> 
<p style="text-align:justify;">升级系统，参考官网：https://www.oracle.com/security-alerts/cpuapr2024.html</p> 
<h3><br><a id="1_20"></a></h3> 
<h2><a id="_45"></a></h2>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c4498e7af8a487ba5b5e9d6f8eee2045/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">百度 | 如何白嫖文心一言4.0，偷偷的用！</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4a8690e856b7885cf2228c444b1d14bc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">微信公众号使用wx.config前端如何配置参数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>