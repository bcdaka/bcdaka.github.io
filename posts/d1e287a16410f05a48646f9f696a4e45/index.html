<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringBoot前后端交互、全局异常处理：后端异常信息抛到前端显示弹窗 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/d1e287a16410f05a48646f9f696a4e45/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="SpringBoot前后端交互、全局异常处理：后端异常信息抛到前端显示弹窗">
  <meta property="og:description" content="前提是前端必须有接收后端信息的载体：比如：ajax的异步接收等等。
后端：
编写后端的统一返回信息类：
/** * 后端统一返回结果 * @param &lt;T&gt; */ @Data public class Result&lt;T&gt; implements Serializable { private Integer code;//1成功，0和其他数字为失败。 private String msg;//错误信息 private T data;//数据 public static &lt;T&gt; Result&lt;T&gt; success(){ Result&lt;T&gt; result = new Result&lt;T&gt;(); result.code=1; return result; } public static &lt;T&gt; Result&lt;T&gt; success(T object){ Result&lt;T&gt; result = new Result&lt;T&gt;(); result.data=object; result.code=1; return result; } public static &lt;T&gt; Result&lt;T&gt; error(String msg){ Result&lt;T&gt; result = new Result&lt;T&gt;(); result.code=0; result.msg=msg; return result; } } 异常基础类：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-09T11:16:46+08:00">
    <meta property="article:modified_time" content="2024-07-09T11:16:46+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringBoot前后端交互、全局异常处理：后端异常信息抛到前端显示弹窗</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>前提是前端必须有接收后端信息的载体：比如：ajax的异步接收等等。</p> 
<p>后端：</p> 
<p>编写后端的统一返回信息类：</p> 
<pre><code class="language-javascript">
/**
 * 后端统一返回结果
 * @param &lt;T&gt;
 */
@Data
public class Result&lt;T&gt; implements Serializable {
    private Integer code;//1成功，0和其他数字为失败。
    private String msg;//错误信息
    private T data;//数据

    public static &lt;T&gt; Result&lt;T&gt; success(){
        Result&lt;T&gt; result = new Result&lt;T&gt;();
        result.code=1;
        return result;
    }
    public static &lt;T&gt; Result&lt;T&gt; success(T object){
        Result&lt;T&gt; result = new Result&lt;T&gt;();
        result.data=object;
        result.code=1;
        return result;
    }

    public static &lt;T&gt; Result&lt;T&gt; error(String msg){
        Result&lt;T&gt; result = new Result&lt;T&gt;();
        result.code=0;
        result.msg=msg;
        return result;
    }
}</code></pre> 
<p>异常基础类：</p> 
<pre><code class="language-javascript">/**
 * 业务异常
 */
public class BaseException extends RuntimeException{
    public BaseException(String message) {
        super(message);
    }
    public BaseException() {
    }
}</code></pre> 
<pre>账号不存在异常：</pre> 
<pre><code class="language-javascript">/**
 * 账号不存在异常
 */
public class AccountNotFoundException extends BaseException {

    public AccountNotFoundException() {
    }

    public AccountNotFoundException(String msg) {
        super(msg);
    }

}</code></pre> 
<pre>账号密码为空异常：
</pre> 
<pre><code class="language-javascript">/**
 * 账号密码为空
 */
public class InputAccountAndPassword extends BaseException{
    public InputAccountAndPassword(String message) {
        super(message);
    }
}
</code></pre> 
<p> 登录失败异常：</p> 
<pre><code class="language-javascript">/**
 * 登录失败
 */
public class LoginFailedException extends BaseException{
    public LoginFailedException(String msg){
        super(msg);
    }
}</code></pre> 
<p> 密码错误：</p> 
<pre><code class="language-javascript">/**
 * 密码错误异常
 */
public class PasswordErrorException extends BaseException {

    public PasswordErrorException() {
    }

    public PasswordErrorException(String msg) {
        super(msg);
    }

}</code></pre> 
<p>全局异常类：</p> 
<pre><code class="language-javascript">/**
 * 全局异常处理
 */
//@ControllerAdvice(annotations = {RestController.class,Controller.class})
//@ResponseBody
@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {
    /**
     * 业务异常
     * @param ex 异常信息
     * @return 封装、抛出给前端
     */
    @ExceptionHandler
    public Result&lt;String&gt; exceptionHandler(BaseException ex){
        log.error(ex.getMessage());
        return Result.error(ex.getMessage());
    }

    @ExceptionHandler
    public Result&lt;String&gt; exceptionHandler(ExpiredJwtException ex){
        String message=ex.getMessage();
        if (message.contains("expired")){
            return Result.error("登录过期！");
        }
        return null;
    }
}</code></pre> 
<p>举例：</p> 
<p>登录的服务</p> 
<pre><code class="language-javascript">@Service
@Slf4j
public class LoginServiceImpl implements LoginService {
    @Autowired(required = false)
    private LoginMapper loginMapper;

    /**
     * 用户登录
     * @param user 用户
     */
    public void userLogin(User user) {
        String email = user.getEmail();
        String password = user.getPassword();
        if (email.isEmpty() || password.isEmpty()) {
            //账号密码为空
            throw new InputAccountAndPassword(MessageConstant.ACCOUNT_PASSWORD_EMPTY);
        }
        //账号密码不为空
        else {
            //验证账号
            int i = loginMapper.userExist(email);
            //账号存在
            if (i &gt; 0) {
                //验证密码
                int p = loginMapper.loginCheck(email, password);
                //密码正确
                if (p == 1) {
                    //准许登录 state==1
                    loginMapper.login(email);
                }
                else {
                    //密码错误
                    throw new PasswordErrorException(MessageConstant.PASSWORD_ERROR);
                }
            }
            //账号不存在
            else {
                throw new AccountNotFoundException(MessageConstant.ACCOUNT_NOT_FOUND);
            }
        }
    }
}
</code></pre> 
<p>异常提示常量类MessageConstant：</p> 
<pre><code class="language-javascript">/**
 * 信息提示常量类
 */
public class MessageConstant {
    public static final String PASSWORD_ERROR = "密码错误";
    public static final String ACCOUNT_NOT_FOUND = "账号不存在";
    public static final String LOGIN_FAILED = "登录失败";
    public static final String ACCOUNT_PASSWORD_EMPTY="请输入账号和密码";
}</code></pre> 
<p>控制端：</p> 
<pre><code class="language-javascript">@RestController
@RequestMapping("/login")
@Slf4j
public class LoginController {
    @Autowired(required = false)
    private LoginService loginService;
    @Autowired
    private JwtProperties jwtProperties;
    @PostMapping("/userlogin")
    public Result login(@RequestBody User user){
        log.info("开始登录：email:{},password:{}",user.getEmail(),user.getPassword());
        log.info("{}",user);
        loginService.userLogin(user);
        //登录成功后，生成jwt令牌
        Map&lt;String, Object&gt;claims=new HashMap&lt;&gt;();
        claims.put("userId",1L);
        claims.put("email",user.getEmail());
        String token= JwtUtil.createJWT(
                jwtProperties.getUserSecretKey(),
                jwtProperties.getUserTtl(),
                claims);
        UserDTO userDTO = new UserDTO();
        userDTO.setToken(token);
        log.info("生成的token是：{}",token);
        return Result.success(userDTO);
    }
}</code></pre> 
<p>前端登录页面以及ajax的测试用例：</p> 
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="en" xmlns:th="http://www.thymeleaf.org"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;欢迎登录公司员工考勤管理平台&lt;/title&gt;
    &lt;link rel="shortcut icon" th:href="@{/images/icon.svg}"&gt;
    &lt;link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap.css}"&gt;
    &lt;script th:src="@{/js/jquery-3.2.1.js}"&gt;&lt;/script&gt;
    &lt;script th:src="@{/js/token.js}"&gt;&lt;/script&gt;
    &lt;script type="text/javascript"&gt;
        $(function () {
            let token=null;
            //登录按钮
            $("#login").click(function () {
                let email=$('#email').val();
                let password=$('#password').val();
                $.ajax({
                    type:"post",
                    url:"/login/userlogin",
                    contentType:"application/json",
                    data:JSON.stringify({"email":email,"password":password}),
                    success:function (result) {
                        if (result.code===1){
                             token=result.data.token;
                            alert("登录成功");
                        //    收到Token，开始存储token
                            localStorage.setItem('token',token);
                            alert("token值为:"+token+"!");
                            //返回Token给后端
                            //返回后端
                            location.href="/main";//也会经过拦截器
                        }else {
                            alert(result.msg);
                        }
                    }
                });
            });

         $("#registry").click(function () {
             location.href="/registry"
         })
        })
    &lt;/script&gt;
&lt;/head&gt;
&lt;body style="position: absolute;
  top: 20%;
  left: 38%;
  transform: translate(40%,40%);
  margin: 0;padding: 0"&gt;
&lt;div&gt;
    &lt;h2&gt;登录页面&lt;/h2&gt;
&lt;/div&gt;
&lt;div&gt;
    &lt;label for="email"&gt;&lt;/label&gt;&lt;input type="text" id="email" name="email" placeholder="E-mail address"&gt;
&lt;/div&gt;
&lt;div&gt;
    &lt;label for="password"&gt;&lt;/label&gt;&lt;input type="password" id="password" name="password" placeholder="Password"/&gt;
&lt;/div&gt;
&lt;button id="login"&gt;登录&lt;/button&gt;
&lt;button id="registry"&gt;注册&lt;/button&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre> 
<p>测试：</p> 
<p>账号密码不为空：</p> 
<p><img alt="" height="494" src="https://images2.imgbox.com/aa/02/DpHYOmlU_o.png" width="603"></p> 
<p>后台：</p> 
<p><img alt="" height="135" src="https://images2.imgbox.com/6f/32/pakXCdg4_o.png" width="1200"></p> 
<p></p> 
<p>账号不存在：</p> 
<p><img alt="" height="491" src="https://images2.imgbox.com/f7/b7/m4ZpLBjl_o.png" width="544"></p> 
<p>后台：</p> 
<p><img alt="" height="247" src="https://images2.imgbox.com/00/8a/UN6wlgfj_o.png" width="1200"></p> 
<p></p> 
<p>密码错误：</p> 
<p><img alt="" height="456" src="https://images2.imgbox.com/58/c4/mNhnGuek_o.png" width="539"></p> 
<p>后台：</p> 
<p><img alt="" height="297" src="https://images2.imgbox.com/09/be/2muTInhP_o.png" width="1200"></p> 
<p>还有很多其他的情况......</p> 
<p>Tips：其实有些情况可以直接在前端判断，没有必要全部都给到后台判断，这样会造成后台压力比较大；比如密码账号不为空，账号格式等等。</p> 
<p>本期内容到这，如果帮到你了，或者你学到了新知识点，可以点赞收藏关注走一波，支持作者！作者后续会更新发布更多更加高质量的文章！谢谢！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/87405e9647061018ab5243a39bde8a6a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">《无所不能的JavaScript · prototype 原型链》</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/666979c82e8d6472d12c3492119d10c4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Kafka发送对象消息</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>