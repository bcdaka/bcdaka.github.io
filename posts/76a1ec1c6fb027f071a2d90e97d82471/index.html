<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Xcode 15.0 新 #Preview 预览让 SwiftUI 界面调试更加悠然自得 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/76a1ec1c6fb027f071a2d90e97d82471/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Xcode 15.0 新 #Preview 预览让 SwiftUI 界面调试更加悠然自得">
  <meta property="og:description" content="概览 从 Xcode 15 开始，苹果推出了新的 #Preview 宏预览机制，它无论从语法还是灵活性上都远远超过之前的预览方式。#Preview 不但可以实时预览 SwiftUI 视图，而且对 UIKit 的界面预览也是信手拈来。
想学习新 #Preview 预览的一些超实用调试小妙招吗？那就“如意如意”随小伙伴们的心意吧！
在本篇博文中，您将学到如下内容： 概览1. Xcode 15.0 新预览机制简介2. #Preview 让状态初始化如此轻松！3. 为什么 #Preview 中不能直接嵌入可变状态？4 #Preview &#43; @Observable 宏构造可变 @Binding 实参总结 相信学完本课后，大家对于 Xcode 15&#43; 预览的使用以及 SwiftUI 界面调试会更加的轻车熟路！
那还等什么呢？让我们马上开始吧！Let‘s preview！！！😉
本文对应的视频课在此，欢迎恣意观赏 😃
Xcode 15.0新 #Preview 预览让调试悠然自得
1. Xcode 15.0 新预览机制简介 从 Xcode 15 开始，苹果借助于 Swift 5.9 宏（Macro）的“东风”，也为我们带来了全新的 #Preview 预览机制。你猜的没错，它其实就是一个宏：
如上所示：我们将 #Preview 宏定义展开为了其原始代码的实现，大家可以清楚的看到 #Preview 宏背地里到底做了些神马。
在 Xcode 15 之前，小伙伴们需要使用遵循 PreviewProvider 协议的 Previews 结构来帮助我们预览指定的 SwiftUI 视图：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-13T19:06:37+08:00">
    <meta property="article:modified_time" content="2024-04-13T19:06:37+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Xcode 15.0 新 #Preview 预览让 SwiftUI 界面调试更加悠然自得</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/02/c9/dCyMBBEZ_o.jpg" alt="在这里插入图片描述"></p> 
<h2><a id="_2"></a>概览</h2> 
<p>从 Xcode 15 开始，苹果推出了新的 #Preview 宏预览机制，它无论从语法还是灵活性上都远远超过之前的预览方式。#Preview 不但可以实时预览 SwiftUI 视图，而且对 UIKit 的界面预览也是信手拈来。</p> 
<p><img src="https://images2.imgbox.com/07/b8/VLeFKyiR_o.gif" alt="在这里插入图片描述"></p> 
<p>想学习新 #Preview 预览的一些超实用调试小妙招吗？那就“如意如意”随小伙伴们的心意吧！<br> </p> 
<div class="toc"> 
 <h4>在本篇博文中，您将学到如下内容：</h4> 
 <ul><li><a href="#_2" rel="nofollow">概览</a></li><li><a href="#1_Xcode_150__22" rel="nofollow">1. Xcode 15.0 新预览机制简介</a></li><li><a href="#2_Preview__56" rel="nofollow">2. #Preview 让状态初始化如此轻松！</a></li><li><a href="#3__Preview__107" rel="nofollow">3. 为什么 #Preview 中不能直接嵌入可变状态？</a></li><li><a href="#4_Preview__Observable__Binding__150" rel="nofollow">4 #Preview + @Observable 宏构造可变 @Binding 实参</a></li><li><a href="#_200" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<p>相信学完本课后，大家对于 Xcode 15+ 预览的使用以及 SwiftUI 界面调试会更加的轻车熟路！</p> 
<p>那还等什么呢？让我们马上开始吧！Let‘s preview！！！😉</p> 
<hr> 
<p>本文对应的视频课在此，欢迎恣意观赏 😃</p> 
<p></p> 
<div class="csdn-video-box"> 
 <iframe id="fGWyhrED-1713006345237" frameborder="0" src="https://live.csdn.net/v/embed/378589" allowfullscreen="true" data-mediaembed="csdn"></iframe> 
 <p>Xcode 15.0新 #Preview 预览让调试悠然自得</p> 
</div> 
<p></p> 
<h2><a id="1_Xcode_150__22"></a>1. Xcode 15.0 新预览机制简介</h2> 
<p>从 Xcode 15 开始，苹果借助于 Swift 5.9 宏（Macro）的“东风”，也为我们带来了全新的 #Preview 预览机制。你猜的没错，它其实就是一个宏：</p> 
<p><img src="https://images2.imgbox.com/36/1e/yZtmmbGA_o.gif" alt="在这里插入图片描述"></p> 
<p>如上所示：我们将 #Preview 宏定义展开为了其原始代码的实现，大家可以清楚的看到 #Preview 宏背地里到底做了些神马。</p> 
<p>在 Xcode 15 之前，小伙伴们需要使用遵循 PreviewProvider 协议的 Previews 结构来帮助我们预览指定的 SwiftUI 视图：</p> 
<pre><code class="prism language-swift"><span class="token keyword">struct</span> <span class="token class-name">LaunchView_Previews</span><span class="token punctuation">:</span> <span class="token class-name">PreviewProvider</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">LaunchView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">environmentObject</span><span class="token punctuation">(</span><span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>而现在，只需一个 #Preview 即可搞定所有，岂不呜呼快哉：</p> 
<pre><code class="prism language-swift"><span class="token other-directive property">#Preview</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">LaunchView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">environmentObject</span><span class="token punctuation">(</span><span class="token class-name">Model</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>为了方便起见，我们还可以非常 nice 的将多个定制的 #Preview 预览内容混合在一起显示：</p> 
<p><img src="https://images2.imgbox.com/67/e2/tQGUa1On_o.gif" alt="在这里插入图片描述"></p> 
<p>如上所示，为了便于观察我们在 #Preview 中指定了不同预览名称以及预览设备的方向和明暗主题等特性，简直小菜一碟。</p> 
<h2><a id="2_Preview__56"></a>2. #Preview 让状态初始化如此轻松！</h2> 
<p>“理想很骨感，现实却很残酷”。</p> 
<p>在实际开发中，不可能所有视图都如此简单。在现实的 App 中视图多半都会与模型（数据）相绑定，这意味着我们在预览它们之前需要创建对应的数据，否则预览就不会达到预期效果，显示将是一片“空空如也”。</p> 
<p>比如在 SwiftUI 里我们有一个分类选择视图（V2_ChallengeClassSelectView），所有内置（Built in）的分类都是从数据库中读取的，但前提是我们在数据库中已经初始化了这些分类，这是通过调用如下方法来完成的：</p> 
<pre><code class="prism language-swift"><span class="token class-name">V2_ChallengeClassification</span><span class="token punctuation">.</span><span class="token function">initializeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>所以，我们可能会写出下面的代码以期待 #Preview 预览可以正常工作：</p> 
<pre><code class="prism language-swift"><span class="token attribute atrule">@available</span><span class="token punctuation">(</span>iOS <span class="token number">17.0</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token other-directive property">#Preview</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">V2_ChallengeClassSelectView</span><span class="token punctuation">(</span>selecting<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token nil constant">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>onAppear <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">V2_ChallengeClassification</span><span class="token punctuation">.</span><span class="token function">initializeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>不过可惜的是，以上实现无法得偿所愿。原因是我们 V2_ChallengeClassSelectView 视图中的分类数据必须在其 body 显示之前就准备就绪：</p> 
<pre><code class="prism language-swift"><span class="token attribute atrule">@available</span><span class="token punctuation">(</span>iOS <span class="token number">17.0</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token keyword">struct</span> <span class="token class-name">V2_ChallengeClassSelectView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token attribute atrule">@Binding</span> <span class="token keyword">var</span> selecting<span class="token punctuation">:</span> <span class="token class-name">V2_ChallengeClassification</span><span class="token operator">?</span>
    
    <span class="token keyword">let</span> builtInClasses <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">V2_ChallengeClassification</span><span class="token punctuation">.</span><span class="token function">allBuiltInClassifications</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>对于这种情况，#Preview 宏有一个非常简单的解决方案：我们只需在预览内容之前直接调用初始化代码即可：</p> 
<pre><code class="prism language-swift"><span class="token attribute atrule">@available</span><span class="token punctuation">(</span>iOS <span class="token number">17.0</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token other-directive property">#Preview</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">V2_ChallengeClassification</span><span class="token punctuation">.</span><span class="token function">initializeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token class-name">V2_ChallengeClassSelectView</span><span class="token punctuation">(</span>selecting<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token nil constant">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行可以看到，我们已经能够在预览中正确显示初始化之后的所有内置分类了：</p> 
<p><img src="https://images2.imgbox.com/6f/6b/EHcJy4OQ_o.gif" alt="在这里插入图片描述"></p> 
<h2><a id="3__Preview__107"></a>3. 为什么 #Preview 中不能直接嵌入可变状态？</h2> 
<p>大家可能已经发现了，上面示例中的 V2_ChallengeClassSelectView 视图包含一个 selecting 绑定状态：</p> 
<pre><code class="prism language-swift"><span class="token keyword">struct</span> <span class="token class-name">V2_ChallengeClassSelectView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{<!-- --></span>   
    <span class="token attribute atrule">@Binding</span> <span class="token keyword">var</span> selecting<span class="token punctuation">:</span> <span class="token class-name">V2_ChallengeClassification</span><span class="token operator">?</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>但在我们的预览中，为了“偷懒”实际向其传入的是一个绑定常量：</p> 
<pre><code class="prism language-swift"><span class="token class-name">V2_ChallengeClassSelectView</span><span class="token punctuation">(</span>selecting<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token nil constant">nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>这样做的后果是：我们无法在预览中改变 selecting 属性的值，也就无法观察到视图中选择所产生的变化了。</p> 
<p>小伙伴们可能会觉得，下面的实现可以帮我们摆脱这一问题：</p> 
<pre><code class="prism language-swift"><span class="token attribute atrule">@available</span><span class="token punctuation">(</span>iOS <span class="token number">17.0</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token other-directive property">#Preview</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token attribute atrule">@State</span> <span class="token keyword">var</span> selecting<span class="token punctuation">:</span> <span class="token class-name">V2_ChallengeClassification</span><span class="token operator">?</span>
    
    <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">V2_ChallengeClassification</span><span class="token punctuation">.</span><span class="token function">initializeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token class-name">V2_ChallengeClassSelectView</span><span class="token punctuation">(</span>selecting<span class="token punctuation">:</span> $selecting<span class="token punctuation">)</span>
       
<span class="token punctuation">}</span>
</code></pre> 
<p>遗憾的是这样做“然并卵”，毫无用处：</p> 
<p><img src="https://images2.imgbox.com/93/e6/kmn7pJYR_o.gif" alt="在这里插入图片描述"></p> 
<p>其原因是：与 Xcode 15 之前的旧预览机制类似，嵌入在预览结构中的简单状态实际上是无法被改变的，即使它被 @State 等（可变）限定符所修饰时也是如此。</p> 
<p>那么我们如何解决呢？</p> 
<p>答案很简单：<strong>将可变状态放到 #Preview 外面去！</strong></p> 
<h2><a id="4_Preview__Observable__Binding__150"></a>4 #Preview + @Observable 宏构造可变 @Binding 实参</h2> 
<p>从 Xcode 15 （Swift 5.9）开始，苹果推出了新的 @Observable 宏帮我们便捷的创建可观察对象。</p> 
<hr> 
<p>更多关于 @Observable 宏以及 Observation 框架的详细介绍，小伙伴们可以移步到下面的博文中进一步观赏：</p> 
<ul><li><a href="https://kinds.blog.csdn.net/article/details/133543655" rel="nofollow">Swift 5.9 与 SwiftUI 5.0 中新 Observation 框架应用之深入浅出</a></li><li><a href="https://kinds.blog.csdn.net/article/details/136146131" rel="nofollow">Swift 5.9 新 @Observable 对象在 SwiftUI 使用中的陷阱与解决</a></li></ul> 
<hr> 
<p>简单来说，我们可以在 #Preview 之外利用 @Observable 宏包裹我们的可变状态，从而可以将其通过绑定传入到对应的视图中去：</p> 
<pre><code class="prism language-swift"><span class="token attribute atrule">@available</span><span class="token punctuation">(</span>iOS <span class="token number">17.0</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token attribute atrule">@Observable</span>
<span class="token keyword">class</span> <span class="token class-name">PreviewModel</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> selecting<span class="token punctuation">:</span> <span class="token class-name">V2_ChallengeClassification</span><span class="token operator">?</span>
<span class="token punctuation">}</span>

<span class="token attribute atrule">@available</span><span class="token punctuation">(</span>iOS <span class="token number">17.0</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token other-directive property">#Preview</span> <span class="token punctuation">{<!-- --></span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">var</span> model <span class="token operator">=</span> <span class="token class-name">PreviewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">V2_ChallengeClassification</span><span class="token punctuation">.</span><span class="token function">initializeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token class-name">V2_ChallengeClassSelectView</span><span class="token punctuation">(</span>selecting<span class="token punctuation">:</span> $model<span class="token punctuation">.</span>selecting<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>注意，在上面的代码示例中我们实际向 V2_ChallengeClassSelectView 视图传递的绑定是 @Observable 可观察对象 model 中的属性。虽然 model 作为 @State 放在了预览内部，不过由于它是一个可观察对象，所以它仍然可以变化自如。</p> 
<p>编译运行修改后的代码，我们现在可以在 #Preview 预览界面中顺畅自如的测试 selecting 分类属性改变时的显示逻辑了：</p> 
<p><img src="https://images2.imgbox.com/3d/98/yGmgGFaj_o.gif" alt="在这里插入图片描述"></p> 
<p>至此，我们通过上面几个小“栗子”对 Xcode 15 中新的 #Preview 预览机制又有了更深刻的领悟，小伙伴们还不赶快给自己点一个大大的赞吧！👍🏻</p> 
<hr> 
<p>想要系统学习 Swift 语言的小伙伴们，千万不要错过我的《Swift 语言开发精讲》专栏哦：</p> 
<p><img src="https://images2.imgbox.com/40/91/247MyHol_o.png" alt="在这里插入图片描述"></p> 
<ul><li><a href="https://blog.csdn.net/mydo/category_408030.html?spm=1001.2014.3001.5482">Swift 语言开发精讲</a></li></ul> 
<hr> 
<h2><a id="_200"></a>总结</h2> 
<p>在本篇博文中，我们介绍了 Xcode 15+ 中新的 #Preview 预览机制，并讨论了如何利用 #Preview + @Observable 宏让 SwiftUI 界面调试更加“如虎添翼”。</p> 
<p>感谢观赏，再会啦！😎</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4bd829925db99310e181e4ce552cfd75/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【WebSocket连接异常】前端使用WebSocket子协议传递token时，Java后端的正确打开方式！！！</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f884457c2c1ea88f9aac0db0cb7d8a29/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据可视化插件echarts【前端】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>