<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【JavaEE进阶】——利用框架完成功能全面的图书管理系统 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/a2ec03cc9c65e5abcb0812f79c3e9dc2/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【JavaEE进阶】——利用框架完成功能全面的图书管理系统">
  <meta property="og:description" content="目录
🚩项目所需要的技术栈
🚩项目准备工作
🎈环境准备
🎈数据库准备
🚩前后端交互分析
🎈登录
📝前后端交互
📝实现服务器代码
📝测试前后端代码是否正确
🎈添加图书
📝前后端交互
📝实现服务器代码
📝测试前后端代码是否正确
🎈图书列表
📝前后端交互
📝实现服务器代码
📝测试前后端代码是否正确
🎈修改图书
📝前后端交互
📝实现服务器代码 📝测试前后端代码是否正确
🎈删除图书
📝约定前后端交互接⼝
📝实现服务器代码 📝测试前后端代码是否正确
🎈批量删除图书
📝约定前后端交互接⼝
📝实现服务器代码 📝测试前后端代码是否正确
🚩项目所需要的技术栈 该项目是一个针对于SpringBoot&#43;Mybatis&#43;SpringMVC的基础运用项目适合初学者来检验水平测试能力，该项目所需技术栈如下：
&gt;* SpringBoot：作为项目的框架，使用Maven托管代码
&gt;* Mybatis：使用Mybatis框架操纵数据库，其中使用了xml和注解两种方式去操作数据库
&gt;* 前端ajax：前后端的交互使用的是ajax作为前端为后端发送数据以及接收数据
&gt;* 项目分层：项目分为前端页面&#43;control（与前端建立连接的控制层）&#43;Service(服务层供control层进行调用)&#43;Mapper（操纵数据库实现数据与后端代码的 交互）&#43;model(需要实现的主类)。
🚩项目准备工作 🎈环境准备 项目的创建需要选好项目名，项目路径，语言为java，type是基于maven构建，jdk可以选择17以上的(切记最好不要用jdk8)，packing是打成jar包。
此时项目创建成功。MySQL Driver和MyBatis Framework引⼊MyBatis 和 MySQL驱动依赖
也可以手动引入依赖，上面只是更简单。
这是围绕整个项目的配置文件，没有该配置文件，是无法运行成功的，没有它们你就完成不了一个项目。我们依赖该pom.xml文件，让我们能完成该项目。
SpringBookt配置文件,统一使用yml格式 application.yml
很多项⽬或者框架的配置信息也放在配置⽂件中, ⽐如: • 项⽬的启动端⼝ • 数据库的连接信息(包含⽤⼾名和密码的设置) • ⽤于发现和定位问题的普通⽇志和异常⽇志等 server: port: 8080 #配置数据库 spring: datasource: url: jdbc:mysql://127.0.0.1:3306/book_system?characterEncoding=utf8&amp;useSSL=false username: root password: driver-class-name: com.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-12T18:08:08+08:00">
    <meta property="article:modified_time" content="2024-06-12T18:08:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【JavaEE进阶】——利用框架完成功能全面的图书管理系统</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%F0%9F%9A%A9%E9%A1%B9%E7%9B%AE%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84%E6%8A%80%E6%9C%AF%E6%A0%88-toc" style="margin-left:0px;"><a href="#%F0%9F%9A%A9%E9%A1%B9%E7%9B%AE%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84%E6%8A%80%E6%9C%AF%E6%A0%88" rel="nofollow">🚩项目所需要的技术栈</a></p> 
<p id="%F0%9F%9A%A9%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C-toc" style="margin-left:0px;"><a href="#%F0%9F%9A%A9%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C" rel="nofollow">🚩项目准备工作</a></p> 
<p id="%F0%9F%8E%88%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-toc" style="margin-left:40px;"><a href="#%F0%9F%8E%88%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87" rel="nofollow">🎈环境准备</a></p> 
<p id="%F0%9F%8E%88%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%86%E5%A4%87-toc" style="margin-left:40px;"><a href="#%F0%9F%8E%88%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%86%E5%A4%87" rel="nofollow">🎈数据库准备</a></p> 
<p id="%F0%9F%9A%A9%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92%E5%88%86%E6%9E%90-toc" style="margin-left:0px;"><a href="#%F0%9F%9A%A9%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92%E5%88%86%E6%9E%90" rel="nofollow">🚩前后端交互分析</a></p> 
<p id="%F0%9F%8E%88%E7%99%BB%E5%BD%95-toc" style="margin-left:40px;"><a href="#%F0%9F%8E%88%E7%99%BB%E5%BD%95" rel="nofollow">🎈登录</a></p> 
<p id="%F0%9F%93%9D%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92" rel="nofollow">📝前后端交互</a></p> 
<p id="%F0%9F%93%9D%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81" rel="nofollow">📝实现服务器代码</a></p> 
<p id="%F0%9F%93%9D%E6%B5%8B%E8%AF%95%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E6%B5%8B%E8%AF%95%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE" rel="nofollow">📝测试前后端代码是否正确</a></p> 
<p id="%F0%9F%8E%88%E6%B7%BB%E5%8A%A0%E5%9B%BE%E4%B9%A6-toc" style="margin-left:40px;"><a href="#%F0%9F%8E%88%E6%B7%BB%E5%8A%A0%E5%9B%BE%E4%B9%A6" rel="nofollow">🎈添加图书</a></p> 
<p id="%F0%9F%93%9D%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92" rel="nofollow">📝前后端交互</a></p> 
<p id="%F0%9F%93%9D%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81" rel="nofollow">📝实现服务器代码</a></p> 
<p id="%F0%9F%93%9D%E6%B5%8B%E8%AF%95%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E6%B5%8B%E8%AF%95%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE" rel="nofollow">📝测试前后端代码是否正确</a></p> 
<p id="%F0%9F%8E%88%E5%9B%BE%E4%B9%A6%E5%88%97%E8%A1%A8-toc" style="margin-left:40px;"><a href="#%F0%9F%8E%88%E5%9B%BE%E4%B9%A6%E5%88%97%E8%A1%A8" rel="nofollow">🎈图书列表</a></p> 
<p id="%F0%9F%93%9D%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92" rel="nofollow">📝前后端交互</a></p> 
<p id="%F0%9F%93%9D%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81" rel="nofollow">📝实现服务器代码</a></p> 
<p id="%F0%9F%93%9D%E6%B5%8B%E8%AF%95%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E6%B5%8B%E8%AF%95%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE" rel="nofollow">📝测试前后端代码是否正确</a></p> 
<p id="%F0%9F%8E%88%E4%BF%AE%E6%94%B9%E5%9B%BE%E4%B9%A6-toc" style="margin-left:40px;"><a href="#%F0%9F%8E%88%E4%BF%AE%E6%94%B9%E5%9B%BE%E4%B9%A6" rel="nofollow">🎈修改图书</a></p> 
<p id="%F0%9F%93%9D%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92" rel="nofollow">📝前后端交互</a></p> 
<p id="%F0%9F%93%9D%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81%C2%A0-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81%C2%A0" rel="nofollow">📝实现服务器代码 </a></p> 
<p id="%F0%9F%93%9D%E6%B5%8B%E8%AF%95%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E6%B5%8B%E8%AF%95%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE" rel="nofollow">📝测试前后端代码是否正确</a></p> 
<p id="%F0%9F%8E%88%E5%88%A0%E9%99%A4%E5%9B%BE%E4%B9%A6-toc" style="margin-left:40px;"><a href="#%F0%9F%8E%88%E5%88%A0%E9%99%A4%E5%9B%BE%E4%B9%A6" rel="nofollow">🎈删除图书</a></p> 
<p id="%F0%9F%93%9D%E7%BA%A6%E5%AE%9A%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92%E6%8E%A5%E2%BC%9D-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E7%BA%A6%E5%AE%9A%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92%E6%8E%A5%E2%BC%9D" rel="nofollow">📝约定前后端交互接⼝</a></p> 
<p id="%F0%9F%93%9D%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81%C2%A0-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81%C2%A0" rel="nofollow">📝实现服务器代码 </a></p> 
<p id="%F0%9F%93%9D%E6%B5%8B%E8%AF%95%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E6%B5%8B%E8%AF%95%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE" rel="nofollow">📝测试前后端代码是否正确</a></p> 
<p id="%F0%9F%8E%88%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E5%9B%BE%E4%B9%A6-toc" style="margin-left:40px;"><a href="#%F0%9F%8E%88%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E5%9B%BE%E4%B9%A6" rel="nofollow">🎈批量删除图书</a></p> 
<p id="%F0%9F%93%9D%E7%BA%A6%E5%AE%9A%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92%E6%8E%A5%E2%BC%9D-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E7%BA%A6%E5%AE%9A%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92%E6%8E%A5%E2%BC%9D" rel="nofollow">📝约定前后端交互接⼝</a></p> 
<p id="%F0%9F%93%9D%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81%C2%A0-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81%C2%A0" rel="nofollow">📝实现服务器代码 </a></p> 
<p id="%F0%9F%93%9D%E6%B5%8B%E8%AF%95%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE-toc" style="margin-left:80px;"><a href="#%F0%9F%93%9D%E6%B5%8B%E8%AF%95%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE" rel="nofollow">📝测试前后端代码是否正确</a></p> 
<hr> 
<h2 style="background-color:transparent;"><span style="color:#be191c;">🚩项目所需要的技术栈</span></h2> 
<blockquote> 
 <p> 该项目是一个针对于<span style="color:#1c7331;"><span style="background-color:#d4e9d5;">SpringBoot+Mybatis+SpringMVC</span></span>的基础运用项目适合初学者来检验水平测试能力，该项目所需技术栈如下：<br> &gt;<span style="color:#b95514;"><span style="background-color:#ffd7b9;">* SpringBoot</span></span>：作为项目的框架，使用Maven托管代码<br> &gt;<span style="color:#b95514;"><span style="background-color:#ffd7b9;">* Mybatis</span></span>：使用Mybatis框架操纵数据库，其中使用了xml和注解两种方式去操作数据库<br> &gt;<span style="color:#b95514;"><span style="background-color:#ffd7b9;">* 前端ajax</span></span>：前后端的交互使用的是ajax作为前端为后端发送数据以及接收数据<br> &gt;<span style="color:#b95514;"><span style="background-color:#ffd7b9;">* 项目分层</span></span>：项目分为前端页面+control（与前端建立连接的控制层）+Service(服务层供control层进行调用)+Mapper（操纵数据库实现数据与后端代码的 交互）+model(需要实现的主类)。</p> 
</blockquote> 
<hr> 
<h2 id="%F0%9F%9A%A9%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span style="color:#be191c;">🚩项目准备工作</span></h2> 
<h3 id="%F0%9F%8E%88%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span style="color:#1c7331;">🎈环境准备</span></h3> 
<p><span style="color:#0d0016;">项目的创建需要选好项目名，项目路径，语言为java，type是基于maven构建，jdk可以选择17以上的(切记最好不要用jdk8)，packing是打成jar包。</span></p> 
<p><img alt="" height="952" src="https://images2.imgbox.com/48/d9/2nr1STf1_o.png" width="1182"></p> 
<h3 id="%E2%80%8B%E7%BC%96%E8%BE%91"><img alt="" height="958" src="https://images2.imgbox.com/3e/b8/XsAOBq7M_o.png" width="1182"></h3> 
<p>此时项目创建成功。MySQL Driver和MyBatis Framework<span style="color:#1f2329;">引⼊MyBatis 和 MySQL驱动依赖</span></p> 
<p><img alt="" height="574" src="https://images2.imgbox.com/bf/4f/cMreVzCy_o.png" width="989"></p> 
<p>也可以手动引入依赖，上面只是更简单。</p> 
<p><img alt="" height="364" src="https://images2.imgbox.com/6d/c9/4jG2vkbm_o.png" width="356">这是围绕整个项目的配置文件，没有该配置文件，是无法运行成功的，没有它们你就完成不了一个项目。我们依赖该pom.xml文件，让我们能完成该项目。</p> 
<hr> 
<p><span style="color:#511b78;"><strong>SpringBookt配置文件,统一使用yml格式 application.yml</strong></span></p> 
<blockquote> 
 <div> 
  <span style="color:#1f2329;">很多项⽬或者框架的配置信息也放在配置⽂件中, ⽐如: </span> 
 </div> 
 <ul><li><span style="color:#1456f0;">• </span><span style="color:#1f2329;">项⽬的启动端⼝ </span></li><li><span style="color:#1456f0;">• </span><span style="color:#1f2329;">数据库的连接信息(包含⽤⼾名和密码的设置) </span></li><li><span style="color:#1456f0;">• </span><span style="color:#1f2329;">⽤于发现和定位问题的普通⽇志和异常⽇志等</span></li></ul> 
</blockquote> 
<div> 
 <pre><code>server:
  port: 8080
#配置数据库
spring:
  datasource:
    url: jdbc:mysql://127.0.0.1:3306/book_system?characterEncoding=utf8&amp;useSSL=false
    username: root
    password: 
    driver-class-name: com.mysql.cj.jdbc.Driver
mybatis:
  configuration:
    #配置驼峰自动转换
    map-underscore-to-camel-case: true
    #sql日志(打印出来让我们可以清楚自己的sql语句是否正确)
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    #Spring Boot可以正确找到并加载位于 classpath:mapper/目录下的 xxxxMapper XML 文件，
    #从而在应用程序中使用这些 Mapper 进行数据库操作。(因为有时候sql语句需要动态）
  mapper-locations: classpath:mapper/BookMapper.xml
#将日志记录到一个文件可以通过在配置文件中指定日志文件的位置和名称来实现。
logging:
  file:
    name: spring-book.log
</code></pre> 
 <p><img alt="" height="900" src="https://images2.imgbox.com/ff/d3/eI4lxVEy_o.png" width="1200"></p> 
</div> 
<div> 
 <hr> 
 <h3 id="%F0%9F%8E%88%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%86%E5%A4%87"><span style="color:#1c7331;">🎈数据库准备</span></h3> 
</div> 
<blockquote> 
 <ul><li>数据库表的设计是应用程序开发的一个重要的环节。设计数据库表是根据业务需求相关的。</li><li>数据库表通常分成两种：实体表和关系表，就如图书管理系统来说，图书馆里系统相对是简单的，只有<strong>两个实体：用户和图书，并且用户和图书之间没有关联关系。</strong></li><li>表的具体字段设计，也与需求相关。</li></ul> 
 <p><span style="color:#0d0016;">           <strong>⽤⼾表：</strong>有⽤⼾名和密码即可(复杂的业务可能还涉及昵称, 年龄等资料) </span></p> 
 <p><span style="color:#1f2329;">           <strong>图书表：</strong>有哪些字段, 也是参考需求⻚⾯(通常不是⼀个⻚⾯决定的, ⽽是要对整个                    系统进⾏全⾯分析观察后定的)</span></p> 
 <ul><li> 
   <div> 
    <ul><li></ul> 
   </div> </li></ul> 
</blockquote> 
<hr> 
<p><span style="color:#511b78;"><strong>创建数据库book_system  用户表user_info  图书表 book_info</strong></span></p> 
<pre><code>DROP DATABASE IF EXISTS book_system;
CREATE DATABASE book_system DEFAULT CHARACTER SET utf8mb4;
use book_system;

-- ⽤⼾表
DROP TABLE IF EXISTS user_info;
CREATE TABLE user_info (
 `id` INT NOT NULL AUTO_INCREMENT,
 `user_name` VARCHAR ( 128 ) NOT NULL,
 `password` VARCHAR ( 128 ) NOT NULL,
 `delete_flag` TINYINT ( 4 ) NULL DEFAULT 0,
 `create_time` DATETIME DEFAULT now(),
 `update_time` DATETIME DEFAULT now() ON UPDATE now(),
PRIMARY KEY ( `id` ),
UNIQUE INDEX `user_name_UNIQUE` ( `user_name` ASC )) ENGINE = INNODB DEFAULT
CHARACTER
SET = utf8mb4 COMMENT = '⽤⼾表';


-- 图书表
DROP TABLE IF EXISTS book_info;
CREATE TABLE `book_info` (
 `id` INT ( 11 ) NOT NULL AUTO_INCREMENT,
 `book_name` VARCHAR ( 127 ) NOT NULL,
 `author` VARCHAR ( 127 ) NOT NULL,
 `count` INT ( 11 ) NOT NULL,
 `price` DECIMAL (7,2 ) NOT NULL,
 `publish` VARCHAR ( 256 ) NOT NULL,
 `status` TINYINT ( 4 ) DEFAULT 1 COMMENT '0-⽆效, 1-正常, 2-不允许借阅',
 `create_time` DATETIME DEFAULT now(),
 `update_time` DATETIME DEFAULT now() ON UPDATE now(),
PRIMARY KEY ( `id` ) 
) ENGINE = INNODB DEFAULT CHARSET = utf8mb4;

--初始化数据
INSERT INTO user_info ( user_name, PASSWORD ) VALUES ( "admin", "admin" );
INSERT INTO user_info ( user_name, PASSWORD ) VALUES ( "zhangsan", "123456" );


INSERT INTO book_info (book_name, author, count, price, publish, status)
VALUES
('深入理解计算机系统', 'Randal E. Bryant', 18, 98.00, '机械工业出版社', 1),
('现代操作系统', 'Andrew S. Tanenbaum', 10, 89.00, '清华大学出版社', 1),
('计算机网络：自顶向下方法', 'James Kurose', 14, 85.00, '电子工业出版社', 1),
('数据库系统概念', 'Abraham Silberschatz', 7, 110.00, '机械工业出版社', 1),
('算法导论', 'Thomas H. Cormen', 5, 130.00, '机械工业出版社', 1),
('机器学习', '周志华', 20, 120.00, '清华大学出版社', 1),
('Python编程：从入门到实践', 'Eric Matthes', 25, 65.00, '电子工业出版社', 1),
('深度学习', 'Ian Goodfellow', 12, 180.00, '人民邮电出版社', 1),
('计算机图形学', 'John F. Hughes', 9, 95.00, '机械工业出版社', 1),
('操作系统真相还原', '史蒂文·穆查', 15, 80.00, '电子工业出版社', 1);
</code></pre> 
<div> 
 <span style="color:#511b78;"><strong> Model创建   BookInfo UserInfo</strong></span> 
</div> 
<pre><code>package com.example.cl.model;

import lombok.Data;

import java.math.BigDecimal;
import java.util.Date;

@Data
public class BookInfo {
    //图书ID
    private Integer id;
    //书名
    private String bookName;
    //作者
    private String author;
    //数量
    private Integer count;
    //定价
    private BigDecimal price;
    //出版社
    private String publish;
    //状态 0-⽆效 1-允许借阅 2-不允许借阅
    private Integer status;
    private String statusCN;
    //创建时间
    private Date createTime;
    //更新时间
    private Date updateTime;
}


package com.example.cl.model;

import lombok.Data;
import java.util.Date;
@Data
public class UserInfo {
    private Integer id;
    private String userName;
    private String password;
    private Integer deleteFlag;
    private Date createTime;
    private Date updateTime;
}</code></pre> 
<hr> 
<h2 id="%F0%9F%9A%A9%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92%E5%88%86%E6%9E%90"><span style="color:#be191c;">🚩前后端交互分析</span></h2> 
<h3 id="%F0%9F%8E%88%E7%99%BB%E5%BD%95"><span style="color:#511b78;">🎈登录</span></h3> 
<div> 
 <pre><code> &lt;div class="container-login"&gt;
        &lt;div class="container-pic"&gt;
            &lt;img src="pic/computer.png" width="350px"&gt;
        &lt;/div&gt;
        &lt;div class="login-dialog"&gt;
            &lt;h3&gt;登陆&lt;/h3&gt;
            &lt;div class="row"&gt;
                &lt;span&gt;用户名&lt;/span&gt;
                &lt;input type="text" name="userName" id="userName" class="form-control"&gt;
            &lt;/div&gt;
            &lt;div class="row"&gt;
                &lt;span&gt;密码&lt;/span&gt;
                &lt;input type="password" name="password" id="password" class="form-control"&gt;
            &lt;/div&gt;
            &lt;div class="row"&gt;
                &lt;button type="button" class="btn btn-info btn-lg" onclick="login()"&gt;登录&lt;/button&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;</code></pre> 
 <p>前端登录有两个表单，输入用户名和密码，表单中name属性是用于表单提交时用于标识表单数据的属性，服务器端通过‘name’属性来获取提交的数据。此时前端的id属性来获取客户端输入的用户名和密码给后端。</p> 
 <hr> 
 <h4 id="%F0%9F%93%9D%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92"><span style="color:#1a439c;">📝前后端交互</span></h4> 
 <pre><code>     function login() {
            // var userName=  $("#userName").val();
            // var password = $("#password").val()
            $.ajax({
                url: "/user/login",
                type: "post",
                data:{
                    userName: $("#userName").val(),
                    password: $("#password").val()
                }
        }</code></pre> 
 <blockquote> 
  <p><strong><span style="color:#1a439c;">前端发出请求：</span></strong></p> 
  <p>url：/user/login</p> 
  <p>type：post</p> 
  <p><strong><span style="color:#1a439c;">参数：</span></strong></p> 
  <p>data：userName=$("#userName").val()【admin】</p> 
  <p>           password=$("#password").val()【admin】</p> 
  <p><strong><span style="color:#1a439c;">响应：</span></strong></p> 
  <p>true （密码或者用户名正确，返回true）</p> 
  <pre><code>        function login() {
            // var userName=  $("#userName").val();
            // var password = $("#password").val()
            $.ajax({
                url: "/user/login",
                type: "post",
                data:{
                    userName: $("#userName").val(),
                    password: $("#password").val()
                },
                success:function(result){
                    if(result.code=="SUCCESS" &amp;&amp; result.data ==""){
                        //密码正确
                        location.href = "book_list.html?pageNum=1";
                    }else{
                        alert(result.errMsg);
                    }
                }
            });
        }</code></pre> 
  <p>因为登录页面基本上错误出现在用户名和密码上，如果用户名和密码出现问题，其实并没有必要返回error信息，如果服务器返回的结果码是“SUCCESS”和返回的结果数据是“”，那么就表明密码正确，否则就弹窗 结果的errMsg错误信息。</p> 
 </blockquote> 
 <hr> 
 <h4 id="%F0%9F%93%9D%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81"><span style="color:#1a439c;">📝实现服务器代码</span></h4> 
 <p><span style="color:#0d0016;">我们要知道三层架构，mapper——service——controller</span></p> 
 <blockquote> 
  <p>control（与前端建立连接的控制层）</p> 
  <p>Service(服务层供control层进行调用)</p> 
  <p>Mapper（操纵数据库实现数据与后端代码的 交互）</p> 
  <p>model(需要实现的主类)。</p> 
 </blockquote> 
</div> 
<div> 
 <hr> 
 <p>我们该如何实现服务器代码呢？首先，我们需要获取到delet_flag=0对应的userName因为，如果已经删除了，那么就也得返回null，如果没有找到服务器收到的userName那么返回null，如果找到了并且并没有删除该用户，那么就成功。</p> 
 <hr> 
 <p><span style="color:#b95514;">🎓数据层</span></p> 
</div> 
<div> 
 <pre><code>package com.example.cl.mapper;

import com.example.cl.model.UserInfo;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Select;

@Mapper
public interface UserInfoMapper {
    @Select("select * from user_info where delete_flag=0 and user_name=#{name}")
    UserInfo queryUserByName(String name);
}</code></pre> 
 <div> 
  <span style="color:#646a73;">访问数据库, 使⽤MyBatis来实现, 所以把之前dao路径下的⽂件可以删掉, ⽤mapper⽬录来代替, 创 </span> 
 </div> 
 <div> 
  <span style="color:#646a73;">建UserInfoMapper ，当然, 继续使⽤dao⽬录也可以,此处为建议 ，dao和mapper通常都被认为是数据库层 </span> 
 </div> 
 <hr> 
 <p><span style="color:#b95514;">🎓业务层</span></p> 
</div> 
<div> 
 <pre><code>package com.example.cl.service;

import com.example.cl.mapper.UserInfoMapper;
import com.example.cl.model.UserInfo;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class UserInfoService {
    @Autowired
    private UserInfoMapper userInfoMapper;
    public UserInfo queryUserByName(String userName){
        return userInfoMapper.queryUserByName(userName);
    }
}
</code></pre> 
 <p><span style="color:#b95514;">🎓控制层</span></p> 
</div> 
<div> 
 <img alt="" height="537" src="https://images2.imgbox.com/31/ca/KkUMo7O8_o.png" width="1200"> 
</div> 
<div></div> 
<div> 
 <img alt="" height="271" src="https://images2.imgbox.com/b6/4d/m0GkzkxY_o.png" width="753"> 
</div> 
<div>
  我们需要进行前后端交互 
</div> 
<div> 
 <span style="color:#1a439c;"><span style="background-color:#cbe0f1;">我们需要创建一个类Result，里面包含errMsg(显示什么导致错误的信息)，code(业务码), data(服务器返回给前端的数据)。</span></span> 
</div> 
<div> 
 <span style="color:#0d0016;">而code业务码，是需要通过键值对的形式创建，比如我们设定200标识succss，-1表示fail，-2表示未登录功能，我们需要创建一个一个枚举类。</span> 
</div> 
<div> 
 <span style="color:#1a439c;"><span style="background-color:#cbe0f1;">创建一个枚举类</span><span style="background-color:#cbe0f1;">StatusResult，枚举三种状态。</span></span> 
</div> 
<div></div> 
<div> 
 <span style="color:#1c7331;"><span style="background-color:#d4e9d5;">🍭Result类</span></span> 
</div> 
<div> 
 <pre><code>package com.example.cl.model;

import com.example.cl.enums.ResultStatus;
import lombok.Data;

@Data
public class Result&lt;T&gt; {
    private ResultStatus code; //业务码  不是Http状态码  200-成功  -2 失败  -1 未登录
    private String errMsg; //错误信息, 如果业务成功, errMsg为空
    private T data;
    public static &lt;T&gt; Result success(T data){
        Result result=new Result&lt;&gt;();
        result.setCode(ResultStatus.SUCCESS);
        result.setData(data);
        return  result;
    }
    public static Result fail(String msg){
        Result result=new Result&lt;&gt;();
        result.setCode(ResultStatus.Fail);
        result.setErrMsg(msg);
        return result;
    }
}</code></pre> 
 <div> 
  <span style="color:#1c7331;"><span style="background-color:#d4e9d5;">🍭StatusResult枚举类</span></span> 
 </div> 
 <div></div> 
 <div>
   枚举类不能使用@Data注解 
 </div> 
 <div> 
  <pre><code>package com.example.cl;

public enum StatusResult {
    SUCCESS(200),//成功返回200
    FAIL(-1),//错误返回-1
    NOLOGIN(-2)//未登录返回-2
    ;
    private int code;
    StatusResult(int code) {
        this.code=code;
    }

    public int getCode() {
        return code;
    }

    public void setCode(int code) {
        this.code = code;
    }
}
</code></pre> 
  <hr> 
  <p></p> 
 </div> 
</div> 
<div> 
 <pre><code>package com.example.cl.controller;

import com.example.cl.constant.constants;
import com.example.cl.model.Result;
import com.example.cl.model.UserInfo;
import com.example.cl.service.UserInfoService;
import jakarta.servlet.http.HttpSession;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.util.StringUtils;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping("/user")
public class UserInfoController {
    @Autowired
    private UserInfoService userInfoService;
    @RequestMapping(value = "/login",produces = "application/json")
    public Result login(String userName, String password, HttpSession session){
        //1.效验参数
        if(!StringUtils.hasLength(userName) || !StringUtils.hasLength(password)){
            //如果长度其中一个为空，
            return Result.fail("用户名或者密码为空");
        }
        //账号和密码是否正确
        //获取查找当前userName的用户所有信息
        UserInfo userInfo=userInfoService.queryUserByName(userName);
        if(userInfo==null){
            return Result.fail("用户不存在");
        }
        if(!password.equals(userInfo.getPassword())){
            return Result.fail("密码错误");
        }
        //3.正确情况
        session.setAttribute(constants.USER_SESSION_KEY,userInfo);
        return Result.success("");//成功返回空串
    }
}</code></pre> 
 <hr> 
 <h4 id="%F0%9F%93%9D%E6%B5%8B%E8%AF%95%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE"><span style="color:#1a439c;">📝测试前后端代码是否正确</span></h4> 
 <p>后端通过postman进行检查，最后返回的结果正确，说明后端代码是没有问题的， 如果后端代码有问题会返回505错误码。</p> 
 <p><img alt="" height="465" src="https://images2.imgbox.com/c6/fd/gQBhTyiv_o.png" width="1200"></p> 
 <p><img alt="" height="782" src="https://images2.imgbox.com/76/6a/NyoAFdXL_o.png" width="1200"></p> 
 <p>我们可以看到如果成功，errMsg为空，data返回给前端也是空，code是success</p> 
 <p><img alt="" height="209" src="https://images2.imgbox.com/30/71/8qEoZpcv_o.png" width="1200"></p> 
</div> 
<div> 
 <span style="color:#1a439c;">检查前端代码</span> 
</div> 
<div></div> 
<div> 
 <img alt="" height="940" src="https://images2.imgbox.com/95/d9/qdP3owAw_o.png" width="1200"> 
</div> 
<div> 
 <img alt="" height="751" src="https://images2.imgbox.com/d5/89/Ug0be6K4_o.png" width="1200"> 
</div> 
<div></div> 
<div> 
 <hr> 
 <h3 id="%F0%9F%8E%88%E6%B7%BB%E5%8A%A0%E5%9B%BE%E4%B9%A6"><span style="color:#be191c;">🎈添加图书</span></h3> 
 <h4><span style="color:#1a439c;">📝前后端交互</span></h4> 
 <p><img alt="" height="175" src="https://images2.imgbox.com/99/f6/tf9feX2u_o.png" width="657"></p> 
 <blockquote> 
  <p><span style="color:#1a439c;"><strong>前端发出请求：</strong></span></p> 
  <p>url：/book/addBook</p> 
  <p>type：post</p> 
  <p><span style="color:#1a439c;"><strong>参数：</strong></span></p> 
  <p>date：传给服务器的数据 ，用到的$("#addBook").serialize() 表示form表单中所有的数据</p> 
  <p><img alt="" height="889" src="https://images2.imgbox.com/e4/6e/P8C0N7MD_o.png" width="1200"></p> 
  <p><span style="color:#1a439c;"><strong>响应：</strong></span></p> 
  <p>""  //失败信息，成功返回空串</p> 
  <pre><code>  function add() {
            $.ajax({
                url: "/book/addBook",
                type: "post",
                data: $("#addBook").serialize(),
                success: function (result) {
                    if (result.code == "SUCCESS" &amp;&amp; result.data == "") {
                        //添加成功
                        location.href = "book_list.html";
                    } else {
                        alert(result.data);
                    }
                }, 
                error: function (error) {
                    //用户未登录
                    if (error.code=="NOLOGIN"&amp;&amp;error.data==null) {
                        location.href = "login.html";
                    }
                }
            });
        }</code></pre> 
  <p>如果没有返回错误，那么就判断result的data是否为空，如果为空，我们就跳转到博客列表页，如果不等于“”，我们就弹框</p> 
  <p>如果返回错误，说明是用户未登录，那么就要判断error中的数据是否是未登录页码</p> 
 </blockquote> 
 <hr> 
 <h4><span style="color:#1a439c;">📝实现服务器代码</span></h4> 
</div> 
<div>
  插入图书，还是之前的三层架构方式，再mapper层中，我们要插入book_name, author, `count`, price, publish, `status`，这几个字段，因为创建时间和更新时间是以当时时间为准的，id是自增的。 
</div> 
<div></div> 
<div></div> 
<div> 
 <strong><span style="color:#b95514;">🎓数据层</span></strong> 
</div> 
<div></div> 
<div> 
 <pre><code>package com.example.cl.mapper;

import com.example.cl.model.BookInfo;
import org.apache.ibatis.annotations.Insert;
import org.apache.ibatis.annotations.Mapper;

@Mapper
public interface BookInfoMapper {
    /**
     * 插入图书
     */
    @Insert("insert into book_info (book_name, author, `count`, price, publish, `status`) "
            + "values (#{bookName}, #{author}, #{count}, #{price}, #{publish}, #{status})")
    Integer insertBook(BookInfo bookInfo);
}</code></pre> 
 <p><span style="color:#b95514;"><strong>🎓业务层</strong></span></p> 
</div> 
<div> 
 <pre><code>package com.example.cl.service;

import com.example.cl.mapper.BookInfoMapper;
import com.example.cl.mapper.UserInfoMapper;
import com.example.cl.model.BookInfo;
import com.example.cl.model.UserInfo;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

@Service
public class BookInfoService {
    @Autowired
    private BookInfoMapper bookInfoMapper;
    public Integer insertBook(BookInfo bookInfo){
        return bookInfoMapper.insertBook(bookInfo);
    }
}
</code></pre> 
 <p><span style="color:#ad720d;"><strong>🎓控制层</strong></span></p> 
</div> 
<div> 
 <div> 
  <img alt="" height="174" src="https://images2.imgbox.com/f6/68/YrsQIk5K_o.png" width="768"> 
 </div> 
 <p>添加@Slf4j可以让我们再运行的时候，控制台会进行报出日志消息。</p> 
</div> 
<div>
  在后面我们是对图书进行增删改查的功能，这些功能的前提是我们需要用户必须是登录的，所以我们在效验参数之前，我们需要进行判断是否用户登录，如果没有登录返回error信息，设置状态码为NOLOGIN，并且错误信息就是“用户未登录”。 
</div> 
<div></div> 
<div> 
 <pre><code>public static&lt;T&gt; Result nologin(String errMsg){
        Result result=new Result();
        result.setErrMsg(errMsg);
        result.setCode(StatusResult.NOLOGIN);
        return result;
    }</code></pre> 
</div> 
<div>
  如果用户登录了，就按照正常的流程进行添加图书，由于添加图书的返回值是int类型，如果添加图书的数量是&gt;0的我们就表示添加成功，然后我们返回success成功码，如果没有返回成功，就会报错。 
</div> 
<div></div> 
<div> 
 <pre><code>   /**
     * 增加图书
     */
    @RequestMapping(value = "/addBook",produces = "application/json")
    public Result&lt;String&gt; addBook(BookInfo bookInfo, HttpSession session){
        Result&lt;String&gt; ans=new Result&lt;&gt;();
        //1.判断用户是否登录
        //如果用户信息为空, 说明用户未登录
        UserInfo loginUserInfo = (UserInfo) session.getAttribute(constants.USER_SESSION_KEY);
        if (loginUserInfo==null || loginUserInfo.getId()&lt;=0){
            return Result.nologin("用户未登录");
        }
        //1.效验参数
        log.info("添加图书，接收到的参数bookInfo：{}",bookInfo);
        if (!StringUtils.hasLength(bookInfo.getBookName())
                || !StringUtils.hasLength(bookInfo.getAuthor())
                || bookInfo.getCount()==null
                || bookInfo.getPrice()==null
                || !StringUtils.hasLength(bookInfo.getPublish())
                || bookInfo.getStatus()==null){
            ans.setData("输入错误");
            ans.setCode(StatusResult.FAIL);
            return ans;
        }
        //添加图书
        try {
            Integer result=bookInfoService.insertBook(bookInfo);
            if(result&gt;0){
                ans.setData("");
                ans.setCode(StatusResult.SUCCESS);
                return ans;
            }
        }catch (Exception e){
            log.error("添加图书失败");
        }
        ans.setCode(StatusResult.FAIL);
        ans.setData("添加失败");
        return ans;
    }</code></pre> 
 <hr> 
 <h4><span style="color:#1a439c;">📝测试前后端代码是否正确</span></h4> 
</div> 
<div>
  我们先看用户登录状态，首先用postman进行发出登录请求 
</div> 
<div> 
 <img alt="" height="388" src="https://images2.imgbox.com/25/c6/CNdc74Jr_o.png" width="826"> 
</div> 
<div></div> 
<div>
  然后通过postman进行发出添加图书请求，返回SUCCESS状态码 
</div> 
<div> 
 <img alt="" height="892" src="https://images2.imgbox.com/0c/94/Fhdm5tsK_o.png" width="1200"> 
</div> 
<div></div> 
<div> 
 <hr> 
 <p>我们再来看用户未登录状态：返回的错误信息“errMsg”，code为LOGIN</p> 
 <p><img alt="" height="905" src="https://images2.imgbox.com/d5/50/isNVpiAe_o.png" width="1200"></p> 
</div> 
<div> 
 <hr> 
 <p><span style="color:#1a439c;">检查前端代码</span></p> 
 <p class="img-center"><img alt="" height="328" src="https://images2.imgbox.com/5f/5d/F0NzMDlI_o.png" width="360"></p> 
 <p>此时查看数据库中的数据，此时增加了一条。</p> 
 <p><img alt="" height="183" src="https://images2.imgbox.com/df/5a/hCOKWvnl_o.png" width="1200"></p> 
 <p><img alt="" height="190" src="https://images2.imgbox.com/06/d4/enDL85gj_o.png" width="1140"></p> 
 <hr> 
 <h3 id="%F0%9F%8E%88%E5%9B%BE%E4%B9%A6%E5%88%97%E8%A1%A8"><span style="color:#be191c;">🎈图书列表</span></h3> 
 <div> 
  <span style="color:#1f2329;">可以看到, 添加图书之后, 跳转到图书列表⻚⾯, 并没有显⽰刚才添加的图书信息, 接下来我们来实现图书列表。</span> 
 </div> 
 <div></div> 
 <div> 
  <blockquote> 
   <div> 
    <span style="color:#1f2329;">需求分析 </span> 
   </div> 
   <div> 
    <span style="color:#1f2329;">我们之前做的表⽩墙查询功能，是将数据库中所有的数据查询出来并展⽰到⻚⾯上，试想如果数据库中的数据有很多(假设有⼗⼏万条)的时候，将数据全部展⽰出来肯定不现实，那如何解决这个问题呢？ </span> 
   </div> 
  </blockquote> 
  <div> 
   <span style="color:#1a439c;"><span style="background-color:#cbe0f1;">使⽤分⻚解决这个问题。每次只展⽰⼀⻚的数据，⽐如：⼀⻚展⽰10条数据，如果还想看其他的数 </span></span> 
  </div> 
  <div> 
   <span style="color:#1a439c;"><span style="background-color:#cbe0f1;">据，可以通过点击⻚码进⾏查询 </span></span> 
  </div> 
 </div> 
 <h3><img alt="" height="126" src="https://images2.imgbox.com/84/b2/sUQk7tYQ_o.png" width="712"></h3> 
 <blockquote> 
  <div> 
   <span style="color:#1f2329;">分⻚时, 数据是如何展⽰的呢 </span> 
  </div> 
  <div> 
   <span style="color:#1f2329;">第1⻚: 显⽰1-10 条的数据 </span> 
  </div> 
  <div> 
   <span style="color:#1f2329;">第2⻚: 显⽰11-20 条的数据 </span> 
  </div> 
  <div> 
   <span style="color:#1f2329;">第3⻚: 显⽰21-30 条的数据 </span> 
  </div> 
  <div> 
   <span style="color:#1f2329;">以此类推... </span> 
  </div> 
  <div> 
   <span style="color:#1f2329;">要想实现这个功能, 从数据库中进⾏分⻚查询，我们要使⽤ </span> 
   <span style="color:#1f2329;">LIMIT </span> 
   <span style="color:#1f2329;">关键字，格式为：</span> 
  </div> 
  <div> 
   <span style="color:#1c7331;"><span style="background-color:#d4e9d5;">limit 开始索引每⻚显⽰的条数(开始索引从0开始) </span></span> 
  </div> 
 </blockquote> 
 <p>我们先增加一些数据，让每一页都更加的明显显示出来。</p> 
 <p>第一页的开始索引是0  （1-0）*10</p> 
 <p><img alt="" height="469" src="https://images2.imgbox.com/fc/77/w39Flb0B_o.png" width="1020"></p> 
 <p>第二页的开始索引是10，（2-1）*10</p> 
 <h3><img alt="" height="452" src="https://images2.imgbox.com/6e/c1/qn5YFlF6_o.png" width="1007"></h3> 
 <div> 
  <span style="color:#0d0016;">观察以上SQL语句，发现: 开始索引⼀直在改变, 每⻚显⽰条数是固定的 </span> 
 </div> 
 <div> 
  <span style="color:#be191c;"><span style="background-color:#fbd4d0;">开始索引的计算公式： 开始索引 = (当前⻚码 - 1) * 每⻚显⽰条数</span></span> 
 </div> 
 <hr> 
 <div></div> 
 <div> 
  <span style="color:#1f2329;">我们继续基于前端⻚⾯, 继续分析, 得出以下结论：</span> 
 </div> 
 <div></div> 
 <blockquote> 
  <div> 
   <span style="color:#1a439c;">前端发出请求,需要向服务器传递参数</span> 
  </div> 
  <div> 
   <ul><li><span style="color:#1f2329;">currentPage 当前⻚码 //默认值为1 </span></li><li><span style="color:#1456f0;">◦ </span><span style="color:#1f2329;">pageSize 每⻚显⽰条数 //默认值为10</span></li></ul> 
  </div> 
  <div> 
   <div> 
    <span style="color:#646a73;">为了项⽬更好的扩展性, 通常不设置固定值, ⽽是以参数的形式来进⾏传递 </span> 
   </div> 
   <div> 
    <span style="color:#646a73;">扩展性: 软件系统具备⾯对未来需求变化⽽进⾏扩展的能⼒ ，⽐如当前需求⼀⻚显⽰10条, 后期需求改为⼀⻚显⽰20条, 后端代码不需要任何修改 </span> 
   </div> 
  </div> 
 </blockquote> 
</div> 
<blockquote> 
 <div> 
  <span style="color:#1a439c;">后端响应时, 需要响应给前端的数据 </span> 
 </div> 
 <div> 
  <ul><li><span style="color:#1f2329;">records 所查询到的数据列表(存储到List 集合中) </span></li><li><span style="color:#1456f0;">◦ </span><span style="color:#1f2329;">total 总记录数 (⽤于告诉前端显⽰多少⻚, 显⽰⻚数为: </span><span style="color:#1f2329;">(total + pageSize -1)/pageSize </span></li></ul> 
 </div> 
</blockquote> 
<div> 
 <span style="color:#1f2329;">翻⻚请求和响应部分, 我们通常封装在两个对象中：</span> 
</div> 
<div></div> 
<div> 
 <strong><span style="color:#511b78;">🎓翻⻚请求对象</span></strong> 
 <span style="color:#1f2329;"> </span> 
</div> 
<div></div> 
<div> 
 <pre><code>package com.example.cl.model;

import lombok.Data;


@Data
public class PageRequest {
    private Integer pageNum =1;//当前页
    private Integer pageSize = 10;//每页中的记录数
    private Integer offset;//起始索引

    public Integer getOffset() {
        return (pageNum-1) * pageSize;
    }
}</code></pre> 
 <p>通过当前页和每页的记录数，记录当前的起始索引。</p> 
 <div> 
  <strong><span style="color:#511b78;">🎓翻⻚列表结果类:</span></strong> 
 </div> 
</div> 
<pre><code>package com.example.cl.model;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import java.util.List;

@AllArgsConstructor  //生成构造方法
@NoArgsConstructor   //生成无构造方法
@Data
public class PageResult&lt;T&gt;{
    private List&lt;T&gt; records;//当前页的数据
    private Integer count;//所有的记录数
    private PageRequest pageRequest;//从哪个下标开始，显示多少本书
}</code></pre> 
<hr> 
<h4><span style="color:#1a439c;">📝前后端交互</span></h4> 
<blockquote> 
 <p><strong><span style="color:#1c7331;">前端发出请求</span></strong></p> 
 <p>url： </p> 
 <div> 
  <span style="color:#2b2f36;">/book/getListByPage?currentPage=1&amp;pageSize=10 </span> 
 </div> 
 <div> 
  <span style="color:#2b2f36;">Content-Type: application/x-www-form-urlencoded; charset=UTF-8</span> 
 </div> 
 <p>type:  get</p> 
 <p><span style="color:#1c7331;"><strong>参数：</strong></span></p> 
 <div> 
  <span style="color:#1c7331;"><strong>响应:</strong></span> 
 </div> 
 <div> 
  <pre>{"errMsg":"","data":"","code":""}</pre> 
 </div> 
</blockquote> 
<div> 
 <span style="color:#1f2329;">我们约定, 浏览器给服务器发送⼀个 </span> 
 <span style="color:#1f2329;">/book/getListByPage </span> 
 <span style="color:#1f2329;">这样的 HTTP 请求, 通过 </span> 
</div> 
<div> 
 <span style="color:#1f2329;">currentPage 参数告诉服务器, 当前请求为第⼏⻚的数据, 后端根据请求参数, 返回对应⻚的数据 </span> 
</div> 
<div> 
 <span style="color:#0d0016;">第⼀⻚可以不传参数, currentPage默认值为 1 </span> 
</div> 
<div> 
 <hr> 
 <h4><span style="color:#1a439c;">📝实现服务器代码</span></h4> 
 <p><span style="color:#b95514;">🎓数据层</span></p> 
</div> 
<div> 
 <pre><code>  /**
     * 获取当前页数据
     */@Select("select * from book_info where status !=0 order by id asc limit #{offset}, #{pageSize}")//升序
     List&lt;BookInfo&gt; queryBookListByPage(PageRequest pageRequest);//查询当前页所有未借阅的书
//offset索引起始 pageSize一页展示多少数据

    @Select("select count(1) from book_info where status&lt;&gt;0")
    Integer count();//统计未借阅的书的本数</code></pre> 
 <p><span style="color:#ad720d;">🎓业务层</span></p> 
 <div> 
  <span style="color:#1456f0;">1. </span> 
  <span style="color:#646a73;">翻⻚信息需要返回数据的总数和列表信息, 需要查两次SQL </span> 
 </div> 
 <div> 
  <span style="color:#0d0016;">2. 图书状态: 图书状态和数据库存储的status有⼀定的对应关系 ，如果后续状态码有变动, 我们需要修改项⽬中所有涉及的代码, 这种情况, 通常采⽤枚举类来处理映射关系</span> 
 </div> 
</div> 
<div> 
 <pre><code>package com.example.cl.enums;

public enum BookStatus {
    DELETE(0,"删除"),
    NORMAL(1,"可借阅"),
    FORBIDDEN(2,"不可借阅")
    ;


    BookStatus(Integer code, String desc) {
        this.code = code;
        this.desc = desc;
    }

    private Integer code;//数字
    private String desc;//内容


        //根据code，返回描述信息
    public static BookStatus getDescByCode(Integer code){
        switch (code){
            case 0:return DELETE;
            case 1:return NORMAL;
            case 2:
            default:return FORBIDDEN;
        }
    }
    public Integer getCode() {
        return code;
    }

    public void setCode(Integer code) {
        this.code = code;
    }

    public String getDesc() {
        return desc;
    }

    public void setDesc(String desc) {
        this.desc = desc;
    }
</code></pre> 
 <p>业务层</p> 
 <pre><code> public PageResult&lt;BookInfo&gt; queryBookListByPage(PageRequest pageRequest){
        //获取所有未借阅的书的总数
        Integer count=bookInfoMapper.count();
        //获取当前页的记录
        List&lt;BookInfo&gt;bookInfos=bookInfoMapper.queryBookListByPage(pageRequest.getOffset(), pageRequest.getPageSize());
        //3.处理状态（0表示删除，1表示可借阅，2表示未借阅，之前用数字代替，现在需要转成string形式
        for (BookInfo bookInfo:bookInfos) {
            bookInfo.setStatus(BookStatus.getDescByCode(bookInfo.getStatus()).getCode());
        }
        return new PageResult(bookInfos,count,pageRequest);
    }</code></pre> 
 <hr> 
 <p><span style="color:#b95514;">🎓控制层</span></p> 
 <pre><code>    /**
     * 获取当前页数据
     */
    @RequestMapping("/getBookListByPage")
    public Result&lt;PageResult&lt;BookInfo&gt;&gt; getBookListByPage(PageRequest pageRequest,HttpSession session){
        Result&lt;PageResult&lt;BookInfo&gt;&gt; ans=new Result&lt;&gt;();
        //1.判断用户是否登录
        //如果用户信息为空, 说明用户未登录
        UserInfo loginUserInfo = (UserInfo) session.getAttribute(constants.USER_SESSION_KEY);
        if (loginUserInfo==null || loginUserInfo.getId()&lt;=0){
            return Result.nologin("用户未登录");
        }
        //
        PageResult&lt;BookInfo&gt; bookList=bookInfoService.queryBookListByPage(pageRequest);
        return Result.success(bookList);
    }</code></pre> 
 <pre><code>    public static &lt;T&gt; Result success(T data){
        Result result=new Result();
        result.setCode(StatusResult.SUCCESS);
        result.setData(data);
        return result;
    }</code></pre> 
 <p>此时结果返回bookList类型的。</p> 
 <hr> 
 <h4><span style="color:#1a439c;">📝测试前后端代码是否正确</span></h4> 
</div> 
<div>
  先测后端 
</div> 
<div> 
 <img alt="" height="674" src="https://images2.imgbox.com/0e/8f/cGXrh1rc_o.png" width="1119"> 
</div> 
<div> 
 <img alt="" height="172" src="https://images2.imgbox.com/bf/40/917k5rlv_o.png" width="833"> 
</div> 
<div>
  一共有32个书没有被借阅。 
</div> 
<div></div> 
<div> 
 <img alt="" height="543" src="https://images2.imgbox.com/6c/e4/CXIu8xvx_o.png" width="1200"> 
</div> 
<div></div> 
<div>
  前端部分需要给博客列表做出来之后即可看到。 
</div> 
<div></div> 
<div> 
 <img alt="" height="1200" src="https://images2.imgbox.com/ab/99/K9PqEUtO_o.png" width="1200"> 
</div> 
<p><img alt="" height="95" src="https://images2.imgbox.com/35/ff/5OsFKeBn_o.png" width="1037"></p> 
<hr> 
<div></div> 
<h3 id="%F0%9F%8E%88%E4%BF%AE%E6%94%B9%E5%9B%BE%E4%B9%A6"><span style="color:#be191c;">🎈修改图书</span></h3> 
<h4><span style="color:#1a439c;">📝前后端交互</span></h4> 
<div> 
 <div> 
  <span style="color:#1f2329;">进⼊修改⻚⾯, 需要显⽰当前图书的信息 </span> 
 </div> 
 <div></div> 
 <blockquote> 
  <div> 
   <div> 
    <span style="color:#511b78;">[请求] </span> 
   </div> 
   <div></div> 
   <div> 
    <span style="color:#2b2f36;">/book/queryBookById?bookId=25 </span> 
   </div> 
   <div></div> 
   <div> 
    <span style="color:#511b78;">[参数] </span> 
   </div> 
   <div></div> 
   <div> 
    <span style="color:#2b2f36;">⽆ </span> 
   </div> 
   <div></div> 
   <div> 
    <span style="color:#511b78;">[响应] </span> 
   </div> 
   <div></div> 
   <div> 
    <span style="color:#2b2f36;">{ </span> 
   </div> 
   <div> 
    <span style="color:#2b2f36;">"id": 25, </span> 
   </div> 
   <div> 
    <span style="color:#2b2f36;">"bookName": "</span> 
    <span style="color:#2b2f36;">图书</span> 
    <span style="color:#2b2f36;">21", </span> 
   </div> 
   <div> 
    <span style="color:#2b2f36;">"author": "</span> 
    <span style="color:#2b2f36;">作者</span> 
    <span style="color:#2b2f36;">2", </span> 
   </div> 
   <div> 
    <span style="color:#2b2f36;">"count": 999, </span> 
   </div> 
   <div> 
    <span style="color:#2b2f36;">"price": 222.00, </span> 
   </div> 
   <div> 
    <span style="color:#2b2f36;">"publish": "</span> 
    <span style="color:#2b2f36;">出版社</span> 
    <span style="color:#2b2f36;">1", </span> 
   </div> 
   <div> 
    <span style="color:#2b2f36;">"status": 2, </span> 
   </div> 
   <div> 
    <span style="color:#2b2f36;">"statusCN": null, </span> 
   </div> 
   <div> 
    <span style="color:#2b2f36;">"createTime": "2023-09-04T04:01:27.000+00:00", </span> 
   </div> 
   <div> 
    <span style="color:#2b2f36;">"updateTime": "2023-09-05T03:37:03.000+00:00" </span> 
   </div> 
   <div> 
    <span style="color:#2b2f36;">} </span> 
   </div> 
  </div> 
 </blockquote> 
</div> 
<div> 
 <span style="color:#646a73;">根据图书ID, 获取当前图书的信息</span> 
</div> 
<div></div> 
<div> 
 <span style="color:#1f2329;">点击修改按钮, 修改图书信息</span> 
</div> 
<div></div> 
<blockquote> 
 <div> 
  <div> 
   <span style="color:#2b2f36;">[</span> 
   <span style="color:#2b2f36;">请求</span> 
   <span style="color:#2b2f36;">] </span> 
  </div> 
  <div> 
   <span style="color:#2b2f36;">/book/updateBook </span> 
  </div> 
  <div> 
   <span style="color:#2b2f36;">Content-Type: application/x-www-form-urlencoded; charset=UTF-8 </span> 
  </div> 
  <div></div> 
  <div> 
   <span style="color:#2b2f36;">[</span> 
   <span style="color:#2b2f36;">参数</span> 
   <span style="color:#2b2f36;">] </span> 
  </div> 
  <div> 
   <span style="color:#2b2f36;">id=1&amp;bookName=</span> 
   <span style="color:#2b2f36;">图书</span> 
   <span style="color:#2b2f36;">1&amp;author=</span> 
   <span style="color:#2b2f36;">作者</span> 
   <span style="color:#2b2f36;">1&amp;count=23&amp;price=36&amp;publish=</span> 
   <span style="color:#2b2f36;">出版社</span> 
   <span style="color:#2b2f36;">1&amp;status=1 </span> 
  </div> 
  <div></div> 
  <div> 
   <span style="color:#2b2f36;">[</span> 
   <span style="color:#2b2f36;">响应</span> 
   <span style="color:#2b2f36;">] </span> 
  </div> 
  <div> 
   <span style="color:#2b2f36;">"" //</span> 
   <span style="color:#2b2f36;">失败信息</span> 
   <span style="color:#2b2f36;">, </span> 
   <span style="color:#2b2f36;">成功时返回空字符串</span> 
  </div> 
 </div> 
</blockquote> 
<div> 
 <div> 
  <span style="color:#1f2329;">我们约定, 浏览器给服务器发送⼀个</span> 
  <span style="color:#1f2329;"> /book/updateBook </span> 
  <span style="color:#1f2329;">这样的 HTTP 请求, form表单的形式来 </span> 
 </div> 
 <div> 
  <span style="color:#1f2329;">提交数据 ，服务器返回处理结果, 返回""表⽰添加图书成功, 否则, 返回失败信息. </span> 
 </div> 
</div> 
<div></div> 
<hr> 
<h4 id="%F0%9F%93%9D%E5%AE%9E%E7%8E%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BB%A3%E7%A0%81%C2%A0"><span style="color:#1a439c;">📝实现服务器代码 </span></h4> 
<div> 
 <span style="color:#ad720d;">🎓数据层</span> 
</div> 
<div></div> 
<div> 
 <span style="color:#0d0016;">数据层我们需要先寻找该书通过id，因为当我们再点击修改的时候，我们就可以获取到该书的id号，然后再对该书进行更新。</span> 
</div> 
<div></div> 
<div> 
 <img alt="" height="134" src="https://images2.imgbox.com/33/c1/eSLArmma_o.png" width="1200"> 
</div> 
<div></div> 
<div> 
 <p><img alt="" height="194" src="https://images2.imgbox.com/1e/ce/cU6zA4B5_o.png" width="994"></p> 
</div> 
<div> 
 <img alt="" height="345" src="https://images2.imgbox.com/1b/fb/6ldf4P9T_o.png" width="361"> 
 <img alt="" height="339" src="https://images2.imgbox.com/33/83/CnKJVcu1_o.png" width="318"> 
</div> 
<div></div> 
<div> 
 <pre><code>    /**
     * 修改图书
     */
    //通过id查询图书信息
    @Select("select * from book_info where id=#{bookid} and status!=0")
    BookInfo queryBookById(Integer bookid);

    Integer updateBookById(BookInfo bookInfo);</code></pre> 
 <p>通过点击修改按钮，之后跳转到更新页面的时候，就相当于通过id获取到图书信息显示再表单中，然后我们就可以再文本框中输入值，进行更改数据。</p> 
 <p class="img-center"><img alt="" height="361" src="https://images2.imgbox.com/2e/ca/AgLS5qwz_o.png" width="359"></p> 
 <pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;mapper namespace="com.example.cl.mapper.BookMapper"&gt;
    &lt;update id="updateBookById"&gt;
        update book_info
        &lt;set&gt;
            &lt;if test="bookName != null"&gt;
                book_name = #{bookName},
            &lt;/if&gt;
            &lt;if test="author != null"&gt;
                author =#{author},
            &lt;/if&gt;
            &lt;if test="count != null"&gt;
                count = #{count},
            &lt;/if&gt;
            &lt;if test="price !=null"&gt;
                price = #{price},
            &lt;/if&gt;
            &lt;if test="publish != null"&gt;
                publish =#{publish},
            &lt;/if&gt;
            &lt;if test="status != null"&gt;
                status =#{status}
            &lt;/if&gt;
        &lt;/set&gt;
        where id=#{id}
    &lt;/update&gt;
&lt;mapper&gt;</code></pre> 
 <p>因为有些数据我们可能是不想改的，所以我们再更新图书的时候进行了动态sql，用了xml文件进行实现动态sql。</p> 
</div> 
<div> 
 <img alt="" height="202" src="https://images2.imgbox.com/50/d1/t8g2v2wT_o.png" width="983"> 
</div> 
<div></div> 
<div> 
 <hr> 
 <p><span style="color:#ad720d;">🎓业务层</span></p> 
 <pre><code>    /*
    更改图书
     */
    public Integer updateBookById(BookInfo bookInfo){
        return bookInfoMapper.updateBookById(bookInfo);
    }
    public BookInfo queryBookById(Integer bookid){
        return bookInfoMapper.queryBookById(bookid);
    }</code></pre> 
 <p><span style="color:#ad720d;">🎓控制层</span></p> 
 <pre><code> /**
     * 查询图书信息
     */
    @RequestMapping("/queryBookById")
    public Result&lt;BookInfo&gt; queryBookById(Integer bookId,HttpSession session) {
        Result&lt;BookInfo&gt;ans=new Result&lt;&gt;();
        //校验用户信息是否为空，说明是未登录状态
        UserInfo loginUserInfo = (UserInfo) session.getAttribute(constants.USER_SESSION_KEY);
        if (loginUserInfo==null || loginUserInfo.getId()&lt;=0){
            ans.setData(null);
            ans.setCode(StatusResult.NOLOGIN);
            return ans;
        }
        log.info("根据ID查询图书信息, id:"+bookId);
        long start=System.currentTimeMillis();
        BookInfo bookInfo=bookInfoService.queryBookById(bookId);
        ans.setCode(StatusResult.SUCCESS);
        ans.setData(bookInfo);
        log.info("queryBookById 耗时: "+ (System.currentTimeMillis()-start) + "ms");
        return ans;
    }
    /**
     * 更新图书
     */
    @RequestMapping(value = "/updateBook", produces = "application/json")
    public Result&lt;String&gt; updateBook(BookInfo bookInfo,HttpSession session) {
        Result&lt;String&gt;ans=new Result&lt;&gt;();
        //效验参数是否登录
        UserInfo loginUserInfo = (UserInfo) session.getAttribute(constants.USER_SESSION_KEY);
        if (loginUserInfo==null || loginUserInfo.getId()&lt;=0){
            ans.setCode(StatusResult.NOLOGIN);
            ans.setData(null);
            return ans;
        }
        log.info("更新图书, bookInfo: {}", bookInfo);
        try {
            Integer result=bookInfoService.updateBookById(bookInfo);
            if(result&gt;0){
                ans.setData("");
                ans.setCode(StatusResult.SUCCESS);
                return ans;
            }
        }catch (Exception e){
            log.error("更新图书失败");
        }
        ans.setData(null);
        ans.setCode(StatusResult.FAIL);
        return ans;
    }</code></pre> 
 <p>首先通过id查询图书信息，返回的数据是BookInfo类型的，因为我们需要把书返回给客户端。</p> 
 <p>然后通过id进行修改该书。如果更新的结果行数大于0，说明更新成功，如果没有，那么就更新失败。返回null数据。</p> 
 <hr> 
 <h4><span style="color:#1a439c;">📝测试前后端代码是否正确</span></h4> 
 <p><span style="color:#511b78;"><span style="background-color:#dad5e9;">先测后端代码，首先是未登录状态</span></span></p> 
 <p><img alt="" height="158" src="https://images2.imgbox.com/6a/1e/bARJsJj0_o.png" width="589"></p> 
 <p>登录状态：</p> 
 <p><span style="color:#1c7331;"><span style="background-color:#d4e9d5;">通过id获取图书信息</span></span></p> 
 <p><img alt="" height="268" src="https://images2.imgbox.com/e5/ce/gwRqOFWR_o.png" width="341"></p> 
 <p><span style="color:#1c7331;"><span style="background-color:#d4e9d5;">通过id更改图书信息</span></span></p> 
 <p><img alt="" height="471" src="https://images2.imgbox.com/ec/3d/aOXYZuQX_o.png" width="973"></p> 
</div> 
<div> 
 <hr> 
 <p><span style="color:#511b78;"><span style="background-color:#dad5e9;">检查前端代码：</span></span></p> 
 <p><img alt="" height="151" src="https://images2.imgbox.com/b9/48/zMxvEFeY_o.png" width="1200"></p> 
</div> 
<div>
  刚刚后端测试的时候进行修改的，此时我们通过前端修改作者，然后会跳转到博客列表页 
</div> 
<div></div> 
<div> 
 <img alt="" height="287" src="https://images2.imgbox.com/6f/96/EGcsYaGe_o.png" width="272"> 
 <img alt="" height="276" src="https://images2.imgbox.com/94/e0/W5cy9kmU_o.png" width="370"> 
</div> 
<div> 
 <hr> 
 <h3 id="%F0%9F%8E%88%E5%88%A0%E9%99%A4%E5%9B%BE%E4%B9%A6">🎈<span style="color:#be191c;">删除图书</span></h3> 
</div> 
<h4 id="%F0%9F%93%9D%E7%BA%A6%E5%AE%9A%E5%89%8D%E5%90%8E%E7%AB%AF%E4%BA%A4%E4%BA%92%E6%8E%A5%E2%BC%9D"><span style="color:#1a439c;">📝约定前后端交互接⼝</span></h4> 
<div> 
 <div> 
  <span style="color:#1f2329;">删除分为 逻辑删除 和物理删除 </span> 
 </div> 
 <div></div> 
 <blockquote> 
  <div> 
   <div> 
    <span style="color:#511b78;"><span style="background-color:#dad5e9;">逻辑删除 </span></span> 
   </div> 
   <div> 
    <span style="color:#646a73;">逻辑删除也称为软删除、假删除、Soft Delete，即不真正删除数据，⽽在某⾏数据上增加类型 is_deleted的删除标识，⼀般使⽤UPDATE语句 </span> 
   </div> 
   <div> 
    <span style="color:#511b78;"><span style="background-color:#dad5e9;">物理删除 </span></span> 
   </div> 
   <div> 
    <span style="color:#646a73;">物理删除也称为硬删除，从数据库表中删除某⼀⾏或某⼀集合数据，⼀般使⽤DELETE语句</span> 
   </div> 
  </div> 
 </blockquote> 
</div> 
<blockquote> 
 <div> 
  <div> 
   <span style="color:#511b78;"><span style="background-color:#dad5e9;">删除图书的两种实现⽅式 </span></span> 
  </div> 
  <ul><li><span style="color:#646a73;">逻辑删除 </span><span style="color:#a626a4;">update</span><span style="color:#646a73;"> book_info </span><span style="color:#a626a4;">set</span><span style="color:#646a73;"> status=</span><span style="color:#986801;">0 </span><span style="color:#a626a4;">where</span><span style="color:#646a73;"> id = </span><span style="color:#986801;">1 </span></li><li><span style="color:#646a73;">物理删除 </span><span style="color:#a626a4;">delete from</span><span style="color:#646a73;"> book_info </span><span style="color:#a626a4;">where</span><span style="color:#646a73;"> id=</span><span style="color:#986801;">25 </span></li></ul> 
 </div> 
</blockquote> 
<div> 
 <div> 
  <span style="color:#1f2329;">物理删除+归档的⽅式实现有些复杂, </span> 
  <span style="color:#511b78;"><span style="background-color:#dad5e9;">咱们采⽤逻辑删除的⽅式 </span></span> 
 </div> 
 <div> 
  <span style="color:#1f2329;">逻辑删除的话, 依然是更新逻辑, 我们可以直接使⽤修改图书的接⼝</span> 
 </div> 
 <div></div> 
 <blockquote> 
  <div> 
   <div> 
    <span style="color:#1f2329;">/book/deleteBook</span> 
   </div> 
   <div></div> 
   <div> 
    <div> 
     <span style="color:#2b2f36;">[</span> 
     <span style="color:#2b2f36;">请求</span> 
     <span style="color:#2b2f36;">] </span> 
    </div> 
    <div> 
     <span style="color:#2b2f36;">/book/deleteBook </span> 
    </div> 
    <div> 
     <span style="color:#2b2f36;">Content-Type: application/x-www-form-urlencoded; charset=UTF-8 </span> 
    </div> 
    <div></div> 
    <div> 
     <span style="color:#2b2f36;">[</span> 
     <span style="color:#2b2f36;">参数</span> 
     <span style="color:#2b2f36;">] </span> 
    </div> 
    <div> 
     <span style="color:#2b2f36;">id=1&amp;status=0 </span> 
    </div> 
    <div></div> 
    <div> 
     <span style="color:#2b2f36;">[</span> 
     <span style="color:#2b2f36;">响应</span> 
     <span style="color:#2b2f36;">] </span> 
    </div> 
    <div> 
     <span style="color:#2b2f36;">"" //</span> 
     <span style="color:#2b2f36;">失败信息</span> 
     <span style="color:#2b2f36;">, </span> 
     <span style="color:#2b2f36;">成功时返回空字符串 </span> 
    </div> 
   </div> 
  </div> 
 </blockquote> 
 <div> 
  <span style="color:#1a439c;">实现客⼾端代码</span> 
 </div> 
</div> 
<div></div> 
<div> 
 <img alt="" height="341" src="https://images2.imgbox.com/1a/ea/hFdzbadW_o.png" width="919"> 
</div> 
<div></div> 
<div> 
 <hr> 
 <p>当后端接收到bookid的时候，数据层通过id删除该图书，由于删除的sql语句，返回的是int类型，如果删除成功，执行的长度&gt;0，并且返回""数据，并且设置字节码为successs，然后跳转到列表页,如果执行失败，长度为0，返回的是null数据，并且设置字节码fail。失败的情况是未登录状态，如果返回的数据是空并且字节码是nologin，就返回的到登录页面</p> 
 <p><img alt="" height="492" src="https://images2.imgbox.com/81/8a/4WaIOlns_o.png" width="808"></p> 
</div> 
<div> 
 <hr> 
 <h4><span style="color:#1a439c;">📝实现服务器代码 </span></h4> 
 <p><span style="color:#b95514;">🎓数据层</span></p> 
 <p><span style="color:#0d0016;">删除我们是按照id进行删除的，并且我们是按照逻辑删除的，所以就相当于通过id进行更新。</span></p> 
</div> 
<div> 
 <hr> 
 <span style="color:#b95514;">🎓服务层</span> 
 <pre><code>   /**
     * 删除图书
     */
    public Integer deleteBook(Integer bookId){
       BookInfo bookInfo=new BookInfo();
       bookInfo.setId(bookId);
       bookInfo.setStatus(0);
       return bookInfoMapper.updateBookById(bookInfo);
    }</code></pre> 
</div> 
<div>
  我们需要给定id，并且给状态设置为0，然后进行通过id进行修改即可。 
</div> 
<div> 
 <hr> 
 <p><span style="color:#ad720d;">🎓控制层</span></p> 
</div> 
<div> 
 <pre><code> /**
     * 删除图书
     */
    @RequestMapping("/deleteBook")
    public Result&lt;Boolean&gt; deleteBook(Integer bookId,HttpSession session){
        Result&lt;Boolean&gt;ans=new Result&lt;&gt;();
        //效验参数是否登录
        UserInfo loginUserInfo = (UserInfo) session.getAttribute(constants.USER_SESSION_KEY);
        if (loginUserInfo==null || loginUserInfo.getId()&lt;=0){
            ans.setCode(StatusResult.NOLOGIN);
            ans.setData(null);
            return ans;
        }
        log.info("删除图书,bookId:{}",bookId);
        Integer result=bookInfoService.deleteBook(bookId);
        if(result&gt;0){
            ans.setData(true);
            ans.setCode(StatusResult.SUCCESS);
            return ans;
        }
        ans.setData(false);
        ans.setCode(StatusResult.FAIL);
        return ans;
    }</code></pre> 
 <p>控制层返回的数据是返回给客户端代码中。</p> 
</div> 
<div> 
 <hr> 
 <h4><span style="color:#1a439c;">📝测试前后端代码是否正确</span></h4> 
 <p><span style="color:#511b78;"><span style="background-color:#dad5e9;">先测后端代码，首先是未登录状态</span></span></p> 
</div> 
<div> 
 <img alt="" height="217" src="https://images2.imgbox.com/4c/48/ZSUE3LeU_o.png" width="328"> 
</div> 
<div>
  登录状态： 
</div> 
<div></div> 
<div> 
 <span style="color:#511b78;"><span style="background-color:#dad5e9;">通过id删除图书：</span></span> 
</div> 
<div></div> 
<div> 
 <img alt="" height="271" src="https://images2.imgbox.com/1d/b9/oiLQaIOj_o.png" width="493"> 
</div> 
<div> 
 <img alt="" height="107" src="https://images2.imgbox.com/e5/70/YU3gWzGD_o.png" width="1038"> 
</div> 
<div></div> 
<div> 
 <hr> 
 <span style="color:#511b78;"><span style="background-color:#dad5e9;">检查前端代码：</span></span> 
 <p><img alt="" height="698" src="https://images2.imgbox.com/4f/77/ZPXF0hDR_o.png" width="1200"></p> 
 <p><img alt="" height="475" src="https://images2.imgbox.com/95/9c/8GNFb1Le_o.png" width="1200"></p> 
 <p>此时删除成功，返回的列表页。</p> 
 <hr> 
 <h3 id="%F0%9F%8E%88%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E5%9B%BE%E4%B9%A6">🎈<span style="color:#be191c;">批量删除图书</span></h3> 
</div> 
<h4><span style="color:#1a439c;">📝约定前后端交互接⼝</span></h4> 
<blockquote> 
 <div> 
  <span style="color:#1f2329;">/book/</span>batchDeleteBook 
 </div> 
 <div></div> 
 <div> 
  <div> 
   <span style="color:#2b2f36;">[</span> 
   <span style="color:#2b2f36;">请求</span> 
   <span style="color:#2b2f36;">] </span> 
  </div> 
  <div> 
   <span style="color:#2b2f36;">/book/</span>batchDeleteBook 
  </div> 
  <div> 
   <span style="color:#2b2f36;">Content-Type: application/x-www-form-urlencoded; charset=UTF-8 </span> 
  </div> 
  <div></div> 
  <div> 
   <span style="color:#2b2f36;">[</span> 
   <span style="color:#2b2f36;">参数</span> 
   <span style="color:#2b2f36;">] </span> 
  </div> 
  <div> 
   <span style="color:#2b2f36;">id=1&amp;status=0 </span> 
  </div> 
  <div></div> 
  <div> 
   <span style="color:#2b2f36;">[</span> 
   <span style="color:#2b2f36;">响应</span> 
   <span style="color:#2b2f36;">] </span> 
  </div> 
  <div> 
   <span style="color:#2b2f36;">"" //</span> 
   <span style="color:#2b2f36;">失败信息</span> 
   <span style="color:#2b2f36;">, </span> 
   <span style="color:#2b2f36;">成功时返回空字符串</span> 
  </div> 
 </div> 
</blockquote> 
<div> 
 <pre><code> function batchDelete() {
            var isDelete = confirm("确认批量删除?");
            if (isDelete) {
                //获取复选框的id
                var ids = [];
                //已经选中的元素
                $("input:checkbox[name='selectBook']:checked").each(function () {
                    ids.push($(this).val());
                });
                console.log(ids);
                $.ajax({
                    url: "/book/batchDeleteBook?ids=" + ids,
                    type: "post",
                    success: function (result) {
                        if (result.code == "SUCCESS" &amp;&amp; result.data == "") {
                            //删除成功
                            location.href = "book_list.html";
                        } else {
                            alert(result.data);
                        }
                    },
                    error: function (error) {
                        //用户未登录
                        if (error.data == null &amp;&amp; error.data=="NOLOGIN") {
                            location.href = "login.html";
                        }
                    }
                });
                // alert("批量删除成功");
            }
        }</code></pre> 
 <p>前端将url和type发送给服务器。</p> 
 <hr> 
 <h4><span style="color:#1a439c;">📝实现服务器代码 </span></h4> 
</div> 
<div> 
 <span style="color:#ad720d;">🎓数据层</span> 
</div> 
<div> 
 <pre><code>Integer batchDeleteBookByIds(List&lt;Integer&gt; ids);</code></pre> 
 <p>批量删除，我们需要将选中的id对应的图书都删除掉。用到动态sql语句</p> 
 <pre><code>   &lt;delete id="batchDeleteBookByIds"&gt;
        update book_info set status=0
        where id in
        &lt;foreach collection="ids" open="(" close=")" item="id" separator=","&gt;
            #{id}
        &lt;/foreach&gt;
    &lt;/delete&gt;</code></pre> 
 <p><span style="color:#b95514;">🎓业务层</span></p> 
</div> 
<div> 
 <pre><code>    /**
     * 批量删除
     */
    public Integer batchDeleteBookByIds(List&lt;Integer&gt; ids){
        return bookInfoMapper.batchDeleteBookByIds(ids);
    }</code></pre> 
 <p><span style="color:#b95514;">🎓控制层</span></p> 
</div> 
<div> 
 <pre><code>    /**
     * 批量删除  ids
     */
    @RequestMapping(value = "/batchDeleteBook", produces = "application/json")
    public Result&lt;String&gt; batchDelete(@RequestParam List&lt;Integer&gt; ids, HttpSession session) {
        Result&lt;String&gt;ans=new Result&lt;&gt;();
        //效验参数是否登录
        UserInfo loginUserInfo = (UserInfo) session.getAttribute(constants.USER_SESSION_KEY);
        if (loginUserInfo==null || loginUserInfo.getId()&lt;=0){
            ans.setCode(StatusResult.NOLOGIN);
            ans.setData(null);
            return ans;
        }
        Integer result= bookInfoService.batchDeleteBookByIds(ids);
        if(result&gt;0){
            ans.setData("");
            ans.setCode(StatusResult.SUCCESS);
            return ans;
        }
        ans.setData("批量删除失败");
        ans.setCode(StatusResult.FAIL);
        return ans;
    }</code></pre> 
 <hr> 
 <h4 style="background-color:transparent;"><span style="color:#1a439c;">📝测试前后端代码是否正确</span></h4> 
 <p><span style="color:#511b78;"><span style="background-color:#dad5e9;">先测后端代码，首先是未登录状态</span></span></p> 
 <p><img alt="" height="280" src="https://images2.imgbox.com/dd/c3/FodyBLBg_o.png" width="466"></p> 
 <div>
   登录状态： 
 </div> 
 <div></div> 
 <div> 
  <span style="color:#511b78;"><span style="background-color:#dad5e9;">通过ids批量删除图书：</span></span> 
 </div> 
</div> 
<div></div> 
<div> 
 <img alt="" height="203" src="https://images2.imgbox.com/00/39/ki0IqByo_o.png" width="363"> 
</div> 
<p><img alt="" height="104" src="https://images2.imgbox.com/f5/ef/SCW3CJtj_o.png" width="912"></p> 
<hr> 
<p><span style="color:#511b78;"><span style="background-color:#dad5e9;">检查前端代码：</span></span></p> 
<p><img alt="" height="272" src="https://images2.imgbox.com/64/e9/oEnSA0V7_o.png" width="462"></p> 
<p><img alt="" height="219" src="https://images2.imgbox.com/5a/02/nkAjcEWa_o.png" width="1173"></p> 
<p><img alt="" height="553" src="https://images2.imgbox.com/4b/90/BmwvLFt4_o.png" width="1200"></p> 
<p>此时批量删除成功！</p> 
<p><img alt="" height="1143" src="https://images2.imgbox.com/41/c1/uWTuOHGW_o.png" width="570"></p> 
<hr> 
<p>永远有优秀的代码，永远有提升的空间，比如，我们次实现都要调用一个接口，是不是很复杂，如果有更多的功能接口，那么就会更复杂。我们想想会有什么方法来优化呢？后续会有统一功能等等，让这个项目做进一步的优化。</p> 
<hr> 
<blockquote> 
 <p>披星戴月走过的路必将繁华似锦！</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/98579a1ffd0a145765ee92e7b289211a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">undetected_chromedriver驱动浏览器结束报错OSError: [WinError 6] 句柄无效</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cb76d06fb84d1d2035e4933cfa29711e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何在 Windows 上安装 MySQL（保姆级教程2024版）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>