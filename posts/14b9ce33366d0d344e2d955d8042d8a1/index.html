<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Unity打包到Webgl平台以及遇到的问题 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/14b9ce33366d0d344e2d955d8042d8a1/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Unity打包到Webgl平台以及遇到的问题">
  <meta property="og:description" content="Unity打包到Webgl平台以及遇到的问题 参考网站 Unity打包WebGL的全过程及在打包和使用过程中会遇到的问题(本地测试)-CSDN博客
unity打包到Webgl 并配置能正常运行 这里我用的是Unity2022.3.3f1c1版本
有两种方法
1、配置本地web服务
2、安装vsCode&gt;添加插件LiveServer&gt;把工程托到vsCode里在index.html上右键Open with Live Server 即可运行webgl
首先安装webGL模块 新建一个空工程
切到WebGL平台
PlayerSettings设置 Resolution and Presentation设置分辨率 : 将会在浏览器显示的默认大小
Other Settings
有的版本会有一个警告:
Unity Other Settings的默认设置在打开后会看到有警告，其大致意思就是在提醒我们要在 Unity WebGL 构建中启用高质量的光照贴图编码并确保 WebGL 2 兼容性，解决这个警告只需要将Auto Graphics API 自动图形接口关闭后在Graphics APIs选择WebGL2就可以解决这个警告
我们这里也用WebGL2的渲染方式
Publishing Settings 发布设置
分两种情况介绍 选择压缩的 选择不压缩的
Compression Format是打包后的Build包的压缩格式
压缩和不压缩出来的包展示：
没有压缩的
选择Gzip压缩的
选择Gzip压缩 没勾压缩回退的 这种的webgl运行加载会出错
!
到这里打包以前的所有配置就都已经完了
接下来就是配置本地的服务器测试环境
先介绍第一种 发布时 不压缩的情况 打包后我们会发现在我们的文件夹里会有一个网址html，
这代表我们的Web包已经打成功了，
那么直接点击这个html文件运行我们的项目会发现一个报错
提示我们没有web服务
这个问题是因为我们Web包必须在有服务器支持的环境下才能够正常运行，
所以接下来我们要配置我们的包体在本地也就是127.0.0的环境下的服务器托管状态
配置包体在本地也就是127.0.0的环境下的服务器托管状态 分两步
1、启用我们的电脑的Windows功能
2、创建一个新的网络（映射到我们自己的包体）">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-09T10:12:07+08:00">
    <meta property="article:modified_time" content="2023-12-09T10:12:07+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Unity打包到Webgl平台以及遇到的问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="UnityWebgl_0"></a>Unity打包到Webgl平台以及遇到的问题</h4> 
<h5><a id="_1"></a>参考网站</h5> 
<p><a href="https://blog.csdn.net/qq_66312646/article/details/131083148">Unity打包WebGL的全过程及在打包和使用过程中会遇到的问题(本地测试)-CSDN博客</a></p> 
<h5><a id="unityWebgl__5"></a>unity打包到Webgl 并配置能正常运行</h5> 
<p>这里我用的是Unity2022.3.3f1c1版本</p> 
<p>有两种方法</p> 
<p><strong>1、配置本地web服务<br> 2、安装vsCode&gt;添加插件LiveServer&gt;把工程托到vsCode里在index.html上右键Open with Live Server 即可运行webgl</strong></p> 
<h6><a id="webGL_14"></a>首先安装webGL模块</h6> 
<p><img src="https://images2.imgbox.com/77/a6/coGFAEdH_o.png" alt="在这里插入图片描述"><br> <strong>新建一个空工程</strong></p> 
<p><strong>切到WebGL平台</strong><img src="https://images2.imgbox.com/70/06/Ah754sIV_o.png" alt=""></p> 
<h6><a id="PlayerSettings_21"></a>PlayerSettings设置</h6> 
<p>Resolution and Presentation设置分辨率 : 将会在浏览器显示的默认大小</p> 
<p><img src="https://images2.imgbox.com/33/02/x5sbqSpH_o.png" alt="在这里插入图片描述"><br> <strong>Other Settings</strong></p> 
<p>有的版本会有一个警告:</p> 
<p>Unity Other Settings的默认设置在打开后会看到有警告，其大致意思就是在提醒我们要在 Unity WebGL 构建中启用高质量的光照贴图编码并确保 WebGL 2 兼容性，解决这个警告只需要将Auto Graphics API 自动图形接口关闭后在Graphics APIs选择WebGL2就可以解决这个警告</p> 
<p><strong>我们这里也用WebGL2的渲染方式</strong></p> 
<p><img src="https://images2.imgbox.com/2f/8c/Hksqbx4q_o.png" alt="在这里插入图片描述"></p> 
<p><strong>Publishing Settings 发布设置</strong></p> 
<p>分两种情况介绍 选择压缩的 选择不压缩的</p> 
<p><img src="https://images2.imgbox.com/b3/1c/FSvONgQd_o.png" alt="在这里插入图片描述"></p> 
<p>Compression Format是打包后的Build包的压缩格式</p> 
<p><img src="https://images2.imgbox.com/76/55/e8uQ8fMQ_o.png" alt="在这里插入图片描述"><br> 压缩和不压缩出来的包展示：</p> 
<p>没有压缩的</p> 
<p><img src="https://images2.imgbox.com/d3/f8/qZBvcs58_o.png" alt="在这里插入图片描述"></p> 
<p>选择Gzip压缩的</p> 
<p><img src="https://images2.imgbox.com/ec/db/r1Lr7ziC_o.png" alt="在这里插入图片描述"></p> 
<p>选择Gzip压缩 没勾压缩回退的 这种的webgl运行加载会出错</p> 
<p>!<img src="https://images2.imgbox.com/21/e3/pQpIbbCs_o.png" alt="在这里插入图片描述"></p> 
<p><strong>到这里打包以前的所有配置就都已经完了</strong></p> 
<p><strong>接下来就是配置本地的服务器测试环境</strong></p> 
<h6><a id="___68"></a>先介绍第一种 发布时 不压缩的情况</h6> 
<p><img src="https://images2.imgbox.com/3f/1f/lewCqtHR_o.png" alt="在这里插入图片描述"><br> 打包后我们会发现在我们的文件夹里会有一个网址html，</p> 
<p>这代表我们的Web包已经打成功了，</p> 
<p>那么直接点击这个html文件运行我们的项目会发现一个报错<br> <img src="https://images2.imgbox.com/fe/c2/TnBUj22z_o.png" alt="在这里插入图片描述"><br> 提示我们没有web服务</p> 
<p>这个问题是因为我们Web包必须在有服务器支持的环境下才能够正常运行，</p> 
<p>所以接下来我们要配置我们的包体在本地也就是127.0.0的环境下的服务器托管状态</p> 
<h6><a id="12700_85"></a>配置包体在本地也就是127.0.0的环境下的服务器托管状态</h6> 
<p><strong>分两步<br> 1、启用我们的电脑的Windows功能<br> 2、创建一个新的网络（映射到我们自己的包体）</strong></p> 
<p><strong>首先要配置（启用）我们的电脑的Windows功能</strong></p> 
<p>控制面板&gt;程序&gt;启用或关闭windows功能<br> <img src="https://images2.imgbox.com/6a/66/O7Cma4WI_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/c8/6e/9bUr03Rc_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/4d/a2/8gEf49Jw_o.png" alt="在这里插入图片描述"></p> 
<p>Internet Information Services左边的箭头全选后点击 确定就可以</p> 
<p><strong>接下来就是创建一个新的网络</strong></p> 
<p>我的电脑（右键）&gt;管理&gt;服务和应用管理&gt;Internet Information Services&gt;</p> 
<p>网站（右键 添加一个新的网站）</p> 
<p><img src="https://images2.imgbox.com/32/05/AiUCoACP_o.png" alt="在这里插入图片描述"></p> 
<p>!<img src="https://images2.imgbox.com/96/58/xE1RBlGZ_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/ed/bb/FKIO5s8p_o.png" alt="在这里插入图片描述"></p> 
<p>!<img src="https://images2.imgbox.com/ff/ef/j1GGgPnx_o.png" alt="在这里插入图片描述"></p> 
<p>点击确定后就会创建出一个我们的本地路径的web服务</p> 
<p>然后在我们的网页上输入127.0.0.1:8080（设置的端口号）</p> 
<p>运行后发现还是进不去F12打开调试看一下</p> 
<p>还是报错</p> 
<p><img src="https://images2.imgbox.com/ee/9d/2ehojkSn_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/42/2d/0JTroN2n_o.png" alt="在这里插入图片描述"></p> 
<p>我们在网络里发现我们的.data文件出现了报错我们双击他就会进入这样的界面</p> 
<p><img src="https://images2.imgbox.com/9b/35/VEXovGDF_o.png" alt="在这里插入图片描述"><br> .data的解析出错</p> 
<p>这是因为我们的网站MIME类型不支持解析.data类型文件</p> 
<p><strong>需要我们自己在网站的MIME里添加一个.data类型</strong></p> 
<p>我们再次回到我们的网站配置界面 点击我们添加的网站</p> 
<p><img src="https://images2.imgbox.com/53/ad/HBkvqJBf_o.png" alt="在这里插入图片描述"><br> 找到MIME类型双击它 双击</p> 
<p>然后点击添加<br> <img src="https://images2.imgbox.com/45/ca/IuS7sD6W_o.png" alt="在这里插入图片描述"><br> application/octet-stream</p> 
<p>点击确定就添加上了我们的类型</p> 
<p>然后再回去我们的网站就可以正常运行了<br> <img src="https://images2.imgbox.com/1a/56/gcTBKvdN_o.png" alt="在这里插入图片描述"></p> 
<p>至此所有环境配置完成</p> 
<h6><a id="_162"></a>第二种压缩的发布设置</h6> 
<p><img src="https://images2.imgbox.com/ed/46/SLZix4Le_o.png" alt="在这里插入图片描述"><br> 压缩后需要在压缩回退这里勾上</p> 
<p>否则web运行时会出错</p> 
<p><img src="https://images2.imgbox.com/33/b6/OXhKnaTc_o.png" alt="在这里插入图片描述"></p> 
<p>然后点击添加 在把这两个文件扩展名添加上</p> 
<p>!<img src="https://images2.imgbox.com/7a/59/N3S9Yghr_o.png" alt="在这里插入图片描述"></p> 
<p>.unity3d</p> 
<p>.unityweb</p> 
<p>application/octet-stream</p> 
<p>.json (一般情况下在配置好IIS后会有该类型，若没有就添加)</p> 
<p>application/json</p> 
<p>然后压缩的也可以正常运行了</p> 
<h6><a id="Unityweb_191"></a>第二种运行Unity打包出web的办法</h6> 
<p>1、安装VSCode</p> 
<p>vsCode下载慢的话 可以百度vsCode下载慢 会有办法的</p> 
<p><a href="https://blog.csdn.net/z099164/article/details/131396783">VSCode下载和安装教程（超详细）以及解决VSCode下载速度特别慢的问题_vscode下载太慢-CSDN博客</a></p> 
<p>2、安装LiveServer插件</p> 
<p>这个插件是用来启动本地服务的 所以可以顺利运行webgl工程</p> 
<p><img src="https://images2.imgbox.com/0b/e3/qetpqYPU_o.png" alt="在这里插入图片描述"><br> 3、vscode打开unity发布的webgl</p> 
<p>可以直接把文件夹拖到vsCode里 会提示信任 点击信任就行</p> 
<p>4、选择index,在文本编辑位置，右键选择 Open with Live Server 即可运行webgl</p> 
<h5><a id="Unity_webglstreamingAssetsPathtxt_211"></a>Unity webgl读取streamingAssetsPath文件夹txt</h5> 
<p>参考网站</p> 
<p>里面有读取音频 texture 等都有参考价值</p> 
<p><a href="https://blog.csdn.net/abcd5711664321/article/details/124020326">Unity webgl读取streamingAssetsPath文件夹txt_unitywebgl读取steamasset-CSDN博客</a></p> 
<p>在StreamingAssets文件夹下新建一个txt 里面随便写点东西</p> 
<p>也可以写json一些配置文件用于游戏的配置设置</p> 
<p>把这个脚本挂到场景的物体上 在脚本上拖一个Text</p> 
<p>这里只演示了一下读取</p> 
<pre><code>using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.Events;
using UnityEngine.Networking;
using UnityEngine.UI;

public class ReadConfig : MonoBehaviour
{

    public Text ReadText;

    // Start is called before the first frame update
    void Start()
    {
        StartCoroutine(ReadTxt("ConfigData.txt", ReadTxtCallBack));
    }

    private void ReadTxtCallBack(string str)
    {
        ReadText.text = str;
    }

    private IEnumerator ReadTxt(string configName, UnityAction&lt;string&gt; action = null)
    {
        string path;
        //手机路径  需要加file://
#if UNITY_WIN_STANDALONE || UNITY_IPHONE &amp;&amp;!UNITY_EDITOR
        path ="file://"+ Application.streamingAssetsPath + configName;
#else 
        path = Application.streamingAssetsPath + "/" + configName;
#endif
        UnityWebRequest unityWebRequest = UnityWebRequest.Get(path);
        yield return unityWebRequest.SendWebRequest();

        if (unityWebRequest.error != null)
            Debug.Log(unityWebRequest.error);
        else
        {
            string content = unityWebRequest.downloadHandler.text;
            if (action != null)
                action(content);
        }
    }

    // Update is called once per frame
    void Update()
    {

    }
}
</code></pre> 
<h5><a id="unityCjs_282"></a>unity中C#调用js</h5> 
<p>参考网站</p> 
<p><a href="https://docs.unity3d.com/cn/current/Manual/webgl-interactingwithbrowserscripting.html" rel="nofollow">Interaction with browser scripting - Unity 手册 (unity3d.com)</a></p> 
<p><a href="http://news.558idc.com/455108.html" rel="nofollow">Unity2021发布WebGL与网页交互问题的解决 - 自由资讯 (558idc.com)</a></p> 
<p>在项目中使用浏览器 JavaScript 的建议方法是将 JavaScript 源代码添加到项目中，</p> 
<p>然后直接从脚本代码中调用这些函数。</p> 
<p>首先是需要在工程的Asset目录里面建一个Plugins文件夹，</p> 
<p>然后在文件夹里面创建一个.txt文件，名字倒是无所谓，</p> 
<p>创建好后要把扩展名改成.jslib。</p> 
<p>文件需要有如下所示的语法：</p> 
<p>这其中只有mergeInto的第二个参数是可以修改的，</p> 
<p>第二个参数是一个对象，这个对象里面包含了多个方法的引用，</p> 
<p>这些方法（例如：Hello（）、BingdeWebGLTexture（）等）都是在Unity编程中可以引入的。</p> 
<p>这些方法内调用的方法（例如：wiindow.alert()、GLctx.bindTexture()等）都是将来页面中可以被调用的。</p> 
<pre><code>mergeInto(LibraryManager.library, {

  Hello: function () {
    window.alert("Hello, world!");
  },

  HelloString: function (str) {
    window.alert(UTF8ToString(str));
  },

  PrintFloatArray: function (array, size) {
    for(var i = 0; i &lt; size; i++)
    console.log(HEAPF32[(array &gt;&gt; 2) + i]);
  },

  AddNumbers: function (x, y) {
    return x + y;
  },

  StringReturnValueFunction: function () {
    var returnStr = "bla";
    var bufferSize = lengthBytesUTF8(returnStr) + 1;
    var buffer = _malloc(bufferSize);
    stringToUTF8(returnStr, buffer, bufferSize);
    return buffer;
  },

  BindWebGLTexture: function (texture) {
    GLctx.bindTexture(GLctx.TEXTURE_2D, GL.textures[texture]);
  },

});
</code></pre> 
<p>具体在Unity编程中引入方法的方式以C#为例</p> 
<p>首先需要引入命名空间：</p> 
<pre><code>using System.Runtime.InteropServices;
</code></pre> 
<p>其次需要写具体引入代码：</p> 
<pre><code>[DllImport("__Internal")] private static extern void Hello();

using System.Collections;
using System.Collections.Generic;
using System.Runtime.InteropServices;
using UnityEngine;

public class CShapCallJs : MonoBehaviour
{
    [DllImport("__Internal")]
    private static extern void Hello();

    [DllImport("__Internal")]
    private static extern void HelloString(string str);

    [DllImport("__Internal")]
    private static extern void PrintFloatArray(float[] array, int size);

    [DllImport("__Internal")]
    private static extern int AddNumbers(int x, int y);

    [DllImport("__Internal")]
    private static extern string StringReturnValueFunction();

    [DllImport("__Internal")]
    private static extern void BindWebGLTexture(int texture);


    public bool CanRotate;
    public float angle = 45;

    void Start()
    {
        Hello();//在js里写了 出先一个弹窗tip

        HelloString("这是一个字符串");

        float[] myArray = new float[10];
        PrintFloatArray(myArray, myArray.Length);

        int result = AddNumbers(5, 7);
        Debug.Log(result);

        Debug.Log(StringReturnValueFunction());

        //var texture = new Texture2D(0, 0, TextureFormat.ARGB32, false);
        //BindWebGLTexture(texture.GetNativeTextureID());

    }

    void Update()
    {
        if (CanRotate)
        {
            this.transform.Rotate(Vector3.up, Time.deltaTime * angle, Space.World);
        }

    }
    public void OnSetStart()
    {
        CanRotate = true;
    }
    public void OnSetEnd()
    {
        CanRotate = false;
    }
}
</code></pre> 
<h5><a id="jsunityC_420"></a>js调用unity中C#的代码</h5> 
<p>(页面方法调用Unity内方法的办法)</p> 
<p>有时需要从浏览器的 JavaScript 向 Unity 脚本发送一些数据或通知。</p> 
<p>建议的做法是调用内容中的游戏对象上的方法。</p> 
<p>如果要从嵌入在项目中的 JavaScript 插件执行调用，</p> 
<p>可使用以下代码：</p> 
<pre><code>MyGameInstance.SendMessage(objectName, methodName, value);
</code></pre> 
<p>其中，<strong>objectName</strong> 是场景中的对象名称；<strong>methodName</strong> 是当前附加到该对象的脚本中的方法名称；<strong>value</strong> 可以是字符串、数字，也可为空。</p> 
<p><img src="https://images2.imgbox.com/38/a3/FuwkXAYS_o.png" alt="在这里插入图片描述"></p> 
<p>很空虚具体怎么用呢</p> 
<p>看看打出包来的官方index.html程序 怎么调用</p> 
<p>官方用了一个全屏的功能 unityInstance.SetFullscreen(1);</p> 
<p><img src="https://images2.imgbox.com/05/5b/8w6ilrSw_o.png" alt="在这里插入图片描述"></p> 
<p>如果是我们自己怎么用呢 ，这个是被定义在了拉姆达表达式里 我们用一个对象给接收出来</p> 
<p>就可以用这个Unity实例对象了</p> 
<p>具体怎么用呢</p> 
<p>我们先创建两个按钮测试一下</p> 
<p>在 unity打好的webgl包里 的 index.html中 body下创建两个button</p> 
<p><img src="https://images2.imgbox.com/8b/d7/9j5C4MU6_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/db/3f/rI8GYloU_o.png" alt="在这里插入图片描述"></p> 
<p>在这里可以看到这两个按钮</p> 
<p>接下来给这两个按钮 用js添加点击事件</p> 
<p><img src="https://images2.imgbox.com/f6/00/hjorahsU_o.png" alt="在这里插入图片描述"></p> 
<p>myUnityInstance.SendMessage(“Cube”, “OnSetStart”);</p> 
<p>这个SendMessage 对应到了 unity里的方法</p> 
<p><img src="https://images2.imgbox.com/8d/2b/AOn2s1VU_o.png" alt="在这里插入图片描述"></p> 
<p>接下来看看打印出来的myUnityInstance</p> 
<p><img src="https://images2.imgbox.com/e3/82/vu0N1K0B_o.png" alt="在这里插入图片描述"></p> 
<p>这两个都是熟悉的方法了 打印出来也有个好处是 能看到里面能用到的方法</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e1513e356d64ad6546d25d82df650fe5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Copilot】Edge浏览器的copilot消失了怎么办</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/263ccc0d5865f118fb3a0d52e51faded/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">大数据实验 实验七：Flink初级编程实践</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>