<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【React】React18 Hooks 之 useContext - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/30dbf05e9cd1f45ab124c475b3894e32/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【React】React18 Hooks 之 useContext">
  <meta property="og:description" content="目录 useContext1、Provider和 useContext2、Provider 和Consumer3、Provider 嵌套4、React.createContext提供的Provider和class的contextType属性5、读、写Context（1）父组件修改Context（2）子组件修改Context 好书推荐 useContext官方地址
使用 Context 深度传递数据
通常，您会通过 props 将信息从父组件传递到子组件。但是，如果您必须通过中间的许多组件传递信息，或者应用中的许多组件都需要相同的信息，则传递 props 会变得冗长且不方便。Context允许父组件向其下方树中的任何组件（无论深度如何）提供一些信息，而无需通过 props 明确传递。
简单来说使用Context可以实现跨组件层级传递数据，不用层层传递数据。本文介绍三种Context的使用方式。
函数组件：React.createContext提供的Provider和useContext钩子React.createContext提供的Provider和ConsumerProvider嵌套Class组件：React.createContext提供的Provider和class的contextType属性读、写Context useContext useContext是一个 React Hook，可让您从组件读取和订阅上下文。
用法：
const value = useContext(SomeContext) 参数的含义：
SomeContext：使用createContext创建的上下文。上下文本身并不包含信息，它只代表您可以提供或从组件中读取的信息类型。
返回值的含义：
value：useContext返回调用组件的上下文值，传递给最接近的SomeContext的值。
1、Provider和 useContext 新建个context.js，导出createContext()的返回值
import { createContext } from &#34;react&#34;; export default createContext(); App.js，导入上面写的context，并使用context提供的Provider组件进行包裹，圈定局部的全局作用域，传值后可以提供给子组件进行消费。当 Provider 的 value 值发生变化时，它内部的所有消费组件都会重新渲染。
import Context from &#34;./context&#34;; import Test from &#34;./Test&#34; function App() { const value = &#34;app 中的数据&#34; return (&lt;&gt; &lt;Context.Provider value={value}&gt; &lt;div className=&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-09T14:24:37+08:00">
    <meta property="article:modified_time" content="2024-07-09T14:24:37+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【React】React18 Hooks 之 useContext</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#useContext_17" rel="nofollow">useContext</a></li><li><ul><li><a href="#1Provider_useContext_29" rel="nofollow">1、Provider和 useContext</a></li><li><a href="#2Provider_Consumer_93" rel="nofollow">2、Provider 和Consumer</a></li><li><a href="#3Provider__111" rel="nofollow">3、Provider 嵌套</a></li><li><a href="#4ReactcreateContextProviderclasscontextType_221" rel="nofollow">4、React.createContext提供的Provider和class的contextType属性</a></li><li><a href="#5Context_250" rel="nofollow">5、读、写Context</a></li><li><ul><li><a href="#1Context_251" rel="nofollow">（1）父组件修改Context</a></li><li><a href="#2Context_293" rel="nofollow">（2）子组件修改Context</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_310" rel="nofollow">好书推荐</a></li></ul> 
</div> 
<p></p> 
<p><img src="https://images2.imgbox.com/84/06/8KACWo2o_o.png" alt="在这里插入图片描述"></p> 
<p><a href="https://react.dev/reference/react/useContext" rel="nofollow">useContext官方地址</a><br> <a href="https://react.dev/learn/passing-data-deeply-with-context" rel="nofollow">使用 Context 深度传递数据</a></p> 
<blockquote> 
 <p>通常，您会通过 <strong>props 将信息从父组件传递到子组件</strong>。但是，如果您必须通过中间的许多组件传递信息，或者应用中的许多组件都需要相同的信息，则传递 props 会变得冗长且不方便。<strong>Context允许父组件向其下方树中的任何组件（无论深度如何）提供一些信息，而无需通过 props 明确传递</strong>。</p> 
</blockquote> 
<p>简单来说使用<code>Context</code>可以实现跨组件层级传递数据，不用层层传递数据。本文介绍三种<code>Context</code>的使用方式。</p> 
<ul><li>函数组件：<code>React.createContext</code>提供的<code>Provider</code>和<code>useContext</code>钩子</li><li><code>React.createContext</code>提供的<code>Provider</code>和<code>Consumer</code></li><li>Provider嵌套</li><li>Class组件：<code>React.createContext</code>提供的<code>Provider</code>和<code>class</code>的<code>contextType</code>属性</li><li>读、写<code>Context</code></li></ul> 
<h2><a id="useContext_17"></a>useContext</h2> 
<p>useContext是一个 React Hook，可让您从组件读取和订阅上下文。</p> 
<p>用法：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>SomeContext<span class="token punctuation">)</span>
</code></pre> 
<p>参数的含义：<br> SomeContext：使用createContext创建的上下文。上下文本身并不包含信息，它只代表您可以提供或从组件中读取的信息类型。<br> 返回值的含义：<br> value：useContext返回调用组件的上下文值，<strong>传递给最接近的SomeContext的值</strong>。</p> 
<h3><a id="1Provider_useContext_29"></a>1、Provider和 useContext</h3> 
<p>新建个context.js，导出createContext()的返回值</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>App.js，导入上面写的context，并使用context提供的Provider组件进行包裹，圈定局部的全局作用域，传值后可以提供给子组件进行消费。<strong>当 Provider 的 value 值发生变化时，它内部的所有消费组件都会重新渲染。</strong></p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> Context <span class="token keyword">from</span> <span class="token string">"./context"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Test <span class="token keyword">from</span> <span class="token string">"./Test"</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token string">"app 中的数据"</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>Context<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>value<span class="token punctuation">}</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"Appy"</span> <span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>Test <span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>Context<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre> 
<p>新建个Test.js，</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> Context <span class="token keyword">from</span> <span class="token string">"./context"</span>
<span class="token keyword">import</span> MyComponent <span class="token keyword">from</span> <span class="token string">"./MyComponent"</span>
<span class="token keyword">const</span> <span class="token function-variable function">Test1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>MyComponent<span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Test1
</code></pre> 
<p>新建个MyComponent.js，使用useContext钩子接收Context提供的参数</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> Context <span class="token keyword">from</span> <span class="token string">"./context"</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span>
<span class="token keyword">const</span> <span class="token function-variable function">MyComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>Context<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>value<span class="token operator">:</span><span class="token punctuation">{<!-- --></span>value<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> MyComponent
</code></pre> 
<p>可以看到页面中显示如下：<br> <img src="https://images2.imgbox.com/29/49/b7gCEjfL_o.png" alt="在这里插入图片描述"><br> 使用Components分析如下：</p> 
<p><img src="https://images2.imgbox.com/67/53/bdr1defJ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2Provider_Consumer_93"></a>2、Provider 和Consumer</h3> 
<p>上面的<code>MyComponent.js </code>文件，我们可以使用Context.Consumer组件接收数据。在MyComponent组件中，导入context，使用其提供的Consumer组件来订阅Context的变更,需要一个函数作为子元素,函数的第一个形参便是Provider组件提供的value值。如下：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> Context <span class="token keyword">from</span> <span class="token string">"./context"</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span>
<span class="token keyword">const</span> <span class="token function-variable function">MyComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>Context<span class="token punctuation">)</span>
	<span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>Context<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
		<span class="token punctuation">{<!-- --></span><span class="token parameter">value</span><span class="token operator">=&gt;</span><span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>value1<span class="token operator">:</span><span class="token punctuation">{<!-- --></span>value<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">}</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>Context<span class="token punctuation">.</span>Consumer<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> MyComponent
</code></pre> 
<h3><a id="3Provider__111"></a>3、Provider 嵌套</h3> 
<p>新建context.js，创建ThemeContext，AuthContext，然后再分别创建创建 ThemeContext 、AuthContext 的 Provider 组件，Provider 组件主要提供方法。</p> 
<pre><code class="prism language-javascript">
<span class="token comment">// context.js</span>
<span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> createContext<span class="token punctuation">,</span> useState<span class="token punctuation">,</span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 ThemeContext</span>
<span class="token keyword">const</span> ThemeContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 ThemeContext 的 Provider 组件</span>
<span class="token keyword">const</span> <span class="token function-variable function">ThemeProvider</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>theme<span class="token punctuation">,</span> setTheme<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">'light'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 假设初始主题是 'light'</span>

  <span class="token comment">// 可以通过函数来切换主题</span>
  <span class="token keyword">const</span> <span class="token function-variable function">toggleTheme</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setTheme</span><span class="token punctuation">(</span>theme <span class="token operator">===</span> <span class="token string">'light'</span> <span class="token operator">?</span> <span class="token string">'dark'</span> <span class="token operator">:</span> <span class="token string">'light'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ThemeContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> theme<span class="token punctuation">,</span> toggleTheme <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{<!-- --></span>children<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 AuthContext</span>
<span class="token keyword">const</span> AuthContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建 AuthContext 的 Provider 组件</span>
<span class="token keyword">const</span> <span class="token function-variable function">AuthProvider</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>user<span class="token punctuation">,</span> setUser<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 假设初始用户是 null</span>

  <span class="token comment">// 可以通过函数来设置用户</span>
  <span class="token keyword">const</span> <span class="token function-variable function">login</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">userData</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setUser</span><span class="token punctuation">(</span>userData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">logout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setUser</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>AuthContext<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span> user<span class="token punctuation">,</span> login<span class="token punctuation">,</span> logout <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
      <span class="token punctuation">{<!-- --></span>children<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>AuthContext<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 导出 ThemeProvider 和 AuthProvider，以及它们各自的 Context</span>
<span class="token keyword">export</span> <span class="token punctuation">{<!-- --></span> ThemeContext<span class="token punctuation">,</span> ThemeProvider<span class="token punctuation">,</span> AuthContext<span class="token punctuation">,</span> AuthProvider <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>App.js，导入ThemeProvider, AuthProvider，层层嵌套。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ThemeProvider<span class="token punctuation">,</span> AuthProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./context.js'</span><span class="token punctuation">;</span> <span class="token comment">// 导入提供者</span>
<span class="token keyword">import</span> MyComponent <span class="token keyword">from</span> <span class="token string">'./MyComponent'</span><span class="token punctuation">;</span> <span class="token comment">// 假设您有一个 MyComponent 组件</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>ThemeProvider <span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>AuthProvider <span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>MyComponent <span class="token operator">/</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span><span class="token comment">/* MyComponent 现在可以访问 ThemeContext 和 AuthContext */</span><span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>AuthProvider<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ThemeProvider<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre> 
<p>MyComponent.js，导入ThemeContext, AuthContext ，使用useContext获取ThemeContext, AuthContext 的Provider组件传递的参数。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ThemeContext<span class="token punctuation">,</span> AuthContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./context.js'</span><span class="token punctuation">;</span> <span class="token comment">// 导入 Context</span>

<span class="token keyword">const</span> <span class="token function-variable function">MyComponent</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">useContext</span><span class="token punctuation">(</span>ThemeContext<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'useContext(ThemeContext)'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> theme<span class="token punctuation">,</span> toggleTheme <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ThemeContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> user<span class="token punctuation">,</span> login<span class="token punctuation">,</span> logout <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>AuthContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">useContext</span><span class="token punctuation">(</span>AuthContext<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'useContext(ThemeContext)'</span><span class="token punctuation">)</span>

  <span class="token comment">// 使用 theme、toggleTheme、user、login 和 logout 做一些事情...</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token comment">// ... 组件的 JSX</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>当前主题<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>theme<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>toggleTheme<span class="token punctuation">}</span><span class="token operator">&gt;</span>切换主题<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token punctuation">{<!-- --></span>user <span class="token operator">?</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>已登录用户<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>user<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>logout<span class="token punctuation">}</span><span class="token operator">&gt;</span>登出<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'John Doe'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>登录<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> MyComponent<span class="token punctuation">;</span>
</code></pre> 
<p>页面如下：<br> <img src="https://images2.imgbox.com/d2/43/jkYJY92u_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4ReactcreateContextProviderclasscontextType_221"></a>4、React.createContext提供的Provider和class的contextType属性</h3> 
<blockquote> 
 <p>static contextType 是一种在类组件中直接访问 Context 值的方式，而不必明确地传递一个 &lt;Context.Consumer&gt; 组件。static contextType 应该被定义在类组件的外部，而不是在 render 方法内部或组件的类体内部。</p> 
</blockquote> 
<blockquote> 
 <p>挂载在 class 上的 contextType 属性会被重赋值为一个由React.createContext() 创建的 Context 对象。这能让你使用 this.context 来消费最近 Context 上的那个值。你可以在任何生命周期中访问到它，包括 render 函数中。<br> 使用static关键字添加静态属性，和直接在class添加属性效果一致,最终都会添加到类上，而不是类的实例上</p> 
</blockquote> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> context <span class="token keyword">from</span> <span class="token string">"./context"</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Test1</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">static</span> contextType <span class="token operator">=</span> context<span class="token punctuation">;</span>
 
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Test1<span class="token punctuation">.</span>contextType<span class="token punctuation">,</span><span class="token string">'contextType'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">,</span><span class="token string">'context'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>第三种使用Context方式获取的值：<span class="token punctuation">{<!-- --></span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Test1.contextType = context; //此处与写static关键字作用一致</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Test1<span class="token punctuation">;</span>

</code></pre> 
<p>可以看到打印的<code>Test1.contextType</code>为<code>React.createContext() </code>创建的 <code>Context </code>对象，打印<code>this.context</code>为最近的 Context 上的值<br> <img src="https://images2.imgbox.com/45/2a/P48cU8Yn_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5Context_250"></a>5、读、写Context</h3> 
<h4><a id="1Context_251"></a>（1）父组件修改Context</h4> 
<p>App.js中，更改<code>Context</code>数据，调用组件中的<code>onChange</code>方法。Provider的value不再传入一个简单结构的对象，而是将useState的返回值作为新对象的key/value，子组件便能调用App的setStore函数进行更新</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> Context <span class="token keyword">from</span> <span class="token string">"./context"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Test <span class="token keyword">from</span> <span class="token string">"./Test1"</span> 
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span>
<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token string">"app 中的数据"</span>
	<span class="token keyword">const</span> <span class="token punctuation">[</span>store<span class="token punctuation">,</span> setStore<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">setStore</span><span class="token punctuation">(</span><span class="token string">"app 数据 change"</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>Context<span class="token punctuation">.</span>Provider value<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>store<span class="token punctuation">,</span> setStore<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"Appy"</span> <span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>Test <span class="token operator">/</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>onChange<span class="token punctuation">}</span><span class="token operator">&gt;</span>按钮<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>Context<span class="token punctuation">.</span>Provider<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
	<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span>
</code></pre> 
<p>Test.js中，使用<code>useContext</code>接收<code>Context</code>数据。点击父组件中的按钮，数据从 <code>app 中的数据</code>变为<code>app 数据 change</code></p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> Context <span class="token keyword">from</span> <span class="token string">"./context"</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span>
<span class="token keyword">const</span> <span class="token function-variable function">Test1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>Context<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span><span class="token string">'test1组件接收到的'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{<!-- --></span>value<span class="token punctuation">.</span>store<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Test1
</code></pre> 
<h4><a id="2Context_293"></a>（2）子组件修改Context</h4> 
<p>这里更改子组件的代码，新增一个button按钮，使用context接收过来的setStore函数，修改Context数据。点击button之后，数据由<code>app 中的数据</code>变为<code>子组件修改Context成功</code>。效果与在父组件中修改Context数据一样。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> Context <span class="token keyword">from</span> <span class="token string">"./context"</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> useContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span>
<span class="token comment">// import MyComponent from "./MyComponent"</span>
<span class="token keyword">const</span> <span class="token function-variable function">Test1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> context <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>Context<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{<!-- --></span>value<span class="token punctuation">.</span>store<span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span>context<span class="token punctuation">.</span><span class="token function">setStore</span><span class="token punctuation">(</span><span class="token string">"子组件修改Context成功"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>子组件button<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Test1
</code></pre> 
<h2><a id="_310"></a>好书推荐</h2> 
<p><a href="https://item.jd.com/14549308.html" rel="nofollow">《Rust Web开发》</a></p> 
<blockquote> 
 <p>如果你厌倦了缓慢、占用大量资源且不稳定的模板化Web开发工具，Rust就是你的解决方案。Rust服务提供了稳定的安全保证、非凡的开发经验，以及能够自动防止常见错误的编译器。</p> 
</blockquote> 
<p><a href="https://item.jd.com/14549308.html" rel="nofollow">《Rust Web开发》</a>教你使用Rust以及重要的Rust库(如异步运行时的Tokio、用于Web服务器和API的Warp，以及运行外部HTTP请求的Reqwest)来创建服务端的Web应用。《Rust Web开发》包含大量的代码示例以及专业的提示，以帮助你创建项目和组织代码。随着学习的深入，你将创建一个完整的Q&amp;A Web服务并逐章迭代你的代码，就像参与了真实的项目开发一样。</p> 
<p>这不是一本参考书，而是一本工作手册。正在构建的应用程序在设计上做出了一些妥协，以便在适当的时候解释概念。需要阅读整本书的内容才能最终将应用程序部署到生产环境中。</p> 
<p><img src="https://images2.imgbox.com/19/27/wmosHut3_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5cdb38bee7c8269db69ea439a1c8b569/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">AI究竟是在帮助开发者还是取代他们？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/baf3fa3d7fc158b68aa5cc0f07c9b9b9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Facebook数据仓库的变迁与启示</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>