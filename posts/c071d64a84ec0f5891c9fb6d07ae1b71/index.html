<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C# HttpClient全攻略：GET、POST、文件传输与授权设置一网打尽 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/c071d64a84ec0f5891c9fb6d07ae1b71/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="C# HttpClient全攻略：GET、POST、文件传输与授权设置一网打尽">
  <meta property="og:description" content="概述：本文详解了在C#中使用HttpClient发送HTTP请求的全面指南，包括GET、POST请求、文件上传和下载，以及设置Authorization、cookie等操作，为实现网络操作提供了清晰的方法和示例。
1. 说明 HttpClient是C#中用于发送HTTP请求的类，基于HttpClient的异步模型，可以实现GET、POST请求，处理响应数据，上传和下载文件，以及设置Authorization、cookie等。
2. 方法说明 2.1 发送GET请求 using (HttpClient client = new HttpClient()) { HttpResponseMessage response = await client.GetAsync(&#34;https://example.com/api/resource&#34;); // 处理响应 } 2.2 发送POST请求 using (HttpClient client = new HttpClient()) { var content = new StringContent(&#34;data to send&#34;, Encoding.UTF8, &#34;application/json&#34;); HttpResponseMessage response = await client.PostAsync(&#34;https://example.com/api/resource&#34;, content); // 处理响应 } 2.3 上传文件 using (HttpClient client = new HttpClient()) { var content = new MultipartFormDataContent(); content.Add(new ByteArrayContent(File.ReadAllBytes(&#34;file.txt&#34;)), &#34;file&#34;, &#34;file.txt&#34;); HttpResponseMessage response = await client.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-23T19:28:08+08:00">
    <meta property="article:modified_time" content="2024-01-23T19:28:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C# HttpClient全攻略：GET、POST、文件传输与授权设置一网打尽</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>概述：本文详解了在C#中使用HttpClient发送HTTP请求的全面指南，包括GET、POST请求、文件上传和下载，以及设置Authorization、cookie等操作，为实现网络操作提供了清晰的方法和示例。</p> 
<h4>1. 说明</h4> 
<p><code>HttpClient</code>是C#中用于发送HTTP请求的类，基于HttpClient的异步模型，可以实现GET、POST请求，处理响应数据，上传和下载文件，以及设置Authorization、cookie等。</p> 
<h4>2. 方法说明</h4> 
<h5>2.1 发送GET请求</h5> 
<pre><code>using (HttpClient client = new HttpClient())
{
    HttpResponseMessage response = await client.GetAsync("https://example.com/api/resource");
    // 处理响应
}
</code></pre> 
<h5>2.2 发送POST请求</h5> 
<pre><code>using (HttpClient client = new HttpClient())
{
    var content = new StringContent("data to send", Encoding.UTF8, "application/json");
    HttpResponseMessage response = await client.PostAsync("https://example.com/api/resource", content);
    // 处理响应
}
</code></pre> 
<h5>2.3 上传文件</h5> 
<pre><code>using (HttpClient client = new HttpClient())
{
    var content = new MultipartFormDataContent();
    content.Add(new ByteArrayContent(File.ReadAllBytes("file.txt")), "file", "file.txt");
    HttpResponseMessage response = await client.PostAsync("https://example.com/api/upload", content);
    // 处理响应
}
</code></pre> 
<h5>2.4 下载文件</h5> 
<pre><code>using (HttpClient client = new HttpClient())
{
    byte[] fileData = await client.GetByteArrayAsync("https://example.com/api/download");
    File.WriteAllBytes("downloaded_file.txt", fileData);
}
</code></pre> 
<h5>2.5 设置Authorization</h5> 
<pre><code>using (HttpClient client = new HttpClient())
{
    client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", "your_access_token");
    HttpResponseMessage response = await client.GetAsync("https://example.com/api/resource");
    // 处理响应
}
</code></pre> 
<h5>2.6 设置Cookie</h5> 
<pre><code>using (HttpClient client = new HttpClient())
{
    var cookieContainer = new CookieContainer();
    var handler = new HttpClientHandler { CookieContainer = cookieContainer };
    using (var httpClient = new HttpClient(handler))
    {
        HttpResponseMessage response = await client.GetAsync("https://example.com/api/resource");
        // 处理响应
    }
}
</code></pre> 
<h4>3. 步骤说明</h4> 
<h5>3.1 发送GET请求</h5> 
<ol><li> <p>创建<code>HttpClient</code>实例。</p> </li><li> <p>使用<code>GetAsync</code>方法发送GET请求。</p> </li><li> <p>处理<code>HttpResponseMessage</code>以获取响应数据。</p> </li></ol> 
<h5>3.2 发送POST请求</h5> 
<ol><li> <p>创建<code>HttpClient</code>实例。</p> </li><li> <p>创建<code>StringContent</code>或<code>FormUrlEncodedContent</code>作为请求内容。</p> </li><li> <p>使用<code>PostAsync</code>方法发送POST请求。</p> </li><li> <p>处理<code>HttpResponseMessage</code>以获取响应数据。</p> </li></ol> 
<h5>3.3 上传文件</h5> 
<ol><li> <p>创建<code>HttpClient</code>实例。</p> </li><li> <p>创建<code>MultipartFormDataContent</code>，添加<code>ByteArrayContent</code>作为文件内容。</p> </li><li> <p>使用<code>PostAsync</code>方法发送包含文件的请求。</p> </li><li> <p>处理<code>HttpResponseMessage</code>以获取响应数据。</p> </li></ol> 
<h5>3.4 下载文件</h5> 
<ol><li> <p>创建<code>HttpClient</code>实例。</p> </li><li> <p>使用<code>GetByteArrayAsync</code>方法获取文件的字节数组。</p> </li><li> <p>使用<code>File.WriteAllBytes</code>保存文件。</p> </li></ol> 
<h5>3.5 设置Authorization</h5> 
<ol><li> <p>创建<code>HttpClient</code>实例。</p> </li><li> <p>设置<code>DefaultRequestHeaders.Authorization</code>属性为<code>AuthenticationHeaderValue</code>。</p> </li></ol> 
<h5>3.6 设置Cookie</h5> 
<ol><li> <p>创建<code>HttpClient</code>实例。</p> </li><li> <p>创建<code>CookieContainer</code>和<code>HttpClientHandler</code>实例。</p> </li><li> <p>在<code>HttpClientHandler</code>中设置<code>CookieContainer</code>。</p> </li><li> <p>使用包含<code>HttpClientHandler</code>的<code>HttpClient</code>实例发送请求。</p> </li></ol> 
<h4>4. 实例源代码</h4> 
<pre><code>// 示例代码请根据实际情况修改URL和文件路径

// 发送GET请求
using (HttpClient client = new HttpClient())
{
    HttpResponseMessage response = await client.GetAsync("https://example.com/api/resource");
    // 处理响应
}

// 发送POST请求
using (HttpClient client = new HttpClient())
{
    var content = new StringContent("data to send", Encoding.UTF8, "application/json");
    HttpResponseMessage response = await client.PostAsync("https://example.com/api/resource", content);
    // 处理响应
}

// 上传文件
using (HttpClient client = new HttpClient())
{
    var content = new MultipartFormDataContent();
    content.Add(new ByteArrayContent(File.ReadAllBytes("file.txt")), "file", "file.txt");
    HttpResponseMessage response = await client.PostAsync("https://example.com/api/upload", content);
    // 处理响应
}

// 下载文件
using (HttpClient client = new HttpClient())
{
    byte[] fileData = await client.GetByteArrayAsync("https://example.com/api/download");
    File.WriteAllBytes("downloaded_file.txt", fileData);
}

// 设置Authorization
using (HttpClient client = new HttpClient())
{
    client.DefaultRequestHeaders.Authorization = new AuthenticationHeaderValue("Bearer", "your_access_token");
    HttpResponseMessage response = await client.GetAsync("https://example.com/api/resource");
    // 处理响应
}

// 设置Cookie
using (HttpClient client = new HttpClient())
{
    var cookieContainer = new CookieContainer();
    var handler = new HttpClientHandler { CookieContainer = cookieContainer };
    using (var httpClient = new HttpClient(handler))
    {
        HttpResponseMessage response = await client.GetAsync("https://example.com/api/resource");
        // 处理响应
    }
}
</code></pre> 
<h4>5. 注意事项及建议</h4> 
<ul><li> <p>使用<code>using</code>语句确保及时释放<code>HttpClient</code>资源。</p> </li><li> <p>异步方法应避免在同步上下文中使用，以提高性能。</p> </li><li> <p>注意处理HTTP响应状态码和异常，确保请求的正确执行。</p> </li><li> <p>文件上传和下载时，考虑使用流式传输以节省内存。</p> </li></ul> 
<p>通过<code>HttpClient</code>，我们能够在C#中方便地进行HTTP请求操作，包括GET、POST请求、文件上传和下载，以及设置Authorization、cookie等。确保使用异步操作和适当的异常处理，能够保证请求的稳定性和性能。</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/01b8f3b3aa9ab0055cf79e539c68f010/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java的23种设计模式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4cb8e7c519fc2f1acd697875af72c5d7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python的type()函数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>