<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>艾体宝案例 | 使用Redis和Spring Ai构建rag应用程序 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/d50fb56c6b13f6c3ffe06bd181bfc419/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="艾体宝案例 | 使用Redis和Spring Ai构建rag应用程序">
  <meta property="og:description" content="随着AI技术的不断进步，开发者面临着如何有效利用现有工具和技术来加速开发过程的挑战。Redis与Spring AI的结合为Java开发者提供了一个强大的平台，以便快速构建并部署响应式AI应用。探索这一整合如何通过简化的开发流程，让开发者能够更专注于创新而非底层实现。
一、Spring AI简介 由大型语言模型（LLM）驱动的应用程序中，向量数据库常作为人工智能应用程序的核心存储技术。此类数据库需要支持语义搜索，并为LLM提供相关的上下文环境。
在此之前，通过Spring和Redis来构建人工智能应用程序的选项还相对有限。而最近，Redis作为一种高性能的向量数据库方案，现已引起广泛关注。Spring社区推出了一个名为Spring AI的新项目，旨在简化人工智能应用程序特别是那些涉及向量数据库的应用的开发流程。
下面将介绍如何使用Redis作为向量数据库构建一个Spring AI应用程序，实现检索增强生成（RAG）工作流。
二、检索增强生成 检索增强生成（RAG）是一种结合数据与人工智能模型的技术方法。在RAG工作流中，首先需要将数据加载入向量数据库（例如Redis）。接收到用户查询后，向量数据库会检索出一组与查询相似的文档。这些文档将作为解答用户问题的上下文，并结合用户的查询，通常通过人工智能模型来生成响应。
本例中，我们将利用一个包含各类啤酒信息的数据集进行演示，数据集中包含啤酒的名称、酒精含量（ABV）、国际苦味单位（IBU）和描述等属性。该数据集将被加载到Redis中，以展示RAG工作流的实际应用。
三、代码和依赖关系 可以在GitHub上找到Spring AI和Redis演示的全部代码。
本项目使用了Spring Boot作为Web应用程序的启动依赖项，并结合了Azure OpenAI和Spring AI Redis。
四、数据加载 我们的应用程序将采用提供啤酒信息的JSON文档作为数据来源。每个文档的结构如下：
{ &#34;id&#34;: &#34;00gkb9&#34;, &#34;name&#34;: &#34;Smoked Porter Ale&#34;, &#34;description&#34;: &#34;The Porter Pounder Smoked Porter is a dark rich flavored ale that is made with 5 malts that include smoked and chocolate roasted malts. It has coffee and mocha notes that create a long finish that ends clean with the use of just a bit of dry hopping&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-24T17:45:32+08:00">
    <meta property="article:modified_time" content="2024-04-24T17:45:32+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">艾体宝案例 | 使用Redis和Spring Ai构建rag应用程序</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#40464f;">随着AI技术的不断进步，开发者面临着如何有效利用现有工具和技术来加速开发过程的挑战。Redis与Spring AI的结合为Java开发者提供了一个强大的平台，以便快速构建并部署响应式AI应用。探索这一整合如何通过简化的开发流程，让开发者能够更专注于创新而非底层实现。</span></p> 
<h3 style="margin-left:0pt;text-align:justify;"><strong><strong><span style="color:#000000;"><strong>一、Spring AI</strong></span></strong><strong><span style="color:#000000;"><strong>简介</strong></span></strong></strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#40464f;">由大型语言模型（LLM）驱动的应用程序中，向量数据库常作为人工智能应用程序的核心存储技术。此类数据库需要支持语义搜索，并为LLM提供相关的上下文环境。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#40464f;">在此之前，通过Spring和Redis来构建人工智能应用程序的选项还相对有限。而最近，Redis作为一种高性能的向量数据库方案，现已引起广泛关注。Spring社区推出了一个名为Spring AI的新项目，旨在简化人工智能应用程序特别是那些涉及向量数据库的应用的开发流程。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#40464f;"><strong>下面将介绍如何使用Redis作为向量数据库构建一个Spring AI应用程序，实现检索增强生成（RAG）工作流。</strong></span></strong></p> 
<h3 style="margin-left:0pt;text-align:justify;"><strong><strong><span style="color:#000000;"><strong>二、</strong></span></strong><strong><span style="color:#000000;"><strong>检索增强生成</strong></span></strong></strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#40464f;"><strong>检索增强生成（RAG）是一种结合数据与人工智能模型的技术方法。在RAG工作流中，首先需要将数据加载入向量数据库（例如Redis）。接收到用户查询后，向量数据库会检索出一组与查询相似的文档。这些文档将作为解答用户问题的上下文，并结合用户的查询，通常通过人工智能模型来生成响应。</strong></span></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#40464f;">本例中，我们将利用一个包含各类啤酒信息的数据集进行演示，数据集中包含啤酒的名称、酒精含量（ABV）、国际苦味单位（IBU）和描述等属性。该数据集将被加载到Redis中，以展示RAG工作流的实际应用。</span></p> 
<h3 style="margin-left:0pt;text-align:justify;"><strong><strong><span style="color:#000000;"><strong>三、</strong></span></strong><strong><span style="color:#000000;"><strong>代码和依赖关系</strong></span></strong></strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#40464f;">可以在GitHub上找到</span><a href="https://github.com/redis-developer/spring-ai-redis-demo" title="Spring AI和Redis演示">Spring AI和Redis演示</a><span style="color:#40464f;">的全部代码。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#40464f;">本项目使用了Spring Boot作为Web应用程序的启动依赖项，并结合了Azure OpenAI和Spring AI Redis。</span></p> 
<h3 style="margin-left:0pt;text-align:justify;"><strong><strong><span style="color:#000000;"><strong>四、</strong></span></strong><strong><span style="color:#000000;"><strong>数据加载</strong></span></strong></strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#40464f;">我们的应用程序将采用提供啤酒信息的JSON文档作为数据来源。每个文档的结构如下：</span></p> 
<pre><code class="hljs">{
  "id": "00gkb9",
  "name": "Smoked Porter Ale",
  "description": "The Porter Pounder Smoked Porter is a dark rich flavored ale that is made with 5 malts that include smoked and chocolate roasted malts. It has coffee and mocha notes that create a long finish that ends clean with the use of just a bit of dry hopping",
  "abv": 8,
  "ibu": 36
}</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#40464f;">为了将啤酒数据集加载到 Redis 中，我们将使用 RagDataLoader 类。该类包含一个方法，在应用程序启动时执行。在该方法中，我们使用一个 JsonReader 来解析数据集，然后使用自动连接的 VectorStore 将文档插入 Redis。</span></p> 
<pre><code class="language-java">// Create a JSON reader with fields relevant to our use case
JsonReader loader = new JsonReader(file, "name", "abv", "ibu", "description");
// Use the autowired VectorStore to insert the documents into Redis
vectorStore.add(loader.get());</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#40464f;">至此，我们得到了一个包含约 22,000 种啤酒及其相应嵌入的数据集。</span></p> 
<h3 style="margin-left:0pt;text-align:justify;"><strong><strong><span style="color:#000000;"><strong>五、</strong></span></strong><strong><span style="color:#000000;"><strong>RAG Service</strong></span></strong></strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#40464f;">RagService 类实现了 RAG 工作流程。当收到用户提示时，会调用 retrieve 方法，执行以下步骤：</span></p> 
<ol><li style="text-align:justify;"><span style="color:#40464f;">计算用户提示的向量</span></li><li style="text-align:justify;"><span style="color:#40464f;">查询 Redis 数据库，检索最相关的文档</span></li><li style="text-align:justify;"><span style="color:#40464f;">使用检索到的文档和用户提示构建一个提示信息</span></li><li style="text-align:justify;"><span style="color:#40464f;">使用提示调用聊天客户端以生成响应</span></li></ol> 
<pre><code class="language-java">public Generation retrieve(String message) {
    SearchRequest request = SearchRequest.query(message).withTopK(topK);
    // Query Redis for the top K documents most relevant to the input message
    List&lt;Document&gt; docs = store.similaritySearch(request);
    Message systemMessage = getSystemMessage(docs);
    UserMessage userMessage = new UserMessage(message);
    // Assemble the complete prompt using a template
    Prompt prompt = new Prompt(List.of(systemMessage, userMessage));
    // Call the autowired chat client with the prompt
    ChatResponse response = client.call(prompt);
    return response.getResult();
}</code></pre> 
<h3 style="margin-left:0pt;text-align:justify;"><strong><strong><span style="color:#000000;"><strong>六、</strong></span></strong><strong><span style="color:#000000;"><strong>Controller</strong></span></strong></strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#40464f;">现在我们已经实现了 RAG 服务，可以将其封装在 HTTP 端点中。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#40464f;">RagController 类将服务作为 POST 端点公开：</span></p> 
<pre><code class="language-java">@PostMapping("/chat/{chatId}")
@ResponseBody
public Message chatMessage(@PathVariable("chatId") String chatId, @RequestBody Prompt prompt) {
    // Extract the user prompt from the body and pass it to the autowired RagService
    Generation generation = ragService.retrieve(prompt.getPrompt());
    // Reply with the generated message
    return Message.of(generation.getOutput().getContent());
}</code></pre> 
<h3 style="margin-left:0pt;text-align:justify;"><strong><strong><span style="color:#000000;"><strong>七、</strong></span></strong><strong><span style="color:#000000;"><strong>用户界面 </strong></span></strong></strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#40464f;">在用户界面方面，创建一个简单的 React 前端，允许用户提出有关啤酒的问题。前端通过向 /chat/{chatId} 端点发送 HTTP 请求并显示响应来与 Spring 后端交互。</span></p> 
<p class="img-center"><img alt="" height="274" src="https://images2.imgbox.com/ad/fd/BMH3EwAH_o.png" width="553"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#40464f;">仅通过简单的几个类，我们就用 Spring AI 和 Redis 实现了一个 RAG 应用程序。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#40464f;">若要更进一步，我们建议您</span><a href="https://github.com/redis-developer/spring-ai-redis-demo" title="查看 Github 上的示例代码">查看 Github 上的示例代码</a><span style="color:#40464f;">。将 Redis 的高效和易用性与 Spring AI 提供的便捷抽象相结合，Java 开发人员使用 Spring 构建响应式 AI 应用程序将变得更加容易。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#40464f;">有关向量数据库的更多信息，欢迎与我们沟通交流~</span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/07f6f1cd1f847c7d11bf89d66c9653b3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spring Boot整合Redisson的两种方式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2018a637862b8a5e847bbbe878885bde/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">支付宝无限实名技术（纯好奇），解决异地收款限制，解决无号可用的困境</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>