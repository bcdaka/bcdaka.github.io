<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>懒人福音：Java版Webhook机器人，一键开启‘躺赢’模式 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/88cb4076b5af1bb34fd8fef356173493/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="懒人福音：Java版Webhook机器人，一键开启‘躺赢’模式">
  <meta property="og:description" content="0. 前言 Webhook是一种网络回调机制，允许一个应用程序在特定事件发生时通知另一个应用程序。这种通知通常是通过HTTP POST请求发送给预先设定的URL（即Webhook端点）。当事件触发时，如数据库更新、文件上传完成、支付确认等，源系统会向目标URL发送数据。这种方式使得两个系统能够实时交互，而不需要定期轮询。
企业微信、飞书、钉钉等企业级协作工具中的自定义机器人功能，常常使用Webhook作为实现自动消息传递的核心机制。在当今快速发展的数字化时代，自动化和即时通讯成为了提升工作效率的关键因素。企业微信、飞书、钉钉等协作平台凭借其强大的沟通和管理功能，已经成为许多企业和组织日常运营的基石。然而，随着业务需求的日益复杂，仅仅依赖平台的基础功能已无法满足定制化和自动化的高级需求。因此，Webhook在这些平台中扮演了桥梁的角色，使得自定义机器人能够与外部服务进行实时通信，实现更高级的自动化功能。
让我们一起踏上这段旅程，解锁Webhook自定义机器人的无限潜力，让自动化成为推动企业创新和成长的新动力。
1. 企业微信（WeCom） 1.1 在群组中添加自定义机器人 首先你得有一个企业微信群。然后才能邀请自定义机器人进群。我这里已经创建好了。
点击自定义机器人就可以看到详情：
特别特别要注意：一定要保护好机器人的webhook地址，避免泄漏！不要分享到github、博客等可被公开查阅的地方，否则坏人就可以用你的机器人来发垃圾消息了。
可以在终端先试下curl命令，这里直接填入URL即可正常执行！
1.2 测试调用自定义机器人的 webhook 地址，向所在群组发送消息。 官方网址：https://developer.work.weixin.qq.com/document/path/99110
仔细查看文档，重点看curl的请求参数命令。 代码实现。代码实际上就是在模拟curl命令这个过程，只不过不同的Webhook规范不一样，需要查看官方API文档。 注意：这里在模拟的时候，需要引入两个依赖。这两个Maven依赖项分别用于处理编码解码操作和HTTP请求
&lt;/dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;commons-codec&lt;/groupId&gt; &lt;artifactId&gt;commons-codec&lt;/artifactId&gt; &lt;version&gt;1.11&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.squareup.okhttp3&lt;/groupId&gt; &lt;artifactId&gt;okhttp&lt;/artifactId&gt; &lt;version&gt;4.9.1&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; import okhttp3.*; import java.io.IOException; /** * @author Juechen * @version : WeComWebhookSender.java */ public class WeComWebhookSender { private static void WeCom(String url, String text) { OkHttpClient client = new OkHttpClient(); String webhookUrl = url; String payload = &#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-13T10:38:44+08:00">
    <meta property="article:modified_time" content="2024-07-13T10:38:44+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">懒人福音：Java版Webhook机器人，一键开启‘躺赢’模式</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="0__0"></a>0. 前言</h2> 
<p><strong>Webhook</strong>是一种网络回调机制，允许一个应用程序在特定事件发生时通知另一个应用程序。这种通知通常是通过HTTP <strong>POST</strong>请求发送给预先设定的URL（即Webhook端点）。当事件触发时，如数据库更新、文件上传完成、支付确认等，源系统会向<strong>目标URL</strong>发送数据。这种方式使得两个系统能够实时交互，而不需要定期轮询。</p> 
<p><strong>企业微信</strong>、<strong>飞书</strong>、<strong>钉钉</strong>等企业级协作工具中的<strong>自定义机器人</strong>功能，常常使用Webhook作为实现自动消息传递的核心机制。在当今快速发展的数字化时代，自动化和即时通讯成为了提升工作效率的关键因素。企业微信、飞书、钉钉等协作平台凭借其强大的沟通和管理功能，已经成为许多企业和组织日常运营的基石。然而，随着业务需求的日益复杂，仅仅依赖平台的基础功能已无法满足定制化和自动化的高级需求。因此，<strong>Webhook</strong>在这些平台中扮演了桥梁的角色，使得自定义机器人能够与外部服务进行实时通信，实现更高级的自动化功能。</p> 
<p>让我们一起踏上这段旅程，解锁<strong>Webhook</strong>自定义机器人的无限潜力，让自动化成为推动企业创新和成长的新动力。</p> 
<h2><a id="1_WeCom_6"></a>1. 企业微信（WeCom）</h2> 
<h3><a id="11__7"></a>1.1 在群组中添加自定义机器人</h3> 
<ol><li>首先你得有一个企业微信群。然后才能邀请自定义机器人进群。我这里已经创建好了。<br> <img src="https://images2.imgbox.com/fd/1c/3Hs4mGHC_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/cf/90/IwHhzsh2_o.png" alt="在这里插入图片描述"></li><li>点击自定义机器人就可以看到详情：<br> <img src="https://images2.imgbox.com/39/6f/wX7eAvzq_o.png" alt="在这里插入图片描述"></li></ol> 
<blockquote> 
 <p>特别特别要注意：一定要保护好机器人的webhook地址，避免泄漏！不要分享到github、博客等可被公开查阅的地方，否则坏人就可以用你的机器人来发垃圾消息了。</p> 
</blockquote> 
<ol start="3"><li>可以在终端先试下curl命令，这里直接填入URL即可正常执行！<br> <img src="https://images2.imgbox.com/bc/eb/bgNMuH0L_o.png" alt="在这里插入图片描述"></li></ol> 
<h3><a id="12__webhook__20"></a>1.2 测试调用自定义机器人的 webhook 地址，向所在群组发送消息。</h3> 
<p>官方网址：<a href="https://developer.work.weixin.qq.com/document/path/99110" rel="nofollow">https://developer.work.weixin.qq.com/document/path/99110</a></p> 
<ol><li>仔细查看文档，重点看curl的请求参数命令。</li></ol> 
<p><img src="https://images2.imgbox.com/68/10/kmmFfYjO_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li>代码实现。代码实际上就是在模拟curl命令这个过程，只不过不同的Webhook规范不一样，需要查看官方API文档。</li></ol> 
<p><strong>注意</strong>：这里在模拟的时候，需要引入两个依赖。这两个Maven依赖项分别用于处理编码解码操作和HTTP请求</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-codec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-codec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.squareup.okhttp3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>okhttp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.9.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">okhttp3<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author Juechen
 * @version : WeComWebhookSender.java
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeComWebhookSender</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">WeCom</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">OkHttpClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OkHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> webhookUrl <span class="token operator">=</span> url<span class="token punctuation">;</span>

        <span class="token class-name">String</span> payload <span class="token operator">=</span> <span class="token string">"{\"msgtype\": \"text\",\"text\": {\"content\": \""</span> <span class="token operator">+</span> text <span class="token operator">+</span> <span class="token string">"\"}}"</span><span class="token punctuation">;</span>

        <span class="token class-name">RequestBody</span> requestBody <span class="token operator">=</span> <span class="token class-name">RequestBody</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"application/json; charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Request</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span>webhookUrl<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Response</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newCall</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span><span class="token function">isSuccessful</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">"Unexpected code "</span> <span class="token operator">+</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">"https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxxxxxxxxxx"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token string">"企业微信，共创未来！"</span><span class="token punctuation">;</span>

        <span class="token class-name">WeCom</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<ol start="3"><li>返回企业微信，消息发送成功！<br> <img src="https://images2.imgbox.com/31/85/5Ro0L66F_o.png" alt="在这里插入图片描述"></li></ol> 
<h2><a id="2_Lark_98"></a>2. 飞书（Lark）</h2> 
<h3><a id="21__99"></a>2.1 在群组中添加自定义机器人</h3> 
<ol><li> <p>邀请自定义机器人进群。我这里已经创建好了。<br> <img src="https://images2.imgbox.com/b4/49/yXMMh6te_o.png" alt="在这里插入图片描述"></p> </li><li> <p>获取自定义机器人的 webhook 地址以及加密密钥。详情点击<code>帮助文档</code>链接。<br> <img src="https://images2.imgbox.com/d6/81/4gjqYdZD_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<blockquote> 
 <p>请妥善保存好此 webhook 地址，不要公布在 Gitlab、博客等可公开查阅的网站上，避免地址泄露后被恶意调用发送垃圾消息。</p> 
</blockquote> 
<h3><a id="22__webhook__109"></a>2.2 测试调用自定义机器人的 webhook 地址，向所在群组发送消息。</h3> 
<p>官方网址：<a href="https://open.feishu.cn/document/client-docs/bot-v3/add-custom-bot" rel="nofollow">https://open.feishu.cn/document/client-docs/bot-v3/add-custom-bot</a></p> 
<ol><li>仔细查看文档，重点看curl的请求参数命令以及加密密钥的签名算法方法。<br> <img src="https://images2.imgbox.com/cb/d7/OICE4VbY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e8/19/fryM7t0n_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0d/6e/z2KXI0PD_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/aa/74/iD8e8kpQ_o.png" alt="在这里插入图片描述"></li><li>代码实现。代码实际上就是在模拟curl命令这个过程，只不过不同的Webhook规范不一样，需要查看官方API文档。签名方法直接复制即可！</li></ol> 
<p><strong>注意</strong>：这里在模拟的时候，需要引入两个依赖。这两个Maven依赖项分别用于处理编码解码操作和HTTP请求</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-codec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-codec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.squareup.okhttp3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>okhttp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.9.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">okhttp3<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">Mac</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">SecretKeySpec</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">InvalidKeyException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">NoSuchAlgorithmException</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>binary<span class="token punctuation">.</span></span><span class="token class-name">Base64</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author Juechen
 * @version : LarkWebhookSender.java
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LarkWebhookSender</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">HMAC_SHA256_ALGORITHM</span> <span class="token operator">=</span> <span class="token string">"HmacSHA256"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">Lark</span><span class="token punctuation">(</span><span class="token class-name">String</span> secretKey<span class="token punctuation">,</span> <span class="token class-name">String</span> url<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchAlgorithmException</span><span class="token punctuation">,</span> <span class="token class-name">InvalidKeyException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">OkHttpClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OkHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> webhookUrl <span class="token operator">=</span> url<span class="token punctuation">;</span>
        <span class="token class-name">String</span> secret <span class="token operator">=</span> secretKey<span class="token punctuation">;</span>
        <span class="token keyword">int</span> timestamp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> signature <span class="token operator">=</span> <span class="token class-name">GenSign</span><span class="token punctuation">(</span>secret<span class="token punctuation">,</span> timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> payload <span class="token operator">=</span> <span class="token string">"{\"timestamp\": \""</span> <span class="token operator">+</span> timestamp <span class="token operator">+</span> <span class="token string">"\",\"sign\": \""</span> <span class="token operator">+</span> signature <span class="token operator">+</span> <span class="token string">"\",\"msg_type\":\"text\",\"content\":{\"text\":\"飞书，天下无敌！\"}}"</span><span class="token punctuation">;</span>
        <span class="token class-name">RequestBody</span> body <span class="token operator">=</span> <span class="token class-name">RequestBody</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"application/json; charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Request</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span>webhookUrl<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Response</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newCall</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span><span class="token function">isSuccessful</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">"Unexpected code "</span> <span class="token operator">+</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token class-name">GenSign</span><span class="token punctuation">(</span><span class="token class-name">String</span> secret<span class="token punctuation">,</span> <span class="token keyword">int</span> timestamp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchAlgorithmException</span><span class="token punctuation">,</span> <span class="token class-name">InvalidKeyException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> stringToSign <span class="token operator">=</span> timestamp <span class="token operator">+</span> <span class="token string">"\n"</span> <span class="token operator">+</span> secret<span class="token punctuation">;</span>
        <span class="token class-name">Mac</span> mac <span class="token operator">=</span> <span class="token class-name">Mac</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token constant">HMAC_SHA256_ALGORITHM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mac<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>stringToSign<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">HMAC_SHA256_ALGORITHM</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> signData <span class="token operator">=</span> mac<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">encodeBase64</span><span class="token punctuation">(</span>signData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchAlgorithmException</span><span class="token punctuation">,</span> <span class="token class-name">InvalidKeyException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> webhookUrl <span class="token operator">=</span> <span class="token string">"https://open.feishu.cn/open-apis/bot/v2/hook/xxxxxxxx"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> secret <span class="token operator">=</span> <span class="token string">"xxxxxxxx"</span><span class="token punctuation">;</span>

        <span class="token class-name">Lark</span><span class="token punctuation">(</span>secret<span class="token punctuation">,</span> webhookUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>返回飞书客户端，消息发送成功！<br> <img src="https://images2.imgbox.com/1c/db/ah59itxK_o.png" alt="在这里插入图片描述"></li><li>想在终端试下curl命令，为上面代码添加输出<code>timestamp</code>和<code>signature</code>的逻辑即可正常执行！注意拼接方式与钉钉的不同！<br> <img src="https://images2.imgbox.com/24/6a/SY8GZdM4_o.png" alt="在这里插入图片描述"></li></ol> 
<h2><a id="3_DingTalk_206"></a>3. 钉钉（DingTalk）</h2> 
<h3><a id="31__207"></a>3.1 在群组中添加自定义机器人</h3> 
<ol><li> <p>邀请自定义机器人进群。我这里已经创建好了。<br> <img src="https://images2.imgbox.com/cd/04/e2b3KpPl_o.png" alt="在这里插入图片描述"></p> </li><li> <p>获取自定义机器人的 webhook 地址以及加密密钥。详情点击<code>查看文档</code>链接。<br> <img src="https://images2.imgbox.com/16/fd/TOfQPHmI_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<blockquote> 
 <p>请保管好此 Webhook 地址，不要公布在外部网站上，泄露有安全风险。</p> 
</blockquote> 
<h3><a id="32__webhook__216"></a>3.2 测试调用自定义机器人的 webhook 地址，向所在群组发送消息。</h3> 
<p>官方文档：<br> <a href="https://open.dingtalk.com/document/orgapp/customize-robot-security-settings" rel="nofollow">https://open.dingtalk.com/document/orgapp/customize-robot-security-settings</a><br> <a href="https://open.dingtalk.com/document/orgapp/custom-bot-to-send-group-chat-messages" rel="nofollow">https://open.dingtalk.com/document/orgapp/custom-bot-to-send-group-chat-messages</a></p> 
<ol><li> <p>仔细查看文档，重点看curl的请求参数命令以及加密密钥的签名算法方法。<br> <img src="https://images2.imgbox.com/52/82/KUG3K9NN_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f0/7c/HfoJd1r7_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1d/2e/hMZkk59G_o.png" alt="在这里插入图片描述"></p> </li><li> <p>代码实现。代码实际上就是在模拟curl命令这个过程，只不过不同的Webhook规范不一样，需要查看官方API文档。这里我们不用官方<code>alibaba-dingtalk-service-sdk</code>这个依赖了，用通用的<code>com.squareup.okhttp3</code>实现即可。</p> </li></ol> 
<p><strong>注意</strong>：这里在模拟的时候，需要引入两个依赖。这两个Maven依赖项分别用于处理编码解码操作和HTTP请求</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-codec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-codec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.squareup.okhttp3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>okhttp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.9.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">okhttp3<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">UnsupportedEncodingException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URLEncoder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">InvalidKeyException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">NoSuchAlgorithmException</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">Mac</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">SecretKeySpec</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>binary<span class="token punctuation">.</span></span><span class="token class-name">Base64</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author Juechen
 * @version : DingTalkWebhookSender.java
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DingTalkWebhookSender</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">HMAC_SHA256_ALGORITHM</span> <span class="token operator">=</span> <span class="token string">"HmacSHA256"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">DingTalk</span><span class="token punctuation">(</span><span class="token class-name">String</span> access_token<span class="token punctuation">,</span> <span class="token class-name">String</span> secretKey<span class="token punctuation">,</span> <span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchAlgorithmException</span><span class="token punctuation">,</span> <span class="token class-name">UnsupportedEncodingException</span><span class="token punctuation">,</span> <span class="token class-name">InvalidKeyException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">OkHttpClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OkHttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> secret <span class="token operator">=</span> secretKey<span class="token punctuation">;</span>
        <span class="token class-name">Long</span> timestamp <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> sign <span class="token operator">=</span> <span class="token function">generateSign</span><span class="token punctuation">(</span>secret<span class="token punctuation">,</span> timestamp<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> webhookUrl <span class="token operator">=</span> access_token <span class="token operator">+</span> <span class="token string">"&amp;sign="</span> <span class="token operator">+</span> sign <span class="token operator">+</span> <span class="token string">"&amp;timestamp="</span> <span class="token operator">+</span> timestamp<span class="token punctuation">;</span>


        <span class="token class-name">String</span> payload <span class="token operator">=</span> <span class="token string">"{\"msgtype\": \"text\",\"text\": {\"content\": \""</span> <span class="token operator">+</span> text <span class="token operator">+</span> <span class="token string">"\"}}"</span><span class="token punctuation">;</span>
        <span class="token class-name">RequestBody</span> requestBody <span class="token operator">=</span> <span class="token class-name">RequestBody</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"application/json; charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Request</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">url</span><span class="token punctuation">(</span>webhookUrl<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>requestBody<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Response</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">newCall</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span><span class="token function">isSuccessful</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">"Unexpected code "</span> <span class="token operator">+</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">generateSign</span><span class="token punctuation">(</span><span class="token class-name">String</span> secret<span class="token punctuation">,</span> <span class="token class-name">Long</span> timestamp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchAlgorithmException</span><span class="token punctuation">,</span> <span class="token class-name">UnsupportedEncodingException</span><span class="token punctuation">,</span> <span class="token class-name">InvalidKeyException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> stringToSign <span class="token operator">=</span> timestamp <span class="token operator">+</span> <span class="token string">"\n"</span> <span class="token operator">+</span> secret<span class="token punctuation">;</span>
        <span class="token class-name">Mac</span> mac <span class="token operator">=</span> <span class="token class-name">Mac</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token constant">HMAC_SHA256_ALGORITHM</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mac<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>secret<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"HmacSHA256"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> signData <span class="token operator">=</span> mac<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>stringToSign<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">encodeBase64</span><span class="token punctuation">(</span>signData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">UnsupportedEncodingException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchAlgorithmException</span><span class="token punctuation">,</span> <span class="token class-name">InvalidKeyException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> secret <span class="token operator">=</span> <span class="token string">"xxxxxxxxx"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> access_token <span class="token operator">=</span> <span class="token string">"https://oapi.dingtalk.com/robot/send?access_token=xxxxxxxxxx"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token string">"钉钉，让进步发生！"</span><span class="token punctuation">;</span>

        <span class="token class-name">DingTalk</span><span class="token punctuation">(</span>access_token<span class="token punctuation">,</span> secret<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>返回钉钉客户端，消息发送成功！<br> <img src="https://images2.imgbox.com/80/57/xBQri7xD_o.png" alt="在这里插入图片描述"></li><li>想在终端试下curl命令，为上面代码添加输出<code>timestamp</code>和<code>sign</code>的逻辑即可正常执行！注意拼接方式与飞书的不同！<br> <img src="https://images2.imgbox.com/67/e3/pm4G1L2P_o.png" alt="在这里插入图片描述"></li></ol> 
<h2><a id="4_320"></a>4.小结</h2> 
<p>在本文中，我们深入探讨了如何运用<strong>Java</strong>编程语言和<strong>Webhook</strong>技术，构建功能强大的自定义机器人，以自动化企业微信、飞书、钉钉等协作平台上的工作流程。这一旅程不仅是技术上的挑战，也是对现代企业自动化需求的深刻理解。本文只是对简单的<code>TEXT</code>文本类型进行了编写，你也可以查阅官方文档，添加更多的发送消息类型（Link链接消息、Markdown 类型、图片类型等等）。</p> 
<p>总之，Java版Webhook机器人是技术与创意的结晶，它不仅能够简化日常工作，还能够激发新的业务模式和增长点。随着你对这一领域的深入了解和实践，相信你会发掘出更多令人惊喜的应用场景，让自动化的力量成为推动企业前进的强大引擎。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6f51aeb7c61008853cf1cc2fd4698bcd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python 字典（Dict）详解与实战应用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8500f6dc5dd4631b07a8d98d486f1189/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SQL Server 创建用户并授权</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>