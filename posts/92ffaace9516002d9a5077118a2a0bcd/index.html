<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringMVCæºç è§£æ(äºŒ)ï¼šè¯·æ±‚æ‰§è¡Œæµç¨‹ - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/92ffaace9516002d9a5077118a2a0bcd/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="SpringMVCæºç è§£æ(äºŒ)ï¼šè¯·æ±‚æ‰§è¡Œæµç¨‹">
  <meta property="og:description" content="SpringMVCæºç ç³»åˆ—æ–‡ç« 
SpringMVCæºç è§£æ(ä¸€)ï¼šwebå®¹å™¨å¯åŠ¨æµç¨‹
SpringMVCæºç è§£æ(äºŒ)ï¼šè¯·æ±‚æ‰§è¡Œæµç¨‹
ç›®å½• å‰è¨€DispatcherServletå…¥å£ä¸€ã€è·å–HandlerExcutionChain(åŒ…æ‹¬Handler)1ã€è·å–Handler1.1ã€é€šè¿‡requestè·å–æŸ¥æ‰¾è·¯å¾„1.2ã€é€šè¿‡æŸ¥æ‰¾è·¯å¾„è·å–HandlerMethod 2ã€è·å–æ‰§è¡Œé“¾(åŒ…æ‹¬Handlerã€æ‹¦æˆªå™¨) äºŒã€è·å–é€‚é…å™¨ä¸‰ã€æ‰§è¡ŒHandlerï¼ˆğŸ”¥é‡ç‚¹ï¼‰1ã€è·å–è¯·æ±‚å‚æ•°1.1ã€è·å–å‚æ•°è§£æå™¨1.2ã€è§£æ@RequestBodeyè¯·æ±‚å‚æ•°1.2.1ã€æ¶ˆæ¯è½¬æ¢å™¨1.2.2ã€RequestBodyAdviceè¯·æ±‚å¢å¼ºå™¨ 2ã€æ‰§è¡ŒControllerå…·ä½“é€»è¾‘æ–¹æ³•3ã€è¿”å›å¯¹è±¡è½¬ä¸ºå“åº”ä¿¡æ¯(json)3.1ã€è·å–è¿”å›å€¼å¤„ç†å™¨3.2ã€è¿”å›å€¼å¤„ç†å™¨å¤„ç†æ–¹æ³•3.2.1ã€æ¶ˆæ¯è½¬æ¢å™¨3.2.2ã€ResponseBodyAdviceå“åº”å¢å¼ºå™¨ å››ã€æ‹¦æˆªå™¨1ã€æ‰§è¡Œæ‹¦æˆªå™¨preHandleæ–¹æ³•2ã€æ‰§è¡Œæ‹¦æˆªå™¨postHandleæ–¹æ³•3ã€æ‰§è¡Œæ‹¦æˆªå™¨afterCompletionæ–¹æ³• äº”ã€å¼‚å¸¸å¤„ç†å™¨æ€»ç»“ å‰è¨€ å‰æ–‡ä¸­æˆ‘ä»¬ä»‹ç»äº†SpringMVCå®¹å™¨çš„å¯åŠ¨ï¼ŒåŒ…æ‹¬å‰ç«¯æ§åˆ¶å™¨DispatcherServletå¯¹è±¡çš„åˆ›å»ºï¼Œè¿‡æ»¤å™¨æ·»åŠ åˆ°Tomcatå®¹å™¨çš„è¿‡æ»¤å™¨é›†åˆä¸­ï¼Œå°†æ‰€æœ‰æ‹¦æˆªå™¨ã€è·¨åŸŸé…ç½®ã€æ¶ˆæ¯è½¬æ¢å™¨ç­‰é…ç½®ç»Ÿä¸€æ·»åŠ åˆ°å„è‡ªé›†åˆä¸­ï¼Œè§£æ@RequestMappingæ³¨è§£ç”Ÿæˆè¯·æ±‚è·¯å¾„å’ŒControlleræ–¹æ³•çš„æ˜ å°„mapã€‚æœ¬ç« æ¥ç ”ç©¶ä¸‹è¯·æ±‚çš„æ‰§è¡Œè¿‡ç¨‹ã€‚
è¯´åˆ°è¯·æ±‚è¿‡ç¨‹ï¼Œé‚£ä¹ˆå¾—å…ˆè¯´ä¸‹å…¥å£åœ¨å“ªé‡Œï¼Ÿå…¥å£è‚¯å®šæ˜¯ç»Ÿä¸€åˆ†å‘è¯·æ±‚ç»™å¤„ç†ç¨‹åºçš„DispatcherServletï¼ŒDispatcherServletå½’æ ¹ç»“åº•ä¹Ÿæ˜¯Servletã€‚Tomcaté€šè¿‡è¯·æ±‚Mappingæ˜ å°„å’ŒServeltå¯¹åº”å…³ç³»æ‰¾åˆ°Serveltï¼Œè°ƒç”¨Serveltä¹‹å‰ä¼šæ‰§è¡Œè¿‡æ»¤å™¨é“¾ï¼Œæ‰€æœ‰è¿‡æ»¤å™¨æ”¾è¡Œæ‰ä¼šèµ°åˆ°ServeltçœŸæ­£çš„æ‰§è¡Œé€»è¾‘ã€‚
ä¾ç…§å¸¸è§çš„postè¯·æ±‚ä¸ºä¾‹ // æ¥å—Userå¯¹è±¡å¹¶è¿”å› @PostMapping(&#34;/test&#34;) @ResponseBody public User test(@RequestBody User user) { user.setName(&#34;æå››&#34;); System.out.println(user); return user; } æ–¹æ³•æ ˆè°ƒç”¨é“¾ HttpServelt#serviceåˆ†æ°´å²­doPostæ–¹æ³•ï¼Œåªè¦æ‰¾åˆ°DispatcherServelté‡å†™çš„doPostæ–¹æ³•å°±æ˜¯å…¥å£äº† æœ¬æ–‡å°±ä¸è®²è¿‡æ»¤å™¨çš„è°ƒç”¨äº†ï¼Œå› ä¸ºä»DispatcherServeltå¼€å§‹ï¼Œè¿‡æ»¤å™¨é“¾å·²ç»æ‰§è¡Œå®Œæˆï¼Œä¹‹å‰æ–‡ç« Tomcatæºç è§£æ(å…«)ï¼šä¸€ä¸ªè¯·æ±‚çš„æ‰§è¡Œæµç¨‹ï¼ˆé™„Tomcatæ•´ä½“æ€»ç»“ï¼‰æœ‰ä»‹ç»è¿‡ã€‚
DispatcherServletå…¥å£ DispatcherServletçš„ç±»å›¾å¦‚ä¸‹ï¼š
ä»doPoståˆ°doDispatchæ–¹æ³•
doPostæ–¹æ³•æ˜¯ç”±DispatcherServeltçš„çˆ¶ç±»FrameworkServletå®ç°çš„ä¸è®ºpostè¿˜æ˜¯getè¯·æ±‚éƒ½æ˜¯è°ƒç”¨åŒä¸€ä¸ªæ–¹æ³•processRequest(request, response)å¯¹äºæ–¹æ³•å‚æ•°requestå’Œresponséƒ½æ˜¯Tomcatå®¹å™¨åˆ›å»ºçš„ï¼Œä»¥å‰æ–‡ç« Tomcatæºç è§£æ(ä¸ƒ)ï¼šåº•å±‚å¦‚ä½•è·å–è¯·æ±‚urlã€è¯·æ±‚å¤´ã€jsonæ•°æ®ï¼Ÿæœ‰å…·ä½“ä»‹ç» ä¸»è¦æ–¹æ³•doService(request, response) // FrameworkServletç±»æ–¹æ³• protected final void processRequest(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { long startTime = System.currentTimeMillis(); Throwable failureCause = null; ... try { doService(request, response); } catch (ServletException | IOException ex) { failureCause = ex; throw ex; } catch (Throwable ex) { failureCause = ex; throw new NestedServletException(&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-29T07:00:00+08:00">
    <meta property="article:modified_time" content="2024-07-29T07:00:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringMVCæºç è§£æ(äºŒ)ï¼šè¯·æ±‚æ‰§è¡Œæµç¨‹</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><font size="5"><strong>SpringMVCæºç ç³»åˆ—æ–‡ç« </strong></font></p> 
<p><a href="https://xuchang.blog.csdn.net/article/details/134139936" rel="nofollow">SpringMVCæºç è§£æ(ä¸€)ï¼šwebå®¹å™¨å¯åŠ¨æµç¨‹</a></p> 
<p><a href="https://xuchang.blog.csdn.net/article/details/140209209" rel="nofollow">SpringMVCæºç è§£æ(äºŒ)ï¼šè¯·æ±‚æ‰§è¡Œæµç¨‹</a></p> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>ç›®å½•</h4> 
 <ul><li><a href="#_10" rel="nofollow">å‰è¨€</a></li><li><a href="#DispatcherServlet_40" rel="nofollow">DispatcherServletå…¥å£</a></li><li><a href="#HandlerExcutionChainHandler_203" rel="nofollow">ä¸€ã€è·å–HandlerExcutionChain(åŒ…æ‹¬Handler)</a></li><li><ul><li><a href="#1Handler_275" rel="nofollow">1ã€è·å–Handler</a></li><li><ul><li><a href="#11request_317" rel="nofollow">1.1ã€é€šè¿‡requestè·å–æŸ¥æ‰¾è·¯å¾„</a></li><li><a href="#12HandlerMethod_323" rel="nofollow">1.2ã€é€šè¿‡æŸ¥æ‰¾è·¯å¾„è·å–HandlerMethod</a></li></ul> 
   </li><li><a href="#2Handler_359" rel="nofollow">2ã€è·å–æ‰§è¡Œé“¾(åŒ…æ‹¬Handlerã€æ‹¦æˆªå™¨)</a></li></ul> 
  </li><li><a href="#_404" rel="nofollow">äºŒã€è·å–é€‚é…å™¨</a></li><li><a href="#Handler_461" rel="nofollow">ä¸‰ã€æ‰§è¡ŒHandlerï¼ˆğŸ”¥é‡ç‚¹ï¼‰</a></li><li><ul><li><a href="#1_531" rel="nofollow">1ã€è·å–è¯·æ±‚å‚æ•°</a></li><li><ul><li><a href="#11_572" rel="nofollow">1.1ã€è·å–å‚æ•°è§£æå™¨</a></li><li><a href="#12RequestBodey_615" rel="nofollow">1.2ã€è§£æ@RequestBodeyè¯·æ±‚å‚æ•°</a></li><li><ul><li><a href="#121_696" rel="nofollow">1.2.1ã€æ¶ˆæ¯è½¬æ¢å™¨</a></li><li><a href="#122RequestBodyAdvice_837" rel="nofollow">1.2.2ã€RequestBodyAdviceè¯·æ±‚å¢å¼ºå™¨</a></li></ul> 
   </li></ul> 
   </li><li><a href="#2Controller_930" rel="nofollow">2ã€æ‰§è¡ŒControllerå…·ä½“é€»è¾‘æ–¹æ³•</a></li><li><a href="#3json_953" rel="nofollow">3ã€è¿”å›å¯¹è±¡è½¬ä¸ºå“åº”ä¿¡æ¯(json)</a></li><li><ul><li><a href="#31_973" rel="nofollow">3.1ã€è·å–è¿”å›å€¼å¤„ç†å™¨</a></li><li><a href="#32_1013" rel="nofollow">3.2ã€è¿”å›å€¼å¤„ç†å™¨å¤„ç†æ–¹æ³•</a></li><li><ul><li><a href="#321_1033" rel="nofollow">3.2.1ã€æ¶ˆæ¯è½¬æ¢å™¨</a></li><li><a href="#322ResponseBodyAdvice_1109" rel="nofollow">3.2.2ã€ResponseBodyAdviceå“åº”å¢å¼ºå™¨</a></li></ul> 
   </li></ul> 
  </li></ul> 
  </li><li><a href="#_1167" rel="nofollow">å››ã€æ‹¦æˆªå™¨</a></li><li><ul><li><a href="#1preHandle_1222" rel="nofollow">1ã€æ‰§è¡Œæ‹¦æˆªå™¨preHandleæ–¹æ³•</a></li><li><a href="#2postHandle_1246" rel="nofollow">2ã€æ‰§è¡Œæ‹¦æˆªå™¨postHandleæ–¹æ³•</a></li><li><a href="#3afterCompletion_1262" rel="nofollow">3ã€æ‰§è¡Œæ‹¦æˆªå™¨afterCompletionæ–¹æ³•</a></li></ul> 
  </li><li><a href="#_1285" rel="nofollow">äº”ã€å¼‚å¸¸å¤„ç†å™¨</a></li><li><a href="#_1360" rel="nofollow">æ€»ç»“</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_10"></a>å‰è¨€</h2> 
<p>â€ƒâ€ƒ<font color="RoyalBlue"><strong>å‰æ–‡ä¸­æˆ‘ä»¬ä»‹ç»äº†SpringMVCå®¹å™¨çš„å¯åŠ¨ï¼ŒåŒ…æ‹¬å‰ç«¯æ§åˆ¶å™¨DispatcherServletå¯¹è±¡çš„åˆ›å»ºï¼Œè¿‡æ»¤å™¨æ·»åŠ åˆ°Tomcatå®¹å™¨çš„è¿‡æ»¤å™¨é›†åˆä¸­ï¼Œå°†æ‰€æœ‰æ‹¦æˆªå™¨ã€è·¨åŸŸé…ç½®ã€æ¶ˆæ¯è½¬æ¢å™¨ç­‰é…ç½®ç»Ÿä¸€æ·»åŠ åˆ°å„è‡ªé›†åˆä¸­ï¼Œè§£æ@RequestMappingæ³¨è§£ç”Ÿæˆè¯·æ±‚è·¯å¾„å’ŒControlleræ–¹æ³•çš„æ˜ å°„mapã€‚æœ¬ç« æ¥ç ”ç©¶ä¸‹<code>è¯·æ±‚çš„æ‰§è¡Œè¿‡ç¨‹</code>ã€‚</strong></font></p> 
<p>â€ƒâ€ƒ<strong><font color="#d32b8f">è¯´åˆ°è¯·æ±‚è¿‡ç¨‹ï¼Œé‚£ä¹ˆå¾—å…ˆè¯´ä¸‹å…¥å£åœ¨å“ªé‡Œï¼Ÿ<font color="green">å…¥å£è‚¯å®šæ˜¯ç»Ÿä¸€åˆ†å‘è¯·æ±‚ç»™å¤„ç†ç¨‹åºçš„<code>DispatcherServlet</code>ï¼ŒDispatcherServletå½’æ ¹ç»“åº•ä¹Ÿæ˜¯Servletã€‚<font color="Olive">Tomcaté€šè¿‡è¯·æ±‚Mappingæ˜ å°„å’ŒServeltå¯¹åº”å…³ç³»æ‰¾åˆ°Serveltï¼Œè°ƒç”¨Serveltä¹‹å‰ä¼šæ‰§è¡Œè¿‡æ»¤å™¨é“¾ï¼Œæ‰€æœ‰è¿‡æ»¤å™¨æ”¾è¡Œæ‰ä¼šèµ°åˆ°ServeltçœŸæ­£çš„æ‰§è¡Œé€»è¾‘ã€‚</font></font></font></strong></p> 
<ul><li><font color="SaddleBrown"><strong>ä¾ç…§å¸¸è§çš„postè¯·æ±‚ä¸ºä¾‹</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token comment">// æ¥å—Userå¯¹è±¡å¹¶è¿”å›</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ResponseBody</span>
<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    user<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"æå››"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><font color="RoyalBlue"><strong>æ–¹æ³•æ ˆè°ƒç”¨é“¾</strong></font></li></ul> 
<p><img src="https://images2.imgbox.com/d7/27/EuGt8GYh_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<ul><li><font color="BlueViolet"><strong>HttpServelt#serviceåˆ†æ°´å²­doPostæ–¹æ³•ï¼Œåªè¦æ‰¾åˆ°<code>DispatcherServelté‡å†™çš„doPostæ–¹æ³•</code>å°±æ˜¯å…¥å£äº†</strong></font></li></ul> 
<p><img src="https://images2.imgbox.com/0a/2a/JCCCGKhz_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>â€ƒâ€ƒ<font color="SaddleBrown"><strong>æœ¬æ–‡å°±ä¸è®²è¿‡æ»¤å™¨çš„è°ƒç”¨äº†ï¼Œå› ä¸ºä»DispatcherServeltå¼€å§‹ï¼Œè¿‡æ»¤å™¨é“¾å·²ç»æ‰§è¡Œå®Œæˆï¼Œä¹‹å‰æ–‡ç« <a href="https://blog.csdn.net/qq_35512802/article/details/139278521">Tomcatæºç è§£æ(å…«)ï¼šä¸€ä¸ªè¯·æ±‚çš„æ‰§è¡Œæµç¨‹ï¼ˆé™„Tomcatæ•´ä½“æ€»ç»“ï¼‰</a>æœ‰ä»‹ç»è¿‡ã€‚</strong></font></p> 
<h2><a id="DispatcherServlet_40"></a>DispatcherServletå…¥å£</h2> 
<p><font color="purple"><strong>DispatcherServletçš„ç±»å›¾å¦‚ä¸‹ï¼š</strong></font></p> 
<p><img src="https://images2.imgbox.com/08/68/jfwGLSlC_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<blockquote> 
 <p><strong><font size="3">ä»doPoståˆ°doDispatchæ–¹æ³•</font></strong></p> 
</blockquote> 
<ul><li><font color="RoyalBlue"><strong><code>doPost</code>æ–¹æ³•æ˜¯ç”±DispatcherServeltçš„çˆ¶ç±»<code>FrameworkServlet</code>å®ç°çš„</strong></font></li><li><font color="green"><strong>ä¸è®ºpostè¿˜æ˜¯getè¯·æ±‚éƒ½æ˜¯è°ƒç”¨åŒä¸€ä¸ªæ–¹æ³•<code>processRequest(request, response)</code></strong></font></li><li><font color="purple"><strong>å¯¹äºæ–¹æ³•å‚æ•°requestå’Œresponséƒ½æ˜¯Tomcatå®¹å™¨åˆ›å»ºçš„ï¼Œä»¥å‰æ–‡ç« <a href="https://blog.csdn.net/qq_35512802/article/details/139043605">Tomcatæºç è§£æ(ä¸ƒ)ï¼šåº•å±‚å¦‚ä½•è·å–è¯·æ±‚urlã€è¯·æ±‚å¤´ã€jsonæ•°æ®ï¼Ÿ</a>æœ‰å…·ä½“ä»‹ç»</strong></font></li></ul> 
<p><img src="https://images2.imgbox.com/ee/8a/QhtRvugs_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<ul><li><font color="purple"><strong>ä¸»è¦æ–¹æ³•<code>doService(request, response)</code></strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token comment">// FrameworkServletç±»æ–¹æ³•</span>
<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">processRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Throwable</span> failureCause <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

	<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">doService</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ServletException</span> <span class="token operator">|</span> <span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		failureCause <span class="token operator">=</span> ex<span class="token punctuation">;</span>
		<span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		failureCause <span class="token operator">=</span> ex<span class="token punctuation">;</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NestedServletException</span><span class="token punctuation">(</span><span class="token string">"Request processing failed"</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><font color="purple"><strong>ä¸»è¦æ–¹æ³•<code>doDispatch(request, response)</code></strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token comment">// DispatcherServletç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doService</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// ... è®¾ç½®ä¸€å †Attributeå±æ€§</span>

	<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">doDispatch</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><strong><font size="3">æ ¸å¿ƒæ–¹æ³•<code>doDispatch</code></font></strong></p> 
</blockquote> 
<ul><li><font color="BlueViolet"><strong>è¿™ä¸ªæ–¹æ³•åŒ…å«äº†SpringMVCçš„æ•´ä¸ªæ‰§è¡Œæµç¨‹</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doDispatch</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	<span class="token class-name">HttpServletRequest</span> processedRequest <span class="token operator">=</span> request<span class="token punctuation">;</span>
	<span class="token class-name">HandlerExecutionChain</span> mappedHandler <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token keyword">boolean</span> multipartRequestParsed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	
	<span class="token comment">// å¼‚æ­¥è¯·æ±‚ç›¸å…³ï¼Œä»¥åå•ç‹¬ç¯‡ç« è®²</span>
	<span class="token class-name">WebAsyncManager</span> asyncManager <span class="token operator">=</span> <span class="token class-name">WebAsyncUtils</span><span class="token punctuation">.</span><span class="token function">getAsyncManager</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">ModelAndView</span> mv <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token class-name">Exception</span> dispatchException <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// åˆ¤æ–­æ˜¯å¦ä¸Šä¼ è¯·æ±‚ï¼Œä»¥åæœ‰æœºä¼šå•ç‹¬å°†</span>
			processedRequest <span class="token operator">=</span> <span class="token function">checkMultipart</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// å¦‚æœæ˜¯ä¸Šä¼ è¯·æ±‚ï¼Œè¿™ä¸ªå‚æ•°ç½®ä¸ºtrueï¼Œæœ€åä¼šå»æ¸…ç†èµ„æº</span>
			multipartRequestParsed <span class="token operator">=</span> <span class="token punctuation">(</span>processedRequest <span class="token operator">!=</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// è·å–HandlerExcutionChain ï¼ˆå†…éƒ¨åŒ…æ‹¬Handlerï¼‰</span>
			mappedHandler <span class="token operator">=</span> <span class="token function">getHandler</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mappedHandler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// è¯·æ±‚urlæ‰¾ä¸åˆ°404å°±ä¼šèµ°åˆ°è¿™é‡Œ</span>
				<span class="token function">noHandlerFound</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// è·å–é€‚é…å™¨</span>
			<span class="token class-name">HandlerAdapter</span> ha <span class="token operator">=</span> <span class="token function">getHandlerAdapter</span><span class="token punctuation">(</span>mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// getè¯·æ±‚ç¼“å­˜ç›¸å…³ï¼Œä»¥åæœ‰æœºä¼šå•ç‹¬å°†</span>
			<span class="token class-name">String</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">boolean</span> isGet <span class="token operator">=</span> <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>isGet <span class="token operator">||</span> <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span><span class="token constant">HEAD</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">long</span> lastModified <span class="token operator">=</span> ha<span class="token punctuation">.</span><span class="token function">getLastModified</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ServletWebRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">checkNotModified</span><span class="token punctuation">(</span>lastModified<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> isGet<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">return</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			
			<span class="token comment">// è°ƒç”¨æ‹¦æˆªå™¨çš„å‰ç½®æ–¹æ³•preHandle</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mappedHandler<span class="token punctuation">.</span><span class="token function">applyPreHandle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// æ‰§è¡Œhandleræ–¹æ³•</span>
			<span class="token comment">// éœ€è¦è·³è½¬é¡µé¢è¿™é‡Œæ‰ä¼šè¿”å›ModelAndViewå¯¹è±¡ï¼Œå¦åˆ™@ResponseBodyè¿”å›å¯¹è±¡è¿™é‡Œè¿”å›null</span>
			mv <span class="token operator">=</span> ha<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>asyncManager<span class="token punctuation">.</span><span class="token function">isConcurrentHandlingStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token function">applyDefaultViewName</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> mv<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// è°ƒç”¨æ‹¦æˆªå™¨çš„åç½®æ–¹æ³•postHandle</span>
			mappedHandler<span class="token punctuation">.</span><span class="token function">applyPostHandle</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mv<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			dispatchException <span class="token operator">=</span> ex<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">//ä»4.3å¼€å§‹ï¼Œæˆ‘ä»¬ä¹Ÿåœ¨å¤„ç†å¤„ç†ç¨‹åºæ–¹æ³•æŠ›å‡ºçš„é”™è¯¯ï¼Œ</span>
			<span class="token comment">//ä½¿å®ƒä»¬å¯ç”¨äº@ExceptionHandleræ–¹æ³•å’Œå…¶ä»–åœºæ™¯ã€‚</span>
			dispatchException <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NestedServletException</span><span class="token punctuation">(</span><span class="token string">"Handler dispatch failed"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å¤„ç†ç»“æœ</span>
		<span class="token function">processDispatchResult</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">,</span> mv<span class="token punctuation">,</span> dispatchException<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// è°ƒç”¨æ‹¦æˆªå™¨è¯·æ±‚å¤„ç†å®Œæˆåçš„å›è°ƒtriggerAfterCompletion</span>
		<span class="token function">triggerAfterCompletion</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// è°ƒç”¨æ‹¦æˆªå™¨è¯·æ±‚å¤„ç†å®Œæˆåçš„å›è°ƒtriggerAfterCompletion</span>
		<span class="token function">triggerAfterCompletion</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">,</span> mappedHandler<span class="token punctuation">,</span>
				<span class="token keyword">new</span> <span class="token class-name">NestedServletException</span><span class="token punctuation">(</span><span class="token string">"Handler processing failed"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>asyncManager<span class="token punctuation">.</span><span class="token function">isConcurrentHandlingStarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// å¼‚æ­¥å¤„ç†çš„å›è°ƒ</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mappedHandler <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				mappedHandler<span class="token punctuation">.</span><span class="token function">applyAfterConcurrentHandlingStarted</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// å¦‚æœæ˜¯ä¸Šä¼ è¯·æ±‚ï¼Œæ¸…ç†ç›¸å…³èµ„æº</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>multipartRequestParsed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token function">cleanupMultipart</span><span class="token punctuation">(</span>processedRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="HandlerExcutionChainHandler_203"></a>ä¸€ã€è·å–HandlerExcutionChain(åŒ…æ‹¬Handler)</h2> 
<p>â€ƒâ€ƒ<font color="RoyalBlue"><strong>éå†æ‰€æœ‰çš„HandlerMappingï¼Œåªè¦getHandleræ–¹æ³•èƒ½è·å–åˆ°<code>HandlerExecutionChain</code>ç«‹å³è¿”å›ã€‚</strong></font></p> 
<pre><code class="prism language-java"><span class="token comment">// DispatcherServletç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">protected</span> <span class="token class-name">HandlerExecutionChain</span> <span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlerMappings <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HandlerMapping</span> mapping <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlerMappings<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">HandlerExecutionChain</span> handler <span class="token operator">=</span> mapping<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> handler<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>â€ƒâ€ƒ<font color="purple"><strong>å¦‚ä¸‹è¿™ä¸‰ä¸ªHandlerMappingæ˜¯webå®¹å™¨å¯åŠ¨æ—¶å€™åŠ è½½çš„ï¼Œä¸Šç¯‡æ–‡ç« <a href="https://xuchang.blog.csdn.net/article/details/134139936" rel="nofollow">SpringMVCæºç è§£æ(ä¸€)ï¼šwebå®¹å™¨å¯åŠ¨æµç¨‹</a>æœ‰å…·ä½“ä»‹ç»ã€‚<font color="green">ä¸‰ä¸ªè½®æµè°ƒç”¨getHandleræ–¹æ³•ï¼Œè€ŒHandlerMappingä¹Ÿæœ‰é¡ºåºçš„ï¼Œ<code>RequestMappingHanderMapping</code>æ’åºä¸º0ä¼˜å…ˆçº§æœ€é«˜ï¼Œè€Œå®ƒä¹Ÿæ˜¯å¤„ç†<code>@RequestMapping</code>æ³¨è§£çš„æ˜ å°„å…³ç³»çš„æ˜ å°„å™¨ã€‚</font></strong></font></p> 
<p><img src="https://images2.imgbox.com/f8/cc/RiCwkVKo_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>â€ƒâ€ƒ<font color="RoyalBlue"><strong>è°ƒç”¨<code>æŠ½è±¡ç±»</code>çš„æ–¹æ³•ï¼Œé‚£ä¹ˆä¸Šé¢çœ‹åˆ°çš„ä¸‰ä¸ªHandlerMappingåº”è¯¥éƒ½ä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼Œè€Œè¿™é‡Œè‚¯å®šæœ‰ä¸€äº›æ ¸å¿ƒçš„ä¸åŒçš„æ–¹æ³•å®ç°åœ¨ä¸åŒçš„HandlerMappingå…·ä½“å®ç°ç±»ä¸­ï¼Œå…¸å‹çš„<code>æ¨¡æ¿æ–¹æ³•</code>è®¾è®¡æ¨¡å¼ã€‚</strong></font></p> 
<pre><code class="prism language-java"><span class="token comment">// AbstractHandlerMappingç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">HandlerExecutionChain</span> <span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// è·å–Handler</span>
	<span class="token class-name">Object</span> handler <span class="token operator">=</span> <span class="token function">getHandlerInternal</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		handler <span class="token operator">=</span> <span class="token function">getDefaultHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// handlerä¸ºbeançš„åç§°</span>
	<span class="token comment">// è¿™ç§Controlleråº”è¯¥æ˜¯å®ç°Controlerã€HttpRequestHandleræ¥å£çš„æ–¹å¼</span>
	<span class="token comment">// ä»¥å‰çš„è€å®ç°æ–¹å¼ï¼Œæš‚ä¸ç ”ç©¶</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">String</span> handlerName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> handler<span class="token punctuation">;</span>
		handler <span class="token operator">=</span> <span class="token function">obtainApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>handlerName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	
	<span class="token comment">// è·å–æ‰§è¡Œé“¾(åŒ…æ‹¬Handlerå’Œæ‹¦æˆªå™¨)</span>
	<span class="token class-name">HandlerExecutionChain</span> executionChain <span class="token operator">=</span> <span class="token function">getHandlerExecutionChain</span><span class="token punctuation">(</span>handler<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// ...æ‰“å°æ—¥å¿—</span>
	
	<span class="token comment">// æ·»åŠ è·¨åŸŸè®¾ç½®ï¼ˆæœ¬èº«ä¹Ÿæ˜¯æ‹¦æˆªå™¨ï¼‰åˆ°æ‹¦æˆªå™¨é“¾ä¸­ç¬¬ä¸€ä¸ªä½ç½®</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasCorsConfigurationSource</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">CorsUtils</span><span class="token punctuation">.</span><span class="token function">isPreFlightRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">CorsConfiguration</span> config <span class="token operator">=</span> <span class="token function">getCorsConfiguration</span><span class="token punctuation">(</span>handler<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getCorsConfigurationSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">CorsConfiguration</span> globalConfig <span class="token operator">=</span> <span class="token function">getCorsConfigurationSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCorsConfiguration</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
			config <span class="token operator">=</span> <span class="token punctuation">(</span>globalConfig <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> globalConfig<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token operator">:</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>config <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			config<span class="token punctuation">.</span><span class="token function">validateAllowCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		executionChain <span class="token operator">=</span> <span class="token function">getCorsHandlerExecutionChain</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> executionChain<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> executionChain<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="1Handler_275"></a>1ã€è·å–Handler</h3> 
<ul><li><font color="SaddleBrown"><strong>ä¸»è¦å†…å®¹å°±æ˜¯è°ƒç”¨çˆ¶ç±»AbstractHandlerMethodMappingçš„ç›¸åŒæ–¹æ³•</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token comment">// RequestMappingInfoHandlerMappingç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">protected</span> <span class="token class-name">HandlerMethod</span> <span class="token function">getHandlerInternal</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	request<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token constant">PRODUCIBLE_MEDIA_TYPES_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// æ ¸å¿ƒæ–¹æ³•è°ƒç”¨çˆ¶ç±»çš„getHandlerInternalæ–¹æ³•</span>
		<span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getHandlerInternal</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">ProducesRequestCondition</span><span class="token punctuation">.</span><span class="token function">clearMediaTypesAttribute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><font color="BlueViolet"><strong>é€šè¿‡requestè·å–<code>æŸ¥æ‰¾è·¯å¾„</code></strong></font></li><li><font color="BlueViolet"><strong>é€šè¿‡æŸ¥æ‰¾è·¯å¾„è·å–<code>HandlerMethod</code></strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token comment">// AbstractHandlerMethodMappingç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">protected</span> <span class="token class-name">HandlerMethod</span> <span class="token function">getHandlerInternal</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// é€šè¿‡requestè·å–æŸ¥æ‰¾è·¯å¾„</span>
	<span class="token class-name">String</span> lookupPath <span class="token operator">=</span> <span class="token function">initLookupPath</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>mappingRegistry<span class="token punctuation">.</span><span class="token function">acquireReadLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// é€šè¿‡æŸ¥æ‰¾è·¯å¾„è·å–HandlerMethod</span>
		<span class="token class-name">HandlerMethod</span> handlerMethod <span class="token operator">=</span> <span class="token function">lookupHandlerMethod</span><span class="token punctuation">(</span>lookupPath<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span>handlerMethod <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> handlerMethod<span class="token punctuation">.</span><span class="token function">createWithResolvedBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>mappingRegistry<span class="token punctuation">.</span><span class="token function">releaseReadLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="11request_317"></a>1.1ã€é€šè¿‡requestè·å–æŸ¥æ‰¾è·¯å¾„</h4> 
<ul><li><font color="green"><strong>æˆªå–è¯·æ±‚<code>uri</code>ï¼Œå¦‚å›¾/springmvc/testï¼Œ/springmvcä¸º<code>é¡¹ç›®è·¯å¾„</code>ï¼Œ/testä¸ºæˆ‘ä»¬éœ€è¦çš„<code>æŸ¥æ‰¾è·¯å¾„</code></strong></font></li></ul> 
<p><img src="https://images2.imgbox.com/b1/54/tOobU9er_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="12HandlerMethod_323"></a>1.2ã€é€šè¿‡æŸ¥æ‰¾è·¯å¾„è·å–HandlerMethod</h4> 
<p>â€ƒâ€ƒ<font color="purple"><strong>è¿™ä¸ªæ–¹æ³•çš„æ ¸å¿ƒå†…å®¹å°±æ˜¯ä»ä¹‹å‰è®²çš„<a href="https://xuchang.blog.csdn.net/article/details/134139936" rel="nofollow">SpringMVCæºç è§£æ(ä¸€)ï¼šwebå®¹å™¨å¯åŠ¨æµç¨‹</a>æ³¨å†Œçš„<code>ä¸¤ä¸ªmap</code>è·å–æ•°æ®ã€‚</strong></font></p> 
<p><img src="https://images2.imgbox.com/1f/c0/vmPtysnw_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-java"><span class="token comment">// AbstractHandlerMethodMappingç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">protected</span> <span class="token class-name">HandlerMethod</span> <span class="token function">lookupHandlerMethod</span><span class="token punctuation">(</span><span class="token class-name">String</span> lookupPath<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Match</span><span class="token punctuation">&gt;</span></span> matches <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// é€šè¿‡æŸ¥æ‰¾è·¯å¾„è·å–RequestMappingInfo</span>
	<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> directPathMatches <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mappingRegistry<span class="token punctuation">.</span><span class="token function">getMappingsByDirectPath</span><span class="token punctuation">(</span>lookupPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>directPathMatches <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// é€šè¿‡RequestMappingInfoè·å–HandlerMethod</span>
		<span class="token function">addMatchingMappings</span><span class="token punctuation">(</span>directPathMatches<span class="token punctuation">,</span> matches<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>matches<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">Match</span> bestMatch <span class="token operator">=</span> matches<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>matches<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">//...åŒ¹é…å¤šä¸ªï¼ŒæŠ›é”™å¼‚å¸¸</span>
		<span class="token punctuation">}</span>
		request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token constant">BEST_MATCHING_HANDLER_ATTRIBUTE</span><span class="token punctuation">,</span> bestMatch<span class="token punctuation">.</span><span class="token function">getHandlerMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">handleMatch</span><span class="token punctuation">(</span>bestMatch<span class="token punctuation">.</span>mapping<span class="token punctuation">,</span> lookupPath<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// è·å–HandlerMethodå¹¶è¿”å›</span>
		<span class="token keyword">return</span> bestMatch<span class="token punctuation">.</span><span class="token function">getHandlerMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">handleNoMatch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mappingRegistry<span class="token punctuation">.</span><span class="token function">getRegistrations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lookupPath<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/95/5b/jZokA3bd_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="2Handler_359"></a>2ã€è·å–æ‰§è¡Œé“¾(åŒ…æ‹¬Handlerã€æ‹¦æˆªå™¨)</h3> 
<p>â€ƒâ€ƒ<font color="Olive"><strong>æˆ‘ä»¬è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨ç»Ÿä¸€ç”¨<code>MappedInterceptor</code>è¿™ä¸ªæ‹¦æˆªå™¨åŒ…è£…äº†ä¸€å±‚ï¼Œä¸ºäº†ç»Ÿä¸€è°ƒç”¨<code>matcher</code>æ–¹æ³•ï¼Œ<font color="BlueViolet">åŒ¹é…æ­¤æ‹¦æˆªå™¨è¯·æ±‚æ˜¯å¦æ‹¦æˆªæœ¬æ¬¡è¯·æ±‚ï¼Œå¦‚æœæ˜¯åˆ™ä¼šæ·»åŠ åˆ°æ‹¦æˆªå™¨é“¾ä¸­ã€‚</font></strong></font></p> 
<pre><code class="prism language-java"><span class="token comment">// AbstractHandlerMappingç±»æ–¹æ³•</span>
<span class="token keyword">protected</span> <span class="token class-name">HandlerExecutionChain</span> <span class="token function">getHandlerExecutionChain</span><span class="token punctuation">(</span><span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// åˆ›å»ºHandlerExecutionChainå¯¹è±¡</span>
	<span class="token class-name">HandlerExecutionChain</span> chain <span class="token operator">=</span> <span class="token punctuation">(</span>handler <span class="token keyword">instanceof</span> <span class="token class-name">HandlerExecutionChain</span> <span class="token operator">?</span>
			<span class="token punctuation">(</span><span class="token class-name">HandlerExecutionChain</span><span class="token punctuation">)</span> handler <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">HandlerExecutionChain</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// éå†æ‰€æœ‰çš„æ‹¦æˆªå™¨ï¼Œè¿™æ‹¦æˆªå™¨æ˜¯webå®¹å™¨å¯åŠ¨æ—¶å€™è§£æåŠ è½½çš„çš„</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HandlerInterceptor</span> interceptor <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>adaptedInterceptors<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// æˆ‘ä»¬è‡ªå®šä¹‰çš„æ‹¦æˆªå™¨ç»Ÿä¸€ç”¨MappedInterceptorè¿™ä¸ªæ‹¦æˆªå™¨åŒ…è£…äº†ä¸€å±‚</span>
		<span class="token comment">// ä¸ºäº†ç»Ÿä¸€çš„åŒ¹é…æ–¹æ³•ï¼Œä¸‹é¢è°ƒç”¨maches</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>interceptor <span class="token keyword">instanceof</span> <span class="token class-name">MappedInterceptor</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">MappedInterceptor</span> mappedInterceptor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MappedInterceptor</span><span class="token punctuation">)</span> interceptor<span class="token punctuation">;</span>
			<span class="token comment">// matcheråŒ¹é…å½“å‰è¯·æ±‚è·¯å¾„æ˜¯å¦ç¬¦åˆæ‹¦æˆªå™¨çš„æ‹¦æˆªè¯·æ±‚</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mappedInterceptor<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				chain<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>mappedInterceptor<span class="token punctuation">.</span><span class="token function">getInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			chain<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>interceptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> chain<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æ‰§è¡Œå™¨é“¾å¯¹è±¡ï¼Œä¸»è¦å°±æ˜¯ä¸¤ä¸ªå±æ€§handlerï¼šHandlerå¯¹è±¡ï¼ŒinterceptorListï¼šæ‹¦æˆªå™¨é›†åˆ</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HandlerExecutionChain</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> handler<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HandlerInterceptor</span><span class="token punctuation">&gt;</span></span> interceptorList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// æ„é€ æ–¹æ³•</span>
	<span class="token keyword">public</span> <span class="token class-name">HandlerExecutionChain</span><span class="token punctuation">(</span><span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">(</span>handler<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">HandlerInterceptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><font color="purple"><strong>æ‹¦æˆªå™¨é“¾æœ€ç»ˆçš„ç»“æœ</strong></font></li></ul> 
<p><img src="https://images2.imgbox.com/6b/6e/sZXAVGkb_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="_404"></a>äºŒã€è·å–é€‚é…å™¨</h2> 
<blockquote> 
 <p><strong><font size="3">çœ‹ä¸‹HandlerAdapteræ¥å£</font></strong></p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HandlerAdapter</span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">/**
	 * å› ä¸ºæœ‰å¤šä¸ªHandlerMappingå’ŒHandlerAdapter
	 * å¯¹äºHandlerAdapteræ˜¯å¦æ”¯æŒå¯¹åº”çš„HandlerMappingï¼Œé€šè¿‡æ­¤æ–¹æ³•åˆ¤æ–­
	 */</span>
	<span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">Object</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * å…·ä½“è°ƒç”¨Hangderçš„æ–¹æ³•
	 */</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">ModelAndView</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>â€ƒâ€ƒ<font color="green"><strong>å› ä¸ºä¸åŒçš„<code>Hander</code>(@RequestMappingã€å®ç°Controlleræ¥å£ã€å®ç°HttpRequestHandleræ¥å£)å¯¹åº”çš„<code>HandlerAdapter</code>(é€‚é…å™¨)ä¸ä¸€æ ·ï¼Œé€šè¿‡HandlerAdapterçš„<code>supports</code>æ–¹æ³•åˆ¤æ–­å½“å‰HandlerAdapter<code>æ˜¯å¦æ”¯æŒæ­¤æ¬¡è¯·æ±‚çš„Hander</code>ã€‚</strong></font></p> 
<pre><code class="prism language-java"><span class="token comment">// DispatcherServletç±»æ–¹æ³•</span>
<span class="token keyword">protected</span> <span class="token class-name">HandlerAdapter</span> <span class="token function">getHandlerAdapter</span><span class="token punctuation">(</span><span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlerAdapters <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HandlerAdapter</span> adapter <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlerAdapters<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>adapter<span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> adapter<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ServletException</span><span class="token punctuation">(</span><span class="token string">"No adapter for handler ["</span> <span class="token operator">+</span> handler <span class="token operator">+</span>
			<span class="token string">"]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><font color="SaddleBrown"><strong>è¿™ä¸ªæ˜¯æŠ½è±¡ç±»å®ç°çš„supportsæ–¹æ³•ï¼Œæ‰€æœ‰HandlerAdapteråˆ¤æ–­æ˜¯å¦æ”¯æŒéƒ½ä¼šèµ°è¿™é‡Œ</strong></font></li><li><font color="purple"><strong>å…¶ä¸»è¦ä½œç”¨å°±æ˜¯supportsInternalæ–¹æ³•ï¼Œåœ¨ä¸åŒçš„HandlerAdapterå®ç°ç±»ä¸­é‡å†™</strong> </font> 
  <ul><li><font color="RoyalBlue"><strong><code>RequestMappingHandlerAdapter</code>é‡å†™çš„supportsInternalè¿”å›trueï¼Œè¡¨ç¤ºå…¶<code>æ”¯æŒ</code></strong></font></li></ul> </li></ul> 
<pre><code class="prism language-java"><span class="token comment">// AbstractHandlerMethodAdapterç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>handler <span class="token keyword">instanceof</span> <span class="token class-name">HandlerMethod</span> <span class="token operator">&amp;&amp;</span> <span class="token function">supportsInternal</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">HandlerMethod</span><span class="token punctuation">)</span> handler<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// RequestMappingHandlerAdapterç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">supportsInternal</span><span class="token punctuation">(</span><span class="token class-name">HandlerMethod</span> handlerMethod<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>â€ƒâ€ƒ<font color="BlueViolet"><strong>ç”±ä¸Šé¢HandlerAdapteræ¥å£å¯ä»¥çŒœåˆ°ï¼Œ<code>RequestMappingHandlerAdapter</code>é€‚é…å™¨å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œä¹‹åä¼šé€šè¿‡handleæ–¹æ³•å»<code>æ‰§è¡ŒHangderæ–¹æ³•</code>å³è°ƒç”¨<code>Controller#Method</code>ã€‚</strong></font></p> 
<h2><a id="Handler_461"></a>ä¸‰ã€æ‰§è¡ŒHandlerï¼ˆğŸ”¥é‡ç‚¹ï¼‰</h2> 
<p>â€ƒâ€ƒ<font color="RoyalBlue"><strong>AbstractHandlerMethodAdapterç±»çš„handleæ–¹æ³•å³é‡å†™HandlerAdapterçš„handleæ–¹æ³•ï¼Œæ‰€æœ‰çš„HandlerAdapteræ‰§è¡ŒHangdleréƒ½ä¼šè¿›å…¥æ­¤æ–¹æ³•ï¼Œè€Œå…·ä½“çš„æ–¹æ³•å®ç°åˆè¦è°ƒç”¨HandlerAdapterçš„å®ç°ç±»ï¼Œå¦‚ä¸‹ï¼Œå®ç°ç±»å°±åœ¨<code>RequestMappingHandlerAdapter</code>ç±»çš„<code>handleInternal</code>æ–¹æ³•ã€‚</strong></font></p> 
<pre><code class="prism language-java"><span class="token comment">// AbstractHandlerMethodAdapterç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">ModelAndView</span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">return</span> <span class="token function">handleInternal</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">HandlerMethod</span><span class="token punctuation">)</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><font color="BlueViolet"><strong>æ‰§è¡ŒHandleæ–¹æ³•å†…åˆåŒ…æ‹¬<code>è§£æè¯·æ±‚</code>ï¼Œ<code>æ‰§è¡ŒçœŸæ­£é€»è¾‘</code>ï¼Œ<code>è§£æå“åº”</code></strong></font></li></ul> 
<p><img src="https://images2.imgbox.com/b0/10/n4ACXcKC_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<ul><li><font color="RoyalBlue"><strong>æ‰§è¡ŒHandlerå¹¶è·å–è¿”å›å€¼ï¼Œå¤„ç†å“åº”ï¼Œå¦‚å¯¹è±¡è½¬åŒ–ä¸ºjson</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token comment">// ServletInvocableHandlerMethodç±»æ–¹æ³•</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">invokeAndHandle</span><span class="token punctuation">(</span><span class="token class-name">ServletWebRequest</span> webRequest<span class="token punctuation">,</span> <span class="token class-name">ModelAndViewContainer</span> mavContainer<span class="token punctuation">,</span>
		<span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> providedArgs<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	
	<span class="token comment">// æ‰§è¡ŒHandlerå¹¶è·å–è¿”å›å€¼</span>
	<span class="token class-name">Object</span> returnValue <span class="token operator">=</span> <span class="token function">invokeForRequest</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">,</span> mavContainer<span class="token punctuation">,</span> providedArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setResponseStatus</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>returnValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isRequestNotModified</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">getResponseStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> mavContainer<span class="token punctuation">.</span><span class="token function">isRequestHandled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">disableContentCachingIfNecessary</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mavContainer<span class="token punctuation">.</span><span class="token function">setRequestHandled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span><span class="token function">getResponseStatusReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		mavContainer<span class="token punctuation">.</span><span class="token function">setRequestHandled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	mavContainer<span class="token punctuation">.</span><span class="token function">setRequestHandled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>returnValueHandlers <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"No return value handlers"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// å¤„ç†å“åº”ï¼Œè¿”å›å¯¹è±¡è½¬æ¢å“åº”ä¿¡æ¯ï¼Œå¦‚å¯¹è±¡è½¬åŒ–ä¸ºjson</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>returnValueHandlers<span class="token punctuation">.</span><span class="token function">handleReturnValue</span><span class="token punctuation">(</span>
				returnValue<span class="token punctuation">,</span> <span class="token function">getReturnValueType</span><span class="token punctuation">(</span>returnValue<span class="token punctuation">)</span><span class="token punctuation">,</span> mavContainer<span class="token punctuation">,</span> webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// å¼‚å¸¸å‘ä¸ŠæŠ›</span>
		<span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// InvocableHandlerMethodç±»æ–¹æ³•ï¼Œå®ç°HandlerMethodæ¥å£</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invokeForRequest</span><span class="token punctuation">(</span><span class="token class-name">NativeWebRequest</span> request<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ModelAndViewContainer</span> mavContainer<span class="token punctuation">,</span>
		<span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> providedArgs<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// è·å–è¯·æ±‚å‚æ•°</span>
	<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> <span class="token function">getMethodArgumentValues</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> mavContainer<span class="token punctuation">,</span> providedArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"Arguments: "</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// æ‰§è¡ŒçœŸæ­£é€»è¾‘</span>
	<span class="token keyword">return</span> <span class="token function">doInvoke</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="1_531"></a>1ã€è·å–è¯·æ±‚å‚æ•°</h3> 
<p>â€ƒâ€ƒ<font color="green"><strong>æ‹¿åˆ°å…·ä½“Controllerçš„<code>Method</code>æ–¹æ³•å‚æ•°ï¼Œéå†æ‰€æœ‰å‚æ•°å¯»æ‰¾æ”¯æŒæ¯ä¸ªå‚æ•°ç±»å‹çš„<code>å‚æ•°è§£æå™¨</code>ï¼Œè§£æå‚æ•°å¹¶è¿”å›ã€‚</strong></font></p> 
<pre><code class="prism language-java"><span class="token comment">// InvocableHandlerMethodç±»æ–¹æ³•ï¼Œå®ç°HandlerMethodæ¥å£</span>
<span class="token keyword">protected</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getMethodArgumentValues</span><span class="token punctuation">(</span><span class="token class-name">NativeWebRequest</span> request<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ModelAndViewContainer</span> mavContainer<span class="token punctuation">,</span>
		<span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> providedArgs<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	
	<span class="token comment">// ä»HandlerMethodä¸­è·å–å‚æ•°ä¿¡æ¯</span>
	<span class="token comment">// ä¹‹å‰é¡¹ç›®å¯åŠ¨å°±åŠ è½½äº†Handlerï¼Œé‡Œé¢åŒ…å«äº†å…·ä½“è¦æ‰§è¡Œçš„Controllerçš„Method</span>
	<span class="token class-name">MethodParameter</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameters <span class="token operator">=</span> <span class="token function">getMethodParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>parameters<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token constant">EMPTY_ARGS</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// éå†æ‰€æœ‰çš„å‚æ•°</span>
	<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span>parameters<span class="token punctuation">.</span>length<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parameters<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">MethodParameter</span> parameter <span class="token operator">=</span> parameters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		parameter<span class="token punctuation">.</span><span class="token function">initParameterNameDiscovery</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>parameterNameDiscoverer<span class="token punctuation">)</span><span class="token punctuation">;</span>
		args<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">findProvidedArgument</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> providedArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">continue</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// å¯»æ‰¾æ”¯æŒå½“å‰å‚æ•°ç±»å‹çš„å‚æ•°è§£æå™¨</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolvers<span class="token punctuation">.</span><span class="token function">supportsParameter</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token function">formatArgumentError</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> <span class="token string">"No suitable resolver"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// æ ¹æ®ä¸Šä¸€æ­¥è·å–çš„å‚æ•°è§£æå™¨è§£æå‚æ•°å¹¶è¿”å›å…·ä½“å‚æ•°</span>
			args<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resolvers<span class="token punctuation">.</span><span class="token function">resolveArgument</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> mavContainer<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dataBinderFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> args<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="11_572"></a>1.1ã€è·å–å‚æ•°è§£æå™¨</h4> 
<p>â€ƒâ€ƒ<font color="RoyalBlue"><strong>éå†æ‰€æœ‰çš„<code>å‚æ•°è§£æå™¨</code>ï¼Œè°ƒç”¨å‚æ•°è§£æå™¨çš„<code>supportsParameter</code>æ–¹æ³•ï¼Œè¿”å›trueï¼Œè¡¨ç¤ºæ­¤è§£æå™¨å¯ä»¥è§£æå½“å‰å‚æ•°ç±»å‹ï¼Œè€Œä¸”å°†æ–¹æ³•çš„å‚æ•°ä¸è§£æå™¨æ”¾å…¥ç¼“å­˜<code>argumentResolverCache</code>ï¼Œ<font color="Olive">ä»¥ååŒä¸€ä¸ªæ¥å£è°ƒç”¨ç¬¬äºŒæ¬¡ï¼Œå‚æ•°è§£æå™¨ç›´æ¥ä»ç¼“å­˜ä¸­è·å–å°±å¯ä»¥ï¼Œä¸å†éœ€è¦éå†è°ƒç”¨supportsParameteræ–¹æ³•å»ç­›é€‰è·å–ã€‚</font></strong></font></p> 
<pre><code class="prism language-java"><span class="token comment">// HandlerMethodArgumentResolverCompositeç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">supportsParameter</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token function">getArgumentResolver</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">private</span> <span class="token class-name">HandlerMethodArgumentResolver</span> <span class="token function">getArgumentResolver</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token class-name">HandlerMethodArgumentResolver</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>argumentResolverCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HandlerMethodArgumentResolver</span> resolver <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>argumentResolvers<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>resolver<span class="token punctuation">.</span><span class="token function">supportsParameter</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				result <span class="token operator">=</span> resolver<span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>argumentResolverCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><font color="purple"><strong>å‚æ•°è§£æå™¨é›†åˆ<code>HandlerMethodArgumentResolver argumentResolvers</code>ä¸­ä¸€å…±æœ‰27ä¸ª</strong> </font> 
  <ul><li><font color="green"><strong>å‡ ä¹æ¯ä¸ªæ³¨è§£å°±æ˜¯ä¸€ä¸ªè§£æå™¨ï¼Œå¦‚<code>@RequestParam</code>ã€<code>@PathVariable</code>ç­‰ç­‰</strong></font></li></ul> </li><li><font color="green"><strong>å‚æ•°è§£æå™¨é›†åˆä¸­ä¸‹æ ‡7å°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„<code>@RequestBody</code>æ³¨è§£å‚æ•°è§£æå™¨</strong></font></li></ul> 
<p><img src="https://images2.imgbox.com/c1/2e/HU9LeIue_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<ul><li><font color="BlueViolet"><strong>supportsParameteræ–¹æ³•ç®€å•æ˜äº†ï¼Œå‚æ•°åŒ…å«æ³¨è§£<code>@RequestBody</code>å³å¯</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token comment">// RequestResponseBodyMethodProcessorç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">supportsParameter</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> parameter<span class="token punctuation">.</span><span class="token function">hasParameterAnnotation</span><span class="token punctuation">(</span><span class="token class-name">RequestBody</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="12RequestBodey_615"></a>1.2ã€è§£æ@RequestBodeyè¯·æ±‚å‚æ•°</h4> 
<pre><code class="prism language-java"><span class="token comment">// HandlerMethodArgumentResolverCompositeç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">resolveArgument</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ModelAndViewContainer</span> mavContainer<span class="token punctuation">,</span>
		<span class="token class-name">NativeWebRequest</span> webRequest<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">WebDataBinderFactory</span> binderFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// è·å–å‚æ•°è§£æå™¨ï¼Œæ­¤æ—¶ä¸Šé¢å·²ç»ç­›æŸ¥å‡ºæ¥ï¼Œæ”¾åˆ°argumentResolverCacheç¼“å­˜ä¸­</span>
	<span class="token class-name">HandlerMethodArgumentResolver</span> resolver <span class="token operator">=</span> <span class="token function">getArgumentResolver</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>resolver <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Unsupported parameter type ["</span> <span class="token operator">+</span>
				parameter<span class="token punctuation">.</span><span class="token function">getParameterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]. supportsParameter should be called first."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// è§£ææ–¹æ³•</span>
	<span class="token keyword">return</span> resolver<span class="token punctuation">.</span><span class="token function">resolveArgument</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> mavContainer<span class="token punctuation">,</span> webRequest<span class="token punctuation">,</span> binderFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><font color="purple"><strong>è°ƒç”¨æ³¨è§£è§£æå™¨<code>RequestResponseBodyMethodProcessor</code>çš„<code>resolveArgument</code>æ–¹æ³•</strong> </font> 
  <ul><li><font color="Olive"><strong>readWithMessageConvertersï¼šé€šè¿‡<code>æ¶ˆæ¯è½¬æ¢å™¨</code>è·å–è¯·æ±‚å‚æ•°</strong></font></li><li><font color="Olive"><strong>validateIfApplicableï¼š<code>@Validated</code>æ³¨è§£çš„æ ¡éªŒï¼Œä»¥åå•ç‹¬å°†</strong></font></li></ul> </li></ul> 
<pre><code class="prism language-java"><span class="token comment">// RequestResponseBodyMethodProcessorç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">resolveArgument</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ModelAndViewContainer</span> mavContainer<span class="token punctuation">,</span>
		<span class="token class-name">NativeWebRequest</span> webRequest<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">WebDataBinderFactory</span> binderFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

	parameter <span class="token operator">=</span> parameter<span class="token punctuation">.</span><span class="token function">nestedIfOptional</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// è·å–å‚æ•°å¯¹è±¡</span>
	<span class="token class-name">Object</span> arg <span class="token operator">=</span> <span class="token function">readWithMessageConverters</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> parameter<span class="token punctuation">.</span><span class="token function">getNestedGenericParameterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token class-name">Conventions</span><span class="token punctuation">.</span><span class="token function">getVariableNameForParameter</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>binderFactory <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">WebDataBinder</span> binder <span class="token operator">=</span> binderFactory<span class="token punctuation">.</span><span class="token function">createBinder</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">,</span> arg<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>arg <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// @Validatedæ³¨è§£çš„æ ¡éªŒ</span>
			<span class="token function">validateIfApplicable</span><span class="token punctuation">(</span>binder<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>binder<span class="token punctuation">.</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isBindExceptionRequired</span><span class="token punctuation">(</span>binder<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">MethodArgumentNotValidException</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> binder<span class="token punctuation">.</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mavContainer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			mavContainer<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token class-name">BindingResult</span><span class="token punctuation">.</span><span class="token constant">MODEL_KEY_PREFIX</span> <span class="token operator">+</span> name<span class="token punctuation">,</span> binder<span class="token punctuation">.</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token function">adaptArgumentIfNecessary</span><span class="token punctuation">(</span>arg<span class="token punctuation">,</span> parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><font color="green"><strong>å¦‚æœè¯·æ±‚å‚æ•°ä¸ºç©ºï¼Œæ£€æŸ¥<code>@RequstBody</code>çš„<code>required</code>å±æ€§æ˜¯å¦ä¸º<code>true</code></strong> </font> 
  <ul><li><font color="Olive"><strong>trueè¡¨ç¤º@RequstBodyæ³¨è§£çš„å‚æ•°ä¸èƒ½ä¸ºç©º</strong></font></li><li><font color="Olive"><strong>é‚£ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸<code>Required request body is missing</code></strong></font></li></ul> </li></ul> 
<pre><code class="prism language-java"><span class="token comment">// RequestResponseBodyMethodProcessorç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Object</span> <span class="token function">readWithMessageConverters</span><span class="token punctuation">(</span><span class="token class-name">NativeWebRequest</span> webRequest<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">,</span>
		<span class="token class-name">Type</span> paramType<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">HttpMediaTypeNotSupportedException</span><span class="token punctuation">,</span> <span class="token class-name">HttpMessageNotReadableException</span> <span class="token punctuation">{<!-- --></span>

	<span class="token class-name">HttpServletRequest</span> servletRequest <span class="token operator">=</span> webRequest<span class="token punctuation">.</span><span class="token function">getNativeRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">state</span><span class="token punctuation">(</span>servletRequest <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"No HttpServletRequest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">ServletServerHttpRequest</span> inputMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletServerHttpRequest</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// è¿›ä¸€æ­¥è°ƒç”¨æ–¹æ³•ï¼Œé€šè¿‡æ¶ˆæ¯è½¬æ¢å™¨è·å–è¯·æ±‚å‚æ•°</span>
	<span class="token class-name">Object</span> arg <span class="token operator">=</span> <span class="token function">readWithMessageConverters</span><span class="token punctuation">(</span>inputMessage<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> paramType<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// å¦‚æœè¯·æ±‚ä¸ºç©ºï¼Œæ£€æŸ¥@RequstBodyæ˜¯å¦ä¸ºè¯·æ±‚å¿…é¡»å‚æ•°</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>arg <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token function">checkRequired</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpMessageNotReadableException</span><span class="token punctuation">(</span><span class="token string">"Required request body is missing: "</span> <span class="token operator">+</span>
				parameter<span class="token punctuation">.</span><span class="token function">getExecutable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toGenericString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> inputMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> arg<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// @requestBodyæ³¨è§£requiredå±æ€§æ˜¯å¦ä¸ºtrue</span>
<span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">checkRequired</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token class-name">RequestBody</span> requestBody <span class="token operator">=</span> parameter<span class="token punctuation">.</span><span class="token function">getParameterAnnotation</span><span class="token punctuation">(</span><span class="token class-name">RequestBody</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>requestBody <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> requestBody<span class="token punctuation">.</span><span class="token function">required</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>parameter<span class="token punctuation">.</span><span class="token function">isOptional</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="121_696"></a>1.2.1ã€æ¶ˆæ¯è½¬æ¢å™¨</h5> 
<blockquote> 
 <p><strong><font size="3">æ¶ˆæ¯è½¬æ¢å™¨æ¥å£</font></strong></p> 
</blockquote> 
<ul><li><font color="green"><strong><code>MediaTypeç±»</code>ï¼šè¡¨ç¤ºäº’è”ç½‘ä¸­å¤šåª’ä½“æ•°æ®ç±»å‹çš„æ ¼å¼ï¼›ä¾‹å¦‚ï¼štext/htmlï¼Œtext/plainï¼Œapplication/jsonâ€¦</strong></font></li><li><font color="BlueViolet"><strong><code>canReadæ–¹æ³•</code>ï¼šæ£€æŸ¥èƒ½å¦å°†è¯·æ±‚ä¿¡æ¯è½¬æ¢ä¸ºmediaTypeè¡¨ç¤ºçš„æ•°æ®ç±»å‹ï¼Œè¿™ä¸ªmediaTypeæ˜¯å‰ç«¯é¡µé¢è¯·æ±‚æ—¶è®¾å®šçš„contentTypeæ ¼å¼</strong></font></li><li><font color="BlueViolet"><strong><code>readæ–¹æ³•</code>ï¼šå¦‚æœcanReadæ–¹æ³•è¿”å›å€¼ä¸ºtrueï¼Œåˆ™è°ƒç”¨readæ–¹æ³•å°†è¯·æ±‚ä¿¡æ¯è½¬æ¢ä¸ºTç±»å‹å¯¹è±¡</strong></font></li><li><font color="Olive"><strong><code>canWriteæ–¹æ³•</code>ï¼šæ£€æŸ¥clazzå¯¹è±¡æ˜¯å¦èƒ½è½¬æ¢ä¸ºmediaTypeç±»å‹ï¼Œæ­¤æ—¶çš„mediaTypeè¡¨ç¤ºåç«¯æƒ³è¦å“åº”ç»™å‰ç«¯çš„æ•°æ®æ ¼å¼</strong></font></li><li><font color="Olive"><strong><code>writeæ–¹æ³•</code>ï¼šå¦‚æœcanWriteè¿”å›å€¼ä¸ºtrueï¼Œåˆ™å°†Tç±»å‹çš„å¯¹è±¡å†™åˆ°å“åº”æµä¸­ï¼ŒåŒæ—¶æŒ‡å®šmediaTypeç±»å‹</strong></font></li></ul> 
<p><img src="https://images2.imgbox.com/fc/6c/58ejGAV0_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<blockquote> 
 <p><strong><font size="3">å›åˆ°ä¸Šé¢çš„readWithMessageConvertersæ–¹æ³•</font></strong></p> 
</blockquote> 
<ul><li><font color="RoyalBlue"><strong>é¦–å…ˆè·å–è¯·æ±‚å¤´<code>ContentType</code>åª’ä½“å†…å®¹ç±»å‹ï¼Œè‚¯å®šæ˜¯<code>application/json</code>ï¼Œé»˜è®¤<code>application/octet-stream</code></strong></font></li><li><font color="RoyalBlue"><strong>éå†æ‰€æœ‰çš„<code>æ¶ˆæ¯è½¬æ¢å™¨</code>ï¼Œè°ƒç”¨<code>canRead</code>æ–¹æ³•ç­›é€‰å¯ä»¥å°†<code>è¯·æ±‚ä¿¡æ¯</code>è½¬ä¸ºæŒ‡å®šçš„åª’ä½“ç±»å‹<code>contentType</code>çš„è½¬æ¢å™¨</strong></font></li><li><font color="Olive"><strong>ç„¶åæ‹¿åˆ°ç­›é€‰çš„æ¶ˆæ¯è¿‡æ»¤å™¨è½¬æ¢å¯¹è±¡å‰ï¼Œè¿™é‡Œspringmvcç•™ä¸‹äº†<code>æ‰©å±•ç‚¹RequestBodyAdvice</code>ï¼Œå¯ä»¥å¯¹<code>è¯·æ±‚</code>åšä¸€äº›ä¿®æ”¹ï¼Œå¦‚åŠ å¯†æ‹¦æˆªè¯·æ±‚ç­‰ç­‰</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token comment">// AbstractMessageConverterMethodArgumentResolverç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">protected</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Object</span> <span class="token function">readWithMessageConverters</span><span class="token punctuation">(</span><span class="token class-name">HttpInputMessage</span> inputMessage<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">,</span>
		<span class="token class-name">Type</span> targetType<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">HttpMediaTypeNotSupportedException</span><span class="token punctuation">,</span> <span class="token class-name">HttpMessageNotReadableException</span> <span class="token punctuation">{<!-- --></span>

	<span class="token class-name">MediaType</span> contentType<span class="token punctuation">;</span>
	<span class="token keyword">boolean</span> noContentType <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// è·å–è¯·æ±‚å¤´ContentType</span>
		contentType <span class="token operator">=</span> inputMessage<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvalidMediaTypeException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpMediaTypeNotSupportedException</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>contentType <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		noContentType <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token comment">// é»˜è®¤åª’ä½“ç±»å‹ "application/octet-stream"</span>
		contentType <span class="token operator">=</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_OCTET_STREAM</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// è·å–Controllerçš„Classå¯¹è±¡</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> contextClass <span class="token operator">=</span> parameter<span class="token punctuation">.</span><span class="token function">getContainingClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// è·å–æ–¹æ³•å‚æ•°çš„Classå¯¹è±¡</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> targetClass <span class="token operator">=</span> <span class="token punctuation">(</span>targetType <span class="token keyword">instanceof</span> <span class="token class-name">Class</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> targetType <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>targetClass <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">ResolvableType</span> resolvableType <span class="token operator">=</span> <span class="token class-name">ResolvableType</span><span class="token punctuation">.</span><span class="token function">forMethodParameter</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
		targetClass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> resolvableType<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token class-name">HttpMethod</span> httpMethod <span class="token operator">=</span> <span class="token punctuation">(</span>inputMessage <span class="token keyword">instanceof</span> <span class="token class-name">HttpRequest</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">HttpRequest</span><span class="token punctuation">)</span> inputMessage<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Object</span> body <span class="token operator">=</span> <span class="token constant">NO_VALUE</span><span class="token punctuation">;</span>

	<span class="token class-name">EmptyBodyCheckingHttpInputMessage</span> message <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
		message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EmptyBodyCheckingHttpInputMessage</span><span class="token punctuation">(</span>inputMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// éå†æ‰€æœ‰çš„æ¶ˆæ¯è½¬æ¢å™¨</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HttpMessageConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> converter <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>messageConverters<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converterType <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> converter<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">GenericHttpMessageConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> genericConverter <span class="token operator">=</span>
					<span class="token punctuation">(</span>converter <span class="token keyword">instanceof</span> <span class="token class-name">GenericHttpMessageConverter</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token class-name">GenericHttpMessageConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> converter <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// è°ƒç”¨canReadæ–¹æ³•ï¼Œç­›é€‰æ¯ä¸ªæ¶ˆæ¯è¿‡æ»¤å™¨æ˜¯å¦èƒ½å°†è¯·æ±‚ä¿¡æ¯è½¬ä¸ºæŒ‡å®šçš„åª’ä½“ç±»å‹contentType</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>genericConverter <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> genericConverter<span class="token punctuation">.</span><span class="token function">canRead</span><span class="token punctuation">(</span>targetType<span class="token punctuation">,</span> contextClass<span class="token punctuation">,</span> contentType<span class="token punctuation">)</span> <span class="token operator">:</span>
					<span class="token punctuation">(</span>targetClass <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> converter<span class="token punctuation">.</span><span class="token function">canRead</span><span class="token punctuation">(</span>targetClass<span class="token punctuation">,</span> contentType<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">hasBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token comment">// è·å–è¯·æ±‚å¢å¼ºå™¨å¹¶è°ƒç”¨beforeBodyReadæ–¹æ³•</span>
					<span class="token class-name">HttpInputMessage</span> msgToUse <span class="token operator">=</span>
							<span class="token function">getAdvice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">beforeBodyRead</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> targetType<span class="token punctuation">,</span> converterType<span class="token punctuation">)</span><span class="token punctuation">;</span>
				    <span class="token comment">// æ¶ˆæ¯è½¬æ¢å™¨çœŸæ­£å°†è¯·æ±‚ä¿¡æ¯è½¬ä¸ºå‚æ•°å¯¹è±¡çš„æ–¹æ³•</span>
					body <span class="token operator">=</span> <span class="token punctuation">(</span>genericConverter <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> genericConverter<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>targetType<span class="token punctuation">,</span> contextClass<span class="token punctuation">,</span> msgToUse<span class="token punctuation">)</span> <span class="token operator">:</span>
							<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">HttpMessageConverter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> converter<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>targetClass<span class="token punctuation">,</span> msgToUse<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			
				    <span class="token comment">// è·å–è¯·æ±‚å¢å¼ºå™¨å¹¶è°ƒç”¨afterBodyReadæ–¹æ³•</span>
					body <span class="token operator">=</span> <span class="token function">getAdvice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">afterBodyRead</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> msgToUse<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> targetType<span class="token punctuation">,</span> converterType<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
					body <span class="token operator">=</span> <span class="token function">getAdvice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handleEmptyBody</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> targetType<span class="token punctuation">,</span> converterType<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">HttpMessageNotReadableException</span><span class="token punctuation">(</span><span class="token string">"I/O error while reading input message"</span><span class="token punctuation">,</span> ex<span class="token punctuation">,</span> inputMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

	<span class="token keyword">return</span> body<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><font color="BlueViolet"><strong>æœ€ç»ˆç­›é€‰å‡ºJacksonæ¶ˆæ¯è½¬æ¢å™¨<code>MappingJackson2HttpMessageConverter</code></strong></font></li></ul> 
<p><img src="https://images2.imgbox.com/57/9c/YMTVp9Eq_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<blockquote> 
 <p><strong><font size="3">genericConverter.canRead<code>ç­›é€‰</code>æ–¹æ³•</font></strong></p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token comment">// AbstractJackson2HttpMessageConverterç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">canRead</span><span class="token punctuation">(</span><span class="token class-name">Type</span> type<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> contextClass<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">MediaType</span> mediaType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// åˆ¤æ–­æ˜¯å¦æ”¯æŒä¼ å…¥çš„mediaType</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">canRead</span><span class="token punctuation">(</span>mediaType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token class-name">JavaType</span> javaType <span class="token operator">=</span> <span class="token function">getJavaType</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> contextClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token function">selectObjectMapper</span><span class="token punctuation">(</span>javaType<span class="token punctuation">.</span><span class="token function">getRawClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mediaType<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>objectMapper <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span> causeRef <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// åˆ¤æ–­ç±»èƒ½å¦ååºåˆ—åŒ–ï¼Œå¹¶å°†é”™è¯¯è®°å½•åˆ°causeRefä¸­ï¼Œä¸‹é¢ä¼šæ‰“å°</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>objectMapper<span class="token punctuation">.</span><span class="token function">canDeserialize</span><span class="token punctuation">(</span>javaType<span class="token punctuation">,</span> causeRef<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// æ‰“å°causeRefï¼Œä¸èƒ½ååºåˆ—åŒ–çš„é”™è¯¯</span>
	<span class="token function">logWarningIfNecessary</span><span class="token punctuation">(</span>javaType<span class="token punctuation">,</span> causeRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><strong><font size="3">genericConverter.read<code>jsonååºåˆ—åŒ–ä¸ºå¯¹è±¡</code>æ–¹æ³•</font></strong></p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token comment">// AbstractJackson2HttpMessageConverterç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token class-name">Type</span> type<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> contextClass<span class="token punctuation">,</span> <span class="token class-name">HttpInputMessage</span> inputMessage<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">HttpMessageNotReadableException</span> <span class="token punctuation">{<!-- --></span>

	<span class="token class-name">JavaType</span> javaType <span class="token operator">=</span> <span class="token function">getJavaType</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> contextClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token function">readJavaType</span><span class="token punctuation">(</span>javaType<span class="token punctuation">,</span> inputMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/e0/cc/HKBHkvVB_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h5><a id="122RequestBodyAdvice_837"></a>1.2.2ã€RequestBodyAdviceè¯·æ±‚å¢å¼ºå™¨</h5> 
<p>â€ƒâ€ƒ<font color="BlueViolet"><strong>ä¸Šç¯‡æ–‡ç« <a href="https://xuchang.blog.csdn.net/article/details/134139936" rel="nofollow">SpringMVCæºç è§£æ(ä¸€)ï¼šwebå®¹å™¨å¯åŠ¨æµç¨‹</a>ä»‹ç»è¿‡ï¼Œç±»ä¸Šæœ‰<code>@ControllerAdvice</code>æ³¨è§£ä¸”å®ç°<code>RequestBodyAdviceæ¥å£</code>çš„å³ä¸ºRequestBodyAdviceå¢å¼ºå™¨ï¼Œ<font color="green">ä¸»è¦å°±æ˜¯åœ¨è¯·æ±‚ä¿¡æ¯è½¬æ¢ä¸ºå‚æ•°å¯¹è±¡çš„<code>å‰å</code>åšä¸€äº›<code>æ‰©å±•</code>å¤„ç†ã€‚</font></strong></font></p> 
<blockquote> 
 <p><strong><font size="3">RequestBodyAdviceè¯·æ±‚å¢å¼ºå™¨</font></strong></p> 
</blockquote> 
<ul><li><font color="#d32b8f"><strong>ä½¿ç”¨åœºæ™¯ï¼šå‚æ•°çš„è¿‡æ»¤ , å­—ç¬¦çš„ç¼–ç  , ç¬¬ä¸‰æ–¹çš„è§£å¯†ç­‰ç­‰</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RequestBodyAdvice</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// æ˜¯å¦æ”¯æŒï¼Œè‡ªå®šä¹‰åˆ¤æ–­æ¡ä»¶ï¼Œå¦‚åŒ…å«æŸä¸ªè‡ªå®šä¹‰æ³¨è§£ç­‰ç­‰</span>
	<span class="token comment">// è¯¥æ–¹æ³•è¿”å›trueæ—¶ï¼Œæ‰ä¼šè¿›å»ä¸‹é¢çš„beforeBodyReadæ–¹æ³•</span>
	<span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> methodParameter<span class="token punctuation">,</span> <span class="token class-name">Type</span> targetType<span class="token punctuation">,</span>
			<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converterType<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// è¯·æ±‚ä½“è§£æå‰å¤„ç†ï¼Œä¸€èˆ¬åœ¨æ­¤æ–¹æ³•ä¸­å¯¹bodyæ•°æ®è¿›è¡Œä¿®æ”¹</span>
	<span class="token class-name">HttpInputMessage</span> <span class="token function">beforeBodyRead</span><span class="token punctuation">(</span><span class="token class-name">HttpInputMessage</span> inputMessage<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">,</span>
			<span class="token class-name">Type</span> targetType<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converterType<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">;</span>
			
	<span class="token comment">// è¯·æ±‚ä½“è§£æåå¤„ç†ï¼Œä¸€èˆ¬ç›´æ¥è¿”å›åŸå®ä¾‹</span>
	<span class="token class-name">Object</span> <span class="token function">afterBodyRead</span><span class="token punctuation">(</span><span class="token class-name">Object</span> body<span class="token punctuation">,</span> <span class="token class-name">HttpInputMessage</span> inputMessage<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">,</span>
			<span class="token class-name">Type</span> targetType<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converterType<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// å½“bodyä¸ºemptyæ—¶æ“ä½œ(bodyä»€ä¹ˆéƒ½ä¸ä¼ æ‰ç®—ï¼Œå³ä½¿{}ä¹Ÿä¸ç®—ç©º)</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">Object</span> <span class="token function">handleEmptyBody</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> body<span class="token punctuation">,</span> <span class="token class-name">HttpInputMessage</span> inputMessage<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">,</span>
			<span class="token class-name">Type</span> targetType<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converterType<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><strong><font size="3">å›åˆ°ä¸Šé¢çš„getAdvice().beforeBodyReadæ–¹æ³•</font></strong></p> 
</blockquote> 
<ul><li><font color="purple"><strong>è·å–æ‰€æœ‰çš„è¯·æ±‚å¢å¼ºå™¨ï¼Œè°ƒç”¨supportsæ–¹æ³•</strong> </font> 
  <ul><li><font color="green"><strong>è¿”å›trueï¼Œè¡¨ç¤ºå½“å‰å¢å¼ºå™¨æ»¡è¶³æ¡ä»¶ï¼Œæ¥ä¸‹æ¥è°ƒç”¨<code>beforeBodyRead</code>æ–¹æ³•`å¯¹è¯·æ±‚ä¿¡æ¯åšå¤„ç†</strong></font></li><li><font color="RoyalBlue"><strong>è¿”å›falseï¼Œè¡¨ç¤ºå½“å‰å¢å¼ºå™¨ä¸æ»¡è¶³æ¡ä»¶ï¼Œè·³è¿‡å»æ ¡éªŒä¸‹ä¸€ä¸ªå¢å¼ºå™¨</strong></font></li></ul> </li></ul> 
<pre><code class="prism language-java"><span class="token comment">// RequestResponseBodyAdviceChainç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">HttpInputMessage</span> <span class="token function">beforeBodyRead</span><span class="token punctuation">(</span><span class="token class-name">HttpInputMessage</span> request<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">,</span>
		<span class="token class-name">Type</span> targetType<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converterType<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// è·å–æ‰€æœ‰è¯·æ±‚å¢å¼ºå™¨</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">RequestBodyAdvice</span> advice <span class="token operator">:</span> <span class="token function">getMatchingAdvice</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> <span class="token class-name">RequestBodyAdvice</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>advice<span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> targetType<span class="token punctuation">,</span> converterType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			request <span class="token operator">=</span> advice<span class="token punctuation">.</span><span class="token function">beforeBodyRead</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> targetType<span class="token punctuation">,</span> converterType<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> request<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><strong><font size="3">getAdvice().afterBodyReadæ–¹æ³•</font></strong></p> 
</blockquote> 
<ul><li><font color="green"><strong>è¯·æ±‚å‚æ•°è½¬æ¢ä¸ºå¯¹è±¡ä»¥åçš„å¤„ç†ï¼Œè¿™æ—¶å€™å¯ä»¥å¯¹<code>å‚æ•°å¯¹è±¡</code>åšä¸€äº›<code>æ‰©å±•å¤„ç†</code>äº†</strong></font></li><li><font color="RoyalBlue"><strong>ä¸ä¸Šé¢beforeBodyReadæ–¹æ³•ä¸€æ ·ï¼Œå…ˆè°ƒç”¨supportsæ ¡éªŒæ˜¯å¦æ”¯æŒï¼Œå†è°ƒç”¨<code>afterBodyRead</code>å¤„ç†</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token comment">// RequestResponseBodyAdviceChainç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">afterBodyRead</span><span class="token punctuation">(</span><span class="token class-name">Object</span> body<span class="token punctuation">,</span> <span class="token class-name">HttpInputMessage</span> inputMessage<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">,</span>
		<span class="token class-name">Type</span> targetType<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converterType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">RequestBodyAdvice</span> advice <span class="token operator">:</span> <span class="token function">getMatchingAdvice</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> <span class="token class-name">RequestBodyAdvice</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>advice<span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> targetType<span class="token punctuation">,</span> converterType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			body <span class="token operator">=</span> advice<span class="token punctuation">.</span><span class="token function">afterBodyRead</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> inputMessage<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> targetType<span class="token punctuation">,</span> converterType<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> body<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><strong><font size="3">getAdvice().handleEmptyBodyæ–¹æ³•</font></strong></p> 
</blockquote> 
<ul><li><font color="purple"><strong>è¯·æ±‚bodyä»€ä¹ˆéƒ½æ²¡æœ‰æ‰ä¼šè¿›å…¥æ­¤æ–¹æ³•</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token comment">// RequestResponseBodyAdviceChainç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">handleEmptyBody</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> body<span class="token punctuation">,</span> <span class="token class-name">HttpInputMessage</span> inputMessage<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> parameter<span class="token punctuation">,</span>
		<span class="token class-name">Type</span> targetType<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converterType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">RequestBodyAdvice</span> advice <span class="token operator">:</span> <span class="token function">getMatchingAdvice</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> <span class="token class-name">RequestBodyAdvice</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>advice<span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span>parameter<span class="token punctuation">,</span> targetType<span class="token punctuation">,</span> converterType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			body <span class="token operator">=</span> advice<span class="token punctuation">.</span><span class="token function">handleEmptyBody</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> inputMessage<span class="token punctuation">,</span> parameter<span class="token punctuation">,</span> targetType<span class="token punctuation">,</span> converterType<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> body<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2Controller_930"></a>2ã€æ‰§è¡ŒControllerå…·ä½“é€»è¾‘æ–¹æ³•</h3> 
<ul><li><font color="green"><strong>getBeanè·å–çš„Controllerå¯¹è±¡ï¼Œ<code>method.invoke(obj,args)</code>æ ‡å‡†åå°„è°ƒç”¨æ–¹æ³•</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token comment">// InvocableHandlerMethodç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">doInvoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	<span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token function">getBridgedMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">KotlinDetector</span><span class="token punctuation">.</span><span class="token function">isSuspendingFunction</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token class-name">CoroutinesUtils</span><span class="token punctuation">.</span><span class="token function">invokeSuspendingFunction</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// åå°„è°ƒç”¨æ–¹æ³•</span>
		<span class="token keyword">return</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3json_953"></a>3ã€è¿”å›å¯¹è±¡è½¬ä¸ºå“åº”ä¿¡æ¯(json)</h3> 
<ul><li><font color="purple"><strong>è·å–æ”¯æŒå¤„ç†å½“å‰è¿”å›å€¼çš„å¤„ç†å™¨ï¼Œå¹¶è°ƒç”¨<code>handleReturnValue</code>å¤„ç†æ–¹æ³•</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token comment">// HandlerMethodReturnValueHandlerCompositeç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleReturnValue</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> returnValue<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span>
		<span class="token class-name">ModelAndViewContainer</span> mavContainer<span class="token punctuation">,</span> <span class="token class-name">NativeWebRequest</span> webRequest<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// è·å–æ–¹æ³•è¿”å›å€¼å¤„ç†å™¨</span>
	<span class="token class-name">HandlerMethodReturnValueHandler</span> handler <span class="token operator">=</span> <span class="token function">selectHandler</span><span class="token punctuation">(</span>returnValue<span class="token punctuation">,</span> returnType<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Unknown return value type: "</span> <span class="token operator">+</span> returnType<span class="token punctuation">.</span><span class="token function">getParameterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// å¤„ç†æ–¹æ³•</span>
	handler<span class="token punctuation">.</span><span class="token function">handleReturnValue</span><span class="token punctuation">(</span>returnValue<span class="token punctuation">,</span> returnType<span class="token punctuation">,</span> mavContainer<span class="token punctuation">,</span> webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="31_973"></a>3.1ã€è·å–è¿”å›å€¼å¤„ç†å™¨</h4> 
<ul><li><font color="RoyalBlue"><strong>éå†æ‰€æœ‰çš„è¿”å›å€¼å¤„ç†å™¨ï¼Œé€šè¿‡è°ƒç”¨å¤„ç†å™¨çš„<code>supportsReturnType</code>æ–¹æ³•ç­›é€‰</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token comment">// HandlerMethodReturnValueHandlerCompositeç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">private</span> <span class="token class-name">HandlerMethodReturnValueHandler</span> <span class="token function">selectHandler</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">boolean</span> isAsyncValue <span class="token operator">=</span> <span class="token function">isAsyncReturnValue</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> returnType<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// éå†æ‰€æœ‰çš„è¿”å›å€¼å¤„ç†å™¨</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HandlerMethodReturnValueHandler</span> handler <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>returnValueHandlers<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// æ’é™¤å¼‚æ­¥å¤„ç†å™¨ï¼Œä¸ç”¨ç®¡</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>isAsyncValue <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>handler <span class="token keyword">instanceof</span> <span class="token class-name">AsyncHandlerMethodReturnValueHandler</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">continue</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// é€šè¿‡è°ƒç”¨å¤„ç†å™¨çš„supportsReturnTypeæ–¹æ³•ç­›é€‰</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>handler<span class="token punctuation">.</span><span class="token function">supportsReturnType</span><span class="token punctuation">(</span>returnType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> handler<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/59/be/i37wZQM6_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<blockquote> 
 <p><strong><font size="3">æŸ¥çœ‹<code>RequestResponseBodyMethodProcessor</code>çš„ç­›é€‰æ–¹æ³•<code>handleReturnValue</code></font></strong></p> 
</blockquote> 
<ul><li><font color="BlueViolet"><strong>supportsReturnTypeæ–¹æ³•ç®€å•æ˜äº†ï¼Œ<code>æ–¹æ³•</code>æˆ–<code>ç±»ä¸Š</code>åŒ…å«æ³¨è§£<code>@ResponseBody</code>å³å¯</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">supportsReturnType</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">AnnotatedElementUtils</span><span class="token punctuation">.</span><span class="token function">hasAnnotation</span><span class="token punctuation">(</span>returnType<span class="token punctuation">.</span><span class="token function">getContainingClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ResponseBody</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token operator">||</span>
			returnType<span class="token punctuation">.</span><span class="token function">hasMethodAnnotation</span><span class="token punctuation">(</span><span class="token class-name">ResponseBody</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="32_1013"></a>3.2ã€è¿”å›å€¼å¤„ç†å™¨å¤„ç†æ–¹æ³•</h4> 
<pre><code class="prism language-java"><span class="token comment">// RequestResponseBodyMethodProcessorç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleReturnValue</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> returnValue<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span>
		<span class="token class-name">ModelAndViewContainer</span> mavContainer<span class="token punctuation">,</span> <span class="token class-name">NativeWebRequest</span> webRequest<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">HttpMediaTypeNotAcceptableException</span><span class="token punctuation">,</span> <span class="token class-name">HttpMessageNotWritableException</span> <span class="token punctuation">{<!-- --></span>

	mavContainer<span class="token punctuation">.</span><span class="token function">setRequestHandled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">ServletServerHttpRequest</span> inputMessage <span class="token operator">=</span> <span class="token function">createInputMessage</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">ServletServerHttpResponse</span> outputMessage <span class="token operator">=</span> <span class="token function">createOutputMessage</span><span class="token punctuation">(</span>webRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// å³ä½¿è¿”å›å€¼ä¸ºç©ºï¼Œä¹Ÿè¦å°è¯•ã€‚ResponseBodyAdviceå¯èƒ½ä¼šå‚ä¸å…¶ä¸­ã€‚</span>
	<span class="token function">writeWithMessageConverters</span><span class="token punctuation">(</span>returnValue<span class="token punctuation">,</span> returnType<span class="token punctuation">,</span> inputMessage<span class="token punctuation">,</span> outputMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f0/8d/knyvMb2O_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h5><a id="321_1033"></a>3.2.1ã€æ¶ˆæ¯è½¬æ¢å™¨</h5> 
<p>â€ƒâ€ƒ<font color="BlueViolet"><strong>è¿™é‡Œç”¨çš„æ¶ˆæ¯è½¬æ¢å™¨ä¸è·å–è¯·æ±‚å‚æ•°é‡Œçš„è½¬æ¢å™¨ä¸€æ ·ï¼Œéƒ½æ˜¯<code>MappingJackson2HttpMessageConverter</code>ã€‚ä¹‹å‰è½¬åŒ–å™¨æ˜¯éœ€è¦å°†è¯·æ±‚ä¿¡æ¯bodyé‡Œçš„jsonå­—ç¬¦ä¸²è½¬æ¢ï¼ˆ<code>ååºåˆ—åŒ–</code>ï¼‰ä¸ºå¯¹è±¡ï¼›è¿™é‡Œçš„è½¬æ¢å™¨æ˜¯å°†å¯¹è±¡è½¬æ¢ï¼ˆ<code>åºåˆ—åŒ–</code>ï¼‰å¯¹jsonå­—ç¬¦ä¸²ã€‚</strong></font></p> 
<blockquote> 
 <p><strong><font size="3">genericConverter.canWrite<code>ç­›é€‰</code>æ–¹æ³•</font></strong></p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token comment">// AbstractGenericHttpMessageConverterç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">canWrite</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Type</span> type<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">MediaType</span> mediaType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token function">canWrite</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span> mediaType<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// AbstractJackson2HttpMessageConverterç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">canWrite</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">MediaType</span> mediaType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// åˆ¤æ–­æ˜¯å¦æ”¯æŒä¼ å…¥çš„mediaType</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">canWrite</span><span class="token punctuation">(</span>mediaType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mediaType <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mediaType<span class="token punctuation">.</span><span class="token function">getCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">Charset</span> charset <span class="token operator">=</span> mediaType<span class="token punctuation">.</span><span class="token function">getCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">ENCODINGS</span><span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>charset<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token function">selectObjectMapper</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span> mediaType<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>objectMapper <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span> causeRef <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// åˆ¤æ–­å¯¹è±¡æ˜¯å¦èƒ½åºåˆ—åŒ–ä¸ºjsonå­—ç¬¦ä¸²ï¼Œå¹¶å°†é”™è¯¯è®°å½•åˆ°causeRefä¸­ï¼Œä¸‹é¢ä¼šæ‰“å°</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>objectMapper<span class="token punctuation">.</span><span class="token function">canSerialize</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span> causeRef<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// æ‰“å°causeRefï¼Œä¸èƒ½åºåˆ—åŒ–çš„é”™è¯¯</span>
	<span class="token function">logWarningIfNecessary</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span> causeRef<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><strong><font size="3">genericConverter.write<code>å¯¹è±¡åºåˆ—åŒ–ä¸ºjson</code>æ–¹æ³•</font></strong></p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token comment">// AbstractGenericHttpMessageConverterç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">T</span> t<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token keyword">final</span> <span class="token class-name">Type</span> type<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">MediaType</span> contentType<span class="token punctuation">,</span>
		<span class="token class-name">HttpOutputMessage</span> outputMessage<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">HttpMessageNotWritableException</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// è®¾ç½®é»˜è®¤è¯·æ±‚å¤´</span>
	<span class="token keyword">final</span> <span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> outputMessage<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">addDefaultHeaders</span><span class="token punctuation">(</span>headers<span class="token punctuation">,</span> t<span class="token punctuation">,</span> contentType<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>outputMessage <span class="token keyword">instanceof</span> <span class="token class-name">StreamingHttpOutputMessage</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">StreamingHttpOutputMessage</span> streamingOutputMessage <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">StreamingHttpOutputMessage</span><span class="token punctuation">)</span> outputMessage<span class="token punctuation">;</span>
		streamingOutputMessage<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span>outputStream <span class="token operator">-&gt;</span> <span class="token function">writeInternal</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> type<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">HttpOutputMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token annotation punctuation">@Override</span>
			<span class="token keyword">public</span> <span class="token class-name">OutputStream</span> <span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> outputStream<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token annotation punctuation">@Override</span>
			<span class="token keyword">public</span> <span class="token class-name">HttpHeaders</span> <span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> headers<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// jacksonåºåˆ—åŒ–æ–¹æ³•</span>
		<span class="token function">writeInternal</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> type<span class="token punctuation">,</span> outputMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
		outputMessage<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><font color="green"><strong>æ ¸å¿ƒæ–¹æ³•ï¼šå¯¹è±¡è½¬æ¢ä¸ºjsonå­—ç¬¦ä¸²å¹¶å†™å…¥<code>è¾“å‡ºæµ</code>ä¸­</strong></font></li></ul> 
<p><img src="https://images2.imgbox.com/5c/af/kNnzESn5_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h5><a id="322ResponseBodyAdvice_1109"></a>3.2.2ã€ResponseBodyAdviceå“åº”å¢å¼ºå™¨</h5> 
<p>â€ƒâ€ƒ<font color="BlueViolet"><strong>ä¸Šç¯‡æ–‡ç« <a href="https://xuchang.blog.csdn.net/article/details/134139936" rel="nofollow">SpringMVCæºç è§£æ(ä¸€)ï¼šwebå®¹å™¨å¯åŠ¨æµç¨‹</a>ä»‹ç»è¿‡ï¼Œç±»ä¸Šæœ‰<code>@ControllerAdvice</code>æ³¨è§£ä¸”å®ç°<code>ResponseBodyAdviceæ¥å£</code>çš„å³ä¸ºResponseBodyAdviceå¢å¼ºå™¨ï¼Œ<font color="green">ä¸»è¦å°±æ˜¯åœ¨è¿”å›å¯¹è±¡è½¬æ¢å“åº”ä¿¡æ¯<code>å‰</code>åšä¸€äº›<code>æ‰©å±•</code>å¤„ç†ã€‚</font></strong></font></p> 
<blockquote> 
 <p><strong><font size="3">ResponseBodyAdviceå“åº”å¢å¼ºå™¨</font></strong></p> 
</blockquote> 
<ul><li><font color="#d32b8f"><strong>ä½¿ç”¨åœºæ™¯ï¼šå¯¹responseæ•°æ®ç»Ÿä¸€å°è£…æˆ–è€…åŠ å¯†ç­‰æ“ä½œ</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ResponseBodyAdvice</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">// æ˜¯å¦æ”¯æŒï¼Œè‡ªå®šä¹‰åˆ¤æ–­æ¡ä»¶</span>
	<span class="token comment">// è¯¥æ–¹æ³•è¿”å›trueæ—¶ï¼Œæ‰ä¼šè¿›å»ä¸‹é¢çš„ beforeBodyWriteæ–¹æ³•</span>
	<span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converterType<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// å“åº”å†™å…¥ä¹‹å‰è°ƒç”¨</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">T</span> <span class="token function">beforeBodyWrite</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">T</span> body<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">MediaType</span> selectedContentType<span class="token punctuation">,</span>
			<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> selectedConverterType<span class="token punctuation">,</span>
			<span class="token class-name">ServerHttpRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServerHttpResponse</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><strong><font size="3">å›åˆ°ä¸Šé¢çš„getAdvice().beforeBodyWriteæ–¹æ³•</font></strong></p> 
</blockquote> 
<ul><li><font color="RoyalBlue"><strong>éå†æ‰€æœ‰çš„å“åº”å¢å¼ºå™¨ï¼Œè°ƒç”¨<code>supports</code>æ–¹æ³•ç­›é€‰æ”¯æŒçš„å¢å¼ºï¼Œç„¶åè°ƒç”¨å¢å¼ºæ–¹æ³•<code>beforeBodyWrite</code></strong></font></li><li><font color="RoyalBlue"><strong>æ­¤æ—¶beforeBodyWriteæ–¹æ³•æ‹¿åˆ°çš„<code>bodyå³ä¸ºæ–¹æ³•è¿”å›å€¼</code>ï¼Œè¿˜æ²¡æœ‰åºåˆ—åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹<code>è¿”å›å€¼</code>åš<code>æ‰©å±•å¤„ç†</code>äº†</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token comment">// RequestResponseBodyAdviceChainç±»æ–¹æ³•</span>
<span class="token annotation punctuation">@Override</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">beforeBodyWrite</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> body<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">MediaType</span> contentType<span class="token punctuation">,</span>
		<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converterType<span class="token punctuation">,</span>
		<span class="token class-name">ServerHttpRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServerHttpResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">return</span> <span class="token function">processBody</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> returnType<span class="token punctuation">,</span> contentType<span class="token punctuation">,</span> converterType<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">private</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Object</span> <span class="token function">processBody</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> body<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">MediaType</span> contentType<span class="token punctuation">,</span>
		<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">HttpMessageConverter</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> converterType<span class="token punctuation">,</span>
		<span class="token class-name">ServerHttpRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServerHttpResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	
	<span class="token comment">// éå†æ‰€æœ‰çš„å“åº”å¢å¼ºå™¨ï¼Œè°ƒç”¨supportsæ–¹æ³•ï¼Œç­›é€‰æ”¯æŒçš„å¢å¼ºå™¨</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ResponseBodyAdvice</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> advice <span class="token operator">:</span> <span class="token function">getMatchingAdvice</span><span class="token punctuation">(</span>returnType<span class="token punctuation">,</span> <span class="token class-name">ResponseBodyAdvice</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>advice<span class="token punctuation">.</span><span class="token function">supports</span><span class="token punctuation">(</span>returnType<span class="token punctuation">,</span> converterType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			body <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ResponseBodyAdvice</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> advice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">beforeBodyWrite</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> body<span class="token punctuation">,</span> returnType<span class="token punctuation">,</span>
					contentType<span class="token punctuation">,</span> converterType<span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> body<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_1167"></a>å››ã€æ‹¦æˆªå™¨</h2> 
<ul><li><font color="purple"><strong>æ–‡ç« ç¬¬ä¸€èŠ‚è·å–<code>æ‰§è¡Œå™¨é“¾HandlerExecutionChain</code>é‡Œé¢å°±åŒ…å«äº†æ‹¦æˆªå™¨é›†åˆï¼Œå¦‚ä¸‹</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token comment">// æ‰§è¡Œå™¨é“¾å¯¹è±¡ï¼Œä¸»è¦å°±æ˜¯ä¸¤ä¸ªå±æ€§handlerï¼šHandlerå¯¹è±¡ï¼ŒinterceptorListï¼šæ‹¦æˆªå™¨é›†åˆ</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HandlerExecutionChain</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> handler<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HandlerInterceptor</span><span class="token punctuation">&gt;</span></span> interceptorList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// æ„é€ æ–¹æ³•</span>
	<span class="token keyword">public</span> <span class="token class-name">HandlerExecutionChain</span><span class="token punctuation">(</span><span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">(</span>handler<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">HandlerInterceptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><strong><font size="3">æ‹¦æˆªå™¨æ¥å£</font></strong></p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">/**
	 * æ‰§è¡Œå¤„ç†ç¨‹åºä¹‹å‰çš„æ‹¦æˆªç‚¹
	 */</span>
	<span class="token keyword">default</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/**
	 * æˆåŠŸæ‰§è¡Œå¤„ç†ç¨‹åºåçš„æ‹¦æˆªç‚¹
	 */</span>
	<span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span>
			<span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ModelAndView</span> modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>
	<span class="token comment">/**
	 * è¯·æ±‚å¤„ç†å®Œæˆåçš„å›è°ƒï¼Œå³æ¸²æŸ“è§†å›¾å
	 */</span>
	<span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span>
			<span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><font color="green"><strong>æ‹¦æˆªå™¨çš„å¤„ç†çš„ä½ç½®</strong> </font> 
  <ul><li><font color="Olive"><strong>å‰ç½®å¤„ç†ï¼šæ‰§è¡Œæ–¹æ³•<code>å‰</code></strong></font></li><li><font color="Olive"><strong>åç½®å¤„ç†ï¼šæ‰§è¡Œæ–¹æ³•<code>å</code></strong></font></li><li><font color="Olive"><strong>æœ€ç»ˆå¤„ç†ï¼š<code>æœ€å</code>å¿…æ‰§è¡Œ</strong></font></li></ul> </li></ul> 
<p><img src="https://images2.imgbox.com/cb/95/MRluXrj8_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="1preHandle_1222"></a>1ã€æ‰§è¡Œæ‹¦æˆªå™¨preHandleæ–¹æ³•</h3> 
<ul><li><font color="RoyalBlue"><strong>éå†æ‰€æœ‰çš„æ‹¦æˆªå™¨ï¼Œè°ƒç”¨preHandleæ–¹æ³•</strong> </font> 
  <ul><li><font color="green"><strong>è¿”å›trueï¼Œåˆ™æ­£å¸¸éå†æ‰€æœ‰çš„æ‹¦æˆªå™¨ï¼Œå¹¶è°ƒç”¨æ‰€æœ‰æ‹¦æˆªå™¨çš„<code>preHandle</code>æ–¹æ³•</strong></font></li><li><font color="green"><strong>è¿”å›falseï¼Œåˆ™ä¸å†å¾ªç¯éå†åé¢çš„æ‹¦æˆªå™¨ï¼Œåªä¼šè°ƒç”¨å½“å‰æ‹¦æˆªå™¨çš„æœ€ç»ˆæ–¹æ³•<code>afterCompletion</code>ï¼Œå¹¶ä¸”<code>Handleréƒ½ä¸å†æ‰§è¡Œ</code>ï¼Œç›´æ¥è¿”å›</strong></font></li></ul> </li></ul> 
<pre><code class="prism language-java"><span class="token comment">// HandlerExecutionChainç±»æ–¹æ³•</span>
<span class="token keyword">boolean</span> <span class="token function">applyPreHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interceptorList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// éå†æ‰€æœ‰çš„æ‹¦æˆªå™¨ï¼Œè°ƒç”¨preHandleæ–¹æ³•</span>
		<span class="token class-name">HandlerInterceptor</span> interceptor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interceptorList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>interceptor<span class="token punctuation">.</span><span class="token function">preHandle</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handler<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">triggerAfterCompletion</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// æ‹¦æˆªå™¨é›†åˆç´¢å¼•ä¸‹æ ‡è®°å½•</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>interceptorIndex <span class="token operator">=</span> i<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2postHandle_1246"></a>2ã€æ‰§è¡Œæ‹¦æˆªå™¨postHandleæ–¹æ³•</h3> 
<ul><li><font color="green"><strong>æ­£å¸¸éå†è°ƒç”¨ï¼Œä½†æ˜¯æ˜¯æ ¹æ®æ‹¦æˆªå™¨é¡ºåºçš„<code>å€’åº</code>éå†æ‰§è¡Œ<code>postHandle</code>æ–¹æ³•</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token comment">// HandlerExecutionChainç±»æ–¹æ³•</span>
<span class="token keyword">void</span> <span class="token function">applyPostHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ModelAndView</span> mv<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interceptorList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">HandlerInterceptor</span> interceptor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interceptorList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		interceptor<span class="token punctuation">.</span><span class="token function">postHandle</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handler<span class="token punctuation">,</span> mv<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3afterCompletion_1262"></a>3ã€æ‰§è¡Œæ‹¦æˆªå™¨afterCompletionæ–¹æ³•</h3> 
<ul><li><font color="RoyalBlue"><strong>interceptorIndexè®°å½•çš„æ˜¯å‡ ä¸ªæ‰§è¡Œè¿‡preHandleæ–¹æ³•çš„æ‹¦æˆªå™¨çš„æ•°é‡</strong></font></li><li><font color="green"><strong>è¿™é‡Œä¹Ÿæ˜¯<code>å€’åº</code>è°ƒç”¨<code>afterCompletion</code>æ–¹æ³•</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token keyword">void</span> <span class="token function">triggerAfterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interceptorIndex<span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">HandlerInterceptor</span> interceptor <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interceptorList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			interceptor<span class="token punctuation">.</span><span class="token function">afterCompletion</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handler<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"HandlerInterceptor.afterCompletion threw exception"</span><span class="token punctuation">,</span> ex2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><font color="#d32b8f"><strong>ä¸€èˆ¬æ¥è¯´æ‹¦æˆªå™¨preHandleçš„æ–¹æ³•ä¼šè¿”å›true(è¡¨ç¤ºæ”¾è¡Œ)ï¼Œé‚£ä¹ˆå¯¹äºæ‹¦æˆªå™¨ä¸‰ä¸ªæ–¹æ³•æ‰§è¡Œé¡ºåºå³ä¸ºï¼š123 321 321</strong></font></p> 
<h2><a id="_1285"></a>äº”ã€å¼‚å¸¸å¤„ç†å™¨</h2> 
<p>â€ƒâ€ƒ<font color="BlueViolet"><strong>ä¹‹å‰æ–‡ç« <a href="https://xuchang.blog.csdn.net/article/details/134139936" rel="nofollow">SpringMVCæºç è§£æ(ä¸€)ï¼šwebå®¹å™¨å¯åŠ¨æµç¨‹</a>æœ‰ä»‹ç»ï¼Œç­›é€‰å¼‚å¸¸å¤„ç†å™¨å³<code>ç±»ä¸Š@ControllerAdvice</code>ï¼Œ<code>æ–¹æ³•ä¸Š@ExceptionHandler</code>ã€‚</strong></font></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExceptionController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">exceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token string">"ç³»ç»Ÿå¼‚å¸¸"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><font color="RoyalBlue"><strong>å¼‚å¸¸å¤„ç†å™¨è§¦å‘ä½ç½®</strong></font></li></ul> 
<p><img src="https://images2.imgbox.com/5d/dc/hW19ONcW_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<pre><code class="prism language-java"><span class="token comment">// DispatcherServletç±»æ–¹æ³•</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">processDispatchResult</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Nullable</span> <span class="token class-name">HandlerExecutionChain</span> mappedHandler<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ModelAndView</span> mv<span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">boolean</span> errorView <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>exception <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>exception <span class="token keyword">instanceof</span> <span class="token class-name">ModelAndViewDefiningException</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"ModelAndViewDefiningException encountered"</span><span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mv <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ModelAndViewDefiningException</span><span class="token punctuation">)</span> exception<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">Object</span> handler <span class="token operator">=</span> <span class="token punctuation">(</span>mappedHandler <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> mappedHandler<span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// æ‰§è¡Œå¼‚å¸¸å¤„ç†å™¨</span>
			mv <span class="token operator">=</span> <span class="token function">processHandlerException</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> handler<span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
			errorView <span class="token operator">=</span> <span class="token punctuation">(</span>mv <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	
	<span class="token comment">// æ‰§è¡Œæ‹¦æˆªå™¨çš„æœ€ç»ˆå¤„ç†</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mappedHandler <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		mappedHandler<span class="token punctuation">.</span><span class="token function">triggerAfterCompletion</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><font color="green"><strong>éå†æ‰€æœ‰çš„å¼‚å¸¸å¤„ç†å™¨ï¼Œè°ƒç”¨<code>resolveException</code>æ–¹æ³•ï¼Œè¿”å›ç»“æœä¸ä¸ºnullï¼Œå³è·³å‡ºå¾ªç¯ç›´æ¥è¿”å›</strong></font></li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Nullable</span>
<span class="token keyword">protected</span> <span class="token class-name">ModelAndView</span> <span class="token function">processHandlerException</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span>
		<span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

	<span class="token comment">// éå†å¼‚å¸¸å¤„ç†å™¨</span>
	<span class="token class-name">ModelAndView</span> exMv <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlerExceptionResolvers <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">HandlerExceptionResolver</span> resolver <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlerExceptionResolvers<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			exMv <span class="token operator">=</span> resolver<span class="token punctuation">.</span><span class="token function">resolveException</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> handler<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>exMv <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// æœ€åæŠ›å‡ºå¼‚å¸¸</span>
	<span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_1360"></a>æ€»ç»“</h2> 
<p>â€ƒâ€ƒ<font color="BlueViolet"><strong>JavaWebæ˜¯æ¯ä¸€ä¸ªä¸šåŠ¡é€»è¾‘å°±éœ€è¦æ„å»ºä¸€ä¸ª<code>Servelt</code>ï¼ŒTomcatè§£æè¯·æ±‚ä¹Ÿæ˜¯é€šè¿‡è¯·æ±‚è·¯å¾„æ˜ å°„æ‰¾åˆ°å¯¹äºçš„Serveltç¨‹åºã€‚è€ŒSpringMVCåªæ„å»º<code>ä¸€ä¸ª</code>Serveltï¼Œé‚£å°±æ˜¯<code>DispatcherServlet</code>ï¼Œè¿™é‡ŒServeltæ¥æ”¶æ‰€æœ‰çš„è¯·æ±‚ï¼Œç„¶åå†æ ¹æ®è¯·æ±‚è·¯å¾„åˆ†å‘å‡ºå»æ‰¾åˆ°å¯¹äºçš„Controlleræ–¹æ³•ã€‚</strong></font></p> 
<ul><li><font color="RoyalBlue"><strong>è·å–æ‰§è¡Œå™¨é“¾ï¼ˆåŒ…æ‹¬Handlerå’Œæ‹¦æˆªå™¨ï¼‰</strong> </font> 
  <ul><li><font color="Olive"><strong>æˆªå–è¯·æ±‚<code>uri</code>è·å–@RequestMappingæ³¨è§£æ˜ å°„çš„è·¯å¾„</strong></font></li><li><font color="Olive"><strong>é¡¹ç›®å¯åŠ¨æ—¶ï¼Œå°†æ‰€æœ‰<code>@Controller#Method @RequestMapping</code>å¯¹åº”å…³ç³»æ·»åŠ åˆ°<code>map</code>é›†åˆä¸­</strong></font></li><li><font color="Olive"><strong>è¿™é‡Œé€šè¿‡è¯·æ±‚è·¯å¾„å¯ä»¥è·å–åˆ°å…·ä½“çš„Controller#Method</strong></font></li><li><font color="Olive"><strong>å¯¹äºæ‹¦æˆªå™¨ä¹Ÿæ˜¯åœ¨é¡¹ç›®å¯åŠ¨é˜¶æ®µï¼Œå°†æ‰€æœ‰æ‹¦æˆªå™¨æ ¹æ®æ’åºæ”¾åˆ°é›†åˆä¸­ï¼Œè¿™é‡Œç›´æ¥æ‹¿æ¥å³å¯</strong></font></li></ul> </li></ul> 
<p>â€ƒâ€ƒ<font color="purple"><strong>å®šä¹‰Handlerçš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œæ—©æœŸæœ‰å®ç°Controllerã€HttpRequestHandleræ¥å£ï¼Œç°åœ¨å¸¸ç”¨çš„@Controlleræ–¹å¼ï¼Œä¸åŒçš„Handleræ–¹å¼ç”Ÿæˆè¯·æ±‚å’ŒHandlerçš„æ˜ å°„çš„æ–¹æ³•å°±ä¸åŒï¼Œè¿™æ—¶å€™æŠ½è±¡å‡ºæ¥<code>HandlerMapping</code><font color="green">(æ ¹æ®requestè¯·æ±‚åŒ¹é…/æ˜ å°„ä¸Šèƒ½å¤Ÿå¤„ç†å½“å‰requestçš„Handler)</font>ï¼Œä¸Šé¢è¯´çš„è·å–æ‰§è¡Œå™¨é“¾è·å–Handlerå°±æ˜¯ä¸“é—¨å¤„ç†@Controllerçš„HandlerMappingï¼Œè¿™æ ·å°±å‡ºç°äº†ä¸åŒå®ç°çš„HandlerMappingã€‚</strong><br> â€ƒâ€ƒ<font color="purple"><strong>ä¸åŒHandlerè°ƒç”¨å…·ä½“å®ç°é€»è¾‘çš„æ–¹æ³•ä¹Ÿä¸åŒï¼Œ@Controlleræ–¹å¼ç›´æ¥è°ƒç”¨è®°å½•çš„ç±»çš„Methodå³å¯ï¼Œè€Œå…¶ä»–å®ç°æ¥å£çš„æ–¹å¼è¿™æ˜¯è°ƒç”¨æ­¤æ¥å£å®ç°ç±»çš„é‡å†™handleRequestæ–¹æ³•ï¼Œè¿™æ—¶å€™æŠ½è±¡å‡ºæ¥<code>HandlerAdapter</code>ï¼Œ<font color="green">ä¸åŒHandlerAdapterå¤„ç†ä¸åŒHandlerã€‚</font></strong></font></font></p> 
<ul><li><font color="Blue"><strong>æ‰§è¡ŒHandlerå‰ï¼Œå³è°ƒç”¨Controllerå…·ä½“æ–¹æ³•ï¼Œéœ€è¦å°†æ–¹æ³•çš„å‚æ•°éƒ½è·å–åˆ°</strong> </font> 
  <ul><li><font color="Olive"><strong>å¯¹äºæˆ‘ä»¬å¸¸è§çš„<code>@RequestBody</code>ã€<code>@RequestParam</code>ã€<code>@PathVariable</code>æ³¨è§£SpringMVCéƒ½å†…ç½®çš„<code>å‚æ•°è§£æå™¨</code></strong></font></li><li><font color="Olive"><strong>@RequestBodyçš„å‚æ•°è§£æéœ€è¦ç”¨åˆ°æ¶ˆæ¯è½¬æ¢å™¨(è¯·æ±‚ä¿¡æ¯è½¬æ¢ä¸ºjavaå¯¹è±¡)ï¼ŒSpringMVCå†…ç½®çš„Byteã€Stringç­‰è½¬æ¢å™¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¯¼åŒ…å¯¼å…¥<code>jackson</code>å’Œ<code>fastjson</code>è½¬æ¢å™¨</strong></font></li><li><font color="Olive"><strong>å¯¹äºjsonè½¬æ¢å™¨å°±æ˜¯å°†è¯·æ±‚ä¿¡æ¯é‡Œbodyçš„<code>jsonå­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºjavaå¯¹è±¡</code></strong></font></li><li><font color="Olive"><strong>åœ¨è½¬æ¢å¯¹è±¡å‰åï¼ŒSpringMVCç•™ä¸‹äº†æ‰©å±•ç‚¹ï¼Œ<code>è¯·æ±‚å¢å¼ºå™¨RequestponseBodyAdvice</code>ï¼Œå¯ä»¥å¯¹<code>è½¬æ¢å‰</code>çš„bodyå’Œè½¬æ¢åçš„å¯¹è±¡åšæ‰©å±•å¤„ç†</strong></font></li></ul> </li><li><font color="Blue"><strong>æ‰§è¡ŒHandlerå°±å¾ˆç®€å•äº†ï¼Œç›´æ¥method.invoke(obj,args)åå°„è°ƒç”¨æ–¹æ³•å³å¯</strong></font></li><li><font color="Blue"><strong>æ‰§è¡ŒHandleråï¼Œä½¿ç”¨è¿”å›å€¼å¤„ç†å™¨å¯¹è±¡è¿”å›å€¼åšå¤„ç†äº†</strong> </font> 
  <ul><li><font color="Olive"><strong>å¯¹äºç±»ä¸Šæˆ–æ–¹æ³•ä¸Šæœ‰<code>@ResponseBody</code>çš„ï¼Œä½¿ç”¨æ¶ˆæ¯è½¬æ¢å™¨å°†<code>javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå­—ç¬¦ä¸²</code>(ä»¥åä¼šä¼ ç»™å‰ç«¯)</strong></font></li><li><font color="Olive"><strong>åŒæ ·ä¹Ÿæ˜¯å†è½¬æ¢å‰ï¼ŒSpringMVCç•™ä¸‹äº†æ‰©å±•ç‚¹ï¼Œ<code>å“åº”å¢å¼ºå™¨ResponseBodyAdvice</code>ï¼Œå¯ä»¥å¯¹æ–¹æ³•è¿”å›å€¼åšæ‰©å±•å¤„ç†å†åºåˆ—åŒ–</strong></font></li></ul> </li><li><font color="RoyalBlue"><strong>å†è¯´ä¸‹æˆ‘ä»¬å¸¸ç”¨çš„æ‰©å±•ç‚¹ï¼Œæ‹¦æˆªå™¨ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œ<code>å‰å</code>åŠ<code>æœ€å</code>æ— è®ºæ˜¯å¦æŠ›å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œçš„<code>ä¸‰ä¸ªä½ç½®</code>ï¼Œéƒ½å¯ä»¥åšæ‰©å±•å¤„ç†</strong></font></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f16bb548cf52027f5a74ea871ec8cb5e/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">å†™ä»£ç å¯¹äººçš„å½±å“</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0d39be3a5019cb1a12d65e014cf81a98/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">ã€STM32ã€‘STM32å•ç‰‡æœºå…¥é—¨</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>