<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kafka学习-Java使用Kafka - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/c1681b8f2918635ec797455ca7cba5f4/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Kafka学习-Java使用Kafka">
  <meta property="og:description" content="文章目录 前言一、Kafka1、什么是消息队列offset 2、高性能topicpartition 3、高扩展broker 4、高可用replicas、leader、follower 5、持久化和过期策略6、消费者组7、Zookeeper8、架构图 二、安装Zookeeper三、安装Kafka四、Java中使用Kafka1、引入依赖2、生产者3、消费者4、运行效果 前言 Kafka消息中间件
一、Kafka 1、什么是消息队列 假设我们有两个服务：生产者A每秒能生产200个消息，消费者B每秒能消费100个消息。
那么B服务是处理不了A这么多消息的，那么怎么使B不被压垮的同时还能处理A的消息呢，我们引入一个中间件，即Kafka。（当然着并不能使消费者的处理速度上升）
offset 那么我们可以在B服务中加入一个队列，也就是一个链表，链表的每个节点相当于一条消息，每个节点有一个序号即offset，记录消息的位置。
但是这样也会有个问题，还没有处理的消息是存储在内存中的，如果B服务挂掉，那么消息也就丢失了。
所以我们可以把队列移出，变成一个单独的进程，即使B服务挂掉，消息也不会丢失。
2、高性能 B服务由于性能差，队列中未处理的消息会越来越多，我们可以增加更多的消费者来处理消息，相对的也可以增加更多的生产者来生成消息。
topic 但是，生产者与消费者会争抢同一个队列，没有抢到就要等待，那么怎么解决呢？
我们可以将消息进行分类，每一类消息是一个topic，生产者按消息的类型投递到不同的topic中，消费者也按照不同的topic进行消费。
partition 但是单个topic的消息还是有可能过多，我们可以将单个队列拆分，每段是一个partition分区，每个消费者负责一个partition。
3、高扩展 broker 随着partition过多，所有的partition都在同一个机器上，就可能会导致单机的cpu和内存过高，影响性能，那么我们可以使用多台机器，将partition分散部署在不同的机器上。每台机器就代表一个broker。
我们可以增加broker来缓解服务器的cpu过高的性能问题。
4、高可用 replicas、leader、follower 假如某个broker挂了， 那么其中partition中的消息也就都丢失了，那么这个问题怎么解决呢？
我们可以给partition多加几个副本，统称replicas，并将它们分为leader和follower。
leader负责生产者和消费者的读写，follower只负责同步leader的数据。假如leader挂了，也不会影响follower，随后在follower中选出一个leader，保证消息队列的高可用。
5、持久化和过期策略 在上面讲述了leader挂掉的情况，如果所有的broker都挂了，消息不就都丢失了？
为了解决这个问题，就不能只把数据存在内存中，也要存在磁盘中。
但是如果所有消息一直保存在磁盘中，那磁盘也会被占满，所以引入保留策略。
6、消费者组 如果我想在原有的基础上增加一个消费者，那么它只能跟着最新的offset接着消费，如果我想从某个offset开始消费呢？
我们引入消费者组，实现不同消费者维护自己的消费进度。
7、Zookeeper 上面介绍了很多的组件，每个组件都有自己的状态信息，那么就需要有一个组件去统一维护这些组件的状态信息，于是引入了Zookeeper组件，它会定期与broker通信，获取Kafka集群的状态，判断哪些broker挂了，消费者组消费到哪了等等。
8、架构图 二、安装Zookeeper 1、官网地址
https://zookeeper.apache.org/
2、下载
选择稳定版本下载
3、解压，修改配置文件
解压后，复制 zoo_sample.cfg，重命名为 zoo.cfg
修改数据文件目录位置
4、启动
我们是在windows系统下安装的，运行 bin 目录下的 zkServer.cmd
三、安装Kafka 1、官网地址
https://kafka.apache.org/
2、下载
3、解压，修改配置文件
修改 config 目录下 server.properties 文件">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-11T11:47:17+08:00">
    <meta property="article:modified_time" content="2024-05-11T11:47:17+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Kafka学习-Java使用Kafka</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_5" rel="nofollow">前言</a></li><li><a href="#Kafka_10" rel="nofollow">一、Kafka</a></li><li><ul><li><a href="#1_12" rel="nofollow">1、什么是消息队列</a></li><li><ul><li><a href="#offset_21" rel="nofollow">offset</a></li></ul> 
   </li><li><a href="#2_33" rel="nofollow">2、高性能</a></li><li><ul><li><a href="#topic_39" rel="nofollow">topic</a></li><li><a href="#partition_45" rel="nofollow">partition</a></li></ul> 
   </li><li><a href="#3_51" rel="nofollow">3、高扩展</a></li><li><ul><li><a href="#broker_53" rel="nofollow">broker</a></li></ul> 
   </li><li><a href="#4_60" rel="nofollow">4、高可用</a></li><li><ul><li><a href="#replicasleaderfollower_62" rel="nofollow">replicas、leader、follower</a></li></ul> 
   </li><li><a href="#5_70" rel="nofollow">5、持久化和过期策略</a></li><li><a href="#6_75" rel="nofollow">6、消费者组</a></li><li><a href="#7Zookeeper_83" rel="nofollow">7、Zookeeper</a></li><li><a href="#8_87" rel="nofollow">8、架构图</a></li></ul> 
  </li><li><a href="#Zookeeper_92" rel="nofollow">二、安装Zookeeper</a></li><li><a href="#Kafka_122" rel="nofollow">三、安装Kafka</a></li><li><a href="#JavaKafka_146" rel="nofollow">四、Java中使用Kafka</a></li><li><ul><li><a href="#1_148" rel="nofollow">1、引入依赖</a></li><li><a href="#2_157" rel="nofollow">2、生产者</a></li><li><a href="#3_185" rel="nofollow">3、消费者</a></li><li><a href="#4_250" rel="nofollow">4、运行效果</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_5"></a>前言</h2> 
<p><a href="https://blog.csdn.net/qsmiley10/article/details/115000474?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171516959616800222898691%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=171516959616800222898691&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-115000474-null-null.142%5Ev100%5Epc_search_result_base3&amp;utm_term=java%20kafka&amp;spm=1018.2226.3001.4187">Kafka消息中间件</a></p> 
<h2><a id="Kafka_10"></a>一、Kafka</h2> 
<h3><a id="1_12"></a>1、什么是消息队列</h3> 
<p>假设我们有两个服务：生产者A每秒能生产200个消息，消费者B每秒能消费100个消息。</p> 
<p><img src="https://images2.imgbox.com/29/ce/1PNGGX1e_o.png" alt="在这里插入图片描述"></p> 
<p>那么B服务是处理不了A这么多消息的，那么怎么使B不被压垮的同时还能处理A的消息呢，我们引入一个中间件，即<code>Kafka</code>。（当然着并不能使消费者的处理速度上升）</p> 
<p><img src="https://images2.imgbox.com/02/64/UEtOpjyH_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="offset_21"></a>offset</h4> 
<p>那么我们可以在B服务中加入一个队列，也就是一个链表，链表的每个节点相当于一条消息，每个节点有一个序号即<code>offset</code>，记录消息的位置。</p> 
<p><img src="https://images2.imgbox.com/30/08/Yi6LgApK_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/cc/f2/IVvnkrDu_o.png" alt="在这里插入图片描述"></p> 
<p>但是这样也会有个问题，还没有处理的消息是存储在内存中的，如果B服务挂掉，那么消息也就丢失了。<br> 所以我们可以把队列移出，变成一个单独的进程，即使B服务挂掉，消息也不会丢失。</p> 
<p><img src="https://images2.imgbox.com/9b/bb/cLSQFiIv_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_33"></a>2、高性能</h3> 
<p>B服务由于性能差，队列中未处理的消息会越来越多，我们可以增加更多的消费者来处理消息，相对的也可以增加更多的生产者来生成消息。</p> 
<p><img src="https://images2.imgbox.com/42/e1/dcuRouOj_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="topic_39"></a>topic</h4> 
<p>但是，生产者与消费者会争抢同一个队列，没有抢到就要等待，那么怎么解决呢？<br> 我们可以将消息进行分类，每一类消息是一个<code>topic</code>，生产者按消息的类型投递到不同的<code>topic</code>中，消费者也按照不同的topic进行消费。</p> 
<p><img src="https://images2.imgbox.com/22/96/Sj3wpUOK_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="partition_45"></a>partition</h4> 
<p>但是单个topic的消息还是有可能过多，我们可以将单个队列拆分，每段是一个<code>partition</code>分区，每个消费者负责一个<code>partition</code>。</p> 
<p><img src="https://images2.imgbox.com/a7/71/Hjm0ZOVe_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_51"></a>3、高扩展</h3> 
<h4><a id="broker_53"></a>broker</h4> 
<p>随着<code>partition</code>过多，所有的<code>partition</code>都在同一个机器上，就可能会导致单机的cpu和内存过高，影响性能，那么我们可以使用多台机器，将<code>partition</code>分散部署在不同的机器上。每台机器就代表一个<code>broker</code>。<br> 我们可以增加<code>broker</code>来缓解服务器的cpu过高的性能问题。</p> 
<p><img src="https://images2.imgbox.com/3b/65/in6iPmkz_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4_60"></a>4、高可用</h3> 
<h4><a id="replicasleaderfollower_62"></a>replicas、leader、follower</h4> 
<p>假如某个<code>broker</code>挂了， 那么其中<code>partition</code>中的消息也就都丢失了，那么这个问题怎么解决呢？<br> 我们可以给<code>partition</code>多加几个副本，统称<code>replicas</code>，并将它们分为<code>leader</code>和<code>follower</code>。<br> <code>leader</code>负责生产者和消费者的读写，<code>follower</code>只负责同步<code>leader</code>的数据。假如<code>leader</code>挂了，也不会影响<code>follower</code>，随后在<code>follower</code>中选出一个<code>leader</code>，保证消息队列的高可用。</p> 
<p><img src="https://images2.imgbox.com/c6/3b/iQ7Eg8Iv_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5_70"></a>5、持久化和过期策略</h3> 
<p>在上面讲述了<code>leader</code>挂掉的情况，如果所有的<code>broker</code>都挂了，消息不就都丢失了？<br> 为了解决这个问题，就不能只把数据存在内存中，也要存在磁盘中。<br> 但是如果所有消息一直保存在磁盘中，那磁盘也会被占满，所以引入保留策略。</p> 
<h3><a id="6_75"></a>6、消费者组</h3> 
<p>如果我想在原有的基础上增加一个消费者，那么它只能跟着最新的<code>offset</code>接着消费，如果我想从某个<code>offset</code>开始消费呢？<br> 我们引入消费者组，实现不同消费者维护自己的消费进度。</p> 
<p><img src="https://images2.imgbox.com/ed/98/0SO2MkH0_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="7Zookeeper_83"></a>7、Zookeeper</h3> 
<p>上面介绍了很多的组件，每个组件都有自己的状态信息，那么就需要有一个组件去统一维护这些组件的状态信息，于是引入了<code>Zookeeper</code>组件，它会定期与<code>broker</code>通信，获取<code>Kafka</code>集群的状态，判断哪些<code>broker</code>挂了，消费者组消费到哪了等等。</p> 
<h3><a id="8_87"></a>8、架构图</h3> 
<p><img src="https://images2.imgbox.com/cc/b6/vurOXbC2_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Zookeeper_92"></a>二、安装Zookeeper</h2> 
<p><strong>1、官网地址</strong></p> 
<p><a href="https://zookeeper.apache.org/" rel="nofollow">https://zookeeper.apache.org/</a></p> 
<p><strong>2、下载</strong></p> 
<p><img src="https://images2.imgbox.com/08/f2/80McgGG5_o.png" alt="在这里插入图片描述"></p> 
<p>选择稳定版本下载</p> 
<p><img src="https://images2.imgbox.com/4b/c7/byA8LvTO_o.png" alt="在这里插入图片描述"></p> 
<p><strong>3、解压，修改配置文件</strong></p> 
<p>解压后，复制 zoo_sample.cfg，重命名为 zoo.cfg</p> 
<p><img src="https://images2.imgbox.com/bf/99/73iRDsPL_o.png" alt="在这里插入图片描述"></p> 
<p>修改数据文件目录位置</p> 
<p><img src="https://images2.imgbox.com/f2/4d/MozrgeqP_o.png" alt="在这里插入图片描述"></p> 
<p><strong>4、启动</strong></p> 
<p>我们是在windows系统下安装的，运行 bin 目录下的 zkServer.cmd</p> 
<p><img src="https://images2.imgbox.com/36/d2/CeamuUab_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Kafka_122"></a>三、安装Kafka</h2> 
<p><strong>1、官网地址</strong></p> 
<p><a href="https://kafka.apache.org/" rel="nofollow">https://kafka.apache.org/</a></p> 
<p><strong>2、下载</strong></p> 
<p><img src="https://images2.imgbox.com/a3/e7/Q19xlEJn_o.png" alt="在这里插入图片描述"></p> 
<p><strong>3、解压，修改配置文件</strong></p> 
<p>修改 config 目录下 server.properties 文件<br> 修改日志文件位置，其他参数（如zookeeper端口，根据需要修改）</p> 
<p><img src="https://images2.imgbox.com/00/64/xwnYCEKY_o.png" alt="在这里插入图片描述"></p> 
<p><strong>4、启动</strong></p> 
<pre><code class="prism language-powershell">bin\windows\kafka-server-<span class="token function">start</span><span class="token punctuation">.</span>bat config\server<span class="token punctuation">.</span>properties
</code></pre> 
<p><img src="https://images2.imgbox.com/ae/ca/lbDzhwAi_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="JavaKafka_146"></a>四、Java中使用Kafka</h2> 
<h3><a id="1_148"></a>1、引入依赖</h3> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.kafka<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>kafka-clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="2_157"></a>2、生产者</h3> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Properties</span> prop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">BOOTSTRAP_SERVERS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">"127.0.0.1:9092"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">KEY_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringSerializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">VALUE_SERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringSerializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">ACKS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">"all"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">RETRIES_CONFIG</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">BATCH_SIZE_CONFIG</span><span class="token punctuation">,</span> <span class="token number">16384</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">LINGER_MS_CONFIG</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ProducerConfig</span><span class="token punctuation">.</span><span class="token constant">BUFFER_MEMORY_CONFIG</span><span class="token punctuation">,</span> <span class="token number">33554432</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> topic <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>

    <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> producer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaProducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        producer<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProducerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>topic<span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"hello kafka"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"生产消息："</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    producer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3_185"></a>3、消费者</h3> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Properties</span> prop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span><span class="token constant">BOOTSTRAP_SERVERS_CONFIG</span><span class="token punctuation">,</span><span class="token string">"127.0.0.1:9092"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span><span class="token constant">KEY_DESERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringDeserializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span><span class="token constant">VALUE_DESERIALIZER_CLASS_CONFIG</span><span class="token punctuation">,</span> <span class="token string">"org.apache.kafka.common.serialization.StringDeserializer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span><span class="token constant">GROUP_ID_CONFIG</span><span class="token punctuation">,</span> <span class="token string">"con-1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 消费者组</span>
    prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span><span class="token constant">AUTO_OFFSET_RESET_CONFIG</span><span class="token punctuation">,</span> <span class="token string">"latest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span><span class="token constant">ENABLE_AUTO_COMMIT_CONFIG</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//自动提交偏移量</span>
    prop<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ConsumerConfig</span><span class="token punctuation">.</span><span class="token constant">AUTO_COMMIT_INTERVAL_MS_CONFIG</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//自动提交时间</span>

    <span class="token class-name">KafkaConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> consumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">KafkaConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> topics <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//可以订阅多个消息</span>
    topics<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    consumer<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>topics<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">ConsumerRecords</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> poll <span class="token operator">=</span> consumer<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TopicPartition</span> topicPartition <span class="token operator">:</span> poll<span class="token punctuation">.</span><span class="token function">partitions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

                <span class="token comment">//	通过TopicPartition获取指定的消息集合，获取到的就是当前topicPartition下面所有的消息</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ConsumerRecord</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> partitionRecords <span class="token operator">=</span> poll<span class="token punctuation">.</span><span class="token function">records</span><span class="token punctuation">(</span>topicPartition<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//	获取TopicPartition对应的主题名称</span>
                <span class="token class-name">String</span> topic <span class="token operator">=</span> topicPartition<span class="token punctuation">.</span><span class="token function">topic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//	获取TopicPartition对应的分区位置</span>
                <span class="token keyword">int</span> partition <span class="token operator">=</span> topicPartition<span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//	获取当前TopicPartition下的消息条数</span>
                <span class="token keyword">int</span> size <span class="token operator">=</span> partitionRecords<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"--- 获取topic: %s, 分区位置：%s, 消息总数： %s%n"</span><span class="token punctuation">,</span>
                        topic<span class="token punctuation">,</span>
                        partition<span class="token punctuation">,</span>
                        size<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">ConsumerRecord</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> consumerRecord <span class="token operator">=</span> partitionRecords<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//	实际的数据内容</span>
                    <span class="token class-name">String</span> key <span class="token operator">=</span> consumerRecord<span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//	实际的数据内容</span>
                    <span class="token class-name">String</span> value <span class="token operator">=</span> consumerRecord<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//	当前获取的消息偏移量</span>
                    <span class="token keyword">long</span> offset <span class="token operator">=</span> consumerRecord<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//	表示下一次从什么位置(offset)拉取消息</span>
                    <span class="token keyword">long</span> commitOffser <span class="token operator">=</span> offset <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"消费消息 key：%s, value：%s, 消息offset: %s, 提交offset: %s%n"</span><span class="token punctuation">,</span>
                            key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> commitOffser<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
        consumer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4_250"></a>4、运行效果</h3> 
<p>生产消息</p> 
<p><img src="https://images2.imgbox.com/ad/54/oHAd3n8Y_o.png" alt="在这里插入图片描述"></p> 
<p>消费消息</p> 
<p><img src="https://images2.imgbox.com/b7/f0/MWgjfqhC_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b0/d1/kxoaKrns_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/83f05f2a241eea420e81f0159005c731/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">安卓模拟器Frida环境搭建 （mumu&#43;adb&#43;frida）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e8c93409221424d29eb45a443985545a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【记录】LangChain｜Ollama结合LangChain使用的速通版（包含代码以及切换各种模型的方式）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>