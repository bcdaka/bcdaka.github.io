<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>接口开发笔记-WebApi - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/6155983d9990e287670a01eb8ea00b17/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="接口开发笔记-WebApi">
  <meta property="og:description" content="一、基础概念与原理 1、WebAPI的基本概念。 WebAPI是一种基于HTTP协议的网络应用程序接口，它使用JSON或XML格式来传输数据。WebAPI是服务器端应用程序，允许客户端应用程序通过HTTP请求来访问服务器上的数据。WebAPI支持RESTful服务，是构建这种服务的理想选择。同时，WebAPI的客户端系统和服务系统彼此独立，调用者可以使用不同的语言（如Java、Python、Ruby等）进行API的调用。
2、与WebService、WCF等技术的区别与联系。 2.1、WebAPI与WebService的区别 数据传输格式：虽然WebService也支持基于XML格式的数据传输，但在实际生产过程中，WebAPI更常见的数据类型格式是JSON。与XML相比，JSON更加轻量，序列化和反序列化的工作量更少，因此在解析速率方面更快，对带宽的要求更低。交互方式：WebService基于SOAP协议，而WebAPI使用json数据来传递信息，更加轻量化地构建HTTP服务框架。系统交互：WebService通常仅在两个系统之间交互，并且不同的客户端下各浏览器对XML的解析方式不一致，需要重复编写很多代码。而WebAPI的客户端系统和服务系统彼此独立，具有更广泛的适用性。 2.2、WebAPI与WCF的区别 框架与开放性：WCF是附带.NET框架的，不是开源的；而WebAPI是开源的，并且也附带.NET框架。服务支持：WCF提供对有限RESTFUL服务的支持；而WebAPI是构建RESTFUL服务的理想选择。配置方式：WCF使用web.config和属性来配置一个HttpConfiguration类；而WebAPI则主要使用web.config服务进行配置。编程模型：WCF依赖于基于属性的编程模型；而WebAPI将HTTP动词映射到方法。功能支持：WCF不支持MVC功能，如控制器、路由、过滤器等；而WebAPI则与这些功能紧密集成。 3、如何通过WebAPI实现资源的操作。 通过ASP.NET Web API框架，可以实现资源的创建（POST）、读取（GET）、更新（PUT/PATCH）和删除（DELETE）等操作，这些操作都遵循RESTful架构风格。以下是一个简单的步骤：
1.1、创建ASP.NET Web API项目 首先，需要在Visual Studio中创建一个ASP.NET Web API项目。通过选择“文件” -&gt; “新建” -&gt; “项目”，然后在项目模板中选择“ASP.NET Web 应用程序”来完成。在创建过程中，选择“Web API”作为项目类型。
1.2、定义模型（Model） 模型类代表了你想要通过API操作的数据资源。例如，如果你想要操作一个用户资源，你可以定义一个User类：
public class User { public int Id { get; set; } public string Name { get; set; } public string Email { get; set; } } 1.3、创建控制器（Controller） 控制器负责处理HTTP请求并返回响应。你需要创建一个继承自ApiController的类，并添加与资源操作对应的方法。
using System; using System.Collections.Generic; using System.Linq; using System.Web; using System.Web.Http; using WebApplication1.Models; namespace WebApplication1.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-27T08:32:22+08:00">
    <meta property="article:modified_time" content="2024-03-27T08:32:22+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">接口开发笔记-WebApi</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>一、基础概念与原理</h2> 
<h3><a id="1WebAPI_2"></a>1、WebAPI的基本概念。</h3> 
<p>WebAPI是一种基于HTTP协议的网络应用程序接口，它使用JSON或XML格式来传输数据。WebAPI是服务器端应用程序，允许客户端应用程序通过HTTP请求来访问服务器上的数据。WebAPI支持RESTful服务，是构建这种服务的理想选择。同时，WebAPI的客户端系统和服务系统彼此独立，调用者可以使用不同的语言（如Java、Python、Ruby等）进行API的调用。</p> 
<h3><a id="2WebServiceWCF_6"></a>2、与WebService、WCF等技术的区别与联系。</h3> 
<h4><a id="21WebAPIWebService_8"></a>2.1、WebAPI与WebService的区别</h4> 
<ol><li>数据传输格式：虽然WebService也支持基于XML格式的数据传输，但在实际生产过程中，WebAPI更常见的数据类型格式是JSON。与XML相比，JSON更加轻量，序列化和反序列化的工作量更少，因此在解析速率方面更快，对带宽的要求更低。</li><li>交互方式：WebService基于SOAP协议，而WebAPI使用json数据来传递信息，更加轻量化地构建HTTP服务框架。</li><li>系统交互：WebService通常仅在两个系统之间交互，并且不同的客户端下各浏览器对XML的解析方式不一致，需要重复编写很多代码。而WebAPI的客户端系统和服务系统彼此独立，具有更广泛的适用性。</li></ol> 
<h4><a id="22WebAPIWCF_14"></a>2.2、WebAPI与WCF的区别</h4> 
<ol><li>框架与开放性：WCF是附带.NET框架的，不是开源的；而WebAPI是开源的，并且也附带.NET框架。</li><li>服务支持：WCF提供对有限RESTFUL服务的支持；而WebAPI是构建RESTFUL服务的理想选择。</li><li>配置方式：WCF使用web.config和属性来配置一个HttpConfiguration类；而WebAPI则主要使用web.config服务进行配置。</li><li>编程模型：WCF依赖于基于属性的编程模型；而WebAPI将HTTP动词映射到方法。</li><li>功能支持：WCF不支持MVC功能，如控制器、路由、过滤器等；而WebAPI则与这些功能紧密集成。</li></ol> 
<h3><a id="3WebAPI_22"></a>3、如何通过WebAPI实现资源的操作。</h3> 
<p>通过ASP.NET Web API框架，可以实现资源的创建（POST）、读取（GET）、更新（PUT/PATCH）和删除（DELETE）等操作，这些操作都遵循RESTful架构风格。以下是一个简单的步骤：</p> 
<h4><a id="11ASPNET_Web_API_26"></a>1.1、创建ASP.NET Web API项目</h4> 
<p>首先，需要在Visual Studio中创建一个ASP.NET Web API项目。通过选择“文件” -&gt; “新建” -&gt; “项目”，然后在项目模板中选择“ASP.NET Web 应用程序”来完成。在创建过程中，选择“Web API”作为项目类型。</p> 
<p><img src="https://images2.imgbox.com/91/77/iKlY7lH2_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/6d/08/eb8eEvZf_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/c4/c2/rnkDN1w7_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="12Model_39"></a>1.2、定义模型（Model）</h4> 
<p>模型类代表了你想要通过API操作的数据资源。例如，如果你想要操作一个用户资源，你可以定义一个<code>User</code>类：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Email <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="13Controller_52"></a>1.3、创建控制器（Controller）</h4> 
<p>控制器负责处理HTTP请求并返回响应。你需要创建一个继承自<code>ApiController</code>的类，并添加与资源操作对应的方法。</p> 
<p><img src="https://images2.imgbox.com/b6/8f/fKP4A9Tz_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/dd/29/HgVtFm7F_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Http</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">WebApplication1<span class="token punctuation">.</span>Models</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">WebApplication1<span class="token punctuation">.</span>Controllers</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RoutePrefix</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"api/Test"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ApiController</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// GET api/Test  </span>
        <span class="token punctuation">[</span>HttpGet<span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"GetUser"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> <span class="token function">GetUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 返回所有用户的逻辑</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span> <span class="token punctuation">{<!-- --></span> Id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> Email <span class="token operator">=</span> <span class="token string">"alice@example.com"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span> <span class="token punctuation">{<!-- --></span> Id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token string">"Bob"</span><span class="token punctuation">,</span> Email <span class="token operator">=</span> <span class="token string">"bob@example.com"</span> <span class="token punctuation">}</span>  
            <span class="token comment">// ... 其他用户数据  </span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// GET api/Test/5  </span>
        <span class="token punctuation">[</span>HttpGet<span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"GetMyUser"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">User</span> <span class="token function">GetMyUser</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 根据ID返回单个用户的逻辑  </span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span> <span class="token punctuation">{<!-- --></span> Id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> Name <span class="token operator">=</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> Email <span class="token operator">=</span> <span class="token string">"alice@example.com"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// POST api/Test  </span>
        <span class="token punctuation">[</span>HttpPost<span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"PostUser"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IHttpActionResult</span> <span class="token function">PostUser</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 创建新用户的逻辑  </span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ModelState<span class="token punctuation">.</span>IsValid<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token function">BadRequest</span><span class="token punctuation">(</span>ModelState<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 假设的创建新用户逻辑  </span>
            <span class="token class-name"><span class="token keyword">bool</span></span> success <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 创建成功，返回201 Created状态码，并可能包含新用户的URI  </span>
                <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>Id<span class="token operator">+</span><span class="token string">"创建成功！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 创建失败，返回500 Internal Server Error状态码  </span>
                <span class="token keyword">return</span> <span class="token function">InternalServerError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// PUT api/Test/5  </span>
        <span class="token punctuation">[</span>HttpPut<span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"PutUser"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IHttpActionResult</span> <span class="token function">PutUser</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span> <span class="token class-name">User</span> user<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 更新指定ID的用户的逻辑  </span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ModelState<span class="token punctuation">.</span>IsValid<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token function">BadRequest</span><span class="token punctuation">(</span>ModelState<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">!=</span> user<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token function">BadRequest</span><span class="token punctuation">(</span><span class="token string">"ID mismatch in the URL and the request body."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 假设的更新用户逻辑  </span>
            <span class="token class-name"><span class="token keyword">bool</span></span> success <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 更新成功，返回204 No Content状态码  </span>
                <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 更新失败，返回500 Internal Server Error状态码  </span>
                <span class="token keyword">return</span> <span class="token function">InternalServerError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// DELETE api/Test/5  </span>
        <span class="token punctuation">[</span>HttpDelete<span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"DeleteUser"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IHttpActionResult</span> <span class="token function">DeleteUser</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 删除指定ID的用户的逻辑  </span>
            <span class="token comment">// 假设的删除用户逻辑  </span>
            <span class="token class-name"><span class="token keyword">bool</span></span> success <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>success<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 删除成功，返回204 No Content状态码  </span>
                <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token string">"成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 如果未找到用户，返回404 Not Found状态码  </span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span> <span class="token function">NotFound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// 其他删除失败情况，返回500 Internal Server Error状态码  </span>
                <span class="token keyword">return</span> <span class="token function">InternalServerError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="14Routing_184"></a>1.4、配置路由（Routing）</h4> 
<p>在Web API项目中，你需要配置路由以将HTTP请求映射到控制器的方法。这通常在<code>WebApiConfig.cs</code>文件中完成，该文件位于<code>App_Start</code>文件夹下。</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WebApiConfig</span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token class-name">HttpConfiguration</span> config<span class="token punctuation">)</span>  
    <span class="token punctuation">{<!-- --></span>  
        <span class="token comment">// Web API 配置和服务  </span>
  
        <span class="token comment">// Web API 路由  </span>
        config<span class="token punctuation">.</span><span class="token function">MapHttpAttributeRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        config<span class="token punctuation">.</span>Routes<span class="token punctuation">.</span><span class="token function">MapHttpRoute</span><span class="token punctuation">(</span>  
            <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">"DefaultApi"</span><span class="token punctuation">,</span>  
            <span class="token named-parameter punctuation">routeTemplate</span><span class="token punctuation">:</span> <span class="token string">"api/{controller}/{id}"</span><span class="token punctuation">,</span>  
            <span class="token named-parameter punctuation">defaults</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token punctuation">{<!-- --></span> id <span class="token operator">=</span> RouteParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span>  
        <span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="15API_207"></a>1.5、运行和测试API</h4> 
<p>运行Web API项目，并使用工具如Postman或浏览器来测试你的API。你可以发送GET、POST、PUT和DELETE请求到相应的URL，并观察响应。</p> 
<p>例如，要获取所有用户，你可以发送一个GET请求到<code>http://localhost:&lt;port&gt;/api/Test/GetUser</code>。要创建一个新用户，你可以发送一个POST请求到<code>http://localhost:&lt;port&gt;/api/Test/PostUser</code>，并在请求体中包含用户数据。</p> 
<h4><a id="16_213"></a>1.6、异常处理和验证</h4> 
<p>使用ASP.NET Web API时，可以通过模型验证、异常过滤器以及其他机制来增强API的健壮性和安全性。</p> 
<h5><a id="161__217"></a>1.6.1 模型验证</h5> 
<p>对于<code>PostUser</code>和<code>PutUser</code>方法，可以使用数据注解（Data Annotations）来定义模型验证规则。例如：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserNew</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>  
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">DataType</span><span class="token attribute-arguments"><span class="token punctuation">(</span>DataType<span class="token punctuation">.</span>Password<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>  
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Password <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Email <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在API控制器中，可以检查模型状态（ModelState）是否有效：</p> 
<pre><code class="prism language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"PostUserNew"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IHttpActionResult</span> <span class="token function">PostUserNew</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span> <span class="token class-name">UserNew</span> user<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ModelState<span class="token punctuation">.</span>IsValid<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">BadRequest</span><span class="token punctuation">(</span>ModelState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 假设用户创建逻辑...  </span>
    <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token string">"用户创建成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPut</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"PutUserNew"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IHttpActionResult</span> <span class="token function">PutUserNew</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span> <span class="token class-name">UserNew</span> user<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ModelState<span class="token punctuation">.</span>IsValid<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">BadRequest</span><span class="token punctuation">(</span>ModelState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 假设用户更新逻辑...  </span>
    <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token string">"用户更新成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="162__266"></a>1.6.2 异常过滤器</h5> 
<p>创建自定义的异常过滤器来处理未捕获的异常，并返回适当的HTTP响应。例如：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HttpExceptionFilterAttribute</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ExceptionFilterAttribute</span></span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnException</span><span class="token punctuation">(</span><span class="token class-name">HttpActionExecutedContext</span> actionExecutedContext<span class="token punctuation">)</span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>actionExecutedContext<span class="token punctuation">.</span>Exception <span class="token keyword">is</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>  
    <span class="token punctuation">{<!-- --></span>  
        actionExecutedContext<span class="token punctuation">.</span>Response <span class="token operator">=</span> actionExecutedContext<span class="token punctuation">.</span>Request<span class="token punctuation">.</span><span class="token function">CreateErrorResponse</span><span class="token punctuation">(</span>  
            HttpStatusCode<span class="token punctuation">.</span>InternalServerError<span class="token punctuation">,</span> ex<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> 
<p>然后，我们可以在控制器或全局范围内应用这个过滤器：</p> 
<pre><code class="prism language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpExceptionFilter</span></span><span class="token punctuation">]</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ApiController</span></span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token comment">// ... 方法 ...  </span>
<span class="token punctuation">}</span>
</code></pre> 
<p>或者，在Web API配置中全局注册：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WebApiConfig</span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token class-name">HttpConfiguration</span> config<span class="token punctuation">)</span>  
    <span class="token punctuation">{<!-- --></span>  
        <span class="token comment">// ... 其他配置 ...  </span>
          
        config<span class="token punctuation">.</span>Filters<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpExceptionFilterAttribute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="163__308"></a>1.6.3 身份验证和授权</h5> 
<p>对于安全性，需要实施身份验证和授权机制。ASP.NET Web API支持多种身份验证方式，如OAuth 2.0、JWT等。可以使用内置的<code>[Authorize]</code>属性来要求用户授权才能访问某些API。</p> 
<h5><a id="164_CSRF_312"></a>1.6.4 跨站请求伪造（CSRF）防护</h5> 
<p>为了防止跨站请求伪造攻击，应该考虑在API中实施防护措施，比如检查请求的来源或使用验证令牌。</p> 
<h5><a id="165__316"></a>1.6.5 输入验证和清理</h5> 
<p>对于所有从客户端接收的输入，都应该进行验证和清理，以防止SQL注入、跨站脚本（XSS）等攻击。可以使用ASP.NET中的安全功能，比如编码助手类，来清理和编码输出。</p> 
<h5><a id="166__320"></a>1.6.6 响应格式化</h5> 
<p>返回具体的错误信息或详细的堆栈跟踪可能会泄露敏感信息。在生产环境中，应只返回一般性的错误消息，并避免暴露内部实现细节。</p> 
<h5><a id="167__324"></a>1.6.7 日志记录</h5> 
<p>实现良好的日志记录机制可以帮助你追踪问题、识别攻击和审计API的使用情况。可以使用ASP.NET的日志记录功能或第三方日志库。</p> 
<h4><a id="17API_328"></a>1.7、部署API</h4> 
<p>完成开发和测试后，需要将Web API项目部署到IIS服务器或其他托管环境中，以便其他客户端应用程序可以访问它。</p> 
<h3><a id="4HTTPWebAPI_332"></a>4、HTTP协议及其在WebAPI中的应用。</h3> 
<p>在前一篇中已经专门讲过HTTP协议，在此不多做赘述。</p> 
<p><a href="http://t.csdnimg.cn/wNWyr" rel="nofollow">接口开发笔记-HTTP协议</a></p> 
<h2><a id="_338"></a>二、项目创建与配置</h2> 
<h3><a id="1WebAPI_340"></a>1、创建WebAPI项目，包括项目的基本结构和文件组成。</h3> 
<p>创建项目前面已经说过了，现在主要记录项目的基本结构和文件组成</p> 
<h4><a id="11_344"></a>1.1、项目结构</h4> 
<ul><li><strong>项目根目录</strong>：包含项目的所有文件和文件夹。</li><li><strong>Controllers</strong>：存放Web API控制器的文件夹。控制器是处理HTTP请求的主要类。</li><li><strong>App_Start</strong>：包含Web API的配置文件，如<code>WebApiConfig.cs</code>。</li><li><strong>Models</strong>：存放数据模型的文件夹（可选）。</li><li><strong>Views</strong>：对于Web API项目，这个文件夹通常是空的，因为API不返回视图。</li><li><strong>Properties</strong>：包含项目属性的文件夹，如<code>AssemblyInfo.cs</code>和<code>launchSettings.json</code>（对于ASP.NET Core项目）。</li><li><strong>其他文件和文件夹</strong>：根据我们的项目设置和所选模板，可能还有其他文件和文件夹，如<code>wwwroot</code>（用于存放静态文件）或<code>Dependencies</code>（包含项目依赖项）。</li></ul> 
<h4><a id="12_354"></a>1.2、文件组成</h4> 
<ul><li><strong>Global.asax</strong> 或 <strong>Startup.cs</strong>：项目的入口点。对于ASP.NET，<code>Global.asax</code>包含应用程序的启动和关闭事件。对于ASP.NET Core，<code>Startup.cs</code>类中的<code>ConfigureServices</code>和<code>Configure</code>方法用于配置服务和请求处理管道。</li><li><strong>WebApiConfig.cs</strong>：Web API的配置文件，用于定义路由和其他设置。</li><li><strong>控制器文件</strong>（如<code>ValuesController.cs</code>）：控制器类，用于处理特定的HTTP请求。每个控制器通常对应一组相关的API端点。</li><li><strong>模型类文件</strong>（可选）：定义数据的模型或实体类。</li><li><strong>其他配置文件</strong>：如<code>appsettings.json</code>（用于存储应用程序设置）和<code>web.config</code>（用于IIS设置）。</li></ul> 
<h3><a id="2Globalasax_362"></a>2、Global.asax文件的配置及配置路由规则。</h3> 
<p><code>Global.asax</code> 文件是一个非常重要的文件，它用于处理应用程序级别的事件，如应用程序启动、关闭以及会话启动和关闭等。对于Web API项目，通常会在 <code>Global.asax</code> 文件中配置路由规则。</p> 
<p>下面是一个 <code>Global.asax</code> 文件的示例，演示了如何配置Web API的路由规则：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Http</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Mvc</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Optimization</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Routing</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">WebApplication1</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebApiApplication</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>HttpApplication</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">protected</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Application_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            AreaRegistration<span class="token punctuation">.</span><span class="token function">RegisterAllAreas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            GlobalConfiguration<span class="token punctuation">.</span><span class="token function">Configure</span><span class="token punctuation">(</span>WebApiConfig<span class="token punctuation">.</span>Register<span class="token punctuation">)</span><span class="token punctuation">;</span>
            FilterConfig<span class="token punctuation">.</span><span class="token function">RegisterGlobalFilters</span><span class="token punctuation">(</span>GlobalFilters<span class="token punctuation">.</span>Filters<span class="token punctuation">)</span><span class="token punctuation">;</span>
            RouteConfig<span class="token punctuation">.</span><span class="token function">RegisterRoutes</span><span class="token punctuation">(</span>RouteTable<span class="token punctuation">.</span>Routes<span class="token punctuation">)</span><span class="token punctuation">;</span>
            BundleConfig<span class="token punctuation">.</span><span class="token function">RegisterBundles</span><span class="token punctuation">(</span>BundleTable<span class="token punctuation">.</span>Bundles<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>在这个例子中，<code>Application_Start</code> 方法在应用程序启动时调用。<code>GlobalConfiguration.Configure(WebApiConfig.Register);</code> 这行代码是配置Web API路由的关键所在。它调用了 <code>WebApiConfig</code> 类中的 <code>Register</code> 方法来配置路由。</p> 
<p>需要创建一个名为 <code>WebApiConfig</code> 的类，并在其中定义路由配置。下面是一个 <code>WebApiConfig</code> 类的示例：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>  
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>  
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>  
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Http</span><span class="token punctuation">;</span>  
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Routing</span><span class="token punctuation">;</span>  
  
<span class="token keyword">namespace</span> <span class="token namespace">WebApplication1</span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WebApiConfig</span>  
    <span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token class-name">HttpConfiguration</span> config<span class="token punctuation">)</span>  
        <span class="token punctuation">{<!-- --></span>  
            <span class="token comment">// Web API 配置和服务  </span>
  
            <span class="token comment">// Web API 路由  </span>
            config<span class="token punctuation">.</span><span class="token function">MapHttpAttributeRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
            config<span class="token punctuation">.</span>Routes<span class="token punctuation">.</span><span class="token function">MapHttpRoute</span><span class="token punctuation">(</span>  
                <span class="token named-parameter punctuation">name</span><span class="token punctuation">:</span> <span class="token string">"DefaultApi"</span><span class="token punctuation">,</span>  
                <span class="token named-parameter punctuation">routeTemplate</span><span class="token punctuation">:</span> <span class="token string">"api/{controller}/{id}"</span><span class="token punctuation">,</span>  
                <span class="token named-parameter punctuation">defaults</span><span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token punctuation">{<!-- --></span> id <span class="token operator">=</span> RouteParameter<span class="token punctuation">.</span>Optional <span class="token punctuation">}</span>  
            <span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> 
<p>在这个 <code>WebApiConfig</code> 类中，<code>Register</code> 方法定义了Web API的路由规则。<code>config.MapHttpAttributeRoutes();</code> 这行代码允许我们使用特性路由，即在控制器或动作方法上使用 <code>[Route]</code> 特性来定义路由。</p> 
<p><code>config.Routes.MapHttpRoute</code> 方法定义了一个默认的路由规则。在这个例子中，路由模板是 <code>"api/{controller}/{id}"</code>，这意味着当我们访问像 api/Test 这样的URL时，它会映射到 TestController的默认动作方法（通常是 Get）。{id}是可选的，这意味着我们可以访问 <code>api/Test/1</code> 来获取特定ID的资源。</p> 
<p>一旦定义了这些路由规则，Web API控制器就可以根据这些规则来处理HTTP请求了。例如，如果有一个名为 <code>TestController</code> 的控制器，并且我们想要处理GET请求来获取一组值，你可以这样定义它：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>  
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>  
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Web<span class="token punctuation">.</span>Http</span><span class="token punctuation">;</span>  
  
<span class="token keyword">namespace</span> <span class="token namespace">WebApplication1<span class="token punctuation">.</span>Controllers</span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ApiController</span></span>  
    <span class="token punctuation">{<!-- --></span>  
        <span class="token comment">// GET api/Test  </span>
        <span class="token punctuation">[</span>HttpGet<span class="token punctuation">]</span>
        <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Get"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">IEnumerable<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{<!-- --></span> <span class="token string">"value1"</span><span class="token punctuation">,</span> <span class="token string">"value2"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> 
  
        <span class="token comment">// 其他动作方法...  </span>
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3CORS_455"></a>3、跨域配置、CORS（跨源资源共享）的原理及应用。</h3> 
<p>跨域资源共享（CORS，Cross-Origin Resource Sharing）是一个重要概念，它允许Web应用程序从不同的源（域、协议或端口）访问资源。默认情况下，出于安全考虑，浏览器会限制从一个源加载的文档或脚本与另一个源的资源进行交互。但是，通过CORS，服务器可以明确指定哪些外部源有权访问其资源。</p> 
<h4><a id="31CORS_459"></a>3.1、CORS的原理</h4> 
<p>CORS是一个W3C规范，它定义了一种浏览器和服务器交互的方式来确定是否允许跨源请求。这主要通过服务器返回的HTTP响应头来实现。当浏览器发送一个跨域请求时，它会在请求头中包含<code>Origin</code>字段，表示请求的源。服务器根据这个<code>Origin</code>字段以及其他的CORS相关头信息（如<code>Access-Control-Allow-Origin</code>），来决定是否允许这个请求。</p> 
<h4><a id="32C_WebAPI_NET_Framework_CORS_463"></a>3.2、在C# WebAPI (.NET Framework) 中应用CORS</h4> 
<p>在C# WebAPI (.NET Framework) 项目中，可以通过几种方式来启用和配置CORS：</p> 
<p><strong>3.2.1 使用Web.config文件</strong></p> 
<p>在<code>Web.config</code>文件的<code>&lt;system.webServer&gt;</code>部分，可以添加CORS相关的HTTP响应头。但是，这种方式不够灵活，且难以管理复杂的CORS策略。</p> 
<p><strong>3.2.2 使用全局CORS策略</strong></p> 
<p>在<code>WebApiConfig.Register</code>方法中，可以配置全局的CORS策略。这通常是通过调用<code>EnableCors</code>扩展方法来实现的。例如：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WebApiConfig</span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token class-name">HttpConfiguration</span> config<span class="token punctuation">)</span>  
    <span class="token punctuation">{<!-- --></span>  
        <span class="token comment">// ... 其他配置 ...  </span>
  
        <span class="token comment">// 启用CORS支持并设置全局策略  </span>
        <span class="token class-name"><span class="token keyword">var</span></span> cors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">EnableCorsAttribute</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 允许所有源、所有方法和所有头信息  </span>
        config<span class="token punctuation">.</span><span class="token function">EnableCors</span><span class="token punctuation">(</span>cors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 应用全局CORS策略  </span>
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> 
<p>请注意，使用<code>"*"</code>作为源、方法和头信息是一种非常宽松的策略，可能带来安全风险。在实际应用中，应该根据具体需求来限制这些值。</p> 
<p><strong>3.2.3 使用控制器或动作级别的CORS策略</strong></p> 
<p>除了全局策略外，还可以在控制器或动作级别上设置CORS策略。这可以通过在控制器或动作方法上使用<code>[EnableCors]</code>特性来实现。例如：</p> 
<pre><code class="prism language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EnableCors</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token named-parameter punctuation">origins</span><span class="token punctuation">:</span> <span class="token string">"http://example.com"</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">headers</span><span class="token punctuation">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">methods</span><span class="token punctuation">:</span> <span class="token string">"*"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyApiController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ApiController</span></span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token comment">// ... 控制器方法 ...  </span>
<span class="token punctuation">}</span>
</code></pre> 
<p>或者，只在特定的动作方法上应用CORS策略：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyApiController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ApiController</span></span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">EnableCors</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token named-parameter punctuation">origins</span><span class="token punctuation">:</span> <span class="token string">"http://example.com"</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">headers</span><span class="token punctuation">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token named-parameter punctuation">methods</span><span class="token punctuation">:</span> <span class="token string">"GET,POST"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>  
    <span class="token keyword">public</span> <span class="token return-type class-name">IHttpActionResult</span> <span class="token function">MyAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token punctuation">{<!-- --></span>  
        <span class="token comment">// ... 动作方法实现 ...  </span>
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_516"></a>安全注意事项</h4> 
<p>在配置CORS时，务必注意安全性。不要随意允许所有源、方法和头信息，因为这可能使你的API暴露给潜在的攻击者。应该根据API的实际需求和安全策略来仔细设置CORS策略。</p> 
<p>此外，即使启用了CORS，仍然需要确保API的其他安全措施（如身份验证、授权和输入验证）得到妥善实施，以防止未授权访问和数据泄露。</p> 
<h2><a id="_522"></a>三、控制器与路由</h2> 
<p>使用路由属性（如 <code>[Route]</code>、<code>[HttpGet]</code>、<code>[HttpPost]</code> 等）是定义和映射HTTP请求到特定控制器方法的一种非常方便的方式。这些特性允许你以声明式的方式指定如何路由到你的API方法，而不是依赖于全局路由配置。</p> 
<p>下面是如何在WebAPI中使用这些路由属性的示例：</p> 
<h3><a id="1_Route__528"></a>1、使用 [Route] 特性定义控制器的基础路由</h3> 
<p>在控制器类上使用 <code>[Route]</code> 特性，你可以定义一个基础路由前缀，该前缀将应用于控制器中的所有方法。</p> 
<pre><code class="prism language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RoutePrefix</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"api/Test"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ApiController</span></span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token comment">// 控制器方法将映射到以 "api/Test" 为前缀的路由  </span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2_Route__540"></a>2、使用 [Route] 特性定义方法级别的路由</h3> 
<p>在控制器的方法上使用 <code>[Route]</code> 特性，可以定义具体的方法路由。这可以与控制器的基础路由结合使用。</p> 
<pre><code class="prism language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">RoutePrefix</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"api/Test"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProductsController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ApiController</span></span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token comment">// GET api/Test  </span>
	<span class="token punctuation">[</span>HttpGet<span class="token punctuation">]</span>
	<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"GetProducts"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
	<span class="token keyword">public</span> <span class="token return-type class-name">IHttpActionResult</span> <span class="token function">GetProducts</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
    	<span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token string">"获取成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// GET api/Test/5  </span>
	<span class="token punctuation">[</span>HttpGet<span class="token punctuation">]</span>
	<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"GetProduct"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
	<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"{id:int}"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token comment">// 使用路由约束来确保id是整数  </span>
	<span class="token keyword">public</span> <span class="token return-type class-name">IHttpActionResult</span> <span class="token function">GetProduct</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
    	<span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">id</span><span class="token punctuation">}</span></span><span class="token string">获取成功"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// POST api/Test  </span>
	<span class="token punctuation">[</span>HttpPost<span class="token punctuation">]</span>
	<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"CreateProduct"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
	<span class="token keyword">public</span> <span class="token return-type class-name">IHttpActionResult</span> <span class="token function">CreateProduct</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span> <span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
    	<span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">id</span><span class="token punctuation">}</span></span><span class="token string">创建成功"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在上面的例子中，<code>GetProducts</code> 方法将响应 <code>GET api/products</code> 请求，<code>GetProduct</code> 方法将响应形如 <code>GET api/products/5</code> 的请求，而 <code>CreateProduct</code> 方法将响应 <code>POST api/products</code> 请求。</p> 
<h3><a id="3_HttpGetHttpPost_HTTP_577"></a>3、使用 [HttpGet]、[HttpPost] 等特性指定HTTP方法</h3> 
<p>这些特性用于指定控制器方法应该响应哪种HTTP方法。例如，<code>[HttpGet]</code> 表示该方法应该响应GET请求，而 <code>[HttpPost]</code> 表示应该响应POST请求。</p> 
<pre><code class="prism language-csharp"><span class="token comment">// 响应 GET 请求  </span>
<span class="token punctuation">[</span>HttpGet<span class="token punctuation">]</span>  
<span class="token keyword">public</span> <span class="token return-type class-name">IHttpActionResult</span> <span class="token function">GetSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token comment">// ...  </span>
<span class="token punctuation">}</span>  
  
<span class="token comment">// 响应 POST 请求  </span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>  
<span class="token keyword">public</span> <span class="token return-type class-name">IHttpActionResult</span> <span class="token function">PostSomething</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span><span class="token class-name"><span class="token keyword">object</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token comment">// ...  </span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4_597"></a>4、路由约束</h3> 
<p>在 <code>[Route]</code> 特性中，可以使用路由约束来限制路由参数的格式或类型。例如，<code>{id:int}</code> 约束确保 <code>id</code> 参数是一个整数。</p> 
<h3><a id="5_601"></a>5、全局配置与特性路由的结合</h3> 
<p>在 <code>WebApiConfig</code> 类的 <code>Register</code> 方法中，需要调用 <code>config.MapHttpAttributeRoutes();</code> 来启用特性路由。这样，Web API 框架就会查找并使用在控制器和方法上定义的路由特性。</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WebApiConfig</span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Register</span><span class="token punctuation">(</span><span class="token class-name">HttpConfiguration</span> config<span class="token punctuation">)</span>  
    <span class="token punctuation">{<!-- --></span>  
        <span class="token comment">// Web API 配置和服务  </span>
  
        <span class="token comment">// 启用特性路由  </span>
        config<span class="token punctuation">.</span><span class="token function">MapHttpAttributeRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
        <span class="token comment">// 其他路由配置...  </span>
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="6_620"></a>6、处理路由冲突</h3> 
<p>确保路由模板是唯一的，以避免路由冲突。如果两个不同的方法具有相同的路由模板和相同的HTTP方法，Web API 将无法确定哪个方法应该处理特定的请求，这会导致运行时错误。</p> 
<h2><a id="_624"></a>四、数据处理与响应</h2> 
<h3><a id="1_626"></a>1、如何从请求中获取数据</h3> 
<p>通过不同的方式从HTTP请求中获取数据，包括查询字符串、表单数据、JSON数据等。以下是如何处理这些不同数据类型的示例：</p> 
<h4><a id="11Query_String_630"></a>1.1、查询字符串（Query String）</h4> 
<p>查询字符串是附加在URL后面的键值对，通常以<code>?</code>开头，并通过<code>&amp;</code>分隔多个键值对。</p> 
<p>在Web API中，可以通过方法的参数来自动绑定查询字符串的值。ASP.NET Web API 支持简单的类型绑定，如<code>int</code>、<code>string</code>等，也支持复杂类型的绑定。</p> 
<pre><code class="prism language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"GetProduct"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"{id:int}"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span> <span class="token comment">// 使用路由约束来确保id是整数  </span>
<span class="token keyword">public</span> <span class="token return-type class-name">IHttpActionResult</span> <span class="token function">GetProduct</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> id<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// id 将从查询字符串中获取，例如：GET api/test/GetProduct?id=9905  </span>
    <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">id</span><span class="token punctuation">}</span></span><span class="token string">创建成功"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果需要获取多个查询字符串参数，可以简单地在方法签名中添加更多的参数。</p> 
<h4><a id="12Form_Data_649"></a>1.2、表单数据（Form Data）</h4> 
<p>对于POST请求中的表单数据，可以使用<code>[FromBody]</code>特性来从请求正文中获取数据。这通常用于<code>application/x-www-form-urlencoded</code>或<code>multipart/form-data</code>类型的请求。</p> 
<pre><code class="prism language-csharp"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"PostFormData"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name">IHttpActionResult</span> <span class="token function">PostFormData</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span> <span class="token class-name">FormDataCollection</span> formData<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// formData 将包含表单数据  </span>
    <span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span> <span class="token operator">=</span> formData<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">Ok</span><span class="token punctuation">(</span><span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre> 
<p>对于简单类型的表单数据，也可以直接将它们作为参数：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name">IHttpActionResult</span> <span class="token function">PostSimpleFormData</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span><span class="token class-name"><span class="token keyword">string</span></span> <span class="token keyword">value</span><span class="token punctuation">)</span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token comment">// value 将直接从表单数据中获取  </span>
    <span class="token comment">// ... 处理数据 ...  </span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="13JSON_674"></a>1.3、JSON数据</h4> 
<p>对于JSON数据，通常会创建一个与JSON结构相对应的C#类，并使用<code>[FromBody]</code>特性来绑定请求正文中的JSON到该类的实例。</p> 
<p>首先，定义一个与JSON数据匹配的C#类：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">decimal</span></span> Price <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> 
<p>然后，在API方法中，使用这个类作为参数类型，并使用<code>[FromBody]</code>特性：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name">IHttpActionResult</span> <span class="token function">PostProduct</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span><span class="token class-name">Product</span> product<span class="token punctuation">)</span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token comment">// product 对象将从请求正文的JSON中自动填充  </span>
    <span class="token comment">// ... 处理产品数据 ...  </span>
<span class="token punctuation">}</span>
</code></pre> 
<p>确保客户端发送的请求的<code>Content-Type</code>头设置为<code>application/json</code>，这样Web API才能正确解析JSON数据。</p> 
<h4><a id="14_701"></a>1.4、读取原始请求体</h4> 
<p>如果需要直接读取请求的原始内容，而不是将其绑定到某个对象，可以使用<code>HttpRequestMessage</code>的<code>Content</code>属性来读取流。</p> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>IHttpActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">ReadRawRequestBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
<span class="token punctuation">{<!-- --></span>  
    <span class="token class-name"><span class="token keyword">string</span></span> content <span class="token operator">=</span> <span class="token keyword">await</span> Request<span class="token punctuation">.</span>Content<span class="token punctuation">.</span><span class="token function">ReadAsStringAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    <span class="token comment">// content 现在包含请求的原始内容  </span>
    <span class="token comment">// ... 处理原始内容 ...  </span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在这个例子中，<code>ReadAsStringAsync</code>方法用于异步读取请求体的内容作为一个字符串。注意，这通常在不需要将请求体绑定到某个对象时使用，因为它不提供类型安全或验证。</p> 
<h4><a id="15_716"></a>1.5、注意事项</h4> 
<ul><li>确保客户端发送的请求的<code>Content-Type</code>头与期望相匹配（例如，对于JSON数据，它应该是<code>application/json</code>）。</li><li>当使用<code>[FromBody]</code>特性时，Web API将尝试从请求正文中读取数据。一个方法通常只能有一个参数使用<code>[FromBody]</code>，因为请求正文只能被读取一次。</li><li>对于复杂的请求类型（如自定义的媒体类型），可能需要编写自定义的模型绑定器或格式化程序来处理数据绑定。</li></ul> 
<h3><a id="2_722"></a>2、客户端如何请求接口获取数据</h3> 
<p>客户端可以通过使用HttpClient类请求接口获取响应数据，以下是一个典型示例：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Linq</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Text</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Http</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Newtonsoft<span class="token punctuation">.</span>Json</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">ConsoleApp1</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">HttpClient</span> httpClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HttpClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">var</span></span> getResponse <span class="token operator">=</span> <span class="token keyword">await</span> httpClient<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span><span class="token string">"https://localhost:44352/api/Test/GetUser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>getResponse<span class="token punctuation">.</span>IsSuccessStatusCode<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">var</span></span> content <span class="token operator">=</span> <span class="token keyword">await</span> getResponse<span class="token punctuation">.</span>Content<span class="token punctuation">.</span><span class="token function">ReadAsStringAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出响应内容，例如 ["value1","value2"]</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"Error: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">getResponse<span class="token punctuation">.</span>StatusCode</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//请求GetUser接口</span>
            <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                Id <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
                Name <span class="token operator">=</span> <span class="token string">"Charlie"</span><span class="token punctuation">,</span>
                Email <span class="token operator">=</span> <span class="token string">"charlie@example.com"</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> json<span class="token operator">=</span>JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">StringContent</span> content1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringContent</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">,</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> getResponse1<span class="token operator">=</span><span class="token keyword">await</span> httpClient<span class="token punctuation">.</span><span class="token function">PostAsync</span><span class="token punctuation">(</span><span class="token string">"https://localhost:44352/api/test/PostUser"</span><span class="token punctuation">,</span> content1 <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>getResponse1<span class="token punctuation">.</span>IsSuccessStatusCode<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">var</span></span> result<span class="token operator">=</span> <span class="token keyword">await</span> getResponse1<span class="token punctuation">.</span>Content<span class="token punctuation">.</span><span class="token function">ReadAsStringAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//请求PutUser接口</span>
            <span class="token class-name">User</span> user1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                Id <span class="token operator">=</span> <span class="token number">10086</span><span class="token punctuation">,</span>
                Name <span class="token operator">=</span> <span class="token string">"Charlie"</span><span class="token punctuation">,</span>
                Email <span class="token operator">=</span> <span class="token string">"charlie@example.com"</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">string</span></span> json1 <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span>user1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">StringContent</span> content2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StringContent</span><span class="token punctuation">(</span>json1<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>UTF8<span class="token punctuation">,</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> getResponse2 <span class="token operator">=</span> <span class="token keyword">await</span> httpClient<span class="token punctuation">.</span><span class="token function">PutAsync</span><span class="token punctuation">(</span><span class="token string">"https://localhost:44352/api/test/PutUser?id=10086"</span><span class="token punctuation">,</span> content2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>getResponse2<span class="token punctuation">.</span>IsSuccessStatusCode<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">var</span></span> result2 <span class="token operator">=</span> <span class="token keyword">await</span> getResponse2<span class="token punctuation">.</span>Content<span class="token punctuation">.</span><span class="token function">ReadAsStringAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Email <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h2><a id="_796"></a>五、身份验证和授权</h2> 
<h3><a id="1_798"></a>1、身份验证</h3> 
<p>身份验证是确认用户身份的过程。Web API 通常使用令牌（如 JWT 令牌）或基于 Cookie 的身份验证机制。</p> 
<h4><a id="11_JWTJSON_Web_Tokens_802"></a>1.1、 JWT（JSON Web Tokens）身份验证</h4> 
<p>JWT 是一种用于身份验证的开放标准（RFC 7519）。它定义了一种紧凑的、自包含的方式，用于作为JSON对象在各方之间安全地传输信息。这些信息可以被验证和信任，因为它们是数字签名的。</p> 
<ul><li>用户向认证服务器（如IdentityServer）发送凭据（用户名和密码）。</li><li>认证服务器验证凭据并返回一个JWT令牌。</li><li>客户端（如移动应用或Web前端）在后续的API请求中携带此令牌。</li><li>Web API 验证令牌的签名，并确认其有效性。</li></ul> 
<h4><a id="12_Cookie_811"></a>1.2、 基于Cookie的身份验证</h4> 
<p>对于基于浏览器的应用，Web API 可以使用Cookie进行身份验证。用户登录时，服务器在响应中设置一个包含会话信息的Cookie。后续的请求会携带这个Cookie，服务器根据Cookie识别用户身份。</p> 
<h3><a id="2_815"></a>2、授权</h3> 
<p>授权是确定用户是否有权访问特定资源的过程。这通常通过角色或声明来实现。</p> 
<h4><a id="21_819"></a>2.1、基于角色的授权</h4> 
<p>可以为用户分配角色（如“管理员”、“用户”等），并在Web API中定义哪些角色可以访问哪些资源。</p> 
<ul><li>使用<code>[Authorize(Roles = "Admin")]</code>属性在控制器或操作方法上指定允许的角色。</li><li>配置Web API以使用角色管理器来解析角色。</li></ul> 
<h4><a id="22_826"></a>2.2、基于声明的授权</h4> 
<p>声明是关于用户、设备或其他实体的信息。它们可以是任何类型的数据，如用户的电子邮件地址、姓名或自定义属性。</p> 
<ul><li>在用户登录时，将声明添加到身份验证令牌中。<br> get; set; }<br> }<br> }</li></ul> 
<pre><code>
# 五、身份验证和授权

## 1、身份验证

身份验证是确认用户身份的过程。Web API 通常使用令牌（如 JWT 令牌）或基于 Cookie 的身份验证机制。

### 1.1、 JWT（JSON Web Tokens）身份验证

JWT 是一种用于身份验证的开放标准（RFC 7519）。它定义了一种紧凑的、自包含的方式，用于作为JSON对象在各方之间安全地传输信息。这些信息可以被验证和信任，因为它们是数字签名的。

- 用户向认证服务器（如IdentityServer）发送凭据（用户名和密码）。
- 认证服务器验证凭据并返回一个JWT令牌。
- 客户端（如移动应用或Web前端）在后续的API请求中携带此令牌。
- Web API 验证令牌的签名，并确认其有效性。

### 1.2、 基于Cookie的身份验证

对于基于浏览器的应用，Web API 可以使用Cookie进行身份验证。用户登录时，服务器在响应中设置一个包含会话信息的Cookie。后续的请求会携带这个Cookie，服务器根据Cookie识别用户身份。

## 2、授权

授权是确定用户是否有权访问特定资源的过程。这通常通过角色或声明来实现。

### 2.1、基于角色的授权

可以为用户分配角色（如“管理员”、“用户”等），并在Web API中定义哪些角色可以访问哪些资源。

- 使用`[Authorize(Roles = "Admin")]`属性在控制器或操作方法上指定允许的角色。
- 配置Web API以使用角色管理器来解析角色。

### 2.2、基于声明的授权

声明是关于用户、设备或其他实体的信息。它们可以是任何类型的数据，如用户的电子邮件地址、姓名或自定义属性。

- 在用户登录时，将声明添加到身份验证令牌中。
- 在Web API中，使用`[Authorize(ClaimType = "email", ClaimValue = "user@example.com")]`来指定允许的声明。
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/be47adf2cdbc5e7fb00c87512bbf65b3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于Java的图书管理系统论文</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3696776a084318db061514644781dedb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vue-WebTopo-SVGEditor：下一代SVG图形编辑器的创新实践</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>