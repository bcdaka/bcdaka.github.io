<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Vagrant配合VirtualBox搭建虚拟机 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/b85bc3b9c5b0ae7bd9be2a84699b9212/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Vagrant配合VirtualBox搭建虚拟机">
  <meta property="og:description" content="目录 前言一、软件下载及安装1.下载2.安装扩展： 二、创建一个虚拟机1.Vagrant官方镜像仓库 三、使用远程工具连接虚拟机1.修改相关配置文件 四、虚拟机克隆及使用1.通用配置2.简单搭建一个java环境3.克隆虚拟机1.重命名虚拟机（可选）2.打包指定名称的虚拟机 五、异常情况处理1.up启动报错2.身份验证失败 前言 目前我用虚拟机主要作用是模拟linux系统下当服务器使用，直接用vmware虚拟机或者VirtualBox虚拟机进行搭建相关开发环境耗时，并且很多步骤冗余，至此想要探寻简化配置步骤，并且可以一次搭建多次复用的方式，我们从使用Vagrant开始，然后我们还有去探索克隆虚拟机，搭建完基础环境之后移植到其他机器也能快速使用的方法。
一、软件下载及安装 我这里是win环境下安装相关软件。博客那没多，要搞就搞点不一样的，都安装最新版本。
1.下载 Vagrant下载
截止2024/7/8最新版本为2.4.1版本，我是win64位系统，选择amd64，如果你的电脑是非常旧的版本或32位选择I686
VirtualBox下载
我就想要下载旧一些的版本，他可能稳定或者相关资料更多一些，这里也提供旧版本下载提示。
直达链接
2.安装 ①安装VirtualBox
在选择安装位置时，你是否也把目录切换到了其他磁盘而不是默认的系统盘
解决方式有两种
第一种：不喜欢折腾的同学，直接换回系统盘安装。
第二种：分两种情况
第一种情况：选择其他盘后，建一个根目录，把它安装到该目录下。需要做一些准备。
例如我把它安装到了某个目录下：
需要创建完该文件夹后执行如下命令，以管理员身份运行cmd程序，执行如下几行代码。
icacls A:\VirtualBox /reset /t /c icacls A:\VirtualBox /inheritance:d /t /c icacls A:\VirtualBox /grant *S-1-5-32-545:(OI)(CI)(RX) icacls A:\VirtualBox /deny *S-1-5-32-545:(DE,WD,AD,WEA,WA) icacls A:\VirtualBox /grant *S-1-5-11:(OI)(CI)(RX) icacls A:\VirtualBox /deny *S-1-5-11:(DE,WD,AD,WEA,WA) 执行完毕，重新安装并且选择你执行过的目录即可安装。
情况2：更换其他磁盘，并且不是放在更目录，此时你需要把指定目录和对应的根目录都执行一次，我嫌麻烦就没这么搞了。
②安装Vagrant
这个就没啥好选的了，最新版没找到选择安装目录的位置。在最后一步时，你选择了yes会立刻重启你的电脑。其他情况暂时未遇到问题。
扩展： ①
icacls工具:管理文件和目录的访问控制列表，这些操作类似于linux对目录用户组进行权限分配和设置。资料来源网络，如果错误还请指正。
1- icacls A:\VirtualBox /reset /t /c 这个命令将重置A:\VirtualBox目录及其所有子目录和文件的权限为默认设置。/t参数表示操作递归应用于所有子目录和文件，/c参数则表示如果遇到错误，命令会继续处理其他项。
2- icacls A:\VirtualBox /inheritance:d /t /c 此命令禁用了A:\VirtualBox目录及其子目录的继承权限。inheritance:d表示删除现有的继承权限条目，/t和/c与上一个命令相同">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-09T16:33:42+08:00">
    <meta property="article:modified_time" content="2024-07-09T16:33:42+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Vagrant配合VirtualBox搭建虚拟机</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">前言</a></li><li><a href="#_3" rel="nofollow">一、软件下载及安装</a></li><li><ul><li><a href="#1_5" rel="nofollow">1.下载</a></li><li><a href="#2_20" rel="nofollow">2.安装</a></li><li><a href="#_47" rel="nofollow">扩展：</a></li></ul> 
  </li><li><a href="#_90" rel="nofollow">二、创建一个虚拟机</a></li><li><ul><li><a href="#1Vagrant_91" rel="nofollow">1.Vagrant官方镜像仓库</a></li></ul> 
  </li><li><a href="#_113" rel="nofollow">三、使用远程工具连接虚拟机</a></li><li><ul><li><a href="#1_115" rel="nofollow">1.修改相关配置文件</a></li></ul> 
  </li><li><a href="#_163" rel="nofollow">四、虚拟机克隆及使用</a></li><li><ul><li><a href="#1_165" rel="nofollow">1.通用配置</a></li><li><a href="#2java_202" rel="nofollow">2.简单搭建一个java环境</a></li><li><a href="#3_206" rel="nofollow">3.克隆虚拟机</a></li><li><a href="#1_209" rel="nofollow">1.重命名虚拟机（可选）</a></li><li><a href="#2_273" rel="nofollow">2.打包指定名称的虚拟机</a></li></ul> 
  </li><li><a href="#_407" rel="nofollow">五、异常情况处理</a></li><li><ul><li><a href="#1up_410" rel="nofollow">1.up启动报错</a></li><li><a href="#2_420" rel="nofollow">2.身份验证失败</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>前言</h2> 
<p>    目前我用虚拟机主要作用是模拟linux系统下当服务器使用，直接用vmware虚拟机或者VirtualBox虚拟机进行搭建相关开发环境耗时，并且很多步骤冗余，至此想要探寻简化配置步骤，并且可以一次搭建多次复用的方式，我们从使用Vagrant开始，然后我们还有去探索克隆虚拟机，搭建完基础环境之后移植到其他机器也能快速使用的方法。</p> 
<h2><a id="_3"></a>一、软件下载及安装</h2> 
<p>我这里是win环境下安装相关软件。博客那没多，要搞就搞点不一样的，都安装最新版本。</p> 
<h3><a id="1_5"></a>1.下载</h3> 
<p><a href="https://developer.hashicorp.com/vagrant/install#windows" rel="nofollow">Vagrant下载</a><br> 截止2024/7/8最新版本为2.4.1版本，我是win64位系统，选择amd64，如果你的电脑是非常旧的版本或32位选择I686</p> 
<p><img src="https://images2.imgbox.com/48/84/KWDIEC3y_o.png" alt="在这里插入图片描述"></p> 
<p><a href="https://www.virtualbox.org/wiki/Downloads" rel="nofollow">VirtualBox下载</a><br> <img src="https://images2.imgbox.com/c3/05/ytuSV9cU_o.png" alt="在这里插入图片描述"><br> <code>我就想要下载旧一些的版本，他可能稳定或者相关资料更多一些，这里也提供旧版本下载提示。</code><br> <img src="https://images2.imgbox.com/5e/e7/PL8gWxD7_o.png" alt="在这里插入图片描述"><br> <a href="https://www.virtualbox.org/wiki/Download_Old_Builds" rel="nofollow">直达链接</a></p> 
<h3><a id="2_20"></a>2.安装</h3> 
<p>①安装VirtualBox<br> 在选择安装位置时，你是否也把目录切换到了其他磁盘而不是默认的系统盘<br> <img src="https://images2.imgbox.com/5c/3c/TKZumj2W_o.png" alt="在这里插入图片描述"><br> 解决方式有两种<br> 第一种：不喜欢折腾的同学，直接换回系统盘安装。<br> 第二种：分两种情况<br> 第一种情况：选择其他盘后，建一个根目录，把它安装到该目录下。需要做一些准备。<br> 例如我把它安装到了某个目录下：<br> <img src="https://images2.imgbox.com/05/8a/PqMenUwx_o.png" alt="在这里插入图片描述"><br> 需要创建完该文件夹后执行如下命令，以管理员身份运行cmd程序，执行如下几行代码。</p> 
<pre><code class="prism language-bash">icacls A:<span class="token punctuation">\</span>VirtualBox /reset /t /c
icacls A:<span class="token punctuation">\</span>VirtualBox /inheritance:d /t /c 
icacls A:<span class="token punctuation">\</span>VirtualBox /grant *S-1-5-32-545:<span class="token punctuation">(</span>OI<span class="token punctuation">)</span><span class="token punctuation">(</span>CI<span class="token punctuation">)</span><span class="token punctuation">(</span>RX<span class="token punctuation">)</span> 
icacls A:<span class="token punctuation">\</span>VirtualBox /deny *S-1-5-32-545:<span class="token punctuation">(</span>DE,WD,AD,WEA,WA<span class="token punctuation">)</span>
icacls A:<span class="token punctuation">\</span>VirtualBox /grant *S-1-5-11:<span class="token punctuation">(</span>OI<span class="token punctuation">)</span><span class="token punctuation">(</span>CI<span class="token punctuation">)</span><span class="token punctuation">(</span>RX<span class="token punctuation">)</span>
icacls A:<span class="token punctuation">\</span>VirtualBox /deny *S-1-5-11:<span class="token punctuation">(</span>DE,WD,AD,WEA,WA<span class="token punctuation">)</span>
</code></pre> 
<p>执行完毕，重新安装并且选择你执行过的目录即可安装。<br> 情况2：更换其他磁盘，并且不是放在更目录，此时你需要把指定目录和对应的根目录都执行一次，我嫌麻烦就没这么搞了。</p> 
<p>②安装Vagrant<br> 这个就没啥好选的了，最新版没找到选择安装目录的位置。<code>在最后一步时，你选择了yes会立刻重启你的电脑。</code>其他情况暂时未遇到问题。<br> <img src="https://images2.imgbox.com/66/22/2wFbPx43_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_47"></a>扩展：</h3> 
<p><font color="blue">①</font><br> icacls工具:管理文件和目录的访问控制列表，这些操作类似于linux对目录用户组进行权限分配和设置。资料来源网络，如果错误还请指正。</p> 
<pre><code class="prism language-bash"><span class="token number">1</span>- icacls A:<span class="token punctuation">\</span>VirtualBox /reset /t /c
</code></pre> 
<p>这个命令将重置<code>A:\VirtualBox</code>目录及其所有子目录和文件的权限为默认设置。<code>/t</code>参数表示操作递归应用于所有子目录和文件，<code>/c</code>参数则表示如果遇到错误，命令会继续处理其他项。</p> 
<pre><code class="prism language-bash"><span class="token number">2</span>- icacls A:<span class="token punctuation">\</span>VirtualBox /inheritance:d /t /c
</code></pre> 
<p>此命令禁用了<code>A:\VirtualBox</code>目录及其子目录的继承权限。inheritance:d表示删除现有的继承权限条目，<code>/t</code>和<code>/c</code>与上一个命令相同</p> 
<pre><code class="prism language-bash"><span class="token number">3</span>- icacls A:<span class="token punctuation">\</span>VirtualBox /grant *S-1-5-32-545:<span class="token punctuation">(</span>OI<span class="token punctuation">)</span><span class="token punctuation">(</span>CI<span class="token punctuation">)</span><span class="token punctuation">(</span>RX<span class="token punctuation">)</span>
</code></pre> 
<p>这个命令向<code>A:\VirtualBox</code>目录及其子目录授予对用户组<code>*S-1-5-32-545</code>（通常是本地用户组）的读取权限。(<code>OI</code>)表示对象继承，(<code>CI</code>)表示容器继承，(<code>RX</code>)是读取权限的缩写。</p> 
<pre><code class="prism language-bash"><span class="token number">4</span>- icacls A:<span class="token punctuation">\</span>VirtualBox /deny *S-1-5-32-545:<span class="token punctuation">(</span>DE,WD,AD,WEA,WA<span class="token punctuation">)</span>
</code></pre> 
<p>此命令拒绝<code>A:\VirtualBox</code>目录及其子目录中<code>*S-1-5-32-545</code>用户组的多种权限：删除、写入数据、添加子目录、写入扩展属性、写入属性等。</p> 
<pre><code class="prism language-bash"><span class="token number">5</span>- icacls A:<span class="token punctuation">\</span>VirtualBox /grant *S-1-5-11:<span class="token punctuation">(</span>OI<span class="token punctuation">)</span><span class="token punctuation">(</span>CI<span class="token punctuation">)</span><span class="token punctuation">(</span>RX<span class="token punctuation">)</span>
</code></pre> 
<p>类似于第三个命令，但这次是向<code>*S-1-5-11</code>（通常是管理员组）授予读取权限。</p> 
<pre><code class="prism language-bash"><span class="token number">6</span>- icacls A:<span class="token punctuation">\</span>VirtualBox /deny *S-1-5-11:<span class="token punctuation">(</span>DE,WD,AD,WEA,WA<span class="token punctuation">)</span>
</code></pre> 
<p>同第四个命令，但这次是对<code>*S-1-5-11</code>用户组拒绝多种权限。</p> 
<p><font color="blue">②</font><br> <font color="red">如果你的电脑没有开启虚拟化，需要进入bois进行开始虚拟化设置!!!每个人电脑多少有一些差异，如果没有找到请按照自己电脑型号去网上查一下在哪块开启</font></p> 
<p><img src="https://images2.imgbox.com/65/d9/C5CvK0ao_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d9/f7/tusNInmp_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="_90"></a>二、创建一个虚拟机</h2> 
<h3><a id="1Vagrant_91"></a>1.Vagrant官方镜像仓库</h3> 
<p><a href="https://app.vagrantup.com/boxes/search" rel="nofollow">仓库地址</a><br> 我们使用vagrant 进行虚拟机的创建，使用他对应的官方镜像进行linux系统的创建。<br> 相关命令在他的文档中有体现<br> <img src="https://images2.imgbox.com/4a/ac/pLL4tIFq_o.png" alt="在这里插入图片描述"><br> 初始化一个centos7虚拟机，启动虚拟机。<br> cmd执行如下命令</p> 
<pre><code class="prism language-bash">vagrant init centos/7
vagrant up
</code></pre> 
<p><img src="https://images2.imgbox.com/44/72/aqeu8TAc_o.png" alt="在这里插入图片描述"><br> 启动虚拟机</p> 
<pre><code class="prism language-bash">vagrant up
</code></pre> 
<p><img src="https://images2.imgbox.com/b7/bb/ITsPUsGo_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/74/53/21VlkRXH_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="_113"></a>三、使用远程工具连接虚拟机</h2> 
<h3><a id="1_115"></a>1.修改相关配置文件</h3> 
<p>使用远程工具连接虚拟机。</p> 
<p>这里的网络和之前博客不太一样，注意甄别。找到对应的虚拟机网卡信息</p> 
<pre><code class="prism language-bash">ipconfig
</code></pre> 
<p><img src="https://images2.imgbox.com/c1/a6/u1WbURaT_o.png" alt="从这里开始看就行"><br> 修改vagrant配置文件，把对应的ip设置为静态ip，在192.168.56.xx网段下即可<br> <img src="https://images2.imgbox.com/dc/94/2kbf32pI_o.png" alt="在这里插入图片描述"><br> <code>我的在第35行</code><br> <img src="https://images2.imgbox.com/da/df/NlQZ0fJ6_o.png" alt="在这里插入图片描述"><br> 首先，使用win的cmd进行远程ssh连接，修改一下linux中的一些ssh连接设置。</p> 
<pre><code class="prism language-bash">vagrant <span class="token function">ssh</span>
</code></pre> 
<p>切换root用户，密码为：<code>vagrant</code><br> <img src="https://images2.imgbox.com/96/9a/CmI4sBsa_o.png" alt="在这里插入图片描述"><br> ·<code>改参数值，找到 PasswordAuthentication 改为yes</code></p> 
<pre><code class="prism language-bash"><span class="token function">vi</span> /etc/ssh/sshd_config
</code></pre> 
<p>刚进入文件时，使用vi的搜索功能。</p> 
<pre><code class="prism language-bash">/Passw
</code></pre> 
<p>此时定位到对应的内容后，按<code>i</code>键进行编辑。<br> <img src="https://images2.imgbox.com/36/1b/bhgYvDFs_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">:wq
</code></pre> 
<p>重启ssh服务</p> 
<pre><code class="prism language-bash">systemctl restart sshd
</code></pre> 
<p>此时使用你自己的ssh工具即可进行访问<br> ip：192.168.56.10<br> username：root<br> password：vagrant</p> 
<h2><a id="_163"></a>四、虚拟机克隆及使用</h2> 
<h3><a id="1_165"></a>1.通用配置</h3> 
<p>更换一下国内yum源<br> 先备份原有配置</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">cp</span> /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup
</code></pre> 
<p>创建一个新的repo文件</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">vi</span> /etc/yum.repos.d/alimirror.repo
</code></pre> 
<p>编辑新的源</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>alimirror<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>alimirror
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://mirrors.aliyun.com/centos/<span class="token variable">$releasever</span>/os/<span class="token variable">$basearch</span>/
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre> 
<p>清理缓存并更新元数据</p> 
<pre><code class="prism language-bash">yum clean all
yum makecache fast
</code></pre> 
<p>更新yum</p> 
<pre><code class="prism language-bash">yum update
</code></pre> 
<p>安装vim</p> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> vim-enhanced
</code></pre> 
<h3><a id="2java_202"></a>2.简单搭建一个java环境</h3> 
<p><a href="https://www.oracle.com/java/technologies/downloads/#java8" rel="nofollow">下载一个jdk包</a><br> 此处省略相关配置环境变量等，主要为了验证克隆之后是否能生效和使用。<br> <img src="https://images2.imgbox.com/79/06/2HVRtT9o_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_206"></a>3.克隆虚拟机</h3> 
<p>为虚拟机配置环境变量，这块不需要非得抄我的知道怎么配环境变量的同学自行配置即可<br> 1.<img src="https://images2.imgbox.com/ec/11/o0XTxG4U_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="1_209"></a>1.重命名虚拟机（可选）</h3> 
<p><font color="red">为什么要对虚拟机重命名？</font><br> <font color="blue">因为这样克隆虚拟机时，可以指定克隆那个虚拟机，当然你如果不想进行重命名，也有支持打包当前运行中的虚拟机方式。但是如果你同时需要启动多个虚拟机时，这块随意，不影响功能使用，这块也稍微麻烦一些，不想麻烦的可以跳过，个人感觉用处不大。</font></p> 
<p>查询当前虚拟机名称</p> 
<pre><code class="prism language-bash">vagrant status
</code></pre> 
<p><img src="https://images2.imgbox.com/e9/7c/Ppf35yf2_o.png" alt="在这里插入图片描述"><br> 就叫<code>default</code></p> 
<p>重命名虚拟机名称，为第一步使用vagrant 打包做准备。<br> <font color="red">先关闭当前虚拟机。</font></p> 
<p><font color="red">1.修改Vagrantfile配置文件,增加虚拟机名称配置，就挨着config.vm.box配置再上放增加一行即可，结束时需要增加end。</font></p> 
<pre><code class="prism language-bash">  config.vm.define <span class="token string">"vm1"</span> <span class="token keyword">do</span> <span class="token operator">|</span><span class="token function">node</span><span class="token operator">|</span>
    xxxx
	config.vm.box <span class="token operator">=</span> <span class="token string">"centos/7"</span>
  end
</code></pre> 
<p>示例：</p> 
<pre><code class="prism language-bash">Vagrant.configure<span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config.vm.define <span class="token string">"vm1"</span> <span class="token keyword">do</span> <span class="token operator">|</span><span class="token function">node</span><span class="token operator">|</span>
    node.vm.box <span class="token operator">=</span> <span class="token string">"ubuntu/focal64"</span>
    <span class="token comment"># ... 其他配置 ...</span>
  end
end
</code></pre> 
<p>我命名为vm1</p> 
<pre><code class="prism language-bash">config.vm.define <span class="token string">"vm1"</span> <span class="token keyword">do</span> <span class="token operator">|</span><span class="token function">node</span><span class="token operator">|</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/92/71/KFhqfxJI_o.png" alt="在这里插入图片描述"><br> <font color="red">2.重命名还未结束，还需要根据uuid更新底层逻辑</font></p> 
<pre><code class="prism language-bash">vboxmanage list vms
</code></pre> 
<p><code>这个命令如果提示不是内外部命令，那就是你没有成功配置box的环境变量。</code><br> <img src="https://images2.imgbox.com/e0/11/5jsQKQuy_o.png" alt="在这里插入图片描述"><br> <font color="red">3.更新虚拟机名称</font></p> 
<pre><code class="prism language-bash">vboxmanage modifyvm <span class="token punctuation">{<!-- --></span>UUID<span class="token punctuation">}</span> <span class="token parameter variable">--name</span> <span class="token string">"虚拟机名称"</span>
</code></pre> 
<p>我的命令</p> 
<pre><code class="prism language-bash">vboxmanage modifyvm <span class="token punctuation">{<!-- --></span>604009aa-cd0c-40a6-978a-380b23c8b873<span class="token punctuation">}</span> <span class="token parameter variable">--name</span> <span class="token string">"vm1"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d8/5a/RScjwUkz_o.png" alt="在这里插入图片描述"><br> 再次查询当前虚拟机名称</p> 
<pre><code class="prism language-bash">vagrant status
</code></pre> 
<p><img src="https://images2.imgbox.com/bc/16/kXYZW9IK_o.png" alt="在这里插入图片描述"><br> 至此重命名完成。</p> 
<h3><a id="2_273"></a>2.打包指定名称的虚拟机</h3> 
<p><font color="red" size="5">方式1：cmd命令方式（已经验证成功，可以正常使用）</font><br> 使用vagrant命令打包当前的虚拟机<br> ①查询所有虚拟机列表</p> 
<pre><code class="prism language-bash">vboxmanage list vms
</code></pre> 
<p><img src="https://images2.imgbox.com/14/08/KDlHMEiv_o.png" alt="在这里插入图片描述"><br> 打包指定名称的虚拟机<br> ②<code>你想把打包的文件放到哪里，此时你就使用cmd进行切换目录</code><br> 示例</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> A:<span class="token punctuation">\</span>DATA<span class="token punctuation">\</span>copy
</code></pre> 
<p>此时执行打包命令后会把打包的文件放在该目录下<br> ③进行打包<br> 示例打包名为vm1虚拟机，输出文件为vagrant01.box</p> 
<pre><code class="prism language-bash">vagrant package <span class="token parameter variable">--base</span> vm1 <span class="token parameter variable">--output</span> copy.box 
</code></pre> 
<p><font color="red">这一步非常的耗时!!!，并且控制台无进度条</font>，此时需要耐心等待。我的文件8个多G，从任务管理器能看出磁盘io每秒达到50mb左右的速度，也可能我电脑拉胯些比较慢。<br> 两种方式判断是否完成<br> 第一种：控制台出现不在阻塞之后Compressing即可<br> <img src="https://images2.imgbox.com/d3/f6/iZ9JVj1s_o.png" alt="在这里插入图片描述"></p> 
<p>第二种：保存目录的文件不再是0kb大小<br> <img src="https://images2.imgbox.com/4b/ef/IsNdS1Yc_o.png" alt="在这里插入图片描述"><br> ④将打包好的box文件add到vagrant<br> copy 可以理解为虚拟机的名字copy ，copy .box是我们打包的文件名称。<br> <code>注意：需要切换到copy.box目录再执行下方命令</code></p> 
<pre><code class="prism language-bash">vagrant box <span class="token function">add</span> copy copy.box
</code></pre> 
<p>⑤初始化一个新的vagrant环境</p> 
<pre><code class="prism language-bash">vagrant init copy 
</code></pre> 
<p>执行完成后只有一个Vagrantfile文件<br> ⑥编辑这个新的Vagrantfile文件</p> 
<pre><code class="prism language-bash">Vagrant.configure<span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config.vm.define <span class="token string">"copy"</span>
  config.vm.box <span class="token operator">=</span> <span class="token string">"copy"</span>
  config.vm.network <span class="token string">"private_network"</span>, ip: <span class="token string">"192.168.56.20"</span>
  config.ssh.username <span class="token operator">=</span> <span class="token string">"vagrant"</span>
  config.ssh.password <span class="token operator">=</span> <span class="token string">"vagrant"</span>
end
</code></pre> 
<p>全量替换成我的，如果你不是交copy则替换你对应的虚拟机名称，ssh这块是因为解决某个异常添加的，具体异常请在下方查阅。<br> ⑦更改默认的虚拟机位置<br> <img src="https://images2.imgbox.com/1e/fe/V5TSjIb2_o.png" alt="在这里插入图片描述"><br> 选择其他，找到你init的目录即可<br> <img src="https://images2.imgbox.com/ce/0d/dcNXQgK7_o.png" alt="在这里插入图片描述"><br> 启动这个虚拟机</p> 
<pre><code class="prism language-bash">vagrant up copy
</code></pre> 
<p><code>此时启动后virtual box页面会有一个虚拟机，但是名称不是我们起的copy，而是一个很长一串的名称，加上copy内容，这块还在研究，不影响使用。</code></p> 
<p>⑧再次修改ip地址<br> 进入控制台，使用默认的username和password进行登录，在切换到root用户</p> 
<pre><code class="prism language-bash">vagrant <span class="token function">ssh</span>
</code></pre> 
<p>username和password都为</p> 
<pre><code class="prism language-bash">vagrant
</code></pre> 
<pre><code class="prism language-bash"><span class="token function">su</span> root
</code></pre> 
<pre><code class="prism language-bash">vagrant
</code></pre> 
<p>先查询一下ip地址是否还是之前打包的ip地址</p> 
<pre><code class="prism language-bash"><span class="token function">ip</span> addr show
</code></pre> 
<p>我这块已经手动改过了，你的话应该还是192.168.56.10，此时需要在服务器端更改一下。<br> <img src="https://images2.imgbox.com/66/25/p5Ha9Z5v_o.png" alt="在这里插入图片描述"><br> 更改ip地址<br> 切换到该目录下，查询自己需要更改的文件，我的文件是eth1文件，你的可能不是</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /etc/sysconfig/network-scripts/
</code></pre> 
<p><img src="https://images2.imgbox.com/4f/bb/juTEjRsj_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token function">vi</span> ifcfg-eth1
</code></pre> 
<p><img src="https://images2.imgbox.com/53/a0/vYp0D7ik_o.png" alt="在这里插入图片描述"><br> 修改完保存重启网路服务一下</p> 
<pre><code class="prism language-bash">systemctl restart network
</code></pre> 
<p>验证一下是否生效</p> 
<pre><code class="prism language-bash"><span class="token function">ip</span> addr show eth1
</code></pre> 
<p>至此以命令方式的克隆虚拟机完成，之前搭建的java环境也正常使用。</p> 
<p><font color="red" size="5">方式2：virtual box方式打包（未验证成功，正在解决问题）</font></p> 
<p><img src="https://images2.imgbox.com/ea/14/23DdFF9k_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ab/e8/l4EBGki3_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ec/6f/gUVHFgnY_o.png" alt="在这里插入图片描述"><br> 复制成功之后，还是需要把对应的文件夹放到系统盘的默认路径下，否则检测不到（这块需要再研究一下，目前只能是放在原来虚拟机的文件夹下）</p> 
<p><img src="https://images2.imgbox.com/f4/c8/5Bpvrmb9_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ef/86/JCPrZSQO_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/37/db/JtRpPbPb_o.png" alt="在这里插入图片描述"><br> 打开我们复制的这个虚拟机文件<br> <img src="https://images2.imgbox.com/d7/20/Pvb414fA_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/df/2a/RmyyoPVN_o.png" alt="在这里插入图片描述"><br> 正在解决ing</p> 
<h2><a id="_407"></a>五、异常情况处理</h2> 
<p><a href="https://www.vagrantup.com/" rel="nofollow">vagrant官方网站</a><br> 有问题实在解决不了，那就只能肝官网文档了。</p> 
<h3><a id="1up_410"></a>1.up启动报错</h3> 
<blockquote> 
 <p>The machine with the name ‘copy’ was not found configured for this Vagrant environment.</p> 
</blockquote> 
<p>解决方式<br> Vagrantfile文件增加配置内容</p> 
<pre><code class="prism language-bash">config.vm.define <span class="token string">"copy"</span>
</code></pre> 
<h3><a id="2_420"></a>2.身份验证失败</h3> 
<blockquote> 
 <p>copy:Warning: Authentication failure. Retrying…</p> 
</blockquote> 
<p>直接使用明文username和password，目前还没有进行更加深入的研究，只用这个方式先解决，如果大家有其他优雅的方式欢迎一起交流讨论。</p> 
<pre><code class="prism language-bash">config.ssh.username <span class="token operator">=</span> <span class="token string">"vagrant"</span>
config.ssh.password <span class="token operator">=</span> <span class="token string">"vagrant"</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3e46a5c65cc1ea2a170a5ba578c5906f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">“爆炸性更新！JDK 17携全新语法特性强势来袭，开发者必看的升级亮点“（1）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6860075ad9ca5d31c6f21e9aa90d15f8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何判断服务器是否被攻击</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>