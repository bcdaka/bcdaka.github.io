<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>问题“Web应用程序[ROOT]似乎启动了一个名为[mysql-cj-abandoned-connection-cleanup]的线程，但未能停止它。这很可能会造成内存泄漏”的解决 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/2e95c483393b1f4bc611dfd750ee2685/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="问题“Web应用程序[ROOT]似乎启动了一个名为[mysql-cj-abandoned-connection-cleanup]的线程，但未能停止它。这很可能会造成内存泄漏”的解决">
  <meta property="og:description" content="1 问题描述 运行环境如下：
项目版本JDK1.8Tomcat9.0.73IDEA2023.3.2 写了一个SSM Java Web 项目，项目能正常运行，但是在关闭项目时（亦即在IDEA中通过按钮关闭Tomcat 9.0.73服务时），如下了如下警告：
D:\Server\apache-tomcat-9.0.73-windows-x64\apache-tomcat-9.0.73\bin\catalina.bat stop
Using CATALINA_BASE: “C:\Users\Abc\AppData\Local\JetBrains\IntelliJIdea2023.3\tomcat\be4e23eb-1dde-42b0-9e52-853b5050e770”
Using CATALINA_HOME: “D:\Server\apache-tomcat-9.0.73-windows-x64\apache-tomcat-9.0.73”
Using CATALINA_TMPDIR: “D:\Server\apache-tomcat-9.0.73-windows-x64\apache-tomcat-9.0.73\temp”
Using JRE_HOME: “D:\programfiles\BaseTools\Java\jdk-1.8”
Using CLASSPATH: “D:\Server\apache-tomcat-9.0.73-windows-x64\apache-tomcat-9.0.73\bin\bootstrap.jar;D:\Server\apache-tomcat-9.0.73-windows-x64\apache-tomcat-9.0.73\bin\tomcat-juli.jar”
Using CATALINA_OPTS: “”
14-Mar-2024 08:32:34.599 信息 [main] org.apache.catalina.core.StandardServer.await 通过关闭端口接收到有效的关闭命令。正在停止服务器实例。
14-Mar-2024 08:32:34.600 信息 [main] org.apache.coyote.AbstractProtocol.pause 暂停ProtocolHandler[“http-nio-8080”]
14-Mar-2024 08:32:34.686 信息 [main] org.apache.catalina.core.StandardService.stopInternal 正在停止服务[Catalina]
14-Mar-2024 08:32:34.694 警告 [main] org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesJdbc Web应用程序 [ROOT] 注册了JDBC驱动程序 [com.alibaba.druid.proxy.DruidDriver]，但在Web应用程序停止时无法注销它。 为防止内存泄漏，JDBC驱动程序已被强制取消注册。
14-Mar-2024 08:32:34.695 警告 [main] org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesJdbc Web应用程序 [ROOT] 注册了JDBC驱动程序 [com.mysql.cj.jdbc.Driver]，但在Web应用程序停止时无法注销它。 为防止内存泄漏，JDBC驱动程序已被强制取消注册。
14-Mar-2024 08:32:34.695 警告 [main] org.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-14T10:35:51+08:00">
    <meta property="article:modified_time" content="2024-03-14T10:35:51+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">问题“Web应用程序[ROOT]似乎启动了一个名为[mysql-cj-abandoned-connection-cleanup]的线程，但未能停止它。这很可能会造成内存泄漏”的解决</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1__1"></a>1 问题描述</h2> 
<p>运行环境如下：</p> 
<table><thead><tr><th>项目</th><th>版本</th></tr></thead><tbody><tr><td>JDK</td><td>1.8</td></tr><tr><td>Tomcat</td><td>9.0.73</td></tr><tr><td>IDEA</td><td>2023.3.2</td></tr></tbody></table> 
<p>写了一个SSM Java Web 项目，项目能正常运行，但是在关闭项目时（亦即在IDEA中通过按钮关闭Tomcat 9.0.73服务时），如下了如下警告：</p> 
<blockquote> 
 <p>D:\Server\apache-tomcat-9.0.73-windows-x64\apache-tomcat-9.0.73\bin\catalina.bat stop<br> Using CATALINA_BASE: “C:\Users\Abc\AppData\Local\JetBrains\IntelliJIdea2023.3\tomcat\be4e23eb-1dde-42b0-9e52-853b5050e770”<br> Using CATALINA_HOME: “D:\Server\apache-tomcat-9.0.73-windows-x64\apache-tomcat-9.0.73”<br> Using CATALINA_TMPDIR: “D:\Server\apache-tomcat-9.0.73-windows-x64\apache-tomcat-9.0.73\temp”<br> Using JRE_HOME: “D:\programfiles\BaseTools\Java\jdk-1.8”<br> Using CLASSPATH: “D:\Server\apache-tomcat-9.0.73-windows-x64\apache-tomcat-9.0.73\bin\bootstrap.jar;D:\Server\apache-tomcat-9.0.73-windows-x64\apache-tomcat-9.0.73\bin\tomcat-juli.jar”<br> Using CATALINA_OPTS: “”<br> 14-Mar-2024 08:32:34.599 信息 [main] org.apache.catalina.core.StandardServer.await 通过关闭端口接收到有效的关闭命令。正在停止服务器实例。<br> 14-Mar-2024 08:32:34.600 信息 [main] org.apache.coyote.AbstractProtocol.pause 暂停ProtocolHandler[“http-nio-8080”]<br> 14-Mar-2024 08:32:34.686 信息 [main] org.apache.catalina.core.StandardService.stopInternal 正在停止服务[Catalina]<br> 14-Mar-2024 08:32:34.694 警告 [main] org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesJdbc Web应用程序 [ROOT] 注册了JDBC驱动程序 [com.alibaba.druid.proxy.DruidDriver]，但在Web应用程序停止时无法注销它。 为防止内存泄漏，JDBC驱动程序已被强制取消注册。<br> 14-Mar-2024 08:32:34.695 警告 [main] org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesJdbc Web应用程序 [ROOT] 注册了JDBC驱动程序 [com.mysql.cj.jdbc.Driver]，但在Web应用程序停止时无法注销它。 为防止内存泄漏，JDBC驱动程序已被强制取消注册。<br> 14-Mar-2024 08:32:34.695 警告 [main] org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesThreads Web应用程序[ROOT]似乎启动了一个名为[mysql-cj-abandoned-connection-cleanup]的线程，但未能停止它。这很可能会造成内存泄漏。线程的堆栈跟踪：[<br> java.lang.Object.wait(Native Method)<br> java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:144)<br> com.mysql.cj.jdbc.AbandonedConnectionCleanupThread.run(AbandonedConnectionCleanupThread.java:91)<br> java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)<br> java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)<br> java.lang.Thread.run(Thread.java:748)]<br> INFO 03-14 08:32:34, 689 {dataSource-1} closing … (DruidDataSource.java:2071)<br> INFO 03-14 08:32:34, 691 {dataSource-1} closed (DruidDataSource.java:2144)<br> 14-Mar-2024 08:32:34.705 信息 [main] org.apache.coyote.AbstractProtocol.stop 正在停止ProtocolHandler [“http-nio-8080”]<br> 14-Mar-2024 08:32:34.715 信息 [main] org.apache.coyote.AbstractProtocol.destroy 正在摧毁协议处理器 [“http-nio-8080”]<br> Disconnected from server</p> 
</blockquote> 
<p>上面问题的重点是：</p> 
<blockquote> 
 <p>Web应用程序 [ROOT] 注册了JDBC驱动程序 [com.alibaba.druid.proxy.DruidDriver]，但在Web应用程序停止时无法注销它。 为防止内存泄漏，JDBC驱动程序已被强制取消注册。<br> 14-Mar-2024 08:32:34.695 警告 [main] org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesJdbc Web应用程序 [ROOT] 注册了JDBC驱动程序 [com.mysql.cj.jdbc.Driver]，但在Web应用程序停止时无法注销它。 为防止内存泄漏，JDBC驱动程序已被强制取消注册。<br> 14-Mar-2024 08:32:34.695 警告 [main] org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesThreads Web应用程序[ROOT]似乎启动了一个名为[mysql-cj-abandoned-connection-cleanup]的线程，但未能停止它。这很可能会造成内存泄漏</p> 
</blockquote> 
<h2><a id="2__41"></a>2 解决</h2> 
<h3><a id="21__42"></a>2.1 解决方法</h3> 
<p>从网上看了大量的该问题的解决方案，有许多是行不通的。例如博文<a href="https://blog.csdn.net/qq_43794633/article/details/123199393">解决SSM项目关闭Tomcat9时出现Web应用程序注册了JDBC驱动程序，但在Web应用程序停止时无法注销销它。 为防止内存泄漏，JDBC驱动程序已被强制取消注册的问题</a>给出的方案，但是在我的环境下，找不到类<code>com.mysql.cj.jdbc.AbandonedConnectionCleanupThread</code>。</p> 
<p>还有的说是Tomcat的版本问题，需要改为低版本；stackoverflow也给出了一些解决方案，但场景也不能适用。</p> 
<p>最后，找到一篇博文<a href="https://www.cnblogs.com/gengshao/p/16049332.html" rel="nofollow">Tomcat停止时为了防止内存泄漏，JDBC驱动程序被强制取消注册出现原因</a>，我采用了其中方法2解决了该问题。</p> 
<p>具体说，该解决方法步骤如下：<br> 1 打开项目的<code>Project Structure</code>，按下图设置一下：<br> <img src="https://images2.imgbox.com/85/08/aGwX8F72_o.png" alt="在这里插入图片描述"><br> 上图中，需要右击4，才能出现5。</p> 
<h3><a id="22__53"></a>2.2 验证是否解决</h3> 
<p>我反复启动服务、关闭服务，都没有发现问题。截图如下：<br> <img src="https://images2.imgbox.com/7a/26/6Ie40ViM_o.png" alt="在这里插入图片描述"><br> 可以看出，已不再出现前述的警告信息了。</p> 
<h2><a id="3__58"></a>3 结语</h2> 
<p>真正的原因我还是不知道，stackoverflow虽有人给出了问题的原因，但我还是没理解透。稀里糊涂的把问题解决了，记录一下。</p> 
<p>之前在带GPU的电脑上安装了多次Tensorflow 2.x，安装过程非常繁琐，但都没有像本问题那样令人困惑。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6a4e856fa1fde15d14dd9c2c08639310/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">前端每日一练：使用 JavaScript 下载图片并保存到本地的方法详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6967913f029297de941a2701faa4d294/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Oracle lead和lag函数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>