<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android基础教程——从入门到精通（上） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/5b5b839df71a6caf29ab242e38b22dec/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Android基础教程——从入门到精通（上）">
  <meta property="og:description" content="本文是对B站教程 动脑学院 Android教程 学习过程中所做的笔记。文章分为上下两部分，此文是上部分，下部分链接为：Android基础教程——从入门到精通（下）源视频教程并没有录制全，本文还补充了 Service 和 网络通信 的内容文章介绍详细，示例代码丰富，相信跟着本教程可以打下很好的Android基础。 文章目录 一、开发环境搭建二、简单控件1. 文本显示2. 按钮3. 常用布局（1）线性布局LinearLayout（3）相对布局RelativeLayout（3）网格布局GridLayout 4. 图像显示（1）图像的缩放问题：（2）图像按钮ImageButton： 三、Activity1. Activity的启动和结束2. Activity的生命周期3. Activity的启动模式（1）静态设置（2）动态设置 4. Activity之间传递信息（1）显式Intent和隐式Intent1. 显式Intent2. 隐式Intent： （2）向下一个Activity发送消息：（3）向上一个Activity返回消息： 5. Activity获取一些附加信息（1）获取资源信息：（2）获取元数据信息： 四、数据存储1. 共享参数SharedPreferences（1）使用：（2）应用实例：记住密码功能 2. 数据库SQLite（1）SQLiteDatabase（2）SQLiteOpenHelper（3）代码举例：（4）优化记住密码： 3. 存储卡（1）私有空间和公有空间（2）在存储卡上读写文件（3）在存储卡上读写 图片文件 4. 应用组件Application5. 实战：购物车 五、内容共享1. 在应用之间共享数据2. 使用内容组件获取通讯信息（1）运行时动态申请权限（2）使用ContentResolver读写联系人（3）使用ContentObserver监听短信 3. 在应用之间共享文件（1）使用相册图片发送彩信（2）借助FileProvider发送彩信（3）借助FileProvider安装应用 一、开发环境搭建 安装android studio安装 sdk（当前使用最新版33） 手动下载gradle
（更新：弄完之后有时候没用，可以再试试挂梯子，换网络之类的）
如果第一次启动AndroidStudio没有报错则无需设置，这里是因为我启动完之后下载gradle报错：
could not install gradle distribution from &#39;https://services.gradle.org/dist 可能是网络问题连接不到，所以手动下载。
点击上面提示的链接下载压缩包，然后解压到C:\Users\OYMN\.gradle\wrapper\dists\gradle-7.2-bin\2dnblmf4td7x66yl1d74lt32g
安装模拟器
使用androidstudio提供的模拟器，或者自行下载第三方安卓模拟器（雷电模拟器）
二、简单控件 1. 文本显示 设置文本内容有两种方式：
在 XML 文件中通过属性 android:text 设置文本在 Java 代码中调用文本视图对象的 setText 方法设置文本 引用字符串资源：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-02-07T10:20:50+08:00">
    <meta property="article:modified_time" content="2023-02-07T10:20:50+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android基础教程——从入门到精通（上）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <ul><li>本文是对B站教程 <a href="https://www.bilibili.com/video/BV19U4y1R7zV/" rel="nofollow">动脑学院 Android教程</a> 学习过程中所做的笔记。</li><li>文章分为上下两部分，此文是上部分，下部分链接为：<a href="https://blog.csdn.net/OYMNCHR/article/details/128913683">Android基础教程——从入门到精通（下）</a></li><li>源视频教程并没有录制全，本文还补充了 Service 和 网络通信 的内容</li><li>文章介绍详细，示例代码丰富，相信跟着本教程可以打下很好的Android基础。</li></ul> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_6" rel="nofollow">一、开发环境搭建</a></li><li><a href="#_33" rel="nofollow">二、简单控件</a></li><li><ul><li><a href="#1__35" rel="nofollow">1. 文本显示</a></li><li><a href="#2__49" rel="nofollow">2. 按钮</a></li><li><a href="#3__59" rel="nofollow">3. 常用布局</a></li><li><ul><li><a href="#1LinearLayout_61" rel="nofollow">（1）线性布局LinearLayout</a></li><li><a href="#3RelativeLayout_70" rel="nofollow">（3）相对布局RelativeLayout</a></li><li><a href="#3GridLayout_81" rel="nofollow">（3）网格布局GridLayout</a></li></ul> 
   </li><li><a href="#4__85" rel="nofollow">4. 图像显示</a></li><li><ul><li><a href="#1_92" rel="nofollow">（1）图像的缩放问题：</a></li><li><a href="#2ImageButton_98" rel="nofollow">（2）图像按钮ImageButton：</a></li></ul> 
  </li></ul> 
  </li><li><a href="#Activity_108" rel="nofollow">三、Activity</a></li><li><ul><li><a href="#1_Activity_112" rel="nofollow">1. Activity的启动和结束</a></li><li><a href="#2_Activity_132" rel="nofollow">2. Activity的生命周期</a></li><li><a href="#3_Activity_152" rel="nofollow">3. Activity的启动模式</a></li><li><ul><li><a href="#1_156" rel="nofollow">（1）静态设置</a></li><li><a href="#2_176" rel="nofollow">（2）动态设置</a></li></ul> 
   </li><li><a href="#4_Activity_184" rel="nofollow">4. Activity之间传递信息</a></li><li><ul><li><a href="#1IntentIntent_198" rel="nofollow">（1）显式Intent和隐式Intent</a></li><li><ul><li><a href="#1_Intent_200" rel="nofollow">1. 显式Intent</a></li><li><a href="#2_Intent_225" rel="nofollow">2. 隐式Intent：</a></li></ul> 
    </li><li><a href="#2Activity_263" rel="nofollow">（2）向下一个Activity发送消息：</a></li><li><a href="#3Activity_287" rel="nofollow">（3）向上一个Activity返回消息：</a></li></ul> 
   </li><li><a href="#5_Activity_340" rel="nofollow">5. Activity获取一些附加信息</a></li><li><ul><li><a href="#1_342" rel="nofollow">（1）获取资源信息：</a></li><li><a href="#2_351" rel="nofollow">（2）获取元数据信息：</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_367" rel="nofollow">四、数据存储</a></li><li><ul><li><a href="#1_SharedPreferences_369" rel="nofollow">1. 共享参数SharedPreferences</a></li><li><ul><li><a href="#1_371" rel="nofollow">（1）使用：</a></li><li><a href="#2_406" rel="nofollow">（2）应用实例：记住密码功能</a></li></ul> 
   </li><li><a href="#2_SQLite_436" rel="nofollow">2. 数据库SQLite</a></li><li><ul><li><a href="#1SQLiteDatabase_440" rel="nofollow">（1）SQLiteDatabase</a></li><li><a href="#2SQLiteOpenHelper_451" rel="nofollow">（2）SQLiteOpenHelper</a></li><li><a href="#3_468" rel="nofollow">（3）代码举例：</a></li><li><a href="#4_638" rel="nofollow">（4）优化记住密码：</a></li></ul> 
   </li><li><a href="#3__692" rel="nofollow">3. 存储卡</a></li><li><ul><li><a href="#1_694" rel="nofollow">（1）私有空间和公有空间</a></li><li><a href="#2_722" rel="nofollow">（2）在存储卡上读写文件</a></li><li><a href="#3__751" rel="nofollow">（3）在存储卡上读写 图片文件</a></li></ul> 
   </li><li><a href="#4_Application_830" rel="nofollow">4. 应用组件Application</a></li><li><a href="#5__912" rel="nofollow">5. 实战：购物车</a></li></ul> 
  </li><li><a href="#_914" rel="nofollow">五、内容共享</a></li><li><ul><li><a href="#1__916" rel="nofollow">1. 在应用之间共享数据</a></li><li><a href="#2__1075" rel="nofollow">2. 使用内容组件获取通讯信息</a></li><li><ul><li><a href="#1_1077" rel="nofollow">（1）运行时动态申请权限</a></li><li><a href="#2ContentResolver_1320" rel="nofollow">（2）使用ContentResolver读写联系人</a></li><li><a href="#3ContentObserver_1529" rel="nofollow">（3）使用ContentObserver监听短信</a></li></ul> 
   </li><li><a href="#3__1606" rel="nofollow">3. 在应用之间共享文件</a></li><li><ul><li><a href="#1_1608" rel="nofollow">（1）使用相册图片发送彩信</a></li><li><a href="#2FileProvider_1610" rel="nofollow">（2）借助FileProvider发送彩信</a></li><li><a href="#3FileProvider_1612" rel="nofollow">（3）借助FileProvider安装应用</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_6"></a>一、开发环境搭建</h2> 
<ol><li>安装android studio</li><li>安装 sdk（当前使用最新版33）</li></ol> 
<p><img src="https://images2.imgbox.com/26/ac/K4Q4IAPY_o.png" alt="image-20230105224008976"></p> 
<ol start="3"><li> <p>手动下载gradle</p> <p><strong>（更新：弄完之后有时候没用，可以再试试挂梯子，换网络之类的）</strong></p> <p>如果第一次启动AndroidStudio没有报错则无需设置，这里是因为我启动完之后下载gradle报错：</p> <pre><code>could not install gradle distribution from 'https://services.gradle.org/dist
</code></pre> <p>可能是网络问题连接不到，所以手动下载。</p> <p>点击上面提示的链接下载压缩包，然后解压到<code>C:\Users\OYMN\.gradle\wrapper\dists\gradle-7.2-bin\2dnblmf4td7x66yl1d74lt32g</code></p> <p><img src="https://images2.imgbox.com/07/90/UhU7zEa4_o.png" alt="image-20230105234019833"></p> </li><li> <p>安装模拟器</p> <p>使用androidstudio提供的模拟器，或者自行下载第三方安卓模拟器（雷电模拟器）</p> </li></ol> 
<h2><a id="_33"></a>二、简单控件</h2> 
<h3><a id="1__35"></a>1. 文本显示</h3> 
<p>设置文本内容有两种方式：</p> 
<ul><li>在 XML 文件中通过属性 android:text 设置文本</li><li>在 Java 代码中调用文本视图对象的 setText 方法设置文本</li></ul> 
<p>引用字符串资源：</p> 
<ul><li>在XML文件中引用（@string/xxx）</li><li>在Java代码中引用（R.string.xxx）</li></ul> 
<p>其余设置文本字体大小，颜色等都是可以通过关键词+代码提示很容易就能知道怎么写，这里就不赘述。</p> 
<h3><a id="2__49"></a>2. 按钮</h3> 
<p>Button继承于TextView，因此它们拥有的属性都是共通的。</p> 
<p>除此之外，Button最重要的是点击事件。</p> 
<ul><li> <p>点击监听器：通过setOnClickListener方法设置。按钮被按住少于500毫秒时，会触发点击事件。</p> </li><li> <p>长按监听器：通过setOnLongClickListener方法设置。按钮被按住超过500毫秒时，会触发长按事件。</p> </li></ul> 
<h3><a id="3__59"></a>3. 常用布局</h3> 
<h4><a id="1LinearLayout_61"></a>（1）线性布局LinearLayout</h4> 
<p>特点：要不水平排列，要不竖直排列，通过orintation进行设置（horiztal为水平，vertical为竖直）</p> 
<p>权重属性：通过layout_weight来设置，在线性布局的直接下级进行设置，表示该下级布局占据的宽高比例。</p> 
<ul><li>layout_width填0dp时，layout_weight表示水平方向的宽度比例。</li><li>layout_height填0dp时，layout_weight表示垂直方向的高度比例。</li></ul> 
<h4><a id="3RelativeLayout_70"></a>（3）相对布局RelativeLayout</h4> 
<p>相对布局中的视图位置由两个因素所影响：</p> 
<ul><li>与该视图平级的其他视图</li><li>上级视图（也就是它归属的RelativeLayout）</li></ul> 
<p>相对位置的一些取值：</p> 
<p><img src="https://images2.imgbox.com/79/1d/7F9o8uCV_o.png" alt="image-20230107003412969"></p> 
<h4><a id="3GridLayout_81"></a>（3）网格布局GridLayout</h4> 
<p>顾名思义该布局适用于表格类型的布局。</p> 
<h3><a id="4__85"></a>4. 图像显示</h3> 
<p>图片一般放在res/drawable目录下，设置图像显示一般有两种方法：</p> 
<ul><li>在XML文件中，通过属性android:src设置图片资源，属性值格式形如 @drawable/不含扩展名的图片名称。</li><li>在Java代码中，调用setImageResource方法设置图片资源，方法参数格式形如 R.drawable.不含扩展名的图片名称。</li></ul> 
<h4><a id="1_92"></a>（1）图像的缩放问题：</h4> 
<p>ImageView本身默认图片居中显示，若要改变图片的显示方式，可通过scaleType属性设定，该属性的取值说明如下：</p> 
<p><img src="https://images2.imgbox.com/ee/39/DdH3x2sk_o.png" alt="image-20230107004159846"></p> 
<h4><a id="2ImageButton_98"></a>（2）图像按钮ImageButton：</h4> 
<p>ImageButton是显示图片的图像按钮，但它继承自ImageView，而非继承Button。</p> 
<p>ImageButton和Button之间的区别有：</p> 
<ul><li>Button既可显示文本也可显示图片，ImageButton只能显示图片不能显示文本。</li><li>ImageButton上的图像可按比例缩放，而Button通过背景设置的图像会拉伸变形。</li><li>Button只能靠背景显示一张图片，而ImageButton可分别在前景和背景显示图片，从而实现两张图片叠加的效果。</li></ul> 
<h2><a id="Activity_108"></a>三、Activity</h2> 
<p>Activity是安卓开发四大组件之一，非常重要。</p> 
<h3><a id="1_Activity_112"></a>1. Activity的启动和结束</h3> 
<p>Activity的启动这里指的是跳转，从一个页面跳转到一个新的页面，就相当于启动了一个新的页面。</p> 
<p>示例：</p> 
<pre><code class="prism language-java">bt<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intent<span class="token punctuation">.</span><span class="token function">setClass</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">MainActivity2</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>结束Activity：调用 <code>finish()</code>。</p> 
<h3><a id="2_Activity_132"></a>2. Activity的生命周期</h3> 
<p><strong>onCreate</strong>：此时将页面布局加载到内存中，初始化页面。</p> 
<p><strong>onStart</strong>：将页面展示在屏幕。</p> 
<p><strong>onResume</strong>：此时页面能够和用户进行交互。</p> 
<p><strong>onPause</strong>：页面进入暂停状态，无法和用户进行交互。</p> 
<p><strong>onStop</strong>：页面不在屏幕显示。</p> 
<p><strong>onDestory</strong>：回收Activity占用的资源，彻底销毁该Activity。</p> 
<p><strong>onRestart</strong>：onStop状态可以转为onRestart状态。</p> 
<p><strong>onNewIntent</strong>：重用已存在的活动实例。如果一个Activity已经启动了，并且存在与当前栈，而当前栈的启动模式为SingleTask，SingleInstance，SingleTop（此时在任务栈顶端），那么再次启动该Activity的话，并不会重新进行onCreate，而是会执行onNewIntent方法。</p> 
<p><img src="https://images2.imgbox.com/8d/a9/jYhDUSil_o.png" alt="image-20230108223537951"></p> 
<h3><a id="3_Activity_152"></a>3. Activity的启动模式</h3> 
<p>Android允许在创建Activity时设置启动模式，通过启动模式控制Activity的出入栈行为。</p> 
<h4><a id="1_156"></a>（1）静态设置</h4> 
<p>设置方式：打开AndroidManifest.xml文件，给activity添加属性android:launchMode。如以下表示该activity使用standard标准模式，默认也是标准模式。</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.JumpFirstActivity<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">android:</span>launchMode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>standard<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>launchMode的取值有：</p> 
<p><img src="https://images2.imgbox.com/d6/29/eOOGCm2W_o.png" alt="image-20230109161545002"></p> 
<p><img src="https://images2.imgbox.com/9d/75/7sS2Oknl_o.png" alt="image-20230109161736927"></p> 
<p><img src="https://images2.imgbox.com/79/54/SwDZtjWF_o.png" alt="image-20230109161750015"></p> 
<p><img src="https://images2.imgbox.com/d5/4f/sPnxERGX_o.png" alt="image-20230109161845199"></p> 
<p><img src="https://images2.imgbox.com/8a/ce/ASqEErWN_o.png" alt="image-20230109161930718"></p> 
<h4><a id="2_176"></a>（2）动态设置</h4> 
<p>通过 Intent 动态设置 Activity启动模式：</p> 
<pre><code class="prism language-java">intent<span class="token punctuation">.</span><span class="token function">setFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="4_Activity_184"></a>4. Activity之间传递信息</h3> 
<p>Intent能够让Android各组件之间进行沟通。</p> 
<p>Intent可以完成3部分工作：</p> 
<ul><li>表明本次通信从哪里来，往哪里走，要怎么走。</li><li>发送方可以携带消息给接收方，接收方可以从收到的Intent解析数据。</li><li>发送方如果想要知道接收方的处理结果，接收方也可以通过Intent返回结果。</li></ul> 
<p>Intent的一些组成元素：</p> 
<p><img src="https://images2.imgbox.com/79/23/4D4Pc8fH_o.png" alt="image-20230109163305363"></p> 
<h4><a id="1IntentIntent_198"></a>（1）显式Intent和隐式Intent</h4> 
<h5><a id="1_Intent_200"></a>1. 显式Intent</h5> 
<p>创建方式：</p> 
<ul><li> <p>在Intent的构造函数中指定：</p> <pre><code class="prism language-java"><span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">NextActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>调用setClass指定：</p> <pre><code class="prism language-java"><span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intent<span class="token punctuation">.</span><span class="token function">setClass</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">NextActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>调用setComponent指定：</p> <pre><code class="prism language-java"><span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ComponentName</span> component <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComponentName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">NextActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intent<span class="token punctuation">.</span><span class="token function">setComponent</span><span class="token punctuation">(</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li></ul> 
<h5><a id="2_Intent_225"></a>2. 隐式Intent：</h5> 
<p>没有明确指定所要跳转的页面，而是通过一些动作字符串来让系统自动匹配。</p> 
<p>通常是App不想向外暴露Activity的名称，只给出一些定义好的字符串。这些字符串可以自己定义，也有系统定义的。</p> 
<p>常见的系统动作如下：</p> 
<p><img src="https://images2.imgbox.com/a7/fb/11HUS4qf_o.png" alt="image-20230109224228884"></p> 
<p>下面以调用系统拨号页面举例：</p> 
<pre><code class="prism language-java"><span class="token class-name">String</span> phone <span class="token operator">=</span> <span class="token string">"12345"</span><span class="token punctuation">;</span>
<span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//这里表示设置意图动作为准备拨号</span>
intent<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_DIAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intent<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"tel:"</span> <span class="token operator">+</span> phone<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>如果想要跳转到自己定义的activity：</p> 
<p>步骤一：在AndroidManifest.xml找到该activity，添加action和category标签，同时设置exported为true，表示允许被其他activity调用。</p> 
<p><img src="https://images2.imgbox.com/ab/d8/B3Rv7VlS_o.png" alt="image-20230109230403488"></p> 
<p>步骤二：调用过程和上面一样：</p> 
<pre><code class="prism language-java"><span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intent<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token string">"android.intent.action.activity2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intent<span class="token punctuation">.</span><span class="token function">addCategory</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">CATEGORY_DEFAULT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="2Activity_263"></a>（2）向下一个Activity发送消息：</h4> 
<p>Intent重载了很多putExtra方法用于传递各种类型的信息，包括整数类型，字符串等。但是显然通过调用putExtra方法会很不好管理，因为数据都是零碎传递。所以Android引入了Bundle，其内部是一个Map，使用起来也和Map一样。</p> 
<p><img src="https://images2.imgbox.com/1e/f6/lMQqpavD_o.png" alt="image-20230109165406124"></p> 
<p>示例：</p> 
<pre><code class="prism language-java"><span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">NextActivity</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//通过bundle包装数据</span>
<span class="token class-name">Bundle</span> bundle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bundle<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">"stringKey"</span><span class="token punctuation">,</span> <span class="token string">"stringValue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intent<span class="token punctuation">.</span><span class="token function">putExtras</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>然后下一个Activity就可以通过intent获取到所想要的数据了：</p> 
<pre><code class="prism language-java"><span class="token class-name">Bundle</span> bundle <span class="token operator">=</span> <span class="token function">getIntent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getExtras</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> stringValue <span class="token operator">=</span> bundle<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"stringKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="3Activity_287"></a>（3）向上一个Activity返回消息：</h4> 
<p>上一个页面跳转到下一个页面，同时携带数据：</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token class-name">ActivityResultLauncher</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Intent</span><span class="token punctuation">&gt;</span></span> register<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>bt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//回调函数，返回到这个页面时所执行的程序</span>
    register <span class="token operator">=</span> <span class="token function">registerForActivityResult</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ActivityResultContracts<span class="token punctuation">.</span>StartActivityForResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ActivityResultCallback</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ActivityResult</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
       			<span class="token comment">//回调函数</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onActivityResult</span><span class="token punctuation">(</span><span class="token class-name">ActivityResult</span> result<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token class-name">Intent</span> intent <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>intent <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span><span class="token function">getResultCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Activity</span><span class="token punctuation">.</span><span class="token constant">RESULT_OK</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token comment">//获取到返回的数据</span>
                            <span class="token class-name">Bundle</span> bundle <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getExtras</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">//...</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">MainActivity3</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//跳转下一页面</span>
    register<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>下一个页面接受到数据，处理之后返回结果给上一个页面：</p> 
<pre><code class="prism language-java"><span class="token class-name">Bundle</span> bundle <span class="token operator">=</span> <span class="token function">getIntent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getExtras</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//...页面进行处理</span>
<span class="token comment">//返回数据给上一个页面</span>
<span class="token class-name">Bundle</span> bundle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
bundle<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">"stringKey"</span><span class="token punctuation">,</span> <span class="token string">"stringValue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
intent<span class="token punctuation">.</span><span class="token function">putExtras</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setResult</span><span class="token punctuation">(</span><span class="token class-name">Activity</span><span class="token punctuation">.</span><span class="token constant">RESULT_OK</span><span class="token punctuation">,</span> intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="5_Activity_340"></a>5. Activity获取一些附加信息</h3> 
<h4><a id="1_342"></a>（1）获取资源信息：</h4> 
<pre><code class="prism language-java"><span class="token comment">//获取strings.xml中的字符串资源</span>
<span class="token class-name">String</span> text <span class="token operator">=</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//获取color.xml中的颜色资源</span>
<span class="token keyword">int</span> black <span class="token operator">=</span> <span class="token function">getColor</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>color<span class="token punctuation">.</span>black<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="2_351"></a>（2）获取元数据信息：</h4> 
<pre><code class="prism language-java"><span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//获取包管理器</span>
    <span class="token class-name">PackageManager</span> pm <span class="token operator">=</span> <span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取当前的Activity信息</span>
    <span class="token class-name">ActivityInfo</span> activityInfo <span class="token operator">=</span> pm<span class="token punctuation">.</span><span class="token function">getActivityInfo</span><span class="token punctuation">(</span><span class="token function">getComponentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span><span class="token constant">GET_META_DATA</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Bundle</span> bundle <span class="token operator">=</span> activityInfo<span class="token punctuation">.</span>metaData<span class="token punctuation">;</span>
    <span class="token class-name">String</span> text2 <span class="token operator">=</span> bundle<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"text2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">PackageManager<span class="token punctuation">.</span>NameNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_367"></a>四、数据存储</h2> 
<h3><a id="1_SharedPreferences_369"></a>1. 共享参数SharedPreferences</h3> 
<h4><a id="1_371"></a>（1）使用：</h4> 
<p>sharedPreferences是安卓的一个轻量级存储工具，采用的方式是key-value，以xml文件形式存在，文件路径为/data/data/应用包名/shared_prefs/文件名.xml。</p> 
<pre><code class="prism language-java">
</code></pre> 
<p>适合场景：</p> 
<ol><li>简单且孤立的数据</li><li>文本数据，二进制数据则不合适</li><li>需要持久化的数据，也就是重启APP后数据仍然存在且有效。</li></ol> 
<p>实际开发中，sharedPreferences经常用来存储的数据有：APP的个性化配置信息，用户使用APP的行为信息等。</p> 
<p>sharedPreferences对数据的存储和读取类似Map，提供put和set方法。</p> 
<p>获取数据可以通过SharedPreferences对象获取：</p> 
<pre><code class="prism language-java"><span class="token comment">//第一个参数表示文件名，第二个参数表示私有模式</span>
<span class="token class-name">SharedPreferences</span> shared <span class="token operator">=</span> <span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token string">"fileName"</span><span class="token punctuation">,</span> <span class="token constant">MODE_PRIVATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> name <span class="token operator">=</span> shared<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>而存储数据则还需要借助Editor类：</p> 
<pre><code class="prism language-java"><span class="token class-name">SharedPreferences<span class="token punctuation">.</span>Editor</span> editor <span class="token operator">=</span> shared<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
editor<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"oymn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
editor<span class="token punctuation">.</span><span class="token function">putInt</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
editor<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="2_406"></a>（2）应用实例：记住密码功能</h4> 
<ol><li>声明一个共享参数对象，并在onCreate中调用getSharedPreferences方法获取共享参数的实例。</li><li>登录成功时，如果用户勾选了“记住密码”，就使用共享参数保存手机号码与密码。</li></ol> 
<p>所以在登录页面的onCreat方法中添加获取共享参数的代码：</p> 
<pre><code class="prism language-java"><span class="token comment">// 从share_login.xml获取共享参数对象</span>
mShared <span class="token operator">=</span> <span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token string">"share_login"</span><span class="token punctuation">,</span> <span class="token constant">MODE_PRIVATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取共享参数保存的手机号码</span>
<span class="token class-name">String</span> phone <span class="token operator">=</span> mShared<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取共享参数保存的密码</span>
<span class="token class-name">String</span> password <span class="token operator">=</span> mShared<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
et_phone<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 往手机号码编辑框填写上次保存的手机号</span>
et_password<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 往密码编辑框填写上次保存的密码</span>
</code></pre> 
<p>接着在登录成功方法中添加保存功能：</p> 
<pre><code class="prism language-java"><span class="token comment">// 如果勾选了“记住密码”，就把手机号码和密码都保存到共享参数中</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>isRemember<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">SharedPreferences<span class="token punctuation">.</span>Editor</span> editor <span class="token operator">=</span> mShared<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得编辑器的对象</span>
    editor<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">,</span> et_phone<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加名叫phone的手机号码</span>
    editor<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span> et_password<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加名叫password的密码</span>
    editor<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 提交编辑器中的修改</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2_SQLite_436"></a>2. 数据库SQLite</h3> 
<p>SQLite是安卓的一种小巧的嵌入式数据库，基本使用和思路和Mysql无异。</p> 
<h4><a id="1SQLiteDatabase_440"></a>（1）SQLiteDatabase</h4> 
<p>java代码层面借助SQLiteDatabase来对SQLite进行操作。</p> 
<pre><code class="prism language-java"><span class="token comment">//创建数据库text.db</span>
<span class="token class-name">SQLiteDatabase</span> db <span class="token operator">=</span> <span class="token function">openOrCreateDatabase</span><span class="token punctuation">(</span><span class="token function">getFileDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/test.db"</span><span class="token punctuation">,</span> <span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">MODE_PRIVATE</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/26/9e/6k3yqFTX_o.png" alt="image-20230112213636282"></p> 
<h4><a id="2SQLiteOpenHelper_451"></a>（2）SQLiteOpenHelper</h4> 
<p>由于SQLiteDatabase存在局限性，一不小心就会重复打开数据库，处理数据库的升级也不方便；因此Android提供了数据库帮助器SQLiteOpenHelper，帮助开发者合理使用SQLite。</p> 
<p>SQLiteOpenHelper的具体使用步骤如下：</p> 
<ul><li>步骤一，新建一个继承自SQLiteOpenHelper的数据库操作类，按提示重写onCreate和onUpgrade两个方法。其中，onCreate方法只在第一次打开数据库时执行，在此可以创建表结构；而onUpgrade方法在数据库版本升高时执行，在此可以根据新旧版本号变更表结构。</li><li>步骤二，为保证数据库安全使用，需要封装几个必要方法，包括获取单例对象、打开数据库连接、关闭数据库连接，说明如下： 
  <ul><li>获取单例对象：确保在App运行过程中数据库只会打开一次，避免重复打开引起错误。</li><li>打开数据库连接：SQLite有锁机制，即读锁和写锁的处理；故而数据库连接也分两种，读连接可调用getReadableDatabase方法获得，写连接可调用getWritableDatabase获得。</li><li>关闭数据库连接：数据库操作完毕，调用数据库实例的close方法关闭连接。</li></ul> </li><li>步骤三， 提供对表记录增加、删除、修改、查询的操作方法。能被SQLite直接使用的数据结构是ContentValues类，它类似于映射Map，也提供了put和get方法存取键值对。 
  <ul><li>区别之处在于：ContentValues的键只能是字符串，不能是其他类型。ContentValues主要用于增加记录和更新记录，对应数据库的insert和update方法。</li><li>记录的查询操作用到了游标类Cursor，调用query和rawQuery方法返回的都是Cursor对象，若要获取全部的查询结果，则需根据游标的指示一条一条遍历结果集合。Cursor的常用方法可分为3类，说明如下：</li></ul> </li></ul> 
<p><img src="https://images2.imgbox.com/2c/be/95TxuBiz_o.png" alt="image-20230112214321301"></p> 
<h4><a id="3_468"></a>（3）代码举例：</h4> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDBHelper</span> <span class="token keyword">extends</span> <span class="token class-name">SQLiteOpenHelper</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DB_NAME</span> <span class="token operator">=</span> <span class="token string">"user.db"</span><span class="token punctuation">;</span>   <span class="token comment">//数据库名称</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DB_VERSION</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment">//数据库的版本号</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">UserDBHelper</span> helper <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>   <span class="token comment">//单例</span>
    <span class="token keyword">private</span> <span class="token class-name">SQLiteDatabase</span> sdb <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token comment">//数据库实例</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TABLE_NAME</span> <span class="token operator">=</span> <span class="token string">"user_info"</span><span class="token punctuation">;</span>   <span class="token comment">//表名</span>

    <span class="token keyword">public</span> <span class="token class-name">UserDBHelper</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token constant">DB_NAME</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token constant">DB_VERSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">UserDBHelper</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token keyword">int</span> version<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token constant">DB_NAME</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//通过单例模式获取 UserDBHelper 的唯一实例</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">UserDBHelper</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token keyword">int</span> version<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>version <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> helper <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            helper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDBHelper</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>helper <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            helper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDBHelper</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> helper<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//打开读连接</span>
    <span class="token keyword">public</span> <span class="token class-name">SQLiteDatabase</span> <span class="token function">openReadLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sdb <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>sdb<span class="token punctuation">.</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            sdb <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">getReadableDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> sdb<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//打开写连接</span>
    <span class="token keyword">public</span> <span class="token class-name">SQLiteDatabase</span> <span class="token function">openWriteLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sdb <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>sdb<span class="token punctuation">.</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            sdb <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">getWritableDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> sdb<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//关闭数据库连接</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">closeLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sdb <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> sdb<span class="token punctuation">.</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            sdb<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            sdb <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//创建数据库，执行建表语句</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">SQLiteDatabase</span> db<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//先删除已存在表</span>
        <span class="token class-name">String</span> drop_sql <span class="token operator">=</span> <span class="token string">"drop table if exists "</span> <span class="token operator">+</span> <span class="token constant">TABLE_NAME</span> <span class="token operator">+</span> <span class="token string">";"</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>drop_sql<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建表</span>
        <span class="token class-name">String</span> create_sql <span class="token operator">=</span> <span class="token string">"CREATE TABLE IF NOT EXISTS "</span> <span class="token operator">+</span> <span class="token constant">TABLE_NAME</span> <span class="token operator">+</span> <span class="token string">" ("</span>
                <span class="token operator">+</span> <span class="token string">"_id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,"</span>
                <span class="token operator">+</span> <span class="token string">"name VARCHAR NOT NULL,"</span> <span class="token operator">+</span> <span class="token string">"age INTEGER NOT NULL,"</span>
                <span class="token operator">+</span> <span class="token string">"height INTEGER NOT NULL,"</span> <span class="token operator">+</span> <span class="token string">"weight FLOAT NOT NULL,"</span>
                <span class="token operator">+</span> <span class="token string">"married INTEGER NOT NULL,"</span> <span class="token operator">+</span> <span class="token string">"update_time VARCHAR NOT NULL"</span>
                <span class="token comment">//演示数据库升级时要先把下面这行注释</span>
                <span class="token operator">+</span> <span class="token string">",phone VARCHAR"</span> <span class="token operator">+</span> <span class="token string">",password VARCHAR"</span>
                <span class="token operator">+</span> <span class="token string">");"</span><span class="token punctuation">;</span>

        db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>create_sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//修改表结构</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onUpgrade</span><span class="token punctuation">(</span><span class="token class-name">SQLiteDatabase</span> db<span class="token punctuation">,</span> <span class="token keyword">int</span> oldVersion<span class="token punctuation">,</span> <span class="token keyword">int</span> newVersion<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newVersion <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//Android的ALTER命令不支持一次添加多列，只能分多次添加</span>
            <span class="token class-name">String</span> alter_sql <span class="token operator">=</span> <span class="token string">"ALTER TABLE "</span> <span class="token operator">+</span> <span class="token constant">TABLE_NAME</span> <span class="token operator">+</span> <span class="token string">" ADD COLUMN phone VARCHAR;"</span><span class="token punctuation">;</span>
            db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>alter_sql<span class="token punctuation">)</span><span class="token punctuation">;</span>

            alter_sql <span class="token operator">=</span> <span class="token string">"ALTER TABLE "</span> <span class="token operator">+</span> <span class="token constant">TABLE_NAME</span> <span class="token operator">+</span> <span class="token string">" ADD COLUMN "</span> <span class="token operator">+</span> <span class="token string">"password VARCHAR;"</span><span class="token punctuation">;</span>
            db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span>alter_sql<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行完整的SQL语</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//根据指定条件删除记录</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> condition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> sdb<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> condition<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//删除全部记录</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">deleteAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> sdb<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> <span class="token string">"1=1"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//根据条件查询记录</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">String</span> condition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"select rowid,_id,name,age,height,weight,married,update_time,"</span> <span class="token operator">+</span>
                <span class="token string">"phone,password from %s where %s;"</span><span class="token punctuation">,</span> <span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> condition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//执行查询语句，该语句返回结果集的游标</span>
        <span class="token class-name">Cursor</span> cursor <span class="token operator">=</span> sdb<span class="token punctuation">.</span><span class="token function">rawQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> userInfos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//循环取出游标指向的结果集</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">moveToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userInfo<span class="token punctuation">.</span>name <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userInfo<span class="token punctuation">.</span>age <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userInfos<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        cursor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userInfos<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//往表里添加一条记录</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">UserInfo</span> userinfo<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> userInfos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        userInfos<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>userinfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">insert</span><span class="token punctuation">(</span>userInfos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//往表里添加多条记录</span>
    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> userInfos<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">long</span> result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">UserInfo</span> userInfo <span class="token operator">:</span> userInfos<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//如果名字相同，则更新记录</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span>name <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> userInfo<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">String</span> condition <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"name = '%s'"</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> dbUserInfoList <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>dbUserInfoList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> dbUserInfoList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">update</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span> condition<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//返回其id</span>
                    result <span class="token operator">=</span> dbUserInfoList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>id<span class="token punctuation">;</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//其余情况则说明记录不重复，添加新纪录</span>
            <span class="token class-name">ContentValues</span> cv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            cv<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            cv<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
            result <span class="token operator">=</span> sdb<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> cv<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> result<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//根据指定条件更新表记录</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">UserInfo</span> userInfo<span class="token punctuation">,</span> <span class="token class-name">String</span> condition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">ContentValues</span> cv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cv<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cv<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> sdb<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> cv<span class="token punctuation">,</span> condition<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="4_638"></a>（4）优化记住密码：</h4> 
<p>上面通过SharedPreferences存储密码的方式还是存在一定的局限性，该方式只能记住一个用户的登录信息，当下一个用户登录后，上一个用户的信息将会被覆盖。正确的记住密码功能应该是输入手机号自动补充密码，因此，可以考虑使用数据库来进行存储。</p> 
<p>主要的改造如下：</p> 
<ol><li>声明一个数据库的helper对象，在Activity的OnResume方法中获取数据库连接，在OnPause方法中关闭数据库连接。</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token class-name">UserDBHelper</span> helper<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//获取数据库帮助器实例 (此处是单例，所以不怕重复获取)</span>
    helper <span class="token operator">=</span> <span class="token class-name">UserDBHelper</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//恢复页面时则获取连接</span>
    helper<span class="token punctuation">.</span><span class="token function">openWriteLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//暂停页面时就断开连接</span>
    helper<span class="token punctuation">.</span><span class="token function">closeLink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>登录成功后，如果用户勾选了记住密码功能，则保存到数据库。也就是在loginSuccess方法中添加如下：</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>isRemember<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">UserInfo</span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个用户信息对象</span>
    info<span class="token punctuation">.</span>phone <span class="token operator">=</span> et_phone<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    info<span class="token punctuation">.</span>password <span class="token operator">=</span> et_password<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    info<span class="token punctuation">.</span>update_time <span class="token operator">=</span> <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">getNowDateTime</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mHelper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 往用户数据库添加登录成功的用户信息</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>用户进行登录时，根据输入手机号自动查找密码：</li></ol> 
<pre><code class="prism language-java"><span class="token comment">// 根据手机号码查询指定记录</span>
<span class="token keyword">public</span> <span class="token class-name">UserInfo</span> <span class="token function">queryByPhone</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">UserInfo</span> info <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> infoList <span class="token operator">=</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"phone='%s'"</span><span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>infoList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 存在该号码的登录信息</span>
    info <span class="token operator">=</span> infoList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> info<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3__692"></a>3. 存储卡</h3> 
<h4><a id="1_694"></a>（1）私有空间和公有空间</h4> 
<p>为了更规范地管理手机存储空间，<strong>Android从7.0开始将存储卡划分为私有存储和公共存储两大部分</strong>，也就是分区存储方式，系统给每个App都分配了默认的私有存储空间。<strong>App在私有空间上读写文件无须任何授权，但是若想在公共空间读写文件，则要在AndroidManifest.xml里面添加下述的权限配置。</strong></p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- 存储卡读写 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.WRITE_EXTERNAL_STORAGE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.READ_EXTERNAL_STORAG<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>但是即使App声明了完整的存储卡操作权限，系统仍然默认禁止该App访问公共空间。打开手机的系统设置界面，进入到具体应用的管理页面，会发现该应用的存储访问权限被禁止了。</p> 
<p>既然存储卡分为公共空间和私有空间两部分，它们的空间路径获取也就有所不同。若想获取公共空间的存储路径，调用的是Environment.getExternalStoragePublicDirectory方法；若想获取应用私有空间的存储路径，调用的是getExternalFilesDir方法。</p> 
<pre><code class="prism language-java"> <span class="token comment">//获取系统的公共存储路径</span>
<span class="token class-name">String</span> publicPath <span class="token operator">=</span> <span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token function">getExternalStoragePublicDirectory</span><span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token constant">DIRECTORY_DOWNLOADS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//获取系统的私有存储路径</span>
<span class="token class-name">String</span> privatePath <span class="token operator">=</span> <span class="token function">getExternalFilesDir</span><span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token constant">DIRECTORY_DOWNLOADS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">boolean</span> isLegacy <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span><span class="token constant">VERSION</span><span class="token punctuation">.</span><span class="token constant">SDK_INT</span> <span class="token operator">&gt;=</span> <span class="token class-name">Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>Q</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//Android10的存储空间默认采用分区方式，这里是判断是使用传统方式还是分区方式</span>
    isLegacy <span class="token operator">=</span> <span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token function">isExternalStorageLegacy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="2_722"></a>（2）在存储卡上读写文件</h4> 
<p>文本文件的读写借助IO流 FileOutputStream（写文件）和 FileInputStream（读文件）</p> 
<pre><code class="prism language-java"><span class="token comment">// 把字符串保存到指定路径的文本文件</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">saveText</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">String</span> txt<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 根据指定的文件路径构建文件输出流对象</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   		fos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>txt<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 把字符串写入文件输出流</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 从指定路径的文本文件中读取内容字符串</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">openText</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> readStr <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token comment">// 根据指定的文件路径构建文件输入流对象</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>fis<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        fis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从文件输入流读取字节数组</span>
        readStr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 把字节数组转换为字符串</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> readStr<span class="token punctuation">;</span> <span class="token comment">// 返回文本文件中的文本字符串</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="3__751"></a>（3）在存储卡上读写 图片文件</h4> 
<p>文本文件可以转化为对字符串的读写，而图像的读写就需要借助专门的位图工具Bitmap处理。不同图像来源获取Bitmap的方式不同，有三种：</p> 
<ol><li>从指定资源文件中获取：decodeResource，例如从资源文件img.png获取位图对象：</li></ol> 
<pre><code class="prism language-java"><span class="token class-name">Bitmap</span> bitmap <span class="token operator">=</span> <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="2"><li>从指定路径下获取：decodeFile，但是要注意从Android10开始，该方法只能获取私有空间下的图片，公共空间下获取不了。</li></ol> 
<pre><code class="prism language-java"><span class="token class-name">Bitmap</span> bitmap <span class="token operator">=</span> <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeFile</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\OYMN\\Pictures\\onepunch.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="3"><li>从指定的输入流中获取，比如使用IO流打开图片文件，然后作为参数传入decodeStream：</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Bitmap</span> <span class="token function">openImage</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Bitmap</span> bitmap <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 声明一个位图对象</span>
    <span class="token comment">// 根据指定的文件路径构建文件输入流对象</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	bitmap <span class="token operator">=</span> <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeStream</span><span class="token punctuation">(</span>fis<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 从文件输入流中解码位图数据</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    	e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bitmap<span class="token punctuation">;</span> <span class="token comment">// 返回图片文件中的位图数据</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>获取到图片之后就可以通过ImageView的setImageBitmap进行设置了。</p> 
<p>有多种读取图片的方式，但是写图片只有一种方式。通过Bitmap的compress方法将位图数据压缩到文件输出流：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">saveImage</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">Bitmap</span> bitmap<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">//根据文件路径构建文件输出流</span>
    <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">//将位图数据压缩到文件输出流</span>
        bitmap<span class="token punctuation">.</span><span class="token function">compress</span><span class="token punctuation">(</span><span class="token class-name">Bitmap<span class="token punctuation">.</span>CompressFormat</span><span class="token punctuation">.</span><span class="token constant">JPEG</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> fos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>以下演示一下完整的文件读写操作：</p> 
<pre><code class="prism language-java"><span class="token comment">// 获取当前App的私有下载目录</span>
<span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token function">getExternalFilesDir</span><span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token constant">DIRECTORY_DOWNLOADS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
<span class="token string">"/"</span><span class="token punctuation">;</span>
<span class="token comment">// 从指定的资源文件中获取位图对象</span>
<span class="token class-name">Bitmap</span> bitmap <span class="token operator">=</span> <span class="token class-name">BitmapFactory</span><span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>huawei<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> file_path <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token class-name">DateUtil</span><span class="token punctuation">.</span><span class="token function">getNowDateTime</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".jpeg"</span><span class="token punctuation">;</span>
<span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">saveImage</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> bitmap<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 把位图对象保存为图片文件</span>
tv_path<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"图片文件的保存路径为：\n"</span> <span class="token operator">+</span> file_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token comment">// 获取当前App的私有下载目录</span>
mPath <span class="token operator">=</span> <span class="token function">getExternalFilesDir</span><span class="token punctuation">(</span><span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token constant">DIRECTORY_DOWNLOADS</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/"</span><span class="token punctuation">;</span>
<span class="token comment">// 获得指定目录下面的所有图片文件</span>
mFilelist <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">getFileList</span><span class="token punctuation">(</span>mPath<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token string">".jpeg"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>mFilelist<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token comment">// 打开并显示选中的图片文件内容</span>
<span class="token class-name">String</span> file_path <span class="token operator">=</span> mFilelist<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
tv_content<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"找到最新的图片文件，路径为"</span><span class="token operator">+</span>file_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 显示存储卡图片文件的第一种方式：直接调用setImageURI方法</span>
<span class="token comment">//iv_content.setImageURI(Uri.parse(file_path)); // 设置图像视图的路径对象</span>
<span class="token comment">// 第二种方式：先调用BitmapFactory.decodeFile获得位图，再调用setImageBitmap方法</span>
<span class="token comment">//Bitmap bitmap = BitmapFactory.decodeFile(file_path);</span>
<span class="token comment">//iv_content.setImageBitmap(bitmap); // 设置图像视图的位图对象</span>
<span class="token comment">// 第三种方式：先调用FileUtil.openImage获得位图，再调用setImageBitmap方法</span>
<span class="token class-name">Bitmap</span> bitmap <span class="token operator">=</span> <span class="token class-name">FileUtil</span><span class="token punctuation">.</span><span class="token function">openImage</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
iv_content<span class="token punctuation">.</span><span class="token function">setImageBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 设置图像视图的位图对象</span>
</code></pre> 
<h3><a id="4_Application_830"></a>4. 应用组件Application</h3> 
<p>Application是Android的一大组件，在App运行期间只有一个Application对象贯穿整个应用的生命周期。因此，Application适合保存全局变量，主要是以下三类数据：</p> 
<ul><li> <p>会频繁读取的信息：如用户名，手机号码等</p> </li><li> <p>不方便通过intent传递的数据，如位图对象，非字符串的集合对象等。</p> </li><li> <p>容易因频繁分配内存而导致内存泄漏的对象，如Handler处理器实例等。</p> <p><img src="https://images2.imgbox.com/e7/5e/Qnzb10A0_o.png" alt="image-20230115170457698"></p> </li></ul> 
<p>通过Application实现对全局内存的读写：</p> 
<ol><li>先继承Application，并获取唯一实例：</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyApplication</span> <span class="token keyword">extends</span> <span class="token class-name">Application</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">MyApplication</span> myApplication<span class="token punctuation">;</span>   <span class="token comment">//Application唯一实例</span>

    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//当作全局变量，用来存储数据</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">MyApplication</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> myApplication<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 在打开应用时对静态的应用实例赋值</span>
        myApplication <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<ol start="2"><li>在AndroidManifest.xml 通过name属性添加该Application</li></ol> 
<p><img src="https://images2.imgbox.com/70/a4/PK6uKRKP_o.png" alt="image-20230117121213401"></p> 
<ol start="3"><li>接下来就可以通过该Application在整个App中存取数据了：</li></ol> 
<p>如在MainActivity6存储数据：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main6<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//存储数据</span>
    <span class="token class-name">MyApplication</span> myApplication <span class="token operator">=</span> <span class="token class-name">MyApplication</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myApplication<span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"myKey"</span><span class="token punctuation">,</span> <span class="token string">"myValue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//跳转到MainActivity5</span>
    <span class="token class-name">View</span> bt5 <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>bt5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    bt5<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">MainActivity6</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">MainActivity5</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>在MainActivity5中获取数据：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main5<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">TextView</span> tv <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>tv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    tv<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token class-name">MyApplication</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"myKey"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//成功获取到数据</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="5__912"></a>5. 实战：购物车</h3> 
<h2><a id="_914"></a>五、内容共享</h2> 
<h3><a id="1__916"></a>1. 在应用之间共享数据</h3> 
<p>接下来将介绍Android的四大组件之一ContentProvider，通过ContentProvider封装内部数据的外部访问接口，实现不同应用能够互相传输数据。</p> 
<p>和ContentProvider搭配使用的还有：ContentResolver（内容解析器），ContentObserver（内容观察器）。</p> 
<p>上面提到的SQLite可以操作自身的数据库，而ContentProvider则是作为中间接口，通过SQLiteOpenHelper和SQLiteDatabase间接操控数据库，实现为其他应用提供数据的功能。</p> 
<p><img src="https://images2.imgbox.com/18/3e/L1Aju6lo_o.png" alt="image-20230119194835570"></p> 
<p>使用举例如下：</p> 
<ol><li> <p>创建一个UserInfoProvider，用来提供用户信息给外界应用</p> <p>在弹出的右键菜单中依次选择New→Other→Content Provider</p> <p>此时会自动修改两处地方：</p> <p>（1）一是在AndroidManifest.xml中添加该Provider的配置信息：</p> <p><img src="https://images2.imgbox.com/1f/b9/Xmm0eoP6_o.png" alt="image-20230118224755856"></p> <p>（2）二是创建的这个Provider会继承ContentProvider，并重写了一些方法。</p> </li></ol> 
<p>Server端代码：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfoProvider</span> <span class="token keyword">extends</span> <span class="token class-name">ContentProvider</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//这里是上面实现的dbHelper，用来操作本地数据库</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDBHelper</span> userDBHelper<span class="token punctuation">;</span>

    <span class="token comment">//初始化</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//初始化 dbHelper</span>
        userDBHelper <span class="token operator">=</span> <span class="token class-name">UserDBHelper</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//插入</span>
    <span class="token comment">//uri格式：content://com.example.secondandroidapp.UserInfoProvider/user</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Uri</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">Uri</span> uri<span class="token punctuation">,</span> <span class="token class-name">ContentValues</span> values<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//使用sqlite插入数据</span>
        <span class="token class-name">SQLiteDatabase</span> db <span class="token operator">=</span> userDBHelper<span class="token punctuation">.</span><span class="token function">getWritableDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">UserDBHelper</span><span class="token punctuation">.</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> uri<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//查询</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Cursor</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">Uri</span> uri<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> projection<span class="token punctuation">,</span> <span class="token class-name">String</span> selection<span class="token punctuation">,</span>
                        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> selectionArgs<span class="token punctuation">,</span> <span class="token class-name">String</span> sortOrder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token class-name">SQLiteDatabase</span> db <span class="token operator">=</span> userDBHelper<span class="token punctuation">.</span><span class="token function">getReadableDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">UserDBHelper</span><span class="token punctuation">.</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> projection<span class="token punctuation">,</span> selection<span class="token punctuation">,</span> selectionArgs<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//删除</span>
	<span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">Uri</span> uri<span class="token punctuation">,</span> <span class="token class-name">String</span> selection<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> selectionArgs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>uriMatcher<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//这种是uri不带参数："content://com.example.secondandroidapp.UserInfoProvider/user"</span>
            <span class="token keyword">case</span> <span class="token constant">USER</span><span class="token operator">:</span>
                <span class="token comment">// 获取SQLite数据库的写连接</span>
                <span class="token class-name">SQLiteDatabase</span> db <span class="token operator">=</span> userDBHelper<span class="token punctuation">.</span><span class="token function">getWritableDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 执行SQLite的删除操作，并返回删除记录的数目</span>
                count <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">UserDBHelper</span><span class="token punctuation">.</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> selection<span class="token punctuation">,</span>
                        selectionArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token comment">//这种是uri带参数："content://com.example.secondandroidapp.UserInfoProvider/user/2"</span>
            <span class="token keyword">case</span> <span class="token constant">USERS</span><span class="token operator">:</span>
                <span class="token class-name">String</span> id <span class="token operator">=</span> uri<span class="token punctuation">.</span><span class="token function">getLastPathSegment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">SQLiteDatabase</span> db2 <span class="token operator">=</span> userDBHelper<span class="token punctuation">.</span><span class="token function">getWritableDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                count <span class="token operator">=</span> db2<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">UserDBHelper</span><span class="token punctuation">.</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> <span class="token string">"id = ?"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span>id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                db2<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token class-name">Uri</span> uri<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// TODO: Implement this to handle requests for the MIME type of the data</span>
        <span class="token comment">// at the given URI.</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token string">"Not yet implemented"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Uri</span> uri<span class="token punctuation">,</span> <span class="token class-name">ContentValues</span> values<span class="token punctuation">,</span> <span class="token class-name">String</span> selection<span class="token punctuation">,</span>
                      <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> selectionArgs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// TODO: Implement this to handle requests to update one or more rows.</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token string">"Not yet implemented"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li> <p>利用ContentProvider只实现服务端App的数据封装，如果客户端App想访问对方的内部数据，就要通过内容解析器ContentResolver访问。</p> <p><img src="https://images2.imgbox.com/f7/f5/GUqSCYr4_o.png" alt="image-20230119194953733"></p> </li></ol> 
<p>ContentProvider的Uri结构如下：<code>content://authority/data_path/id</code></p> 
<p>Client的代码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity7</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Uri</span> <span class="token class-name">ContentUri</span> <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"content://com.example.secondandroidapp.UserInfoProvider/user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main7<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Button</span> insertButton <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>insertButton<span class="token punctuation">)</span><span class="token punctuation">;</span>
        insertButton<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">ContentValues</span> values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"陈鸿荣"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token string">"20"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//获取到ContentResolver之后调用插入方法进行插入</span>
                <span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ContentUri</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Button</span> deleteButton <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>deleteButton<span class="token punctuation">)</span><span class="token punctuation">;</span>
        deleteButton<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// content://com.example.secondandroidapp.UserInfoProvider/user/2</span>
                <span class="token class-name">Uri</span> uri <span class="token operator">=</span> <span class="token class-name">ContentUris</span><span class="token punctuation">.</span><span class="token function">withAppendedId</span><span class="token punctuation">(</span><span class="token class-name">ContentUri</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>出于安全考虑，Android11需要事先声明需要访问的其他应用：</p> 
<p>在AndroidManifest.xml中添加如下：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>queries</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--服务端应用包名 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.secondandroidapp<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    
    <span class="token comment">&lt;!--或者直接指定authorities--&gt;</span>
    <span class="token comment">&lt;!-- &lt;provider android:authorities="com.example.secondandroidapp.UserInfoProvider"/&gt;   --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>queries</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="2__1075"></a>2. 使用内容组件获取通讯信息</h3> 
<h4><a id="1_1077"></a>（1）运行时动态申请权限</h4> 
<p>在上面讲公共存储空间与私有存储空间提到，App若想访问存储卡的公共空间，就要在AndroidManifest.xml里面添加下述的权限配置。</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- 存储卡读写 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.WRITE_EXTERNAL_STORAGE<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.READ_EXTERNAL_STORAG<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>然而即使App声明了完整的存储卡操作权限，从Android 7.0开始，系统仍然默认禁止该App访问公共空间，必须到设置界面手动开启应用的存储卡权限才行。尽管此举是为用户隐私着想，可是人家咋知道要手工开权限呢？就算用户知道，去设置界面找到权限开关也颇费周折。为此Android支持在Java代码中处理权限，处理过程分为3个步骤：</p> 
<ol><li> <p>检查App是否开启了指定权限：</p> <p>调用ContextCompat的checkSelfPermission方法</p> </li><li> <p>请求系统弹窗，以便用户选择是否开启权限：</p> <p>调用ActivityCompat的requestPermissions方法，即可命令系统自动弹出权限申请窗口。</p> </li><li> <p>判断用户的权限选择结果，是开启还是拒绝：</p> <p>重写活动页面的权限请求回调方法onRequestPermissionsResult，在该方法内部处理用户的权限选择结果</p> </li></ol> 
<p>动态申请权限有两种方式：饿汉式 和 懒汉式。</p> 
<p>接下来通过获取通讯权限和短信权限来进行举例说明：</p> 
<p>首先是懒汉式：当需要某种权限的时候再去申请</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PermissionUtil</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//检查权限，返回true表示完全启用权限，返回false则表示为完全启用所有权限</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">checkPermission</span><span class="token punctuation">(</span><span class="token class-name">Activity</span> activity<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> permissions<span class="token punctuation">,</span> <span class="token keyword">int</span> requestCode<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

        <span class="token comment">//Android6.0之后采取动态权限管理</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span><span class="token constant">VERSION</span><span class="token punctuation">.</span><span class="token constant">SDK_INT</span> <span class="token operator">&gt;</span> <span class="token class-name">Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>M</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">int</span> check <span class="token operator">=</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span><span class="token constant">PERMISSION_GRANTED</span><span class="token punctuation">;</span>  <span class="token comment">// 0</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> permission <span class="token operator">:</span> permissions<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                check <span class="token operator">=</span> <span class="token class-name">ContextCompat</span><span class="token punctuation">.</span><span class="token function">checkSelfPermission</span><span class="token punctuation">(</span>activity<span class="token punctuation">,</span> permission<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>check <span class="token operator">!=</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span><span class="token constant">PERMISSION_GRANTED</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//如果未开启该权限，则请求系统弹窗，好让用户选择是否开启权限</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>check <span class="token operator">!=</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span><span class="token constant">PERMISSION_GRANTED</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token comment">//请求权限</span>
                <span class="token class-name">ActivityCompat</span><span class="token punctuation">.</span><span class="token function">requestPermissions</span><span class="token punctuation">(</span>activity<span class="token punctuation">,</span> permissions<span class="token punctuation">,</span> requestCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//检查权限数组，返回true表示都已经授权</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">checkGrant</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> grantResults<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>grantResults <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> grant <span class="token operator">:</span> grantResults<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>grant <span class="token operator">!=</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span><span class="token constant">PERMISSION_GRANTED</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>通过两个按钮模拟分别获取权限：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PermissionLazyActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//通讯录的读写权限</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">PERMISSION_CONTACT</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">READ_CONTACTS</span><span class="token punctuation">,</span>
            <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">WRITE_CONTACTS</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">//短信的读写权限</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">PERMISSION_SMS</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">SEND_SMS</span><span class="token punctuation">,</span>
            <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">RECEIVE_SMS</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">REQUEST_CODE_CONTACTS</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">REQUEST_CODE_SMS</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_permission_lazy<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取通讯录权限</span>
        <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_contact<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">PermissionUtil</span><span class="token punctuation">.</span><span class="token function">checkPermission</span><span class="token punctuation">(</span><span class="token class-name">PermissionLazyActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">PERMISSION_CONTACT</span><span class="token punctuation">,</span> <span class="token constant">REQUEST_CODE_CONTACTS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//获取短信权限</span>
        <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_sms<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">PermissionUtil</span><span class="token punctuation">.</span><span class="token function">checkPermission</span><span class="token punctuation">(</span><span class="token class-name">PermissionLazyActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">PERMISSION_SMS</span><span class="token punctuation">,</span> <span class="token constant">REQUEST_CODE_SMS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 用户选择权限结果后会调用该回调方法</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRequestPermissionsResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> requestCode<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> permissions<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> grantResults<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onRequestPermissionsResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> permissions<span class="token punctuation">,</span> grantResults<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>requestCode<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token constant">REQUEST_CODE_CONTACTS</span><span class="token operator">:</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">PermissionUtil</span><span class="token punctuation">.</span><span class="token function">checkGrant</span><span class="token punctuation">(</span>grantResults<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"hhh"</span><span class="token punctuation">,</span> <span class="token string">"通讯录获取成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"hhh"</span><span class="token punctuation">,</span> <span class="token string">"通讯录获取失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//跳转到设置界面</span>
                    <span class="token function">jumpToSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">REQUEST_CODE_SMS</span><span class="token operator">:</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">PermissionUtil</span><span class="token punctuation">.</span><span class="token function">checkGrant</span><span class="token punctuation">(</span>grantResults<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"hhh"</span><span class="token punctuation">,</span> <span class="token string">"短信权限获取成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"hhh"</span><span class="token punctuation">,</span> <span class="token string">"短信权限获取失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//跳转到设置界面</span>
                    <span class="token function">jumpToSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//跳转到设置界面</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">jumpToSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intent<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token class-name">Settings</span><span class="token punctuation">.</span><span class="token constant">ACTION_APPLICATION_DETAILS_SETTINGS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intent<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">fromParts</span><span class="token punctuation">(</span><span class="token string">"package"</span><span class="token punctuation">,</span> <span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intent<span class="token punctuation">.</span><span class="token function">addFlags</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_ACTIVITY_NEW_TASK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>另外还需要在AndroidManifest.xml中配置：（在低版本中只需要配置这些信息即可，高版本就需要上面的动态申请权限）</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--    开启通讯录权限--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.READ_CONTACTS<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.WRITE_CONTACTS<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token comment">&lt;!--    开启短信收发权限--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.SEND_SMS<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.permission.RECEIVE_SMS<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p>效果如下：</p> 
<img src="https://images2.imgbox.com/1e/b0/YBXo0d70_o.png" alt="image-20230120224940526"> 
<p>懒汉式：在页面打开之后就一次性需要用户获取所有权限。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PermissionHungryActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//所需全部读写权限</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">PERMISSIONS</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">READ_CONTACTS</span><span class="token punctuation">,</span>
            <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">WRITE_CONTACTS</span><span class="token punctuation">,</span>
            <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">SEND_SMS</span><span class="token punctuation">,</span>
            <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">RECEIVE_SMS</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

   	<span class="token comment">//</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">REQUEST_CODE_ALL</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_permission_lazy<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//检查是否拥有所有所需权限</span>
        <span class="token class-name">PermissionUtil</span><span class="token punctuation">.</span><span class="token function">checkPermission</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token constant">PERMISSIONS</span><span class="token punctuation">,</span> <span class="token constant">REQUEST_CODE_ALL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 用户选择权限结果后会调用该回调方法</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRequestPermissionsResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> requestCode<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> permissions<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> grantResults<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onRequestPermissionsResult</span><span class="token punctuation">(</span>requestCode<span class="token punctuation">,</span> permissions<span class="token punctuation">,</span> grantResults<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>requestCode<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token constant">REQUEST_CODE_ALL</span><span class="token operator">:</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">PermissionUtil</span><span class="token punctuation">.</span><span class="token function">checkGrant</span><span class="token punctuation">(</span>grantResults<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"hhh"</span><span class="token punctuation">,</span> <span class="token string">"所有权限获取成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//部分权限获取失败</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> grantResults<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>grantResults<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span><span class="token constant">PERMISSION_GRANTED</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                            <span class="token comment">//判断是什么权限获取失败</span>
                            <span class="token keyword">switch</span> <span class="token punctuation">(</span>permissions<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                                <span class="token keyword">case</span> <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">WRITE_CONTACTS</span><span class="token operator">:</span>
                                <span class="token keyword">case</span> <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">READ_CONTACTS</span><span class="token operator">:</span>
                                    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"hhh"</span><span class="token punctuation">,</span> <span class="token string">"通讯录获取失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token function">jumpToSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                                <span class="token keyword">case</span> <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">SEND_SMS</span><span class="token operator">:</span>
                                <span class="token keyword">case</span> <span class="token class-name">Manifest</span><span class="token punctuation">.</span>permission<span class="token punctuation">.</span><span class="token constant">RECEIVE_SMS</span><span class="token operator">:</span>
                                    <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"hhh"</span><span class="token punctuation">,</span> <span class="token string">"短信权限获取失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token function">jumpToSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//跳转到设置界面</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">jumpToSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intent<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token class-name">Settings</span><span class="token punctuation">.</span><span class="token constant">ACTION_APPLICATION_DETAILS_SETTINGS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intent<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">fromParts</span><span class="token punctuation">(</span><span class="token string">"package"</span><span class="token punctuation">,</span> <span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        intent<span class="token punctuation">.</span><span class="token function">addFlags</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_ACTIVITY_NEW_TASK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">startActivity</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="2ContentResolver_1320"></a>（2）使用ContentResolver读写联系人</h4> 
<p>手机中通讯录的主要表结构有：</p> 
<p><code>raw_contacts</code>表：</p> 
<p><img src="https://images2.imgbox.com/35/e7/60tuwTvr_o.png" alt="image-20230122114023016"></p> 
<p>data表：记录了用户的通讯录所有数据，包括手机号，显示名称等，但是里面的mimetype_id表示不同的数据类型，这与表mimetypes表中的id相对应，raw_contact_id 与上面的 raw_contacts表中的 id 相对应。</p> 
<p><img src="https://images2.imgbox.com/c4/55/PwUccMjy_o.png" alt="image-20230122114040243"></p> 
<p>mimetypes表：</p> 
<p><img src="https://images2.imgbox.com/1d/76/A6J0x3zS_o.png" alt="image-20230122114056962"></p> 
<p>所以，插入步骤如下：</p> 
<ul><li>首先往raw_contacts表中插入一条数据得到id</li><li>接着由于一个联系人有姓名，电话号码，邮箱，因此需要分三次插入data表中，将raw_contact_id和上面得到的id进行关联</li></ul> 
<p>下面是往通讯录插入和查询联系人的代码：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ContactActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token keyword">implements</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">EditText</span> et_contact_name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">EditText</span> et_contact_phone<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">EditText</span> et_contact_email<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_contact<span class="token punctuation">)</span><span class="token punctuation">;</span>
        et_contact_name <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>et_contact_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        et_contact_phone <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>et_contact_phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        et_contact_email <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>et_contact_email<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_add_contact<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_read_contact<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_add_contact<span class="token operator">:</span>
                <span class="token comment">// 创建一个联系人对象</span>
                <span class="token class-name">Contact</span> contact <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Contact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                contact<span class="token punctuation">.</span>name <span class="token operator">=</span> et_contact_name<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                contact<span class="token punctuation">.</span>phone <span class="token operator">=</span> et_contact_phone<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                contact<span class="token punctuation">.</span>email <span class="token operator">=</span> et_contact_email<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// 方式一，使用ContentResolver多次写入，每次一个字段</span>
<span class="token comment">//                 addContacts(getContentResolver(), contact);</span>

                <span class="token comment">// 方式二，批处理方式</span>
                <span class="token comment">// 每一次操作都是一个 ContentProviderOperation，构建一个操作集合，然后一次性执行</span>
                <span class="token comment">// 好处是，要么全部成功，要么全部失败，保证了事务的一致性</span>
                <span class="token function">addFullContacts</span><span class="token punctuation">(</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> contact<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"添加联系人成功！"</span><span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token constant">LENGTH_SHORT</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>

            <span class="token keyword">case</span> <span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_read_contact<span class="token operator">:</span>
                <span class="token function">readPhoneContacts</span><span class="token punctuation">(</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//往通讯录添加一个联系人信息（姓名，号码，邮箱）</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addContacts</span><span class="token punctuation">(</span><span class="token class-name">ContentResolver</span> contentResolver<span class="token punctuation">,</span> <span class="token class-name">Contact</span> contact<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//得到rawContentId</span>
        <span class="token class-name">ContentValues</span> values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//插入记录得到id</span>
        <span class="token class-name">Uri</span> uri <span class="token operator">=</span> contentResolver<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>RawContacts</span><span class="token punctuation">.</span><span class="token constant">CONTENT_URI</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> rawContentId <span class="token operator">=</span> <span class="token class-name">ContentUris</span><span class="token punctuation">.</span><span class="token function">parseId</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//插入名字</span>
        <span class="token class-name">ContentValues</span> name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关联上面得到的联系人id</span>
        name<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">RAW_CONTACT_ID</span><span class="token punctuation">,</span> rawContentId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关联联系人姓名的类型</span>
        name<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">MIMETYPE</span><span class="token punctuation">,</span> <span class="token class-name">ContactsContract<span class="token punctuation">.</span>CommonDataKinds<span class="token punctuation">.</span>StructuredName</span><span class="token punctuation">.</span><span class="token constant">CONTENT_ITEM_TYPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关联联系人姓名</span>
        name<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">DATA2</span><span class="token punctuation">,</span> contact<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        contentResolver<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">CONTENT_URI</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//插入电话号码</span>
        <span class="token class-name">ContentValues</span> phone <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关联上面得到的联系人id</span>
        phone<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">RAW_CONTACT_ID</span><span class="token punctuation">,</span> rawContentId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关联联系人电话号码的类型</span>
        phone<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">MIMETYPE</span><span class="token punctuation">,</span> <span class="token class-name">ContactsContract<span class="token punctuation">.</span>CommonDataKinds<span class="token punctuation">.</span>Phone</span><span class="token punctuation">.</span><span class="token constant">CONTENT_ITEM_TYPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关联联系人电话号码</span>
        phone<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">DATA1</span><span class="token punctuation">,</span> contact<span class="token punctuation">.</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//指定该号码是家庭号码还是工作号码 (家庭)</span>
        phone<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">DATA2</span><span class="token punctuation">,</span> <span class="token class-name">ContactsContract<span class="token punctuation">.</span>CommonDataKinds<span class="token punctuation">.</span>Phone</span><span class="token punctuation">.</span><span class="token constant">TYPE_MOBILE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        contentResolver<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">CONTENT_URI</span><span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//插入邮箱</span>
        <span class="token class-name">ContentValues</span> email <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关联上面得到的联系人id</span>
        email<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">RAW_CONTACT_ID</span><span class="token punctuation">,</span> rawContentId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关联联系人邮箱的类型</span>
        email<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">MIMETYPE</span><span class="token punctuation">,</span> <span class="token class-name">ContactsContract<span class="token punctuation">.</span>CommonDataKinds<span class="token punctuation">.</span>Email</span><span class="token punctuation">.</span><span class="token constant">CONTENT_ITEM_TYPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关联联系人邮箱</span>
        email<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">DATA1</span><span class="token punctuation">,</span> contact<span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//指定该号码是家庭邮箱还是工作邮箱</span>
        email<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">DATA2</span><span class="token punctuation">,</span> <span class="token class-name">ContactsContract<span class="token punctuation">.</span>CommonDataKinds<span class="token punctuation">.</span>Phone</span><span class="token punctuation">.</span><span class="token constant">TYPE_WORK</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        contentResolver<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">CONTENT_URI</span><span class="token punctuation">,</span> email<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//事务操作，四个插入操作一次性提交</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addFullContacts</span><span class="token punctuation">(</span><span class="token class-name">ContentResolver</span> contentResolver<span class="token punctuation">,</span> <span class="token class-name">Contact</span> contact<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建一个插入联系人主记录的内容操作器</span>
        <span class="token class-name">ContentProviderOperation</span> op_main <span class="token operator">=</span> <span class="token class-name">ContentProviderOperation</span>
                <span class="token punctuation">.</span><span class="token function">newInsert</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>RawContacts</span><span class="token punctuation">.</span><span class="token constant">CONTENT_URI</span><span class="token punctuation">)</span>
                <span class="token comment">//没有实际意义，不加这个会报错（不加这个导致没有创建ContentValue，导致报错）</span>
                <span class="token punctuation">.</span><span class="token function">withValue</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>RawContacts</span><span class="token punctuation">.</span><span class="token constant">ACCOUNT_NAME</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建一个插入联系人姓名记录的内容操作器</span>
        <span class="token class-name">ContentProviderOperation</span> op_name <span class="token operator">=</span> <span class="token class-name">ContentProviderOperation</span><span class="token punctuation">.</span><span class="token function">newInsert</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">CONTENT_URI</span><span class="token punctuation">)</span>
                <span class="token comment">//将第0个操作的id，即raw_contacts中的id作为data表中的raw_contact_id</span>
                <span class="token punctuation">.</span><span class="token function">withValueBackReference</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">RAW_CONTACT_ID</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withValue</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">MIMETYPE</span><span class="token punctuation">,</span> <span class="token class-name">ContactsContract<span class="token punctuation">.</span>CommonDataKinds<span class="token punctuation">.</span>StructuredName</span><span class="token punctuation">.</span><span class="token constant">CONTENT_ITEM_TYPE</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withValue</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">DATA2</span><span class="token punctuation">,</span> contact<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//创建一个插入联系人电话号码记录的内容操作器</span>
        <span class="token class-name">ContentProviderOperation</span> op_phone <span class="token operator">=</span> <span class="token class-name">ContentProviderOperation</span><span class="token punctuation">.</span><span class="token function">newInsert</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">CONTENT_URI</span><span class="token punctuation">)</span>
                <span class="token comment">//将第0个操作的id，即raw_contacts中的id作为data表中的raw_contact_id</span>
                <span class="token punctuation">.</span><span class="token function">withValueBackReference</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">RAW_CONTACT_ID</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withValue</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">MIMETYPE</span><span class="token punctuation">,</span> <span class="token class-name">ContactsContract<span class="token punctuation">.</span>CommonDataKinds<span class="token punctuation">.</span>Phone</span><span class="token punctuation">.</span><span class="token constant">CONTENT_ITEM_TYPE</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withValue</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">DATA1</span><span class="token punctuation">,</span> contact<span class="token punctuation">.</span>phone<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withValue</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">DATA2</span><span class="token punctuation">,</span> <span class="token class-name">ContactsContract<span class="token punctuation">.</span>CommonDataKinds<span class="token punctuation">.</span>Phone</span><span class="token punctuation">.</span><span class="token constant">TYPE_MOBILE</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//创建一个插入联系人邮箱记录的内容操作器</span>
        <span class="token class-name">ContentProviderOperation</span> op_email <span class="token operator">=</span> <span class="token class-name">ContentProviderOperation</span><span class="token punctuation">.</span><span class="token function">newInsert</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">CONTENT_URI</span><span class="token punctuation">)</span>
                <span class="token comment">//将第0个操作的id，即raw_contacts中的id作为data表中的raw_contact_id</span>
                <span class="token punctuation">.</span><span class="token function">withValueBackReference</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">RAW_CONTACT_ID</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withValue</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">MIMETYPE</span><span class="token punctuation">,</span> <span class="token class-name">ContactsContract<span class="token punctuation">.</span>CommonDataKinds<span class="token punctuation">.</span>Email</span><span class="token punctuation">.</span><span class="token constant">CONTENT_ITEM_TYPE</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withValue</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">DATA1</span><span class="token punctuation">,</span> contact<span class="token punctuation">.</span>email<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withValue</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">DATA2</span><span class="token punctuation">,</span> <span class="token class-name">ContactsContract<span class="token punctuation">.</span>CommonDataKinds<span class="token punctuation">.</span>Phone</span><span class="token punctuation">.</span><span class="token constant">TYPE_WORK</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//全部放在集合中一次性提交</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ContentProviderOperation</span><span class="token punctuation">&gt;</span></span> operations <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        operations<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>op_main<span class="token punctuation">)</span><span class="token punctuation">;</span>
        operations<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>op_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        operations<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>op_phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        operations<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>op_email<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//批量提交四个操作</span>
            contentResolver<span class="token punctuation">.</span><span class="token function">applyBatch</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract</span><span class="token punctuation">.</span><span class="token constant">AUTHORITY</span><span class="token punctuation">,</span> operations<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">OperationApplicationException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RemoteException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//读取联系人</span>
    <span class="token annotation punctuation">@SuppressLint</span><span class="token punctuation">(</span><span class="token string">"Range"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readPhoneContacts</span><span class="token punctuation">(</span><span class="token class-name">ContentResolver</span> contentResolver<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//先查询raw_contacts表，再根据raw_contacts_id表 查询data表</span>
        <span class="token class-name">Cursor</span> cursor <span class="token operator">=</span> contentResolver<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>RawContacts</span><span class="token punctuation">.</span><span class="token constant">CONTENT_URI</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>RawContacts</span><span class="token punctuation">.</span>_ID<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">moveToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">int</span> rawContactId <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Uri</span> uri <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"content://com.android.contacts/contacts/"</span> <span class="token operator">+</span> rawContactId <span class="token operator">+</span> <span class="token string">"/data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Cursor</span> dataCursor <span class="token operator">=</span> contentResolver<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">MIMETYPE</span><span class="token punctuation">,</span> <span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">DATA1</span><span class="token punctuation">,</span> <span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">DATA2</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Contact</span> contact <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Contact</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>dataCursor<span class="token punctuation">.</span><span class="token function">moveToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">String</span> data1 <span class="token operator">=</span> dataCursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>dataCursor<span class="token punctuation">.</span><span class="token function">getColumnIndex</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">DATA1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> mimeType <span class="token operator">=</span> dataCursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>dataCursor<span class="token punctuation">.</span><span class="token function">getColumnIndex</span><span class="token punctuation">(</span><span class="token class-name">ContactsContract<span class="token punctuation">.</span>Contacts<span class="token punctuation">.</span>Data</span><span class="token punctuation">.</span><span class="token constant">MIMETYPE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span>mimeType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//是姓名</span>
                    <span class="token keyword">case</span> <span class="token class-name">ContactsContract<span class="token punctuation">.</span>CommonDataKinds<span class="token punctuation">.</span>StructuredName</span><span class="token punctuation">.</span><span class="token constant">CONTENT_ITEM_TYPE</span><span class="token operator">:</span>
                        contact<span class="token punctuation">.</span>name <span class="token operator">=</span> data1<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>

                    <span class="token comment">//邮箱</span>
                    <span class="token keyword">case</span> <span class="token class-name">ContactsContract<span class="token punctuation">.</span>CommonDataKinds<span class="token punctuation">.</span>Email</span><span class="token punctuation">.</span><span class="token constant">CONTENT_ITEM_TYPE</span><span class="token operator">:</span>
                        contact<span class="token punctuation">.</span>email <span class="token operator">=</span> data1<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>

                    <span class="token comment">//手机</span>
                    <span class="token keyword">case</span> <span class="token class-name">ContactsContract<span class="token punctuation">.</span>CommonDataKinds<span class="token punctuation">.</span>Phone</span><span class="token punctuation">.</span><span class="token constant">CONTENT_ITEM_TYPE</span><span class="token operator">:</span>
                        contact<span class="token punctuation">.</span>phone <span class="token operator">=</span> data1<span class="token punctuation">;</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            dataCursor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// RawContacts 表中出现的 _id，不一定在 Data 表中都会有对应记录</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>contact<span class="token punctuation">.</span>name <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"hhh"</span><span class="token punctuation">,</span> contact<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        cursor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>页面如下：</p> 
<img src="https://images2.imgbox.com/fe/1d/MHK4hVcC_o.png" alt="image-20230126163716728"> 
<h4><a id="3ContentObserver_1529"></a>（3）使用ContentObserver监听短信</h4> 
<p>ContentResolver获取数据采用的是主动查询方式，有查询就有数据，没查询就没数据。ContentResolver能够实时获取新增的数据，最常见的业务场景是短信验证码。为了替用户省事，App通常会监控手机刚收到的短信验证码，并自动填写验证码输入框。这时就用到了内容观察器ContentObserver，事先给目标内容注册一个观察器，目标内容的数据一旦发生变化，就马上触发观察器的监听事件，从而执行开发者预先定义的代码。</p> 
<p><img src="https://images2.imgbox.com/7e/33/pIOIhX8x_o.png" alt="image-20230126164316484"></p> 
<p>示例代码如下：（记得在Manifest.xml中开启权限和动态开启权限）</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MonitorSmsActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">SmsGetObserver</span> mObserver<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_monitor_sms<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 给指定Uri注册内容观察器，一旦发生数据变化，就触发观察器的onChange方法</span>
        <span class="token class-name">Uri</span> uri <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"content://sms"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// notifyForDescendents：</span>
        <span class="token comment">// false ：表示精确匹配，即只匹配该Uri，true ：表示可以同时匹配其派生的Uri</span>
        mObserver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SmsGetObserver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerContentObserver</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> mObserver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//取消注册</span>
        <span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unregisterContentObserver</span><span class="token punctuation">(</span>mObserver<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SmsGetObserver</span> <span class="token keyword">extends</span> <span class="token class-name">ContentObserver</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Context</span> mContext<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">SmsGetObserver</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">getMainLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>mContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//回调</span>
        <span class="token annotation punctuation">@SuppressLint</span><span class="token punctuation">(</span><span class="token string">"Range"</span><span class="token punctuation">)</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> selfChange<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Uri</span> uri<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span>selfChange<span class="token punctuation">,</span> uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// onChange会多次调用，收到一条短信会调用两次onChange</span>
            <span class="token comment">// mUri===content://sms/raw/20</span>
            <span class="token comment">// mUri===content://sms/inbox/20</span>
            <span class="token comment">// 安卓7.0以上系统，点击标记为已读，也会调用一次</span>
            <span class="token comment">// mUri===content://sms</span>
            <span class="token comment">// 收到一条短信都是uri后面都会有确定的一个数字，对应数据库的_id，比如上面的20</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>uri <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>uri<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"content://sms/raw"</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                    uri<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"content://sms"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 通过内容解析器获取符合条件的结果集游标</span>
            <span class="token class-name">Cursor</span> cursor <span class="token operator">=</span> mContext<span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token string">"address"</span><span class="token punctuation">,</span> <span class="token string">"body"</span><span class="token punctuation">,</span> <span class="token string">"date"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"date DESC"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">moveToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 短信的发送号码</span>
                <span class="token class-name">String</span> sender <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndex</span><span class="token punctuation">(</span><span class="token string">"address"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 短信内容</span>
                <span class="token class-name">String</span> content <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndex</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"ning"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"sender:%s,content:%s"</span><span class="token punctuation">,</span> sender<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            cursor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3__1606"></a>3. 在应用之间共享文件</h3> 
<h4><a id="1_1608"></a>（1）使用相册图片发送彩信</h4> 
<h4><a id="2FileProvider_1610"></a>（2）借助FileProvider发送彩信</h4> 
<h4><a id="3FileProvider_1612"></a>（3）借助FileProvider安装应用</h4>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dee3e4f9d95b7b56c827d0a61c973a94/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何使用JDBC操作数据库？一文带你吃透JDBC规范</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8add35710959d8643c300200e6081c50/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JVM（Java虚拟机）详解（JVM 内存模型、堆、GC、直接内存、性能调优）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>