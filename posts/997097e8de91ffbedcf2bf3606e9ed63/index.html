<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mysql 物理备份 MySQL 全量备份 增量备份 差异备份 日志备份万字长文 1.3万字 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/997097e8de91ffbedcf2bf3606e9ed63/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="mysql 物理备份 MySQL 全量备份 增量备份 差异备份 日志备份万字长文 1.3万字">
  <meta property="og:description" content="版权声明：本文为博主原创文章，遵循版权协议，转载请附上原文出处链接和本声明
注意，通常 完备增备，日志（binlog)备，结合使用 差异则根据具体情况选用。
此备份过程 属于公司 常用的单个数据库备份技术中的
mysql 物理备份 MySQL 全量备份 增量备份 差异备份 日志备份
至于单个数据库备份技术中的逻辑备份 和
混合数据库及其备份技术，本人会另外开文章再进行说明
MySQL备份工具的安装 逻辑备份工具 mysqldump 自带
物理备份工具 percona-xtrabackup 需安装
MySQL数据备份方式 主要有四种：
完整备份、增量备份、差异备份和逻辑备份。它们的区别在于备份的范围和备份方式不同。
MySQL物理备份的种类及其特点 MySQL物理备份主要有三种：完整备份、增量备份和差异备份。每种备份方式都有其独特的特点和适用场景。
1. 完整备份 特点： 备份整个数据库的所有数据和结构。备份文件较大，占用较多存储空间。恢复速度最快，因为只需要恢复一个备份文件。适用场景： 数据量较小的数据库。需要快速恢复的场景。 2. 增量备份 特点： 备份自上次完整备份或增量备份以来发生变化的数据。备份文件较小，节省存储空间。恢复速度较慢，因为需要先恢复完整备份，然后应用所有增量备份。适用场景： 数据量较大且变化频繁的数据库。需要节省存储空间的场景。 3. 差异备份 特点： 备份自上次完整备份以来发生变化的数据。备份文件大小介于完整备份和增量备份之间。恢复速度较快，因为只需要恢复完整备份和一个差异备份。适用场景： 数据量较大且变化频繁，但希望恢复过程不太复杂。需要快速恢复且节省存储空间的场景。 总结 选择哪种备份方式取决于具体需求：
完整备份适用于数据量较小且需要快速恢复的场景。增量备份适用于数据量较大且变化频繁，需要节省存储空间的场景。差异备份适用于数据量较大且变化频繁，但希望恢复过程不太复杂的场景。 Percona XtraBackup 是一个开源的 MySQL 和 InnoDB 备份工具，广泛用于物理数据备份和恢复。
MySQL安装percona-xtrabackup 逻辑备份工具 mysqldump 自带
percona-xtrabackup版本这里有必要说明 参考官网如下：
Aligning Percona XtraBackup Versions with Percona Server for MySQLWe are excited to let you know about two upcoming changes to Percona XtraBackup which will align Percona XtraBackup Versions with Percona Server for MySQL.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-15T22:53:45+08:00">
    <meta property="article:modified_time" content="2024-08-15T22:53:45+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mysql 物理备份 MySQL 全量备份 增量备份 差异备份 日志备份万字长文 1.3万字</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="color:#0d0016;"><strong>版权声明：本文为博主原创文章，遵循版权协议，转载请附上原文出处链接和本声明</strong></span></p> 
<p></p> 
<p><span style="color:#fe2c24;"><strong>注意，通常 完备增备，日志（binlog)备，结合使用 差异则根据具体情况选用。</strong></span></p> 
<p><span style="color:#9c8ec1;"><strong>此备份过程 </strong></span></p> 
<p><span style="color:#9c8ec1;"><strong>属于公司 </strong></span></p> 
<p><span style="color:#9c8ec1;"><strong>常用的单个数据库备份技术中的</strong></span></p> 
<p><span style="color:#9c8ec1;"><strong>mysql 物理备份 MySQL 全量备份 增量备份 差异备份  日志备份</strong></span></p> 
<p></p> 
<p><span style="color:#fe2c24;"><strong><span style="background-color:#eaf4fc;">至于单个数据库备份技术中的逻辑备份 </span></strong></span></p> 
<p><span style="background-color:#eaf4fc;">和</span></p> 
<p><span style="color:#fe2c24;"><strong><span style="background-color:#eaf4fc;">混合数据库及其备份技术，本人会另外开文章再进行说明</span></strong></span></p> 
<p></p> 
<p></p> 
<h2><strong>MySQL备份工具的安装</strong></h2> 
<p><strong><strong>逻辑备份工具 mysqldump  自带</strong></strong></p> 
<p><strong>物理备份工具 percona-xtrabackup 需安装</strong></p> 
<h2 style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>MySQL数据备份方式</strong></span></strong></h2> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>主要有四种：</strong></span></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>完整备份、增量备份、差异备份和逻辑备份。它们的区别在于备份的范围和备份方式不同。</strong></span></strong></p> 
<h2>MySQL物理备份的种类及其特点</h2> 
<p>MySQL物理备份主要有三种：<strong>完整备份</strong>、<strong>增量备份</strong>和<strong>差异备份</strong>。每种备份方式都有其独特的特点和适用场景。</p> 
<h5>1. 完整备份</h5> 
<ul><li><strong>特点</strong>： 
  <ul><li>备份整个数据库的所有数据和结构。</li><li>备份文件较大，占用较多存储空间。</li><li>恢复速度最快，因为只需要恢复一个备份文件。</li></ul></li><li><strong>适用场景</strong>： 
  <ul><li>数据量较小的数据库。</li><li>需要快速恢复的场景。</li></ul></li></ul> 
<h5>2. 增量备份</h5> 
<ul><li><strong>特点</strong>： 
  <ul><li>备份自上次完整备份或增量备份以来发生变化的数据。</li><li>备份文件较小，节省存储空间。</li><li>恢复速度较慢，因为需要先恢复完整备份，然后应用所有增量备份。</li></ul></li><li><strong>适用场景</strong>： 
  <ul><li>数据量较大且变化频繁的数据库。</li><li>需要节省存储空间的场景。</li></ul></li></ul> 
<h5>3. 差异备份</h5> 
<ul><li><strong>特点</strong>： 
  <ul><li>备份自上次完整备份以来发生变化的数据。</li><li>备份文件大小介于完整备份和增量备份之间。</li><li>恢复速度较快，因为只需要恢复完整备份和一个差异备份。</li></ul></li><li><strong>适用场景</strong>： 
  <ul><li>数据量较大且变化频繁，但希望恢复过程不太复杂。</li><li>需要快速恢复且节省存储空间的场景。</li></ul></li></ul> 
<h4>总结</h4> 
<p>选择哪种备份方式取决于具体需求：</p> 
<ul><li><strong>完整备份</strong>适用于数据量较小且需要快速恢复的场景。</li><li><strong>增量备份</strong>适用于数据量较大且变化频繁，需要节省存储空间的场景。</li><li><strong>差异备份</strong>适用于数据量较大且变化频繁，但希望恢复过程不太复杂的场景。</li></ul> 
<p><strong><span style="color:#fe2c24;">Percona XtraBackup 是一个开源的 MySQL 和 InnoDB 备份工具，广泛用于物理数据备份和恢复。</span></strong></p> 
<p></p> 
<h2 style="background-color:transparent;text-align:justify;"><strong><strong><strong>MySQL</strong></strong><strong><strong>安装percona-xtrabackup</strong></strong></strong></h2> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>逻辑备份工具 mysqldump  自带</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 style="background-color:transparent;margin-left:0px;text-align:left;"><strong><strong><strong>percona-xtrabackup</strong></strong></strong><span style="background-color:#ffffff;"><strong><span style="background-color:#ffffff;"><span style="color:#0101fa;"><strong>版本这里有必要说明</strong></span></span></strong></span></h2> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><strong><span style="background-color:#ffffff;"><span style="color:#0101fa;"><strong>参考官网如下：</strong></span></span></strong></span></p> 
<ul><li style="text-align:justify;"><a class="has-card" href="https://www.percona.com/blog/aligning-percona-xtrabackup-versions-with-percona-server-for-mysql/" rel="nofollow" title="Aligning Percona XtraBackup Versions with Percona Server for MySQL"><span class="link-card-box"><span class="link-title">Aligning Percona XtraBackup Versions with Percona Server for MySQL</span><span class="link-desc">We are excited to let you know about two upcoming changes to Percona XtraBackup which will align Percona XtraBackup Versions with Percona Server for MySQL. </span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/ac/46/fSRamDjx_o.png" alt="icon-default.png?t=N7T8">https://www.percona.com/blog/aligning-percona-xtrabackup-versions-with-percona-server-for-mysql/</span></span></a></li></ul> 
<ul><li style="text-align:justify;"><strong><span style="background-color:#ffffff;"><span style="color:#0101fa;"><strong>翻译过来意思就是</strong></span></span></strong><strong><span style="background-color:#ffffff;"><span style="color:#0101fa;"><strong>：Percona XtraBackup 的版本要超过（</strong></span></span></strong><strong><span style="background-color:#f9f2f4;"><span style="color:#0101fa;"><strong>大于或等于</strong></span></span></strong><strong><span style="background-color:#ffffff;"><span style="color:#0101fa;"><strong>）数据库的版本。</strong></span></span></strong></li></ul> 
<p style="margin-left:0;text-align:left;"><strong><span style="color:#0101fa;"><strong><span style="background-color:#ffffff;">比如：</span>当前 MySQL 数据库版本 8.0.32，若安装 XtraBackup 版本为 8.0.32-xxx</strong></span></strong></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#fe2c24;"><strong><span style="background-color:#ffffff;"><strong>尽量和数据库的版本保持一致</strong></span></strong><strong>  为啥？如果不保持一致 因为会天天输出报警信息说你的备份工具和数据库版本不匹配</strong></span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><strong><span style="background-color:#ffffff;"><span style="color:#fe2c24;"><strong>查看mysql 版本</strong></span><span style="color:#0101fa;"><strong>：</strong></span></span></strong></span></p> 
<blockquote> 
 <p style="margin-left:0;text-align:left;"><strong>[root@root ~]# mysql -V <br> mysql  Ver 14.14 Distrib 5.7.44, for Linux (x86_64) using  EditLine wrapper<br> [root@root ~]# </strong><br>  </p> 
</blockquote> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><strong><span style="background-color:#ffffff;"><span style="color:#0101fa;"><strong> 注意v必须大写</strong></span></span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><strong><span style="background-color:#f5f5f5;"><span style="color:#0101fa;"><strong>安装与MySQL 5.7兼容的Percona XtraBackup版本。在你的情况下，MySQL版本是5.7.44，所以你应该安装Percona XtraBackup 2.4，因为这一版本与MySQL 5.7兼容。</strong></span></span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><strong><span style="background-color:#f5f5f5;"><span style="color:#0101fa;"><strong>MySQL </strong></span></span></strong></span><strong><span style="color:#0101fa;"><strong>8.0.32 对应版本：      </strong></span></strong><span style="background-color:#ffffff;"><strong><span style="background-color:#f5f5f5;"><span style="color:#0101fa;"><strong>Percona XtraBackup 8.0.32-x</strong></span></span></strong></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>则查看 XtraBackup 版本时</strong></span></strong></p> 
<h3 style="margin-left:0pt;text-align:left;"><span style="background-color:#ffffff;"><strong><strong><span style="background-color:#ffffff;"><span style="color:#0101fa;"><strong>卸载</strong></span></span></strong></strong><span style="color:#0101fa;">已经安装的 XtraBackup</span></span></h3> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h4 style="text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#0101fa;">查找已经安装的 XtraBackup 名称</span></span></h4> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;">查找</p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>[</strong></span></strong><strong><span style="color:#0101fa;"><strong>root@root soft]# yum list installed | grep -i xtrabackup</strong></span></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong> # 卸载                                        </strong></span></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>                                          </strong></span></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>       yum -y remove percona-xtrabackup-80.x86_64</strong></span></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
</blockquote> 
<h2 style="margin-left:.0001pt;text-align:justify;"></h2> 
<h2 style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>安装percona-xtrabackup</strong></span></strong></h2> 
<p></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><strong><span style="background-color:#ffffff;"><span style="color:#fe2c24;"><strong>查看mysql 版本</strong></span><span style="color:#0101fa;"><strong>：</strong></span></span></strong></span></p> 
<blockquote> 
 <p style="margin-left:0;text-align:left;"><strong>[<span style="color:#fe2c24;">root@root ~]# mysql -V <br> mysql  Ver 14.14 Distrib 5.7.44, for Linux (x86_64) using  EditLine wrapper<br> [root@root ~]# </span></strong></p> 
</blockquote> 
<p></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><strong><span style="background-color:#f5f5f5;"><span style="color:#0101fa;"><strong>安装与MySQL 5.7兼容的Percona XtraBackup版本。在你的情况下，MySQL版本是5.7.44，所以你应该安装Percona XtraBackup 2.4，因为这一版本与MySQL 5.7兼容。</strong></span></span></strong></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><strong><span style="background-color:#f5f5f5;"><span style="color:#0101fa;"><strong>MySQL </strong></span></span></strong></span><strong><span style="color:#0101fa;"><strong>8.0.32 对应版本：      </strong></span></strong><span style="background-color:#ffffff;"><strong><span style="background-color:#f5f5f5;"><span style="color:#0101fa;"><strong>Percona XtraBackup 8.0.32-x</strong></span></span></strong></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>[root@mysql-server ~]# vim /etc/yum.repos.d/Percona.repo </strong></span></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>[percona] </strong></span></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>name = CentOS $releasever - Percona </strong></span></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>baseurl=http://repo.percona.com/centos/$releasever/os/$basearch/ </strong></span></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>enabled = 1 </strong></span></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-percona </strong></span></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>gpgcheck = 1</strong></span></strong><strong><span style="color:#0101fa;"><strong>  改为0 不然还要去官网获取密钥太麻烦</strong></span></strong></p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#fe2c24;"><strong><strong>注:我的MySQL 5.7.44 是用yum安装的</strong></strong></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#fe2c24;"><strong><strong>推荐yum,二进制安装 ，切记不推荐编译，</strong></strong></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#fe2c24;"><strong><strong>会爆各种错，五花八门的</strong></strong></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#fe2c24;"><strong>MySQL物理备份主要有三种：完整备份、增量备份和差异备份。每种备份方式都有其独特的特点和适用场景。</strong></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<blockquote> 
 <h2 style="margin-left:.0001pt;text-align:justify;">完全备份 </h2> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>创建备份目录：</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root ~]#  mkdir /xtrabackup/bakwuli -p</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>备份之前，进入数据库，存入些数据</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root ~]# mysql -uroot -p'Password123$'</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>mysql&gt;  create database testbakwuli;</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>Query OK, 1 row affected (0.01 sec)</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>mysql&gt; use testbakwuli</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>Database changed</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>mysql&gt;  create table t1(id int);</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>Query OK, 0 rows affected (0.05 sec)</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>mysql&gt; exit</strong></strong></p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>备份：</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root ~]#  innobackupex --user=root --password='Password123$' /xtrabackup/bakwuli</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>。。。。。</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>。。。。。。</strong></strong></p> 
 <p></p> 
 <p><strong>40815 20:43:24 Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS...<br> xtrabackup: The latest check point (for incremental): '32452021'<br> xtrabackup: Stopping log copying thread.<br> .240815 20:43:24 &gt;&gt; log scanned up to (32452030)</strong></p> 
 <p><strong>240815 20:43:24 Executing UNLOCK TABLES<br> 240815 20:43:24 All tables unlocked<br> 240815 20:43:24 [00] Copying ib_buffer_pool to /xtrabackup/bakwuli/2024-08-15_20-43-21/ib_buffer_pool<br> 240815 20:43:24 [00]        ...done<br> 240815 20:43:24 Backup created in directory '/xtrabackup/bakwuli/2024-08-15_20-43-21/'<br> 240815 20:43:24 [00] Writing /xtrabackup/bakwuli/2024-08-15_20-43-21/backup-my.cnf<br> 240815 20:43:24 [00]        ...done<br> 240815 20:43:24 [00] Writing /xtrabackup/bakwuli/2024-08-15_20-43-21/xtrabackup_info<br> 240815 20:43:24 [00]        ...done<br> xtrabackup: Transaction log of lsn (32452021) to (32452030) was copied.<br> 240815 20:43:25 completed OK!</strong><br>  </p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>查看:</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root ~]# cd  /xtrabackup/bakwuli</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]# ls</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>2024-08-15_20-43-21</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]# </strong></strong></p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 style="text-align:justify;"><strong><strong><strong>完全备份恢复</strong></strong></strong></h2> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
</blockquote> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>1.关闭数据库：</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]# systemctl stop mysqld</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>清理环境</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]# rm -rf /var/lib/mysql/*</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]#  rm -rf /var/log/mysql-slow/slow.log</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>2.重演恢复:</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]#  innobackupex --apply-log /xtrabackup/bakwuli/2024-08-15_20-43-21</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;">。。。。。</p> 
 <p style="margin-left:.0001pt;text-align:justify;">。。。</p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong>g the file full; Please wait ...<br> InnoDB: File './ibtmp1' size is now 12 MB.<br> InnoDB: 96 redo rollback segment(s) found. 1 redo rollback segment(s) are active.<br> InnoDB: 32 non-redo rollback segment(s) are active.<br> InnoDB: 5.7.44 started; log sequence number 32452117<br> xtrabackup: starting shutdown with innodb_fast_shutdown = 1<br> InnoDB: FTS optimize thread exiting.<br> InnoDB: Starting shutdown...<br> InnoDB: Shutdown completed; log sequence number 32452136<br> 240815 20:50:01 completed OK!</strong><br>  </p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>注：恢复之前需要确认配置文件内有数据库指定目录，如下，不然会随机恢复数据到某个位置</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>很麻烦</strong></strong></p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#fe2c24;"><strong>vim /etc/my.cnf</strong></span></p> 
 <p style="margin-left:.0001pt;text-align:justify;">在命令行模式：</p> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#fe2c24;"><strong>/datadir=/var/lib/mysq</strong></span></p> 
 <p style="margin-left:.0001pt;text-align:justify;">查看里面是否有<span style="color:#fe2c24;"><strong><strong>datadir=/var/lib/mysql</strong></strong></span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[mysqld]</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>datadir=/var/lib/mysql</strong></strong></p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="325" src="https://images2.imgbox.com/4c/63/hiRwBRMt_o.png" width="517"></p> 
<p style="margin-left:.0001pt;text-align:justify;">：q</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 style="margin-left:.0001pt;text-align:justify;"><strong><strong>.恢复数据:</strong></strong></h3> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#fe2c24;"><strong>[root@root bakwuli]#  innobackupex --copy-back /xtrabackup/bakwuli/2024-08-15_20-43-21</strong></span><br><strong>。。。。。。</strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong>。。。。。。</strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong>b_buffer_pool<br> 240815 20:58:39 [01]        ...done<br> 240815 20:58:39 [01] Copying ./xtrabackup_info to /var/lib/mysql/xtrabackup_info<br> 240815 20:58:39 [01]        ...done<br> 240815 20:58:39 [01] Copying ./xtrabackup_master_key_id to /var/lib/mysql/xtrabackup_master_key_id<br> 240815 20:58:39 [01]        ...done<br> 240815 20:58:39 [01] Copying ./ibtmp1 to /var/lib/mysql/ibtmp1<br> 240815 20:58:39 [01]        ...done<br> 240815 20:58:39 completed OK!<br> [root@root bakwuli]# </strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>恢复完数据 重启失败，但是给他一个权限就能重启成功</strong></span></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]#  chown mysql.mysql  /var/lib/mysql  -R</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]#  systemctl start mysqld</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]# </strong></strong></p> 
</blockquote> 
<h3 style="margin-left:.0001pt;text-align:justify;"><strong>测试是否成功恢复数据</strong></h3> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[</strong>root@root bakwuli]#  mysql -uroot -p"Password123$"</strong></p> 
 <p><strong>mysql&gt; show databases;<br> +--------------------+<br> | Database           |<br> +--------------------+<br> | information_schema |<br> | mysql              |<br> | performance_schema |<br> | sys                |<br> | testbakwuli       |<br> | zabbix             |<br> +--------------------+<br> 7 rows in set (0.01 sec)</strong></p> 
 <p><strong>mysql&gt; use testbakwuli;<br> Reading table information for completion of table and column names<br> You can turn off this feature to get a quicker startup with -A</strong></p> 
 <p><strong>Database changed<br> mysql&gt; show tables;<br> +-----------------------+<br> | Tables_in_testbakwuli |<br> +-----------------------+<br> | t1                    |                              ————》》从这可看出刚刚删除的表，数据已恢复<br> +-----------------------+<br> 1 row in set (0.00 sec</strong>)</p> 
 <p><strong>mysql&gt; exit</strong></p> 
 <p><br><strong><strong>systemctl st</strong></strong><strong><strong>op</strong></strong><strong><strong> mysqld</strong></strong></p> 
</blockquote> 
<h2 style="margin-left:.0001pt;text-align:justify;">增量备份</h2> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#fe2c24;"><strong>增量备份 每次备份上一次备份到现在产生的新数据 <strong> 且基于前一天的备份为目录，</strong>在企业中增量备份通常与完备配合使用 比如1234567天  1用完备，2，3，4，5，6，7分别用增量 .</strong></span></p> 
<p></p> 
<p>刚刚已创建指定备份目录<span style="color:#fe2c24;"><strong>/xtrabackup/bakwuli/</strong></span>   和 测试用的数据库<strong><span style="color:#fe2c24;">testbakwuli</span> </strong> 数据表<strong><span style="color:#fe2c24;">t1</span></strong></p> 
<p><strong><span style="color:#fe2c24;">刚刚已经备份了第1天的完备 </span></strong></p> 
<h3><strong><span style="color:#fe2c24;">现在第2天，增备：</span></strong></h3> 
<p>在数据库中插入表值，<strong><span style="color:#fe2c24;"> 模拟第2天产生新数据</span></strong></p> 
<p></p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>mysql -uroot -p"Password123$"</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>mysql&gt;  insert into testbakwuli.t1 values(2);</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>Query OK, 1 row affected (0.01 sec)</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>mysql&gt; exit</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>systemctl st</strong></strong><strong><strong>op</strong></strong><strong><strong> mysqld</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong> </strong><span style="color:#fe2c24;"><strong>备份上一次备份到现在产生的新数据 <strong> 且基于第一天的备份为目录 </strong></strong></span></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]# innobackupex -uroot -p"Password123$" --incremental /xtrabackup/bakwuli/ --incremental-basedir=//xtrabackup/bakwuli/2024-08-15_20-43-21 </strong></strong><strong> </strong></p> 
 <p></p> 
</blockquote> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>[root@root bakwuli]# ls</strong></span></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>2024-08-15_20-43-21  2024-08-15_21-24-39</strong></span></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#0101fa;"><strong>[root@root bakwuli]# </strong></span></strong></p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h4 style="margin-left:0px;text-align:left;"><strong><span style="color:#fe2c24;"><strong>现在第</strong></span></strong><strong><span style="color:#fe2c24;"><strong>3</strong></span></strong><strong><span style="color:#fe2c24;"><strong>天，增备：</strong></span></strong></h4> 
<blockquote> 
 <p style="margin-left:0;text-align:left;">在数据库中插入表值，<strong><span style="color:#fe2c24;"><strong> 模拟第</strong></span></strong><strong><span style="color:#fe2c24;"><strong>3</strong></span></strong><strong><span style="color:#fe2c24;"><strong>天产生新数据</strong></span></strong></p> 
 <p style="margin-left:0;text-align:justify;"><strong><strong>mysql -uroot -p"Password123$"</strong></strong></p> 
 <p style="margin-left:0;text-align:justify;"><strong><strong>mysql&gt;  insert into testbakwuli.t1 values(</strong></strong><strong><strong>3</strong></strong><strong><strong>);</strong></strong></p> 
 <p style="margin-left:0;text-align:justify;"><strong><strong>Query OK, 1 row affected (0.01 sec)</strong></strong></p> 
 <p style="margin-left:0;text-align:justify;"><strong><strong>mysql&gt; exit</strong></strong></p> 
 <p style="margin-left:0;text-align:justify;"><strong><strong>[root@root bakwuli]# ls</strong></strong><strong><strong>  查看前两天的备份</strong></strong></p> 
 <p style="margin-left:0;text-align:justify;"><strong><strong>2024-08-15_20-43-21  2024-08-15_21-24-39</strong></strong><strong>   </strong></p> 
</blockquote> 
<p style="margin-left:0;text-align:justify;"><strong><span style="color:#fe2c24;"><strong># </strong></span></strong><strong><span style="color:#fe2c24;"><strong>备份上一次备份到现在产生的新数据  且</strong></span></strong><strong><span style="color:#fe2c24;"><strong>是</strong></span></strong><strong><span style="color:#fe2c24;"><strong>基于第</strong></span></strong><strong><span style="color:#fe2c24;"><strong>2</strong></span></strong><strong><span style="color:#fe2c24;"><strong>天的备份为目录 </strong></span></strong></p> 
<blockquote> 
 <p style="margin-left:0;text-align:justify;"><strong><strong>systemctl st</strong></strong><strong><strong>op</strong></strong><strong><strong> mysqld</strong></strong></p> 
 <p style="margin-left:0;text-align:justify;"></p> 
 <p style="margin-left:0;text-align:justify;"><strong><span style="color:#0101fa;"><strong>[root@root bakwuli]# innobackupex -uroot -p"Password123$" --incremental /xtrabackup/bakwuli/ --incremental-basedir=//xtrabackup/bakwuli/2024-08-15_21-24-39</strong></span></strong></p> 
 <p style="margin-left:0;text-align:justify;"><strong><span style="color:#fe2c24;"><strong>[root@root bakwuli]# ls</strong></span></strong></p> 
 <p style="margin-left:0;text-align:justify;"><strong><span style="color:#fe2c24;"><strong>2024-08-15_20-43-21  2024-08-15_21-24-39  2024-08-15_21-35-30</strong></span></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>  全备周一</strong></strong><strong><strong>（</strong></strong><strong><strong>第1天</strong></strong><strong><strong>      增量周二</strong></strong><strong><strong>（</strong></strong><strong><strong>第2天</strong></strong><strong><strong>      增量周三</strong></strong><strong><strong>（</strong></strong><strong><strong>第3天</strong></strong></p> 
</blockquote> 
<h2 style="margin-left:.0001pt;text-align:justify;">增量备份恢复</h2> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>1. 停止数据库</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>2. 清理环境</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>3. 依次重演回滚redo log－－&gt; 恢复数据</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>恢复完整备份。</strong></strong><strong><strong>依次应用所有增量备份。完成恢复过程。</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>将恢复的数据文件复制到 MySQL 数据目录</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>4. 修改权限</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>5. 启动数据库</strong></strong></p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;">测试：</p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]# ls</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>2024-08-15_20-43-21  2024-08-15_21-24-39  2024-08-15_21-35-30</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]#  systemctl stop mysqld</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]#  rm -rf /var/lib/mysql/*</strong></strong></p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>依次重演回滚redo log:</strong></strong><strong> </strong><strong><strong>恢复完整备份</strong></strong><strong> </strong><strong> </strong><strong><span style="color:#0101fa;"><strong>假设完整备份存储在</strong></span></strong><strong> </strong><strong><span style="color:#0101fa;"><strong>/xtrabackup/bakwuli/2024-08-15_20-43-21/</strong></span></strong><strong><span style="color:#0101fa;"><strong> 目录中。</strong></span></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]# innobackupex --apply-log --redo-only /xtrabackup/bakwuli/2024-08-15_20-43-21/</strong></strong></p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>回滚</strong></strong><strong><strong>周二</strong></strong><strong>         </strong><strong><strong>应用第一个增量</strong></strong><strong><strong> ：</strong></strong><strong><strong>备份</strong></strong><strong><strong>假设完整备份存储在</strong></strong><strong><span style="color:#0101fa;"><strong>/xtrabackup/bakwuli/2024-08-15_21-24-39</strong></span></strong><strong> </strong><strong><strong>目录中。</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]# innobackupex --apply-log --redo-only /xtrabackup/bakwuli/2024-08-15_20-43-21/ --incremental-dir=/xtrabackup/bakwuli/2024-08-15_21-24-39</strong></strong></p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>回滚周三</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]# innobackupex --apply-log --redo-only /xtrabackup/bakwuli/2024-08-15_21-24-39/ --incremental-dir=/xtrabackup/bakwuli/2024-08-15_21-35-30</strong></strong></p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong> 完成恢复</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>最后一步是完成恢复过程，这次不再使用 </strong></strong><strong><strong>--redo-only</strong></strong><strong><strong> 选项。</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]# innobackupex --apply-log /xtrabackup/bakwuli/2024-08-15_20-43-21/</strong></strong></p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>恢复数据到 MySQL 数据目录</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>将恢复的数据文件复制到 MySQL 数据目录中。确保 MySQL 服务已停止。</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@root bakwuli]# cp -r /xtrabackup/bakwuli/2024-08-15_20-43-21/* /var/lib/mysql/</strong></strong></p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>修改权限</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@mysql-server ~]# chown -R mysql.mysql /var/lib/mysql</strong></strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[root@mysql-server ~]# systemctl start mysqld</strong></strong></p> 
</blockquote> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong>查看是否恢复</strong></p> 
 <p style="margin-left:.0001pt;text-align:justify;"><strong><strong>[</strong>root@root bakwuli]#  mysql -uroot -p"Password123$"</strong></p> 
 <p></p> 
 <p><strong>mysql&gt; show databases;<br> +--------------------+<br> | Database           |<br> +--------------------+<br> | information_schema |<br> | mysql              |<br> | performance_schema |<br> | sys                |<br> | testbakwuli       |<br> | zabbix             |<br> +--------------------+<br> 7 rows in set (0.01 sec)</strong></p> 
 <p><strong>mysql&gt; use testbakwuli;<br> Reading table information for completion of table and column names<br> You can turn off this feature to get a quicker startup with -A</strong></p> 
 <p><strong>Database changed<br> mysql&gt; show tables;</strong></p> 
</blockquote> 
<h3><strong>关于<strong><strong>增量备份恢复过程 ，</strong></strong>报错解决</strong></h3> 
<p>InnoDB: Page [page id: space=0, page number=7] log sequence number 32452174 is in the future! Current system log sequence number 32452154.<br> InnoDB: Your database may be corrupt or you may have copied the InnoDB tablespace but not the InnoDB log files. Please refer to <a href="http://dev.mysql.com/doc/refman/5.7/en/forcing-innodb-recovery.html" rel="nofollow" title="MySQL :: MySQL 5.7 Reference Manual :: 14.22.2 Forcing InnoDB Recovery">MySQL :: MySQL 5.7 Reference Manual :: 14.22.2 Forcing InnoDB Recovery</a> for information about forcing recovery.</p> 
<p>xtrabackup: error: The transaction log file is corrupted.<br> xtrabackup: error: The log was not applied to the intended LSN!<br> xtrabackup: Log applied to lsn 32452145<br> xtrabackup: The intended lsn is 32452347</p> 
<p>具体的错误信息如下：</p> 
<ol><li> <p><strong>Page log sequence number is in the future</strong>：</p> <pre>Copy<code>InnoDB: Page [page id: space=0, page number=7] log sequence number 32452174 is in the future! Current system log sequence number 32452154.
</code></pre> <p>这意味着某个页面的日志序列号（LSN）比当前系统的日志序列号还要大，表明数据不一致。</p> </li><li> <p><strong>Transaction log file is corrupted</strong>：</p> <pre>Copy<code>xtrabackup: error: The transaction log file is corrupted.
xtrabackup: error: The log was not applied to the intended LSN!
xtrabackup: Log applied to lsn 32452145
xtrabackup: The intended lsn is 32452347
</code></pre> <p>这表示事务日志文件已损坏，日志应用到了错误的 LSN。</p> </li></ol> 
<p>这些错误可能是由于以下原因导致的：</p> 
<ul><li>备份过程中 InnoDB 表空间和日志文件没有同步复制。</li><li>数据库在备份时发生了写入操作，导致数据不一致。</li><li>硬件故障或文件系统错误导致文件损坏。</li></ul> 
<h4>解决方法</h4> 
<ol><li> <p><strong>强制恢复</strong>：<br> 可以尝试按照 MySQL 官方文档中的指导进行强制恢复。参考链接：<a href="http://dev.mysql.com/doc/refman/5.7/en/forcing-innodb-recovery.html" rel="nofollow" title="Forcing InnoDB Recovery">Forcing InnoDB Recovery</a></p> <p>在 <code>my.cnf</code> 文件中添加以下配置选项，然后重启 MySQL 服务：</p> <pre>Copy<code>[mysqld]
innodb_force_recovery = 1
</code></pre> <p>如果 <code>innodb_force_recovery = 1</code> 无法解决问题，可以尝试逐步增加值（最大为 <code>6</code>），但请注意，较高的值可能会导致数据丢失。</p> </li><li> <p><strong>检查和修复文件权限</strong>：<br> 确保 MySQL 服务器对所有 InnoDB 表空间和日志文件具有适当的读写权限。</p> </li><li> <p><strong>重新备份和恢复</strong>：<br> 如果可能的话，重新进行一个完整的备份，并确保备份过程没有中断或错误。</p> </li><li> <p><strong>检查硬件和文件系统</strong>：<br> 确保硬件和文件系统没有问题，检查磁盘是否有坏块，文件系统是否有错误。</p> </li><li> <p><strong>咨询专业支持</strong>：<br> 如果问题依然存在，考虑寻求专业的数据库支持服务，特别是如果这是一个生产环境。</p> </li></ol> 
<p></p> 
<h3>为了避免InnoDB数据库损坏和备份过程中的问题，以下是一些最佳实践和预防措施：</h3> 
<h4>1. 定期备份</h4> 
<ul><li><strong>频繁备份</strong>：定期进行全量和增量备份，确保在数据损坏时有可用的恢复点。</li><li><strong>验证备份</strong>：定期验证备份文件的完整性和可恢复性，确保备份文件没有损坏。</li></ul> 
<h4>2. 正确配置备份工具</h4> 
<ul><li><strong>使用最新版本</strong>：确保使用对应数据库版本的备份工具，如Percona XtraBackup，以获得最新的功能和修复。</li><li><strong>正确配置</strong>：确保备份工具的配置正确，包括备份路径、日志文件路径等。</li></ul> 
<h4>3. 数据库配置</h4> 
<ul><li><strong>启用双写缓冲区</strong>：在MySQL配置文件中启用InnoDB的双写缓冲区，以减少数据损坏的可能性。 <pre>Copy<code>[mysqld]
innodb_doublewrite = 1
</code></pre> </li><li><strong>适当的缓冲池大小</strong>：配置适当的InnoDB缓冲池大小，确保数据库性能和稳定性。 <pre>Copy<code>[mysqld]
innodb_buffer_pool_size = &lt;适当的大小&gt;
</code></pre> </li></ul> 
<h4>4. 数据库维护</h4> 
<ul><li><strong>定期检查和优化</strong>：定期运行<code>CHECK TABLE</code>和<code>OPTIMIZE TABLE</code>命令，确保表的一致性和性能。</li><li><strong>监控错误日志</strong>：定期检查MySQL错误日志，及时发现和解决潜在问题。</li></ul> 
<h4>5. 文件系统和硬件</h4> 
<ul><li><strong>选择可靠的文件系统</strong>：使用支持事务的文件系统，如EXT4或XFS，以减少文件系统层面的数据损坏。</li><li><strong>硬件监控</strong>：定期检查硬件状态，包括磁盘健康状况，确保硬件没有故障。</li></ul> 
<h4>6. 数据库操作</h4> 
<ul><li><strong>避免长时间运行的事务</strong>：避免长时间运行的事务，减少锁争用和潜在的数据不一致性。</li><li><strong>适当的事务隔离级别</strong>：根据业务需求设置适当的事务隔离级别，避免不必要的锁争用。</li></ul> 
<h4>7. 恢复测试</h4> 
<ul><li><strong>定期恢复测试</strong>：定期进行恢复测试，确保备份文件在实际恢复过程中可用。</li></ul> 
<h4>8. 业务高峰期备份</h4> 
<ul><li><strong>避开高峰期</strong>：尽量避开业务高峰期进行备份，减少备份过程中数据写入的冲突。</li></ul> 
<h4>9. 备份策略</h4> 
<ul><li><strong>多层次备份</strong>：结合全量备份、增量备份和日志备份，确保多层次的备份策略。</li><li><strong>异地备份</strong>：将备份文件存储在异地，防止本地灾难导致数据完全丢失。</li></ul> 
<h4>10. 监控和报警</h4> 
<ul><li><strong>设置监控和报警</strong>：使用监控工具（如Prometheus、Grafana）监控数据库和备份工具的运行状态，设置报警机制，及时发现和处理异常情况。</li></ul> 
<p><strong>通过以上措施，可以大大减少InnoDB数据库损坏和备份过程中的问题，确保数据的安全性和可靠性。</strong></p> 
<p></p> 
<h3>Binlog 备份概述</h3> 
<p><strong>MySQL 的二进制日志（binlog）记录了所有对数据库进行更改的语句（例如，INSERT、UPDATE、DELETE等）。通过备份和恢复 binlog，可以实现数据的增量恢复和灾难恢复。</strong></p> 
<h2><strong>Binlog 备份</strong></h2> 
<ol><li> <p><strong>启用 binlog<br> 确保在 MySQL 配置文件（<code>my.cnf</code> 或 <code>my.ini</code>）中启用了 binlog。</strong></p> <pre><strong>Copy<code>[mysqld]
log-bin=mysql-bin
server-id=1
</code></strong></pre> <p><strong>重启 MySQL 服务以使配置生效。</strong></p> <pre><strong>Copy<code>systemctl restart mysqld
</code></strong></pre> </li><li> <p><strong>查看 binlog 文件<br> 使用以下命令查看当前的 binlog 文件列表。</strong></p> <pre><strong>Copy<code>mysql -uroot -p"Password123$" -e "SHOW BINARY LOGS;"
</code></strong></pre> </li><li> <p><strong>备份 binlog 文件<br> 定期将 binlog 文件复制到安全的位置。例如，可以使用 <code>rsync</code> 或 <code>scp</code> 命令进行远程备份。</strong></p> <pre><strong>Copy<code>rsync -av /var/lib/mysql/mysql-bin.* /path/to/backup/
</code></strong></pre> </li></ol> 
<h4><strong>Binlog 恢复的步骤</strong></h4> 
<ol><li> <p><strong>恢复完整备份<br> 首先恢复最近的完整备份。假设完整备份存储在 <code>/xtrabackup/bakwuli/2024-08-15_20-43-21/</code> 目录中。</strong></p> <pre><strong>Copy<code>innobackupex --apply-log /xtrabackup/bakwuli/2024-08-15_20-43-21/
cp -r /xtrabackup/bakwuli/2024-08-15_20-43-21/* /var/lib/mysql/
chown -R mysql:mysql /var/lib/mysql
systemctl start mysqld
</code></strong></pre> </li><li> <p><strong>恢复 binlog 文件<br> 使用 <code>mysqlbinlog</code> 工具将 binlog 文件应用到数据库中。</strong></p> <pre><strong>Copy<code>mysqlbinlog /path/to/backup/mysql-bin.000001 /path/to/backup/mysql-bin.000002 | mysql -uroot -p"Password123$"
</code></strong></pre> <p><strong>如果需要应用特定的时间点，可以使用 <code>--start-datetime</code> 和 <code>--stop-datetime</code> 选项。</strong></p> <pre><strong>Copy<code>mysqlbinlog --start-datetime="2024-08-16 00:00:00" --stop-datetime="2024-08-16 23:59:59" /path/to/backup/mysql-bin.000001 | mysql -uroot -p"Password123$"
</code></strong></pre> </li></ol> 
<h4><strong>总结</strong></h4> 
<p><strong>通过 binlog 备份和恢复，可以实现 MySQL 数据库的增量恢复。这种方法特别适用于需要将数据库恢复到特定时间点的场景。结合完整备份和增量备份，binlog 备份提供了一种灵活且高效的数据恢复方案</strong></p> 
<p></p> 
<h3><strong>差异备份概述</strong></h3> 
<p><strong>差异备份是备份自上次完整备份以来发生变化的数据。与增量备份不同，差异备份每次都基于上一次的完整备份，而不是基于上一次的增量备份。因此，恢复过程只需要恢复完整备份和最后一个差异备份。</strong></p> 
<h2 style="background-color:transparent;"></h2> 
<h2 style="background-color:transparent;"><strong>差异备份</strong></h2> 
<p></p> 
<h2><strong><span style="color:#fe2c24;">注意，通常 完备增备，日志（binlog)备，结合使用 差异则根据具体情况选用</span>。</strong></h2> 
<p><strong>假设我已经完成了第1天的完整备份，现在将进行第2天和第3天的差异备份。</strong></p> 
<h5><strong>第1天：完整备份</strong></h5> 
<p><strong>假设完备（完整备份）已经完成，存储在 <code>/xtrabackup/bakwuli/2024-08-15_20-43-21/</code> 目录中。</strong></p> 
<h5><strong>第2天：差异备份</strong></h5> 
<ol><li> <p><strong>插入新数据</strong></p> <pre><strong>Copy<code>mysql -uroot -p"Password123$"
mysql&gt; insert into testbakwuli.t1 values(2);
Query OK, 1 row affected (0.01 sec)
mysql&gt; exit
</code></strong></pre> </li><li> <p><strong>停止 MySQL 服务</strong></p> <pre><strong>Copy<code>systemctl stop mysqld
</code></strong></pre> </li><li> <p><strong>执行差异备份</strong></p> <pre><strong>Copy<code>innobackupex -uroot -p"Password123$" --incremental /xtrabackup/bakwuli/ --incremental-basedir=/xtrabackup/bakwuli/2024-08-15_20-43-21
</code></strong></pre> </li><li> <p><strong>查看备份目录</strong></p> <pre><strong>Copy<code>ls /xtrabackup/bakwuli/
</code></strong></pre> <p><strong>输出应类似：</strong></p> <pre><strong>Copy<code>2024-08-15_20-43-21  2024-08-16_21-24-39
</code></strong></pre> </li></ol> 
<h5><strong>第3天：差异备份</strong></h5> 
<ol><li> <p><strong>插入新数据</strong></p> <pre><strong>Copy<code>mysql -uroot -p"Password123$"
mysql&gt; insert into testbakwuli.t1 values(3);
Query OK, 1 row affected (0.01 sec)
mysql&gt; exit
</code></strong></pre> </li><li> <p><strong>停止 MySQL 服务</strong></p> <pre><strong>Copy<code>systemctl stop mysqld
</code></strong></pre> </li><li> <p><strong>执行差异备份</strong></p> <pre><strong>Copy<code>innobackupex -uroot -p"Password123$" --incremental /xtrabackup/bakwuli/ --incremental-basedir=/xtrabackup/bakwuli/2024-08-15_20-43-21
</code></strong></pre> </li><li> <p><strong>查看备份目录</strong></p> <pre><strong>Copy<code>ls /xtrabackup/bakwuli/
</code></strong></pre> <p><strong>输出应类似：</strong></p> <pre><strong>Copy<code>2024-08-15_20-43-21  2024-08-16_21-24-39  2024-08-17_21-35-30
</code></strong></pre> </li></ol> 
<h4><strong>差异备份的恢复</strong></h4> 
<ol><li> <p><strong>停止 MySQL 服务</strong></p> <pre><strong>Copy<code>systemctl stop mysqld
</code></strong></pre> </li><li> <p><strong>清理 MySQL 数据目录</strong></p> <pre><strong>Copy<code>rm -rf /var/lib/mysql/*
</code></strong></pre> </li><li> <p><strong>恢复完整备份</strong></p> <pre><strong>Copy<code>innobackupex --apply-log --redo-only /xtrabackup/bakwuli/2024-08-15_20-43-21/
</code></strong></pre> </li><li> <p><strong>应用第一个差异备份</strong></p> <pre><strong>Copy<code>innobackupex --apply-log --redo-only /xtrabackup/bakwuli/2024-08-15_20-43-21/ --incremental-dir=/xtrabackup/bakwuli/2024-08-16_21-24-39/
</code></strong></pre> </li><li> <p><strong>应用第二个差异备份</strong></p> <pre><strong>Copy<code>innobackupex --apply-log /xtrabackup/bakwuli/2024-08-15_20-43-21/ --incremental-dir=/xtrabackup/bakwuli/2024-08-17_21-35-30/
</code></strong></pre> </li><li> <p><strong>将恢复的数据文件复制到 MySQL 数据目录</strong></p> <pre><strong>Copy<code>cp -r /xtrabackup/bakwuli/2024-08-15_20-43-21/* /var/lib/mysql/
</code></strong></pre> </li><li> <p><strong>修改权限</strong></p> <pre><strong>Copy<code>chown -R mysql:mysql /var/lib/mysql
</code></strong></pre> </li><li> <p><strong>启动 MySQL 服务</strong></p> <pre><strong>Copy<code>systemctl start mysqld
</code></strong></pre> </li></ol> 
<h4><strong>总结</strong></h4> 
<p><strong>差异备份的恢复过程相对简单，只需要恢复完整备份和最后一个差异备份。相比增量备份，差异备份的恢复速度更快，因为不需要依次应用所有增量备份。选择哪种备份方式应根据具体的需求和场景来决定。</strong></p> 
<p></p> 
<p></p> 
<p>待补充，，，，</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ccfc7250b71145e56e847584ea1cb993/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vue自我总结面试</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/df952db57d39d6284af1e78ca1285903/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【机器学习】探索数据矿藏：Python中的AI大模型与数据挖掘创新实践</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>