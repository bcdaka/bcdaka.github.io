<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringCloud-搭建Nacos配置中心 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/451c62ce083100cc8fe62c8abeec8471/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="SpringCloud-搭建Nacos配置中心">
  <meta property="og:description" content="一、Nacos 功能介绍 Nacos（Dynamic Naming and Configuration Service）是阿里巴巴开源的一个分布式服务注册、配置管理，以及服务健康管理平台。在微服务架构中，配置管理是至关重要的一环，Nacos 提供了可靠、动态的配置管理功能，为分布式系统的配置中心提供了便捷的解决方案。
Nacos的主要功能图：
Nacos 除了可以作为服务的注册中心，同样可以作为集中管理配置信息的配置中心来使用。我们通过在 Nacos 的控制台中对配置信息进行修改，可以直接作用到应用，避免应用的重新发布，这个过程叫配置的热更新。
下面我们就来一步一步介绍如何在 Spring Cloud 微服务项目里搭建 Nacos 配置中心。
二、安装 Nacos Nacos的安装相对简单，首先需要从官方网站下载最新版本的Nacos Server压缩包。解压后，通过执行相应的启动脚本，即可启动Nacos服务。在启动过程中，可以通过修改配置文件来配置Nacos的各项参数，例如数据库配置、端口号等。
可以参考我之前写过的这篇文章：SpringCloud-搭建Nacos服务中心
三、项目引入 Nacos 首先我们准备好或者创建一个微服务项目，如果不会创建，可以参考：
SpringCloud-创建多模块项目
项目准备好之后，我们引入 Nacos，引入注册中心的流程可以参考下面的文章：
SpringCloud-项目引入Nacos
这次，由于我们需要使用到 Nacos 配置管理的功能，所以每个服务模块的 pom.xml 里还需要引入用于 Nacos 配置管理的 jar 包：
&lt;!-- Maven 依赖 --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt; &lt;/dependency&gt; 四、Nacos控制台新建配置 我们访问 Nacos 的控制台页面，Nacos 控制台默认地址是 localhost:8848/nacos，创建配置：
配置起名为：springcloud-provider.yaml，类型选为 YAML 类型，配置内容我们写一个时间格式：
pattern: dateformat: yyyy-MM-dd HH:mm:ss 其他内容我们先不写，Namespace 用于指定命名空间来实现环境隔离，Namespace 是最外层的环境，向内依次是 Group 和服务。
点击发布，可以看到这条配置已经显示在控制台了。
创建配置成功，接着，我们要去实现项目读取 Nacos 上的配置。 五、微服务项目读取配置 1、创建bootstrap.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-16T04:51:23+08:00">
    <meta property="article:modified_time" content="2024-02-16T04:51:23+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringCloud-搭建Nacos配置中心</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、Nacos 功能介绍</h2> 
<p>Nacos（Dynamic Naming and Configuration Service）是阿里巴巴开源的一个分布式服务注册、配置管理，以及服务健康管理平台。在微服务架构中，配置管理是至关重要的一环，Nacos 提供了可靠、动态的配置管理功能，为分布式系统的配置中心提供了便捷的解决方案。</p> 
<p>Nacos的主要功能图：</p> 
<p><img alt="" height="400" src="https://images2.imgbox.com/d7/c9/odQjdnXv_o.png" width="406"></p> 
<p>Nacos 除了可以作为服务的注册中心，同样可以作为集中管理配置信息的配置中心来使用。我们通过在 Nacos 的控制台中对配置信息进行修改，可以直接作用到应用，避免应用的重新发布，这个过程叫配置的热更新。</p> 
<p>下面我们就来一步一步介绍如何在 Spring Cloud 微服务项目里搭建 Nacos 配置中心。</p> 
<hr> 
<h2>二、安装 Nacos</h2> 
<p>Nacos的安装相对简单，首先需要从官方网站下载最新版本的Nacos Server压缩包。解压后，通过执行相应的启动脚本，即可启动Nacos服务。在启动过程中，可以通过修改配置文件来配置Nacos的各项参数，例如数据库配置、端口号等。</p> 
<p>可以参考我之前写过的这篇文章：<a class="link-info" href="https://damon.blog.csdn.net/article/details/136048719" rel="nofollow" title="SpringCloud-搭建Nacos服务中心">SpringCloud-搭建Nacos服务中心</a></p> 
<hr> 
<h2>三、项目引入 Nacos</h2> 
<p>首先我们准备好或者创建一个微服务项目，如果不会创建，可以参考：</p> 
<p><a class="link-info" href="https://damon.blog.csdn.net/article/details/136062885" rel="nofollow" title="SpringCloud-创建多模块项目">SpringCloud-创建多模块项目</a></p> 
<p>项目准备好之后，我们引入 Nacos，引入注册中心的流程可以参考下面的文章：</p> 
<p><a class="link-info" href="https://damon.blog.csdn.net/article/details/136100779" rel="nofollow" title="SpringCloud-项目引入Nacos">SpringCloud-项目引入Nacos</a></p> 
<p>这次，由于我们需要使用到 Nacos 配置管理的功能，所以每个服务模块的 pom.xml 里还需要引入用于 Nacos 配置管理的 jar 包：</p> 
<pre><code class="language-XML">&lt;!-- Maven 依赖 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre> 
<p><img alt="" height="634" src="https://images2.imgbox.com/97/03/OA2MkVlT_o.png" width="1179"></p> 
<hr> 
<h2>四、Nacos控制台新建配置</h2> 
<p>我们访问 Nacos 的控制台页面，Nacos 控制台默认地址是 localhost:8848/nacos，创建配置：</p> 
<p><img alt="" height="537" src="https://images2.imgbox.com/74/13/cTlKmCJf_o.png" width="831"></p> 
<p>配置起名为：springcloud-provider.yaml，类型选为 YAML 类型，配置内容我们写一个时间格式：</p> 
<pre><code class="language-XML">pattern:
    dateformat: yyyy-MM-dd HH:mm:ss</code></pre> 
<p>其他内容我们先不写，Namespace 用于指定命名空间来实现环境隔离，Namespace 是最外层的环境，向内依次是 Group 和服务。</p> 
<p><img alt="" height="505" src="https://images2.imgbox.com/79/af/mRvnFVIM_o.png" width="841"></p> 
<p>点击发布，可以看到这条配置已经显示在控制台了。</p> 
<p>创建配置成功，接着，我们要去实现项目读取 Nacos 上的配置。 </p> 
<hr> 
<h2>五、微服务项目读取配置</h2> 
<h3>1、创建bootstrap.yml文件</h3> 
<p>在 /resource 文件夹下创建 bootstrap.yml 文件，和原先的 application.yml 配置文件平级，并将原先配置文件中的 nacos 配置的部分移动到优先级更高的文件 bootstrap.yml 里。</p> 
<p>bootstrap.yml：</p> 
<pre><code class="language-XML">server:
  #程序端口号
  port: 8083
spring:
  application:
    name: springcloud-provider
  profiles:
    active: dev
  cloud:
    nacos:
      config:
        file-extension: yaml
        username: nacos
        password: nacos
        server-addr: 127.0.0.1:8848
      discovery:
        server-addr: 127.0.0.1:8848</code></pre> 
<p><img alt="" height="567" src="https://images2.imgbox.com/ff/21/STQUtQcY_o.png" width="852"></p> 
<p>原先的 application.yml 变成：</p> 
<pre><code class="language-XML">management:
  endpoints:
    web:
      exposure:
        #公开所有端点
        include: '*'</code></pre> 
<p><img alt="" height="522" src="https://images2.imgbox.com/0d/94/DqQqbf0S_o.png" width="835"></p> 
<hr> 
<h3 style="background-color:transparent;">2、增加bootstrap.yml的读取依赖</h3> 
<p>每个想要进行 Nacos 配置管理的服务模块，不仅需要创建 bootstrap.yml 文件，还需要引入能够在项目启动时自动发现并加载 bootstrap.yml 文件的依赖，在 pom.xml 里添加：</p> 
<pre><code class="language-XML">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;
    &lt;version&gt;3.0.1&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<p><img alt="" height="383" src="https://images2.imgbox.com/6e/45/cL2WmpAo_o.png" width="1101"></p> 
<p>这样在在项目启动时，bootstrap.yml 文件就可以自动被发现并加载了。</p> 
<hr> 
<h3 style="background-color:transparent;">3、编写读取配置信息的接口</h3> 
<p>在 Spring Cloud 项目中，我们可以通过注入 @Value 注解来读取 Nacos 中的配置信息。</p> 
<p>创建 ConfigController 类：</p> 
<pre><code class="language-java">package com.example.springcloudprovider.demos.web;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.cloud.context.config.annotation.RefreshScope;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/config")
@RefreshScope
public class ConfigController {

    @Value("${pattern.dateformat}")
    private String dateformat;

    @GetMapping("dateformat")
    public String now(){
        return dateformat;
    }

}
</code></pre> 
<p><img alt="" height="558" src="https://images2.imgbox.com/95/ea/SZ9kbcw6_o.png" width="1063"></p> 
<hr> 
<h3>4、测试读取配置信息</h3> 
<p>启动项目，访问测试接口：localhost:8083/config/dateformat</p> 
<p><img alt="" height="286" src="https://images2.imgbox.com/70/0b/Z2kQ0pf6_o.png" width="517"></p> 
<p>可以看到我们在 Nacos 上配置的日期格式已经被加载到项目里了。</p> 
<hr> 
<h2>六、测试Nacos对配置热更新</h2> 
<h3>1、修改Nacos上配置内容</h3> 
<p>我们在 Nacos 控制台里修改配置，将 dateformat 改为 yyyy-MM-dd HH:mm:ssss</p> 
<p><img alt="" height="521" src="https://images2.imgbox.com/a4/09/qcnIMNAk_o.png" width="854"></p> 
<hr> 
<h3>2、查看项目内配置是否更新</h3> 
<p>再次访问测试接口：localhost:8083/config/dateformat</p> 
<p><img alt="" height="305" src="https://images2.imgbox.com/0c/08/53wHrDSp_o.png" width="481"></p> 
<p>可以看到我们的项目配置已经被热更新了，即配置实时更新，不需要重新启动或部署项目。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d32b23ef2997aa4b38e5225ab00b744c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">前端秘法进阶篇之事件循环</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a8e5d3d339fa48a15950729d5ee6adac/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Mysql——update更新数据的方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>