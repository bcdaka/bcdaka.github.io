<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ElasticSearch 8.x 安装及集群搭建 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/113426933d710c6d79b3774ebd4e3468/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="ElasticSearch 8.x 安装及集群搭建">
  <meta property="og:description" content="网上查询了一下Elasticsearch，这里终结一下，仅供参考。
Elasticsearch简介 Elasticsearch，简称为ES。 ES是一个开源的高扩展的分布式全文检索引擎，它可以近乎实时的存储、检索数据。
Elasticsearch是面向文档的一种数据库，这意味着其不再需要行列式的表格字段约束。
ES会存储整个构造好的数据或文档，然而不仅仅是储存数据，这使得文档中每个数据可以被标识，进而可以被检索。在ES中，执行index，search，sort或过滤文档等操作都不是传统意义上的行列式的数据。
ES从根本上对数据的不同思考方式也正是他能应对复杂数据结构的全文检索的原因之一。
ES优势 引擎（搜索引擎） Solr查询快，但更新索引时慢、插入删除慢Elasticsearch建立索引快、查询慢 Elasticsearch VS 数据库 模糊查询
数据库的select * from user where name like &#39;xxx&#39;：
1. 不走索引，数据库量很大时，查询慢。2. 往往会返回大量的数据。3.用户输入的内容可能并不准确。 mysql中like进行模糊查询时，如果用前导模糊查询&#34;%程序控&#34;则不会走索引，如果用非前导模糊查询&#34;程序控%&#34;则会走索引。
=》
正排索引存储会以ID作为索引，来查询相应的数据。如果数据量很大，则会导致经常性的全表扫描。
=》
Elasticsearch优势： 倒排索引。
模糊搜索速度很快： 写入数据到Elasticsearch的时候会进行分词。搜索到的数据可以根据评分排序，过滤掉大部分的内容。能匹配有相关性的记录，没有那么准确的关键字也能搜出相关的结果。 结果排序
搜索引擎肯定是根据用户搜索得出最符合用户搜索条件的放在最前面，这一点数据库是无法支持的，es中会根据搜索的数据的评分进行排序，越符合条件评分越高，原生支持这一点。
正向索引 VS 倒排索引
正向索引：书的章节目录就是正向索引，通过章节名称就找到对应的页码。正排索引存储会以ID作为索引，来查询相应的数据。如果数据量很大，则会导致经常性的全表扫描。倒排索引：先对目录分词，对待查找的词找到对应记录。 以字或词为关键字进行索引，表中关键字所对应的记录表项记录了出现这个字或词的所有文档，一个表项就是一个字表段，它记录该文档的ID和字符在该文档中出现的位置情况。
由于每个字或词对应的文档数量在动态变化，所以倒排表的建立和维护都较为复杂，但是在查询的时候由于可以一次得到查询关键字所对应的所有文档，所以效率高于正排表。在全文检索中，检索的快速响应是一个最为关键的性能，而索引建立由于在后台进行，尽管效率相对低一些，但不会影响整个搜索引擎的效率
架构优势
分布式实时文件存储，可将每一个字段存入索引，使其可以被检索到。实时分析的分布式搜索引擎。 分布式：索引分拆成多个分片，每个分片可有零个或多个副本。集群中的每个数据节点都可承载一个或多个分片，并且协调和处理各种操作；
负载再平衡和路由在大多数情况下自动完成。
可以扩展到上百台服务器，处理PB级别的结构化或非结构化数据。也可以运行在单台PC上（已测试）。
支持插件机制，分词插件、同步插件、Hadoop插件、可视化插件等。
为什么可以实现快速的“模糊匹配”/“相关性查询”？ =》分词 &#43; 倒排索引
一.单个节点安装及配置 在所有节点上安装elasticsearch及插件
1.下载elasticsearch二进制包 下载地址:https://www.elastic.co/cn/downloads/elasticsearch
国内下载地址(elasticsearch中文社区下载地址)：下载中心 - Elastic 中文社区
系统：根据自己的操作系统选择系统对应的包版本：根据自己的需要选择对应的版本 2.解压安装 这里以linux系统为例：
tar -zxvf elasticsearch-8.5.1-linux-x86_64.tar.gzmv elasticsearch-8.5.1-linux-x86_64 /opt/elasticsearch 3.建立管理elasticsearch服务的用户 useradd elasticchown -R elastic:elastic /opt/elasticsearch 4.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-10-17T18:30:19+08:00">
    <meta property="article:modified_time" content="2023-10-17T18:30:19+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ElasticSearch 8.x 安装及集群搭建</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="color:#fe2c24;">网上查询了一下Elasticsearch，这里终结一下，仅供参考。</span></p> 
<h2>Elasticsearch简介</h2> 
<p>        Elasticsearch，简称为ES。 ES是一个开源的高扩展的分布式全文检索引擎，它可以近乎实时的存储、检索数据。</p> 
<p>        Elasticsearch是面向文档的一种数据库，这意味着其不再需要行列式的表格字段约束。</p> 
<p>        ES会存储整个构造好的数据或文档，然而不仅仅是储存数据，这使得文档中每个数据可以被标识，进而可以被检索。在ES中，执行index，search，sort或过滤文档等操作都不是传统意义上的行列式的数据。</p> 
<p>        ES从根本上对数据的不同思考方式也正是他能应对复杂数据结构的全文检索的原因之一。</p> 
<p></p> 
<h2>ES优势</h2> 
<h3>引擎（搜索引擎）</h3> 
<ol><li>Solr查询快，但更新索引时慢、插入删除慢</li><li>Elasticsearch建立索引快、查询慢</li></ol> 
<h3>Elasticsearch VS 数据库</h3> 
<p>模糊查询</p> 
<p>数据库的select * from user where name like 'xxx'：</p> 
<ul><li>1. 不走索引，数据库量很大时，查询慢。</li><li>2. 往往会返回大量的数据。</li><li>3.用户输入的内容可能并不准确。</li></ul> 
<p>mysql中like进行模糊查询时，如果用前导模糊查询"%程序控"则不会走索引，如果用非前导模糊查询"程序控%"则会走索引。<br> =》<br> 正排索引存储会以ID作为索引，来查询相应的数据。如果数据量很大，则会导致经常性的全表扫描。<br> =》</p> 
<h4>Elasticsearch优势：</h4> 
<p>倒排索引。</p> 
<ol><li>模糊搜索速度很快： 写入数据到Elasticsearch的时候会进行分词。</li><li>搜索到的数据可以根据评分排序，过滤掉大部分的内容。</li><li>能匹配有相关性的记录，没有那么准确的关键字也能搜出相关的结果。</li></ol> 
<p><strong>结果排序</strong></p> 
<p>        搜索引擎肯定是根据用户搜索得出最符合用户搜索条件的放在最前面，这一点数据库是无法支持的，es中会根据搜索的数据的评分进行排序，越符合条件评分越高，原生支持这一点。</p> 
<p><strong>正向索引 VS 倒排索引</strong></p> 
<ul><li>正向索引：书的章节目录就是正向索引，通过章节名称就找到对应的页码。</li><li>正排索引存储会以ID作为索引，来查询相应的数据。如果数据量很大，则会导致经常性的全表扫描。</li><li>倒排索引：先对目录分词，对待查找的词找到对应记录。</li></ul> 
<p>        以字或词为关键字进行索引，表中关键字所对应的记录表项记录了出现这个字或词的所有文档，一个表项就是一个字表段，它记录该文档的ID和字符在该文档中出现的位置情况。<br>         由于每个字或词对应的文档数量在动态变化，所以倒排表的建立和维护都较为复杂，但是在查询的时候由于可以一次得到查询关键字所对应的所有文档，所以效率高于正排表。在全文检索中，检索的快速响应是一个最为关键的性能，而索引建立由于在后台进行，尽管效率相对低一些，但不会影响整个搜索引擎的效率</p> 
<p><strong>架构优势</strong></p> 
<ul><li>分布式实时文件存储，可将每一个字段存入索引，使其可以被检索到。</li><li>实时分析的分布式搜索引擎。</li></ul> 
<p>分布式：索引分拆成多个分片，每个分片可有零个或多个副本。集群中的每个数据节点都可承载一个或多个分片，并且协调和处理各种操作；<br> 负载再平衡和路由在大多数情况下自动完成。<br> 可以扩展到上百台服务器，处理PB级别的结构化或非结构化数据。也可以运行在单台PC上（已测试）。<br> 支持插件机制，分词插件、同步插件、Hadoop插件、可视化插件等。</p> 
<p><strong>为什么可以实现快速的“模糊匹配”/“相关性查询”？ =》分词 + 倒排索引</strong><br>  </p> 
<p></p> 
<h2 id="h4--">一.单个节点安装及配置</h2> 
<p>在所有节点上安装elasticsearch及插件</p> 
<h3 id="h5-1-elasticsearch-"><a name="1.%E4%B8%8B%E8%BD%BDelasticsearch%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8C%85"></a>1.下载elasticsearch二进制包</h3> 
<p>下载地址:<a href="https://www.elastic.co/cn/downloads/elasticsearch" rel="nofollow" title="https://www.elastic.co/cn/downloads/elasticsearch">https://www.elastic.co/cn/downloads/elasticsearch</a></p> 
<p>国内下载地址(elasticsearch中文社区下载地址)：<a href="https://elasticsearch.cn/download/" rel="nofollow" title="下载中心 - Elastic 中文社区">下载中心 - Elastic 中文社区</a></p> 
<ul><li>系统：根据自己的操作系统选择系统对应的包</li><li>版本：根据自己的需要选择对应的版本</li></ul> 
<h3 id="h5-2-"><a name="2.%E8%A7%A3%E5%8E%8B%E5%AE%89%E8%A3%85"></a>2.解压安装</h3> 
<p>这里以linux系统为例：</p> 
<ol><li><code>tar -zxvf elasticsearch-8.5.1-linux-x86_64.tar.gz</code></li><li><code>mv elasticsearch-8.5.1-linux-x86_64 /opt/elasticsearch</code></li></ol> 
<h3 id="h5-3-elasticsearch-"><a name="3.%E5%BB%BA%E7%AB%8B%E7%AE%A1%E7%90%86elasticsearch%E6%9C%8D%E5%8A%A1%E7%9A%84%E7%94%A8%E6%88%B7"></a>3.建立管理elasticsearch服务的用户</h3> 
<ol><li><code>useradd elastic</code></li><li><code>chown -R elastic:elastic /opt/elasticsearch</code></li></ol> 
<h3 id="h5-4-elasticsearch"><a name="4.%E9%85%8D%E7%BD%AEelasticsearch"></a>4.配置elasticsearch</h3> 
<ul><li><code>elasticsearch.yml</code> : elasticsearch服务相关的配置</li><li><code>jvm.options</code> : elasticsearch的JAVA虚拟机相关的配置</li></ul> 
<h4 id="h6--1-elasticsearch-"><a name="(1)elasticsearch%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%A0%B8%E5%BF%83%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"></a>(1)elasticsearch主配置核心参数配置</h4> 
<pre><code>cluster.name: search-center
node.name: node-200


path.data: /home/elastic/data
path.logs: /var/log/elasticsearch

bootstrap.memory_lock: true

network.host: 192.168.0.200
http.port: 9200
discovery.seed_hosts: ["192.168.0.200:9300", "192.168.0.201:9300","192.168.0.202:9300"]
cluster.initial_master_nodes: ["node-200", "node-201","node-202"]


gateway.recover_after_nodes: 3</code></pre> 
<ul><li><code>cluster.name</code>: 集群名称，具有相同集群名称的节点可以组成一个集群</li><li><code>node.name</code> : 节点名称</li><li><code>node.master</code> : 当前节点是否设置为主节点(候选节点)</li><li><code>node.data</code> : 当前节点是否为数据节点</li><li><code>node.ingest</code> : 当前节点是否为预处理任务节点</li><li><code>node.ml</code> : 当前节点是否为机器学习节点</li></ul> 
<p>注：如果节点不是master节点，也不是data节点，也不是ingest节点，也不是ml节点，那么它只能是协调节点(coordinating node)，只用于转发请求，不处理实际数据</p> 
<ul><li><code>path.data</code> : 数据文件存储路径</li><li><code>path.logs</code> : 日志文件存储路径</li><li><code>bootstrap.memory_lock</code> : 启动时是否锁定内存</li><li><code>network.host</code> : 绑定的主机名或地址(如设置为服务器的内网地址，可供网络访问，如果设置为127.0.0.1那只能本地访问)</li><li><code>http.port</code> : 对外提供的http访问端口(默认为9200)</li><li><code>transport.port</code>: 用于集群中与其他节点通信的端口(默认为9300)</li><li><code>discovery.seed_hosts</code> : 集群的节点地址列表(以7.2有以下的低版本为discovery.zen.ping.unicast.hosts)</li><li><code>cluster.initial_master_nodes</code> : 集群初始化时主节点的侯选节点列表(即可参与主节点选举的节点列表)</li></ul> 
<p>注：discovery.seed_hosts是一个数组，每个数组项为节点的IP地址(也可以是IP:port的形式，其中port为集群通信的端口，一般为9300)</p> 
<h4 id="h6--2-jvm-"><a name="(2)JVM%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"></a>(2)JVM参数配置</h4> 
<ol><li><code>-Xms 4G</code></li><li><code>-Xmx 4G</code></li></ol> 
<ul><li><code>-Xms</code> : JVM堆内存最小大小，如 <code>-Xms2g</code>(单个节点最大堆内存不要超过32G)</li><li><code>-Xmx</code> : JVM堆内存最大小，如<code>-Xmx2g</code>(单个节点最大堆内存不要超过32G)</li><li><code>-XX:+UseG1GC</code> : 使用G1垃圾回收器</li><li><code>-Djava.io.tmpdir</code> : JVM临时文件目录</li><li><code>-XX:+HeapDumpOnOutOfMemoryError</code>: 当分配内存空间失败时生成dump文件</li><li><code>-XX:HeapDumpPath</code> : dump文件存储位置</li><li><code>-XX:ErrorFile</code> : 存储JVM严重错误文件地址</li></ul> 
<p>注：</p> 
<ul><li> <p>这和java应用项目的jvm配置类似，配置的堆内存最好不要超宿主机内存的1/2，因宿主机操作系统也需要相应的运行内存</p> </li><li> <p>官方建议最大堆内存不要超过32G，一般建议最大为31G</p> </li></ul> 
<h4 id="h6--3-"><a name="(3)%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"></a>(3)操作系统相关配置</h4> 
<p>elasticsearch是运行于操作系统这个大容器中，因此系统中对资源的一些限制会对elasticsearch服务有重要的影响</p> 
<p><strong><em>A 资源限制：ulimit</em></strong></p> 
<p>作用：资源限制 (如文件描述述最大数量等)</p> 
<ul><li>临时修改：</li></ul> 
<ol><li><code>ulimit -n 65535 -u 4096</code></li></ol> 
<ul><li>永久修改：修改<code>/etc/security/limits.conf</code></li></ul> 
<ol><li><code># &lt;domain&gt; &lt;type&gt; &lt;item&gt; &lt;value&gt; </code></li><li><code>* hard nofile 65535</code></li><li><code>* soft nofile 65535</code></li><li><code>* hard nproc 4096</code></li><li><code>* soft nproc 4096</code></li></ol> 
<table><thead><tr><th>列编号</th><th>列标识</th><th>含义</th><th>备选项</th></tr></thead><tbody><tr><td>第1列</td><td>domain</td><td>被限制的对象</td><td>用户名 : 对某个用户限制<br> 用户组名: 对某个用户组限制<br> * : 对所有用户都限制</td></tr><tr><td>第2列</td><td>type</td><td>限制的类型</td><td>soft : 软限制(超过限制会有警告)<br> hard : 硬性限制(不能超过的限制)</td></tr><tr><td>第3列</td><td>item</td><td>被限制的资源</td><td>core : 程序运行出现段错误生成的coredump文件最大大小 (KB)<br> data:最大数据大小 (KB)<br><strong>fsize</strong> : 最大文件大小 (KB)<br> memlock : 最大locked-in-memory地址空间 (KB)<br><strong>nofile</strong>: 打开的文件描述符最大数量限制<br> rss:最大的resident set大小 (KB)<br><strong>stack</strong> ： 栈最大大小 (KB)<br> cpu : 占用CPU最大时间 (分钟)<br><strong>nproc</strong> : 最大进程数量<br> as : 地址空间限制 (KB)<br> maxlogins : 当前用户最多登录次数<br> maxsyslogins : 当前系统最多登录次数<br> priority : 运行用户进程的优先级<br> locks: 用户最多可持有的文件锁的数量<br> sigpending:最大的pending signals的数目<br> msgqueue : POSIX消息队列可用的最大内存容量(bytes)<br> nice ：允许提高到的最大优先级 - rtprio:最大实时优先级<br> chroot :更改根目录</td></tr><tr><td>第4列</td><td>value</td><td>限制值</td><td></td></tr></tbody></table> 
<p><strong><em>B.禁用内存交换 swappiness</em></strong></p> 
<p>内存交换是指当内存不够用时，把内存中某些数据存储到磁盘上</p> 
<ul><li>临时禁用</li></ul> 
<ol><li><code>sudo swapoff -a</code></li></ol> 
<ul><li>永久禁用</li></ul> 
<p>修改 <code>/etc/sysctl.conf</code>文件，添加以下内容:</p> 
<ol><li><code>vm.swappiness=1</code></li></ol> 
<p><strong><em>C.虚拟内存设置</em></strong></p> 
<ul><li>临时设置</li></ul> 
<ol><li><code>sysctl -w vm.max_map_count=262144</code></li></ol> 
<ul><li>永久禁用</li></ul> 
<p>修改 <code>/etc/sysctl.conf</code>文件，添加以下内容:</p> 
<ol><li><code>vm.max_map_count=262144</code></li></ol> 
<p><strong><em>D.关闭防火墙</em></strong></p> 
<ol><li><code>systemctl stop firewalld.service</code></li></ol> 
<p>注，如果想永久关闭防火墙，使用</p> 
<ol><li><code>systemctl disable firewalld.service</code></li></ol> 
<h6 id="h5-5-elasticsearch"><a name="5.%E5%90%AF%E5%8A%A8elasticsearch"></a>5.启动elasticsearch</h6> 
<ol><li><code>su elastic</code></li><li><code>cd /opt/elasticsearch</code></li><li><code>bin/elasticsearch -d</code></li></ol> 
<p>主要启动参数</p> 
<ul><li>d : 以后台进程的方式启动</li><li>p : 指定存入elasticsearch进程号的文件地址</li><li>E key=value : 指定配置参数</li></ul> 
<h6 id="h5-6-elasticsearch-"><a name="6.%E9%87%8D%E6%96%B0%E8%AE%BE%E7%BD%AEelasticsearch%E7%9A%84%E5%AF%86%E7%A0%81"></a>6.重新设置elasticsearch的密码</h6> 
<ul><li>首先要关闭https访问</li></ul> 
<ol><li><code>xpack.security.http.ssl:</code></li><li><code>enabled: false</code></li></ol> 
<ul><li>重置密码</li></ul> 
<ol><li><code>./elasticsearch-reset-password -u elastic -i</code></li></ol> 
<ul><li>根据提示重置密码即可</li></ul> 
<p>注：如果配置了https证书，可以将https启用配置打开</p> 
<p></p> 
<h2><a name="%E4%BA%8C.%E9%85%8D%E7%BD%AE%E9%9B%86%E7%BE%A4"></a>二.配置集群</h2> 
<h3 id="h5-1-"><a name="1.%E6%8C%89%E7%85%A7%E7%AC%AC%E4%B8%80%E4%B8%AA%E4%B8%AA%E6%AD%A5%E9%AA%A4%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE%E5%90%84%E8%8A%82%E7%82%B9"></a>1.按照第一个个步骤安装配置各节点</h3> 
<h4 id="h6--1-"><a name="(1)%E8%8A%82%E7%82%B9%E5%A6%82%E4%B8%8B"></a>(1)节点如下</h4> 
<p>在以下节点安装elasticsearch以及需要的第三方插件</p> 
<table><thead><tr><th>节点名称</th><th>节点IP</th><th>节点角色</th><th>其他说明</th></tr></thead><tbody><tr><td>node-200</td><td>192.168.0.200</td><td>数据节点 1 + 主节点1</td><td></td></tr><tr><td>node-201</td><td>192.168.0.201</td><td>数据节点 2 + 主节点2</td><td></td></tr><tr><td>node-202</td><td>192.168.0.202</td><td>数据节点 3 + 主节点3</td><td></td></tr><tr><td>node-203</td><td>192.168.0.203</td><td>协调节点1</td><td></td></tr><tr><td>node-204</td><td>192.168.0.204</td><td>协调节点2</td><td></td></tr><tr><td>node-205</td><td>192.168.0.205</td><td>协调节点3</td><td></td></tr></tbody></table> 
<p>节点角色说明：</p> 
<ul><li>主节点是管理集群状态的(对所有资源要求都不高)</li><li>协调节点是接受客户端请求并分发到相应数据节点的，并合并搜索结果(对网络资源要求高，对CPU和内存也有一定的要求)</li><li>数据节点是读写数据的(对内存、CPU和IO要求高)</li></ul> 
<p>注：一般来说，在生产环境中，为了节省资源一个节点一般都是有多个角色，很少将节点作为单一角色来使用</p> 
<ul><li>最小的集群：将一个节点当作所有角色来使用(每个节点既是数据节点，也是主节点和协调节点)</li><li>初等规模：分成主节点和其他节点(数据节点也是协调节点)；分成协调节点和其他节点(数据节点也是主节点);</li><li>中高等规模：将数据节点、主节点和协调节点分开</li></ul> 
<h6 id="h6--2-elasticseach-"><a name="(2)%E4%B8%BAelasticseach%E6%96%B0%E5%A2%9E%E7%AE%A1%E7%90%86%E7%94%A8%E6%88%B7"></a>(2)为elasticseach新增管理用户</h6> 
<ol><li><code>useradd elastic</code></li><li><code>chown -R elastic:elastic /opt/elasticsearch</code></li></ol> 
<h4><a name="2.%E5%9C%A8%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E4%B8%8A%E9%83%BD%E6%89%93%E5%BC%80%E4%BB%A5%E4%B8%8B%E9%85%8D%E7%BD%AE"></a>2.在每个节点上都打开以下配置</h4> 
<h6><a name="(1)%E5%9C%A8%E6%AF%8F%E4%B8%AA%E8%8A%82%E7%82%B9%E4%B8%8A%E5%8A%A0%E5%85%A5%E4%BB%A5%E5%85%A5%E4%BB%A5%E4%B8%8B%E9%85%8D%E7%BD%AE"></a>(1)在每个节点上加入以入以下配置</h6> 
<pre><code>cluster.name: search-center

# 改成每个节点的名称
node.name: node-200


path.data: /home/elastic/data
path.logs: /var/log/elasticsearch

#改成每个的IP或主机名
network.host: 192.168.0.200
http.port: 9200

discovery.seed_hosts: ["192.168.0.200:9300", "192.168.0.201:9300","192.168.0.202:9300","192.168.0.203:9300","192.168.0.204:9300","192.168.0.205:9300"]

cluster.initial_master_nodes: ["192.168.0.200:9300", "192.168.0.201:9300","192.168.0.202:9300"]</code></pre> 
<p>注：</p> 
<ul><li><code>node.name</code>:每个节点要改成对应节点的名称</li><li><code>network.host</code>:每个节点要改成对应节点的主机名或IP</li><li><code>discovery.seed_hosts</code>:集群中的节点列表</li><li><code>cluster.initial_master_nodes</code>:集群初始化时主节点列表</li></ul> 
<h6 id="h6--2-"><a name="(2)%E5%9C%A8%E4%B8%BB%E8%8A%82%E7%82%B9%E4%B8%8A%E5%8A%A0%E5%85%A5%E4%BB%A5%E4%B8%8B%E9%85%8D%E7%BD%AE"></a>(2)在主节点上加入以下配置</h6> 
<p>在3个主节点上配置如下</p> 
<ol><li><code>node.roles: [master]</code></li></ol> 
<ul><li>注:如果<code>node.roles</code>原来有其他角色，要合并到一起，如原来是data节点，那么就设置为<code>[data,master]</code></li></ul> 
<h6><a name="(3)%E5%9C%A8%E6%89%80%E6%9C%89%E5%8D%8F%E8%B0%83%E8%8A%82%E7%82%B9%E4%B8%8A%E9%85%8D%E7%BD%AE"></a>(3)在所有协调节点上配置</h6> 
<ol><li><code>node.roles:[]</code></li></ol> 
<ul><li>注:没有任何指定角色的节点就是协调节点(默认所有的节点都是协调节点)</li></ul> 
<h6 id="h6--4-"><a name="(4)%E5%9C%A8%E6%89%80%E6%9C%89%E6%95%B0%E6%8D%AE%E8%8A%82%E7%82%B9%E4%B8%8A%E5%8A%A0%E5%85%A5%E4%BB%A5%E4%B8%8B%E9%85%8D%E7%BD%AE"></a>(4)在所有数据节点上加入以下配置</h6> 
<ol><li><code>node.roles: [data]</code></li></ol> 
<ul><li>注:如果<code>node.roles</code>原来有其他角色，要合并到一起，如原来是master节点，那么就设置为<code>[master,data]</code></li></ul> 
<h4 id="h5-3-"><a name="3.%E5%90%AF%E5%8A%A8%E5%90%84%E8%8A%82%E7%82%B9"></a>3.启动各节点</h4> 
<ul><li> <p>依次启动各节点，如果节点启动失败，可根据错误来进行处理</p> </li><li> <p>通过<code>ip:9200</code>的形式在浏览器中访问，查看各节点是否启动成功</p> </li></ul> 
<p>如 <code>http://192.168.0.200:9200</code>,如果可以成功访问说明启动成功</p> 
<h4 id="h5-4-"><a name="4.%E6%A3%80%E6%B5%8B%E9%9B%86%E7%BE%A4%E6%98%AF%E5%90%A6%E6%90%AD%E5%BB%BA%E6%88%90%E5%8A%9F"></a>4.检测集群是否搭建成功</h4> 
<h6><a name="(1)%E5%9C%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9B%B4%E6%8E%A5%E6%9F%A5%E7%9C%8B"></a>(1)在浏览器直接查看</h6> 
<p>官网下载kibana即可(需要与elasticsearch版本对应)</p> 
<p>kibana配置中elasticsearch的地址只需要写集群中的某个节点的地址即可</p> 
<p>查看节点情况:</p> 
<ol><li><code>http://192.168.0.200:9200/_cat/nodes</code></li></ol> 
<p>结果类似于:</p> 
<ol><li><code># host load role master nodeName</code></li><li><code>192.168.0.201 33 96 1 0.19 0.18 0.19 dim - node-201</code></li><li><code>192.168.0.200 22 94 0 0.13 0.22 0.18 dim * node-200</code></li><li><code>192.168.0.202 16 81 1 0.18 0.32 0.20 dim - node-202</code></li><li><code>192.168.0.205 17 96 1 0.40 0.32 0.19 - - node-205</code></li><li><code>192.168.0.203 15 78 1 0.27 0.34 0.22 - - node-203</code></li><li><code>192.168.0.204 15 95 0 0.48 0.45 0.25 - - node-204</code></li></ol> 
<p>注：</p> 
<ul><li>role那一行中，是多个角色的组合 
  <ul><li>d: 数据节点(data)</li><li>i: 预处理节点(ingest)</li><li>m: 主节点备选节点(master)</li></ul></li><li>master那一行，表示当前节点是否为主节点 
  <ul><li><code>*</code> : 是主节点</li><li><code>-</code> : 不是主节点</li></ul></li></ul> 
<h6 id="h6--2-cerebro-"><a name="(2)%E9%80%9A%E8%BF%87cerebro%E6%9F%A5%E7%9C%8B%E9%9B%86%E7%BE%A4%E6%83%85%E5%86%B5"></a>(2)通过cerebro查看集群情况</h6> 
<p>注：cerebro是一个操作cerebro的界面操作工具(github中搜索即可)</p> 
<p>首先，添加一个索引，并设置几条数据</p> 
<pre><code>PUT commodity_item
{
"mappings": {
"properties": {
"id":{
"type":"long"
},
"name":{
"type":"text"
}
}
},
"settings": {
"number_of_shards": 3,
"number_of_replicas": 1
},
"aliases": {
"item": {}
}
}</code></pre> 
<ol><li><code>POST _bulk</code></li><li><code>{"create":{"_index":"commodity_item","_id":1}}</code></li><li><code>{"id":1,"name":"华为p40"}</code></li><li><code>{"create":{"_index":"commodity_item","_id":2}}</code></li><li><code>{"id":2,"name":"魅族18"}</code></li><li><code>{"create":{"_index":"commodity_item","_id":3}}</code></li><li><code>{"id":3,"name":"苹果12"}</code></li></ol> 
<ul><li>分片情况</li></ul> 
<p>a.和我们预想的一样，数据都分布到了数据节点上，没有分布到coordinating节点上<br> b.因为设置了3个分片，共3个节点(虚线是副本分片;实线为主分片)</p> 
<p></p> 
<h2>配置集群2</h2> 
<h3>1、准备</h3> 
<p>ES集群至少需要三台服务器：</p> 
<p>192.168.100.230   master<br> 192.168.100.231   slave1<br> 192.168.100.232   slave2</p> 
<h3>2、配置</h3> 
<h4>1、192.168.100.230 master 配置</h4> 
<p>cluster.name: es-sassycoder   #配置elasticsearch的集群名称，默认是my-application。建议修改成一个有意义的名称。<br> node.name: es-node-230       #节点名，通常一台物理服务器就是一个节点，es会默认随机指定一个名字，建议指定一个有意义的名称，方便管理<br> network.host: 0.0.0.0      #绑定ip地址<br><strong><span style="color:#fe2c24;">http.port: 9200             #暴露的http端口<br> transport.profiles.default.port: 9300    #内部通信端口</span></strong><br> path.data: /usr/local/elasticsearch-8.3.1/data   #索引目录<br> path.logs: /usr/local/elasticsearch-8.3.1/logs   #日志目录<br> # 允许通配符删除索引<br> action.destructive_requires_name: true<br> # 配置集群初始时，作为master的主机，单节点时配置本节点名称（node.name）<br> # 必须使用完整的 node.name<br> # 重新启动集群或向现有集群添加新节点时，不要使用此设置<br><span style="color:#fe2c24;"><strong>cluster.initial_master_nodes: ["es-node-230"]</strong></span><br> # 配置启动时要发现的master列表（IP 或 可解析的域名），端口默认为9300<br> # 单节点时不用配置或配置为本节点IP<br><span style="color:#fe2c24;"><strong>discovery.seed_hosts: ["192.168.100.230:9300","192.168.100.231:9300","192.168.100.232:9300"]</strong></span><br> #使用head等插件监控集群信息，需要打开以下配置项<br> http.cors.enabled: true<br> http.cors.allow-origin: "*"<br> http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type</p> 
<p>#----------------------- BEGIN SECURITY AUTO CONFIGURATION -----------------------<br> #<br> # The following settings, TLS certificates, and keys have been automatically      <br> # generated to configure Elasticsearch security features on 04-07-2022 09:25:53<br> #<br> # --------------------------------------------------------------------------------</p> 
<p># Enable security features<br> xpack.security.enabled: false</p> 
<p>xpack.security.enrollment.enabled: false</p> 
<p># Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agents<br> xpack.security.http.ssl:<br>   enabled: false<br>   keystore.path: certs/http.p12</p> 
<p># Enable encryption and mutual authentication between cluster nodes<br> xpack.security.transport.ssl:<br>   enabled: false<br>   verification_mode: certificate<br>   keystore.path: certs/transport.p12<br>   truststore.path: certs/transport.p12<br> #----------------------- END SECURITY AUTO CONFIGURATION -------------------------<br>  </p> 
<h4>2、192.168.100.231 slave1配置</h4> 
<p>cluster.name: es-sassycoder   #配置elasticsearch的集群名称，默认是my-application。建议修改成一个有意义的名称。<br> node.name: es-node-231       #节点名，通常一台物理服务器就是一个节点，es会默认随机指定一个名字，建议指定一个有意义的名称，方便管理<br> network.host: 0.0.0.0      #绑定ip地址<br> http.port: 9200             #暴露的http端口<br> transport.profiles.default.port: 9300    #内部通信端口<br> path.data: /usr/local/elasticsearch-8.3.1/data   #索引目录<br> path.logs: /usr/local/elasticsearch-8.3.1/logs   #日志目录<br> # 允许通配符删除索引<br> action.destructive_requires_name: true<br> # 配置集群初始时，作为master的主机，单节点时配置本节点名称（node.name）<br> # 必须使用完整的 node.name<br> # 重新启动集群或向现有集群添加新节点时，不要使用此设置<br> #cluster.initial_master_nodes: ["es-node-230","es-node-231","es-node-232"]<br> # 配置启动时要发现的master列表（IP 或 可解析的域名），端口默认为9300<br> # 单节点时不用配置或配置为本节点IP<br> discovery.seed_hosts: ["192.168.100.230:9300","192.168.100.231:9300","192.168.100.232:9300"]<br> #使用head等插件监控集群信息，需要打开以下配置项<br> http.cors.enabled: true<br> http.cors.allow-origin: "*"<br> http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type</p> 
<p>#----------------------- BEGIN SECURITY AUTO CONFIGURATION -----------------------<br> #<br> # The following settings, TLS certificates, and keys have been automatically      <br> # generated to configure Elasticsearch security features on 04-07-2022 09:25:53<br> #<br> # --------------------------------------------------------------------------------</p> 
<p># Enable security features<br><strong><span style="color:#fe2c24;">xpack.security.enabled: false</span></strong></p> 
<p><strong><span style="color:#fe2c24;">xpack.security.enrollment.enabled: false</span></strong></p> 
<p># Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agents<br> xpack.security.http.ssl:<br>   enabled: false<br>   keystore.path: certs/http.p12</p> 
<p># Enable encryption and mutual authentication between cluster nodes<br> xpack.security.transport.ssl:<br>   enabled: false<br>   verification_mode: certificate<br>   keystore.path: certs/transport.p12<br>   truststore.path: certs/transport.p12<br> #----------------------- END SECURITY AUTO CONFIGURATION -------------------------<br>  </p> 
<h4>3、192.168.100.232 slave2配置</h4> 
<p>cluster.name: es-sassycoder   #配置elasticsearch的集群名称，默认是my-application。建议修改成一个有意义的名称。<br> node.name: es-node-232       #节点名，通常一台物理服务器就是一个节点，es会默认随机指定一个名字，建议指定一个有意义的名称，方便管理<br> network.host: 0.0.0.0      #绑定ip地址<br> http.port: 9200             #暴露的http端口<br> transport.profiles.default.port: 9300    #内部通信端口<br> path.data: /usr/local/elasticsearch-8.3.1/data   #索引目录<br> path.logs: /usr/local/elasticsearch-8.3.1/logs   #日志目录<br> # 允许通配符删除索引<br> action.destructive_requires_name: true<br> # 配置集群初始时，作为master的主机，单节点时配置本节点名称（node.name）<br> # 必须使用完整的 node.name<br> # 重新启动集群或向现有集群添加新节点时，不要使用此设置<br> #cluster.initial_master_nodes: ["es-node-232"]<br> # 配置启动时要发现的master列表（IP 或 可解析的域名），端口默认为9300<br> # 单节点时不用配置或配置为本节点IP<br> discovery.seed_hosts: ["192.168.100.230:9300","192.168.100.231:9300","192.168.100.232:9300"]<br> #使用head等插件监控集群信息，需要打开以下配置项<br> http.cors.enabled: true<br> http.cors.allow-origin: "*"<br> http.cors.allow-headers: Authorization,X-Requested-With,Content-Length,Content-Type</p> 
<p>#----------------------- BEGIN SECURITY AUTO CONFIGURATION -----------------------<br> #<br> # The following settings, TLS certificates, and keys have been automatically      <br> # generated to configure Elasticsearch security features on 05-07-2022 07:55:16<br> #<br> # --------------------------------------------------------------------------------</p> 
<p># Enable security features<br><span style="color:#fe2c24;"><strong>xpack.security.enabled: false</strong></span></p> 
<p><span style="color:#fe2c24;"><strong>xpack.security.enrollment.enabled: false</strong></span></p> 
<p># Enable encryption for HTTP API client connections, such as Kibana, Logstash, and Agents<br> xpack.security.http.ssl:<br>   enabled: false<br>   keystore.path: certs/http.p12</p> 
<p># Enable encryption and mutual authentication between cluster nodes<br> xpack.security.transport.ssl:<br>   enabled: false<br>   verification_mode: certificate<br>   keystore.path: certs/transport.p12<br>   truststore.path: certs/transport.p12<br> #----------------------- END SECURITY AUTO CONFIGURATION -------------------------<br><br> 启动过程如果有报错，先把elasticsearch/data目录下的文件全部删除，再试试。<br>  </p> 
<h2>签发CA</h2> 
<h3>签发CA证书（一直回车）</h3> 
<pre><code>sh /usr/local/setup/elasticsearch-8.6.2/bin/elasticsearch-certutil ca</code></pre> 
<h3>签发节点证书（一直回车）</h3> 
<pre><code>sh /usr/local/setup/elasticsearch-8.6.2/bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12</code></pre> 
<p>        创建好的ca证书和server证书默认名称为elastic-stack-ca.p12和elastic-certificates.p12，存放在$ES_HOME目录。</p> 
<pre><code>cd /usr/local/setup/elasticsearch-8.6.2/config
mkdir certs
mv /usr/local/setup/elasticsearch-8.6.2/elastic-*.p12 /usr/local/setup/elasticsearch-8.6.2/config/certs/</code></pre> 
<p>        将证书发送到另外两个节点。</p> 
<pre><code>scp /usr/local/setup/elasticsearch-8.6.2/config/certs/elastic-* node2:/usr/local/setup/elasticsearch-8.6.2/config/certs
scp /usr/local/setup/elasticsearch-8.6.2/config/certs/elastic-* node3:/usr/local/setup/elasticsearch-8.6.2/config/certs/</code></pre> 
<p>        再次修改配置文件</p> 
<pre><code>vi /usr/local/setup/elasticsearch-8.6.2/config/elasticsearch.yml
#启用节点上Elastic Search的xpack安全功能
xpack.security.enabled: true
xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.verification_mode: certificate
xpack.security.transport.ssl.keystore.path: certs/elastic-certificates.p12
xpack.security.transport.ssl.truststore.path: certs/elastic-certificates.p12</code></pre> 
<h4></h4> 
<p></p> 
<h2>参考</h2> 
<p><a href="https://www.cnblogs.com/tanghaorong/p/16324481.html" rel="nofollow" title="https://www.cnblogs.com/tanghaorong/p/16324481.html">https://www.cnblogs.com/tanghaorong/p/16324481.html</a></p> 
<p><a href="https://shixinke.com/elasticsearch/elasticsearch-installation-and-cluster-building" rel="nofollow" title="ElasticSearch 8.5 安装及集群搭建 诗心博客">ElasticSearch 8.5 安装及集群搭建 诗心博客</a></p> 
<p><a href="https://blog.csdn.net/ztx114/article/details/125622169" title="Elasticsearch 8 集群配置_elasticsearch8 群指定配置文件方式启动-CSDN博客">Elasticsearch 8 集群配置_elasticsearch8 群指定配置文件方式启动-CSDN博客</a></p> 
<p><a href="https://zhuanlan.zhihu.com/p/616274155" rel="nofollow" title="Elastic Search 8.6.2集群安装部署 - 知乎">Elastic Search 8.6.2集群安装部署 - 知乎</a></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/93c219542956d05333fb598bd0d58c8f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java：连接mysql数据库的五种方式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a5d39bf11bbf46b063e83b36c7e41e6a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">计算机控制技术——温控系统大林算法控制器设计实验</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>