<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>boto3：Python连接S3对象存储并进行文件操作（上传、下载、删除） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/17b2243b6a0a3e98d642039fb3d28ea5/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="boto3：Python连接S3对象存储并进行文件操作（上传、下载、删除）">
  <meta property="og:description" content="目录
一、前言
二、boto3
三、代码
1、连接
2、列出桶中文件
3、删除文件
4、上传下载
一、前言 在日常进行数据高可用时，会将数据存入对象存储中。在一般的企业中，对象存储资源池只有管理员拥有Web界面管理，普通账号需要对数据进行管理时，有如下方法：
一、通用对象存储管理客户端，如对于S3对象存储有S3browser可以进行使用，其优点是操作简单，界面可视化；缺点是每次需要手动操作。
二、利用对象存储指定的API或者SDK工具进行开发，其优点是适合无法使用可视化界面的IT环境和可自动完成，缺点是需要自己编辑。
二、boto3 boto3是针对S3云存储的Python SDK工具，是boto2的迭代版本，对于可使用S3对象存储接口协议的基本可使用boto3。
安装：pip install boto3
三、代码 1、连接 import boto3 from datetime import datetime, timedelta # 定义 endpoint、access key 和 secret key endpoint_url = &#39;http://*************&#39; access_key = &#39;****&#39; secret_key = &#39;****&#39; # 创建 S3 客户端实例并指定 endpoint 和凭证信息 s3 = boto3.client(&#39;s3&#39;, endpoint_url=endpoint_url, aws_access_key_id=access_key, aws_secret_access_key=secret_key, verify=False) # 如果不需要SSL验证，可以设置verify=False，即http或者https # 列出所有的桶 responses = s3.list_buckets() buckets = [bucket[&#39;Name&#39;] for bucket in responses[&#39;Buckets&#39;]] print(&#39;All of Buckets:&#39;, buckets) 2、列出桶中文件 #前面连接桶的代码段此处已省略 response = s3.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-27T10:18:08+08:00">
    <meta property="article:modified_time" content="2024-02-27T10:18:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">boto3：Python连接S3对象存储并进行文件操作（上传、下载、删除）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80" rel="nofollow">一、前言</a></p> 
<p id="%E4%BA%8C%E3%80%81boto3-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81boto3" rel="nofollow">二、boto3</a></p> 
<p id="%E4%B8%89%E3%80%81%E4%BB%A3%E7%A0%81-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E4%BB%A3%E7%A0%81" rel="nofollow">三、代码</a></p> 
<p id="1%E3%80%81%E8%BF%9E%E6%8E%A5-toc" style="margin-left:40px;"><a href="#1%E3%80%81%E8%BF%9E%E6%8E%A5" rel="nofollow">1、连接</a></p> 
<p id="%C2%A02%E3%80%81%E5%88%97%E5%87%BA%E6%A1%B6%E4%B8%AD%E6%96%87%E4%BB%B6-toc" style="margin-left:40px;"><a href="#%C2%A02%E3%80%81%E5%88%97%E5%87%BA%E6%A1%B6%E4%B8%AD%E6%96%87%E4%BB%B6" rel="nofollow">2、列出桶中文件</a></p> 
<p id="3%E3%80%81%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6-toc" style="margin-left:40px;"><a href="#3%E3%80%81%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6" rel="nofollow">3、删除文件</a></p> 
<p id="%C2%A04%E3%80%81%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD-toc" style="margin-left:40px;"><a href="#%C2%A04%E3%80%81%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD" rel="nofollow">4、上传下载</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80">一、前言</h2> 
<blockquote> 
 <p>      在日常进行数据高可用时，会将数据存入对象存储中。在一般的企业中，对象存储资源池只有管理员拥有Web界面管理，普通账号需要对数据进行管理时，有如下方法：</p> 
 <p>      <strong>一、通用对象存储管理客户端</strong>，如对于S3对象存储有<strong>S3browser</strong>可以进行使用，其优点是操作简单，界面可视化；缺点是每次需要手动操作。</p> 
 <p>      <strong>二、利用对象存储指定的API或者SDK工具进行开发</strong>，其优点是适合无法使用可视化界面的IT环境和可自动完成，缺点是需要自己编辑。</p> 
</blockquote> 
<h2 id="%E4%BA%8C%E3%80%81boto3">二、boto3</h2> 
<blockquote> 
 <p>       boto3是针对S3云存储的Python SDK工具，是boto2的迭代版本，对于可使用S3对象存储接口协议的基本可使用boto3。</p> 
 <p><span style="color:#511b78;"><em>安装：pip install boto3</em></span></p> 
</blockquote> 
<h2 id="%E4%B8%89%E3%80%81%E4%BB%A3%E7%A0%81">三、代码</h2> 
<h3 id="1%E3%80%81%E8%BF%9E%E6%8E%A5">1、连接</h3> 
<pre><code class="language-python">import boto3
from datetime import datetime, timedelta
# 定义 endpoint、access key 和 secret key
endpoint_url = 'http://*************'
access_key = '****'
secret_key = '****'

# 创建 S3 客户端实例并指定 endpoint 和凭证信息
s3 = boto3.client('s3',
                  endpoint_url=endpoint_url,
                  aws_access_key_id=access_key,
                  aws_secret_access_key=secret_key,
                  verify=False)  # 如果不需要SSL验证，可以设置verify=False，即http或者https

# 列出所有的桶
responses = s3.list_buckets()
buckets = [bucket['Name'] for bucket in responses['Buckets']]
print('All of Buckets:', buckets)</code></pre> 
<h3 id="%C2%A02%E3%80%81%E5%88%97%E5%87%BA%E6%A1%B6%E4%B8%AD%E6%96%87%E4%BB%B6">2、列出桶中文件</h3> 
<pre><code class="language-python">#前面连接桶的代码段此处已省略
response = s3.list_objects_v2(Bucket='****') #选择你需要列出的桶名，
# 输出列出的所有对象
if 'Contents' in response:
    for obj in response['Contents']:
        key = obj['Key']
        timestep = obj['LastModified'] #文件对应的最后更改时间
        print(key, timestep)           #输出桶中文件名及最后更改时间</code></pre> 
<h3 id="3%E3%80%81%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6">3、删除文件</h3> 
<blockquote> 
 <p><strong>删除文件：</strong></p> 
 <p>s3.delete_object(Bucket='****', Key='****')</p> 
 <p>Bucket即为桶名，Key为桶中要删除的文件名（包含完整路径）</p> 
</blockquote> 
<pre><code class="language-python">#以删除桶中30天以前的文件来直观了解一下
#省略前面连接代码
response = s3.list_objects_v2(Bucket='****')
days_hup = 30
del_date = datetime.now() - timedelta(days=days_hup)
#print(del_date)
# 删除30天以前的文件
if 'Contents' in response:
    for obj in response['Contents']:
        key = obj['Key']
        timestep = obj['LastModified']
        timestep = timestep.replace(tzinfo=None) #注意进行时间offset-aware和offset-naive的转换
        if timestep &lt; del_date:
            s3.delete_object(Bucket='****', Key=key)
            print(f'删除文件 {key} 成功')</code></pre> 
<h3 id="%C2%A04%E3%80%81%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD">4、上传下载</h3> 
<blockquote> 
 <p>s3.upload_file（本地路径及文件，桶名，对象存储路径及文件）</p> 
 <p>s3.download_file（桶名，对象存储路径及文件，本地路径及文件）</p> 
</blockquote> 
<pre><code class="language-python">#省略前面连接代码 
bucket_name = '****'             #your bucket name
# 上传文件
local_file_path = '/data/testfile'  # 本地文件路径
s3_file_key = '/TEST/uptestfile'  # S3中的文件名，可以包括文件夹
s3.upload_file(local_file_path, bucket_name, s3_file_key)
print('文件上传成功')

# 下载文件
download_path = '/data/downtestflie'  # 下载到本地的路径，包含文件名
s3_file_key = '/TEST/uptestfile'  
s3.download_file(bucket_name, s3_file_key, download_path)
print('文件下载成功')</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/804aa287bb84a62217ed5b4937fa6218/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python日志记录库——loguru</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/79e6b3168d3a434733d9daeabc307250/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Mac找不到.ssh文件夹的解决</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>