<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【网络】数据链路层-MAC帧 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/a9b44ebea1a11d8b4600d215045e0a62/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【网络】数据链路层-MAC帧">
  <meta property="og:description" content="数据链路层-以太网与ARP协议 文章目录 1.数据链路层2.以太网2.1什么是以太网2.2MAC帧格式 3.ARP协议3.1为什么有ARP协议？3.2ARP的定位3.3ARP协议工作流程3.4ARP数据格式 4.RARP协议 1.数据链路层 数据链路层是网络协议栈中最底层的内容，而在之前对其他层次的学习让我们知道传输层可以保证数据的可靠性问题，网络层保证数据跨网络转发的路由问题，而数据链路层解决的就是局域网内两台主机间通信的问题。
2.以太网 2.1什么是以太网 以太网属于一种局域网通信技术。
不同局域网所采用的通信技术可能是不同的，常见的局域网技术有以下三种：
以太网：以太网是一种计算机局域网技术，一种应用最普遍的局域网技术。令牌环网：令牌环网常用于IBM系统中，在这种网络中有一种专门的帧称为“令牌”，在环路上持续地传输来确定一个节点何时可以发送包。无线LAN/WAN：无线局域网是有线网络的补充和扩展，现在已经是计算机网络的一个重要组织部分。 虽然网络中各个局域网所采用的通信技术可能的不同的，但是IP屏蔽了底层网络的差异，对于网络通信双方的IP层及其往上的协议来说，它们并不关心底层具体使用的是哪种局域网技术。
网络中的路由器会不断去掉数据旧的局域网报头，并添加上新的局域网报头，因此数据在进行跨网络传输时，就算所需跨越的网络采用的是不同的局域网技术，最终也能够正确实现跨越。
（1）以太网通信原理
以太网”不是一种具体的网络，而是一种技术标准，它既包含了数据链路层的内容，也包含了一些物理层的内容。例如，以太网规定了网络拓扑结构，访问控制方式，传输速率等。以太网中的网线必须使用双绞线，传输速率有10M，100M，1000M等。 以太网中所有的主机共享一个通信信道，当局域网中的一台主机发出数据后，该局域网中的所有主机都能够收到该数据。
比如当局域网中的主机A想要发送数据给主机B时，其实局域网当中的每一台主机都能收到主机A发出去的数据，只不过最终只有主机B会将主机A发来的数据向上进行交付。局域网当中的其他主机虽然也收到了主机A发出的数据，但经过识别后发现这个数据不是发送给自己的，于是就会直接将该数据丢弃而不会向上进行交付。 （2）数据碰撞
由于以太网中的所有的主机共享一个通信信道，因此在同一时刻只允许有一台主机发送数据，否则各个主机发送的数据就会相互干扰。站在系统的角度来看，这里各个主机所共享的通信信道就是一种临界资源，这个临界资源同一时刻只允许一台主机使用。
对于这个问题，以太网的做法就是先不限制各个主机发送数据的能力，局域网中的每个主机想发数据的时候直接发就行了，但是只要发送出去的数据与其他主机发送的数据产生了碰撞，那就得执行碰撞避免算法。所谓的碰撞避免算法就是，当主机发送出去的数据产生碰撞时，该主机需要等待一段时间后再进行数据重发，在主机等待的时候就能够就能够尽可能让局域网当中的数据消散。一个局域网就是一个碰撞域。 （3）交换机
交换机通过维护一个MAC地址表来记录每个端口连接的设备的MAC地址。当数据帧到达交换机时，它会根据目的MAC地址查找MAC地址表，以确定将数据帧转发到哪个端口。这种机制减少了数据帧被错误地发送到多个端口的可能性，从而降低了碰撞的概率。
交换机支持VLAN技术，可以将网络划分为多个逻辑上独立的广播域。每个VLAN内的设备只能与同一VLAN内的其他设备通信，从而减少了广播流量和碰撞的可能性。
（4）令牌环网
令牌环网（Token-ring network）的传输方法在物理上采用了星形拓扑结构，但逻辑上是环形拓扑结构。令牌环网的通信传输介质可以是无屏蔽双绞线、屏蔽双绞线和光纤等。令牌环网中各节点间采用多站访问部件（Multistation Access Unit，MAU）连接在一起，MAU是一种专业化集线器，用来围绕工作站计算机的环路进行传输。 在令牌环网中有一种专门的帧称为“令牌”，这个“令牌”会在环路上持续地传输，只有拿到“令牌”的主机才能发送数据，因此发送出去的数据不会发生碰撞。
令牌环网当中的“令牌”就像系统当中用于保护临界资源的互斥锁一样，“令牌”与互斥锁一样也有“忙”和“闲”两种状态，“忙”表示令牌已经被占用，而“闲”则表示令牌没有被占用。想要发送数据的计算机必须首先检测到“闲”令牌，并将其置为“忙”状态，然后才可以发送数据，这就和申请互斥锁的过程很像。此外，由于“令牌”在网环上是按顺序依次传递的，因此对于所有入网的计算机而言，它们获取令牌的机会都是相等的，因此不会造成某台主机发送数据的饥饿问题。 2.2MAC帧格式 MAC帧是数据链路层的一种数据数据格式，用于在局域网（以太网）传递数据。
源地址和目的地址是指网卡的硬件地址（也叫MAC地址），长度是48位，是在网卡出厂时固化的。帧协议类型字段有三种值，分别对应IP协议（0800）、ARP协议（0806）和RARP协议（8035）。帧末尾是CRC校验码。 （1）MAC帧如何将报头与有效载荷进行分离？
以太网MAC帧的帧头和帧尾都是固定长度的，因此当底层收到一个MAC帧后，直接提取出MAC帧当中固定长度的帧头和帧尾，此时剩下的就是有效载荷了。
（2）MAC帧如何决定将有效载荷交付给上层的哪一个协议？
以太网MAC帧对应的上层协议不止一种，因此在将MAC帧的报头和有效载荷分离后，还需要确定应该将分离出来的有效载荷交付给上层的哪一个协议。
在MAC帧的帧头当中有2个字节的类型字段，因此在分离出报头和有效载荷后，根据该字段将有效载荷交付给对应的上层协议即可。
（3）数据传输过程
假设局域网当中的主机A想要将IP数据报发送给同一局域网当中的主机B，那么主机A封装MAC帧当中的目的地址就是主机B的MAC地址，源地址就是主机A的MAC地址，而帧协议的类型对应就是0800，紧接着就是要发送的IP数据报，帧尾部分对应就是CRC校验。
当主机A将该MAC帧发送到局域网当中后，局域网当中的所有主机都可以收到这个MAC帧，包括主机A自己。
主机A收到该MAC帧后，可以对收到的MAC帧进行CRC校验，如果校验失败则说明数据发送过程中产生了碰撞，此时主机A就会执行碰撞避免算法，后续进行MAC帧重发。主机B收到该MAC帧后，提取出MAC帧当中的目的地址，发现该目的地址与自己的MAC地址相同，于是在CRC校验成功后就会将有效载荷交付给上层IP层（0800）进行进一步处理。局域网中的其他主机收到该MAC帧后，也会提取出MAC帧当中的目的地址，但发现该目的地址与自己的MAC地址不匹配，于是就会直接将这个MAC帧丢弃掉。 也就是说，当底层收到一个MAC帧后，会根据MAC帧当中的目的地址来判断该MAC帧是否是发给自己的，如果是发送给自己的则会再对其进行CRC校验，如果校验成功则会根据该MAC帧的帧协议类型，将该MAC交付给对应的上层协议进行处理，如果不是发送给自己的则在数据链路层直接将数据丢弃。
（4）认识MAC地址
MAC地址用来识别数据链路层中相连的节点。长度为48位，及6个字节，一般用16进制数字加上冒号的形式来表示，例如：08:00:27:03:fb:19。在网卡出厂时就确定了，不能修改，MAC地址通常是唯一的（虚拟机中的MAC地址不是真实的MAC地址，可能会冲突；也有些网卡支持用户配置MAC地址）。 我们可以通过ifconfig命令来查看我们的MAC地址。
ether：以太。
（5）对比理解MAC地址和IP地址
实际数据在路由过程中会存在两套地址，一套是源IP地址和目的IP地址，还有一套是源MAC地址和目的MAC地址。
IP地址描述的是数据通信总体的起点和终点。MAC地址描述的是数据通信上的每一个区间的起点和终点。 比如唐僧取经，源IP地址就是东土大唐，目的IP地址就是西天，而源MAC地址就是取经路途上一个区间内的起点，目的MAC地址就是取经路途上一个区间内的终点。
因此数据在路由过程中，源IP地址和目的IP地址可以理解成是不会变化的（但实际上由于NAT技术，源IP地址也是会发生变化的），而数据每进行一跳后其源MAC地址和目的MAC地址都会变化。
（6）认识MTU
MTU（Maximum Transmission Unit，最大传输单元）描述的是底层数据帧一次最多可以发送的数据量，这个限制是不同的数据链路层对应的物理层产生的。
以太网对应MTU的值一般是1500字节，不同的网络类型有不同的MTU，如果一次要发送的数据超过了MTU，则需要在IP层对数据进行分片（fragmentation）。此外，以太网规定MAC帧中数据的最小长度为46字节，如果发送数据量小于46字节，则需要在数据后面补填充位，比如ARP数据包的长度就是不够46字节的。 （7）认识MSS
由于数据链路层限制了单次数据传输的数据量（MTU），所以为了避免数据在网络层进行IP分片，我们应在传输层对向网络层交付的数据大小加以控制。
我们将TCP的单个数据报的最大报文长度，称为MSS（Max Segment Size）。
TCP通信双方在建立连接的过程中，就会进行MSS协商，最终选取双方支持的MSS值当中的较小值作为最终MSS。
MSS的值实际就是在TCP首部的40字节的选项字段当中的（kind=2）。
最理想的情况下，MSS的值正好就是在数据不会在IP层进行分片的最大长度。
MSS和MTU的关系如下：
3.ARP协议 地址解析协议（Address Resolution Protocol，ARP）协议，是根据IP地址获取MAC地址的一个TCP/IP协议。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-27T11:02:01+08:00">
    <meta property="article:modified_time" content="2024-08-27T11:02:01+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【网络】数据链路层-MAC帧</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <center> 
 <strong>数据链路层-以太网与ARP协议 </strong> 
</center> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1_8" rel="nofollow">1.数据链路层</a></li><li><a href="#2_14" rel="nofollow">2.以太网</a></li><li><ul><li><a href="#21_16" rel="nofollow">2.1什么是以太网</a></li><li><a href="#22MAC_66" rel="nofollow">2.2MAC帧格式</a></li></ul> 
  </li><li><a href="#3ARP_144" rel="nofollow">3.ARP协议</a></li><li><ul><li><a href="#31ARP_148" rel="nofollow">3.1为什么有ARP协议？</a></li><li><a href="#32ARP_156" rel="nofollow">3.2ARP的定位</a></li><li><a href="#33ARP_170" rel="nofollow">3.3ARP协议工作流程</a></li><li><a href="#34ARP_180" rel="nofollow">3.4ARP数据格式</a></li></ul> 
  </li><li><a href="#4RARP_194" rel="nofollow">4.RARP协议</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1_8"></a>1.数据链路层</h2> 
<p>数据链路层是网络协议栈中最底层的内容，而在之前对其他层次的学习让我们知道传输层可以保证数据的可靠性问题，网络层保证数据跨网络转发的路由问题，而数据链路层解决的就是局域网内两台主机间通信的问题。</p> 
<p><img src="https://images2.imgbox.com/f2/c7/98gtVY2q_o.png" alt="QQ_1723167027624"></p> 
<h2><a id="2_14"></a>2.以太网</h2> 
<h3><a id="21_16"></a>2.1什么是以太网</h3> 
<p>以太网属于一种局域网通信技术。</p> 
<p>不同局域网所采用的通信技术可能是不同的，常见的局域网技术有以下三种：</p> 
<ul><li>以太网：以太网是一种计算机局域网技术，一种应用最普遍的局域网技术。</li><li>令牌环网：令牌环网常用于IBM系统中，在这种网络中有一种专门的帧称为“令牌”，在环路上持续地传输来确定一个节点何时可以发送包。</li><li>无线LAN/WAN：无线局域网是有线网络的补充和扩展，现在已经是计算机网络的一个重要组织部分。</li></ul> 
<p>虽然网络中各个局域网所采用的通信技术可能的不同的，但是IP屏蔽了底层网络的差异，对于网络通信双方的IP层及其往上的协议来说，它们并不关心底层具体使用的是哪种局域网技术。</p> 
<p>网络中的路由器会不断去掉数据旧的局域网报头，并添加上新的局域网报头，因此数据在进行跨网络传输时，就算所需跨越的网络采用的是不同的局域网技术，最终也能够正确实现跨越。</p> 
<p><strong>（1）以太网通信原理</strong></p> 
<ul><li>以太网”不是一种具体的网络，而是一种技术标准，它既包含了数据链路层的内容，也包含了一些物理层的内容。例如，以太网规定了网络拓扑结构，访问控制方式，传输速率等。</li><li>以太网中的网线必须使用双绞线，传输速率有10M，100M，1000M等。</li></ul> 
<p>以太网中所有的主机共享一个通信信道，当局域网中的一台主机发出数据后，该局域网中的所有主机都能够收到该数据。</p> 
<ul><li>比如当局域网中的主机A想要发送数据给主机B时，其实局域网当中的每一台主机都能收到主机A发出去的数据，只不过最终只有主机B会将主机A发来的数据向上进行交付。</li><li>局域网当中的其他主机虽然也收到了主机A发出的数据，但经过识别后发现这个数据不是发送给自己的，于是就会直接将该数据丢弃而不会向上进行交付。</li></ul> 
<p><strong>（2）数据碰撞</strong></p> 
<p>由于以太网中的所有的主机共享一个通信信道，因此在同一时刻只允许有一台主机发送数据，否则各个主机发送的数据就会相互干扰。站在系统的角度来看，这里各个主机所共享的通信信道就是一种临界资源，这个临界资源同一时刻只允许一台主机使用。</p> 
<ul><li>对于这个问题，以太网的做法就是先不限制各个主机发送数据的能力，局域网中的每个主机想发数据的时候直接发就行了，但是只要发送出去的数据与其他主机发送的数据产生了碰撞，那就得执行碰撞避免算法。</li><li>所谓的碰撞避免算法就是，当主机发送出去的数据产生碰撞时，该主机需要等待一段时间后再进行数据重发，在主机等待的时候就能够就能够尽可能让局域网当中的数据消散。</li><li>一个局域网就是一个碰撞域。</li></ul> 
<p><strong>（3）交换机</strong></p> 
<p>交换机通过维护一个MAC地址表来记录每个端口连接的设备的MAC地址。当数据帧到达交换机时，它会根据目的MAC地址查找MAC地址表，以确定将数据帧转发到哪个端口。这种机制减少了数据帧被错误地发送到多个端口的可能性，从而降低了碰撞的概率。</p> 
<p>交换机支持VLAN技术，可以将网络划分为多个逻辑上独立的广播域。每个VLAN内的设备只能与同一VLAN内的其他设备通信，从而减少了广播流量和碰撞的可能性。</p> 
<p><strong>（4）令牌环网</strong></p> 
<ul><li>令牌环网（Token-ring network）的传输方法在物理上采用了星形拓扑结构，但逻辑上是环形拓扑结构。</li><li>令牌环网的通信传输介质可以是无屏蔽双绞线、屏蔽双绞线和光纤等。</li><li>令牌环网中各节点间采用多站访问部件（Multistation Access Unit，MAU）连接在一起，MAU是一种专业化集线器，用来围绕工作站计算机的环路进行传输。</li></ul> 
<p>在令牌环网中有一种专门的帧称为“令牌”，这个“令牌”会在环路上持续地传输，只有拿到“令牌”的主机才能发送数据，因此发送出去的数据不会发生碰撞。</p> 
<ul><li>令牌环网当中的“令牌”就像系统当中用于保护临界资源的互斥锁一样，“令牌”与互斥锁一样也有“忙”和“闲”两种状态，“忙”表示令牌已经被占用，而“闲”则表示令牌没有被占用。</li><li>想要发送数据的计算机必须首先检测到“闲”令牌，并将其置为“忙”状态，然后才可以发送数据，这就和申请互斥锁的过程很像。</li><li>此外，由于“令牌”在网环上是按顺序依次传递的，因此对于所有入网的计算机而言，它们获取令牌的机会都是相等的，因此不会造成某台主机发送数据的饥饿问题。</li></ul> 
<h3><a id="22MAC_66"></a>2.2MAC帧格式</h3> 
<p>MAC帧是数据链路层的一种数据数据格式，用于在局域网（以太网）传递数据。</p> 
<p><img src="https://images2.imgbox.com/84/91/LV01MOnt_o.png" alt="QQ_1723168031354"></p> 
<ul><li>源地址和目的地址是指网卡的硬件地址（也叫MAC地址），长度是48位，是在网卡出厂时固化的。</li><li>帧协议类型字段有三种值，分别对应IP协议（0800）、ARP协议（0806）和RARP协议（8035）。</li><li>帧末尾是CRC校验码。</li></ul> 
<p><strong>（1）MAC帧如何将报头与有效载荷进行分离？</strong></p> 
<p>以太网MAC帧的帧头和帧尾都是固定长度的，因此当底层收到一个MAC帧后，直接提取出MAC帧当中固定长度的帧头和帧尾，此时剩下的就是有效载荷了。</p> 
<p><strong>（2）MAC帧如何决定将有效载荷交付给上层的哪一个协议？</strong></p> 
<p>以太网MAC帧对应的上层协议不止一种，因此在将MAC帧的报头和有效载荷分离后，还需要确定应该将分离出来的有效载荷交付给上层的哪一个协议。</p> 
<p>在MAC帧的帧头当中有2个字节的类型字段，因此在分离出报头和有效载荷后，根据该字段将有效载荷交付给对应的上层协议即可。</p> 
<p><strong>（3）数据传输过程</strong></p> 
<p>假设局域网当中的主机A想要将IP数据报发送给同一局域网当中的主机B，那么主机A封装MAC帧当中的目的地址就是主机B的MAC地址，源地址就是主机A的MAC地址，而帧协议的类型对应就是0800，紧接着就是要发送的IP数据报，帧尾部分对应就是CRC校验。</p> 
<p>当主机A将该MAC帧发送到局域网当中后，局域网当中的所有主机都可以收到这个MAC帧，包括主机A自己。</p> 
<ul><li>主机A收到该MAC帧后，可以对收到的MAC帧进行CRC校验，如果校验失败则说明数据发送过程中产生了碰撞，此时主机A就会执行碰撞避免算法，后续进行MAC帧重发。</li><li>主机B收到该MAC帧后，提取出MAC帧当中的目的地址，发现该目的地址与自己的MAC地址相同，于是在CRC校验成功后就会将有效载荷交付给上层IP层（0800）进行进一步处理。</li><li>局域网中的其他主机收到该MAC帧后，也会提取出MAC帧当中的目的地址，但发现该目的地址与自己的MAC地址不匹配，于是就会直接将这个MAC帧丢弃掉。</li></ul> 
<p>也就是说，当底层收到一个MAC帧后，会根据MAC帧当中的目的地址来判断该MAC帧是否是发给自己的，如果是发送给自己的则会再对其进行CRC校验，如果校验成功则会根据该MAC帧的帧协议类型，将该MAC交付给对应的上层协议进行处理，如果不是发送给自己的则在数据链路层直接将数据丢弃。</p> 
<p><strong>（4）认识MAC地址</strong></p> 
<ul><li>MAC地址用来识别数据链路层中相连的节点。</li><li>长度为48位，及6个字节，一般用16进制数字加上冒号的形式来表示，例如：08:00:27:03:fb:19。</li><li>在网卡出厂时就确定了，不能修改，MAC地址通常是唯一的（虚拟机中的MAC地址不是真实的MAC地址，可能会冲突；也有些网卡支持用户配置MAC地址）。</li></ul> 
<p>我们可以通过ifconfig命令来查看我们的MAC地址。</p> 
<p><img src="https://images2.imgbox.com/99/3b/rZf2Jr14_o.png" alt="QQ_1723168466230"></p> 
<blockquote> 
 <p>ether：以太。</p> 
</blockquote> 
<p><strong>（5）对比理解MAC地址和IP地址</strong></p> 
<p>实际数据在路由过程中会存在两套地址，一套是源IP地址和目的IP地址，还有一套是源MAC地址和目的MAC地址。</p> 
<ul><li>IP地址描述的是数据通信总体的起点和终点。</li><li>MAC地址描述的是数据通信上的每一个区间的起点和终点。</li></ul> 
<p>比如唐僧取经，源IP地址就是东土大唐，目的IP地址就是西天，而源MAC地址就是取经路途上一个区间内的起点，目的MAC地址就是取经路途上一个区间内的终点。</p> 
<p>因此数据在路由过程中，源IP地址和目的IP地址可以理解成是不会变化的（但实际上由于NAT技术，源IP地址也是会发生变化的），而数据每进行一跳后其源MAC地址和目的MAC地址都会变化。</p> 
<p><strong>（6）认识MTU</strong></p> 
<p>MTU（Maximum Transmission Unit，最大传输单元）描述的是底层数据帧一次最多可以发送的数据量，这个限制是不同的数据链路层对应的物理层产生的。</p> 
<ul><li>以太网对应MTU的值一般是1500字节，不同的网络类型有不同的MTU，如果一次要发送的数据超过了MTU，则需要在IP层对数据进行分片（fragmentation）。</li><li>此外，以太网规定MAC帧中数据的最小长度为46字节，如果发送数据量小于46字节，则需要在数据后面补填充位，比如ARP数据包的长度就是不够46字节的。</li></ul> 
<p><strong>（7）认识MSS</strong></p> 
<p>由于数据链路层限制了单次数据传输的数据量（MTU），所以为了避免数据在网络层进行IP分片，我们应在传输层对向网络层交付的数据大小加以控制。</p> 
<p>我们将TCP的单个数据报的最大报文长度，称为MSS（Max Segment Size）。</p> 
<p>TCP通信双方在建立连接的过程中，就会进行MSS协商，最终选取双方支持的MSS值当中的<strong>较小值</strong>作为最终MSS。</p> 
<blockquote> 
 <p>MSS的值实际就是在TCP首部的40字节的选项字段当中的（kind=2）。</p> 
</blockquote> 
<p>最理想的情况下，MSS的值正好就是在数据不会在IP层进行分片的最大长度。</p> 
<p>MSS和MTU的关系如下：</p> 
<p><img src="https://images2.imgbox.com/6d/d4/cNQV9NDe_o.png" alt="QQ_1723169159367"></p> 
<h2><a id="3ARP_144"></a>3.ARP协议</h2> 
<p>地址解析协议（Address Resolution Protocol，ARP）协议，是根据IP地址获取MAC地址的一个TCP/IP协议。</p> 
<h3><a id="31ARP_148"></a>3.1为什么有ARP协议？</h3> 
<p>ARP 协议建立了主机 IP 地址 和 MAC 地址 的映射关系。</p> 
<ul><li>在网络通讯时，源主机的应用程序知道目的主机的 IP 地址和端口号，却不知道目的主机的硬件地址（MAC地址）；</li><li>数据包首先是被网卡接收到再去处理上层协议的，如果接收到的数据包的硬件地址与本机不符，则直接丢弃；</li><li>因此在通讯前必须获得目的主机的硬件地址。</li></ul> 
<h3><a id="32ARP_156"></a>3.2ARP的定位</h3> 
<p>在TCP/IP四层模型中，网络协议栈自顶向下分为应用层、传输层、网络层和数据链路层。</p> 
<p>其中应用层最典型的协议有HTTP、HTTPS和DNS等，传输层最典型的协议有TCP和UDP，网络层最典型的协议就是IP，数据链路层最典型的协议就是MAC帧协议，但实际数据链路层还有两种协议叫做ARP和RARP。</p> 
<p><img src="https://images2.imgbox.com/fd/0e/0C4czG9q_o.png" alt="QQ_1723169474831"></p> 
<p>ARP、RARP和MAC帧协议虽然都属于数据链路层的协议，但ARP协议和RARP协议属于MAC帧的上层协议。</p> 
<p>也就是说，MAC帧的上层协议不一定就直接是网络层的协议，MAC帧的上层协议有可能也属于数据链路层的协议，但就是位于MAC帧的上层。</p> 
<blockquote> 
 <p>网络层当中的ICMP协议和IGMP协议，这两个协议虽然与IP协议都属于网络层，但这两个协议属于IP的上层协议。</p> 
</blockquote> 
<h3><a id="33ARP_170"></a>3.3ARP协议工作流程</h3> 
<p><img src="https://images2.imgbox.com/48/4e/JLpHbq8R_o.png" alt="QQ_1723170399916"></p> 
<ol><li>源主机发出 “ARP请求”，询问“IP 地址是 172.20.1.2 的主机的硬件地址是多少”，并将这个请求广播到本地网段（以太网帧首部的硬件地址填 FF:FF:FF:FF:FF:FF 表示广播）。</li><li>目的主机接收到广播的 ARP请求，发现其中的 IP 地址与本机相符，则发送一个 “ARP应答” 数据包 给源主机，将自己的硬件地址填写在应答包中；</li><li>每台主机都维护一个 ARP 缓存表，可以用<code>arp -a</code>命令查看。 缓存表中的表项有过期时间（一般为 20 分钟），如果 20 分钟内没有再次使用某个表项，则该表项失效，下次还要发 ARP 请求来获得目的主机的硬件地址。</li></ol> 
<img src="https://images2.imgbox.com/df/bc/EMsrJ1wh_o.png" alt="QQ_1723170928361"> 
<h3><a id="34ARP_180"></a>3.4ARP数据格式</h3> 
<p><img src="https://images2.imgbox.com/31/9b/CfDYfbdo_o.png" alt="QQ_1723169662165"></p> 
<ul><li>硬件类型指链路层的网络类型，1为以太网。</li><li>协议类型指要将什么类型的地址转换为MAC地址，0800为IP地址。</li><li>硬件地址长度对于以太网地址为6字节，因为MAC地址是48位的，该字段如果硬件类型为以太网，则填6。</li><li>协议地址长度对于IP地址为4字节，因为IP地址是32位的，该字段如果协议类型为IP，则填4。</li><li>op字段为1表示ARP请求，op字段为2表示ARP应答。</li></ul> 
<p>从ARP的数据格式也可以看出，ARP是MAC帧协议的上层协议，ARP数据格式中的前3个字段和最后一个字段对应的就是以太网首部，但由于ARP数据包的长度不足46字节，因此ARP数据包在封装成为MAC帧时还需要补上18字节的填充字段。</p> 
<p>所以根据MAC帧中的类型字段，可以决定将该MAC帧交付给上层的哪一个协议：IP协议、ARP协议还是RARP协议。</p> 
<h2><a id="4RARP_194"></a>4.RARP协议</h2> 
<p>RARP（Reverse Address Resolution Protocol，反向地址转换协议），是根据MAC地址获取IP地址的一个TCP/IP协议。</p> 
<p>也就是说，某些情况下我们可能只知道一台主机的MAC地址，此时要得知该主机的IP地址就可以使用RARP协议。</p> 
<p>理论上来说，RARP协议一定比ARP协议简单，因为既然我们已经知道一台主机的MAC地址了，那么我们就已经可以直接向给主机发送消息了，因此我们可以直接发消息询问对方的IP地址就行了。</p> 
<hr> 
<p>不了解自我，我们的内心便没有办法得到完全的满足。 —斯瓦米·拉玛</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3a44ceb48ec09859a719c0f4bc0346a1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">苹果秋季发布会前瞻：iPhone 16领衔新品盛宴</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5f165a123f3317be764233f16fcacba4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【STM32】时钟体系</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>