<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python---爬取QQ音乐 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/9d89c1be744e3d7d6b1bdaef32c31a3a/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="python---爬取QQ音乐">
  <meta property="og:description" content="如Cookie为非vip，仅能获取非vip歌曲 1.下载包 pip install jsonpath 2.代码 import os import time import requests from jsonpath import jsonpath def search_and_download_qq_music(query_text): headers = { &#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36 Edg/128.0.0.0&#39;, &#39;Cookie&#39;: &#39;you cookie here&#39; } # 请求的链接 # query_text = &#39;Black Myth wukong&#39; search_url = rf&#39;https://u.y.qq.com/cgi-bin/musicu.fcg?data={{&#34;comm&#34;:{{&#34;g_tk&#34;:235530277,&#34;uin&#34;:&#34;1152921504916411742&#34;,&#34;format&#34;:&#34;json&#34;,&#34;inCharset&#34;:&#34;utf-8&#34;,&#34;outCharset&#34;:&#34;utf-8&#34;,&#34;notice&#34;:0,&#34;platform&#34;:&#34;h5&#34;,&#34;needNewCode&#34;:1,&#34;ct&#34;:23,&#34;cv&#34;:0}},&#34;req_0&#34;:{{&#34;method&#34;:&#34;DoSearchForQQMusicDesktop&#34;,&#34;module&#34;:&#34;music.search.SearchCgiService&#34;,&#34;param&#34;:{{&#34;remoteplace&#34;:&#34;txt.mqq.all&#34;,&#34;searchid&#34;:&#34;64237725668973550&#34;,&#34;search_type&#34;:0,&#34;query&#34;:&#34;{query_text}&#34;,&#34;page_num&#34;:1,&#34;num_per_page&#34;:20}}}}}}&#39; response = requests.get(search_url) music_list = jsonpath(response.json(), &#39;$..data.body.song.list&#39;)[0] # print(f&#39;music_list: {music_list}&#39;) if not os.path.exists(&#39;Q Music&#39;): os.mkdir(&#39;Q Music&#39;) for item in music_list: music_mid = jsonpath(item, &#39;$.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-09-03T16:49:34+08:00">
    <meta property="article:modified_time" content="2024-09-03T16:49:34+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python---爬取QQ音乐</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="Cookievipvip_1"></a>如Cookie为非vip，仅能获取非vip歌曲</h4> 
<h4><a id="1_2"></a>1.下载包</h4> 
<pre><code class="prism language-python">pip install jsonpath 
</code></pre> 
<h4><a id="2_7"></a>2.代码</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> time
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> jsonpath <span class="token keyword">import</span> jsonpath

<span class="token keyword">def</span> <span class="token function">search_and_download_qq_music</span><span class="token punctuation">(</span>query_text<span class="token punctuation">)</span><span class="token punctuation">:</span>

    headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36 Edg/128.0.0.0'</span><span class="token punctuation">,</span>
        <span class="token string">'Cookie'</span><span class="token punctuation">:</span> <span class="token string">'you cookie here'</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 请求的链接</span>
    <span class="token comment"># query_text = 'Black Myth wukong'</span>
    search_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">rf'https://u.y.qq.com/cgi-bin/musicu.fcg?data={<!-- -->{"comm":{<!-- -->{"g_tk":235530277,"uin":"1152921504916411742","format":"json","inCharset":"utf-8","outCharset":"utf-8","notice":0,"platform":"h5","needNewCode":1,"ct":23,"cv":0}},"req_0":{<!-- -->{"method":"DoSearchForQQMusicDesktop","module":"music.search.SearchCgiService","param":{<!-- -->{"remoteplace":"txt.mqq.all","searchid":"64237725668973550","search_type":0,"query":"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>query_text<span class="token punctuation">}</span></span><span class="token string">","page_num":1,"num_per_page":20}}}}}}'</span></span>

    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>search_url<span class="token punctuation">)</span>
    music_list <span class="token operator">=</span> jsonpath<span class="token punctuation">(</span>response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'$..data.body.song.list'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment"># print(f'music_list: {music_list}')</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'Q Music'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span><span class="token string">'Q Music'</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> item <span class="token keyword">in</span> music_list<span class="token punctuation">:</span>
        music_mid <span class="token operator">=</span> jsonpath<span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">'$.mid'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        music_name <span class="token operator">=</span> jsonpath<span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token string">'$.name'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

        <span class="token comment"># print(f'music_name: {music_name}, music_mid: {music_mid}')</span>

        music_data_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">rf'https://u.y.qq.com/cgi-bin/musicu.fcg?data={<!-- -->{"comm":{<!-- -->{"cv":4747474,"ct":24,"format":"json","inCharset":"utf-8","outCharset":"utf-8","notice":0,"platform":"yqq.json","needNewCode":1,"uin":"1152921504916411742","g_tk_new_20200303":1849600344,"g_tk":1849600344}},"req_9":{<!-- -->{"module":"vkey.GetVkeyServer","method":"CgiGetVkey","param":{<!-- -->{"guid":"4868259520","songmid":["</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>music_mid<span class="token punctuation">}</span></span><span class="token string">"],"songtype":[0],"uin":"1152921504916411742","loginflag":1,"platform":"20"}}}}}}'</span></span>
        music_data_response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>music_data_url<span class="token punctuation">)</span>
        <span class="token comment"># print(f'music_data_response: {music_data_response.json()}')</span>

        data_info <span class="token operator">=</span> jsonpath<span class="token punctuation">(</span>music_data_response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'$..purl'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token comment"># print(f'data_info: {data_info}')</span>

        music_url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'https://dl.stream.qqmusic.qq.com/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>data_info<span class="token punctuation">}</span></span><span class="token string">'</span></span>

        music_response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>music_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'./Q Music/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>music_name<span class="token punctuation">}</span></span><span class="token string">.mp3'</span></span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
            <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>music_response<span class="token punctuation">.</span>content<span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'《</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>music_name<span class="token punctuation">}</span></span><span class="token string">》下载成功'</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"-"</span> <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>

        <span class="token comment"># break</span>

search_and_download_qq_music<span class="token punctuation">(</span><span class="token string">"Black Myth wukong"</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>如果有所帮助请给个免费的赞吧~有人看才是支撑我写下去的动力！</strong></p> 
<p><strong>声明：</strong><br> 本文仅用作学习记录和交流</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/86f0846243bd55464f390b7d898261b7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">从手控到声控，NRK3502离线语音芯片赋能智能风扇解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c1e1d8da1c99c246b187626181c5391a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Hadoop|HDFS篇】HDFS概述</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>