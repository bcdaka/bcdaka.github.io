<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【超详细】Python datetime（当前日期、时间戳转换、前一天日期等）【附：时区原理详解】 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/d146eba844e44151e4a782119cbab374/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【超详细】Python datetime（当前日期、时间戳转换、前一天日期等）【附：时区原理详解】">
  <meta property="og:description" content="文章目录 相关文献当前时间前一天日期、后一天日期东八区（北京）时间时间戳转换datetime -&gt; strstr -&gt; datetimedatetime -&gt; timestamp(时间戳)timestamp -&gt; datetime 获取日期中的年、季度、月、周、日、小时、分、秒等时区原理时区问题复杂性的来源深入理解 datetime 的坑不同函数时区标准不同timezone 时区偏移以西为正，以东为负，和ISO标准相反笔者建议 datetime 源码解读pytz 源码解读 作者：小猪快跑 基础数学&amp;计算数学，从事优化领域6年&#43;，主要研究方向：MIP求解器、整数规划、随机规划、智能优化算法
python3 的时区是一个很容易出错的地方。本篇将从原理层面剖析时区概念，让读者真正学懂时区，不踩坑。
如有错误，欢迎指正。如有更好的算法，也欢迎交流！！！——@小猪快跑
相关文献 datetime — Basic date and time types — Python 3.12.4 documentation简述时区问题复杂性来源（Python 版） - 知乎 (zhihu.com) 当前时间 from datetime import datetime print(datetime.now()) # 2024-07-12 14:39:59.531525 前一天日期、后一天日期 from datetime import datetime, timedelta dt = datetime(2024, 1, 1) dt &#43; timedelta(1) # datetime.datetime(2024, 1, 2, 0, 0) dt - timedelta(1) # datetime.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-21T11:29:29+08:00">
    <meta property="article:modified_time" content="2024-07-21T11:29:29+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【超详细】Python datetime（当前日期、时间戳转换、前一天日期等）【附：时区原理详解】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_15" rel="nofollow">相关文献</a></li><li><a href="#_22" rel="nofollow">当前时间</a></li><li><a href="#_33" rel="nofollow">前一天日期、后一天日期</a></li><li><a href="#_49" rel="nofollow">东八区（北京）时间</a></li><li><a href="#_61" rel="nofollow">时间戳转换</a></li><li><ul><li><a href="#datetime__str_63" rel="nofollow">datetime -&gt; str</a></li><li><a href="#str__datetime_87" rel="nofollow">str -&gt; datetime</a></li><li><a href="#datetime__timestamp_96" rel="nofollow">datetime -&gt; timestamp(时间戳)</a></li><li><a href="#timestamp__datetime_106" rel="nofollow">timestamp -&gt; datetime</a></li></ul> 
   </li><li><a href="#_146" rel="nofollow">获取日期中的年、季度、月、周、日、小时、分、秒等</a></li><li><a href="#_171" rel="nofollow">时区原理</a></li><li><ul><li><a href="#_173" rel="nofollow">时区问题复杂性的来源</a></li><li><a href="#_datetime__234" rel="nofollow">深入理解 datetime 的坑</a></li><li><ul><li><a href="#_236" rel="nofollow">不同函数时区标准不同</a></li><li><a href="#timezone_ISO_304" rel="nofollow">timezone 时区偏移以西为正，以东为负，和ISO标准相反</a></li><li><a href="#_316" rel="nofollow">笔者建议</a></li></ul> 
    </li><li><a href="#datetime__324" rel="nofollow">datetime 源码解读</a></li><li><a href="#pytz__352" rel="nofollow">pytz 源码解读</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<br> 
<strong>作者：小猪快跑</strong> 
<p></p> 
<p>基础数学&amp;计算数学，从事优化领域6年+，主要研究方向：MIP求解器、整数规划、随机规划、智能优化算法</p> 
<p>python3 的时区是一个很容易出错的地方。本篇将从原理层面剖析时区概念，让读者真正学懂时区，不踩坑。</p> 
<p><font color="gray"><em>如有错误，欢迎指正。如有更好的算法，也欢迎交流！！！——@小猪快跑</em></font></p> 
<h3><a id="_15"></a>相关文献</h3> 
<ul><li><a href="https://docs.python.org/3/library/datetime.html" rel="nofollow">datetime — Basic date and time types — Python 3.12.4 documentation</a></li><li><a href="https://zhuanlan.zhihu.com/p/355772985" rel="nofollow">简述时区问题复杂性来源（Python 版） - 知乎 (zhihu.com)</a></li></ul> 
<h3><a id="_22"></a>当前时间</h3> 
<pre><code class="prism language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">print</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 2024-07-12 14:39:59.531525</span>
</code></pre> 
<h3><a id="_33"></a>前一天日期、后一天日期</h3> 
<pre><code class="prism language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime<span class="token punctuation">,</span> timedelta

dt <span class="token operator">=</span> datetime<span class="token punctuation">(</span><span class="token number">2024</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

dt <span class="token operator">+</span> timedelta<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># datetime.datetime(2024, 1, 2, 0, 0)</span>

dt <span class="token operator">-</span> timedelta<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># datetime.datetime(2023, 12, 31, 0, 0)</span>
</code></pre> 
<h3><a id="_49"></a>东八区（北京）时间</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pytz
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token keyword">print</span><span class="token punctuation">(</span>datetime<span class="token punctuation">(</span><span class="token number">2024</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span>pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">'Etc/GMT-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 2024-01-01 00:00:00+08:00</span>
</code></pre> 
<h3><a id="_61"></a>时间戳转换</h3> 
<h4><a id="datetime__str_63"></a>datetime -&gt; str</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pytz
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

dt <span class="token operator">=</span> datetime<span class="token punctuation">(</span><span class="token number">2024</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span>pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">'Etc/GMT-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

fmt <span class="token operator">=</span> <span class="token string">'%Y-%m-%d %H:%M:%S%z'</span>
dt<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>fmt<span class="token punctuation">)</span>
<span class="token comment"># 2024-01-01 00:00:00+0800</span>

fmt <span class="token operator">=</span> <span class="token string">'%a %d %b %Y, %I:%M%p'</span>
dt<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>fmt<span class="token punctuation">)</span>
<span class="token comment"># Mon 01 Jan 2024, 12:00AM</span>

fmt <span class="token operator">=</span> <span class="token string">'%d/%m/%y %H:%M:%S.%f'</span>
dt<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span>fmt<span class="token punctuation">)</span>
<span class="token comment"># 01/01/24 00:00:00.000000</span>

<span class="token string">'The {1} is {0:%d}, the {2} is {0:%B}, the {3} is {0:%I:%M%p}.'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>dt<span class="token punctuation">,</span> <span class="token string">"day"</span><span class="token punctuation">,</span> <span class="token string">"month"</span><span class="token punctuation">,</span> <span class="token string">"time"</span><span class="token punctuation">)</span>
<span class="token comment"># 'The day is 01, the month is January, the time is 12:00AM.'</span>
</code></pre> 
<h4><a id="str__datetime_87"></a>str -&gt; datetime</h4> 
<pre><code class="prism language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span><span class="token string">"21/11/06 16:30"</span><span class="token punctuation">,</span> <span class="token string">"%d/%m/%y %H:%M"</span><span class="token punctuation">)</span>
<span class="token comment"># datetime.datetime(2006, 11, 21, 16, 30)</span>
</code></pre> 
<h4><a id="datetime__timestamp_96"></a>datetime -&gt; timestamp(时间戳)</h4> 
<pre><code class="prism language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

dt <span class="token operator">=</span> datetime<span class="token punctuation">(</span><span class="token number">2024</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
dt<span class="token punctuation">.</span>timestamp<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 1704038400.0</span>
</code></pre> 
<h4><a id="timestamp__datetime_106"></a>timestamp -&gt; datetime</h4> 
<pre><code class="prism language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

datetime<span class="token punctuation">.</span>fromtimestamp<span class="token punctuation">(</span><span class="token number">1704038400</span><span class="token punctuation">)</span>
<span class="token comment"># datetime.datetime(2024, 1, 1, 0, 0)</span>
</code></pre> 
<p>下面列出了 1989 年 C 标准所要求的所有格式代码，这些代码可在所有使用标准 C 实现的平台上运行。</p> 
<table><thead><tr><th>指令</th><th>含义</th><th>样例</th></tr></thead><tbody><tr><td>%a</td><td>工作日作为地方缩写名称。</td><td>Sun, Mon, …, Sat (en_US);So, Mo, …, Sa (de_DE)</td></tr><tr><td>%A</td><td>作为地区全称的工作日。</td><td>Sunday, Monday, …, Saturday (en_US);Sonntag, Montag, …, Samstag (de_DE)</td></tr><tr><td>%w</td><td>以十进制数字表示的工作日，其中 0 代表周日，6 代表周六。</td><td>0, 1, …, 6</td></tr><tr><td>%d</td><td>以小数点后 0 位数字表示的月日。</td><td>01, 02, …, 31</td></tr><tr><td>%b</td><td>月（Month）作为本地语言的缩写名称。</td><td>Jan, Feb, …, Dec (en_US);Jan, Feb, …, Dez (de_DE)</td></tr><tr><td>%B</td><td>以本地全称表示的月份。</td><td>January, February, …, December (en_US);Januar, Februar, …, Dezember (de_DE)</td></tr><tr><td>%m</td><td>以十进制零位表示的月份。</td><td>01, 02, …, 12</td></tr><tr><td>%y</td><td>以小数点后零位的数字表示不带世纪的年份。</td><td>00, 01, …, 99</td></tr><tr><td>%Y</td><td>带世纪的年为十进制数。</td><td>0001, 0002, …, 2013, 2014, …, 9998, 9999</td></tr><tr><td>%H</td><td>小时（24 小时制时钟）为零位小数。</td><td>00, 01, …, 23</td></tr><tr><td>%I</td><td>小时（12 小时钟）为零位小数。</td><td>01, 02, …, 12</td></tr><tr><td>%p</td><td>当地的上午或下午。</td><td>AM, PM (en_US);am, pm (de_DE)</td></tr><tr><td>%M</td><td>分钟，小数点后零位。</td><td>00, 01, …, 59</td></tr><tr><td>%S</td><td>秒（小数点后零位）。</td><td>00, 01, …, 59</td></tr><tr><td>%f</td><td>微秒为十进制数，置零后为 6 位数。</td><td>000000, 000001, …, 999999</td></tr><tr><td>%z</td><td>UTC偏移量，格式为±HHMM[SS[.fffffff]]（如果对象为空字符串）。</td><td>(empty), +0000, -0400, +1030, +063415, -030712.345216</td></tr><tr><td>%Z</td><td>时区名称（如果对象为非正则表达式，则为空字符串）。</td><td>(empty), UTC, GMT</td></tr><tr><td>%j</td><td>以十进制零位形式表示的年日。</td><td>001, 002, …, 366</td></tr><tr><td>%U</td><td>年份的星期数（星期日为一周的第一天），以十进制零位表示。在新的一年中，第一个星期日之前的所有天数都被视为第 0 周。</td><td>00, 01, …, 53</td></tr><tr><td>%W</td><td>年的周号（周一为一周的第一天），小数点后加 0。在新的一年中，第一个星期一之前的所有日子都被视为第 0 周。</td><td>00, 01, …, 53</td></tr><tr><td>%c</td><td>当地语言的日期和时间表示法。</td><td>Tue Aug 16 21:30:00 1988 (en_US);Di 16 Aug 21:30:00 1988 (de_DE)</td></tr><tr><td>%x</td><td>本地语言的日期表示法。</td><td>08/16/88 (None);08/16/1988 (en_US);16.08.1988 (de_DE)</td></tr><tr><td>%X</td><td>当地语言中合适的时间表示法。</td><td>21:30:00 (en_US);21:30:00 (de_DE)</td></tr><tr><td>%%</td><td>字面"%"字符。</td><td>%</td></tr></tbody></table> 
<h3><a id="_146"></a>获取日期中的年、季度、月、周、日、小时、分、秒等</h3> 
<pre><code class="prism language-python"><span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

dt <span class="token operator">=</span> datetime<span class="token punctuation">.</span>strptime<span class="token punctuation">(</span><span class="token string">"21/11/06 16:30"</span><span class="token punctuation">,</span> <span class="token string">"%d/%m/%y %H:%M"</span><span class="token punctuation">)</span>

<span class="token comment"># Using datetime.timetuple() to get tuple of all attributes</span>
tt <span class="token operator">=</span> dt<span class="token punctuation">.</span>timetuple<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> it <span class="token keyword">in</span> tt<span class="token punctuation">:</span>   
    <span class="token keyword">print</span><span class="token punctuation">(</span>it<span class="token punctuation">)</span>

<span class="token number">2006</span>    <span class="token comment"># year</span>
<span class="token number">11</span>      <span class="token comment"># month</span>
<span class="token number">21</span>      <span class="token comment"># day</span>
<span class="token number">16</span>      <span class="token comment"># hour</span>
<span class="token number">30</span>      <span class="token comment"># minute</span>
<span class="token number">0</span>       <span class="token comment"># second</span>
<span class="token number">1</span>       <span class="token comment"># weekday (0 = Monday)</span>
<span class="token number">325</span>     <span class="token comment"># number of days since 1st January</span>
<span class="token operator">-</span><span class="token number">1</span>      <span class="token comment"># dst - method tzinfo.dst() returned None</span>
</code></pre> 
<h3><a id="_171"></a>时区原理</h3> 
<h4><a id="_173"></a>时区问题复杂性的来源</h4> 
<ul><li> <p><strong>DST (Daylight Saving Time) 夏令时</strong></p> 
  <ul><li> <p>是一种在<strong>夏季</strong>期间将时钟<strong>向前调整一小时</strong>的做法，目的是为了在白天较长的季节里更有效地利用自然光照，从而节省能源。在夏令时期间，人们可以享受到更多的日光时间，理论上可以减少照明需求。</p> </li><li> <p>夏令时的实施通常遵循以下模式：</p> 
    <ul><li> <p>在春季，时钟在特定的周末（通常是三月或四月的某个周日）凌晨2点时向前调整一小时，变为3点。</p> </li><li> <p>在秋季，时钟则在特定的周末（通常是十月或十一月的某个周日）凌晨2点时向后调整一小时，回到1点。</p> </li></ul> </li><li> <p>不过，每个国家和地区的具体规则可能有所不同，有些地区可能不实行夏令时。</p> </li><li> <p>在中国，曾经在1986年至1991年间实行过夏令时，具体的调整时间为：</p> 
    <ul><li>每年从四月中旬第一个星期日的凌晨2时整（北京时间），将时钟拨快一小时，即从2时跳至3时，夏令时开始；</li><li>到九月中旬第一个星期日的凌晨2时整（北京夏令时），再将时钟拨回一小时，即从2时跳回至1时，夏令时结束。</li></ul> </li><li> <p>自1992年起，中国暂停实行夏令时，目前中国全境全年使用的是北京时间，即东八区的标准时间，没有进行夏令时调整。</p> </li></ul> </li><li> <p><strong>ST(Standard Time) 冬令时</strong></p> 
  <ul><li>指的是在不实行夏令时（Daylight Saving Time，DST）调整的时期内所采用的标准时间。在那些实行夏令时的地区，冬令时实际上就是全年时间中的“正常”时间，而在夏令时期间，时钟会向前调快一个小时。</li><li>当夏令时结束，通常在每年的秋季，时钟会被拨回一小时，恢复到冬令时。这一调整意味着日落时间会提前，白天的时间会相应缩短，而晚上则会提早变暗。冬令时的目的是在冬季减少能源消耗，尤其是在北半球，因为冬季的日光时间较短，不需要额外延长日光时间来节约能源。</li><li>中国在1986年至1991年间曾经实行过夏令时，相应的，在这期间的非夏令时阶段即为所谓的“冬令时”。然而，自1992年起，中国停止实行夏令时，因此也不再有冬令时的概念。目前，中国全境全年使用的是北京时间，即东八区的标准时间（UTC+8），不再进行任何季节性的时间调整。</li><li>在世界其他实行夏令时的国家和地区，冬令时通常是从每年的秋季持续到次年的春季，具体日期可能因国家而异。例如，美国和加拿大在每年11月的第一个周日开始冬令时，而欧洲大多数国家则在10月的最后一个周日开始。</li></ul> </li><li> <p><strong>GMT (Greenwich Mean Time) 格林尼治标准时间</strong></p> 
  <ul><li>这是以英国格林尼治天文台观测结果得出的时间，这是英国格林尼治当地时间，这个地方的当地时间过去被当成世界标准的时间。</li></ul> </li><li> <p><strong>UT (Universal Time) 世界时</strong></p> 
  <ul><li>以本初子午线的平子夜起算的平太阳时。又称格林尼治平时或格林尼治时间。各地的地方平时与世界时之差等于该地的地理经度。1960年以前曾作为基本时间计量系统被广泛应用。由于地球自转速度变化的影响，它不是一种均匀的时间系统。后来世界时先后被<strong>历书时</strong>和<strong>原子时</strong>所取代，但在日常生活、天文导航、大地测量和宇宙飞行等方面仍属必需；同时，世界时反映地球自转速率的变化，是地球自转参数之一，仍为天文学和地球物理学的基本资料。</li></ul> </li><li> <p><strong>TAI（International Atomic Time）国际原子时</strong></p> 
  <ul><li>原子时计量的基本单位：原子时秒。由原子钟导出。</li><li>原子时秒的定义：铯 -133 原子基态的两个超精细能级间在零磁场下跃迁辐射9,192,631,770周所持续的时间。</li><li>1967年第十三届国际计量大会(CGPM)决定，把在海平面实现的上述原子时秒，规定为国际单位制中的时间单位。根据原子时秒的定义，任何原子钟在确定起始历元后，都可以提供原子时。由各实验室用足够精确的铯原子钟导出的原子时称为地方原子时。</li><li>全世界大约有20多个国家的不同实验室分别建立了各自独立的地方原子时。国际时间根据比较、综合世界各地原子钟数据，最后确定的原子时，称为国际原子时，简称TAI。</li><li>TAI的起点是这样规定的：取1958年1月1日0时0分0秒世界时(UT)的瞬间作为同年同月同日0时0分0秒TAI。（事后发现，在该瞬间原子时与世界时的时刻之差为0.0039秒。这一差值就作为历史事实而保留下来。)</li><li>在确定原子时起点之后，由于地球自转速度不均匀，世界时与原子时之间的时差便逐年积累。由于世界时存在不均匀性和历书时的测定精度低，自1967年起，原子时已取代历书时作为基本的时间计量系统。</li></ul> </li><li> <p><strong>UTC (Universal Time Coordinated) 协调世界时：</strong></p> 
  <ul><li><strong>国际原子时</strong>的准确度为每日数<strong>纳秒</strong>，而<strong>世界时</strong>的准确度为每日数<strong>毫秒</strong>。许多应用部门要求时间系统接近世界时UT，对于这种情况，一种称为协调世界时的折中时标于1972年面世。为确保协调世界时与世界时相差不会超过0.9秒，在有需要的情况下会在协调世界时内加上正或负<strong>闰秒</strong>。因此协调世界时与国际原子时之间会出现若干整数秒的差别，两者之差逐年积累，便采用跳秒（闰秒）的方法使协调时与世界时的时刻相接近，其差不超过1s。它既保持时间尺度的均匀性，又能近似地反映地球自转的变化。 [2]按国际无线电咨询委员会（CCIR）通过的关于UTC的修正案，从1972年1月1日起UTC与UT1（在UT中加入极移改正得到）之间的差值最大可以达到±0.9s。位于巴黎的国际地球自转事务中央局负责决定何时加入闰秒。一般会在每年的6月30日、12月31日的最后一秒进行调整。</li><li><strong>原子时 + 自转因素（闰秒） = UTC</strong></li></ul> </li><li> <p><strong>LMT (Local Mean Time) 地方平时</strong></p> 
  <ul><li>地方平时是太阳时改变形式修正后，在指定的经度范围内使用一致时间的地方太阳时，他的一致性仅取决于测量用的钟表准确性。</li><li>地方平时从19世纪初期开始逐渐被采用，这些地区都不再使用地方太阳时或日晷的时间，直到每个国家都以各种不同的形式将之定为标准时间。标准时间意味着相同的时间使用在一些区域中— 通常，不是从格林威治标准时间中抵销就是选择区域内主要区域的地方时间作为标准时间。地方平时和视太阳时之间的差别就是均时差（equation of time）。</li><li>地球划分出不同的时区，每个时区都有一个自己的当地时间。比如上海 LMT 就是 UTC +08:06。</li><li><strong>原子时 + 自转因素（闰秒） + 地理因素 = LMT</strong></li></ul> </li><li> <p><strong>CST时间 China Standard Time</strong></p> 
  <ul><li>某个国家统一采用某个时区的时间，比如上海的采用标准时间，就是UTC+8小时。</li><li>夏令时/冬令时。比如美国会在夏季将时间拨快一个小时。这个时间称之为标准时间。</li><li>历史因素：比如中国曾在 1986 年到 1991 年的内实行过夏令时，以上海为例，他在1988年8月份的标准时间就是 UTC + 9:00, 而在 1988年 12 月份标准时间是 UTC + 8:00。</li><li><strong>原子时 + 自转因素（闰秒） + 法律因素（法律选区的特定时区、 冬令时、夏令时）+ 历史因素 = 当地标准时间</strong></li></ul> </li></ul> 
<p>以上几个因素是时区问题复杂度的来源，为了解决这个问题，人们成立了<strong>时区信息数据库</strong>，Linux 系统也是采用了该数据库来维护系统时间。</p> 
<h4><a id="_datetime__234"></a>深入理解 datetime 的坑</h4> 
<h5><a id="_236"></a>不同函数时区标准不同</h5> 
<p>创建 <strong>datetime</strong> 对象使用的是 <strong>LMT</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pytz
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token comment"># LMT</span>
datetime<span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span>pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">'Asia/Shanghai'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2021-01-01 00:00:00+08:06</span>
datetime<span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span>pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">'Asia/Tokyo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2021-01-01 00:00:00+09:19</span>
</code></pre> 
<p>转换时区函数 <strong>astimezone</strong> 输出是 <strong>ST/DST</strong>，除非输入时区 == 输出时区</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pytz
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

tz_sh <span class="token operator">=</span> datetime<span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span>pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">'Asia/Shanghai'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2021-01-01 00:00:00+08:06</span>
<span class="token comment"># UTC</span>
tz_sh<span class="token punctuation">.</span>astimezone<span class="token punctuation">(</span>pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">'Asia/Tokyo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2021-01-01 00:54:00+09:00</span>
<span class="token comment"># LMT</span>
tz_sh<span class="token punctuation">.</span>astimezone<span class="token punctuation">(</span>pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">'Asia/Shanghai'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2021-01-01 00:00:00+08:06</span>
</code></pre> 
<p>替换时区函数 <strong>replace</strong> 是 <strong>LMT</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pytz
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

tz_sh <span class="token operator">=</span> datetime<span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span>pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">'Asia/Shanghai'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2021-01-01 00:00:00+08:06</span>
tz_sh<span class="token punctuation">.</span>replace<span class="token punctuation">(</span>tzinfo<span class="token operator">=</span>pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">'Asia/Tokyo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2021-01-01 00:00:00+09:19</span>
</code></pre> 
<p>获取当前时间 <strong>datetime.now</strong> 是 <strong>ST/DST</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pytz
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token comment"># UTC</span>
datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span>tz<span class="token operator">=</span>pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">'Asia/Shanghai'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2024-07-18 14:37:33.706649+08:00</span>
</code></pre> 
<p><strong>normalize: LMT</strong> 转换成 <strong>ST/DST</strong>（注意1988年中国有夏令时）</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pytz
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

tz <span class="token operator">=</span> pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">"Asia/ShangHai"</span><span class="token punctuation">)</span>
tz<span class="token punctuation">.</span>normalize<span class="token punctuation">(</span>datetime<span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span>tz<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2020-12-31 23:54:00+08:00</span>
tz<span class="token punctuation">.</span>normalize<span class="token punctuation">(</span>datetime<span class="token punctuation">(</span><span class="token number">1988</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span>tz<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 1988-08-01 00:54:00+09:00</span>
</code></pre> 
<p><strong>localize</strong>：增加 <strong>ST/DST</strong>（注意1988年中国有夏令时）</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pytz
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

tz <span class="token operator">=</span> pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">"Asia/ShangHai"</span><span class="token punctuation">)</span>
tz<span class="token punctuation">.</span>localize<span class="token punctuation">(</span>datetime<span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2021-01-01 00:00:00+08:00</span>
tz<span class="token punctuation">.</span>localize<span class="token punctuation">(</span>datetime<span class="token punctuation">(</span><span class="token number">1988</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 1988-08-01 00:00:00+09:00</span>
</code></pre> 
<h5><a id="timezone_ISO_304"></a>timezone 时区偏移以西为正，以东为负，和ISO标准相反</h5> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pytz
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime

<span class="token comment"># 东八区</span>
datetime<span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span>pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">'Etc/GMT-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2021-01-01 00:00:00+08:00</span>
<span class="token comment"># 西八区</span>
datetime<span class="token punctuation">(</span><span class="token number">2021</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span>pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">'Etc/GMT+8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 2021-01-01 00:00:00-08:00</span>
</code></pre> 
<h5><a id="_316"></a>笔者建议</h5> 
<ul><li>如果不存在夏令时类似的情况，为了避免函数时区标准不同的麻烦，可以直接使用 <code>'Etc/GMT-8'</code>。</li><li>如果存在夏令时这些，那么在转换时要注意不同标准带来的误差。</li><li>尽量使用<strong>无时区信息的时间戳进行计算</strong></li></ul> 
<h4><a id="datetime__324"></a>datetime 源码解读</h4> 
<p>或许是由于时区非常复杂，datetime 时区仅提供了 tzinfo 的抽象类。可以使用常见的时区库：如 pytz。</p> 
<p>tzinfo 两个接口值得注意：</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">tzinfo</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">tzname</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> __dt<span class="token punctuation">:</span> datetime <span class="token operator">|</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span> <span class="token operator">|</span> <span class="token boolean">None</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">utcoffset</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> __dt<span class="token punctuation">:</span> datetime <span class="token operator">|</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> timedelta <span class="token operator">|</span> <span class="token boolean">None</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    	<span class="token comment"># Return the timezone offset as timedelta positive east of UTC (negative west of UTC).</span>
    	<span class="token comment"># 这是描述了该时区当地平均时间与 UTC 时间的偏移</span>
    <span class="token decorator annotation punctuation">@abstractmethod</span>
    <span class="token keyword">def</span> <span class="token function">dst</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> __dt<span class="token punctuation">:</span> datetime <span class="token operator">|</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> timedelta <span class="token operator">|</span> <span class="token boolean">None</span><span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">def</span> <span class="token function">fromutc</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> __dt<span class="token punctuation">:</span> datetime<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> datetime<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	    <span class="token comment"># datetime in UTC -&gt; datetime in local time.</span>
    	<span class="token comment"># 这个接口做的事情是将该UTC时间更改为当地标准时间。</span>
        <span class="token comment"># 这是一个法律概念上的时间，需要考虑到夏令时，历史等因素。</span>
</code></pre> 
<p>datetime 中更换时区的基本过程，通过两个时区相对于 utc 时间的偏移，计算出两个时区的时间间隔。加上该间隔，然后直接更换时区:</p> 
<p><strong>(dt+ timedelta).raplace(tz)</strong></p> 
<h4><a id="pytz__352"></a>pytz 源码解读</h4> 
<p>pytz 是时区信息数据库的 python 接口，使用了 tzif 文件来存储、描述时区，与 linux 相同。</p> 
<p><code>pytz.timezone("Asia/ShangHai")</code> 读取 tzif 文件中的信息创建对象。</p> 
<p><strong>一般我们认为 <code>pytz.timezone("Asia/ShangHai")</code> 是一个时区，其实这不完全正确，准确来说，<code>pytz.timezone("Asia/ShangHai")</code> 应该是一个地方时区库。</strong></p> 
<p>它存储了三个时区:</p> 
<ul><li>LMT +8:06</li><li>CST +8:00</li><li>CDT +9:00 （已废弃的夏令时）</li></ul> 
<p>可以通过一下代码进行查看</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pytz

pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">"Asia/ShangHai"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>_tzinfos
<span class="token comment"># {(datetime.timedelta(seconds=29160), datetime.timedelta(0), 'LMT'): &lt;DstTzInfo 'Asia/Shanghai' LMT+8:06:00 STD&gt;, (datetime.timedelta(seconds=28800), datetime.timedelta(0), 'CST'): &lt;DstTzInfo 'Asia/Shanghai' CST+8:00:00 STD&gt;, (datetime.timedelta(seconds=32400), datetime.timedelta(seconds=3600), 'CDT'): &lt;DstTzInfo 'Asia/Shanghai' CDT+9:00:00 DST&gt;}</span>
</code></pre> 
<p>pytz 库之所以被诟病的原因就是这三个时区的转换，让人有些难以把握。</p> 
<p>除了这些信息，他还记录了上海时区变迁的历史过程。 可以使用以下代码查看</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pytz

tz <span class="token operator">=</span> pytz<span class="token punctuation">.</span>timezone<span class="token punctuation">(</span><span class="token string">"Asia/ShangHai"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> a<span class="token punctuation">,</span> b <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>tz<span class="token punctuation">.</span>_utc_transition_times<span class="token punctuation">,</span> tz<span class="token punctuation">.</span>_transition_info<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
0001-01-01 00:00:00 (datetime.timedelta(seconds=29160), datetime.timedelta(0), 'LMT')
1901-12-13 20:45:52 (datetime.timedelta(seconds=28800), datetime.timedelta(0), 'CST')
1919-04-12 16:00:00 (datetime.timedelta(seconds=32400), datetime.timedelta(seconds=3600), 'CDT')
1919-09-30 15:00:00 (datetime.timedelta(seconds=28800), datetime.timedelta(0), 'CST')
1940-05-31 16:00:00 (datetime.timedelta(seconds=32400), datetime.timedelta(seconds=3600), 'CDT')
1940-10-12 15:00:00 (datetime.timedelta(seconds=28800), datetime.timedelta(0), 'CST')
1941-03-14 16:00:00 (datetime.timedelta(seconds=32400), datetime.timedelta(seconds=3600), 'CDT')
1941-11-01 15:00:00 (datetime.timedelta(seconds=28800), datetime.timedelta(0), 'CST')
1942-01-30 16:00:00 (datetime.timedelta(seconds=32400), datetime.timedelta(seconds=3600), 'CDT')
1945-09-01 15:00:00 (datetime.timedelta(seconds=28800), datetime.timedelta(0), 'CST')
1946-05-14 16:00:00 (datetime.timedelta(seconds=32400), datetime.timedelta(seconds=3600), 'CDT')
1946-09-30 15:00:00 (datetime.timedelta(seconds=28800), datetime.timedelta(0), 'CST')
1947-04-14 16:00:00 (datetime.timedelta(seconds=32400), datetime.timedelta(seconds=3600), 'CDT')
1947-10-31 15:00:00 (datetime.timedelta(seconds=28800), datetime.timedelta(0), 'CST')
1948-04-30 16:00:00 (datetime.timedelta(seconds=32400), datetime.timedelta(seconds=3600), 'CDT')
1948-09-30 15:00:00 (datetime.timedelta(seconds=28800), datetime.timedelta(0), 'CST')
1949-04-30 16:00:00 (datetime.timedelta(seconds=32400), datetime.timedelta(seconds=3600), 'CDT')
1949-05-27 15:00:00 (datetime.timedelta(seconds=28800), datetime.timedelta(0), 'CST')
1986-05-03 18:00:00 (datetime.timedelta(seconds=32400), datetime.timedelta(seconds=3600), 'CDT')
1986-09-13 17:00:00 (datetime.timedelta(seconds=28800), datetime.timedelta(0), 'CST')
1987-04-11 18:00:00 (datetime.timedelta(seconds=32400), datetime.timedelta(seconds=3600), 'CDT')
1987-09-12 17:00:00 (datetime.timedelta(seconds=28800), datetime.timedelta(0), 'CST')
1988-04-16 18:00:00 (datetime.timedelta(seconds=32400), datetime.timedelta(seconds=3600), 'CDT')
1988-09-10 17:00:00 (datetime.timedelta(seconds=28800), datetime.timedelta(0), 'CST')
1989-04-15 18:00:00 (datetime.timedelta(seconds=32400), datetime.timedelta(seconds=3600), 'CDT')
1989-09-16 17:00:00 (datetime.timedelta(seconds=28800), datetime.timedelta(0), 'CST')
1990-04-14 18:00:00 (datetime.timedelta(seconds=32400), datetime.timedelta(seconds=3600), 'CDT')
1990-09-15 17:00:00 (datetime.timedelta(seconds=28800), datetime.timedelta(0), 'CST')
1991-04-13 18:00:00 (datetime.timedelta(seconds=32400), datetime.timedelta(seconds=3600), 'CDT')
1991-09-14 17:00:00 (datetime.timedelta(seconds=28800), datetime.timedelta(0), 'CST')
"""</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5e2ab281302759e1e512f5c5c7c61b1e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mybatis-config.xml中的environments是什么？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/89ee5b27f14a8d10887dfc60fbf17cc2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;背包问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>