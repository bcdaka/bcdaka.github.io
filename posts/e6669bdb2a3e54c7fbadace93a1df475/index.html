<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【wiki知识库】05.分类管理模块--后端SpringBoot模块 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/e6669bdb2a3e54c7fbadace93a1df475/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【wiki知识库】05.分类管理模块--后端SpringBoot模块">
  <meta property="og:description" content="📝个人主页：哈__
期待您的关注 目录
一、🔥今日目标
二、☀SpringBoot代码修改
1.使用逆向工程生成Category表结构
2. 新增CategoryQueryParam
3.新增CategorySaveParam
4.新增CategotyQueryVo
三、🤖新增分类管理的相关接口
1. /category/all
2./category/save
3./category/delete
1.我们删除的是一个二级分类
2.我们删除的是一个一级分类
一、🔥今日目标 【wiki知识库】05.分类管理实现--前端Vue模块-CSDN博客
上一篇文章我把分类模块的前端部分给大家展示出来了，这篇文章主要是为了配合上一篇，其实这一篇文章应该先写到前边，然后在发前端的部分。文章的主要内容是把分类管理的后端接口写出来。
二、☀SpringBoot代码修改 不知道你是否还记得我们电子书模块后端接口书写的流程，【wiki知识库】02.wiki知识库SpringBoot后端的准备-CSDN博客，在这篇文章当中我是用逆向工程生成了Ebook的一些项目结构，现在我们需要Category模块。我们的第一步还是使用逆向工程。
1.使用逆向工程生成Category表结构 在我们util包下的 MybatisGenerator类中修改下方的代码，把我们的表换成category，然后运行代码。
2. 新增CategoryQueryParam package com.my.hawiki.param; import lombok.Data; import lombok.EqualsAndHashCode; @EqualsAndHashCode(callSuper = true) @Data public class CategoryQueryParam extends PageParam { } 3.新增CategorySaveParam package com.my.hawiki.param; import lombok.Data; import javax.validation.constraints.NotNull; @Data public class CategorySaveParam { private Long id; private Long parent; @NotNull(message = &#34;【名称】不能为空&#34;) private String name; @NotNull(message = &#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-05T16:06:08+08:00">
    <meta property="article:modified_time" content="2024-06-05T16:06:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【wiki知识库】05.分类管理模块--后端SpringBoot模块</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="text-align:center;"><img src="https://images2.imgbox.com/1e/a5/6jIRar3g_o.png" alt="427ef4152dbf4b6c92618a198935cb6c.png"></p> 
<p style="text-align:center;"> <strong> 📝个人主页：<a class="link-info" href="https://blog.csdn.net/qq_61024956?type=blog" title="哈__">哈__</a></strong></p> 
<p style="text-align:center;">期待您的关注 </p> 
<p style="text-align:center;"><img src="https://images2.imgbox.com/a3/01/ifQl6R17_o.gif" alt="1b7335aca73b41609b7f05d1d366f476.gif"></p> 
<p><strong>目录</strong></p> 
<p style="margin-left:0px;"> </p> 
<p style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%F0%9F%94%A5%E4%BB%8A%E6%97%A5%E7%9B%AE%E6%A0%87" rel="nofollow">一、🔥今日目标</a></p> 
<p style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E2%98%80SpringBoot%E4%BB%A3%E7%A0%81%E4%BF%AE%E6%94%B9" rel="nofollow">二、☀SpringBoot代码修改</a></p> 
<p style="margin-left:40px;"><a href="#1.%E4%BD%BF%E7%94%A8%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E7%94%9F%E6%88%90Category%E8%A1%A8%E7%BB%93%E6%9E%84" rel="nofollow">1.使用逆向工程生成Category表结构</a></p> 
<p style="margin-left:40px;"><a href="#%C2%A02.%20%E6%96%B0%E5%A2%9ECategoryQueryParam" rel="nofollow"> 2. 新增CategoryQueryParam</a></p> 
<p style="margin-left:40px;"><a href="#3.%E6%96%B0%E5%A2%9ECategorySaveParam" rel="nofollow">3.新增CategorySaveParam</a></p> 
<p style="margin-left:40px;"><a href="#4.%E6%96%B0%E5%A2%9ECategotyQueryVo" rel="nofollow">4.新增CategotyQueryVo</a></p> 
<p style="margin-left:0px;"> </p> 
<p style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%F0%9F%A4%96%E6%96%B0%E5%A2%9E%E5%88%86%E7%B1%BB%E7%AE%A1%E7%90%86%E7%9A%84%E7%9B%B8%E5%85%B3%E6%8E%A5%E5%8F%A3" rel="nofollow">三、🤖新增分类管理的相关接口</a></p> 
<p style="margin-left:40px;"><a href="#1.%20%2Fcategory%2Fall" rel="nofollow">1. /category/all</a></p> 
<p style="margin-left:40px;"><a href="#2.%2Fcategory%2Fsave" rel="nofollow">2./category/save</a></p> 
<p style="margin-left:40px;"><a href="#3.%2Fcategory%2Fdelete" rel="nofollow">3./category/delete</a></p> 
<p style="margin-left:80px;"><a href="#1.%E6%88%91%E4%BB%AC%E5%88%A0%E9%99%A4%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AA%E4%BA%8C%E7%BA%A7%E5%88%86%E7%B1%BB" rel="nofollow">1.我们删除的是一个二级分类</a></p> 
<p style="margin-left:80px;"><a href="#2.%E6%88%91%E4%BB%AC%E5%88%A0%E9%99%A4%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AA%E4%B8%80%E7%BA%A7%E5%88%86%E7%B1%BB" rel="nofollow">2.我们删除的是一个一级分类</a></p> 
<hr> 
<p> </p> 
<h2>一、🔥今日目标</h2> 
<blockquote> 
 <p><a href="https://blog.csdn.net/qq_61024956/article/details/139468674?spm=1001.2014.3001.5501" title="【wiki知识库】05.分类管理实现--前端Vue模块-CSDN博客">【wiki知识库】05.分类管理实现--前端Vue模块-CSDN博客</a></p> 
 <p>上一篇文章我把分类模块的前端部分给大家展示出来了，这篇文章主要是为了配合上一篇，其实这一篇文章应该先写到前边，然后在发前端的部分。文章的主要内容是把分类管理的后端接口写出来。</p> 
</blockquote> 
<h2>二、☀SpringBoot代码修改</h2> 
<blockquote> 
 <p>不知道你是否还记得我们电子书模块后端接口书写的流程，<a href="https://blog.csdn.net/qq_61024956/article/details/139224794?spm=1001.2014.3001.5502" title="【wiki知识库】02.wiki知识库SpringBoot后端的准备-CSDN博客">【wiki知识库】02.wiki知识库SpringBoot后端的准备-CSDN博客</a>，在这篇文章当中我是用逆向工程生成了Ebook的一些项目结构，现在我们需要Category模块。我们的第一步还是使用逆向工程。</p> 
 <h3>1.使用逆向工程生成Category表结构</h3> 
 <p>在我们util包下的 MybatisGenerator类中修改下方的代码，把我们的表换成category，然后运行代码。</p> 
 <p><img src="https://images2.imgbox.com/c2/df/DGoRXiyR_o.png" alt="8f7683c5d7074e85831aaa5143c15837.png"></p> 
 <h3> 2. 新增CategoryQueryParam</h3> 
 <pre><code class="language-java">package com.my.hawiki.param;

import lombok.Data;
import lombok.EqualsAndHashCode;

@EqualsAndHashCode(callSuper = true)
@Data
public class CategoryQueryParam extends PageParam {
}
</code></pre> 
 <h3>3.新增CategorySaveParam</h3> 
 <pre><code class="language-java">package com.my.hawiki.param;

import lombok.Data;
import javax.validation.constraints.NotNull;

@Data
public class CategorySaveParam {
    private Long id;

    private Long parent;

    @NotNull(message = "【名称】不能为空")
    private String name;

    @NotNull(message = "【排序】不能为空")
    private Integer sort;
}
</code></pre> 
 <h3>4.新增CategotyQueryVo</h3> 
 <pre><code class="language-java">package com.my.hawiki.vo;

import lombok.Data;

@Data
public class CategoryQueryVo {
    private Long id;

    private Long parent;

    private String name;

    private Integer sort;
}
</code></pre> 
 <h2> </h2> 
</blockquote> 
<h2>三、🤖新增分类管理的相关接口</h2> 
<blockquote> 
 <h3>1. /category/all</h3> 
 <p>在CatagotyController中添加以下代码：</p> 
 <pre><code class="language-java"> @Resource
    CategoryService categoryService;

    /**
     * 查询所有的分类
     * @return
     */
    @RequestMapping("/all")
    public CommonResp all(){
        List&lt;CategoryQueryVo&gt; list = categoryService.all();
        return new CommonResp(true,"查询成功",list);
    }</code></pre> 
 <p>为CategoryService接口添加all方法。然后CategoryServiceImpl实现该all方法，这个方法很简单，也用不到什么分页功能，因为前端没有去考虑分类功能的分页查询，所以直接查询的就是所有的分页。</p> 
 <pre><code class="language-java">    @Resource
    CategoryMapper categoryMapper;
    @Override
    public List&lt;CategoryQueryVo&gt; all() {
        List&lt;Category&gt; categories = categoryMapper.selectList(null);
        List&lt;CategoryQueryVo&gt; list = CopyUtil.copyList(categories, CategoryQueryVo.class);
        return list;
    }</code></pre> 
 <h3>2./category/save</h3> 
 <p>CategoryController中添加下方代码：</p> 
 <p>这里我做了一个sort值重复的判断，如果你是添加数据并且数据库中也已经有了这个sort值了，你就不能在添加了。</p> 
 <pre><code class="language-java">    /**
     * 添加分类
     * @param categorySaveParam 添加分类参数
     * @return
     */
    @PostMapping("/save")
    public CommonResp save(@Validated @RequestBody CategorySaveParam categorySaveParam){
        // 先看看这个sort有没有被占用
        Category category = categoryService.getOne(new LambdaQueryWrapper&lt;Category&gt;()
                .eq(Category::getSort,categorySaveParam.getSort()));
        if(category != null &amp;&amp; categorySaveParam.getId()==null){
            return new CommonResp(false,"已经存在该顺序了",null);
        }
        boolean res = categoryService.saveOrUpdate(CopyUtil.copy(categorySaveParam,Category.class));
        String message = Boolean.TRUE.equals(res) ? "添加成功":"添加失败";
        return new CommonResp(res,message,null);
    }
</code></pre> 
 <h3>3./category/delete</h3> 
 <p>这里的分类删除操作其实考虑的东西还是很多的，你删除掉了这个分类，那么这个分类下的所有子分类也要删除，对应得所有电子书也都需要删除。</p> 
 <p>这个地方还是有些难度的，不过只要考虑清楚了就可以，我带着大家考虑一下。</p> 
 <p> </p> 
 <ul><li> <h4>我们删除的是一个二级分类</h4> 倘若我们删除的是一个二级分类，这个情况稍微好一些，因为二级分类之间相互独立不影响，我们删除一个二级分类，我们只需要把属于该分类的所有电子书删掉就行。在删掉电子书的时候对应的电子书的文章我们也应该删掉，这里先不考虑文章的事情，我们只考虑分类与电子书。</li></ul> 
 <hr> 
 <ul><li> <h4>我们删除的是一个一级分类</h4> 如果我们删除的是一个一级分类，那我们要做的第一件事就是找到该一级分类下的所有二级分类，然后对所有的二级分类进行删除操作，然后对所有属于该一级分类的电子书进行删除操作，这里我不是通过二级分类删除的电子书，因为一个电子书有两个字段保留其定位，一个是category1：一级分类编号，另一个是category2：二级分类编号。我们可以直接通过一级分类编号进行删除操作。</li></ul> 
 <p>在<strong>CategotyController</strong>中添加如下代码：</p> 
 <pre><code class="language-java"> /**
     * 删除分类
     * @param id 分类id
     * @return
     */
    @DeleteMapping("/delete/{id}")
    public CommonResp delete(@PathVariable("id") Long id){
        boolean res = categoryService.deleteById(id);
        String message = Boolean.TRUE.equals(res) ? "删除成功":"删除失败";
        return new CommonResp&lt;&gt;(res,message,null);
    }</code></pre> 
 <p>在<strong>CategotyService</strong>中添加<strong>deleteById()</strong>方法，我这里直接写<strong>CategotyServiceImpl</strong>中的方法实现。</p> 
 <p>上来拿到Id后先去数据库中查查这个id下有多少子分类，如果大于0的话，就说明有子分类，那么我们要删除的分类就是一级分类了，我用了一个stream流操作，把所有子分类的id提取出来，然后把这个一级分类的id加进去，然后调用mapper的批量删除操作。把分类全部删除了之后，就去看看哪些电子书的一级分类编号和我们传来的一样，直接调用删除操作就行。</p> 
 <p>如果id本身就是一个二级分类的话，我们直接把这个二级分类删除掉，同样的把该二级分类下的电子书也全部删掉。</p> 
 <p> </p> 
 <p>这里值得注意的就是这个 @Transactional注解，意味着我们开启事物，一旦这个方法中出错了，我们的事物要进行回滚操作。</p> 
 <pre><code class="language-java"> @Override
    @Transactional
    public boolean deleteById(Long id) {
        // 先找出来这个分类的子分类
        List&lt;Category&gt; categories = categoryMapper.selectList(new LambdaQueryWrapper&lt;Category&gt;()
                .eq(Category::getParent, id));

        // 证明是一级分类
        if(categories.size()&gt;0){
            List&lt;Long&gt; collect = categories.stream()
                    .map(Category::getId)
                    .collect(Collectors.toList());
            collect.add(id);
            categoryMapper.deleteBatchIds(collect);
            ebookMapper.delete(new LambdaQueryWrapper&lt;Ebook&gt;()
                    .eq(Ebook::getCategory1Id, id));
        }else{
            // 否则就是二级分类
            categoryMapper.deleteById(id);
            ebookMapper.delete(new LambdaQueryWrapper&lt;Ebook&gt;()
                    .eq(Ebook::getCategory2Id, id));
        }
        return true;
    }</code></pre> 
 <p> </p> 
</blockquote> 
<p> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4184857f2b241f8793e95515eecc999d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">RPA机器人的技术挑战与解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4299a51d3b11d86faf49364b9e35c1ba/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">逐步掌握最佳Ai Agents框架-AutoGen 九 RAG应用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>