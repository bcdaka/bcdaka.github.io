<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>EasyExcel动态表头导出 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/322f3fb21782af08dd05673d77dbef10/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="EasyExcel动态表头导出">
  <meta property="og:description" content="1、封装方法 package com.skybird.iot.base.utils; import cn.hutool.core.util.StrUtil; import com.alibaba.excel.EasyExcel; import com.alibaba.excel.support.ExcelTypeEnum; import com.alibaba.excel.write.metadata.style.WriteCellStyle; import com.alibaba.excel.write.metadata.style.WriteFont; import com.alibaba.excel.write.style.HorizontalCellStyleStrategy; import com.skybird.iot.base.utils.bean.Custemhandler; import java.io.IOException; import java.io.OutputStream; import java.net.URLEncoder; import java.util.List; import javax.servlet.http.HttpServletRequest; import javax.servlet.http.HttpServletResponse; import org.apache.poi.ss.usermodel.HorizontalAlignment; import org.apache.poi.ss.usermodel.IndexedColors; import org.apache.poi.ss.usermodel.VerticalAlignment; public class EasyExcelUtil { /** * @param response * @param t 导出实体类 * @param list 数据集合 * @param name 文件名称 * @throws IOException * @throws IllegalAccessException * @throws InstantiationException */ public static void download( HttpServletRequest request, HttpServletResponse response, Class t, List list, String name) throws IOException, IllegalAccessException, InstantiationException { /*兼容IE和其他浏览器导出文件名乱码的问题*/ // name = downloadCommFileName(name, request); response.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-09T17:52:20+08:00">
    <meta property="article:modified_time" content="2024-08-09T17:52:20+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">EasyExcel动态表头导出</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1、封装方法</h2> 
<pre><code class="language-java">package com.skybird.iot.base.utils;

import cn.hutool.core.util.StrUtil;
import com.alibaba.excel.EasyExcel;
import com.alibaba.excel.support.ExcelTypeEnum;
import com.alibaba.excel.write.metadata.style.WriteCellStyle;
import com.alibaba.excel.write.metadata.style.WriteFont;
import com.alibaba.excel.write.style.HorizontalCellStyleStrategy;
import com.skybird.iot.base.utils.bean.Custemhandler;
import java.io.IOException;
import java.io.OutputStream;
import java.net.URLEncoder;
import java.util.List;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import org.apache.poi.ss.usermodel.HorizontalAlignment;
import org.apache.poi.ss.usermodel.IndexedColors;
import org.apache.poi.ss.usermodel.VerticalAlignment;

public class EasyExcelUtil {

  /**
   * @param response
   * @param t 导出实体类
   * @param list 数据集合
   * @param name 文件名称
   * @throws IOException
   * @throws IllegalAccessException
   * @throws InstantiationException
   */
  public static void download(
      HttpServletRequest request, HttpServletResponse response, Class t, List list, String name)
      throws IOException, IllegalAccessException, InstantiationException {
    /*兼容IE和其他浏览器导出文件名乱码的问题*/
    //    name = downloadCommFileName(name, request);

    response.setContentType("application/vnd.ms-excel"); // 设置文本内省
    response.setCharacterEncoding("utf-8"); // 设置字符编码
    response.setHeader("Content-disposition", "attachment;fileName=name.xlsx"); // 设置响应头

    try (OutputStream outStream = response.getOutputStream()) {
      EasyExcel.write(outStream, t)
          .excelType(ExcelTypeEnum.XLSX)
          .registerWriteHandler(new Custemhandler()) // 设置自动列宽设置
          .registerWriteHandler(getStyleStrategy()) // 设置样式
          .sheet(name)
          .doWrite(list); // 用io流来写入数据
      outStream.flush();
    }
  }

  /**
   * 动态表头导出
   *
   * @param request
   * @param response
   * @param head 表头数据
   * @param dataList 内容数据
   * @param name 名称
   * @throws IOException
   */
  public static void trendsDownload(
      HttpServletRequest request,
      HttpServletResponse response,
      List&lt;List&lt;String&gt;&gt; head,
      List&lt;List&lt;Object&gt;&gt; dataList,
      String name)
      throws IOException {

    try (OutputStream outStream = response.getOutputStream()) {
      EasyExcel.write(outStream)
          .head(head)
          .sheet(name)
          .registerWriteHandler(new Custemhandler()) // 设置自动列宽设置
          .registerWriteHandler(getStyleStrategy()) // 设置样式
          .doWrite(dataList);
      outStream.flush();
    }
  }

  /*兼容IE和其他浏览器导出文件名乱码的问题*/
  public static String downloadCommFileName(String fileOut, HttpServletRequest request)
      throws IOException {
    String userAgent = request.getHeader("user-agent").toLowerCase();
    if (!StrUtil.contains(userAgent, "chrome")
        &amp;&amp; (userAgent.contains("msie") || userAgent.contains("like gecko"))) {
      // win10 ie edge 浏览器 和其他系统的ie
      fileOut = URLEncoder.encode(fileOut, "UTF-8");
    } else {
      // 其他
      fileOut = new String(fileOut.getBytes("utf-8"), "iso-8859-1");
    }
    return fileOut;
  }

  public static HorizontalCellStyleStrategy getStyleStrategy() {
    // 头的策略
    WriteCellStyle headWriteCellStyle = new WriteCellStyle();
    // 背景设置
    headWriteCellStyle.setFillForegroundColor(IndexedColors.AUTOMATIC.getIndex());
    WriteFont headWriteFont = new WriteFont();
    headWriteFont.setFontHeightInPoints((short) 12);
    // 字体样式
    headWriteFont.setFontName("宋体");
    headWriteFont.setBold(false); // 取消加粗
    // 字体设置成红色
    //        headWriteFont.setColor(IndexedColors.RED.getIndex());
    headWriteCellStyle.setWriteFont(headWriteFont);
    // 自动换行
    headWriteCellStyle.setWrapped(false);
    //        headWriteCellStyle.setBorderTop(BorderStyle.SLANTED_DASH_DOT);//右边框
    //        headWriteCellStyle.setBorderBottom(BorderStyle.SLANTED_DASH_DOT);//左
    //        headWriteCellStyle.setBorderLeft(BorderStyle.SLANTED_DASH_DOT);//底
    //        headWriteCellStyle.setBorderRight(BorderStyle.SLANTED_DASH_DOT);
    // 水平对齐方式
    headWriteCellStyle.setHorizontalAlignment(HorizontalAlignment.CENTER);
    // 垂直对齐方式
    headWriteCellStyle.setVerticalAlignment(VerticalAlignment.CENTER);

    // 内容的策略
    WriteCellStyle contentWriteCellStyle = new WriteCellStyle();
    // 这里需要指定 FillPatternType 为FillPatternType.SOLID_FOREGROUND 不然无法显示背景颜色.头默认了
    // FillPatternType所以可以不指定
    //        contentWriteCellStyle.setFillPatternType(FillPatternType.SQUARES);
    // 背景白色
    contentWriteCellStyle.setFillForegroundColor(IndexedColors.WHITE.getIndex());
    WriteFont contentWriteFont = new WriteFont();
    // 字体大小
    contentWriteFont.setFontHeightInPoints((short) 12);
    // 字体样式
    contentWriteFont.setFontName("Calibri");
    contentWriteCellStyle.setWriteFont(contentWriteFont);
    return new HorizontalCellStyleStrategy(headWriteCellStyle, contentWriteCellStyle);
  }
}
</code></pre> 
<h2>2、Java请求接口</h2> 
<pre><code class="language-java">  @RequestMapping("/excel")
  public void excel(
      HttpServletRequest request,
      HttpServletResponse response,
      @RequestParam(value = "dateRange", required = false) Integer dateRange)
      throws Exception {

    List&lt;Document&gt; list = getList(dateRange);

    // 表头数据
    List&lt;List&lt;String&gt;&gt; head = ListUtils.newArrayList();
    getHead(head);
    List&lt;Document&gt; dtoList = DocuLib.getList(list.get(0), "causeMalfunctionDetails");
    for (Document item : dtoList) {
      List&lt;String&gt; head1 = ListUtils.newArrayList();
      head1.add(DocuLib.getStr(item, "causeMalfunctionName"));
      head.add(head1);
    }

    // 内容数据
    List&lt;List&lt;Object&gt;&gt; dataList = ListUtils.newArrayList();

    for (Document item : list) {
      List&lt;Object&gt; data = ListUtils.newArrayList();
      data.add(DocuLib.getStr(item, "yearMonth"));
      data.add(DocuLib.getStr(item, "totalMonthly"));
      data.add(DocuLib.getStr(item, "auditMonthly"));
      data.add(DocuLib.getStr(item, "completedMonthly"));
      List&lt;Document&gt; rowList = DocuLib.getList(item, "causeMalfunctionDetails");
      for (Document dto : rowList) {
        data.add(DocuLib.getStr(dto, "count"));
      }
      dataList.add(data);
    }

    EasyExcelUtil.trendsDownload(request, response, head, dataList, "销售退货统计");
  }

  private void getHead(List&lt;List&lt;String&gt;&gt; head) {
    List&lt;String&gt; head1 = ListUtils.newArrayList();
    head1.add("时间");
    List&lt;String&gt; head2 = ListUtils.newArrayList();
    head2.add("退货单数");
    List&lt;String&gt; head3 = ListUtils.newArrayList();
    head3.add("审核通过");
    List&lt;String&gt; head4 = ListUtils.newArrayList();
    head4.add("完成单数");
    head.add(head1);
    head.add(head2);
    head.add(head3);
    head.add(head4);
  }</code></pre> 
<h2>3、html关键代码</h2> 
<pre><code class="language-html">&lt;div class='card-body' style='height: 100%;'&gt;
            &lt;div style="display: flex;flex-wrap: wrap; align-items: center;"&gt;
                &lt;cb-date inline="true"
                         style="width:100px;margin-bottom: 10px; display: block;"
                         ng-model="ctrl.filter.dateRange"
                         placeholder="创建时间"
                         picker="year"&gt;&lt;/cb-date&gt;
                &lt;button class="btn btn-default btn-sm"
                        style="margin-left: 8px; margin-bottom: 10px; display: block;" type="button"
                        ng-click="ctrl.loadData()"&gt;
                    &lt;i class="bi bi-search"&gt;&lt;/i&gt;
                    查询
                &lt;/button&gt;
                &lt;div&gt;
                    &lt;button class='btn btn-outline-primary btn-sm' ng-click='ctrl.export()'
                            style="margin-left: 5px;margin-bottom: 10px;"
                            ng-if="''| SecurityFilter: 'saleReturnOrderStatistics':'export'"
                            type='button'&gt;
                        &lt;i class='bi'&gt;&lt;/i&gt;
                        导出
                    &lt;/button&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;div style="overflow: scroll;overflow-x: auto; width: 100%;height: calc(100% - 80px);"
                 ng-if="check === false"&gt;
                &lt;table class="table table-bordered" style="width: 1640px;table-layout: fixed;"&gt;
                    &lt;thead style="position: sticky;top: -1px;z-index: 1;"&gt;
                    &lt;tr&gt;
                        &lt;th width="100px;"&gt;时间&lt;/th&gt;
                        &lt;th width="150px;"&gt;退货单数&lt;/th&gt;
                        &lt;th width="150px;"&gt;审核通过&lt;/th&gt;
                        &lt;th width="150px;"&gt;完成单数&lt;/th&gt;
                        &lt;th ng-repeat="dailyDetail in entity[0].causeMalfunctionDetails"
                            ng-style="{width: dailyDetail.causeMalfunctionName.length&gt;=5?dailyDetail.causeMalfunctionName.length*17:100}"&gt;
                            {<!-- -->{dailyDetail.causeMalfunctionName}}
                        &lt;/th&gt;
                    &lt;/tr&gt;
                    &lt;/thead&gt;
                    &lt;tbody&gt;
                    &lt;tr ng-repeat="row in entity"&gt;
                        &lt;td&gt;{<!-- -->{row.yearMonth}}&lt;/td&gt;
                        &lt;td&gt;{<!-- -->{row.totalMonthly}}&lt;/td&gt;
                        &lt;td&gt;{<!-- -->{row.auditMonthly}}&lt;/td&gt;
                        &lt;td&gt;{<!-- -->{row.completedMonthly}}&lt;/td&gt;
                        &lt;td ng-repeat="dailyDetail in row.causeMalfunctionDetails"&gt;{<!-- -->{dailyDetail.count}}&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;/tbody&gt;
                &lt;/table&gt;
            &lt;/div&gt;
            &lt;div style="overflow: scroll; width: 100%;height: calc(100% - 80px);" ng-if="check === true"&gt;
                &lt;table class="table table-bordered" style="width: auto;table-layout: fixed;"&gt;
                    &lt;thead style="position: sticky;top: -1px;z-index: 1;"&gt;
                    &lt;tr&gt;
                        &lt;th width="100px;"&gt;时间&lt;/th&gt;
                        &lt;th width="150px;"&gt;退货单数&lt;/th&gt;
                        &lt;th width="150px;"&gt;审核通过&lt;/th&gt;
                        &lt;th width="150px;"&gt;完成单数&lt;/th&gt;
                        &lt;th ng-repeat="dailyDetail in entity[0].causeMalfunctionDetails"&gt;
                            {<!-- -->{dailyDetail.causeMalfunctionName}}
                        &lt;/th&gt;
                    &lt;/tr&gt;
                    &lt;/thead&gt;
                    &lt;tbody&gt;
                    &lt;tr ng-repeat="row in entity"&gt;
                        &lt;td&gt;{<!-- -->{row.yearMonth}}&lt;/td&gt;
                        &lt;td&gt;{<!-- -->{row.totalMonthly}}&lt;/td&gt;
                        &lt;td&gt;{<!-- -->{row.auditMonthly}}&lt;/td&gt;
                        &lt;td&gt;{<!-- -->{row.completedMonthly}}&lt;/td&gt;
                        &lt;td ng-repeat="dailyDetail in row.causeMalfunctionDetails"&gt;{<!-- -->{dailyDetail.count}}&lt;/td&gt;
                    &lt;/tr&gt;
                    &lt;/tbody&gt;
                &lt;/table&gt;
            &lt;/div&gt;
        &lt;/div&gt;</code></pre> 
<h2>4、js关键代码</h2> 
<pre><code class="language-javascript">                export: function () {
                    //后端导出
                    http.getFile('saleReturnOrderStatistics/excel', {
                        dateRange: ctrl.filter.dateRange
                    }).then(function (response) {
                        const url = window.URL.createObjectURL(new Blob([response.data]));
                        const link = document.createElement('a');
                        link.href = url;
                        link.setAttribute('download', '销售退货统计.xlsx');
                        document.body.appendChild(link);
                        link.click();
                    });
                }</code></pre> 
<h2>5、效果</h2> 
<p><img alt="" height="671" src="https://images2.imgbox.com/93/9d/FwDNCmkQ_o.png" width="1200"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a5e160c6490c0ac98f7a49d2a6ae8156/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">保研考研机试攻略：第二章——入门经典（2）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5288da9c07bbb2e8c697f614fdc9e818/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SpringBoot-疫起买菜平台小程序-99212（免费领源码&#43;开发文档）可做计算机毕业设计JAVA、PHP、爬虫、APP、小程序、C#、C&#43;&#43;、python、数据可视化、大数据、全套文案</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>