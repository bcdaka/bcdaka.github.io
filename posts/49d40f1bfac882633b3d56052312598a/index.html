<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>å‘¨å‘¨æ˜Ÿåˆ†äº«7.3â€”åŸºäºæ°”è±¡å¤§æ•°æ®çš„è‡ªåŠ¨ç«™å®å†µè”åˆé¢„æµ‹ - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/49d40f1bfac882633b3d56052312598a/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="å‘¨å‘¨æ˜Ÿåˆ†äº«7.3â€”åŸºäºæ°”è±¡å¤§æ•°æ®çš„è‡ªåŠ¨ç«™å®å†µè”åˆé¢„æµ‹">
  <meta property="og:description" content="èµ›é¢˜ 2024ä¸­å›½é«˜æ ¡è®¡ç®—æœºå¤§èµ› â€” å¤§æ•°æ®æŒ‘æˆ˜èµ›
ç»éªŒåˆ†äº« å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ‰«åœ°åƒ§å›¢é˜Ÿçš„é˜Ÿé•¿ï¼Œä»¥å‰å‚åŠ è¿™æ ·æ‰“æ¦œçš„æ¯”èµ›æ¯”è¾ƒå°‘ï¼Œäº†è§£çš„æ‰“æ¦œæŠ€å·§ä¸æ˜¯å¤ªå¤šï¼Œæ‰€ä»¥æƒ³ä»ç§‘ç ”çš„è§’åº¦ç»™å¤§å®¶ä¸€ç‚¹åˆ†äº«ã€‚
è¿™æ¬¡æ¯”èµ›ä¸»è¦ä»ä»¥ä¸‹äº”ä¸ªæ­¥éª¤è¿›è¡Œï¼šæ•°æ®é›†æ„é€ ğŸ‘‰Baselineé€‰æ‹©ğŸ‘‰æ¨¡å‹ä¼˜åŒ–ğŸ‘‰æ¨¡å‹è°ƒå‚ğŸ‘‰æ¨¡å‹é›†æˆ
1. æ•°æ®é›†æ„é€  å®˜æ–¹å·²ç»ç»™äº†æ•°æ®é›†ï¼Œå¯ä»¥å°è¯•æ ¹æ®æ¸©åº¦ç­›é€‰å‡ºä¸ä¸­å›½æ¸©åº¦ç±»ä¼¼çš„åœºç«™ï¼Œä½†æ˜¯ä¸ç¡®å®šæ˜¯å¦ä¼šæœ‰æ•ˆæœï¼š
import numpy as np import pandas as pd import os import matplotlib.pyplot as plt root_path = &#39;../dataset/global&#39; data_path = &#39;temp.npy&#39; data = np.load(os.path.join(root_path, data_path)) data_oneyear = data[:365*24,:,0] df = pd.DataFrame(data_oneyear) # å¤å¤©å¹³å‡æ¸©åº¦å¤§äº15æ‘„æ°åº¦ summer_df = df.iloc[4000:5500] print(summer_df.shape) summer_index = summer_df.mean(axis=0).apply(lambda x: x &gt; 15) summer_index = summer_index[summer_index].index.to_list() print(len(summer_index)) # å†¬å¤©å¹³å‡æ¸©åº¦å°äº20æ‘„æ°åº¦ winter_df = df.iloc[0:500] print(winter_df.shape) winter_index = winter_df.mean(axis=0).apply(lambda x: x &lt; 20) winter_index = winter_index[winter_index].">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-03T22:59:17+08:00">
    <meta property="article:modified_time" content="2024-07-03T22:59:17+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">å‘¨å‘¨æ˜Ÿåˆ†äº«7.3â€”åŸºäºæ°”è±¡å¤§æ•°æ®çš„è‡ªåŠ¨ç«™å®å†µè”åˆé¢„æµ‹</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>èµ›é¢˜</h3> 
<p><a href="http://nercbds.tsinghua.edu.cn/bdc" rel="nofollow">2024ä¸­å›½é«˜æ ¡è®¡ç®—æœºå¤§èµ› â€” å¤§æ•°æ®æŒ‘æˆ˜èµ›</a></p> 
<p><img src="https://images2.imgbox.com/68/08/AZI5wG0r_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="_5"></a>ç»éªŒåˆ†äº«</h3> 
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ‰«åœ°åƒ§å›¢é˜Ÿçš„é˜Ÿé•¿ï¼Œä»¥å‰å‚åŠ è¿™æ ·æ‰“æ¦œçš„æ¯”èµ›æ¯”è¾ƒå°‘ï¼Œäº†è§£çš„æ‰“æ¦œæŠ€å·§ä¸æ˜¯å¤ªå¤šï¼Œæ‰€ä»¥æƒ³ä»ç§‘ç ”çš„è§’åº¦ç»™å¤§å®¶ä¸€ç‚¹åˆ†äº«ã€‚</p> 
<p>è¿™æ¬¡æ¯”èµ›ä¸»è¦ä»ä»¥ä¸‹äº”ä¸ªæ­¥éª¤è¿›è¡Œï¼š<strong>æ•°æ®é›†æ„é€ ğŸ‘‰Baselineé€‰æ‹©ğŸ‘‰æ¨¡å‹ä¼˜åŒ–ğŸ‘‰æ¨¡å‹è°ƒå‚ğŸ‘‰æ¨¡å‹é›†æˆ</strong></p> 
<h4><a id="1__10"></a>1. æ•°æ®é›†æ„é€ </h4> 
<p>å®˜æ–¹å·²ç»ç»™äº†æ•°æ®é›†ï¼Œå¯ä»¥å°è¯•æ ¹æ®æ¸©åº¦ç­›é€‰å‡ºä¸ä¸­å›½æ¸©åº¦ç±»ä¼¼çš„åœºç«™ï¼Œä½†æ˜¯ä¸ç¡®å®šæ˜¯å¦ä¼šæœ‰æ•ˆæœï¼š</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> os
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

root_path <span class="token operator">=</span> <span class="token string">'../dataset/global'</span>
data_path <span class="token operator">=</span> <span class="token string">'temp.npy'</span>
data <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> data_path<span class="token punctuation">)</span><span class="token punctuation">)</span>

data_oneyear <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">365</span><span class="token operator">*</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data_oneyear<span class="token punctuation">)</span>

<span class="token comment"># å¤å¤©å¹³å‡æ¸©åº¦å¤§äº15æ‘„æ°åº¦</span>
summer_df <span class="token operator">=</span> df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">4000</span><span class="token punctuation">:</span><span class="token number">5500</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>summer_df<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
summer_index <span class="token operator">=</span> summer_df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">&gt;</span> <span class="token number">15</span><span class="token punctuation">)</span>
summer_index <span class="token operator">=</span> summer_index<span class="token punctuation">[</span>summer_index<span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">.</span>to_list<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>summer_index<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># å†¬å¤©å¹³å‡æ¸©åº¦å°äº20æ‘„æ°åº¦</span>
winter_df <span class="token operator">=</span> df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">500</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>winter_df<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
winter_index <span class="token operator">=</span> winter_df<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span>
winter_index <span class="token operator">=</span> winter_index<span class="token punctuation">[</span>winter_index<span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">.</span>to_list<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>winter_index<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># å–ä¸¤ä¸ªè¡¨çš„äº¤é›†</span>
index <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>summer_index<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token builtin">set</span><span class="token punctuation">(</span>winter_index<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># å–ä¸¤ä¸ªè¡¨çš„äº¤é›†</span>
index <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>summer_index<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token builtin">set</span><span class="token punctuation">(</span>north_index<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token builtin">set</span><span class="token punctuation">(</span>winter_index<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># ç­›é€‰ç”µç«™</span>
root_path<span class="token operator">=</span> <span class="token string">'../dataset/global'</span>
temp_path <span class="token operator">=</span> <span class="token string">'temp.npy'</span>
wind_path <span class="token operator">=</span> <span class="token string">'wind.npy'</span>
global_data_path <span class="token operator">=</span> <span class="token string">'global_data.npy'</span>
temp_data <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> temp_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
wind_data <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> wind_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
global_data <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>root_path<span class="token punctuation">,</span> global_data_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>temp_data<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>wind_data<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>global_data<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

temp_seleted <span class="token operator">=</span> temp_data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>index<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
wind_seleted <span class="token operator">=</span> wind_data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span>index<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
global_seleted <span class="token operator">=</span> global_data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span>index<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>temp_seleted<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>wind_seleted<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>global_seleted<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

<span class="token comment"># åˆ’åˆ†è®­ç»ƒé›†å’ŒéªŒè¯é›†</span>
l <span class="token operator">=</span> temp_seleted<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
train_size <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>l <span class="token operator">*</span> <span class="token number">0.9</span><span class="token punctuation">)</span>
temp_seleted_train <span class="token operator">=</span> temp_seleted<span class="token punctuation">[</span><span class="token punctuation">:</span>train_size<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
wind_seleted_train <span class="token operator">=</span> wind_seleted<span class="token punctuation">[</span><span class="token punctuation">:</span>train_size<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
global_seleted_train <span class="token operator">=</span> global_seleted<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token builtin">int</span><span class="token punctuation">(</span>train_size<span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
temp_seleted_val <span class="token operator">=</span> temp_seleted<span class="token punctuation">[</span>train_size<span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
wind_seleted_val <span class="token operator">=</span> wind_seleted<span class="token punctuation">[</span>train_size<span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
global_seleted_val <span class="token operator">=</span> global_seleted<span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>train_size<span class="token operator">/</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"train:"</span><span class="token punctuation">,</span>temp_seleted_train<span class="token punctuation">.</span>shape<span class="token punctuation">,</span>wind_seleted_train<span class="token punctuation">.</span>shape<span class="token punctuation">,</span>global_seleted_train<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"val:"</span><span class="token punctuation">,</span>temp_seleted_val<span class="token punctuation">.</span>shape<span class="token punctuation">,</span>wind_seleted_val<span class="token punctuation">.</span>shape<span class="token punctuation">,</span>global_seleted_val<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>

<span class="token comment"># ä¿å­˜è®­ç»ƒé›†å’ŒéªŒè¯é›†</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'../dataset'</span><span class="token punctuation">,</span> <span class="token string">'seleted_global_train_val'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'../dataset'</span><span class="token punctuation">,</span> <span class="token string">'seleted_global_train_val'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
selected_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'../dataset'</span><span class="token punctuation">,</span> <span class="token string">'seleted_global_train_val'</span><span class="token punctuation">)</span>
np<span class="token punctuation">.</span>save<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>selected_path<span class="token punctuation">,</span> <span class="token string">'temp_train.npy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> temp_seleted_train<span class="token punctuation">)</span>
np<span class="token punctuation">.</span>save<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>selected_path<span class="token punctuation">,</span> <span class="token string">'temp_val.npy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> temp_seleted_val<span class="token punctuation">)</span>
np<span class="token punctuation">.</span>save<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>selected_path<span class="token punctuation">,</span> <span class="token string">'wind_train.npy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> wind_seleted_train<span class="token punctuation">)</span>
np<span class="token punctuation">.</span>save<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>selected_path<span class="token punctuation">,</span> <span class="token string">'wind_val.npy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> wind_seleted_val<span class="token punctuation">)</span>
np<span class="token punctuation">.</span>save<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>selected_path<span class="token punctuation">,</span> <span class="token string">'global_train.npy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> global_seleted_train<span class="token punctuation">)</span>
np<span class="token punctuation">.</span>save<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>selected_path<span class="token punctuation">,</span> <span class="token string">'global_val.npy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> global_seleted_val<span class="token punctuation">)</span>
</code></pre> 
<p>ç­›é€‰åæ¸©åº¦å’Œé£é€Ÿå½¢çŠ¶å¦‚å›¾æ‰€ç¤ºï¼š</p> 
<p><img src="https://images2.imgbox.com/b0/8c/5S0frcI5_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h4><a id="2_Baseline_95"></a>2. Baselineé€‰æ‹©</h4> 
<p>å®˜æ–¹Baselineç»™çš„æ˜¯iTransformerï¼Œå…³äºiTransformeræ¨¡å‹çš„è§£è¯»è¯·å‚è€ƒï¼š<a href="https://www.guyuehome.com/47015" rel="nofollow">ã€PaperInFive-æ—¶é—´åºåˆ—é¢„æµ‹ã€‘iTransformer:è½¬ç½®Transformeråˆ·æ–°æ—¶é—´åºåˆ—é¢„æµ‹SOTA(æ¸…å)</a></p> 
<p>å¯ä»¥å…³æ³¨è¿‘è¿‘ä¸¤å¹´å¼€æºçš„SOTAæ¨¡å‹ï¼Œè¿™é‡Œåˆ†äº«ä¸€ä¸ªGithubï¼Œå¯ä»¥å»ä¸Šé¢æ‰¾è¿‘å¹´çš„SOTAæ¨¡å‹ï¼š<a href="https://github.com/ddz16/TSFpaper">https://github.com/ddz16/TSFpaper</a></p> 
<h4><a id="3__100"></a>3. æ¨¡å‹ä¼˜åŒ–</h4> 
<p>é€‰å¥½æ•ˆæœå¥½çš„Baselineåå°±å¯ä»¥è¿›è¡Œæ¨¡å‹ä¼˜åŒ–ï¼Œæ¯”å¦‚iTransformeråªå»ºæ¨¡äº†ç‰¹å¾ä¿¡æ¯ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨æ¨¡å‹ä¸­è¡¥å……å¯¹æ—¶åºç‰¹å¾çš„å»ºæ¨¡ï¼Œæ¯”å¦‚è¿›è¡Œä¸€äº›å·ç§¯æ“ä½œï¼Œæˆ–è€…åœ¨æ—¶é—´ç»´åº¦ä¸Šè¿›è¡Œself-Attentionï¼Œå…³äºæ—¶é—´ç»´åº¦ä¸Šçš„å»ºæ¨¡å¤§å®¶ä¹Ÿå¯ä»¥å‚è€ƒSOTAè®ºæ–‡ï¼Œå¯ä»¥æŠŠä¸åŒè®ºæ–‡é‡Œçš„æ¨¡å—è¿›è¡Œä¸€ä¸ªèåˆï¼Œè¯´ä¸å®šä¼šæœ‰å¥½æ•ˆæœã€‚</p> 
<h4><a id="4__103"></a>4. æ¨¡å‹è°ƒå‚</h4> 
<p>ç¡®å®šäº†æ¨¡å‹ç»“æ„åå°±å¯ä»¥è¿›è¡Œæ¨¡å‹è¶…å‚æ•°çš„è°ƒæ•´ï¼Œæ¯”å¦‚æ¨¡å‹çš„ç»´åº¦å’Œå±‚æ•°ï¼Œå­¦ä¹ ç‡å’Œbatch sizeç­‰ï¼Œç»è¿‡æµ‹è¯•å¢åŠ æ¨¡å‹çš„dimentionåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æé«˜æ¨¡å‹è¡¨ç°ï¼Œä½†æ˜¯å¢åŠ å±‚æ•°å¥½åƒæ•ˆæœä¸å¤ªæ˜æ˜¾ã€‚</p> 
<p>å­¦ä¹ ç‡æ–¹é¢æˆ‘åˆå§‹å€¼ä¸º0.01æˆ–0.005ï¼Œæ¯ä¸€è½®é™¤ä»¥2è¿›è¡Œè¡°å‡ã€‚batch sizeæˆ‘è®¾ä¸º40960ã€‚</p> 
<h4><a id="5__108"></a>5. æ¨¡å‹é›†æˆ</h4> 
<p>æœ€åå¯ä»¥æŠŠä¸åŒç‰¹å¾çš„æ¨¡å‹è¿›è¡Œé›†æˆï¼Œæ¯”å¦‚å¯ä»¥æŠŠå¤šä¸ªæ¨¡å‹çš„ç»“æœå–å¹³å‡ï¼Œæˆ–è€…å¯ä»¥åœ¨è®­ç»ƒæ—¶é‡‡ç”¨Mixture of Expertçš„æ–¹å¼åŠ æƒæ±‚å’Œã€‚</p> 
<h3><a id="_112"></a>å¸®åŠ©ä»£ç </h3> 
<h4><a id="1__113"></a>1. æ¨¡å‹æµ‹è¯•</h4> 
<p>åŠ åœ¨<code>exp_long_term_forecasting.py</code>é‡Œé¢ï¼š</p> 
<pre><code class="prism language-python">    <span class="token keyword">def</span> <span class="token function">val</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> setting<span class="token punctuation">)</span><span class="token punctuation">:</span>
        _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> val_data<span class="token punctuation">,</span> val_loader <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_data<span class="token punctuation">(</span><span class="token punctuation">)</span>

        time_now <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

        criterion <span class="token operator">=</span> self<span class="token punctuation">.</span>_select_criterion<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>use_amp<span class="token punctuation">:</span>
            scaler <span class="token operator">=</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>amp<span class="token punctuation">.</span>GradScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>
            
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>state_dict_path<span class="token punctuation">,</span>map_location<span class="token operator">=</span>torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cuda:0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        val_loss <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        <span class="token keyword">for</span> i<span class="token punctuation">,</span> <span class="token punctuation">(</span>batch_x<span class="token punctuation">,</span> batch_y<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>val_loader<span class="token punctuation">)</span><span class="token punctuation">:</span>
            batch_x <span class="token operator">=</span> batch_x<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>
            batch_y <span class="token operator">=</span> batch_y<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>

            <span class="token comment"># encoder - decoder</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>use_amp<span class="token punctuation">:</span>
                <span class="token keyword">with</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>amp<span class="token punctuation">.</span>autocast<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>output_attention<span class="token punctuation">:</span>
                        outputs <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">(</span>batch_x<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        outputs <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">(</span>batch_x<span class="token punctuation">)</span>

                    f_dim <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>features <span class="token operator">==</span> <span class="token string">'MS'</span> <span class="token keyword">else</span> <span class="token number">0</span>
                    outputs <span class="token operator">=</span> outputs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span>self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>pred_len<span class="token punctuation">:</span><span class="token punctuation">,</span> f_dim<span class="token punctuation">:</span><span class="token punctuation">]</span>
                    batch_y <span class="token operator">=</span> batch_y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span>self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>pred_len<span class="token punctuation">:</span><span class="token punctuation">,</span> f_dim<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>
                    loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> batch_y<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\titers: {0} | loss: {2:.7f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    val_loss<span class="token punctuation">.</span>append<span class="token punctuation">(</span>loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>output_attention<span class="token punctuation">:</span>
                    outputs <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">(</span>batch_x<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    outputs <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">(</span>batch_x<span class="token punctuation">)</span>

                f_dim <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>features <span class="token operator">==</span> <span class="token string">'MS'</span> <span class="token keyword">else</span> <span class="token number">0</span>
                outputs <span class="token operator">=</span> outputs<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span>self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>pred_len<span class="token punctuation">:</span><span class="token punctuation">,</span> f_dim<span class="token punctuation">:</span><span class="token punctuation">]</span>
                batch_y <span class="token operator">=</span> batch_y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token operator">-</span>self<span class="token punctuation">.</span>args<span class="token punctuation">.</span>pred_len<span class="token punctuation">:</span><span class="token punctuation">,</span> f_dim<span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>
                loss <span class="token operator">=</span> criterion<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> batch_y<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">50</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\titers: {0} | loss: {1:.7f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                val_loss<span class="token punctuation">.</span>append<span class="token punctuation">(</span>loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                
        val_loss <span class="token operator">=</span> np<span class="token punctuation">.</span>average<span class="token punctuation">(</span>val_loss<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Val Loss: {0:.7f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>val_loss<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> self<span class="token punctuation">.</span>model
</code></pre> 
<h4><a id="2_Dataloader_170"></a>2. éªŒè¯é›†Dataloader</h4> 
<p>åŠ åœ¨<code>data_factory.py</code>é‡Œé¢ï¼š</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">data_provider</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Data <span class="token operator">=</span> data_dict<span class="token punctuation">[</span>args<span class="token punctuation">.</span>data<span class="token punctuation">]</span>

    shuffle_flag <span class="token operator">=</span> <span class="token boolean">True</span>
    drop_last <span class="token operator">=</span> <span class="token boolean">False</span>
    batch_size <span class="token operator">=</span> args<span class="token punctuation">.</span>batch_size 

    train_data_set <span class="token operator">=</span> Data<span class="token punctuation">(</span>
        root_path<span class="token operator">=</span>args<span class="token punctuation">.</span>root_path<span class="token punctuation">,</span>
        data_path<span class="token operator">=</span>args<span class="token punctuation">.</span>train_data_path<span class="token punctuation">,</span>
        global_path<span class="token operator">=</span>args<span class="token punctuation">.</span>train_global_path<span class="token punctuation">,</span>
        size<span class="token operator">=</span><span class="token punctuation">[</span>args<span class="token punctuation">.</span>seq_len<span class="token punctuation">,</span> args<span class="token punctuation">.</span>label_len<span class="token punctuation">,</span> args<span class="token punctuation">.</span>pred_len<span class="token punctuation">]</span><span class="token punctuation">,</span>
        features<span class="token operator">=</span>args<span class="token punctuation">.</span>features
    <span class="token punctuation">)</span>
    train_data_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>
        train_data_set<span class="token punctuation">,</span>
        batch_size<span class="token operator">=</span>batch_size<span class="token punctuation">,</span>
        shuffle<span class="token operator">=</span>shuffle_flag<span class="token punctuation">,</span>
        num_workers<span class="token operator">=</span>args<span class="token punctuation">.</span>num_workers<span class="token punctuation">,</span>
        drop_last<span class="token operator">=</span>drop_last<span class="token punctuation">)</span>
    
    val_data_set <span class="token operator">=</span> Data<span class="token punctuation">(</span>
        root_path<span class="token operator">=</span>args<span class="token punctuation">.</span>root_path<span class="token punctuation">,</span>
        data_path<span class="token operator">=</span>args<span class="token punctuation">.</span>val_data_path<span class="token punctuation">,</span>
        global_path<span class="token operator">=</span>args<span class="token punctuation">.</span>val_global_path<span class="token punctuation">,</span>
        size<span class="token operator">=</span><span class="token punctuation">[</span>args<span class="token punctuation">.</span>seq_len<span class="token punctuation">,</span> args<span class="token punctuation">.</span>label_len<span class="token punctuation">,</span> args<span class="token punctuation">.</span>pred_len<span class="token punctuation">]</span><span class="token punctuation">,</span>
        features<span class="token operator">=</span>args<span class="token punctuation">.</span>features
    <span class="token punctuation">)</span>
    val_data_loader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>
        val_data_set<span class="token punctuation">,</span>
        batch_size<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">(</span>batch_size<span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
        num_workers<span class="token operator">=</span>args<span class="token punctuation">.</span>num_workers<span class="token punctuation">,</span>
        drop_last<span class="token operator">=</span>drop_last<span class="token punctuation">)</span>
    <span class="token keyword">return</span> train_data_set<span class="token punctuation">,</span> train_data_loader<span class="token punctuation">,</span> val_data_set<span class="token punctuation">,</span> val_data_loader
</code></pre> 
<h3><a id="_210"></a>æœ€å</h3> 
<p>å¸Œæœ›å¤§å®¶ä»¥èµ›ä¸ºå‹ï¼Œå…±åŒè¿›æ­¥ï¼Œä¸€èµ·åˆ†äº«ä¸€äº›æœ‰ç”¨çš„å°æŠ€å·§ã€‚</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a12be63121323d444dc7042b842672fc/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">è®¡ç®—æœºç½‘ç»œâ€”â€”æ•°æ®é“¾è·¯å±‚ï¼ˆç‚¹å¯¹ç‚¹åè®®PPPï¼‰</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2bdf9c71edcee76d7c79dd208f57fc0d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">äººå·¥æ™ºèƒ½--å¾ªç¯ç¥ç»ç½‘ç»œ</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>