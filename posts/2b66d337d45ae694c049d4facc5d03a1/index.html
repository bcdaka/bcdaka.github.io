<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【C&#43;&#43;】：红黑树深度剖析 --- 手撕红黑树！ - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/2b66d337d45ae694c049d4facc5d03a1/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【C&#43;&#43;】：红黑树深度剖析 --- 手撕红黑树！">
  <meta property="og:description" content="目录 💡前言一，红黑树的概念二，红黑树的性质三，红黑树节点的定义四，红黑树的插入操作4.1 第一步4.2 第二步4.3 插入操作的完整代码 五，红黑树的验证六，实现红黑树的完整代码五，红黑树与AVL树的比较 点击跳转至上一篇文章： 【C&#43;&#43;】：AVL树的深度解析及其实现 点击跳转至文章：【C&#43;&#43;】：二叉树进阶 — 搜索二叉树 💡前言 上一篇文章介绍了什么是AVL树和AVL树的实现，AVL树也有它的缺点：就是太过追求绝对平衡，比如在插入时要维护其绝对平衡，旋转次数太多，在删除时甚至有可能要一直旋转到根位置，使之性能低下。
本篇文章介绍的红黑树也是一种平衡树，是通过改变节点颜色以及旋转操作，使之接近平衡。
红黑树比AVL树的用途更加广泛，在一些方面效率甚至要优于AVL树，并且 map/set 的底层封装用的也是红黑树。
一，红黑树的概念 红黑树，是一种二叉搜索树，但在每个结点上增加一个存储位表示结点的颜色，可以是Red或Black。 通过对任何一条从根到叶子的路径上各个结点着色方式的限制，红黑树确保没有一条路径会比其他路径长出两倍，因而是接近平衡的。
二，红黑树的性质 (1) 每个结点不是红色就是黑色 ；
(2) 根节点是黑色的 ；
(3) 如果一个节点是红色的，则它的两个孩子结点是黑色的（重点）；
(4) 对于每个结点，从该结点到其所有后代叶结点的简单路径上，均包含相同数目的黑色结点（重点） ；
(5) 每个叶子结点都是黑色的(此处的叶子结点指的是空结点，这条性质可有可无，平时不关注)。
三，红黑树节点的定义 红黑树的节点结构与AVL树的大致相同，只是AVL树中有节点的颜色，没有平衡因子。
//枚举颜色 enum Colour { RED, BLACK }; template &lt;class K, class V&gt; struct RBTreeNode { RBTreeNode&lt;K, V&gt;* _left; RBTreeNode&lt;K, V&gt;* _right; RBTreeNode&lt;K, V&gt;* _parent; pair&lt;K, V&gt; _kv; Colour _col; RBTreeNode(const pair&lt;K, V&gt;&amp; kv) :_left(nullptr) ,_right(nullptr) ,_parent(nullptr) ,_kv(kv) ,_col(BLACK) {} }; 四，红黑树的插入操作 首先我们要思考一个问题，插入节点时，到底是插入红色节点还是黑色节点？为什么？">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-26T23:06:41+08:00">
    <meta property="article:modified_time" content="2024-07-26T23:06:41+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【C&#43;&#43;】：红黑树深度剖析 --- 手撕红黑树！</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_4" rel="nofollow">💡前言</a></li><li><a href="#_11" rel="nofollow">一，红黑树的概念</a></li><li><a href="#_17" rel="nofollow">二，红黑树的性质</a></li><li><a href="#_25" rel="nofollow">三，红黑树节点的定义</a></li><li><a href="#_56" rel="nofollow">四，红黑树的插入操作</a></li><li><ul><li><a href="#41__70" rel="nofollow">4.1 第一步</a></li><li><a href="#42__118" rel="nofollow">4.2 第二步</a></li><li><a href="#43__162" rel="nofollow">4.3 插入操作的完整代码</a></li></ul> 
  </li><li><a href="#_301" rel="nofollow">五，红黑树的验证</a></li><li><a href="#_380" rel="nofollow">六，实现红黑树的完整代码</a></li><li><a href="#AVL_748" rel="nofollow">五，红黑树与AVL树的比较</a></li></ul> 
</div> 
<br> 点击跳转至上一篇文章： 
<a href="http://t.csdnimg.cn/hPFYq" rel="nofollow">【C++】：AVL树的深度解析及其实现 </a> 
<p></p> 
<p>点击跳转至文章：<a href="http://t.csdnimg.cn/wL9ri" rel="nofollow">【C++】：二叉树进阶 — 搜索二叉树 </a></p> 
<h2><a id="_4"></a>💡前言</h2> 
<p>上一篇文章介绍了什么是AVL树和AVL树的实现，AVL树也有它的缺点：<strong>就是太过追求绝对平衡，比如在插入时要维护其绝对平衡，旋转次数太多，在删除时甚至有可能要一直旋转到根位置，使之性能低下</strong>。</p> 
<p>本篇文章介绍的<strong>红黑树也是一种平衡树，是通过改变节点颜色以及旋转操作，使之接近平衡</strong>。</p> 
<p>红黑树比AVL树的用途更加广泛，在一些方面效率甚至要优于AVL树，并且 map/set 的底层封装用的也是红黑树。</p> 
<h2><a id="_11"></a>一，红黑树的概念</h2> 
<p>红黑树，是一种<strong>二叉搜索树</strong>，但<strong>在每个结点上增加一个存储位表示结点的颜色，可以是Red或Black</strong>。 <strong>通过对任何一条从根到叶子的路径上各个结点着色方式的限制，红黑树确保没有一条路径会比其他路径长出两倍</strong>，因而是<strong>接近平衡</strong>的。</p> 
<p><img src="https://images2.imgbox.com/22/13/PnL8vfeR_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_17"></a>二，红黑树的性质</h2> 
<p>(1) <strong>每个结点不是红色就是黑色</strong> ；<br> (2) <strong>根节点是黑色的</strong> ；<br> (3) <mark>如果一个节点是红色的，则它的两个孩子结点是黑色的（重点）</mark>；<br> (4) <mark>对于每个结点，从该结点到其所有后代叶结点的简单路径上，均包含相同数目的黑色结点（重点）</mark> ；<br> (5) <strong>每个叶子结点都是黑色的(此处的叶子结点指的是空结点，这条性质可有可无，平时不关注)</strong>。</p> 
<h2><a id="_25"></a>三，红黑树节点的定义</h2> 
<p>红黑树的节点结构与AVL树的大致相同，只是AVL树中有节点的颜色，没有平衡因子。</p> 
<pre><code class="prism language-c"><span class="token comment">//枚举颜色</span>
<span class="token keyword">enum</span> <span class="token class-name">Colour</span>
<span class="token punctuation">{<!-- --></span>
	RED<span class="token punctuation">,</span>
	BLACK
<span class="token punctuation">}</span><span class="token punctuation">;</span>

template <span class="token operator">&lt;</span>class K<span class="token punctuation">,</span> class V<span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">RBTreeNode</span>
<span class="token punctuation">{<!-- --></span>
	RBTreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">*</span> _left<span class="token punctuation">;</span>
	RBTreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">*</span> _right<span class="token punctuation">;</span>
	RBTreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">*</span> _parent<span class="token punctuation">;</span>

	pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span> _kv<span class="token punctuation">;</span>
	Colour _col<span class="token punctuation">;</span>

	<span class="token function">RBTreeNode</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_left</span><span class="token punctuation">(</span>nullptr<span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token function">_right</span><span class="token punctuation">(</span>nullptr<span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token function">_parent</span><span class="token punctuation">(</span>nullptr<span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token function">_kv</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token function">_col</span><span class="token punctuation">(</span>BLACK<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_56"></a>四，红黑树的插入操作</h2> 
<p>首先我们要思考一个问题，插入节点时，到底是插入红色节点还是黑色节点？为什么？</p> 
<p>答案：<strong>插入红色节点</strong>。</p> 
<p>因为我们知道红黑树最重要的两条性质是第(3)(4)条，通过维护这两条规则使之成为红黑树，而当新插入一个节点时，必定会破坏两条规则之一。</p> 
<p>假设插入节点为黑色节点，则所有路径的黑色节点数量均不相同，如何让它们相同将是一个巨大的难题，而插入红色节点(此时一定是作为孩子节点)，就破坏规则(3)，但是只要根据其父亲和叔叔节点进行适当的变色就可以继续恢复规则(3)。</p> 
<p>显而易见，规则(3)(4)就好比"慈父严母"，非要选择得罪其中一人，那当然是"慈父"了。</p> 
<p>红黑树是在二叉搜索树的基础上加上其平衡限制条件，因此红黑树的插入可分为两步：</p> 
<h3><a id="41__70"></a>4.1 第一步</h3> 
<p><strong>按照二叉搜索的树规则插入新节点</strong>：</p> 
<pre><code class="prism language-c">bool <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_root <span class="token operator">==</span> nullptr<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_root <span class="token operator">=</span> new <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> true<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
	Node<span class="token operator">*</span> parent <span class="token operator">=</span> nullptr<span class="token punctuation">;</span>
	
	<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
			<span class="token keyword">return</span> false<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	cur <span class="token operator">=</span> new <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//新增节点，颜色为红色</span>
	cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

	<span class="token comment">//链接时要判断链接在parent的左还是右</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
		parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
	<span class="token keyword">else</span>
		parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> cur<span class="token punctuation">;</span>

	cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

	<span class="token comment">//检测新节点插入后，红黑树的性质是否造到破坏</span>
	<span class="token comment">//……</span>
	
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="42__118"></a>4.2 第二步</h3> 
<p><strong>检测新节点插入后，红黑树的性质是否造到破坏</strong>：</p> 
<p>因为<strong>新节点的默认颜色是红色</strong>，因此：<strong>如果其双亲节点的颜色是黑色，没有违反红黑树任何性质</strong>，则不需要调整；但<strong>当新插入节点的双亲节点颜色为红色时，就违反了性质三不能有连在一起的红色节点</strong>，此时需要对红黑树分情况来讨论：</p> 
<p><strong>约定：<br> (1) cur 为当前节点，p为父节点，g为祖父节点，u为叔叔节点</strong></p> 
<p><strong>(2) 下面的抽象图中，a/b/c/d/e 表示具有 n 个节点的红黑树，n &gt;=0</strong>。</p> 
<p><strong>(一) 情况一: <mark>cur为红，p为红，g为黑，u存在且为红</mark></strong>：</p> 
<p><img src="https://images2.imgbox.com/5e/7d/vlRHP406_o.png" alt="在这里插入图片描述"></p> 
<p><strong>解决方式：<mark>将p,u改为黑，g改为红，然后把g当成cur，继续向上调整</mark></strong>。</p> 
<p><strong>(二) 情况二: <mark>cur为红，p为红，g为黑，u不存在/u存在且为黑</mark></strong></p> 
<p><img src="https://images2.imgbox.com/8d/48/7eUrcDEB_o.png" alt="在这里插入图片描述"></p> 
<p>下面我们根据 u 的情况用具象图分别解释单旋与双旋操作：</p> 
<p>(1) <mark>u 不存在，a/b/c/d/e都是空，cur 是新增</mark>：</p> 
<p><strong>p为g的左孩子，cur为p的左孩子，则进行右单旋转，再 p 变黑，g 变红</strong>：</p> 
<p><img src="https://images2.imgbox.com/d7/96/C3vS3fg0_o.png" alt="在这里插入图片描述"></p> 
<p><strong>相反，p为g的右孩子，cur为p的右孩子，则进行左单旋转，再 p 变黑，g 变红</strong>：</p> 
<p><img src="https://images2.imgbox.com/31/28/aRpJ1KRw_o.png" alt="在这里插入图片描述"></p> 
<p><strong>p为g的左孩子，cur为p的右孩子，先针对p做左单旋转，再针对 g 做右单旋，cur 变黑，g 变红</strong>：</p> 
<p><img src="https://images2.imgbox.com/9e/84/o2iFUFzR_o.png" alt="在这里插入图片描述"></p> 
<p>(2) <mark>u 存在且为黑</mark></p> 
<p><strong>单旋情况</strong>：</p> 
<p><img src="https://images2.imgbox.com/ce/fe/aWARVqjy_o.png" alt="在这里插入图片描述"><br> <strong>双旋情况</strong>：<br> <img src="https://images2.imgbox.com/cc/8c/qqdYu1rW_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="43__162"></a>4.3 插入操作的完整代码</h3> 
<pre><code class="prism language-c">bool <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>_root <span class="token operator">==</span> nullptr<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		_root <span class="token operator">=</span> new <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> true<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
	Node<span class="token operator">*</span> parent <span class="token operator">=</span> nullptr<span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
			<span class="token keyword">return</span> false<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	cur <span class="token operator">=</span> new <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//新增节点，颜色为红色</span>
	cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

	<span class="token comment">//链接时要判断链接在parent的左还是右</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
		parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
	<span class="token keyword">else</span>
		parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> cur<span class="token punctuation">;</span>

	cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> grandfather <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		<span class="token comment">//    g</span>
		<span class="token comment">// p     u</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//找到u的位置</span>
			Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			
			<span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token comment">//u存在且为红,把p/u变黑，g变红,继续向上调整</span>
				parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
				grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

				cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
				parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token comment">//u不存在或存在且为黑</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token comment">//     g</span>
					<span class="token comment">//  p     u    </span>
					<span class="token comment">//c</span>
					<span class="token comment">//单旋</span>
					<span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>
					parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token comment">//     g</span>
					<span class="token comment">//  p     u    </span>
					<span class="token comment">//	   c</span>
					<span class="token comment">//双旋</span>
					<span class="token function">RotateL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>
					
					cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//    g</span>
			<span class="token comment">// u     p</span>
			Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			
			<span class="token comment">//u存在且为红,把p/u变黑，g变红,继续向上调整</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
				grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

				cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
				parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token comment">//u不存在或存在且为黑</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token comment">//    g</span>
					<span class="token comment">// u      p</span>
					<span class="token comment">//            c</span>
					<span class="token comment">//单旋</span>
					<span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>
					parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token comment">//    g</span>
					<span class="token comment">// u     p</span>
					<span class="token comment">//    c</span>
					<span class="token comment">//双旋</span>
					<span class="token function">RotateR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>
					
					cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	_root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>

	<span class="token keyword">return</span> true<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_301"></a>五，红黑树的验证</h2> 
<p>红黑树的检测分为两步：</p> 
<p><strong>(1) 检测其是否满足二叉搜索树(中序遍历是否为有序序列)</strong><br> <strong>(2) 检测其是否满足红黑树的性质</strong></p> 
<p>这里重点检测的是性质(3)与性质(4)。</p> 
<p><strong>检测性质(3)：只要判断当前节点与其父亲节点是否为连续的红色节点</strong>；</p> 
<p><strong>检测性质(4)：先计算出任意一条路径上的黑色节点作为参考值，再用这个参考值与其他路径上的黑色节点数量比较</strong>。</p> 
<pre><code class="prism language-c">private<span class="token operator">:</span>
	<span class="token comment">//中序遍历</span>
	<span class="token keyword">void</span> <span class="token function">InOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">_Inorder</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//判断是否平衡</span>
	bool <span class="token function">IsBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>_root <span class="token operator">==</span> nullptr<span class="token punctuation">)</span>
			<span class="token keyword">return</span> true<span class="token punctuation">;</span>

		<span class="token comment">//检查根节点</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>_root<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
			<span class="token keyword">return</span> false<span class="token punctuation">;</span>
		
		<span class="token comment">// 参考值</span>
		<span class="token keyword">int</span> refNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> BLACK<span class="token punctuation">)</span>
				<span class="token operator">++</span>refNum<span class="token punctuation">;</span>
			
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token function">Check</span><span class="token punctuation">(</span>_root<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> refNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

private<span class="token operator">:</span>
	bool <span class="token function">Check</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">,</span> <span class="token keyword">int</span> blackNum<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> refNum<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//每条路径走到空后与参考值进行比较</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> nullptr<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//cout &lt;&lt; blackNum &lt;&lt; endl;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>refNum <span class="token operator">!=</span> blackNum<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cout <span class="token operator">&lt;&lt;</span> <span class="token string">"存在黑色节点的数量不相等的路径"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
				<span class="token keyword">return</span> false<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> true<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">//检查是否存在连续的红色节点</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED <span class="token operator">&amp;&amp;</span> root<span class="token operator">-&gt;</span>_parent<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cout <span class="token operator">&lt;&lt;</span> root<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> <span class="token string">"存在连续的红色节点"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
			<span class="token keyword">return</span> false<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		<span class="token comment">//blackNum表示：根节点到当前节点的路径上黑色节点的数量</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> BLACK<span class="token punctuation">)</span>
			blackNum<span class="token operator">++</span><span class="token punctuation">;</span>
		
		<span class="token keyword">return</span> <span class="token function">Check</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">,</span> blackNum<span class="token punctuation">,</span> refNum<span class="token punctuation">)</span>
			<span class="token operator">&amp;&amp;</span> <span class="token function">Check</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">,</span> blackNum<span class="token punctuation">,</span> refNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_380"></a>六，实现红黑树的完整代码</h2> 
<p><mark>RBTree.h</mark></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assert.h&gt;</span></span>
using namespace std<span class="token punctuation">;</span>

<span class="token comment">//枚举颜色</span>
<span class="token keyword">enum</span> <span class="token class-name">Colour</span>
<span class="token punctuation">{<!-- --></span>
	RED<span class="token punctuation">,</span>
	BLACK
<span class="token punctuation">}</span><span class="token punctuation">;</span>

template <span class="token operator">&lt;</span>class K<span class="token punctuation">,</span> class V<span class="token operator">&gt;</span>
<span class="token keyword">struct</span> <span class="token class-name">RBTreeNode</span>
<span class="token punctuation">{<!-- --></span>
	RBTreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">*</span> _left<span class="token punctuation">;</span>
	RBTreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">*</span> _right<span class="token punctuation">;</span>
	RBTreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">*</span> _parent<span class="token punctuation">;</span>

	pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span> _kv<span class="token punctuation">;</span>
	Colour _col<span class="token punctuation">;</span>

	<span class="token function">RBTreeNode</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_left</span><span class="token punctuation">(</span>nullptr<span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token function">_right</span><span class="token punctuation">(</span>nullptr<span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token function">_parent</span><span class="token punctuation">(</span>nullptr<span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token function">_kv</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token function">_col</span><span class="token punctuation">(</span>BLACK<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

template <span class="token operator">&lt;</span>class K<span class="token punctuation">,</span> class V<span class="token operator">&gt;</span>
class RBTree
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
public<span class="token operator">:</span>
	Node<span class="token operator">*</span> <span class="token function">Find</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token keyword">else</span>
				<span class="token keyword">return</span> cur<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> nullptr<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	bool <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>_root <span class="token operator">==</span> nullptr<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_root <span class="token operator">=</span> new <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> true<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> parent <span class="token operator">=</span> nullptr<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
				<span class="token keyword">return</span> false<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		cur <span class="token operator">=</span> new <span class="token function">Node</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//新增节点，颜色为红色</span>
		cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

		<span class="token comment">//链接时要判断链接在parent的左还是右</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&gt;</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">)</span>
			parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> cur<span class="token punctuation">;</span>

		cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> grandfather <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
			<span class="token comment">//    g</span>
			<span class="token comment">// p     u</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token comment">//找到u的位置</span>
				Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
				
				<span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token comment">//u存在且为红,把p/u变黑，g变红,继续向上调整</span>
					parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

					cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
					parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token comment">//u不存在或存在且为黑</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token comment">//     g</span>
						<span class="token comment">//  p     u    </span>
						<span class="token comment">//c</span>
						<span class="token comment">//单旋</span>
						<span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>
						parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token comment">//     g</span>
						<span class="token comment">//  p     u    </span>
						<span class="token comment">//	   c</span>
						<span class="token comment">//双旋</span>
						<span class="token function">RotateL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>
						
						cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token comment">//    g</span>
				<span class="token comment">// u     p</span>
				Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
				
				<span class="token comment">//u存在且为红,把p/u变黑，g变红,继续向上调整</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
					grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

					cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
					parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token comment">//u不存在或存在且为黑</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token comment">//    g</span>
						<span class="token comment">// u      p</span>
						<span class="token comment">//            c</span>
						<span class="token comment">//单旋</span>
						<span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>
						parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token comment">//    g</span>
						<span class="token comment">// u     p</span>
						<span class="token comment">//    c</span>
						<span class="token comment">//双旋</span>
						<span class="token function">RotateR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>
						
						cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		_root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>

		<span class="token keyword">return</span> true<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//中序遍历</span>
	<span class="token keyword">void</span> <span class="token function">InOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">_Inorder</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//判断是否平衡</span>
	bool <span class="token function">IsBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>_root <span class="token operator">==</span> nullptr<span class="token punctuation">)</span>
			<span class="token keyword">return</span> true<span class="token punctuation">;</span>

		<span class="token comment">//检查根节点</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>_root<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
			<span class="token keyword">return</span> false<span class="token punctuation">;</span>
		
		<span class="token comment">// 参考值</span>
		<span class="token keyword">int</span> refNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> BLACK<span class="token punctuation">)</span>
				<span class="token operator">++</span>refNum<span class="token punctuation">;</span>
			
			cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token function">Check</span><span class="token punctuation">(</span>_root<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> refNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

private<span class="token operator">:</span>
	<span class="token comment">//每个节点的位置记录一个值blackNum</span>
	<span class="token comment">//blackNum表示：根节点到当前节点的路径上黑色节点的数量</span>
	bool <span class="token function">Check</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">,</span> <span class="token keyword">int</span> blackNum<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> refNum<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//每条路径走到空后与参考值进行比较</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> nullptr<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//cout &lt;&lt; blackNum &lt;&lt; endl;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>refNum <span class="token operator">!=</span> blackNum<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cout <span class="token operator">&lt;&lt;</span> <span class="token string">"存在黑色节点的数量不相等的路径"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
				<span class="token keyword">return</span> false<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> true<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">//检查是否存在连续的红色节点</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED <span class="token operator">&amp;&amp;</span> root<span class="token operator">-&gt;</span>_parent<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cout <span class="token operator">&lt;&lt;</span> root<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> <span class="token string">"存在连续的红色节点"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
			<span class="token keyword">return</span> false<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> BLACK<span class="token punctuation">)</span>
			blackNum<span class="token operator">++</span><span class="token punctuation">;</span>
		
		<span class="token keyword">return</span> <span class="token function">Check</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">,</span> blackNum<span class="token punctuation">,</span> refNum<span class="token punctuation">)</span>
			<span class="token operator">&amp;&amp;</span> <span class="token function">Check</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">,</span> blackNum<span class="token punctuation">,</span> refNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//右单旋</span>
	<span class="token keyword">void</span> <span class="token function">RotateR</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> subL <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> subLR <span class="token operator">=</span> subL<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>subLR<span class="token punctuation">)</span>
			subLR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
		parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subLR<span class="token punctuation">;</span>

		subL<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		<span class="token comment">//改变之前记录</span>
		Node<span class="token operator">*</span> ppNode <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		parent<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> subL<span class="token punctuation">;</span>

		<span class="token comment">//parent为根</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> _root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_root <span class="token operator">=</span> subL<span class="token punctuation">;</span>
			_root<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> nullptr<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//parent为一颗子树</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>ppNode<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> parent<span class="token punctuation">)</span>
				ppNode<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subL<span class="token punctuation">;</span>
			<span class="token keyword">else</span>
				ppNode<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subL<span class="token punctuation">;</span>

			subL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> ppNode<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//左单旋</span>
	<span class="token keyword">void</span> <span class="token function">RotateL</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Node<span class="token operator">*</span> subR <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
		Node<span class="token operator">*</span> subRL <span class="token operator">=</span> subR<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>subRL<span class="token punctuation">)</span>
			subRL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
		parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subRL<span class="token punctuation">;</span>

		subR<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> parent<span class="token punctuation">;</span>

		Node<span class="token operator">*</span> ppNode <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
		parent<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> subR<span class="token punctuation">;</span>

		<span class="token comment">//parent为根</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> _root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_root <span class="token operator">=</span> subR<span class="token punctuation">;</span>
			_root<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> nullptr<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//parent为一颗子树</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>ppNode<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> parent<span class="token punctuation">)</span>
				ppNode<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subR<span class="token punctuation">;</span>
			<span class="token keyword">else</span>
				ppNode<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subR<span class="token punctuation">;</span>

			subR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> ppNode<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">_Inorder</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> nullptr<span class="token punctuation">)</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>

		<span class="token function">_Inorder</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
		cout <span class="token operator">&lt;&lt;</span> root<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> <span class="token string">":"</span> <span class="token operator">&lt;&lt;</span> root<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>second <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token function">_Inorder</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
private<span class="token operator">:</span>
	Node<span class="token operator">*</span> _root <span class="token operator">=</span> nullptr<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//测试代码</span>
<span class="token keyword">void</span> <span class="token function">Test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//int a[] = { 8, 3, 1, 10, 6, 4, 7, 14, 13 };</span>
	<span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">16</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">15</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	RBTree<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">&gt;</span> t<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> e <span class="token operator">:</span> a<span class="token punctuation">)</span>
		t<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> e <span class="token punctuation">,</span>e <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	t<span class="token punctuation">.</span><span class="token function">InOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> t<span class="token punctuation">.</span><span class="token function">IsBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><mark>Test.cpp</mark></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"RBTree.h"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">Test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><strong>运行结果如下</strong>：</p> 
<p><strong>中序遍历是有序的，说明是搜索二叉树，返回1，说明满足红黑树的性质，是平衡树</strong>。</p> 
<p><img src="https://images2.imgbox.com/b4/9c/aW2qjC6V_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="AVL_748"></a>五，红黑树与AVL树的比较</h2> 
<p><strong>红黑树和AVL树都是高效的平衡二叉树，增删改查的时间复杂度都是O(<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          l 
         
        
          o 
         
         
         
           g 
          
         
           2 
          
         
        
          N 
         
        
       
         log_2 N 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right: 0.109em;">N</span></span></span></span></span>)</strong>，红黑树不追求绝对平衡，<strong>其只需保证最长路径不超过最短路径的2倍</strong>，相对而言，降低了插入和旋转的次数，所以在经常进行增删的结构中性能比AVL树更优，而且红黑树实现比较简单，所以实际运用中红黑树更多。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b57c14fd5199da26f63a49811e409585/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">TCP粘包问题详解和解决方案【C语言】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dcb2d9d4757832be34fc1e4ad6cb1110/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">css -- box-shadow阴影属性的复合写法及高级用法，超详细！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>