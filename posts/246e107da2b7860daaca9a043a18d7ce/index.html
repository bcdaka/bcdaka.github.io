<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Doris: Multi Catalog 多源数据目录 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/246e107da2b7860daaca9a043a18d7ce/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Doris: Multi Catalog 多源数据目录">
  <meta property="og:description" content="文章目录 前言一、基本概念 :目前能支持以下数据源：JDBC 外部表 二、基本操作2.1 查看 catalog2.2 新增catalog2.3 切换 catalog2.4 删除 catalog2.5 查看catalog创建信息 三、元数据更新3.1手动刷新3.2定时刷新3.3自动刷新 四、JDBC Catalog4.1 上传mysql驱动包4.2 创建mysql catalog 总结 前言 Doris 是一个高性能的分析型数据库，它能够处理大规模的数据存储和分析任务。Doris 的 Catalog 是其核心组件之一，负责存储和管理元数据。 一、基本概念 : 多源数据目录（Multi-Catalog）功能，旨在能够更方便对接外部数据目录，以增强Doris的数据湖分析和联邦数据查询能力。 目前能支持以下数据源： 1、Hive Metastore：可以访问包括 Hive、Iceberg、Hudi 在内的数据表，也可对接兼容 Hive Metastore 的数据源，如阿里云的 DataLake Formation，同时支持 HDFS 和对象存储上的数据访问。
2、Elasticsearch：访问 ES 数据源。
3、JDBC：支持通过 JDBC 访问 MySQL 数据源。
JDBC 外部表 在过去版本中，Apache Doris 提供了 ODBC 外部表的方式来访问 MySQL、Oracle、SQL Server、PostgreSQL 等数据源，但由于 ODBC 驱动版本问题可能造成系统的不稳定。相对于 ODBC，JDBC 接口更为统一且支持数据库众多，因此在 1.2.0 版本中我们实现了 JDBC 外部表以替换原有的 ODBC 外部表。在新版本中，用户可以通过 JDBC 连接支持 JDBC 协议的外部数据源，">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-23T10:09:19+08:00">
    <meta property="article:modified_time" content="2024-07-23T10:09:19+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Doris: Multi Catalog 多源数据目录</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_2" rel="nofollow">前言</a></li><li><a href="#__6" rel="nofollow">一、基本概念 :</a></li><li><ul><li><a href="#_9" rel="nofollow">目前能支持以下数据源：</a></li><li><ul><li><a href="#JDBC__16" rel="nofollow">JDBC 外部表</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_27" rel="nofollow">二、基本操作</a></li><li><ul><li><a href="#21__catalog_28" rel="nofollow">2.1 查看 catalog</a></li><li><a href="#22_catalog_43" rel="nofollow">2.2 新增catalog</a></li><li><a href="#23__catalog_55" rel="nofollow">2.3 切换 catalog</a></li><li><a href="#24__catalog_64" rel="nofollow">2.4 删除 catalog</a></li><li><a href="#25_catalog_68" rel="nofollow">2.5 查看catalog创建信息</a></li></ul> 
  </li><li><a href="#_72" rel="nofollow">三、元数据更新</a></li><li><ul><li><a href="#31_77" rel="nofollow">3.1手动刷新</a></li><li><a href="#32_80" rel="nofollow">3.2定时刷新</a></li><li><a href="#33_87" rel="nofollow">3.3自动刷新</a></li></ul> 
  </li><li><a href="#JDBC_Catalog_93" rel="nofollow">四、JDBC Catalog</a></li><li><ul><li><a href="#41_mysql_96" rel="nofollow">4.1 上传mysql驱动包</a></li><li><a href="#42_mysql_catalog_101" rel="nofollow">4.2 创建mysql catalog</a></li></ul> 
  </li><li><a href="#_126" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>前言</h2> 
<ul><li><strong>Doris 是一个高性能的分析型数据库，它能够处理大规模的数据存储和分析任务。Doris 的 Catalog 是其核心组件之一，负责存储和管理元数据。</strong></li></ul> 
<hr> 
<h2><a id="__6"></a>一、基本概念 :</h2> 
<ul><li><strong>多源数据目录（Multi-Catalog）功能，旨在能够更方便对接外部数据目录，以增强Doris的数据湖分析和联邦数据查询能力。</strong></li></ul> 
<h3><a id="_9"></a>目前能支持以下数据源：</h3> 
<ul><li> <p><strong>1、Hive Metastore：可以访问包括 Hive、Iceberg、Hudi 在内的数据表，也可对接兼容 Hive Metastore 的数据源，如阿里云的 DataLake Formation，同时支持 HDFS 和对象存储上的数据访问。</strong></p> </li><li> <p><strong>2、Elasticsearch：访问 ES 数据源。</strong></p> </li><li> <p><strong>3、JDBC：支持通过 JDBC 访问 MySQL 数据源。</strong></p> </li></ul> 
<h4><a id="JDBC__16"></a>JDBC 外部表</h4> 
<ul><li> <p><strong>在过去版本中，Apache Doris 提供了 ODBC 外部表的方式来访问 MySQL、Oracle、SQL Server、PostgreSQL 等数据源，但由于 ODBC 驱动版本问题可能造成系统的不稳定。相对于 ODBC，JDBC 接口更为统一且支持数据库众多，因此在 1.2.0 版本中我们实现了 JDBC 外部表以替换原有的 ODBC 外部表。在新版本中，用户可以通过 JDBC 连接支持 JDBC 协议的外部数据源，</strong></p> </li><li> <p>当前已适配的数据源包括：</p> </li><li> <p><strong>MySQL</strong></p> </li><li> <p><strong>PostgreSQL</strong></p> </li><li> <p><strong>Oracle</strong></p> </li><li> <p><strong>SQLServer</strong></p> </li><li> <p><strong>ClickHouse</strong><br> <strong>更多数据源的适配已经在规划之中，原则上任何支持 JDBC 协议访问的数据库均能通过 JDBC 外部表的方式来访问。而之前的 ODBC 外部表功能将会在后续的某个版本中移除，还请尽量切换到 JDBC 外表功能。</strong></p> </li></ul> 
<h2><a id="_27"></a>二、基本操作</h2> 
<h3><a id="21__catalog_28"></a>2.1 查看 catalog</h3> 
<pre><code class="prism language-sql"><span class="token keyword">show</span> catalogs<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a0/69/rPyzEjJW_o.png" alt="show catalogs"></p> 
<pre><code class="prism language-sql"><span class="token comment">//模糊查询catalog</span>
<span class="token keyword">SHOW</span> CATALOGS <span class="token operator">LIKE</span> <span class="token string">'%56%'</span>
<span class="token comment">//查询该catalog下有哪些实例(库)</span>
<span class="token keyword">show</span> <span class="token keyword">databases</span> <span class="token keyword">from</span> jdbc_oracle_zqxk40<span class="token punctuation">;</span>
<span class="token comment">//查询该实例(库)下有哪些表</span>
<span class="token keyword">show</span> <span class="token keyword">tables</span> <span class="token keyword">from</span> jdbc_oracle_zqxk40<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>C##YUNZHENGDATA<span class="token punctuation">`</span></span><span class="token punctuation">;</span>
<span class="token comment">//查询oracle远程表的数据</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> jdbc_oracle_zqxk40<span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>C##YUNZHENGDATA<span class="token punctuation">`</span></span><span class="token punctuation">.</span>BIAO1_QUANLIANGCHE <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="22_catalog_43"></a>2.2 新增catalog</h3> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> CATALOG <span class="token identifier"><span class="token punctuation">`</span>jdbc_oracle_zqxk40<span class="token punctuation">`</span></span> PROPERTIES <span class="token punctuation">(</span> 
                <span class="token string">"type"</span> <span class="token operator">=</span> <span class="token string">"jdbc"</span><span class="token punctuation">,</span> 
                <span class="token string">"user"</span> <span class="token operator">=</span> <span class="token string">"C##YUNZHENGDATA"</span><span class="token punctuation">,</span> 
                <span class="token string">"password"</span> <span class="token operator">=</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span> 
                <span class="token string">"jdbc_url"</span> <span class="token operator">=</span> <span class="token string">"jdbc:oracle:thin:@//172.0.0.1:1521/ORCLCDB"</span><span class="token punctuation">,</span> 
                <span class="token string">"driver_url"</span> <span class="token operator">=</span> <span class="token string">"ojdbc6-11.2.0.3.jar"</span><span class="token punctuation">,</span> 
                <span class="token string">"driver_class"</span> <span class="token operator">=</span> <span class="token string">"oracle.jdbc.driver.OracleDriver"</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="23__catalog_55"></a>2.3 切换 catalog</h3> 
<pre><code class="prism language-sql">switch catalog_name<span class="token punctuation">;</span>
</code></pre> 
<p><strong>切换后，可以直接通过 SHOW DATABASES，USE DB 等命令查看和切换对应 Catalog 中的 Database。Doris 会自动通过 Catalog 中的 Database 和 Table。用户可以像使用 Internal Catalog 一样，对 External Catalog 中的数据进行查看和访问。</strong></p> 
<p><strong>当前，Doris 只支持对 External Catalog 中的数据进行只读访问。</strong></p> 
<h3><a id="24__catalog_64"></a>2.4 删除 catalog</h3> 
<pre><code class="prism language-sql"><span class="token keyword">DROP</span> CATALOG <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> jdbc_oracle_56_dlyz_clear<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="25_catalog_68"></a>2.5 查看catalog创建信息</h3> 
<pre><code class="prism language-sql"><span class="token keyword">show</span> <span class="token keyword">create</span> catalog jdbc_oracle_56_dlyz_clear<span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_72"></a>三、元数据更新</h2> 
<ul><li> <p><strong>默认情况下，外部数据源的元数据变动，如创建、删除表，加减列等操作，不会同步给 Doris。</strong></p> </li><li> <p><strong>用户可以通过以下几种方式刷新元数据。</strong></p> </li></ul> 
<h3><a id="31_77"></a>3.1手动刷新</h3> 
<ul><li><strong>用户需要通过 REFRESH CATALOG catalog_name;命令手动刷新元数据。</strong></li></ul> 
<h3><a id="32_80"></a>3.2定时刷新</h3> 
<ul><li> <p><strong>在创建catalog时，在properties 中指定刷新时间参数metadata_refresh_interval_sec ，以秒为单位，若在创建catalog时设置了该参数，FE 的master节点会根据参数值定时刷新该catalog。目前支持三种类型</strong></p> </li><li> <p><strong>hms</strong>：Hive MetaStore</p> </li><li> <p><strong>es</strong>：Elasticsearch</p> </li><li> <p><strong>jdbc</strong>：数据库访问的标准接口(JDBC)</p> </li></ul> 
<h3><a id="33_87"></a>3.3自动刷新</h3> 
<p><strong>自动刷新目前仅支持 Hive Catalog。该特性在 fe.conf 中有如下参数：</strong></p> 
<ul><li><strong>enable_hms_events_incremental_sync: 是否开启元数据自动增量同步功能,默认关闭。</strong></li><li><strong>hms_events_polling_interval_ms: 读取 event 的间隔时间，默认值为 10000，单位：毫秒。</strong></li><li><strong>hms_events_batch_size_per_rpc: 每次读取 event 的最大数量，默认值为 500。</strong></li></ul> 
<h2><a id="JDBC_Catalog_93"></a>四、JDBC Catalog</h2> 
<ul><li><strong>JDBC Catalog 通过标准 JDBC 协议，连接其他数据源。连接后，Doris 会自动同步数据源下的 Database 和 Table 的元数据，以便快速访问这些外部数据。</strong></li></ul> 
<h3><a id="41_mysql_96"></a>4.1 上传mysql驱动包</h3> 
<ul><li><strong>需将 Jar 包预先存放在 FE 和 BE 部署目录的 jdbc_drivers/ 目录下。系统会自动在这个目录下寻找。该目录的位置，也可以由 fe.conf 和 be.conf 中的 jdbc_drivers_dir 配置修改。</strong><br> <img src="https://images2.imgbox.com/18/d4/VYz68Q1O_o.png" alt="mysql-jdbc"></li><li><strong>修改fe和be配置文件，指定jdbc_drivers_dir目录。</strong><br> <img src="https://images2.imgbox.com/e7/3f/9prRzm8v_o.png" alt="fe.conf,be.conf"></li></ul> 
<h3><a id="42_mysql_catalog_101"></a>4.2 创建mysql catalog</h3> 
<pre><code class="prism language-sql"><span class="token comment">####mysql 8</span>
<span class="token keyword">CREATE</span> CATALOG jdbc_mysql_233_8 PROPERTIES <span class="token punctuation">(</span>
    <span class="token string">"type"</span><span class="token operator">=</span><span class="token string">"jdbc"</span><span class="token punctuation">,</span>
    <span class="token string">"user"</span><span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>
    <span class="token string">"password"</span><span class="token operator">=</span><span class="token string">"123456"</span><span class="token punctuation">,</span>
    <span class="token string">"jdbc_url"</span> <span class="token operator">=</span> <span class="token string">"jdbc:mysql://192.168.110.233:3307/demo"</span><span class="token punctuation">,</span>
    <span class="token string">"driver_url"</span> <span class="token operator">=</span> <span class="token string">"mysql-connector-java-8.0.30.jar"</span><span class="token punctuation">,</span>
    <span class="token string">"driver_class"</span> <span class="token operator">=</span> <span class="token string">"com.mysql.cj.jdbc.Driver"</span>
<span class="token punctuation">)</span>

<span class="token comment">####mysql 5</span>
<span class="token keyword">CREATE</span> CATALOG jdbc_mysql_233_5  PROPERTIES <span class="token punctuation">(</span>
    <span class="token string">"type"</span><span class="token operator">=</span><span class="token string">"jdbc"</span><span class="token punctuation">,</span>
    <span class="token string">"user"</span><span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>
    <span class="token string">"password"</span><span class="token operator">=</span><span class="token string">"123456"</span><span class="token punctuation">,</span>
    <span class="token string">"jdbc_url"</span> <span class="token operator">=</span> <span class="token string">"jdbc:mysql://192.168.110.233:3306/demo"</span><span class="token punctuation">,</span>
    <span class="token string">"driver_url"</span> <span class="token operator">=</span> <span class="token string">"mysql-connector-java-5.1.47.jar"</span><span class="token punctuation">,</span>
    <span class="token string">"driver_class"</span> <span class="token operator">=</span> <span class="token string">"com.mysql.jdbc.Driver"</span>
<span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h2><a id="_126"></a>总结</h2> 
<blockquote> 
 <p>如果此篇文章有帮助到您, 希望打大佬们能<code>关注</code>、<code>点赞</code>、<code>收藏</code>、<code>评论</code>支持一波，非常感谢大家！<br> 如果有不对的地方请指正!!!</p> 
</blockquote> 
<p><a href="https://doris.apache.org/zh-CN/docs/2.0/releasenotes/release-1.2.0?_highlight=multi&amp;_highlight=catalog#3-multi-catalog-%E5%A4%9A%E6%BA%90%E6%95%B0%E6%8D%AE%E7%9B%AE%E5%BD%95" rel="nofollow">参考1</a><br> <a href="https://blog.csdn.net/m0_37559973/article/details/134266182">参考2</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/36b0449684ce73e8f53e9a732b5170e4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Godot4.2】GodotXML插件 - 解析和生成XML</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f1c7518973ee8ab5069557ebcf725da4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">某雪冰城小程序逆向</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>