<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>大数据-78 Kafka 集群模式 集群的应用场景与Kafka集群的搭建 三台云服务器 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/926000112aef68722812ddfdf98b3177/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="大数据-78 Kafka 集群模式 集群的应用场景与Kafka集群的搭建 三台云服务器">
  <meta property="og:description" content="点一下关注吧！！！非常感谢！！持续更新！！！ 目前已经更新到了： Hadoop（已更完）HDFS（已更完）MapReduce（已更完）Hive（已更完）Flume（已更完）Sqoop（已更完）Zookeeper（已更完）HBase（已更完）Redis （已更完）Kafka（正在更新…） 章节内容 上节我们完成了如下的内容：
Kafka 延时队列Kafka 重试队列Kafka JavaAPI 实现 重试队列的操作 应用场景 消息传递 Kafka可以很好的替代传统的邮件代理，消息代理的使用有很多种原因（将处理与数据生产者分离，缓冲未处理消息等）。与大多数邮件系统相比，Kafka具有更好的吞吐量，内置的分区，复制和容错功能，这使其成为大规模邮件处理应用程序的理想解决方案。
网站活动路由 Kafka最初的用例是能够将用户活动跟踪管道重建为一组实时的发布-订阅。这意味着将网站活动（页面浏览、搜索、其他操作等）发布到主题中心，每种活动类型只有一个主题。这些可用于一系列的用例的订阅，包括实时处理，实时监控，以及加载到Hadoop或脱机数据仓库系统中以进行脱机处理和报告。
活动跟踪通常量很大，因为每个用户页面视图都会生成许多活动消息。
监控指标 Kafka通常用于操作监控数据，这涉及汇总来自分布式应用程序的统计信息，以生成操作数据的集中。
日志汇总 许多人使用Kafka代替日志聚合解决方案，日志聚合通常从服务器收集物理日志文件，并将它们放在中央位置（也许是文件服务器或HDFS）以进行处理。Kafka提取文件的详细信息，并以日志的形式更清晰的抽象日志或事件数据，这允许较低的延迟的处理，并更容易支持多个数据源和分布式数据消耗。以日志为中心的系统（例如Scribe或Flume）相比，Kafka具有同样出色的性能，由于复制而提供的更强的耐用性保证以及更低的端到端的延迟。
流处理 Kafka的需要用户在由多个阶段组成的处理管道中处理数据，其中原始输入数据从Kafka主题中使用，然后进行汇总，充实或以其他方式转换为新主题，以供进一步使用或后续处理。例如，用于推荐新闻文章的处理管道可能会从RSS提要中检索文章内容，并将其发布到文章主题中。进一步的处理可能会使该内容规范化或重复数据删除，并将清晰后的文章内容发布到新主题中。最后的处理阶段可能会尝试向用户推荐此内容。这样的处理管道基于各个主题创建实时数据流的图形。
从0.10.0.0开始，一个轻量但功能强大的流处理库成为KafkaStreams可以在ApacheKafka中使用来执行上述数据处理。除了KafkaStreams之外，其他开源流处理工具还包括ApacheStorm和Apache Samza。
活动采集 事件源是一种应用程序，其中状态更改以时间顺序记录记录。Kafka对大量存储的日志数据的支持使其成为以这种样式构建的应用程序的绝佳后端。
提交日志 Kafka可以用作分布式系统的一种外部提交日志，该日志有助于在节点之间复制数据，并充当故障节点恢复其数据的重新同步机制。Kafka中的日志压缩功能有助于支持此用法。
集群搭建 集群设计 由于之前我们已经搭建过单机的Kafka，同时我们为了做之前的实验，一共搭建了两台Kafka的小集群（用作Broker宕机之后的分区、副本等内容的测试），这里我们将对一些部分进行简化。
机器详情 目前我们有三台云服务：
h121.wzk.icuh122.wzk.icuh123.wzk.icu 我们已经搭建好了，ZooKeeper的集群，如果你还没有搭建，需要回到之前的章节：ZooKeeper集群搭建。
这里开始，我们直接搭建Kafka的集群环境。
在 h121.wzk.icu 中，我我们已经有了：kafka_2.12-2.7.2 且是配置好的。
我们借助之前Hadoop中编写的Shell工具来完成Kafka文件的分发（你也可以使用别的方法，比如压缩包等等）
rsync-script kafka_2.12-2.7.2/ h121 h122 h123 环境变量 我们在三台节点上，尽量配置好环境变量：
JDKZooKeeperKafka 修改配置 h121 vim /opt/servers/kafka_2.12-2.7.2/config/server.properties 修改如下内容：
# h121是0、h122是1、h123是2 broker.id=0 # 数据的存储目录 log.dirs=/opt/kafka-logs # ZooKeeper 地址 zookeeper.connect=h121.wzk.icu:2181,h122.wzk.icu:2181,h123.wzk.icu:2181 对应的内容截图如下所示：
h122 # h121是0、h122是1、h123是2 broker.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-12T09:30:19+08:00">
    <meta property="article:modified_time" content="2024-08-12T09:30:19+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">大数据-78 Kafka 集群模式 集群的应用场景与Kafka集群的搭建 三台云服务器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>点一下关注吧！！！非常感谢！！持续更新！！！</h2> 
<h2><a id="_1"></a>目前已经更新到了：</h2> 
<ul><li>Hadoop（已更完）</li><li>HDFS（已更完）</li><li>MapReduce（已更完）</li><li>Hive（已更完）</li><li>Flume（已更完）</li><li>Sqoop（已更完）</li><li>Zookeeper（已更完）</li><li>HBase（已更完）</li><li>Redis （已更完）</li><li>Kafka（正在更新…）</li></ul> 
<h2><a id="_13"></a>章节内容</h2> 
<p>上节我们完成了如下的内容：</p> 
<ul><li>Kafka 延时队列</li><li>Kafka 重试队列</li><li>Kafka JavaAPI 实现 重试队列的操作</li></ul> 
<p><img src="https://images2.imgbox.com/01/9d/1aVsTjmZ_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_20"></a>应用场景</h2> 
<h3><a id="_21"></a>消息传递</h3> 
<p>Kafka可以很好的替代传统的邮件代理，消息代理的使用有很多种原因（将处理与数据生产者分离，缓冲未处理消息等）。与大多数邮件系统相比，Kafka具有更好的吞吐量，内置的分区，复制和容错功能，这使其成为大规模邮件处理应用程序的理想解决方案。</p> 
<h3><a id="_23"></a>网站活动路由</h3> 
<p>Kafka最初的用例是能够将用户活动跟踪管道重建为一组实时的发布-订阅。这意味着将网站活动（页面浏览、搜索、其他操作等）发布到主题中心，每种活动类型只有一个主题。这些可用于一系列的用例的订阅，包括实时处理，实时监控，以及加载到Hadoop或脱机数据仓库系统中以进行脱机处理和报告。<br> 活动跟踪通常量很大，因为每个用户页面视图都会生成许多活动消息。</p> 
<h3><a id="_26"></a>监控指标</h3> 
<p>Kafka通常用于操作监控数据，这涉及汇总来自分布式应用程序的统计信息，以生成操作数据的集中。</p> 
<h3><a id="_28"></a>日志汇总</h3> 
<p>许多人使用Kafka代替日志聚合解决方案，日志聚合通常从服务器收集物理日志文件，并将它们放在中央位置（也许是文件服务器或HDFS）以进行处理。Kafka提取文件的详细信息，并以日志的形式更清晰的抽象日志或事件数据，这允许较低的延迟的处理，并更容易支持多个数据源和分布式数据消耗。以日志为中心的系统（例如Scribe或Flume）相比，Kafka具有同样出色的性能，由于复制而提供的更强的耐用性保证以及更低的端到端的延迟。</p> 
<h3><a id="_30"></a>流处理</h3> 
<p>Kafka的需要用户在由多个阶段组成的处理管道中处理数据，其中原始输入数据从Kafka主题中使用，然后进行汇总，充实或以其他方式转换为新主题，以供进一步使用或后续处理。例如，用于推荐新闻文章的处理管道可能会从RSS提要中检索文章内容，并将其发布到文章主题中。进一步的处理可能会使该内容规范化或重复数据删除，并将清晰后的文章内容发布到新主题中。最后的处理阶段可能会尝试向用户推荐此内容。这样的处理管道基于各个主题创建实时数据流的图形。<br> 从0.10.0.0开始，一个轻量但功能强大的流处理库成为KafkaStreams可以在ApacheKafka中使用来执行上述数据处理。除了KafkaStreams之外，其他开源流处理工具还包括ApacheStorm和Apache Samza。</p> 
<h3><a id="_33"></a>活动采集</h3> 
<p>事件源是一种应用程序，其中状态更改以时间顺序记录记录。Kafka对大量存储的日志数据的支持使其成为以这种样式构建的应用程序的绝佳后端。</p> 
<h3><a id="_35"></a>提交日志</h3> 
<p>Kafka可以用作分布式系统的一种外部提交日志，该日志有助于在节点之间复制数据，并充当故障节点恢复其数据的重新同步机制。Kafka中的日志压缩功能有助于支持此用法。</p> 
<h2><a id="_39"></a>集群搭建</h2> 
<h3><a id="_40"></a>集群设计</h3> 
<p><img src="https://images2.imgbox.com/f5/56/gSuGJohO_o.png" alt="在这里插入图片描述"><br> 由于之前我们已经搭建过单机的Kafka，同时我们为了做之前的实验，一共搭建了两台Kafka的小集群（用作Broker宕机之后的分区、副本等内容的测试），这里我们将对一些部分进行简化。</p> 
<h3><a id="_44"></a>机器详情</h3> 
<p>目前我们有三台云服务：</p> 
<ul><li>h121.wzk.icu</li><li>h122.wzk.icu</li><li>h123.wzk.icu</li></ul> 
<p>我们已经搭建好了，ZooKeeper的集群，如果你还没有搭建，需要回到之前的章节：ZooKeeper集群搭建。<br> 这里开始，我们直接搭建Kafka的集群环境。<br> 在 h121.wzk.icu 中，我我们已经有了：kafka_2.12-2.7.2 且是配置好的。<br> <img src="https://images2.imgbox.com/91/23/fxrWfydo_o.png" alt="在这里插入图片描述"><br> 我们借助之前Hadoop中编写的Shell工具来完成Kafka文件的分发（你也可以使用别的方法，比如压缩包等等）</p> 
<pre><code class="prism language-shell">rsync-script kafka_2.12-2.7.2/
</code></pre> 
<h3><a id="h121_59"></a>h121</h3> 
<p><img src="https://images2.imgbox.com/00/e3/SdpfXFkC_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="h122_62"></a>h122</h3> 
<p><img src="https://images2.imgbox.com/8b/2f/8GhujPUQ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="h123_64"></a>h123</h3> 
<p><img src="https://images2.imgbox.com/a4/f6/g9jiytVY_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_66"></a>环境变量</h3> 
<p>我们在三台节点上，尽量配置好环境变量：</p> 
<ul><li>JDK</li><li>ZooKeeper</li><li>Kafka</li></ul> 
<p><img src="https://images2.imgbox.com/a0/4d/7ossvIYT_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_73"></a>修改配置</h3> 
<h4><a id="h121_74"></a>h121</h4> 
<pre><code class="prism language-shell"><span class="token function">vim</span> /opt/servers/kafka_2.12-2.7.2/config/server.properties
</code></pre> 
<p>修改如下内容：</p> 
<pre><code class="prism language-shell"><span class="token comment"># h121是0、h122是1、h123是2</span>
<span class="token assign-left variable">broker.id</span><span class="token operator">=</span><span class="token number">0</span>

<span class="token comment"># 数据的存储目录</span>
<span class="token assign-left variable">log.dirs</span><span class="token operator">=</span>/opt/kafka-logs

<span class="token comment"># ZooKeeper 地址</span>
<span class="token assign-left variable">zookeeper.connect</span><span class="token operator">=</span>h121.wzk.icu:2181,h122.wzk.icu:2181,h123.wzk.icu:2181
</code></pre> 
<p>对应的内容截图如下所示：<br> <img src="https://images2.imgbox.com/6c/a9/E8gAZC0S_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="h122_91"></a>h122</h4> 
<pre><code class="prism language-shell"><span class="token comment"># h121是0、h122是1、h123是2</span>
<span class="token assign-left variable">broker.id</span><span class="token operator">=</span><span class="token number">1</span>

<span class="token comment"># 数据的存储目录</span>
<span class="token assign-left variable">log.dirs</span><span class="token operator">=</span>/opt/kafka-logs

<span class="token comment"># ZooKeeper 地址</span>
<span class="token assign-left variable">zookeeper.connect</span><span class="token operator">=</span>h121.wzk.icu:2181,h122.wzk.icu:2181,h123.wzk.icu:2181
</code></pre> 
<p><img src="https://images2.imgbox.com/45/81/csCyrQwI_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="h123_104"></a>h123</h4> 
<pre><code class="prism language-shell"><span class="token comment"># h121是0、h122是1、h123是2</span>
<span class="token assign-left variable">broker.id</span><span class="token operator">=</span><span class="token number">3</span>

<span class="token comment"># 数据的存储目录</span>
<span class="token assign-left variable">log.dirs</span><span class="token operator">=</span>/opt/kafka-logs

<span class="token comment"># ZooKeeper 地址</span>
<span class="token assign-left variable">zookeeper.connect</span><span class="token operator">=</span>h121.wzk.icu:2181,h122.wzk.icu:2181,h123.wzk.icu:2181
</code></pre> 
<p>对应的截图如下图所示：<br> <img src="https://images2.imgbox.com/10/cd/U9xGPx5H_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_119"></a>启动集群</h3> 
<p>在每台节点上都执行：</p> 
<pre><code class="prism language-shell">kafka-server-start.sh /opt/servers/kafka_2.12-2.7.2/config/server.properties
</code></pre> 
<h3><a id="_125"></a>查看集群</h3> 
<p>我们需要进入ZooKeeper来启动服务：</p> 
<pre><code class="prism language-shell">zkCli.sh
<span class="token comment"># 进入ZK后，我们查看当中的信息</span>
<span class="token function">ls</span> /brokers/ids
</code></pre> 
<p>执行结果如下图所示：<br> 第一次执行的时候，我的第三台没有配置好环境变量，启动失败了，第二次可以看到：【0,1,2】<br> <img src="https://images2.imgbox.com/45/bc/Yi4Bnuek_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="h121_136"></a>h121</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">2</span><span class="token punctuation">]</span> get /brokers/ids/0
<span class="token punctuation">{<!-- --></span><span class="token string">"listener_security_protocol_map"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"PLAINTEXT"</span><span class="token builtin class-name">:</span><span class="token string">"PLAINTEXT"</span><span class="token punctuation">}</span>,<span class="token string">"endpoints"</span>:<span class="token punctuation">[</span><span class="token string">"PLAINTEXT://h121.wzk.icu:9092"</span><span class="token punctuation">]</span>,<span class="token string">"jmx_port"</span>:-1,<span class="token string">"features"</span>:<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>,<span class="token string">"host"</span><span class="token builtin class-name">:</span><span class="token string">"h121.wzk.icu"</span>,<span class="token string">"timestamp"</span><span class="token builtin class-name">:</span><span class="token string">"1722931444209"</span>,<span class="token string">"port"</span>:9092,<span class="token string">"version"</span>:5<span class="token punctuation">}</span>
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">3</span><span class="token punctuation">]</span> 
</code></pre> 
<h4><a id="h122_143"></a>h122</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">3</span><span class="token punctuation">]</span> get /brokers/ids/1
<span class="token punctuation">{<!-- --></span><span class="token string">"listener_security_protocol_map"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"PLAINTEXT"</span><span class="token builtin class-name">:</span><span class="token string">"PLAINTEXT"</span><span class="token punctuation">}</span>,<span class="token string">"endpoints"</span>:<span class="token punctuation">[</span><span class="token string">"PLAINTEXT://h122.wzk.icu:9092"</span><span class="token punctuation">]</span>,<span class="token string">"jmx_port"</span>:-1,<span class="token string">"features"</span>:<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>,<span class="token string">"host"</span><span class="token builtin class-name">:</span><span class="token string">"h122.wzk.icu"</span>,<span class="token string">"timestamp"</span><span class="token builtin class-name">:</span><span class="token string">"1722931447944"</span>,<span class="token string">"port"</span>:9092,<span class="token string">"version"</span>:5<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="h123_149"></a>h123</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">4</span><span class="token punctuation">]</span> get /brokers/ids/2
<span class="token punctuation">{<!-- --></span><span class="token string">"listener_security_protocol_map"</span>:<span class="token punctuation">{<!-- --></span><span class="token string">"PLAINTEXT"</span><span class="token builtin class-name">:</span><span class="token string">"PLAINTEXT"</span><span class="token punctuation">}</span>,<span class="token string">"endpoints"</span>:<span class="token punctuation">[</span><span class="token string">"PLAINTEXT://h123.wzk.icu:9092"</span><span class="token punctuation">]</span>,<span class="token string">"jmx_port"</span>:-1,<span class="token string">"features"</span>:<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>,<span class="token string">"host"</span><span class="token builtin class-name">:</span><span class="token string">"h123.wzk.icu"</span>,<span class="token string">"timestamp"</span><span class="token builtin class-name">:</span><span class="token string">"1722931584357"</span>,<span class="token string">"port"</span>:9092,<span class="token string">"version"</span>:5<span class="token punctuation">}</span>
</code></pre> 
<p>如下所示：<br> <img src="https://images2.imgbox.com/5a/6a/NrEKLtgR_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/65daed308a1ebbfcfefbf2bf21aff926/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Typescript在AI产品中应用越来越广泛</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/91cd419ba28d4f43c41a0042552a2bc6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">成功解决7版本的数据库导入 8版本数据库脚本报错问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>