<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用Apache Flink实现MySQL数据读取和写入的完整指南 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/df2f13fa370829caab5cab5f81f6b347/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="使用Apache Flink实现MySQL数据读取和写入的完整指南">
  <meta property="og:description" content="1. 导言： Apache Flink是一款功能强大的流式处理引擎，可用于实时处理大规模数据。本文将介绍如何使用Flink与MySQL数据库进行交互，以清洗股票数据为例。
2. 环境准备： 首先，确保已安装Apache Flink并配置好MySQL数据库。导入相关依赖包，并创建必要的Table。同时需要提前创建好mysql表，一行source表，一张sink表。
CREATE TABLE `re_stock_code_price` ( `id` bigint NOT NULL AUTO_INCREMENT, `code` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT &#39;股票代码&#39;, `name` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT &#39;股票名称&#39;, `close` double DEFAULT NULL COMMENT &#39;最新价&#39;, `change_percent` double DEFAULT NULL COMMENT &#39;涨跌幅&#39;, `change` double DEFAULT NULL COMMENT &#39;涨跌额&#39;, `volume` double DEFAULT NULL COMMENT &#39;成交量（手）&#39;, `amount` double DEFAULT NULL COMMENT &#39;成交额&#39;, `amplitude` double DEFAULT NULL COMMENT &#39;振幅&#39;, `turnover_rate` double DEFAULT NULL COMMENT &#39;换手率&#39;, `peration` double DEFAULT NULL COMMENT &#39;市盈率&#39;, `volume_rate` double DEFAULT NULL COMMENT &#39;量比&#39;, `hign` double DEFAULT NULL COMMENT &#39;最高&#39;, `low` double DEFAULT NULL COMMENT &#39;最低&#39;, `open` double DEFAULT NULL COMMENT &#39;今开&#39;, `previous_close` double DEFAULT NULL COMMENT &#39;昨收&#39;, `pb` double DEFAULT NULL COMMENT &#39;市净率&#39;, `create_time` varchar(64) NOT NULL COMMENT &#39;写入时间&#39;, `rise` int NOT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=11207 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci CREATE TABLE `t_stock_code_price` ( `id` bigint NOT NULL AUTO_INCREMENT, `code` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT &#39;股票代码&#39;, `name` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL COMMENT &#39;股票名称&#39;, `close` double DEFAULT NULL COMMENT &#39;最新价&#39;, `change_percent` double DEFAULT NULL COMMENT &#39;涨跌幅&#39;, `change` double DEFAULT NULL COMMENT &#39;涨跌额&#39;, `volume` double DEFAULT NULL COMMENT &#39;成交量（手）&#39;, `amount` double DEFAULT NULL COMMENT &#39;成交额&#39;, `amplitude` double DEFAULT NULL COMMENT &#39;振幅&#39;, `turnover_rate` double DEFAULT NULL COMMENT &#39;换手率&#39;, `peration` double DEFAULT NULL COMMENT &#39;市盈率&#39;, `volume_rate` double DEFAULT NULL COMMENT &#39;量比&#39;, `hign` double DEFAULT NULL COMMENT &#39;最高&#39;, `low` double DEFAULT NULL COMMENT &#39;最低&#39;, `open` double DEFAULT NULL COMMENT &#39;今开&#39;, `previous_close` double DEFAULT NULL COMMENT &#39;昨收&#39;, `pb` double DEFAULT NULL COMMENT &#39;市净率&#39;, `create_time` varchar(64) NOT NULL COMMENT &#39;写入时间&#39;, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=11207 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci package org.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-03-28T19:28:13+08:00">
    <meta property="article:modified_time" content="2024-03-28T19:28:13+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用Apache Flink实现MySQL数据读取和写入的完整指南</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1__0"></a>1. 导言：</h3> 
<p>Apache Flink是一款功能强大的流式处理引擎，可用于实时处理大规模数据。本文将介绍如何使用Flink与MySQL数据库进行交互，以清洗股票数据为例。</p> 
<h3><a id="2__3"></a>2. 环境准备：</h3> 
<p>首先，确保已安装Apache Flink并配置好MySQL数据库。导入相关依赖包，并创建必要的Table。同时需要提前创建好mysql表，一行source表，一张sink表。</p> 
<pre><code class="prism language-java"><span class="token constant">CREATE</span> <span class="token constant">TABLE</span> `re_stock_code_price` <span class="token punctuation">(</span>
  `id` bigint <span class="token constant">NOT</span> <span class="token class-name">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  `code` <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token constant">CHARACTER</span> <span class="token constant">SET</span> utf8mb4 <span class="token constant">COLLATE</span> utf8mb4_0900_ai_ci <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'股票代码'</span><span class="token punctuation">,</span>
  `name` <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token constant">CHARACTER</span> <span class="token constant">SET</span> utf8mb4 <span class="token constant">COLLATE</span> utf8mb4_0900_ai_ci <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'股票名称'</span><span class="token punctuation">,</span>
  `close` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'最新价'</span><span class="token punctuation">,</span>
  `change_percent` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'涨跌幅'</span><span class="token punctuation">,</span>
  `change` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'涨跌额'</span><span class="token punctuation">,</span>
  `volume` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'成交量（手）'</span><span class="token punctuation">,</span>
  `amount` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'成交额'</span><span class="token punctuation">,</span>
  `amplitude` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'振幅'</span><span class="token punctuation">,</span>
  `turnover_rate` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'换手率'</span><span class="token punctuation">,</span>
  `peration` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'市盈率'</span><span class="token punctuation">,</span>
  `volume_rate` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'量比'</span><span class="token punctuation">,</span>
  `hign` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'最高'</span><span class="token punctuation">,</span>
  `low` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'最低'</span><span class="token punctuation">,</span>
  `<span class="token keyword">open</span>` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'今开'</span><span class="token punctuation">,</span>
  `previous_close` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'昨收'</span><span class="token punctuation">,</span>
  `pb` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'市净率'</span><span class="token punctuation">,</span>
  `create_time` <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'写入时间'</span><span class="token punctuation">,</span>
  `rise` <span class="token keyword">int</span> <span class="token class-name">NOT</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>
  <span class="token class-name">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span>`id`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token constant">ENGINE</span><span class="token operator">=</span><span class="token class-name">InnoDB</span> <span class="token constant">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">11207</span> <span class="token class-name">DEFAULT</span> <span class="token constant">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token constant">COLLATE</span><span class="token operator">=</span>utf8mb4_0900_ai_ci 

<span class="token constant">CREATE</span> <span class="token constant">TABLE</span> `t_stock_code_price` <span class="token punctuation">(</span>
  `id` bigint <span class="token constant">NOT</span> <span class="token class-name">NULL</span> <span class="token constant">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  `code` <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token constant">CHARACTER</span> <span class="token constant">SET</span> utf8mb4 <span class="token constant">COLLATE</span> utf8mb4_0900_ai_ci <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'股票代码'</span><span class="token punctuation">,</span>
  `name` <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token constant">CHARACTER</span> <span class="token constant">SET</span> utf8mb4 <span class="token constant">COLLATE</span> utf8mb4_0900_ai_ci <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'股票名称'</span><span class="token punctuation">,</span>
  `close` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'最新价'</span><span class="token punctuation">,</span>
  `change_percent` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'涨跌幅'</span><span class="token punctuation">,</span>
  `change` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'涨跌额'</span><span class="token punctuation">,</span>
  `volume` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'成交量（手）'</span><span class="token punctuation">,</span>
  `amount` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'成交额'</span><span class="token punctuation">,</span>
  `amplitude` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'振幅'</span><span class="token punctuation">,</span>
  `turnover_rate` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'换手率'</span><span class="token punctuation">,</span>
  `peration` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'市盈率'</span><span class="token punctuation">,</span>
  `volume_rate` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'量比'</span><span class="token punctuation">,</span>
  `hign` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'最高'</span><span class="token punctuation">,</span>
  `low` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'最低'</span><span class="token punctuation">,</span>
  `<span class="token keyword">open</span>` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'今开'</span><span class="token punctuation">,</span>
  `previous_close` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'昨收'</span><span class="token punctuation">,</span>
  `pb` <span class="token keyword">double</span> <span class="token constant">DEFAULT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'市净率'</span><span class="token punctuation">,</span>
  `create_time` <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token constant">NOT</span> <span class="token constant">NULL</span> <span class="token constant">COMMENT</span> <span class="token char">'写入时间'</span><span class="token punctuation">,</span>
  <span class="token class-name">PRIMARY</span> <span class="token constant">KEY</span> <span class="token punctuation">(</span>`id`<span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token constant">ENGINE</span><span class="token operator">=</span><span class="token class-name">InnoDB</span> <span class="token constant">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">11207</span> <span class="token class-name">DEFAULT</span> <span class="token constant">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token constant">COLLATE</span><span class="token operator">=</span>utf8mb4_0900_ai_ci 
</code></pre> 
<pre><code class="prism language-scala"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>east</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">RuntimeExecutionMode</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>scala<span class="token punctuation">.</span></span><span class="token class-name">StreamExecutionEnvironment</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>scala<span class="token punctuation">.</span></span><span class="token class-name">StreamTableEnvironment</span></span><span class="token punctuation">;</span>

<span class="token keyword">object</span> TableETL <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">val</span> senv <span class="token operator">=</span> StreamExecutionEnvironment<span class="token punctuation">.</span>getExecutionEnvironment
            <span class="token punctuation">.</span>setRuntimeMode<span class="token punctuation">(</span>RuntimeExecutionMode<span class="token punctuation">.</span>STREAMING<span class="token punctuation">)</span>
        <span class="token keyword">val</span> tEnv <span class="token operator">=</span> StreamTableEnvironment<span class="token punctuation">.</span>create<span class="token punctuation">(</span>senv<span class="token punctuation">)</span>

        <span class="token comment">// 定义源表</span>
        <span class="token keyword">val</span> source_table <span class="token operator">=</span>
            <span class="token triple-quoted-string string">"""
            CREATE TEMPORARY TABLE t_stock_code_price (
                id BIGINT NOT NULL,
                code STRING NOT NULL,
                -- 其他字段...
                create_time STRING NOT NULL,
                PRIMARY KEY (id) NOT ENFORCED
            ) WITH (
                'connector' = 'jdbc',
                'url' = 'jdbc:mysql://localhost:3306/mydb',
                'driver' = 'com.mysql.cj.jdbc.Driver',
                'table-name' = 't_stock_code_price',
                'username' = 'root',
                'password' = '12345678'
            )
            """</span><span class="token punctuation">.</span>stripMargin

        <span class="token comment">// 定义目标表</span>
        <span class="token keyword">val</span> sink_table <span class="token operator">=</span>
            <span class="token triple-quoted-string string">"""
            CREATE TEMPORARY TABLE re_stock_code_price (
                id BIGINT NOT NULL,
                code STRING NOT NULL,
                -- 其他字段...
                create_time STRING NOT NULL,
                rise INT,
                PRIMARY KEY (id) NOT ENFORCED
            ) WITH (
                'connector' = 'jdbc',
                'url' = 'jdbc:mysql://localhost:3306/mydb',
                'driver' = 'com.mysql.cj.jdbc.Driver',
                'table-name' = 're_stock_code_price',
                'username' = 'root',
                'password' = '12345678'
            )
            """</span><span class="token punctuation">.</span>stripMargin

        tEnv<span class="token punctuation">.</span>executeSql<span class="token punctuation">(</span>source_table<span class="token punctuation">)</span>
        tEnv<span class="token punctuation">.</span>executeSql<span class="token punctuation">(</span>sink_table<span class="token punctuation">)</span>
</code></pre> 
<p>在这段代码中，我们首先创建了Flink的流式执行环境和StreamTableEnvironment。然后，我们定义了两个临时表，用于存储原始股票数据和清洗后的数据。</p> 
<h3><a id="3__109"></a>3. 数据清洗：</h3> 
<p>接下来，我们执行数据清洗操作，并将结果写入目标表。</p> 
<pre><code class="prism language-scala">        <span class="token comment">// 执行清洗操作，并将结果写入目标表</span>
        tEnv<span class="token punctuation">.</span>executeSql<span class="token punctuation">(</span><span class="token string">"INSERT INTO re_stock_code_price "</span> <span class="token operator">+</span>
            <span class="token string">"SELECT *, CASE WHEN change_percent &gt; 0 THEN 1 ELSE 0 END AS rise FROM t_stock_code_price"</span><span class="token punctuation">)</span>

</code></pre> 
<p>在这里，我们计算了股票涨跌情况，并将结果写入到目标表中。在这个例子中，我们假设change_percent字段表示股票价格的变化百分比，rise字段为1表示股票上涨，为0表示股票下跌。</p> 
<h3><a id="4__119"></a>4. 结果展示：</h3> 
<p>最后，我们查询目标表并打印结果。</p> 
<p><img src="https://images2.imgbox.com/21/85/maV7KTjr_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/85/b1/Yeogncxg_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5__126"></a>5. 完整代码：</h3> 
<p>下面是完整的代码：</p> 
<pre><code class="prism language-scala"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>east</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>api<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span>RuntimeExecutionMode
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>streaming<span class="token punctuation">.</span>api<span class="token punctuation">.</span>scala<span class="token punctuation">.</span></span>StreamExecutionEnvironment
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>flink<span class="token punctuation">.</span>table<span class="token punctuation">.</span>api<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>scala<span class="token punctuation">.</span></span>StreamTableEnvironment

<span class="token keyword">object</span> TableETL <span class="token punctuation">{<!-- --></span>

  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">val</span> senv <span class="token operator">=</span> StreamExecutionEnvironment<span class="token punctuation">.</span>getExecutionEnvironment
      <span class="token punctuation">.</span>setRuntimeMode<span class="token punctuation">(</span>RuntimeExecutionMode<span class="token punctuation">.</span>STREAMING<span class="token punctuation">)</span>
    <span class="token keyword">val</span> tEnv <span class="token operator">=</span> StreamTableEnvironment<span class="token punctuation">.</span>create<span class="token punctuation">(</span>senv<span class="token punctuation">)</span>

    <span class="token keyword">val</span> source_table <span class="token operator">=</span>
      <span class="token triple-quoted-string string">"""
        |CREATE TEMPORARY TABLE t_stock_code_price (
        |  id BIGINT NOT NULL,
        |  code STRING NOT NULL,
        |  name STRING NOT NULL,
        |  `close` DOUBLE,
        |  change_percent DOUBLE,
        |  change DOUBLE,
        |  volume DOUBLE,
        |  amount DOUBLE,
        |  amplitude DOUBLE,
        |  turnover_rate DOUBLE,
        |  peration DOUBLE,
        |  volume_rate DOUBLE,
        |  hign DOUBLE,
        |  low DOUBLE,
        |  `open` DOUBLE,
        |  previous_close DOUBLE,
        |  pb DOUBLE,
        |  create_time STRING NOT NULL,
        |  PRIMARY KEY (id) NOT ENFORCED
        |) WITH (
        |   'connector' = 'jdbc',
        |   'url' = 'jdbc:mysql://localhost:3306/mydb',
        |   'driver' = 'com.mysql.cj.jdbc.Driver',
        |   'table-name' = 't_stock_code_price',
        |   'username' = 'root',
        |   'password' = '12345678'
        |)
        |"""</span><span class="token punctuation">.</span>stripMargin


    <span class="token keyword">val</span> sink_table <span class="token operator">=</span>
      <span class="token triple-quoted-string string">"""
        |CREATE TEMPORARY TABLE re_stock_code_price (
        |  id BIGINT NOT NULL,
        |  code STRING NOT NULL,
        |  name STRING NOT NULL,
        |  `close` DOUBLE,
        |  change_percent DOUBLE,
        |  change DOUBLE,
        |  volume DOUBLE,
        |  amount DOUBLE,
        |  amplitude DOUBLE,
        |  turnover_rate DOUBLE,
        |  peration DOUBLE,
        |  volume_rate DOUBLE,
        |  hign DOUBLE,
        |  low DOUBLE,
        |  `open` DOUBLE,
        |  previous_close DOUBLE,
        |  pb DOUBLE,
        |  create_time STRING NOT NULL,
        |  rise int,
        |  PRIMARY KEY (id) NOT ENFORCED
        |) WITH (
        |   'connector' = 'jdbc',
        |   'url' = 'jdbc:mysql://localhost:3306/mydb',
        |   'driver' = 'com.mysql.cj.jdbc.Driver',
        |   'table-name' = 're_stock_code_price',
        |   'username' = 'root',
        |   'password' = '12345678'
        |)
        |"""</span><span class="token punctuation">.</span>stripMargin


    tEnv<span class="token punctuation">.</span>executeSql<span class="token punctuation">(</span>source_table<span class="token punctuation">)</span>
    tEnv<span class="token punctuation">.</span>executeSql<span class="token punctuation">(</span>sink_table<span class="token punctuation">)</span>
    tEnv<span class="token punctuation">.</span>executeSql<span class="token punctuation">(</span><span class="token string">"insert into re_stock_code_price select *,case when change_percent&gt;0 then 1 else 0 end as rise from t_stock_code_price"</span><span class="token punctuation">)</span>

    <span class="token keyword">val</span> user_DS <span class="token operator">=</span> tEnv<span class="token punctuation">.</span>executeSql<span class="token punctuation">(</span><span class="token string">"select * from re_stock_code_price"</span><span class="token punctuation">)</span>

    user_DS<span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>如有遇到问题可以找小编沟通交流哦。另外小编帮忙辅导大课作业，学生毕设等。不限于python，java，大数据，模型训练等。</strong><br> <img src="https://images2.imgbox.com/6f/37/U1Ay3FDs_o.jpg" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5dd27e790f8683f3b10af27b16e88533/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Unity AI Navigation自动寻路</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7858c9d77bc821576f53456471e06a6a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Redis存Long取出时报类型转换错误java.lang.ClassCastException: java.lang.Integer cannot be cast to java.lang.Long</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>