<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Chapter8】文件系统，计算机操作系统教程，第四版，左万利，王英 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/b3eca83d5df1047ec7b9a0545746c526/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【Chapter8】文件系统，计算机操作系统教程，第四版，左万利，王英">
  <meta property="og:description" content="文章目录 @[toc]一、文件与文件系统1.1 文件1.2 文件系统 二、文件的访问方式2.1 顺序访问2.2 随机访问 三、文件的组织3.1 文件的逻辑组织3.2 文件的物理组织3.2.1 顺序结构3.2.2 链接结构3.2.3 索引结构3.2.4 Hash 结构3.2.5 倒排结构 3.3 UNIX文件物理结构（索引&#43;链接） 四、文件目录4.1 文件控制块与目录项4.2 单级目录与多级目录4.3 文件目录的改进4.4 根目录与当前目录4.5 文件目录的查找 五、文件的共享5.1 文件共享目的5.2 文件共享的模式5.3 文件共享的实现5.3 文件的保护、保密与安全5.3.1 文件的保护5.3.2 文件保密5.3.3 文件系统的安全 六、文件系统的实现6.1 内存所需表目6.2 UNIX文件系统的实现6.2.1 内存所需表目(UNIX)6.2.2 外存空间的管理 6.3 外存空间管理6.3.1 空闲块表6.3.2 字位映像图6.3.3 空闲链表6.3.4 *成组链接法（UNIX）6.3.4.1 空闲块管理方式：6.3.4.2 空闲inode管理方式： 七、文件系统的界面7.1 创建文件7.2 打开文件7.3 关闭文件7.4 指针定位7.5 读文件7.6 建立连接7.7 断开连接 八、日志结构文件系统8.1 背景8.2 日志结构文件系统 九、内存映射文件九、内存映射文件 一、文件与文件系统 1.1 文件 什么是文件？
**文件（file）**是具有符号名且在逻辑上有完整意义的信息项的有序序列。
文件的符号：即文件名，创建文件时确定，访问文件时使用
信息项：构成文件基本单位；可能等长也可能不等长；具有顺序关系
读写指针：记录当前信息项的读/写位置
文件系统通常提供一个读写指针定位命令，从而支持随机读写
文件分类：
系统文件，用户文件;
临时文件，永久文件;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-26T21:32:50+08:00">
    <meta property="article:modified_time" content="2024-06-26T21:32:50+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Chapter8】文件系统，计算机操作系统教程，第四版，左万利，王英</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="toc_0"></a> 
 <div class="toc"> 
  <h3>文章目录</h3> 
  <ul><li><ul><li><a href="#toc_0" rel="nofollow">@[toc]</a></li><li><a href="#_3" rel="nofollow">一、文件与文件系统</a></li><li><ul><li><a href="#11__8" rel="nofollow">1.1 文件</a></li><li><a href="#12__53" rel="nofollow">1.2 文件系统</a></li></ul> 
    </li><li><a href="#_61" rel="nofollow">二、文件的访问方式</a></li><li><ul><li><a href="#21__66" rel="nofollow">2.1 顺序访问</a></li><li><a href="#22__73" rel="nofollow">2.2 随机访问</a></li></ul> 
    </li><li><a href="#_82" rel="nofollow">三、文件的组织</a></li><li><ul><li><a href="#31__89" rel="nofollow">3.1 文件的逻辑组织</a></li><li><a href="#32__113" rel="nofollow">3.2 文件的物理组织</a></li><li><ul><li><a href="#321__137" rel="nofollow">3.2.1 顺序结构</a></li><li><a href="#322__151" rel="nofollow">3.2.2 链接结构</a></li><li><a href="#323__162" rel="nofollow">3.2.3 索引结构</a></li><li><a href="#324_Hash__175" rel="nofollow">3.2.4 Hash 结构</a></li><li><a href="#325__235" rel="nofollow">3.2.5 倒排结构</a></li></ul> 
     </li><li><a href="#33_UNIX_249" rel="nofollow">3.3 UNIX文件物理结构（索引+链接）</a></li></ul> 
    </li><li><a href="#_274" rel="nofollow">四、文件目录</a></li><li><ul><li><a href="#41__279" rel="nofollow">4.1 文件控制块与目录项</a></li><li><a href="#42__292" rel="nofollow">4.2 单级目录与多级目录</a></li><li><a href="#43__333" rel="nofollow">4.3 文件目录的改进</a></li><li><a href="#44__365" rel="nofollow">4.4 根目录与当前目录</a></li><li><a href="#45__384" rel="nofollow">4.5 文件目录的查找</a></li></ul> 
    </li><li><a href="#_400" rel="nofollow">五、文件的共享</a></li><li><ul><li><a href="#51__405" rel="nofollow">5.1 文件共享目的</a></li><li><a href="#52__415" rel="nofollow">5.2 文件共享的模式</a></li><li><a href="#53__428" rel="nofollow">5.3 文件共享的实现</a></li><li><a href="#53__442" rel="nofollow">5.3 文件的保护、保密与安全</a></li><li><ul><li><a href="#531__453" rel="nofollow">5.3.1 文件的保护</a></li><li><a href="#532__497" rel="nofollow">5.3.2 文件保密</a></li><li><a href="#533__535" rel="nofollow">5.3.3 文件系统的安全</a></li></ul> 
    </li></ul> 
    </li><li><a href="#_558" rel="nofollow">六、文件系统的实现</a></li><li><ul><li><a href="#61__563" rel="nofollow">6.1 内存所需表目</a></li><li><a href="#62_UNIX_584" rel="nofollow">6.2 UNIX文件系统的实现</a></li><li><ul><li><a href="#621_UNIX_586" rel="nofollow">6.2.1 内存所需表目(UNIX)</a></li><li><a href="#622__597" rel="nofollow">6.2.2 外存空间的管理</a></li></ul> 
     </li><li><a href="#63__607" rel="nofollow">6.3 外存空间管理</a></li><li><ul><li><a href="#631__609" rel="nofollow">6.3.1 空闲块表</a></li><li><a href="#632__616" rel="nofollow">6.3.2 字位映像图</a></li><li><a href="#633__625" rel="nofollow">6.3.3 空闲链表</a></li><li><a href="#634_UNIX_638" rel="nofollow">6.3.4 *成组链接法（UNIX）</a></li><li><ul><li><a href="#6341__669" rel="nofollow">6.3.4.1 空闲块管理方式：</a></li><li><a href="#6342_inode_683" rel="nofollow">6.3.4.2 空闲inode管理方式：</a></li></ul> 
     </li></ul> 
    </li></ul> 
    </li><li><a href="#_695" rel="nofollow">七、文件系统的界面</a></li><li><ul><li><a href="#71__704" rel="nofollow">7.1 创建文件</a></li><li><a href="#72__720" rel="nofollow">7.2 打开文件</a></li><li><a href="#73__737" rel="nofollow">7.3 关闭文件</a></li><li><a href="#74__751" rel="nofollow">7.4 指针定位</a></li><li><a href="#75__768" rel="nofollow">7.5 读文件</a></li><li><a href="#76__793" rel="nofollow">7.6 建立连接</a></li><li><a href="#77__811" rel="nofollow">7.7 断开连接</a></li></ul> 
    </li><li><a href="#_829" rel="nofollow">八、日志结构文件系统</a></li><li><ul><li><a href="#81__834" rel="nofollow">8.1 背景</a></li><li><a href="#82__860" rel="nofollow">8.2 日志结构文件系统</a></li></ul> 
    </li><li><a href="#_883" rel="nofollow">九、内存映射文件</a></li><li><a href="#_932" rel="nofollow">九、内存映射文件</a></li></ul> 
  </li></ul> 
 </div></h3> 
<h3><a id="_3"></a>一、文件与文件系统</h3> 
<p><img src="https://images2.imgbox.com/95/f2/YuCS3Ulv_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<h4><a id="11__8"></a>1.1 文件</h4> 
<p><strong>什么是文件？</strong></p> 
<p>**文件（file）**是具有符号名且在逻辑上有完整意义的信息项的有序序列。</p> 
<p><img src="https://images2.imgbox.com/90/75/WylxWrRs_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<ul><li> <p>文件的符号：即<strong>文件名</strong>，创建文件时确定，访问文件时使用</p> </li><li> <p>信息项：构成文件基本单位；可能等长也可能不等长；具有顺序关系</p> </li><li> <p>读写指针：记录当前信息项的读/写位置</p> <p>文件系统通常提供一个<strong>读写指针定位命令</strong>，从而支持随机读写</p> </li></ul> 
<p><strong>文件分类：</strong></p> 
<ol><li> <p>系统文件，用户文件;</p> </li><li> <p>临时文件，永久文件;</p> </li><li> <p>只读文件，只写文件，读/写文件;</p> </li><li> <p>磁盘文件，磁带文件，磁鼓文件;</p> </li><li> <p>目录文件，普通文件;</p> </li><li> <p>程序文件，数据文件;</p> <p>程序文件又可分为：源文件，目标文件，可执行文件，头文件，库文件</p> </li></ol> 
<p>在<strong>UNIX</strong>中有如下文件分类：</p> 
<ul><li>普通文件 
  <ul><li>内容可以是程序、数据、图象、MP3等，保存在磁盘块中</li></ul> </li><li>目录文件 
  <ul><li>文件名，文件号序列，文件描述信息</li></ul> </li><li>特殊文件 
  <ul><li>设备 
    <ul><li>设备作为文件管理的好处 
      <ul><li>界面统一，使用文件与使用设备命令相同，申请设备open，释放close，读read，写write</li><li>利用文件保护功能可以保护设备</li></ul> </li></ul> </li></ul> </li></ul> 
<h4><a id="12__53"></a>1.2 文件系统</h4> 
<p>文件与管理信息资源的程序集合称为<strong>文件系统(file system)</strong>。</p> 
<p>从上往下看，文件系统位于设备之上既需管理文件也需管理保存文件的外存空间。</p> 
<p>文件系统为用户提供按名存取文件的手段。</p> 
<h3><a id="_61"></a>二、文件的访问方式</h3> 
<p><img src="https://images2.imgbox.com/ab/ab/5MQz0EHq_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<h4><a id="21__66"></a>2.1 顺序访问</h4> 
<p>**顺序访问（sequential access）**就是按照从前到后的次序依次存取文件的各个信息项。</p> 
<ol><li>从文件头开始顺序访问</li><li>由文件中间的某一位置开始顺序访问</li></ol> 
<h4><a id="22__73"></a>2.2 随机访问</h4> 
<p>**随即访问（random access）**就是无序存取文件的某些信息项。</p> 
<ol><li>按编号随机访问</li><li>按key随机访问</li></ol> 
<h3><a id="_82"></a>三、文件的组织</h3> 
<p><img src="https://images2.imgbox.com/a3/fb/1hU2FTzf_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<p>文件组织又称文件的结构，所谓的“逻辑结构”，就是指在用户看来，文件内部的数据应该是如何组织起来的。而“物理结构”指的是在操作系统看来，文件的数据是如何存放在外存中的。</p> 
<h4><a id="31__89"></a>3.1 文件的逻辑组织</h4> 
<p>文件的逻辑组织形式主要有两种：流式和记录式。</p> 
<p><strong>1、流式文件</strong></p> 
<p><strong>流式文件（又称无结构文件）</strong>，构成文件的基本单位是<strong>字节</strong>，即流式文件是具有符号名且在逻辑上有完整意义的字节序列。</p> 
<p>如：Windows .txt文件</p> 
<p><img src="https://images2.imgbox.com/89/a5/8nteSnq2_o.png" alt=""></p> 
<p><strong>2、记录式文件</strong></p> 
<p><strong>记录式文件（又称有结构文件）</strong>，构成文件的基本单位是记录，每条记录又由若干个数据项组成。亦即记录式文件是具有符号名且在逻辑上有完整意义的记录序列。</p> 
<p>一般来说，每条记录有一个数据项可作为关键字。根据各条记录的长度(占用的存储空间)是否相等，又可分为<strong>定长记录</strong>和<strong>可变长记录</strong>两种。</p> 
<p><img src="https://images2.imgbox.com/87/d8/u9HPGXZf_o.png" alt=""></p> 
<h4><a id="32__113"></a>3.2 文件的物理组织</h4> 
<p>文件的物理结构就是要确定如何将记录或字节保存在存储型设备的物理块中。</p> 
<p>需要考虑因素：</p> 
<ol><li> <p>记录格式</p> <p>等长or不等长（流式不必考虑）</p> </li><li> <p>空间开销</p> <p>除保存文件内容之外的存储开销</p> </li><li> <p>访问速度</p> <p>顺序访问速度、随机访问速度</p> </li><li> <p>长度变化</p> <p>动态增加和动态减少</p> </li></ol> 
<p>物理结构可分为：<strong>顺序结构，链接结构、索引结构、散列结构、倒排结构</strong>。</p> 
<h5><a id="321__137"></a>3.2.1 顺序结构</h5> 
<p><strong>一个文件占有若干连续的磁盘块，首块号和块数记录在文件控制块(FCB)中。</strong></p> 
<p><img src="https://images2.imgbox.com/14/72/3dzUCE02_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<p><img src="https://images2.imgbox.com/66/59/0LpXbKcx_o.png" alt=""></p> 
<p><strong>优点：访问速度快，节省空间</strong></p> 
<p><strong>缺点：长度变化困难</strong></p> 
<h5><a id="322__151"></a>3.2.2 链接结构</h5> 
<p><strong>一个文件占有若干个不连续的存储块，各块之间以指针相连。其首块号和块数被记录于该文件的文件控制块中</strong></p> 
<p><img src="https://images2.imgbox.com/6d/51/9qZLeU5p_o.png" alt=""></p> 
<p><strong>优点：节省空间，长度变化容易</strong></p> 
<p><strong>缺点：随机访问速度慢</strong></p> 
<h5><a id="323__162"></a>3.2.3 索引结构</h5> 
<p>索引结构针对链接结构随机访问慢而加以改进。</p> 
<p><strong>一文件可存于不连续块中，块号记在索引块中。</strong></p> 
<p><img src="https://images2.imgbox.com/c1/e4/hdKuqBz4_o.png" alt=""></p> 
<p><strong>优点：速度快，长度变化容易</strong></p> 
<p><strong>缺点：索引块占空间(外存和内存)</strong></p> 
<h5><a id="324_Hash__175"></a>3.2.4 Hash 结构</h5> 
<p>**散列结构（hash structures）**又称杂凑结构。只适用于定长记录和按键随机查找的访问方式，用于构造文件目录。</p> 
<p>哈希的思想不必多说。</p> 
<p>散列结构的即通过计算来确定一条记录在存储设备上的存储位置。</p> 
<p>我们可以设计一个hash函数，给定key，可以计算hash(key) = addr来作为记录在磁盘或文件中的存放位置。</p> 
<p>hash技术自然要考虑<strong>hash冲突</strong>。</p> 
<p><strong>如果给定key1 != key2，hash(key1) = hash(key2)，我们该如何解决？</strong></p> 
<p>数据结构上讲过：顺序探查，二次探查，平方取中、拉链法……</p> 
<p>这里最常用的方法是：**顺序探查法：**如发生冲突，则在冲突位置开始顺序探查第一个空闲的存储位置，将该记录保存。</p> 
<p>下面叙述散列结构下保存、查找、删除记录的流程。</p> 
<p><strong>保存记录：</strong></p> 
<p><img src="https://images2.imgbox.com/df/9a/965ahfvd_o.png" alt=""></p> 
<ol><li>计算addr = hash(key)</li><li>相应位置冲突计数+1</li><li>如果查找到的记录空闲，则标记为占用，填充记录内容</li><li>否则顺序查找下一个，直到找到第一个空闲的记录项</li></ol> 
<p><strong>查找记录：</strong></p> 
<p><img src="https://images2.imgbox.com/a8/c6/09N8SR04_o.png" alt=""></p> 
<ol><li>计算addr = hash(key)</li><li>取addr对应记录的冲突计数count 
  <ol><li>如果count = 0，说明无此记录</li></ol> </li><li>否则，如果此项空闲顺取下一条记录，直到找到一条非空闲记录</li><li>如果key相等，那么说明找到</li><li>否则如果hash(key)相同，我们将count - 1 
  <ol><li>如果count = 0，那么说明查找记录不存在</li></ol> </li><li>否则，我们顺取下一条记录</li></ol> 
<p><strong>删除记录：</strong></p> 
<p><img src="https://images2.imgbox.com/76/da/RVkFfLPC_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<ol><li>计算addr = hash(key)</li><li>调用查找过程</li><li>如果没找到，说明无此记录</li><li>否则，我们将记录项置闲，冲突计数减1</li></ol> 
<p><strong>Hash 结构特点：按关键字检索速度非常快</strong></p> 
<p><strong>用途：常用于目录检索</strong></p> 
<p><strong>注意：文件可循环使用，满时保存失败。</strong></p> 
<h5><a id="325__235"></a>3.2.5 倒排结构</h5> 
<p>记录中的域称为键，能够区分所有记录的键称为<strong>主键</strong>，其他键称为<strong>次键</strong>。以键值和记录地址构成的索引结构称为<strong>倒排结构(reverse structure)</strong>。键值为主键的索引称为<strong>主索引</strong>，键值为次键的索引称为<strong>次索引</strong>。</p> 
<p>倒排结构以多个键和多个索引作为特征。</p> 
<p><img src="https://images2.imgbox.com/ee/28/J03pZmtf_o.png" alt=""></p> 
<p>倒排结构适合不同的查找方式，速度很快。其缺点是索引会带来较大的系统开销</p> 
<p><img src="https://images2.imgbox.com/b9/a1/pGmzMglX_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<h4><a id="33_UNIX_249"></a>3.3 UNIX文件物理结构（索引+链接）</h4> 
<p>UNIX 文件的物理结构为<strong>链接结构与索引结构的结合</strong>，也可看成是<strong>多级索引结构</strong>。</p> 
<p>具体地说，当一个文件长度不大于10 × 512B时，为零级索引；当文件长度大于10 × 512B但不大于10 × 512 + 256 × 512B时，为一级索引；当文件长度大于10 × 512 + 256 × 512B但不大于 10 × 512 + 256 × 512 + 256^2 × 512 B时为二级索引；当文件长度大于10 × 512 + 256 × 512 + 265^2 × 512 B但不大于 10 × 512 + 256 × 512 + 256^2 × 512 + 256^3 × 512 B时，为三级索引。</p> 
<p>如下图，文件的控制结构 inode 中有 13 个索引项，即 addr[0], addr[1], …, addr[12]。</p> 
<p>当文件长度不超过10块时，addr[0 ~ 9]充当0级间址，即指向10个信息块；</p> 
<p>addr[10] 用作一级间址，它指向一个一级索引块，一级索引块指向256个信息块。</p> 
<p>addr[11] 用作二级间址，指向1个一级索引块，一级索引块指向256个二级索引块，每个二级索引块分别指向256个信息块。</p> 
<p>addr[12] 用作三级间址，指向一个一级索引块，一级索引块指向256个二级索引块，每个二级索引块指向256个三级索引块，每个三级索引块指向256个信息块。</p> 
<p><img src="https://images2.imgbox.com/ce/30/PkD3Ee4W_o.png" alt=""></p> 
<p>这样做的好处是：大多数文件较短，在零级索引一级索引访问很快。大文件较长，访问二、三级索引虽然略慢，但是缓冲相应索引块到内存后，还是比较快的。</p> 
<p>既能节省空间又提高了速度。</p> 
<h3><a id="_274"></a>四、文件目录</h3> 
<p><img src="https://images2.imgbox.com/72/d4/WPRUwbNS_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<h4><a id="41__279"></a>4.1 文件控制块与目录项</h4> 
<p>**文件控制块（file control block，FCB）**是标志文件存在的数据结构，其中包含系统对文件进行管理所需要的全部信息。</p> 
<p>每一个文件都有一个FCB，它们被保存在外存空间中。</p> 
<p>当欲访问一个文件时，应当能够根据文件名称找到它所对应的FCB。FCB以目录项的形式存储于目录文件中。因此FCB又被称为<strong>目录项</strong>。</p> 
<p>FCB通常保存如下内容：</p> 
<p><img src="https://images2.imgbox.com/b4/9f/n1cUvP1N_o.png" alt=""></p> 
<h4><a id="42__292"></a>4.2 单级目录与多级目录</h4> 
<p><strong>1、单级目录</strong></p> 
<p>所谓单级目录就是整个系统中只有一个目录，所有文件均登记在该目录中。</p> 
<p><img src="https://images2.imgbox.com/2a/47/Ff7U0uGP_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<p><strong>优点：简单</strong></p> 
<p><strong>缺点：文件不能重名</strong></p> 
<p><strong>2、二级目录</strong></p> 
<p>级目录是对单级目录的一种改进。采用二级目录时，整个系统只有一个公共目录，称为<strong>系统目录</strong>；每个用户都有一个专有目录，称为<strong>用户目录</strong>。<strong>所有的用户目录均登记于系统目录中，每个用户目录下登记着该用户的文件。</strong></p> 
<p><img src="https://images2.imgbox.com/80/ac/wWGmqM08_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<p><strong>3、多级目录</strong></p> 
<p>多级目录结构是对二级目录结构的进一步改进。</p> 
<p>文件系统呈现一种树形结构。**叶子结点是一般文件或者目录文件；非叶子结点为目录文件。**根节点是特殊的目录文件，称为根目录文件。</p> 
<p>采用多级目录结构时，文件的名字是一个路径名。路径名由根结点开始到叶子结点结束结点名字序列所构成，其间以“/”或“\”相隔。</p> 
<p><img src="https://images2.imgbox.com/2d/d3/0A0vnr7Y_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<p>优点：</p> 
<ul><li>便于文件分类</li><li>查找速度快（因为每个目录下文件较少）</li><li>可以实现文件的连接（Link）</li></ul> 
<p>目前已为大多数操作系统所采用，如UNIX、Windows</p> 
<h4><a id="43__333"></a>4.3 文件目录的改进</h4> 
<p>有的系统将FCB分为两部分：<strong>FCB主部和FCB次部</strong>。</p> 
<p>**FCB主部：**包括除文件名称以外的所有信息和一个标识该主部和多少次部相对应的连接计数。</p> 
<ul><li>保存在外存<strong>inode</strong>区域，打开时读入内存</li></ul> 
<p>**FCB次部：**仅包含一个文件名称和一个标识文件主部的文件号。</p> 
<ul><li>保存在目录文件中</li></ul> 
<p>在存储文件的外存划分一个固定区域保存文件FCB主部，并将保存主部的记录从头依次编号就是文件号。</p> 
<p>改进的好处：</p> 
<ul><li>可以提高查找速度</li><li>可以实现<strong>文件链接（Link）</strong>，一个文件多个路径名（参考Linux ln指令）</li></ul> 
<p><img src="https://images2.imgbox.com/38/d3/aHFYPCgK_o.png" alt=""></p> 
<p><strong>目录改进后的查找速度：</strong></p> 
<p>顺序查找 n 个记录，找到一个记录的平均查找记录的次数 = (1 + 2 + … n) / n = (n + 1) / 2</p> 
<p>设未分次部和主部的FCB构成的文件目录占n个磁盘块，则顺序查找文件目录，找到一个**文件目录(即FCB)**的平均访问磁盘块的次数 = (n + 1) / 2</p> 
<p>设次部构成的文件目录占m个磁盘块，则顺序查找文件目录找到一个文件(FCB)的平均访盘次数 = (m + 1) / 2 + 1</p> 
<p>若(n + 1) / 2 - ((m + 1) / 2 + 1) &gt; 0，即 n - m &gt; 2，由于次部占据空间小，所以m通常会比n小不少，我们查找速度一般是会快一些的。</p> 
<h4><a id="44__365"></a>4.4 根目录与当前目录</h4> 
<p><strong>1、根目录</strong></p> 
<p>树状结构(多级目录)文件系统中，根结点对应的目录称为根目录;</p> 
<p><strong>根目录保存在外存空间固定位置。</strong></p> 
<p><strong>2、当前目录</strong></p> 
<p>目前正在使用的工作目录称为当前目录。</p> 
<p><strong>UNIX文件卷(volume)组织形式：</strong></p> 
<p>引导块中是引导程序，负责将UNIX可执行程序装入内存并执行</p> 
<p><img src="https://images2.imgbox.com/91/15/aeuRxE9a_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<h4><a id="45__384"></a>4.5 文件目录的查找</h4> 
<p>1、从根目录开始查找</p> 
<p>2、从当前目录开始查找</p> 
<p>二者不仅是绝对路径和相对路径的差别，查找速度上后者也要略快。</p> 
<p>查找算法一般有如下几种：</p> 
<ol><li>顺序查找：emm……</li><li>散列查找：查找速度快，但是要求预先确定目录文件的大小。</li><li>二分查找：要求文件名按字典序存放</li></ol> 
<h3><a id="_400"></a>五、文件的共享</h3> 
<p><img src="https://images2.imgbox.com/57/0b/JGMiCq5s_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<h4><a id="51__405"></a>5.1 文件共享目的</h4> 
<ol><li> <p>节省存储空间</p> <p>共享文件不需要开多个副本了</p> </li><li> <p>进程相互通信</p> <p>进程可以通过文件共享来实现通信</p> </li></ol> 
<h4><a id="52__415"></a>5.2 文件共享的模式</h4> 
<ol><li> <p>异步使用同一文件</p> <p>即，共享文件任意时刻最多只有一个进程访问它</p> </li><li> <p>同时使用一个文件</p> <p>同一时刻多个进程要求使用同一文件，但是这就又分为两种情况了：</p> 
  <ol><li>所有进程都不修改访问文件</li><li>另一种就复杂了。我们要对读者写者进行控制</li></ol> </li></ol> 
<h4><a id="53__428"></a>5.3 文件共享的实现</h4> 
<ol><li> <p>公共目录</p> <p>若干个可以被所有用户访问的公共目录，如Unix下的lib、dev等</p> </li><li> <p>连接（Link）</p> <p>Linux中的硬连接，软连接</p> </li><li> <p>共享说明</p> <p>说明文件可以由哪些用户使用，以及权限。如linux下的rwx，文件用户、组</p> </li></ol> 
<h4><a id="53__442"></a>5.3 文件的保护、保密与安全</h4> 
<ul><li>保护 
  <ul><li>防止用户对文件进行非授权的访问</li></ul> </li><li>保密 
  <ul><li>防止文件内容泄露</li></ul> </li><li>安全 
  <ul><li>防止文件被破坏 
    <ul><li>自然因素</li><li>人为因素，攻防等</li></ul> </li></ul> </li></ul> 
<h5><a id="531__453"></a>5.3.1 文件的保护</h5> 
<ul><li>对文件所有者和创建者的控制 
  <ul><li>能做什么</li><li>能被谁操作</li></ul> </li><li>访问方式 
  <ul><li>读</li><li>写</li><li>执行</li><li>追加</li><li>删除</li><li>列出</li></ul> </li></ul> 
<p><strong>1、存取控制矩阵</strong></p> 
<p>将用户关于所有文件的存取方式记录在一个矩阵中，该矩阵称为<strong>存取控制矩阵</strong>。</p> 
<p>加入我们对文件定义6种存取方式：R、W、E、A、M、D（读写执行追加修改删除），那么六个二进制为可表示</p> 
<p><img src="https://images2.imgbox.com/8f/64/9c7tG6le_o.png" alt=""></p> 
<p>特点：</p> 
<ul><li>权限规定细，过于繁琐，占据较多存储空间</li></ul> 
<p><strong>UNIX访问权限说明，i_mode</strong></p> 
<p>放个linux下的图</p> 
<p><img src="https://images2.imgbox.com/cd/f7/E0PFVI0y_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/7d/0a/oMdW0J5l_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/ce/a3/CMA36n4q_o.png" alt="ss"></p> 
<ul><li>文件主判别：访问进程u_uid == i_uid</li><li>同组用户判别：访问进程u_gid == i_gid</li><li>i_mode在创建文件时给出，creat(filename，mode)</li><li>其后文件主可以修改：chmod(filename，new_mode)</li></ul> 
<h5><a id="532__497"></a>5.3.2 文件保密</h5> 
<p><strong>1、口令</strong></p> 
<p><strong>设置口令：</strong></p> 
<ul><li>创建文件时用户规定一个口令，系统将其记在FCB中</li><li>访问文件要求给出口令，并与FCB中口令比较</li></ul> 
<p><strong>特点：</strong></p> 
<ul><li>简单</li><li>保密性不强（对系统操作者不保密）</li></ul> 
<p><strong>2、密码</strong></p> 
<p>口令由于保存在FCB中保密性太差因而可能泄露，密码则是通过将文件内容加密，那么即使泄露了，窃取者在不知密码的情况下也只是获取了一堆杂乱无章的数据。</p> 
<p><strong>使用：</strong></p> 
<ul><li>保存时加密</li><li>读取时解密</li></ul> 
<p>**特点：**对文件内容加密，速度慢，效果好</p> 
<ul><li><strong>保存时：</strong> 
  <ul><li>用key启动一个随机数发生器，产生一个随机数序列，将其依次加到文件的各个字中</li></ul> </li><li><strong>读取时：</strong> 
  <ul><li>用同一个key启动同一个随机数发生器，产生相同随机数序列，将其依次由文件的各个字中减去</li></ul> </li></ul> 
<p><strong>线性同余法产生随机数</strong></p> 
<pre><code class="prism language-c++">size_t random (size_t key) {
    return (key * C1 + C2) % C3;
}
</code></pre> 
<h5><a id="533__535"></a>5.3.3 文件系统的安全</h5> 
<p><strong>备份（Backup）原理</strong></p> 
<ul><li>定期将磁盘上的文件复制到磁带上</li><li>发生故障时<strong>由磁带恢复（limited recovery）</strong></li></ul> 
<p><strong>实现方式</strong>：</p> 
<ul><li>完全转储：定期将磁带上文件全部复制到磁带上 
  <ul><li>恢复：最后一次转储磁带</li><li>优点：恢复容易</li><li>缺点：大量冗余</li></ul> </li><li>增量转储 
  <ul><li>每次只复制上次转储以来修改的部分</li><li>恢复：由初始转储磁带开始，利用第二次转储磁带、第三次转储磁带、……、最后一次转储磁带，逐步恢复到最终版本</li><li>优点：每次转储数据少</li><li>缺点：实现麻烦，某次转储磁带发生问题将使恢复困难</li></ul> </li></ul> 
<p><strong>磁盘整理</strong></p> 
<p>利用转储和恢复可以对磁盘进行整理(使文件物理块连续，空闲盘块连续)</p> 
<h3><a id="_558"></a>六、文件系统的实现</h3> 
<p><img src="https://images2.imgbox.com/7d/87/MUonLaIy_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<h4><a id="61__563"></a>6.1 内存所需表目</h4> 
<p>文件访间时需要经常访问文件控制信息，为提高访问速度需要将控制信息缓存到内存，因此文件使用前需要打开，使用后需要关闭</p> 
<ul><li><strong>系统打开文件表（系统一个）</strong> 
  <ul><li>修改标志是指FCB主部在内存期间是否被修改</li></ul> </li></ul> 
<p><img src="https://images2.imgbox.com/d9/5c/h0uW0Mw5_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<ul><li><strong>用户打开文件表(每个进程一个)</strong> 
  <ul><li>文件可以共享，多个进程对文件的打开方式可以不同，读写位置可以不同，这些信息记录在一个表中</li></ul> </li></ul> 
<p><img src="https://images2.imgbox.com/db/54/78CJk3m3_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<p>下面一张示例图展示两种表之间的关系：</p> 
<p><img src="https://images2.imgbox.com/62/59/Y1qRufsR_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<h4><a id="62_UNIX_584"></a>6.2 UNIX文件系统的实现</h4> 
<h5><a id="621_UNIX_586"></a>6.2.1 内存所需表目(UNIX)</h5> 
<ul><li><strong>用户打开文件表</strong> 
  <ul><li>u_ofile(每个进程一个)：保存用户打开文件的读写指针</li><li>file(整个系统一个)：保存所有用户的打开文件表目，每个用户被分配的file表目数目不同</li></ul> </li><li><strong>系统打开文件表</strong> 
  <ul><li>inode(整个系统一个)</li></ul> </li></ul> 
<p><img src="https://images2.imgbox.com/7e/91/kC2rJgbn_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<h5><a id="622__597"></a>6.2.2 外存空间的管理</h5> 
<p>后面详细介绍</p> 
<ul><li>空闲块表</li><li>字位映像图（LINUX）</li><li>成组连接（UNIX approach）</li></ul> 
<h4><a id="63__607"></a>6.3 外存空间管理</h4> 
<h5><a id="631__609"></a>6.3.1 空闲块表</h5> 
<p>这种方法是将所有的空闲块记录在同一个表中，该表称为<strong>空闲块表</strong>。</p> 
<p><img src="https://images2.imgbox.com/e0/12/ccKzONBY_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<h5><a id="632__616"></a>6.3.2 字位映像图</h5> 
<p>即<strong>位图（bitset）</strong>。</p> 
<p>这种方法用1位(1bit)来表示外存储器中一块的状态，可以规定当某一位的值为0时，该位所对应的外存块空闲，而当某一位的值为1时，该位所对应的外存块被占用。</p> 
<p><img src="https://images2.imgbox.com/79/a0/4CSNimpZ_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<h5><a id="633__625"></a>6.3.3 空闲链表</h5> 
<p>系统保存着空闲链表<strong>链头、链尾指针</strong>，空闲链表通常分为以下两种形式：</p> 
<p><strong>空闲盘块链</strong>：以盘块为单位组成一条空闲链，</p> 
<p><strong>空闲盘区链</strong>：以盘区为单位组成一条空闲链</p> 
<ul><li>一个盘区由多个盘块组成</li></ul> 
<p><img src="https://images2.imgbox.com/d1/a9/KCe0UkWi_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<h5><a id="634_UNIX_638"></a>6.3.4 *成组链接法（UNIX）</h5> 
<p><strong>回忆UNIX文件卷组织形式</strong></p> 
<p>引导块中是引导程序，负责将UNIX可执行程序装入内存并执行</p> 
<p><img src="https://images2.imgbox.com/cb/be/tLUI204x_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<p>UNIX 外存空间的管理采用<strong>成组连接方式</strong>，空闲块链与空闲块表的结合。</p> 
<p><strong>特殊块/超级块(super block)</strong></p> 
<ul><li>记载文件卷上 k + 1 块到 n - 1 块中所有空闲块</li><li>inode区中100个空闲inode(缓存)</li></ul> 
<p><strong>文件安装(mount)后超级块读入内存。</strong></p> 
<p><u>注：占用区域已经记载在各个文件的inode中。</u></p> 
<p>超级块的结构图如下：</p> 
<p><img src="https://images2.imgbox.com/bf/38/IkyoiFLq_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<ul><li>s_nfree 记录超级块内的块的数目</li><li>s_free[i]都指向一个块</li><li>s_free[0]指向一个索引块，索引块又指向新的一组（100个空闲块）</li></ul> 
<p>下面介绍空闲块管理方式，就明白成组链接的原理了。</p> 
<h6><a id="6341__669"></a>6.3.4.1 空闲块管理方式：</h6> 
<p>相关结构：s_free，s_nfree</p> 
<ul><li>缓冲区sfee中记录的100个空闲块采用的次序管理。 
  <ul><li>申请块时，若s_nfree &gt; 1，取缓冲区s_free[ – s_nfree] 
    <ul><li>如果申请时，s_nfree = 1，那么读入连接块s_free[0]</li><li>将连接块中的s_free 和 s_nfree 信息登记在缓冲区</li></ul> </li><li>分配空闲块</li><li>归还块时，如果s_nfree &lt; 100，那么s_free[s_nfree ++ ] = 归还块号 
    <ul><li>如果s_nfree == 100，那么将 s_free 中记录的100个空闲块号连同 s_nfree 一同登记在连接块内，并写回外存</li><li>s_free[0] = 连接块号</li><li>s_nfree = 1</li></ul> </li></ul> </li></ul> 
<h6><a id="6342_inode_683"></a>6.3.4.2 空闲inode管理方式：</h6> 
<p>相关结构：s_inode，s_ninode</p> 
<p>s_inode 最多记录 100 个空闲 inode 的编号</p> 
<ul><li>申请时，取s_inode[-- s_ninode] 
  <ul><li>如果 s_ninode == 0，说明缓冲区里的inode用完，我们顺序扫描inode区域，拿100个空闲inode编号并记录到s_inode</li></ul> </li><li>释放时，s_inode[s_ninode ++ ] = 释放编号 
  <ul><li>如果s_ninode = 100，丢弃该inode编号</li><li>注意，内存中inode发生变化，我们的选择是及时写回外存</li></ul> </li></ul> 
<h3><a id="_695"></a>七、文件系统的界面</h3> 
<p><img src="https://images2.imgbox.com/03/b3/ILrYYNX1_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<p>文件系统与用户之间的<strong>界面形式是一组系统调用命令</strong>，它们可以被写在用户程序中，是文件使用者与文件系统交互的途径。</p> 
<p>文件的系统调用命令是文件系统与上层软件之间唯一的界面形式。</p> 
<h4><a id="71__704"></a>7.1 创建文件</h4> 
<p><strong>命令形式</strong>：creat(path_name，fcb_args)</p> 
<p><strong>参数说明</strong></p> 
<ul><li>path_name：文件路径名</li><li>fcb_args：参数</li></ul> 
<p><strong>执行步骤：</strong></p> 
<ol><li>为此文件分配一个FCB主部，初始化(文件主、共享说明、创建时间、长度等)</li><li>将文件名和文件号作为FCB次部填到末级目录中</li><li>以写方式打开 
  <ul><li>例如: creat(“/usr/li/d1/f1”, mode)</li></ul> </li></ol> 
<h4><a id="72__720"></a>7.2 打开文件</h4> 
<p><strong>命令形式</strong>：fd=open(path_name, mode)</p> 
<p><strong>参数说明：</strong></p> 
<ol><li>path name：文件路径名</li><li>mode：打开方式</li></ol> 
<p><strong>执行步骤</strong></p> 
<ol><li>根据文件路径名查目录找到文件号，和FCB主部</li><li>合法性检查(根据打开方式、共享说明、用户身份)</li><li>根据文件号查系统打开文件表看该文件是否已被打开，如是共享计数加1；否则取一个空闲的系统打开文件表项并将外存中 FCB主部等信息填入此表项，共享计数置为1；</li><li>在用户打开文件表中取一空表项，填写打开方式和读写指针，并指向系统打开文件表的对应表项。 
  <ul><li>返回信息：fd：文件描述符(在用户打开文件表中的入口)它是一个非负整数，</li></ul> </li></ol> 
<h4><a id="73__737"></a>7.3 关闭文件</h4> 
<p><strong>命令形式</strong>：close(fd)</p> 
<p><strong>参数说明</strong></p> 
<ul><li>fd：文件描述符</li></ul> 
<p><strong>执行步骤：</strong></p> 
<ol><li>由 fd 查用户打开文件表，找到系统打开文件表</li><li>系统打开文件表中共享计数减1，如减1后的值为0且修改标志为1，则将此FCB 由内存写回外存FCB主部;</li><li>将fd所对应的用户打开文件表项置为空闲</li></ol> 
<h4><a id="74__751"></a>7.4 指针定位</h4> 
<p>**命令形式：**seek(fd，offset)</p> 
<p><strong>参数说明：</strong></p> 
<p>fd：文件描述符；</p> 
<p>offset：新的指针位置.</p> 
<p><strong>执行步骤：</strong></p> 
<ol><li>由 fd 查用户打开文件表，得系统打开文件表入口</li><li>查系统打开文件表，得文件长度</li><li>检查参数合法性</li><li>将用户打开文件表中文件读写指针位置设定为offset，后继读写命令由该指针处存取文件内容</li></ol> 
<h4><a id="75__768"></a>7.5 读文件</h4> 
<p>**命令形式：**read(fd,nrd,buf)</p> 
<p><strong>参数说明：</strong></p> 
<p>fd：文件描述符;</p> 
<p>nrd：读入记录个数;</p> 
<p>buf：内存起始位置.</p> 
<p><strong>步骤:</strong></p> 
<ol><li> <p>由fd查用户打开文件表，找到对应的入口;</p> </li><li> <p>合法性检查(用户打开文件表中所记录的打开方式、存取方式)</p> </li><li> <p>查系统打开文件表，找到文件的地址;</p> </li><li> <p>根据逻辑地址(offset)和物理结构计算物理地址;</p> </li><li> <p>如在缓冲区中；所需字节复制到进程空间buf起始位置；</p> </li><li> <p>否则申请缓冲区(可能多个)链入设备IO队列，若设备空闲启动设备，等待IO传输完成(切换进程)，所需字节复制到进程空间buf起始的位置。</p> </li></ol> 
<h4><a id="76__793"></a>7.6 建立连接</h4> 
<p>**命令形式：**link(old name，new name)</p> 
<p><strong>参数含义：</strong></p> 
<p>old_name：已存在的文件路径名;</p> 
<p>new_name：欲连接的文件路径名,</p> 
<p><strong>执行步骤：</strong></p> 
<ol><li> <p>查目录找到文件old name的FCB主部，由此得到文件号;</p> </li><li> <p>查目录找到文件new_name的末级目录;</p> </li><li> <p>将文件号与new_name中末级名字合起来构成一个新的目录项，将其填入new name的末级目录文件中;</p> </li><li> <p>将FCB主部中的连接计数加1</p> </li></ol> 
<h4><a id="77__811"></a>7.7 断开连接</h4> 
<p>**命令形式：**unlink(path_name)</p> 
<p><strong>参数含义：</strong></p> 
<p>path_name：文件路径名,</p> 
<p><strong>执行步骤：</strong></p> 
<ol><li> <p>查目录找到文件path_name的FCB主部</p> </li><li> <p>将连接计数i_nlink减1</p> </li><li> <p>如减1后的值为0，则归还该文件所占用的全部存储块，该文件将被撤销</p> </li><li> <p>将FCB次部由上级目录中清除</p> </li></ol> 
<h3><a id="_829"></a>八、日志结构文件系统</h3> 
<p><img src="https://images2.imgbox.com/85/10/qRHnAT9M_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<h4><a id="81__834"></a>8.1 背景</h4> 
<ul><li>CPU速度越来越快</li><li>内存容量以接近指数级速度增长</li><li>磁盘容量，更大更便宜</li><li>磁盘速度的提高却相对较慢 
  <ul><li>成为系统效率的瓶颈</li><li>缓存的增加，使大部分读盘操作可以在缓存中得到</li><li><strong>写操作</strong>(多数为小量写)是影响文件系统效率的关键</li></ul> </li></ul> 
<p><strong>UNIX中创建一个文件：</strong></p> 
<ol><li>(文件名，文件号)写入目录中</li><li>新文件inode更新</li><li>目录文件inode更新(长度变化)</li><li>写入文件内容</li></ol> 
<p><strong>小量写(small write)</strong></p> 
<ol><li>一次写修改磁盘块上的一小部分数据</li><li>假定一次写需要10ms寻道时间，4ms旋转延迟，50μs读写磁盘访问效率只有 50 / (14000 + 50) = 0.36%.</li></ol> 
<p><strong>考虑写延迟</strong></p> 
<ul><li>发生故障给文件系统一致性带来威胁</li></ul> 
<h4><a id="82__860"></a>8.2 日志结构文件系统</h4> 
<p>UC Berkley 的研究人员提出一种新的文件系统——<strong>日志结构文件系统（LSFS）</strong>。</p> 
<p>LSFS将整个磁盘看做一个日志，周期性地追加新日志。写操作并非直接反映到磁盘上，而是被暂时存到内存缓冲区中，其中包括新写的数据，也包括更新数据当积累到一定规模时，作为一个segment追加到日志的末尾。</p> 
<p><img src="https://images2.imgbox.com/90/10/Y0SQhhjn_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<p>段包括索引结点(inode)、目录(directory)以及数据块(datablock)，每个段的开始处都包含一条总结信息(summary)，说明该段的信息组<br> 织情况。</p> 
<p><img src="https://images2.imgbox.com/15/2b/Rlqey3WV_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<p>由于索引结点的存储位置不能由其编号确定，系统维护一个<strong>索引结点图(inode map)</strong>，以<strong>实现从文件号i-number 到磁盘索引结点inode位置的映射</strong>。索引结点图被保存在磁盘上，但是被缓存到内存以提高访问速度。打开文件时由文件号i-number查索引结点图找到索引结点，进而找到文件数据块。</p> 
<p>当日志将磁盘写满时，新段无法继续写入。由于已写入盘中的段可能有陈旧信息，系统设置一个<strong>清洁线程(cleaner)</strong>，<strong>循环扫描磁盘并对段进行压缩</strong>。</p> 
<ul><li>清洁线程首先读入第一个段，然后查找索引结点图确定索引结点是否为新版并仍然被使用，</li><li>若不是则信息被丢弃。</li><li>仍然有用的索引结点和数据块与内存中的当前段合并作为新段写回磁盘，旧段被标记为空闲，然后顺序处理下一个段。</li></ul> 
<h3><a id="_883"></a>九、内存映射文件</h3> 
<p><img src="https://images2.imgbox.com/38/06/bhKshjqH_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<ul><li>文件保存于外存，存取速度慢 
  <ul><li>访问之前需要打开</li><li>每次访问需要经过“打开文件表</li><li>读写需要经过I/O传输 
    <ul><li>缓冲可以提高速度，但首次访问需要I/O</li></ul> </li><li>内存容量增加，利用率不充分 
    <ul><li>进程虚拟空间大，只使用较小的一部分</li></ul> </li></ul> </li></ul> 
<p><strong>内存映射文件</strong>：将文件映射到内存，以访问内存的方式访问文件</p> 
<ul><li>以访问内存的方式访问文件数据</li><li>文件数据的读入、写出由操作系统自动完成</li><li>进程关闭文件时，操作系统自动将文件被修改的数据写回磁盘</li><li>多个进程可以映射同一个文件，实现<strong>共享</strong></li></ul> 
<p>ry)以及数据块(datablock)，每个段的开始处都包含一条总结信息(summary)，说明该段的信息组<br> 织情况。</p> 
<p>[外链图片转存中…(img-OytUfHHT-1719408518180)]</p> 
<p>由于索引结点的存储位置不能由其编号确定，系统维护一个<strong>索引结点图(inode map)</strong>，以<strong>实现从文件号i-number 到磁盘索引结点inode位置的映射</strong>。索引结点图被保存在磁盘上，但是被缓存到内存以提高访问速度。打开文件时由文件号i-number查索引结点图找到索引结点，进而找到文件数据块。</p> 
<p>当日志将磁盘写满时，新段无法继续写入。由于已写入盘中的段可能有陈旧信息，系统设置一个<strong>清洁线程(cleaner)</strong>，<strong>循环扫描磁盘并对段进行压缩</strong>。</p> 
<ul><li>清洁线程首先读入第一个段，然后查找索引结点图确定索引结点是否为新版并仍然被使用，</li><li>若不是则信息被丢弃。</li><li>仍然有用的索引结点和数据块与内存中的当前段合并作为新段写回磁盘，旧段被标记为空闲，然后顺序处理下一个段。</li></ul> 
<h3><a id="_932"></a>九、内存映射文件</h3> 
<p>[外链图片转存中…(img-oqJYZpR7-1719408518180)]</p> 
<ul><li>文件保存于外存，存取速度慢 
  <ul><li>访问之前需要打开</li><li>每次访问需要经过“打开文件表</li><li>读写需要经过I/O传输 
    <ul><li>缓冲可以提高速度，但首次访问需要I/O</li></ul> </li><li>内存容量增加，利用率不充分 
    <ul><li>进程虚拟空间大，只使用较小的一部分</li></ul> </li></ul> </li></ul> 
<p><strong>内存映射文件</strong>：将文件映射到内存，以访问内存的方式访问文件</p> 
<ul><li>以访问内存的方式访问文件数据</li><li>文件数据的读入、写出由操作系统自动完成</li><li>进程关闭文件时，操作系统自动将文件被修改的数据写回磁盘</li><li>多个进程可以映射同一个文件，实现<strong>共享</strong></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1760350bf743579b518f47c7b09f7e3d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Qt 智能指针类详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/86869959913d0e0e2df8351268ca113f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">自动任务、系统工具、文件工具、PDF工具、OCR图文识别、文字处理、电子表格，30&#43;超实用功能，牛的一批！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>