<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python - SnowNLP 情感分析与自定义训练 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/845d93d4f9a64c18df33a73e38ef0bdb/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Python - SnowNLP 情感分析与自定义训练">
  <meta property="og:description" content="目录
一.引言
二.SnowNLP 情感分析
1.安装 SnowNLP
2.测试 SnowNLP
三.SnowNLP 自定义训练
1.数据集准备
2.训练与保存
3.模型替换
4.模型测试
5.SnowNLP 原理
◆ Bayes 公式
◆ 先验概率
◆ 后验概率
◆ 情感模型
四.总结
一.引言 SnowNLP 是一个基于 Python 的简洁的自然语言处理工具包，它提供了文本情感分析、关键词提取、文本分类等功能。该工具包具有简单易用的接口，可帮助用户快速实现文本处理和情感分析任务。SnowNLP 的设计理念是简洁高效，它采用了一些先进的自然语言处理算法，同时也尽量减少了不必要的复杂性，使得用户可以轻松地应用它来处理文本数据。本文主要包括两部分:
◆ SnowNLP 情感分析
◆ SnowNLP 自定义训练
二.SnowNLP 情感分析 1.安装 SnowNLP pip install snownlp -i https://pypi.tuna.tsinghua.edu.cn/simple 出现 Successfully 即为安装成功，博主这里 Py == 3.8、snownlp == 0.12.3。
2.测试 SnowNLP from snownlp import SnowNLP def sentiment_analysis(text): # 使用SnowNLP对中文文本进行情感分析 s = SnowNLP(text) # SnowNLP的sentiments方法返回情感倾向分数，越接近1表明情感越积极，越接近0表明情感越消极 sentiment_score = s.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-23T07:19:57+08:00">
    <meta property="article:modified_time" content="2024-01-23T07:19:57+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python - SnowNLP 情感分析与自定义训练</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><img src="https://images2.imgbox.com/0b/4c/04BDAwmj_o.jpg" alt="296a0faa3c3445a28ef011ca274753d1.jpeg"></h2> 
<p><strong>目录</strong></p> 
<p style="margin-left:0px;"><a href="#%E4%B8%80.%E5%BC%95%E8%A8%80" rel="nofollow">一.引言</a></p> 
<p style="margin-left:0px;"><a href="#%E4%BA%8C.SnowNLP%20%E6%83%85%E6%84%9F%E5%88%86%E6%9E%90" rel="nofollow">二.SnowNLP 情感分析</a></p> 
<p style="margin-left:40px;"><a href="#1.%E5%AE%89%E8%A3%85%20SnowNLP" rel="nofollow">1.安装 SnowNLP</a></p> 
<p style="margin-left:40px;"><a href="#2.%E6%B5%8B%E8%AF%95%20SnowNLP" rel="nofollow">2.测试 SnowNLP</a></p> 
<p style="margin-left:0px;"><a href="#%E4%B8%89.SnowNLP%20%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%AD%E7%BB%83" rel="nofollow">三.SnowNLP 自定义训练</a></p> 
<p style="margin-left:40px;"><a href="#1.%E6%95%B0%E6%8D%AE%E9%9B%86%E5%87%86%E5%A4%87" rel="nofollow">1.数据集准备</a></p> 
<p style="margin-left:40px;"><a href="#2.%E8%AE%AD%E7%BB%83%E4%B8%8E%E4%BF%9D%E5%AD%98" rel="nofollow">2.训练与保存</a></p> 
<p style="margin-left:40px;"><a href="#3.%E6%A8%A1%E5%9E%8B%E6%9B%BF%E6%8D%A2" rel="nofollow">3.模型替换</a></p> 
<p style="margin-left:40px;"><a href="#4.%E6%A8%A1%E5%9E%8B%E6%B5%8B%E8%AF%95" rel="nofollow">4.模型测试</a></p> 
<p style="margin-left:40px;"><a href="#5.SnowNLP%20%E5%8E%9F%E7%90%86" rel="nofollow">5.SnowNLP 原理</a></p> 
<p style="margin-left:80px;"><a href="#%E2%97%86%20Bayes%20%E5%85%AC%E5%BC%8F" rel="nofollow">◆ Bayes 公式</a></p> 
<p style="margin-left:80px;"><a href="#%E2%97%86%20%E5%85%88%E9%AA%8C%E6%A6%82%E7%8E%87" rel="nofollow">◆ 先验概率</a></p> 
<p style="margin-left:80px;"><a href="#%E2%97%86%20%E5%90%8E%E9%AA%8C%E6%A6%82%E7%8E%87" rel="nofollow">◆ 后验概率</a></p> 
<p style="margin-left:80px;"><a href="#%E2%97%86%20%E6%83%85%E6%84%9F%E6%A8%A1%E5%9E%8B" rel="nofollow">◆ 情感模型</a></p> 
<p style="margin-left:0px;"><a href="#%E5%9B%9B.%E6%80%BB%E7%BB%93" rel="nofollow">四.总结</a></p> 
<hr> 
<p> </p> 
<h2>一.引言</h2> 
<p>SnowNLP 是一个基于 Python 的简洁的自然语言处理工具包，它提供了文本情感分析、关键词提取、文本分类等功能。该工具包具有简单易用的接口，可帮助用户快速实现文本处理和情感分析任务。SnowNLP 的设计理念是简洁高效，它采用了一些先进的自然语言处理算法，同时也尽量减少了不必要的复杂性，使得用户可以轻松地应用它来处理文本数据。本文主要包括两部分:</p> 
<p><strong>◆ SnowNLP 情感分析</strong></p> 
<p><strong>◆ SnowNLP 自定义训练</strong></p> 
<p> </p> 
<h2>二.SnowNLP 情感分析</h2> 
<h3>1.安装 SnowNLP</h3> 
<pre><code class="language-python">pip install snownlp -i https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre> 
<p><img src="https://images2.imgbox.com/d7/eb/o5t4pq7D_o.png" alt="439ae58f93ab4ef89887a46bd640052f.png"></p> 
<p>出现 Successfully 即为安装成功，博主这里 Py == 3.8、snownlp == 0.12.3。</p> 
<p> </p> 
<h3>2.测试 SnowNLP</h3> 
<pre><code class="language-python">from snownlp import SnowNLP

def sentiment_analysis(text):
    # 使用SnowNLP对中文文本进行情感分析
    s = SnowNLP(text)
    # SnowNLP的sentiments方法返回情感倾向分数，越接近1表明情感越积极，越接近0表明情感越消极
    sentiment_score = s.sentiments
    return sentiment_score</code></pre> 
<p>直接调用 SnowNLP 方法获取中文文本情感，这里返回 sentiment_score，以 0.5 为界限，越接近于 1 越积极，反之越消极。</p> 
<pre><code class="language-python">    text = "角色塑造太单调，毫无震撼力！"

    score = sentiment_analysis(text)
    print(f"情感分数: {score}")

    if score &gt; 0.5:
        print("该语句是积极的。")
    else:
        print("该语句是消极的。")</code></pre> 
<p> </p> 
<h2>三.SnowNLP 自定义训练</h2> 
<h3>1.数据集准备</h3> 
<p>自定义训练数据集主要在原生 SnowNLP 无法满足自己场景的情况下，可以自定义积极、消极的文本，按行放置到 txt 文件中，供 sentiment 进行调整。下面以影视评价为例，pos 和 neg 各添加 100 条影评信息。</p> 
<p><strong>◆ pos.txt</strong></p> 
<p><img src="https://images2.imgbox.com/00/d5/qp8fwA3B_o.png" alt="482da70eb8374f27a2dbd65709c4320b.png"></p> 
<p><strong>◆ neg.txt</strong></p> 
<p><img src="https://images2.imgbox.com/ce/15/mhlkmJJa_o.png" alt="b75556900160462c89978201df90ac1f.png"></p> 
<p> </p> 
<h3>2.训练与保存</h3> 
<pre><code class="language-python">from snownlp import sentiment

def train_self_model():
    pos = "./pos.txt"
    neg = "./neg.txt"
    sentiment.train(neg, pos)
    sentiment.save("sentiment.marshal")</code></pre> 
<p>训练结束后会在输出目录得到一个 .marshal.3 的文件:  </p> 
<p><img src="https://images2.imgbox.com/1f/ad/CO0JNCsV_o.png" alt="b687753ef3444fbeb62aa1f6a9a7570d.png"></p> 
<p> </p> 
<h3>3.模型替换</h3> 
<p>要使用自己生成的 marshal 模型需要到 python site-package 库里把 SnowNLP sentiment 原始的 mershal.3 模型文件替换掉。</p> 
<p><strong>◆ 获取 Site-Packages 路径</strong></p> 
<p>在当前 python 环境目录下执行下述脚本获取 Site-Packages 文件路径:</p> 
<pre><code class="language-python">def get_site_pkg_path():
    import site
    # Add snownlp/sentiment
    return site.getsitepackages()[0]</code></pre> 
<p>执行后获取对应 Site-Packages 路径地址:</p> 
<pre><code class="language-python">cd /Users/XXX/miniforge3/PythonTest/lib/python3.8/site-packages
</code></pre> 
<p> </p> 
<p><strong>◆ 修改 mershal 模型</strong></p> 
<pre><code class="language-bash">cd snownlp/sentiment</code></pre> 
<p>备份 sentiment 库文件夹下的 sentiment.marshal.3 文件，将我们 output 的模型文件 cp 到这里。</p> 
<p><img src="https://images2.imgbox.com/a3/90/ZkhFUPhR_o.png" alt="f0a0f1f373f141859c741b66757364e2.png"></p> 
<p><strong>Tips:</strong></p> 
<p>最好备份下原始的模型，要不然将来需要还得再 pip install。 </p> 
<p> </p> 
<h3>4.模型测试</h3> 
<p>继续调用第二节情感分析一节的 sentiment_analysis 函数测试。</p> 
<p><strong>◆ 完整的训练负样本</strong></p> 
<p>使用训练过的负样本会得到非常逼近区间 [0,1] 的分数，正样本大家也可以测试下。</p> 
<pre><code class="language-python">    text = "角色塑造太单调，毫无震撼力！"
    score = sentiment_analysis(text)

    -----------------------------
    情感分数: 3.992483776915634e-07
    该语句是消极的。</code></pre> 
<p> </p> 
<p><strong>◆ 删减的训练负样本</strong></p> 
<p>使用删减过的负样本同样可以得到可靠的情感分析分数。</p> 
<pre><code class="language-python">    text = "毫无震撼力！"
    score = sentiment_analysis(text)

    -------------------------------
    情感分数: 0.004951768064722417   
    该语句是消极的。</code></pre> 
<p> </p> 
<p><strong>◆ Bad Case 分析</strong></p> 
<p>自定义训练模型后原始判定为消极的句子可能判定为积极，我们去掉消极词后可以看到是由于其他词的 Positive  Ratio 太高，从而把 Negative 的词的 Ratio 带高了，从而造成误判。所以如果大家使用自定义模型，需要注意其可能在你的专业领域得到靠谱的情感分析，但是之前的泛化能力受到影响。</p> 
<pre><code class="language-python">    text = "这个产品真的很垃圾！"
    情感分数: 0.9208253155767703    
    该语句是积极的。

    -------------------------

    text = "这个产品真的很！"
    情感分数: 0.9480748399538199
    该语句是积极的。</code></pre> 
<p> </p> 
<h3>5.SnowNLP 原理</h3> 
<p><img src="https://images2.imgbox.com/60/85/iF6j0Nwf_o.png" alt="b27fb597efaf44a59d43f713db4031f0.png"></p> 
<p>上面是 sentiment 的 __init__ 初始化代码，可以看到其使用的模型类型为 Bayes 概率统计模型，这个模型我们之前在机器学习部分讲过，其通过计算条件概率进行情感分析，核心思想是通过训练样本的分词结果构建先验概率分布，再基于先验概率分布计算出现某个情况后的后验概率。</p> 
<h4><strong>◆ Bayes 公式</strong></h4> 
<p><img src="https://images2.imgbox.com/59/3d/Z1XaytPs_o.png" alt="b9df4db8eb4744989ac70a347a9d08a2.png"></p> 
<p> </p> 
<h4><strong>◆ 先验概率</strong></h4> 
<p><img src="https://images2.imgbox.com/7a/6b/cQrq2BPB_o.png" alt="2afae2b2e9f94690a65e8cc3b5dfd5df.png"></p> 
<p>假设男生女生各 50 人，其通过 B/G 代表，则 P(B) = P(G) = 50 / (50  + 50) = 0.5。</p> 
<p>其次规定事件 T 为是否穿长裤，其中男生 75% 的概率穿长裤，即 P(T|B) = 0.75，女生 50% 的概率穿长裤，即 P(T|G) = 0.5，这里 <strong>P(T|B/G) </strong>即为先验概率，是我们通过概率统计计算而得。</p> 
<p> </p> 
<h4><strong>◆ 后验概率</strong></h4> 
<p>由条件概率公式可得，可以理解为穿长裤的男生的数量与男生穿长裤的数量一致：</p> 
<p style="text-align:center;"><strong>P(BT) = P(B) * P(T|B) = P(T) * P(B|T)</strong></p> 
<p>由全概率公式可得，可以理解为穿长裤的概率等于男生、女生穿长裤的概率之和：</p> 
<p style="text-align:center;"><strong>P(T) = P(B) * P(T|B) + P(G) * P(T|G)</strong></p> 
<p>所以可以推导出:</p> 
<p style="text-align:center;"><strong>P(B|T) = P(B)·P(T|B) / P(T)</strong></p> 
<p>这里 P(B) 男生的概率、P(T) 穿长裤的概率、P(T|B) 男生穿长裤的概率都有，计算可得穿长裤的是男生的概率 P(B|T)。</p> 
<p> </p> 
<h4><strong>◆ 情感模型</strong></h4> 
<p>而对于上面情感分析的场景，我们 P(Sentiment) 即为积极 P、消极 N 两种选择，我们获取 text 进行分词得到 w1、w2 且可以得到 P(S|Wi) 即当前词的情感，从而最后推导出情感分析的概率计算:</p> 
<p style="text-align:center;"><img class="mathcode" src="https://images2.imgbox.com/45/0f/Nx45qALM_o.png" alt="eq?P%28S_i%7CW%29%20%3D%20%5Cfrac%7BP%28W_1%7CS_i%29P%28W_2%7CS_i%29...P%28W_n%7CS_i%29%5Ccdot%20P%28S_i%29%7D%7BP%28W_1%29P%28W_2%29%5Ccdots%20P%28W_n%29%7D"></p> 
<p>其中 Wi 为 Text W 中文本分词的结果，Si 对应 P、N 两种情感，我们计算 P(Si|W) 即文本对应的情感 S，P(Wi) 为对应词语出现的频次，P(Wi|Si) 为积极或消极场景中该词出现的概率，以此类推即可计算 Score。 </p> 
<p> </p> 
<h2>四.总结</h2> 
<p>SnowNLP 采用 Bayes 模型，支持自定义训练，开箱即用也很轻便，有需要情感分析的同学可以使用，当然语言模型 Bert 甚至大模型 LLM 现在也具备该场景功能，有兴趣的同学也可以微调模型获得更专业的情感分析模型。</p> 
<p>完整的 Bayes 实战代码可以参考: <a class="link-info" href="https://blog.csdn.net/BIT_666/article/details/79702066?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170531022116800192241266%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=170531022116800192241266&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-2-79702066-null-null.nonecase&amp;utm_term=%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%A8%A1%E5%9E%8B&amp;spm=1018.2226.3001.4450" title="朴素贝叶斯-分类及Sklearn库实现 机器学习实战">朴素贝叶斯-分类及Sklearn库实现 机器学习实战</a>。</p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/948b0c8689b07edb5bea3d30d70a5d15/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">创建表：HBase表的定义与创建</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7229dc7cc25a849ebce609eb84da86d1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【JavaWeb】web乱码总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>