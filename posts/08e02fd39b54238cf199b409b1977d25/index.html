<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>打造专业级ChatGPT风格聊天界面：SpringBoot与Vue实现动态打字机效果，附完整前后端源码 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/08e02fd39b54238cf199b409b1977d25/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="打造专业级ChatGPT风格聊天界面：SpringBoot与Vue实现动态打字机效果，附完整前后端源码">
  <meta property="og:description" content="大家好，今天用SpringBoot、vue写了一个仿ChatGPT官网聊天的打字机效果。
所有代码地址:gitee代码地址 ，包含前端和后端，可以直接运行
使用本技术实现的项目：aicnn.cn，欢迎大家体验
如果文章知识点有错误的地方，请指正！大家一起学习，一起进步。
本文主要应用的技术有:SpringBoot、Vue、Reactive、WebFlux、EventSource等，学习和练手的好项目。实现效果如下：
准备好了吗，let’s get it!
采用本文技术实现的前后端项目，点击体验使用：aicnn.cn
文章目录 前言 项目运行SSE技术概览什么是Server-Sent Events？SSE与WebSockets的区别为什么选择SSE？SSE的应用场景 在Spring Boot中实现SSE设置SSE处理连接和事件处理异常和断开连接一些实用的提示 Vue前端对SSE的处理在Vue中接收SSE保证流畅的用户体验异常处理和重连小结 实际案例分析：实时通知系统场景描述为什么选择SSE？实现概览体验优化可能的挑战 结语 前言 Web开发的世界永远充满惊喜，不是吗？每当我们认为自己掌握了所有的技巧和工具，总会有新的技术出现，挑战我们的知识库。今天，我们要探讨的这项技术可能对一些人来说并不陌生，但对于其他人来说，则像是新发现的宝藏。没错，我在说的是Server-Sent Events（SSE）。
你可能会问：“SSE是什么？”简单来说，SSE是一种让服务器实时向客户端发送更新的技术。但别误会，这不是另一个WebSockets。SSE和WebSockets之间的斗争，有点像是电影《星球大战》中的帝国和反抗军的斗争——两者都有其优势和用武之地，但战场完全不同。SSE是为了解决特定类型的实时通讯问题而生，而不是为了取代WebSockets。
在本文中，我们将一探究竟，看看SSE到底是什么魔法，以及如何在Spring Boot应用程序和VUE中轻松实现它。当然，我们也不会忘记前端的小伙伴们——我们将一起探索如何在Vue应用中接收和处理这些实时数据，并一起实现类似ChatGPT官网的聊天打字机效果。准备好了吗？让我们开始这趟探索之旅吧！
项目运行 所有代码地址:代码地址 ，包含前端和后端，可以直接运行。
springboot安装依赖，并设置对应的sd-key即可：
api key 的获取方式如下：
第一步：打开aicnn.cn第二步：进入设置页面第三步：点击创建新的秘钥第四步：复制密钥值，替换上面代码中的sk-*******,替换后的代码如下所示： .header(&#34;Authorization&#34;, &#34;Bearer sk-1234567890123456789&#34;) 前端项目采用vue3实现，
在项目中,使用如下命令运行项目，即可运行前端:
yarn install yarn serve SSE技术概览 什么是Server-Sent Events？ 在深入探索Server-Sent Events（SSE）之前，让我们先搞清楚它到底是什么。简单地说，SSE是一种允许服务器主动向客户端发送信息的技术。与传统的请求-响应模式不同，SSE建立了一个单向通道，使得服务器可以实时发送更新。这听起来有点像WebSockets，但SSE的工作方式和用例却大有不同。
SSE与WebSockets的区别 SSE和WebSockets都是实现实时通信的技术，但它们各有千秋。WebSockets提供了一个全双工的通信渠道，允许数据在客户端和服务器之间双向流动。相比之下，SSE是单向的——仅从服务器到客户端。这意味着如果你需要从客户端向服务器发送数据，SSE可能就不是最佳选择了。SSE的优势在于它的简单性和轻量级，特别适用于那些仅需要服务器单向传送数据的场景，比如实时新闻更新、股票行情等。
为什么选择SSE？ 现在你可能在想：“为什么我要使用SSE而不是其他技术？”好问题！首先，SSE在浏览器中有很好的支持，这使得它非常容易实现。其次，由于SSE是基于HTTP的，它可以利用现有的HTTP协议特性，如缓存、认证等。这些特性在WebSockets中可能需要额外的处理。最后，SSE的轻量级特性使其成为一种高效的实时数据传输方式，尤其是当你只需要服务器到客户端的单向数据流时。
SSE的应用场景 SSE最适合的是那些需要服务器定期或不定期推送信息到客户端的场景。例如，如果你正在开发一个需要显示实时消息、股票行情或任何形式实时数据的应用，SSE是一个不错的选择。它的轻量级和易用性使其成为这些类型应用的理想选择。
在Spring Boot中实现SSE 设置SSE 在Spring Boot中实现SSE并不复杂。其核心在于使用Spring框架的webflux。使用webflux类能够创建一个持久的连接，使服务器能够向客户端发送多个事件，而无需每次都建立新的连接。
先在pom中引入相关依赖：
&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-webflux&lt;/artifactId&gt; &lt;/dependency&gt; 然后需要在Controller中创建一个方法来返回Flux实例。这个方法将被映射到特定的URL，客户端将使用这个URL来接收事件。
package cn.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-23T14:35:02+08:00">
    <meta property="article:modified_time" content="2024-01-23T14:35:02+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">打造专业级ChatGPT风格聊天界面：SpringBoot与Vue实现动态打字机效果，附完整前后端源码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>大家好，今天用<mark>SpringBoot</mark>、<mark>vue</mark>写了一个仿ChatGPT官网聊天的打字机效果。<br> <strong>所有代码地址:<a href="https://gitee.com/codinginn/chatgpg-sse-demo-springboot-vue.git" rel="nofollow">gitee代码地址</a> </strong>，包含前端和后端，可以直接运行</p> 
 <p>使用本技术实现的项目：<a href="https://aicnn.cn" rel="nofollow">aicnn.cn</a>，欢迎大家体验</p> 
 <p><strong> 如果文章知识点有错误的地方，请指正！大家一起学习，一起进步。</strong></p> 
</blockquote> 
<p>本文主要应用的技术有:<mark>SpringBoot、Vue、Reactive、WebFlux、EventSource</mark>等，学习和练手的好项目。<strong>实现效果如下</strong>：</p> 
<p><img src="https://images2.imgbox.com/d6/69/pVtpbHnV_o.gif" alt="在这里插入图片描述"></p> 
<p>准备好了吗，<font color="red">let’s get it!</font></p> 
<p>采用本文技术实现的前后端项目，点击体验使用：<a href="https://aicnn.cn" rel="nofollow">aicnn.cn</a></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><ul><li><a href="#_18" rel="nofollow">前言</a></li></ul> 
   </li><li><a href="#_34" rel="nofollow">项目运行</a></li><li><ul><li><a href="#SSE_65" rel="nofollow">SSE技术概览</a></li><li><ul><li><a href="#ServerSent_Events_67" rel="nofollow">什么是Server-Sent Events？</a></li><li><a href="#SSEWebSockets_71" rel="nofollow">SSE与WebSockets的区别</a></li><li><a href="#SSE_78" rel="nofollow">为什么选择SSE？</a></li><li><a href="#SSE_82" rel="nofollow">SSE的应用场景</a></li></ul> 
    </li><li><a href="#Spring_BootSSE_86" rel="nofollow">在Spring Boot中实现SSE</a></li><li><ul><li><a href="#SSE_88" rel="nofollow">设置SSE</a></li><li><a href="#_143" rel="nofollow">处理连接和事件</a></li><li><a href="#_244" rel="nofollow">处理异常和断开连接</a></li><li><a href="#_248" rel="nofollow">一些实用的提示</a></li></ul> 
    </li><li><a href="#VueSSE_256" rel="nofollow">Vue前端对SSE的处理</a></li><li><ul><li><a href="#VueSSE_258" rel="nofollow">在Vue中接收SSE</a></li><li><a href="#_294" rel="nofollow">保证流畅的用户体验</a></li><li><a href="#_298" rel="nofollow">异常处理和重连</a></li><li><a href="#_302" rel="nofollow">小结</a></li></ul> 
    </li><li><a href="#_310" rel="nofollow">实际案例分析：实时通知系统</a></li><li><ul><li><a href="#_312" rel="nofollow">场景描述</a></li><li><a href="#SSE_316" rel="nofollow">为什么选择SSE？</a></li><li><a href="#_320" rel="nofollow">实现概览</a></li><li><a href="#_326" rel="nofollow">体验优化</a></li><li><a href="#_330" rel="nofollow">可能的挑战</a></li></ul> 
    </li><li><a href="#_334" rel="nofollow">结语</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="_18"></a>前言</h4> 
<p>Web开发的世界永远充满惊喜，不是吗？每当我们认为自己掌握了所有的技巧和工具，总会有新的技术出现，挑战我们的知识库。今天，我们要探讨的这项技术可能对一些人来说并不陌生，但对于其他人来说，则像是新发现的宝藏。没错，我在说的是Server-Sent Events（SSE）。</p> 
<p><img src="https://images2.imgbox.com/0e/0a/bBTfhPA7_o.jpg" alt="在这里插入图片描述"></p> 
<p>你可能会问：“SSE是什么？”简单来说，SSE是一种让服务器实时向客户端发送更新的技术。但别误会，这不是另一个WebSockets。SSE和WebSockets之间的斗争，有点像是电影《星球大战》中的帝国和反抗军的斗争——两者都有其优势和用武之地，但战场完全不同。SSE是为了解决特定类型的实时通讯问题而生，而不是为了取代WebSockets。</p> 
<p><img src="https://images2.imgbox.com/cf/93/ImIbmfex_o.jpg" alt="在这里插入图片描述"></p> 
<p>在本文中，我们将一探究竟，看看SSE到底是什么魔法，以及如何在Spring Boot应用程序和VUE中轻松实现它。当然，我们也不会忘记前端的小伙伴们——我们将一起探索如何在Vue应用中接收和处理这些实时数据，并一起实现类似ChatGPT官网的聊天打字机效果。准备好了吗？让我们开始这趟探索之旅吧！</p> 
<hr> 
<h3><a id="_34"></a>项目运行</h3> 
<p><strong>所有代码地址:<a href="https://gitee.com/codinginn/chatgpg-sse-demo-springboot-vue.git" rel="nofollow">代码地址</a> </strong>，包含前端和后端，可以直接运行。</p> 
<p>springboot安装依赖，并设置对应的sd-key即可：</p> 
<p><img src="https://images2.imgbox.com/32/34/ZKrIlwUo_o.png" alt="aicnn后端代码设置"></p> 
<p>api key 的获取方式如下：</p> 
<ul><li>第一步：打开<a href="https://aicnn.cn" rel="nofollow">aicnn.cn</a></li><li>第二步：进入设置页面</li><li>第三步：点击创建新的秘钥</li><li>第四步：复制密钥值，替换上面代码中的<code>sk-*******</code>,替换后的代码如下所示：<code> .header("Authorization", "Bearer sk-1234567890123456789")</code></li></ul> 
<p><img src="https://images2.imgbox.com/7f/df/B29HfBEy_o.png" alt="aicnn获取key"></p> 
<p>前端项目采用vue3实现，</p> 
<p>在项目中,使用如下命令运行项目，即可运行前端:</p> 
<pre><code class="prism language-bash"><span class="token function">yarn</span> <span class="token function">install</span>
<span class="token function">yarn</span> serve
</code></pre> 
<p><img src="https://images2.imgbox.com/07/14/KnXWwhVa_o.png" alt="aicnn界面展示"></p> 
<h4><a id="SSE_65"></a>SSE技术概览</h4> 
<h5><a id="ServerSent_Events_67"></a>什么是Server-Sent Events？</h5> 
<p>在深入探索Server-Sent Events（SSE）之前，让我们先搞清楚它到底是什么。简单地说，SSE是一种允许服务器主动向客户端发送信息的技术。与传统的请求-响应模式不同，SSE建立了一个单向通道，使得服务器可以实时发送更新。这听起来有点像WebSockets，但SSE的工作方式和用例却大有不同。</p> 
<h5><a id="SSEWebSockets_71"></a>SSE与WebSockets的区别</h5> 
<p>SSE和WebSockets都是实现实时通信的技术，但它们各有千秋。WebSockets提供了一个全双工的通信渠道，允许数据在客户端和服务器之间双向流动。相比之下，SSE是单向的——仅从服务器到客户端。这意味着如果你需要从客户端向服务器发送数据，SSE可能就不是最佳选择了。SSE的优势在于它的简单性和轻量级，特别适用于那些仅需要服务器单向传送数据的场景，比如实时新闻更新、股票行情等。</p> 
<p><img src="https://images2.imgbox.com/36/6f/SO6tkOXf_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="SSE_78"></a>为什么选择SSE？</h5> 
<p>现在你可能在想：“为什么我要使用SSE而不是其他技术？”好问题！首先，SSE在浏览器中有很好的支持，这使得它非常容易实现。其次，由于SSE是基于HTTP的，它可以利用现有的HTTP协议特性，如缓存、认证等。这些特性在WebSockets中可能需要额外的处理。最后，SSE的轻量级特性使其成为一种高效的实时数据传输方式，尤其是当你只需要服务器到客户端的单向数据流时。</p> 
<h5><a id="SSE_82"></a>SSE的应用场景</h5> 
<p>SSE最适合的是那些需要服务器定期或不定期推送信息到客户端的场景。例如，如果你正在开发一个需要显示实时消息、股票行情或任何形式实时数据的应用，SSE是一个不错的选择。它的轻量级和易用性使其成为这些类型应用的理想选择。</p> 
<h4><a id="Spring_BootSSE_86"></a>在Spring Boot中实现SSE</h4> 
<h5><a id="SSE_88"></a>设置SSE</h5> 
<p>在Spring Boot中实现SSE并不复杂。其核心在于使用Spring框架的<code>webflux</code>。使用webflux类能够创建一个持久的连接，使服务器能够向客户端发送多个事件，而无需每次都建立新的连接。</p> 
<p>先在pom中引入相关依赖：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-webflux<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>然后需要在Controller中创建一个方法来返回<code>Flux</code>实例。这个方法将被映射到特定的URL，客户端将使用这个URL来接收事件。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>aicnn<span class="token punctuation">.</span>chatssespringboot<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>aicnn<span class="token punctuation">.</span>chatssespringboot<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">AIAnswerDTO</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>aicnn<span class="token punctuation">.</span>chatssespringboot<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">GptServiceImpl</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MediaType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>codec<span class="token punctuation">.</span></span><span class="token class-name">ServerSentEvent</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Flux</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>


<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//用于流式请求第三方的实现类</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token class-name">GptServiceImpl</span> gptService<span class="token punctuation">;</span>

    <span class="token comment">//通过stream返回流式数据</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/completions"</span><span class="token punctuation">,</span> produces <span class="token operator">=</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">TEXT_EVENT_STREAM_VALUE</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServerSentEvent</span><span class="token punctuation">&lt;</span><span class="token class-name">AIAnswerDTO</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">getStream</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"messages"</span><span class="token punctuation">)</span><span class="token class-name">String</span> messages<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> gptService<span class="token punctuation">.</span><span class="token function">doChatGPTStream</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token comment">//实现类发送消息并获取返回结果</span>
                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>aiAnswerDTO <span class="token operator">-&gt;</span> <span class="token class-name">ServerSentEvent</span><span class="token punctuation">.</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AIAnswerDTO</span><span class="token punctuation">&gt;</span></span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//进行结果的封装，再返回给前端</span>
                        <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>aiAnswerDTO<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">onErrorResume</span><span class="token punctuation">(</span>e <span class="token operator">-&gt;</span> <span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发生异常时发送空对象</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<h5><a id="_143"></a>处理连接和事件</h5> 
<p>一旦有客户端连接到这个URL，可以通过调用<code>GptServiceImpl</code>实例的<code>doChatGPTStream</code>方法来发送事件。这些事件可以是简单的字符串消息，也可以是更复杂的数据结构，如JSON对象。记住，SSE的设计初衷是轻量级和简单，所以你发送的每个事件都应当是独立的和自包含的。</p> 
<p><code>GptServiceImpl</code>的实现方式如下，也是springboot后端实现的重点</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>aicnn<span class="token punctuation">.</span>chatssespringboot<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>aicnn<span class="token punctuation">.</span>chatssespringboot<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">AIAnswerDTO</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>aicnn<span class="token punctuation">.</span>chatssespringboot<span class="token punctuation">.</span>dto<span class="token punctuation">.</span></span><span class="token class-name">ChatRequestDTO</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>collection<span class="token punctuation">.</span></span><span class="token class-name">CollUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">StrUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>json<span class="token punctuation">.</span></span><span class="token class-name">JSONUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">JsonNode</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span></span><span class="token class-name">ObjectMapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpHeaders</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MediaType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">BodyInserters</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">WebClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Flux</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostConstruct</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>


<span class="token comment">/**
 * @author aicnn.cn
 * @date 2023/2/13
 * @description: aicnn.cn
 **/</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GptServiceImpl</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//webflux的client</span>
    <span class="token keyword">private</span> <span class="token class-name">WebClient</span> webClient<span class="token punctuation">;</span>

    <span class="token comment">//用于读取第三方的返回结果</span>
    <span class="token keyword">private</span> <span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postConstruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>webClient <span class="token operator">=</span> <span class="token class-name">WebClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//创建webflux的client</span>
                <span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span><span class="token string">"https://api.aicnn.cn/v1"</span><span class="token punctuation">)</span><span class="token comment">//填写对应的api地址</span>
                <span class="token punctuation">.</span><span class="token function">defaultHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/json"</span><span class="token punctuation">)</span><span class="token comment">//设置默认请求类型</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//请求stream的主题</span>
    <span class="token keyword">public</span> <span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AIAnswerDTO</span><span class="token punctuation">&gt;</span></span> <span class="token function">doChatGPTStream</span><span class="token punctuation">(</span><span class="token class-name">String</span> requestQuestion<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">//构建请求对象</span>
        <span class="token class-name">ChatRequestDTO</span> chatRequestDTO <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChatRequestDTO</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        chatRequestDTO<span class="token punctuation">.</span><span class="token function">setModel</span><span class="token punctuation">(</span><span class="token string">"gpt-3.5-turbo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置模型</span>
        chatRequestDTO<span class="token punctuation">.</span><span class="token function">setStream</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置流式返回</span>

        <span class="token class-name">ChatRequestDTO<span class="token punctuation">.</span>ReqMessage</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChatRequestDTO<span class="token punctuation">.</span>ReqMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置请求消息，在此可以加入自己的prompt</span>
        message<span class="token punctuation">.</span><span class="token function">setRole</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//用户消息</span>
        message<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span>requestQuestion<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//用户请求内容</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ChatRequestDTO<span class="token punctuation">.</span>ReqMessage</span><span class="token punctuation">&gt;</span></span> messages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        messages<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        chatRequestDTO<span class="token punctuation">.</span><span class="token function">setMessages</span><span class="token punctuation">(</span>messages<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置请求消息</span>


        <span class="token comment">//构建请求json</span>
        <span class="token class-name">String</span> paramJson <span class="token operator">=</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toJsonStr</span><span class="token punctuation">(</span>chatRequestDTO<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

        <span class="token comment">//使用webClient发送消息</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>webClient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token string">"/chat/completions"</span><span class="token punctuation">)</span><span class="token comment">//请求uri</span>
                <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Authorization"</span><span class="token punctuation">,</span> <span class="token string">"Bearer sk-**************"</span><span class="token punctuation">)</span><span class="token comment">//设置成自己的key，获得key的方式可以在下文查看</span>
                <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaders</span><span class="token punctuation">.</span><span class="token constant">ACCEPT</span><span class="token punctuation">,</span> <span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">TEXT_EVENT_STREAM_VALUE</span><span class="token punctuation">)</span><span class="token comment">//设置流式响应</span>
                <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">BodyInserters</span><span class="token punctuation">.</span><span class="token function">fromValue</span><span class="token punctuation">(</span>paramJson<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">bodyToFlux</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>result <span class="token operator">-&gt;</span> <span class="token function">handleWebClientResponse</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//接收到消息的处理方法</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Flux</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AIAnswerDTO</span><span class="token punctuation">&gt;</span></span> <span class="token function">handleWebClientResponse</span><span class="token punctuation">(</span><span class="token class-name">String</span> resp<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"[DONE]"</span><span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//[DONE]是消息结束标识</span>
            <span class="token keyword">return</span> <span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">JsonNode</span> jsonNode <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">readTree</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">AIAnswerDTO</span> result <span class="token operator">=</span> objectMapper<span class="token punctuation">.</span><span class="token function">treeToValue</span><span class="token punctuation">(</span>jsonNode<span class="token punctuation">,</span> <span class="token class-name">AIAnswerDTO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将获得的结果转成对象</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollUtil</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getChoices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getChoices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                    <span class="token operator">!</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getChoices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delta<span class="token punctuation">.</span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//判断是否有异常</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getChoices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delta<span class="token punctuation">.</span><span class="token function">getError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token class-name">Flux</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//返回获得的结果</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在这里，我们请求的api地址设置为https://api.aicnn.cn/v1，并且设置从aicnn.cn获取的api key即可。</p> 
<h5><a id="_244"></a>处理异常和断开连接</h5> 
<p>在使用SSE时，处理异常和断开连接也非常重要。确保在客户端断开连接或发生异常时，正确地关闭<code>webflux</code>实例。这有助于避免资源泄露和其他潜在问题。</p> 
<h5><a id="_248"></a>一些实用的提示</h5> 
<ul><li><strong>超时管理</strong>：SSE连接可能因为超时而被关闭。确保妥善处理这种情况。</li><li><strong>错误处理</strong>：适当地处理可能发生的异常，如网络问题或客户端断开连接。</li><li><strong>资源清理</strong>：在连接结束时清理资源，确保应用的健康和性能。</li></ul> 
<p><strong>至此，我们就完成了SpringBoot的SSE后端开发。</strong></p> 
<h4><a id="VueSSE_256"></a>Vue前端对SSE的处理</h4> 
<h5><a id="VueSSE_258"></a>在Vue中接收SSE</h5> 
<p>在Vue应用中接收SSE消息是相对直截了当的。需要做的基本上就是在Vue组件中创建一个新的<code>EventSource</code>实例，并指向你的Spring Boot应用中设置的SSE URL,本文使用EventSource作为示例，也可以选择axios或@microsoft/fetch-event-source发送post请求的SSE请求，使用另外两种的好处是可以控制header，携带token信息，以便于控制权限。</p> 
<pre><code class="prism language-js">        <span class="token keyword">this</span><span class="token punctuation">.</span>eventSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventSource</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8080/completions?messages='</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>inputText<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>一旦建立了连接，就可以定义各种事件监听器来处理从服务器接收到的消息。在Vue中，这通常涉及到更新组件的数据属性，这些属性又通过Vue的响应式系统自动更新UI。</p> 
<pre><code class="prism language-js"><span class="token function">sendSSEMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 只有当eventSource不存在时才创建新的EventSource连接</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>eventSource<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>inputText<span class="token punctuation">,</span> <span class="token literal-property property">isMine</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token literal-property property">isMine</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建新的EventSource连接</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>eventSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventSource</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8080/completions?messages='</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>inputText<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 设置消息接收的回调函数</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>eventSource<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>messages<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>messages<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>text <span class="token operator">+=</span> data<span class="token punctuation">.</span>choices<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>delta<span class="token punctuation">.</span>content<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">// 可选：监听错误事件，以便在出现问题时能够重新连接或处理错误</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>eventSource<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"EventSource failed:"</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>eventSource<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关闭出错的连接</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>eventSource <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 重置eventSource变量，允许重建连接</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h5><a id="_294"></a>保证流畅的用户体验</h5> 
<p>当处理实时数据时，保证一个流畅且不中断的用户体验至关重要。在Vue中，这意味着需要确保UI的更新是平滑和高效的。幸运的是，Vue的响应式系统会处理大部分重活，但你仍需要注意不要进行不必要的大规模DOM操作或数据处理。</p> 
<h5><a id="_298"></a>异常处理和重连</h5> 
<p>处理连接中断或其他异常也是至关重要的。你可能需要在失去连接时尝试重新连接，或者至少提醒用户当前的连接状态。这可以通过监听<code>EventSource</code>的错误事件并采取适当的行动来实现。</p> 
<h5><a id="_302"></a>小结</h5> 
<p>将SSE与Vue结合使用，可以为用户提供一个富有动态性和实时性的界面。无论是实时消息、通知，还是实时数据流，SSE都能让Vue应用更加生动和实用。</p> 
<p>当然，除了使用SSE进行文字聊天的打字机模式删除，SSE技术还有应用：</p> 
<hr> 
<h4><a id="_310"></a>实际案例分析：实时通知系统</h4> 
<h5><a id="_312"></a>场景描述</h5> 
<p>想象一下，你正在为一个大型在线零售平台工作，该平台需要一种方法来实时通知其用户关于订单状态的更新。在这种情况下，使用SSE来推送通知变得非常有意义。这不仅提高了用户体验，还减少了服务器的负载，因为不需要频繁的轮询。</p> 
<h5><a id="SSE_316"></a>为什么选择SSE？</h5> 
<p>在这个场景中，SSE提供了一种高效且轻量的方式来实时更新用户的订单状态。由于订单状态更新不需要来自客户端的即时响应，SSE的单向数据流完全符合需求。相比于使用WebSockets，这种方式更加简单且资源消耗更少。</p> 
<h5><a id="_320"></a>实现概览</h5> 
<p>在Spring Boot后端，你可以设置一个SSE端点，以便在订单状态发生变化时发送通知。</p> 
<p>在Vue前端，可以创建一个监听SSE消息的组件。当接收到新的订单状态更新时，该组件可以相应地更新UI，为用户提供实时反馈。</p> 
<h5><a id="_326"></a>体验优化</h5> 
<p>为了优化用户体验，还可以在前端实现一些附加功能，比如当用户离开页面时暂停事件流，或者在网络不稳定导致连接断开时自动重连。</p> 
<h5><a id="_330"></a>可能的挑战</h5> 
<p>当然，实现SSE并非没有挑战。例如，你需要确保在高并发场景下后端能够有效地处理大量的连接。此外，处理网络不稳定情况下的重连机制也是需要考虑的。</p> 
<h4><a id="_334"></a>结语</h4> 
<p>回顾我们今天的探索，我们可以看到Server-Sent Events（SSE）在现代web开发中的价值和应用潜力。通过在Spring Boot后端轻松实现SSE，并在Vue前端高效处理这些实时事件，我们可以为用户创造出更加动态和互动的体验，并使用SSE从0开始实现了类似ChatGPT聊天的前后端，以及打字机效果的输出。</p> 
<p>SSE提供了一种简单、高效的方法来处理单向数据流。它是那些需要服务器向客户端实时推送数据的应用的理想选择。无论是实时通知、实时新闻更新，还是其他任何需要实时数据的场景，SSE都能够提供一种轻量级且易于实现的解决方案。</p> 
<p>当然，每种技术都有其适用场景。SSE并不是万能的，它最适合于那些不需要客户端向服务器发送数据的场景。在选择技术方案时，了解你的需求和各种技术的优势及局限性至关重要。</p> 
<p>最后，鼓励所有的开发者尝试将SSE集成到自己的项目中。感谢你和我一起探索SSE的奇妙世界。现在，该是你动手实践的时候了！祝你编码愉快！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/146357faf0c9c914a5723a1766ad6dba/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python自动化测试 环境搭建 Selenium、WebDriver下载、安装、配置、基本使用详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/55565aebdcdcebd084a231896e96339b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">springboot 东方通（tongweb）替换tomcat（国产化）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>