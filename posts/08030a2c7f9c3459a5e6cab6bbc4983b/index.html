<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>spring boot3tokenæ‹¦æˆªå™¨é“¾çš„è®¾è®¡ä¸å®ç° - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/08030a2c7f9c3459a5e6cab6bbc4983b/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="spring boot3tokenæ‹¦æˆªå™¨é“¾çš„è®¾è®¡ä¸å®ç°">
  <meta property="og:description" content="â›°ï¸ä¸ªäººä¸»é¡µ:Â è’¾é…’
ğŸ”¥ç³»åˆ—ä¸“æ ï¼šã€Šspring bootå®æˆ˜ã€‹
ç›®å½•
å†™åœ¨å‰é¢
æµç¨‹åˆ†æ
éœ€è¦æ¸…æ¥šçš„
å®ç°æ­¥éª¤
1.å®šä¹‰æ‹¦æˆªå™¨
2.åˆ›å»ºæ‹¦æˆªå™¨é“¾é…ç½®ç±»
3.é…ç½®æ‹¦æˆªå™¨é“¾é¡ºåº
4.é…ç½®æ‹¦æˆªæ’é™¤é¡¹
æœ€å
å†™åœ¨å‰é¢ æœ¬æ–‡ä»‹ç»äº†spring bootåç«¯æœåŠ¡å¼€å‘ä¸­æœ‰å…³å¦‚ä½•è®¾è®¡æ‹¦æˆªå™¨çš„æ€è·¯ï¼ŒåšæŒçœ‹å®Œç›¸ä¿¡å¯¹ä½ æœ‰å¸®åŠ©ã€‚
åŒæ—¶æ¬¢è¿è®¢é˜…springbootç³»åˆ—ä¸“æ ï¼ŒæŒç»­åˆ†äº«spring bootçš„ä½¿ç”¨ç»éªŒã€‚
æµç¨‹åˆ†æ ç”¨æˆ·åœ¨è¿›è¡Œç™»é™†åæœåŠ¡å™¨ä¼šå‘æ”¾tokenç­‰ä¿¡æ¯ä¸€èµ·è¿”å›ç»™å‰ç«¯ï¼Œå‰ç«¯ä¼šè¿›è¡Œä¿å­˜ï¼Œé‚£ä¹ˆtokené‡Œé¢æ˜¯æºå¸¦ä¸€äº›æœ‰å…³ç”¨æˆ·çš„èº«ä»½ç­‰ä¿¡æ¯çš„ï¼Œç”¨æˆ·ç«¯åœ¨è¯·æ±‚åç«¯æ—¶éœ€è¦åœ¨è¯·æ±‚å¤´æºå¸¦tokenï¼Œè¯·æ±‚å…ˆè¢«æ‹¦æˆªå™¨æˆªè·ï¼Œåªæœ‰ç»è¿‡å¤šé‡æ‹¦æˆªå™¨æ ¡éªŒé€šè¿‡åæ‰å¯ä»¥æ‰§è¡Œå¯¹åº”åŠŸèƒ½æ¥å£ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸è¿”å›å¯¹åº”é”™è¯¯ä¿¡æ¯ã€‚
éœ€è¦æ¸…æ¥šçš„ æ¯æ¬¡ç™»å½•éƒ½è¦åˆ·æ–°tokenä¿¡æ¯ï¼Œä¸èƒ½åœ¨ç”¨æˆ·è®¿é—®çš„è¿‡ç¨‹ä¸­tokenè¿‡æœŸï¼Œåªè¦ç”¨æˆ·è®¿é—®ï¼Œtokenå°±è¦åˆ·æ–°æœ‰æ•ˆæœŸã€‚å¦‚æœtokenæ­£ç¡®è§£ætokenä¸­çš„ç”¨æˆ·id,æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚ å®ç°æ­¥éª¤ æ€»çš„æ¥è¯´å¤§è‡´åˆ†ä¸º4æ­¥ï¼š
1å®šä¹‰æ‹¦æˆªå™¨---&gt;2åˆ›å»ºæ‹¦æˆªå™¨é“¾é…ç½®ç±»---&gt;3é…ç½®æ‹¦æˆªå™¨é“¾é¡ºåº---&gt;4é…ç½®æ‹¦æˆªæ’é™¤é¡¹
1.å®šä¹‰æ‹¦æˆªå™¨ é¦–å…ˆï¼Œéœ€è¦å®šä¹‰ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ç±»ï¼Œè¯¥æ‹¦æˆªå™¨ç±»éœ€è¦å®ç° Spring æ¡†æ¶æä¾›çš„ HandlerInterceptor æ¥å£ã€‚è¯¥æ‹¦æˆªå™¨åªåšä¸€ä»¶äº‹å°±æ˜¯åˆ·æ–°tokenã€‚
import cn.hutool.json.JSONUtil; import com.mijiu.commom.util.JwtUtils; import com.mijiu.commom.util.UserHolder; import com.mijiu.entity.User; import io.jsonwebtoken.Claims; import jakarta.servlet.http.HttpServletRequest; import jakarta.servlet.http.HttpServletResponse; import lombok.extern.slf4j.Slf4j; import org.apache.commons.lang3.StringUtils; import org.springframework.data.redis.core.StringRedisTemplate; import org.springframework.lang.Nullable; import org.springframework.stereotype.Component; import org.springframework.web.servlet.HandlerInterceptor; import java.util.Objects; import java.util.concurrent.TimeUnit; /** * @author mijiupro */ @Slf4j @Component public class RefreshTokenInterceptor implements HandlerInterceptor { private final JwtUtils jwtUtils; private final StringRedisTemplate stringRedisTemplate; public RefreshTokenInterceptor(JwtUtils jwtUtils, StringRedisTemplate stringRedisTemplate) { this.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-27T16:42:08+08:00">
    <meta property="article:modified_time" content="2024-04-27T16:42:08+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">spring boot3tokenæ‹¦æˆªå™¨é“¾çš„è®¾è®¡ä¸å®ç°</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>Â <img alt="" height="68" src="https://images2.imgbox.com/a2/1e/vDTVaV47_o.jpg" width="68"></p> 
<p><span style="color:#ed7976;">â›°ï¸ä¸ªäººä¸»é¡µ:Â  Â  Â <a href="https://blog.csdn.net/qq_62262918?spm=1011.2266.3001.5343" title="è’¾é…’">è’¾é…’</a></span></p> 
<p><span style="color:#a2e043;">ğŸ”¥ç³»åˆ—ä¸“æ ï¼š<a href="https://blog.csdn.net/qq_62262918/category_12571219.html?spm=1001.2014.3001.5482" title="ã€Šspring bootå®æˆ˜ã€‹">ã€Šspring bootå®æˆ˜ã€‹</a></span></p> 
<hr> 
<p id="main-toc"><strong>ç›®å½•</strong></p> 
<p id="1.%E5%89%8D%E8%A8%80-toc" style="margin-left:0px;"><a href="#1.%E5%89%8D%E8%A8%80" rel="nofollow">å†™åœ¨å‰é¢</a></p> 
<p id="%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90-toc" style="margin-left:0px;"><a href="#%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90" rel="nofollow">æµç¨‹åˆ†æ</a></p> 
<p id="%E9%9C%80%E8%A6%81%E6%B8%85%E6%A5%9A%E7%9A%84-toc" style="margin-left:0px;"><a href="#%E9%9C%80%E8%A6%81%E6%B8%85%E6%A5%9A%E7%9A%84" rel="nofollow">éœ€è¦æ¸…æ¥šçš„</a></p> 
<p id="%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4-toc" style="margin-left:0px;"><a href="#%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4" rel="nofollow">å®ç°æ­¥éª¤</a></p> 
<p id="1.%E5%AE%9A%E4%B9%89%E6%8B%A6%E6%88%AA%E5%99%A8-toc" style="margin-left:40px;"><a href="#1.%E5%AE%9A%E4%B9%89%E6%8B%A6%E6%88%AA%E5%99%A8" rel="nofollow">1.å®šä¹‰æ‹¦æˆªå™¨</a></p> 
<p id="2.%E5%88%9B%E5%BB%BA%E6%8B%A6%E6%88%AA%E5%99%A8%E9%93%BE%E9%85%8D%E7%BD%AE%E7%B1%BB-toc" style="margin-left:40px;"><a href="#2.%E5%88%9B%E5%BB%BA%E6%8B%A6%E6%88%AA%E5%99%A8%E9%93%BE%E9%85%8D%E7%BD%AE%E7%B1%BB" rel="nofollow">2.åˆ›å»ºæ‹¦æˆªå™¨é“¾é…ç½®ç±»</a></p> 
<p id="3.%E9%85%8D%E7%BD%AE%E6%8B%A6%E6%88%AA%E5%99%A8%E9%93%BE%E9%A1%BA%E5%BA%8F-toc" style="margin-left:40px;"><a href="#3.%E9%85%8D%E7%BD%AE%E6%8B%A6%E6%88%AA%E5%99%A8%E9%93%BE%E9%A1%BA%E5%BA%8F" rel="nofollow">3.é…ç½®æ‹¦æˆªå™¨é“¾é¡ºåº</a></p> 
<p id="4.%E9%85%8D%E7%BD%AE%E6%8B%A6%E6%88%AA%E6%8E%92%E9%99%A4%E9%A1%B9-toc" style="margin-left:40px;"><a href="#4.%E9%85%8D%E7%BD%AE%E6%8B%A6%E6%88%AA%E6%8E%92%E9%99%A4%E9%A1%B9" rel="nofollow">4.é…ç½®æ‹¦æˆªæ’é™¤é¡¹</a></p> 
<p id="%E6%9C%80%E5%90%8E-toc" style="margin-left:0px;"><a href="#%E6%9C%80%E5%90%8E" rel="nofollow">æœ€å</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2>å†™åœ¨å‰é¢</h2> 
<p>æœ¬æ–‡ä»‹ç»äº†spring bootåç«¯æœåŠ¡å¼€å‘ä¸­æœ‰å…³å¦‚ä½•è®¾è®¡æ‹¦æˆªå™¨çš„æ€è·¯ï¼ŒåšæŒçœ‹å®Œç›¸ä¿¡å¯¹ä½ æœ‰å¸®åŠ©ã€‚</p> 
<p>åŒæ—¶æ¬¢è¿è®¢é˜…springbootç³»åˆ—ä¸“æ ï¼ŒæŒç»­åˆ†äº«spring bootçš„ä½¿ç”¨ç»éªŒã€‚</p> 
<p></p> 
<h2 id="%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90">æµç¨‹åˆ†æ</h2> 
<p>ç”¨æˆ·åœ¨è¿›è¡Œç™»é™†åæœåŠ¡å™¨ä¼šå‘æ”¾tokenç­‰ä¿¡æ¯ä¸€èµ·è¿”å›ç»™å‰ç«¯ï¼Œå‰ç«¯ä¼šè¿›è¡Œä¿å­˜ï¼Œé‚£ä¹ˆtokené‡Œé¢æ˜¯æºå¸¦ä¸€äº›æœ‰å…³ç”¨æˆ·çš„èº«ä»½ç­‰ä¿¡æ¯çš„ï¼Œç”¨æˆ·ç«¯åœ¨è¯·æ±‚åç«¯æ—¶éœ€è¦åœ¨è¯·æ±‚å¤´æºå¸¦tokenï¼Œè¯·æ±‚å…ˆè¢«æ‹¦æˆªå™¨æˆªè·ï¼Œåªæœ‰ç»è¿‡å¤šé‡æ‹¦æˆªå™¨æ ¡éªŒé€šè¿‡åæ‰å¯ä»¥æ‰§è¡Œå¯¹åº”åŠŸèƒ½æ¥å£ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸è¿”å›å¯¹åº”é”™è¯¯ä¿¡æ¯ã€‚</p> 
<p></p> 
<p></p> 
<h2 id="%E9%9C%80%E8%A6%81%E6%B8%85%E6%A5%9A%E7%9A%84">éœ€è¦æ¸…æ¥šçš„</h2> 
<blockquote> 
 <ul><li>æ¯æ¬¡ç™»å½•éƒ½è¦åˆ·æ–°tokenä¿¡æ¯ï¼Œ</li><li>ä¸èƒ½åœ¨ç”¨æˆ·è®¿é—®çš„è¿‡ç¨‹ä¸­tokenè¿‡æœŸï¼Œåªè¦ç”¨æˆ·è®¿é—®ï¼Œtokenå°±è¦åˆ·æ–°æœ‰æ•ˆæœŸã€‚</li><li>å¦‚æœtokenæ­£ç¡®è§£ætokenä¸­çš„ç”¨æˆ·id,æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚</li></ul> 
</blockquote> 
<p></p> 
<h2 id="%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4">å®ç°æ­¥éª¤</h2> 
<p>æ€»çš„æ¥è¯´å¤§è‡´åˆ†ä¸º4æ­¥ï¼š</p> 
<blockquote> 
 <p><strong>1å®šä¹‰æ‹¦æˆªå™¨---&gt;2åˆ›å»ºæ‹¦æˆªå™¨é“¾é…ç½®ç±»---&gt;3é…ç½®æ‹¦æˆªå™¨é“¾é¡ºåº---&gt;4é…ç½®æ‹¦æˆªæ’é™¤é¡¹</strong></p> 
</blockquote> 
<h3 id="1.%E5%AE%9A%E4%B9%89%E6%8B%A6%E6%88%AA%E5%99%A8">1.å®šä¹‰æ‹¦æˆªå™¨</h3> 
<p>é¦–å…ˆï¼Œéœ€è¦å®šä¹‰ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ç±»ï¼Œè¯¥æ‹¦æˆªå™¨ç±»éœ€è¦å®ç° Spring æ¡†æ¶æä¾›çš„ <code>HandlerInterceptor</code> æ¥å£ã€‚è¯¥æ‹¦æˆªå™¨<span style="background-color:#ffd900;">åªåšä¸€ä»¶äº‹å°±æ˜¯åˆ·æ–°tokenã€‚</span></p> 
<p></p> 
<pre><code class="language-java">import cn.hutool.json.JSONUtil;
import com.mijiu.commom.util.JwtUtils;
import com.mijiu.commom.util.UserHolder;
import com.mijiu.entity.User;
import io.jsonwebtoken.Claims;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang3.StringUtils;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.lang.Nullable;
import org.springframework.stereotype.Component;
import org.springframework.web.servlet.HandlerInterceptor;

import java.util.Objects;
import java.util.concurrent.TimeUnit;

/**
 * @author mijiupro
 */
@Slf4j
@Component
public class RefreshTokenInterceptor implements HandlerInterceptor {

    private final JwtUtils jwtUtils;
    private final StringRedisTemplate stringRedisTemplate;

    public RefreshTokenInterceptor(JwtUtils jwtUtils, StringRedisTemplate stringRedisTemplate) {
        this.jwtUtils = jwtUtils;
        this.stringRedisTemplate = stringRedisTemplate;
    }

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {

        // 1ã€ä»è¯·æ±‚å¤´ä¸­è·å–token
        String authorizationHeader = request.getHeader("authorization");
        if (StringUtils.isBlank(authorizationHeader)) {
            return true;
        }
        // 2.è§£ætoken
        Claims claims = jwtUtils.parseToken(authorizationHeader);
        if (Objects.isNull(claims)) {
            return true;
        }

        // 3.è·å–ç”¨æˆ·ä¿¡æ¯
        Integer userId = claims.get("userId", Integer.class);

        String userInfoJson = stringRedisTemplate.opsForValue().get("login:user:" + userId);
        if (StringUtils.isBlank(userInfoJson)) {
            return true;
        }


        // 4.åˆ·æ–°token
        String refreshToken = jwtUtils.refreshToken(authorizationHeader);

        response.setHeader("Access-Control-Expose-Headers", "Authorization");
        response.addHeader("Authorization", refreshToken);
        stringRedisTemplate.expire("login:user:" + userId, 30, TimeUnit.MINUTES);

        // 5.å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥æœ¬åœ°çº¿ç¨‹æ–¹ä¾¿è·å–
        User user = JSONUtil.toBean(userInfoJson, User.class);
        UserHolder.setInfoByToken(user);

        return true;
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable Exception ex) throws Exception {
        // æ¸…ç†æœ¬åœ°çº¿ç¨‹
        UserHolder.clear();
    }
}</code></pre> 
<blockquote> 
 <p><span style="background-color:#ffd900;">å€¼å¾—æ³¨æ„ï¼šå› ä¸ºæœ‰äº›æ¥å£æ˜¯ä¸éœ€è¦è®¤è¯çš„æ¯”å¦‚ä½ åœ¨å•†åŸï¼Œæµè§ˆå•†å“ï¼Œæ˜¯ä¸æ˜¯ä¸ç™»å½•ä¹Ÿå¯ä»¥æµè§ˆã€‚ä¸ç™»å½•å°±æ²¡tokenï¼Œæ²¡tokenå°±ç›´æ¥æ”¾è¡Œï¼ˆè®¤è¯äº¤ç»™åç»­çš„è®¤è¯æ‹¦æˆªå™¨ï¼‰ï¼Œæœ‰tokenå°±ç›´æ¥åˆ·æ–°ï¼ˆä¸å¯èƒ½ä½ ç™»å½•äº†æµè§ˆäº†30åˆ†é’Ÿï¼Œçªç„¶ä¸‹å•ç„¶åå‘Šè¯‰ä½ tokenè¿‡æœŸé‡æ–°ç™»å½•å§ï¼Œæ‰€ä»¥ç™»å½•åè°ƒç”¨çš„æ¯ä¸ªæ¥å£éƒ½è¦èµ°ä¸€étokenåˆ·æ–°ï¼‰ã€‚æœ€åè¯·æ±‚å¤„ç†å®Œä¸€å®šè¦æ¸…ç†ä¸€ä¸‹æœ¬åœ°çº¿ç¨‹ï¼Œä¸ç„¶ç”¨æˆ·å¤šçš„æ—¶å€™å†…å­˜å ç”¨ä¼šå¾ˆå¤§ã€‚</span></p> 
</blockquote> 
<h3></h3> 
<p>ç„¶åï¼Œå°±è¦å®ç°ä¸€ä¸ªè®¤è¯æ‹¦æˆªå™¨äº†ï¼Œå®ç°ç”¨æˆ·èº«ä»½è®¤è¯ã€‚</p> 
<pre><code class="language-java">import com.mijiu.commom.util.UserHolder;
import com.mijiu.entity.User;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import org.springframework.stereotype.Component;
import org.springframework.web.servlet.HandlerInterceptor;
import java.util.Objects;


/**
 * @author mijiupro
 */

@Component
public class LoginInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        User user = UserHolder.getInfoByToken();

        if (Objects.isNull(user)) {
            response.setStatus(401);
            return false;
        }

        return true;
    }
}</code></pre> 
<h3></h3> 
<blockquote> 
 <p>å€¼å¾—æ³¨æ„ï¼šåœ¨ä¸Šä¸ªæ‹¦æˆªå™¨æˆ‘ä»¬æ˜¯åšè¿‡è§£ætokenäº†å¹¶å­˜åœ¨æœ¬åœ°çº¿ç¨‹é‡Œé¢ï¼Œæ‰€ä»¥åªéœ€è¦åˆ¤æ–­æœ¬åœ°çº¿ç¨‹æœ‰æ²¡æœ‰å³å¯ã€‚</p> 
</blockquote> 
<h3 id="2.%E5%88%9B%E5%BB%BA%E6%8B%A6%E6%88%AA%E5%99%A8%E9%93%BE%E9%85%8D%E7%BD%AE%E7%B1%BB">2.<strong>åˆ›å»ºæ‹¦æˆªå™¨é“¾é…ç½®ç±»</strong></h3> 
<p>åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œç”¨äºé…ç½®æ‹¦æˆªå™¨é“¾ã€‚åœ¨è¯¥é…ç½®ç±»ä¸­ï¼Œé€šè¿‡å®ç° <code>WebMvcConfigurer</code> æ¥å£æ¥æ·»åŠ æ‹¦æˆªå™¨ï¼Œå…·ä½“åŒ…æ‹¬ <code>addInterceptors</code> æ–¹æ³•ã€‚</p> 
<pre><code class="language-java">import com.mijiu.commom.interceptor.LoginInterceptor;
import com.mijiu.commom.interceptor.RefreshTokenInterceptor;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

/**
 * @author mijiupro
 */
@Configuration
public class WebConfig implements WebMvcConfigurer {
    private final RefreshTokenInterceptor refreshTokenInterceptor;

    private final LoginInterceptor loginInterceptor;

    public WebConfig(RefreshTokenInterceptor refreshTokenInterceptor, LoginInterceptor loginInterceptor) {
        this.refreshTokenInterceptor = refreshTokenInterceptor;
        this.loginInterceptor = loginInterceptor;
    }


    @Override
    public void addInterceptors( InterceptorRegistry registry) {
        registry.addInterceptor(refreshTokenInterceptor)
                .addPathPatterns("/**").order(0);//è®¾ç½®æ‹¦æˆªå™¨å¯¹æ‰€æœ‰è·¯å¾„ç”Ÿæ•ˆ,æ‰§è¡Œé¡ºåºä¸º0

        registry.addInterceptor(loginInterceptor)
                .excludePathPatterns("/captcha/graph-captcha")//æ’é™¤ç”¨æˆ·ç™»å½•è·å–éªŒè¯ç æ¥å£
                .excludePathPatterns("/","*/login","*.html","/images/**","/doc.html"
                        ,"/webjars/**","/swagger-resources","/swagger-resources/**","/v3/**")//æ’é™¤ç™»å½•è·å–é™æ€èµ„æºã€swaggeræ¥å£æ–‡æ¡£ç­‰ã€‚
                .order(1);//è®¾ç½®æ‹¦æˆªå™¨å¯¹æ‰€æœ‰è·¯å¾„ç”Ÿæ•ˆ,æ‰§è¡Œé¡ºåºä¸º1


    }

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**") // å¯¹æ‰€æœ‰è·¯å¾„ç”Ÿæ•ˆ
                .allowedOrigins("*") //å…è®¸æ‰€æœ‰æºåœ°å€
                .allowedMethods("GET", "POST", "PUT", "DELETE") // å…è®¸çš„è¯·æ±‚æ–¹æ³•
                .allowedHeaders("*"); // å…è®¸çš„è¯·æ±‚å¤´
    }
}</code></pre> 
<h3 id="3.%E9%85%8D%E7%BD%AE%E6%8B%A6%E6%88%AA%E5%99%A8%E9%93%BE%E9%A1%BA%E5%BA%8F"><strong>3.é…ç½®æ‹¦æˆªå™¨é“¾é¡ºåº</strong></h3> 
<p>åˆ·æ–°tokençš„æ‹¦æˆªå™¨è¦æœ€å…ˆæ‰§è¡Œï¼Œæ¥ç€æ‰æ˜¯è®¤è¯æ‹¦æˆªå™¨</p> 
<p><img alt="" height="79" src="https://images2.imgbox.com/91/76/EgBJxmRS_o.png" width="977"></p> 
<p><img alt="" height="203" src="https://images2.imgbox.com/3e/92/KcobadyR_o.png" width="1200"></p> 
<p></p> 
<h3 id="4.%E9%85%8D%E7%BD%AE%E6%8B%A6%E6%88%AA%E6%8E%92%E9%99%A4%E9%A1%B9"><strong>4.é…ç½®æ‹¦æˆªæ’é™¤é¡¹</strong></h3> 
<p>åƒç”¨æˆ·ç™»å½•çš„éªŒè¯ç æ¥å£ã€ç™»å½•æ¥å£ä»¥åŠåƒä¸€äº›é™æ€èµ„æºã€ç½‘é¡µã€å›¾ç‰‡ç­‰éœ€è¦è¿›è¡Œæ‹¦æˆªæ’é™¤ï¼Œå¦‚æœæ•´åˆäº†swaggeræ¥å£æ–‡æ¡£ä¹Ÿæ˜¯éœ€è¦æ’é™¤çš„ã€‚</p> 
<p><img alt="" height="111" src="https://images2.imgbox.com/73/ad/56usHbEu_o.png" width="1200"></p> 
<p></p> 
<h2 id="%E6%9C%80%E5%90%8E">æœ€å</h2> 
<p>tokenæ‹¦æˆªå™¨é“¾çš„è®¾è®¡ä¸å®ç°æ ¸å¿ƒå°±å››æ­¥ï¼š</p> 
<p><strong>1å®šä¹‰æ‹¦æˆªå™¨---&gt;2åˆ›å»ºæ‹¦æˆªå™¨é“¾é…ç½®ç±»---&gt;3é…ç½®æ‹¦æˆªå™¨é“¾é¡ºåº---&gt;4é…ç½®æ‹¦æˆªæ’é™¤é¡¹</strong></p> 
<p>å¸Œæœ›æœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ã€‚</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c89a3c7931f88f84e4b2245dffa28212/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">spring boot3è§£å†³è·¨åŸŸçš„å‡ ç§æ–¹å¼</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8c4a820ef9e7b2fa10bdff30a09f4946/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">springboot3ä½¿ç”¨è‡ªå®šä¹‰æ³¨è§£&#43;AOP&#43;redisä¼˜é›…å®ç°é˜²é‡å¤æäº¤</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>