<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SQL Server 跨库/服务器查询 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f4fc5205ee6a7bf6c239864cb646ede1/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="SQL Server 跨库/服务器查询">
  <meta property="og:description" content="这里写目录标题 1 SQL Server 跨库/服务器查询1.1 跨库查询1.2 跨服务器查询1.2.1 创建链接服务器1.2.2 跨库查询 1.3 拓展：SQL Server 中所有权和用户与架构的分离 1 SQL Server 跨库/服务器查询 1.1 跨库查询 在同一服务器下的跨库查询较为简单，示例
Database.DatabaseSchema.DatabaseObject # 示例 [SqlMatc] 数据库中，查询数据库[SQLATM]里的 DeptSales_copy 表里的所有数据 select * from [SQLATM].[dbo].[DeptSales_copy] 1.2 跨服务器查询 进行跨服务器查询前提是在本地服务器上创建链接服务器。
1.2.1 创建链接服务器 方法一：利用系统存储过程 sp_addlinkedserver
sp_addlinkedserver
创建链接服务器。 链接服务器提供对 OLE DB 数据源的分布式异类查询的访问权限。 使用 sp_addlinkedserver创建链接服务器后，可对此服务器运行分布式查询。 如果将链接服务器定义为 SQL Server 实例，则可以执行远程存储过程。
权限
语句 sp_addlinkedserver 需要 ALTER ANY LINKED SERVER 权限。 (“SQL Server Management Studio新建链接服务器”对话框的实现方式需要固定服务器角色的成员sysadmin身份。)
参数解读
sp_addlinkedserver [ @server = ] &#39;server&#39; -- 链接服务器的名称 [ , [ @srvproduct = ] &#39;product_name&#39; ] -- 链接服务器的 OLE DB 数据源的产品名 -- product_name值为 nvarchar (128) ， -- 默认值为 NULL。 -- 如果值为SQL Server，则无需指provider_name、 -- data_source、位置、provider_string和目录。 [ , [ @provider = ] &#39;provider_name&#39; ] -- 唯一编程标识符。建议使用 MSOLEDBSQL 而不是 SQLNCLI。 [ , [ @datasrc = ] &#39;data_source&#39; ] -- 目的服务器地址 [ , [ @location = ] &#39;location&#39; ] -- 本地登录 [ , [ @provstr = ] &#39;provider_string&#39; ] -- 标识唯一数据源的特定于 OLE DB 提供程序的连接字符串。 [ , [ @catalog = ] &#39;catalog&#39; ] -- 与 OLE DB 提供程序建立连接时要使用的目录。 链接示例：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-09-08T09:18:14+08:00">
    <meta property="article:modified_time" content="2023-09-08T09:18:14+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SQL Server 跨库/服务器查询</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>这里写目录标题</h4> 
 <ul><li><a href="#1_SQL_Server__1" rel="nofollow">1 SQL Server 跨库/服务器查询</a></li><li><ul><li><a href="#11__2" rel="nofollow">1.1 跨库查询</a></li><li><a href="#12__12" rel="nofollow">1.2 跨服务器查询</a></li><li><ul><li><a href="#121__16" rel="nofollow">1.2.1 创建链接服务器</a></li><li><a href="#122__186" rel="nofollow">1.2.2 跨库查询</a></li></ul> 
   </li><li><a href="#13_SQL_Server__193" rel="nofollow">1.3 拓展：SQL Server 中所有权和用户与架构的分离</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1_SQL_Server__1"></a>1 SQL Server 跨库/服务器查询</h2> 
<h3><a id="11__2"></a>1.1 跨库查询</h3> 
<p>在同一服务器下的跨库查询较为简单，示例</p> 
<pre><code class="prism language-sql"><span class="token keyword">Database</span><span class="token punctuation">.</span>DatabaseSchema<span class="token punctuation">.</span>DatabaseObject
<span class="token comment"># 示例 [SqlMatc] 数据库中，查询数据库[SQLATM]里的 DeptSales_copy 表里的所有数据</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">[</span>SQLATM<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>DeptSales_copy<span class="token punctuation">]</span>
</code></pre> 
<h3><a id="12__12"></a>1.2 跨服务器查询</h3> 
<p>进行跨服务器查询前提是在本地服务器上创建链接服务器。</p> 
<h4><a id="121__16"></a>1.2.1 创建链接服务器</h4> 
<p><strong>方法一：利用系统存储过程 sp_addlinkedserver</strong></p> 
<p><strong>sp_addlinkedserver</strong></p> 
<p>创建链接服务器。 链接服务器提供对 OLE DB 数据源的分布式异类查询的访问权限。 使用 <code>sp_addlinkedserver</code>创建链接服务器后，可对此服务器运行分布式查询。 如果将链接服务器定义为 SQL Server 实例，则可以执行远程存储过程。</p> 
<p><strong>权限</strong></p> 
<p>语句 <code>sp_addlinkedserver</code> 需要 <code>ALTER ANY LINKED SERVER</code> 权限。 (“SQL Server Management Studio<code>新建链接服务器</code>”对话框的实现方式需要固定服务器角色的成员<code>sysadmin</code>身份。)</p> 
<p><strong>参数解读</strong></p> 
<pre><code class="prism language-sql">sp_addlinkedserver <span class="token punctuation">[</span> <span class="token variable">@server</span> <span class="token operator">=</span> <span class="token punctuation">]</span> <span class="token string">'server'</span> 	<span class="token comment">-- 链接服务器的名称</span>
    <span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token variable">@srvproduct</span> <span class="token operator">=</span> <span class="token punctuation">]</span> <span class="token string">'product_name'</span> <span class="token punctuation">]</span>  <span class="token comment">-- 链接服务器的 OLE DB 数据源的产品名</span>
    										<span class="token comment">-- product_name值为 nvarchar (128) ，</span>
    										<span class="token comment">-- 默认值为 NULL。 </span>
    									 <span class="token comment">-- 如果值为SQL Server，则无需指provider_name、</span>
    									 <span class="token comment">-- data_source、位置、provider_string和目录。</span>
    										
    <span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token variable">@provider</span> <span class="token operator">=</span> <span class="token punctuation">]</span> <span class="token string">'provider_name'</span> <span class="token punctuation">]</span> 	<span class="token comment">-- 唯一编程标识符。建议使用 MSOLEDBSQL 而不是 SQLNCLI。</span>
    <span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token variable">@datasrc</span> <span class="token operator">=</span> <span class="token punctuation">]</span> <span class="token string">'data_source'</span> <span class="token punctuation">]</span> <span class="token comment">-- 目的服务器地址</span>
    <span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token variable">@location</span> <span class="token operator">=</span> <span class="token punctuation">]</span> <span class="token string">'location'</span> <span class="token punctuation">]</span>   <span class="token comment">-- 本地登录</span>
    <span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token variable">@provstr</span> <span class="token operator">=</span> <span class="token punctuation">]</span> <span class="token string">'provider_string'</span> <span class="token punctuation">]</span> <span class="token comment">-- 标识唯一数据源的特定于 OLE DB 提供程序的连接字符串。</span>
    <span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token punctuation">[</span> <span class="token variable">@catalog</span> <span class="token operator">=</span> <span class="token punctuation">]</span> <span class="token string">'catalog'</span> <span class="token punctuation">]</span> <span class="token comment">-- 与 OLE DB 提供程序建立连接时要使用的目录。</span>
    
</code></pre> 
<p>链接示例：</p> 
<pre><code class="prism language-sql"><span class="token keyword">if</span> <span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sys<span class="token punctuation">.</span>servers <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'LinkedServerName'</span><span class="token punctuation">)</span>
<span class="token keyword">begin</span>
	<span class="token comment">--删除运行本地与远程之间的用户映射</span>
	<span class="token keyword">execute</span> sys<span class="token punctuation">.</span>sp_droplinkedsrvlogin <span class="token variable">@rmtsrvname</span><span class="token operator">=</span><span class="token string">'LinkedServerName'</span><span class="token punctuation">,</span> <span class="token variable">@locallogin</span><span class="token operator">=</span><span class="token boolean">null</span>
	<span class="token comment">--删除链接服务器</span>
	<span class="token keyword">execute</span> sys<span class="token punctuation">.</span>sp_dropserver <span class="token variable">@server</span><span class="token operator">=</span><span class="token string">'LinkedServerName'</span><span class="token punctuation">,</span> <span class="token variable">@droplogins</span><span class="token operator">=</span><span class="token string">'droplogins'</span>
<span class="token keyword">end</span>
go

<span class="token keyword">EXEC</span> sp_addlinkedserver
     <span class="token variable">@server</span> <span class="token operator">=</span> <span class="token string">'LinkedServerName'</span>	<span class="token comment">-- 目的服务器别名</span>
    <span class="token punctuation">,</span><span class="token variable">@srvproduct</span> <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token punctuation">,</span><span class="token variable">@provider</span> <span class="token operator">=</span> <span class="token string">'MSOLEDBSQL'</span> 
    <span class="token punctuation">,</span><span class="token variable">@datasrc</span> <span class="token operator">=</span> <span class="token string">'192.168.3.21'</span> <span class="token comment">-- 目的服务器IP地址</span>
    <span class="token punctuation">,</span><span class="token variable">@location</span> <span class="token operator">=</span> <span class="token string">''</span>	<span class="token comment">-- 本地登录</span>
    <span class="token punctuation">,</span><span class="token variable">@provstr</span> <span class="token operator">=</span> <span class="token string">''</span> <span class="token comment">-- 标识唯一数据源的特定于 OLE DB 提供程序的连接字符串。</span>
    <span class="token comment">--@catalog = '';	-- 指定目录 默认值为 NULL</span>

<span class="token comment">-- 将凭据和选项添加到此链接服务器。</span>
<span class="token keyword">EXEC</span> sp_addlinkedsrvlogin
	 <span class="token variable">@rmtsrvname</span> <span class="token operator">=</span> <span class="token string">'LinkedServerName'</span>
	<span class="token punctuation">,</span><span class="token variable">@useself</span> <span class="token operator">=</span> <span class="token string">'false'</span>	<span class="token comment">-- 是否通过模拟登录 or 显示的提交登录名和密码链接到远程服务器</span>
	<span class="token punctuation">,</span><span class="token variable">@rmtuser</span> <span class="token operator">=</span> <span class="token string">'sa'</span>	<span class="token comment">-- 登录名</span>
	<span class="token punctuation">,</span><span class="token variable">@rmtpassword</span> <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">;</span>	<span class="token comment">-- 密码</span>

<span class="token keyword">EXEC</span> sp_serveroption <span class="token string">'LinkedServerName'</span><span class="token punctuation">,</span> <span class="token string">'rpc'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">;</span>	<span class="token comment">-- 从指定的服务器启用远程过程调用 (RPC)</span>
<span class="token keyword">EXEC</span> sp_serveroption <span class="token string">'LinkedServerName'</span><span class="token punctuation">,</span> <span class="token string">'rpc out'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">;</span>	<span class="token comment">-- 对指定的服务器启用 RPC。</span>

<span class="token comment">-- 查询示例 select * from Server.Database.DatabaseSchema.DatabaseObject</span>
<span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> <span class="token punctuation">[</span>LinkedServerName<span class="token punctuation">]</span><span class="token punctuation">.</span>master<span class="token punctuation">.</span>sys<span class="token punctuation">.</span><span class="token keyword">databases</span><span class="token punctuation">;</span>  
</code></pre> 
<p><strong>此处将链接SQL Server服务器封装成了名为RemoteConnectionServer的存储过程方便使用</strong></p> 
<p>在此存储过程中需要提供四个参数，目的服务器别名（见名知义）、目的服务器IP、目的服务器登录名以及密码。即可创建一个服务器链接。（<strong>注意此存储过程只创建了一个简单的链接服务器，设置了必要的链接参数，使用时请确保参数够用。</strong>）</p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">proc</span> RemoteConnectionServer
	<span class="token variable">@LinkedServerName</span> nvarchar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>	<span class="token comment">-- 目的服务器别名</span>
	<span class="token punctuation">,</span><span class="token variable">@LinkedServerIP</span> nvarchar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token comment">-- 目的服务器IP地址</span>
	<span class="token punctuation">,</span><span class="token variable">@userName</span> nvarchar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>	<span class="token comment">-- 登录名</span>
	<span class="token punctuation">,</span><span class="token variable">@password</span> nvarchar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>	<span class="token comment">-- 密码</span>
<span class="token keyword">as</span>
	<span class="token comment">-- 查找链接服务器是否已创建，若创建则删除</span>
	<span class="token keyword">if</span> <span class="token keyword">exists</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sys<span class="token punctuation">.</span>servers <span class="token keyword">where</span> name<span class="token operator">=</span> <span class="token variable">@LinkedServerName</span><span class="token punctuation">)</span>
	<span class="token keyword">begin</span>
		<span class="token comment">-- 删除运行本地与远程之间的用户映射</span>
		<span class="token keyword">execute</span> sys<span class="token punctuation">.</span>sp_droplinkedsrvlogin <span class="token variable">@rmtsrvname</span><span class="token operator">=</span> <span class="token variable">@LinkedServerName</span><span class="token punctuation">,</span> <span class="token variable">@locallogin</span><span class="token operator">=</span><span class="token boolean">null</span>
		<span class="token comment">--删除链接服务器</span>
		<span class="token keyword">execute</span> sys<span class="token punctuation">.</span>sp_dropserver <span class="token variable">@server</span><span class="token operator">=</span><span class="token variable">@LinkedServerName</span><span class="token punctuation">,</span> <span class="token variable">@droplogins</span><span class="token operator">=</span><span class="token string">'droplogins'</span>
	<span class="token keyword">end</span>

	<span class="token comment">-- 创建链接服务器 </span>
	<span class="token keyword">exec</span> sp_addlinkedserver
		 <span class="token variable">@server</span> <span class="token operator">=</span> <span class="token variable">@LinkedServerName</span>	<span class="token comment">-- 目的服务器别名</span>
		<span class="token punctuation">,</span><span class="token variable">@srvproduct</span> <span class="token operator">=</span> <span class="token string">''</span>
		<span class="token punctuation">,</span><span class="token variable">@provider</span> <span class="token operator">=</span> <span class="token string">'MSOLEDBSQL'</span> 
		<span class="token punctuation">,</span><span class="token variable">@datasrc</span> <span class="token operator">=</span> <span class="token variable">@LinkedServerIP</span> <span class="token comment">-- 目的服务器IP地址</span>
		<span class="token punctuation">,</span><span class="token variable">@location</span> <span class="token operator">=</span> <span class="token string">''</span>	<span class="token comment">-- 本地登录</span>
		<span class="token punctuation">,</span><span class="token variable">@provstr</span> <span class="token operator">=</span> <span class="token string">''</span> <span class="token comment">-- 标识唯一数据源的特定于 OLE DB 提供程序的连接字符串。</span>
		<span class="token comment">--@catalog = '';	-- 指定目录 默认值为 NULL</span>

	<span class="token comment">-- 将凭据和选项添加到此链接服务器。</span>
	<span class="token keyword">exec</span> sp_addlinkedsrvlogin
		 <span class="token variable">@rmtsrvname</span> <span class="token operator">=</span> <span class="token variable">@LinkedServerName</span>
		<span class="token punctuation">,</span><span class="token variable">@useself</span> <span class="token operator">=</span> <span class="token string">'false'</span>	<span class="token comment">-- 是否通过模拟登录 or 显示的提交登录名和密码链接到远程服务器</span>
		<span class="token punctuation">,</span><span class="token variable">@rmtuser</span> <span class="token operator">=</span> <span class="token variable">@userName</span>	<span class="token comment">-- 登录名</span>
		<span class="token punctuation">,</span><span class="token variable">@rmtpassword</span> <span class="token operator">=</span> <span class="token variable">@password</span><span class="token punctuation">;</span>	<span class="token comment">-- 密码</span>

	<span class="token comment">-- 设置服务器选项</span>
	<span class="token keyword">exec</span> sp_serveroption <span class="token variable">@LinkedServerName</span><span class="token punctuation">,</span> <span class="token string">'rpc'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">;</span>	<span class="token comment">-- 从指定的服务器启用远程过程调用 (RPC)</span>
	<span class="token keyword">exec</span> sp_serveroption <span class="token variable">@LinkedServerName</span><span class="token punctuation">,</span> <span class="token string">'rpc out'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">;</span>	<span class="token comment">-- 对指定的服务器启用 RPC。</span>

go
</code></pre> 
<p>执行存储过程</p> 
<pre><code class="prism language-sql"><span class="token keyword">declare</span>	<span class="token variable">@LinkedServerName</span> nvarchar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>	<span class="token operator">=</span> <span class="token string">'linkName'</span>
<span class="token keyword">declare</span>	<span class="token variable">@LinkedServerIP</span> nvarchar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">'192.168.3.21'</span>
<span class="token keyword">declare</span>	<span class="token variable">@userName</span> nvarchar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>	<span class="token operator">=</span> <span class="token string">'sa'</span>
<span class="token keyword">declare</span>	<span class="token variable">@password</span> nvarchar<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>	<span class="token operator">=</span> <span class="token string">'****'</span>
<span class="token comment">-- 执行</span>
<span class="token keyword">exec</span> RemoteConnectionServer <span class="token variable">@LinkedServerName</span><span class="token punctuation">,</span> <span class="token variable">@LinkedServerIP</span><span class="token punctuation">,</span> <span class="token variable">@userName</span><span class="token punctuation">,</span> <span class="token variable">@password</span>

<span class="token comment">-- 测试</span>
<span class="token keyword">SELECT</span> name <span class="token keyword">FROM</span> linkName<span class="token punctuation">.</span>master<span class="token punctuation">.</span>sys<span class="token punctuation">.</span><span class="token keyword">databases</span><span class="token punctuation">;</span>  
</code></pre> 
<p><strong>方法二：利用SSMS创建链接服务器</strong></p> 
<p>下面以链接192.168.2.21 SQL Server 服务器为例：</p> 
<p>1 打开SSMS链接到本地服务器</p> 
<p>2 选择服务器对象–&gt;链接服务器<br> <img src="https://images2.imgbox.com/07/92/QtrsSIgx_o.png" alt="在这里插入图片描述"></p> 
<p>3 链接服务器 右键 新建链接服务器 常规页</p> 
<p>PS：如果勾选服务器类型为"SQL Server"，则此处’‘链接服务器’'名必须为IP 地址。若选择"其他数据源"，此处的链接服务器名作为映射存在（别名）, 在数据源处填写IP地址。</p> 
<p>当然你也可以选择其他数据源去链接 SQL Server 服务器。</p> 
<p><img src="https://images2.imgbox.com/b9/ed/bdMUPr4A_o.png" alt=""></p> 
<p>4 选择“安全性”页<br> <img src="https://images2.imgbox.com/28/f5/9PpOGD8h_o.png" alt="在这里插入图片描述"></p> 
<p>5 选择 “服务器选项” 将 RPC 与 RPC Out 设置为True，默认为False。</p> 
<ul><li><strong>RPC</strong><br> 从指定的服务器启用远程过程调用 (RPC)。</li><li><strong>RPC Out</strong><br> 对指定的服务器启用 RPC。<br> <img src="https://images2.imgbox.com/6e/1c/CX3n0koF_o.png" alt="在这里插入图片描述"></li></ul> 
<p>6 点击 “确定”，此时链接服务器目录下会出现你创建的连接服务器。</p> 
<p>7 右键 测试链接<br> <img src="https://images2.imgbox.com/0a/88/FbYuXp2i_o.png" alt="在这里插入图片描述"></p> 
<p>successs！<br> <img src="https://images2.imgbox.com/3a/3f/hLTGmFXY_o.png" alt="在这里插入图片描述"></p> 
<p>参考链接01：<a href="https://learn.microsoft.com/zh-cn/sql/relational-databases/system-stored-procedures/sp-addlinkedserver-transact-sql?view=sql-server-ver16" rel="nofollow">sp_addlinkedserver (Transact-SQL) - SQL Server | Microsoft Learn</a></p> 
<p>参考链接02：<a href="https://learn.microsoft.com/zh-cn/sql/relational-databases/linked-servers/create-linked-servers-sql-server-database-engine?view=sql-server-ver16" rel="nofollow">创建链接服务器 - SQL Server | Microsoft Learn</a></p> 
<h4><a id="122__186"></a>1.2.2 跨库查询</h4> 
<pre><code class="prism language-sql"><span class="token comment">-- 查询示例 select * from Server.Database.DatabaseSchema.DatabaseObject</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">[</span><span class="token number">192.168</span><span class="token number">.3</span><span class="token number">.21</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>GZ<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>Dept<span class="token punctuation">]</span>
</code></pre> 
<h3><a id="13_SQL_Server__193"></a>1.3 拓展：SQL Server 中所有权和用户与架构的分离</h3> 
<p>SQL Server 安全性的核心概念是对象的所有者具有管理这些对象的不可撤消的权限。 你不能删除对象所有者的特权，并且如果用户在数据库中拥有对象，你也不能将用户从此数据库中删除。</p> 
<p><strong>用户架构分离</strong></p> 
<p>通过用户架构分离，可实现管理数据库对象权限的更大灵活性。 架构是一个适用于数据库对象的命名容器，它使你能够将对象分组到单独的命名空间中。</p> 
<p>用于引用对象的由四部分组成的命名语法指定架构名称。</p> 
<pre><code class="prism language-sql">Server<span class="token punctuation">.</span><span class="token keyword">Database</span><span class="token punctuation">.</span>DatabaseSchema<span class="token punctuation">.</span>DatabaseObject
</code></pre> 
<p><strong>架构所有者和权限</strong></p> 
<p>任何数据库<a href="https://learn.microsoft.com/zh-cn/sql/relational-databases/security/authentication-access/principals-database-engine?view=sql-server-ver16" rel="nofollow">主体</a>都可以拥有架构，并且一个主体可拥有多个架构。 您可以对架构应用安全规则，安全规则将由架构中的所有对象继承。 如果设置了对架构的访问权限，则当新对象添加到架构时，新对象会自动应用这些权限。 可以为用户分配一个默认的架构，且多个数据库用户可以共享同一架构。</p> 
<p>默认情况下，当开发人员在架构中创建对象时，该对象由拥有架构的安全主体而不是开发人员拥有。 可以使用 <a href="https://learn.microsoft.com/zh-cn/sql/t-sql/statements/alter-authorization-transact-sql?view=sql-server-ver16" rel="nofollow">ALTER AUTHORIZATION Transact-SQL</a> 语句转移对象所有权。 尽管架构还可以包含由不同用户拥有的对象并且这些对象具有比分配给架构的权限更加细化的权限，但因为架构会增大管理权限的复杂度，因此不建议使用。 对象可以在架构之间移动，架构所有权也可以在主体之间转移。 可以在不影响架构的情况下删除数据库用户。</p> 
<p><strong>实现后向兼容性的内置架构</strong></p> 
<p>SQL Server 随附 9 个预定义架构，这些架构的名称与内置数据库用户和角色的名称相同：db_accessadmin、db_backupoperator、db_datareader、db_datawriter、db_ddladmin、db_denydatareader、db_denydatawriter、db_owner 和 db_securityadmin。 这些架构用于实现后向兼容性。 建议不要将它们用于用户对象。 可以删除与固定数据库角色同名的架构 - 除非它们已被使用，在这种情况下，drop-command 仅返回错误并阻止删除已使用的架构。 例如：</p> 
<pre><code class="prism language-sql"><span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> sys<span class="token punctuation">.</span>schemas <span class="token keyword">WHERE</span> name <span class="token operator">=</span> N<span class="token string">'db_accessadmin'</span><span class="token punctuation">)</span>
<span class="token keyword">DROP</span> <span class="token keyword">SCHEMA</span> <span class="token punctuation">[</span>db_accessadmin<span class="token punctuation">]</span>
GO

<span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> sys<span class="token punctuation">.</span>schemas <span class="token keyword">WHERE</span> name <span class="token operator">=</span> N<span class="token string">'db_backupoperator'</span><span class="token punctuation">)</span>
<span class="token keyword">DROP</span> <span class="token keyword">SCHEMA</span> <span class="token punctuation">[</span>db_backupoperator<span class="token punctuation">]</span>
</code></pre> 
<p>如果从模型数据库中删除这些架构，它们将不会显示在新数据库中。 不能删除包含对象的架构。</p> 
<p>无法删除以下架构：</p> 
<ul><li><code>dbo</code></li><li><code>guest</code></li><li><code>sys</code></li><li><code>INFORMATION_SCHEMA</code></li></ul> 
<p><code>sys</code> 和 <code>INFORMATION_SCHEMA</code> 架构是为系统对象而保留的。 您不能在这些架构中创建对象，而且不能删除它们。</p> 
<p><strong>dbo 架构</strong></p> 
<p><code>dbo</code> 架构是每个数据库的默认架构。 默认情况下，使用 CREATE USER Transact-SQL 命令创建的用户的默认架构为 <code>dbo</code>。 <code>dbo</code> 架构由 <code>dbo</code> 用户帐户拥有。</p> 
<p>默认架构被分配为 <code>dbo</code> 的用户不会继承 <code>dbo</code> 用户帐户的权限。 用户不从架构继承权限；架构权限由架构中包含的数据库对象继承。 用户的默认架构仅用于对象引用，以防用户在查询对象时省略架构。</p> 
<p>当使用部分名称来引用数据库对象时，SQL Server 首先在用户的默认架构中查找。 如果在此处未找到该对象，则 SQL Server 其次将在 <code>dbo</code> 架构中查找。 如果对象不在 <code>dbo</code> 架构中，则会返回一个错误。</p> 
<p>参考链接：<a href="https://learn.microsoft.com/zh-cn/sql/relational-databases/security/authentication-access/ownership-and-user-schema-separation?view=sql-server-ver16" rel="nofollow">SQL Server 中所有权和用户与架构的分离 - SQL Server | Microsoft Learn</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ff91cad7558cf30bcde0f87aab117256/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">浅析目标检测入门算法：YOLOv1,SSD,YOLOv2,YOLOv3,CenterNet,EfficientDet,YOLOv4</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f4b752180ba07c17ef7932444fc1b67e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android HID设备（键盘、遥控等）功能实现流程及键值映射关系</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>