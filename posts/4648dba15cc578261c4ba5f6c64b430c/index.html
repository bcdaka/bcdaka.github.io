<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>《Windows API每日一练》5.4 键盘消息和字符集 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/4648dba15cc578261c4ba5f6c64b430c/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="《Windows API每日一练》5.4 键盘消息和字符集">
  <meta property="og:description" content="本节我们将通过实例来说明不同国家的语言、字符集和字体之间的差异，以及Windows系统是如何处理的。
本节必须掌握的知识点：
第31练：显示键盘消息
非英语键盘问题
字符集和字体
第32练：显示默认字体信息
第33练：创建逻辑字体
5.4.1 第31练：显示键盘消息 /*------------------------------------------------------------------
031 WIN32 API 每日一练
第31个例子：显示键盘按键消息
SetBkMode函数
GetKeyNameText函数
ScrollWindow函数
(c) www.bcdaren.com, 2020
----------------------------------------------------------------*/
#include &lt;windows.h&gt;
LRESULT CALLBACK WndProc (HWND, UINT, WPARAM, LPARAM) ; int WINAPI WinMain (HINSTANCE hInstance, HINSTANCE hPrevInstance, PSTR szCmdLine, int iCmdShow) { static TCHAR szAppName[] = TEXT (&#34;KEYVIEW1.C&#34;) ; …(略)
return msg.wParam ; } //窗口过程
LRESULT CALLBACK WndProc(HWND hwnd, UINT message, WPARAM wParam, LPARAM lParam)
{
static int cxClientMax, cyClientMax, cxClient, cyClient, cxChar, cyChar;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-24T06:01:33+08:00">
    <meta property="article:modified_time" content="2024-06-24T06:01:33+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">《Windows API每日一练》5.4 键盘消息和字符集</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0;text-align:justify;">本节我们将通过实例来说明不同国家的语言、字符集和字体之间的差异，以及Windows系统是如何处理的。</p> 
<p style="margin-left:0;text-align:justify;"><strong>本节必须掌握的知识点：</strong></p> 
<p style="margin-left:0;text-align:justify;"><strong>        </strong><strong>第31</strong><strong>练：显示键盘消息</strong></p> 
<p style="margin-left:0;text-align:justify;"><strong>        </strong><strong>非英语键盘问题</strong></p> 
<p style="margin-left:0;text-align:justify;"><strong>        </strong><strong>字符集和字体</strong></p> 
<p style="margin-left:0;text-align:justify;"><strong>        </strong><strong>第32</strong><strong>练：显示默认字体信息</strong></p> 
<p style="margin-left:0;text-align:justify;"><strong>        </strong><strong>第33</strong><strong>练：创建逻辑字体</strong></p> 
<h5 style="margin-left:0;text-align:justify;"><strong><a name="_Toc158796795">5.4.1 第31练：显示键盘消息</a></strong></h5> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">/*------------------------------------------------------------------</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">031  WIN32 API </span><span style="color:#008000;">每日一练</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#008000;">第31个例子：显示键盘按键消息</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">     SetBkMode</span><span style="color:#008000;">函数</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">     GetKeyNameText</span><span style="color:#008000;">函数</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">     ScrollWindow</span><span style="color:#008000;">函数</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">(c) www.bcdaren.com, 2020</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">----------------------------------------------------------------*/</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#808080;">#include</span> <span style="color:#a31515;">&lt;windows.h&gt;</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><em><span style="color:#0000ff;">LRESULT</span></em> <em><span style="color:#a000a0;">CALLBACK</span></em> <span style="color:#880000;">WndProc</span><span style="color:#000000;"> (</span><em><span style="color:#0000ff;">HWND</span></em><span style="color:#000000;">, </span><em><span style="color:#0000ff;">UINT</span></em><span style="color:#000000;">, </span><em><span style="color:#0000ff;">WPARAM</span></em><span style="color:#000000;">, </span><em><span style="color:#0000ff;">LPARAM</span></em><span style="color:#000000;">) ; </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">int</span> <em><span style="color:#a000a0;">WINAPI</span></em> <em><span style="color:#880000;">WinMain</span></em><span style="color:#000000;"> (</span><em><span style="color:#0000ff;">HINSTANCE</span></em> <span style="color:#000080;">hInstance</span><span style="color:#000000;">, </span><em><span style="color:#0000ff;">HINSTANCE</span></em> <span style="color:#000080;">hPrevInstance</span><span style="color:#000000;">, </span></p> 
<p style="margin-left:0;text-align:left;"> <em><span style="color:#0000ff;">PSTR</span></em> <span style="color:#000080;">szCmdLine</span><span style="color:#000000;">, </span><span style="color:#0000ff;">int</span> <span style="color:#000080;">iCmdShow</span><span style="color:#000000;">) </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">{ </span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em> <span style="color:#000080;">szAppName</span><span style="color:#000000;">[] = </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;"> (</span><span style="color:#a31515;">"KEYVIEW1.C"</span><span style="color:#000000;">) ; </span></p> 
<p style="margin-left:0;text-align:left;"><em>    </em><span style="color:#0000ff;">…</span><span style="color:#0000ff;">(</span><span style="color:#0000ff;">略)</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">return</span> <span style="color:#000080;">msg</span><span style="color:#000000;">.</span><span style="color:#000080;">wParam</span><span style="color:#000000;"> ; </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">} </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">窗口过程</span></p> 
<p style="margin-left:0;text-align:left;"><em><span style="color:#0000ff;">LRESULT</span></em> <em><span style="color:#a000a0;">CALLBACK</span></em> <span style="color:#880000;">WndProc</span><span style="color:#000000;">(</span><em><span style="color:#0000ff;">HWND</span></em> <span style="color:#000080;">hwnd</span><span style="color:#000000;">, </span><em><span style="color:#0000ff;">UINT</span></em> <span style="color:#000080;">message</span><span style="color:#000000;">, </span><em><span style="color:#0000ff;">WPARAM</span></em> <span style="color:#000080;">wParam</span><span style="color:#000000;">, </span><em><span style="color:#0000ff;">LPARAM</span></em> <span style="color:#000080;">lParam</span><span style="color:#000000;">)</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">{<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> <span style="color:#000080;">cxClientMax</span><span style="color:#000000;">, </span><span style="color:#000080;">cyClientMax</span><span style="color:#000000;">, </span><span style="color:#000080;">cxClient</span><span style="color:#000000;">, </span><span style="color:#000080;">cyClient</span><span style="color:#000000;">, </span><span style="color:#000080;">cxChar</span><span style="color:#000000;">, </span><span style="color:#000080;">cyChar</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> <span style="color:#000080;">cLinesMax</span><span style="color:#000000;">, </span><span style="color:#000080;">cLines</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">    <em><span style="color:#0000ff;">TEXTMETRIC</span></em> <span style="color:#000080;">tm</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">RECT</span></em>  <span style="color:#000080;">rectScroll</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">PMSG</span></em> <span style="color:#000080;">pmsg</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">    <em><span style="color:#0000ff;">HDC</span></em>         <span style="color:#000080;">hdc</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">    <em><span style="color:#0000ff;">PAINTSTRUCT</span></em> <span style="color:#000080;">ps</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em>  <span style="color:#000080;">szTop</span><span style="color:#000000;">[] = </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"Message        Key       Char     Repeat Scan Ext ALT Prev Tran"</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em>  <span style="color:#000080;">szUnd</span><span style="color:#000000;">[] = </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"_______        ___       ____     ______ ____ ___ ___ ____ ____"</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;">* </span><span style="color:#000080;">szFormat</span><span style="color:#000000;">[2] = {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"%-13s %3d %-15s%c%6u %4d %3s %3s %4s %4s"</span><span style="color:#000000;">),</span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"%-13s            0X%04X%1s%c %6u %4d %3s %3s %4s %4s"</span><span style="color:#000000;">) };</span></p> 
<p style="margin-left:0;text-align:left;">    <em><span style="color:#0000ff;">TCHAR</span></em> <span style="color:#000080;">szBuf</span><span style="color:#000000;">[128], </span><span style="color:#000080;">szKeyName</span><span style="color:#000000;">[32];</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;">* </span><span style="color:#000080;">szMessage</span><span style="color:#000000;">[] = {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"WM_KEYDOWN"</span><span style="color:#000000;">), </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"WM_KEYUP"</span><span style="color:#000000;">),</span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"WM_CHAR"</span><span style="color:#000000;">), </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"WM_DEADCHAR"</span><span style="color:#000000;">),</span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"WM_SYSKEYDOWN"</span><span style="color:#000000;">), </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"WM_SYSKEYUP"</span><span style="color:#000000;">),</span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"WM_SYSCHAR"</span><span style="color:#000000;">), </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"WM_SYSDEADCHAR"</span><span style="color:#000000;">) };</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">int</span> <span style="color:#000080;">iType</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;">* </span><span style="color:#000080;">szYes</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"Yes"</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;">* </span><span style="color:#000080;">szNo</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"No"</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;">* </span><span style="color:#000080;">szDown</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"Down"</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;">* </span><span style="color:#000080;">szUp</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"Up"</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">switch</span><span style="color:#000000;"> (</span><span style="color:#000080;">message</span><span style="color:#000000;">)</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_CREATE</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_DISPLAYCHANGE</span></em><span style="color:#000000;">:</span><span style="color:#008000;">//</span><span style="color:#008000;">显示器分辨率改变时，此消息仅发送到顶级窗口</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#008000;">//</span><span style="color:#008000;">获得最大的客户区</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">cxClientMax</span><span style="color:#000000;"> = </span><em><span style="color:#880000;">GetSystemMetrics</span></em><span style="color:#000000;">(</span><em><span style="color:#a000a0;">SM_CXMAXIMIZED</span></em><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">cyClientMax</span><span style="color:#000000;"> = </span><em><span style="color:#880000;">GetSystemMetrics</span></em><span style="color:#000000;">(</span><em><span style="color:#a000a0;">SM_CYMAXIMIZED</span></em><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#008000;">//</span><span style="color:#008000;">获得等宽字体的大小</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">hdc</span><span style="color:#000000;"> = </span><em><span style="color:#880000;">GetDC</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#880000;">SelectObject</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, </span><em><span style="color:#880000;">GetStockObject</span></em><span style="color:#000000;">(</span><em><span style="color:#a000a0;">SYSTEM_FIXED_FONT</span></em><span style="color:#000000;">));</span><span style="color:#008000;">//</span><span style="color:#008000;">选入系统等宽字体</span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#880000;">GetTextMetrics</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, &amp;</span><span style="color:#000080;">tm</span><span style="color:#000000;">);</span><span style="color:#008000;">//</span><span style="color:#008000;">检索字体文本的度量信息</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">cxChar</span><span style="color:#000000;"> = </span><span style="color:#000080;">tm</span><span style="color:#000000;">.</span><em><span style="color:#000080;">tmAveCharWidth</span></em><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">cyChar</span><span style="color:#000000;"> = </span><span style="color:#000080;">tm</span><span style="color:#000000;">.</span><em><span style="color:#000080;">tmHeight</span></em><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#880000;">ReleaseDC</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">, </span><span style="color:#000080;">hdc</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#008000;">//</span><span style="color:#008000;">为消息数组分配内存</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#0000ff;">if</span><span style="color:#000000;"> (</span><span style="color:#000080;">pmsg</span><span style="color:#000000;">) </span><em><span style="color:#a000a0;">free</span></em><span style="color:#000000;">(</span><span style="color:#000080;">pmsg</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">cLinesMax</span><span style="color:#000000;"> = </span><span style="color:#000080;">cyClientMax</span><span style="color:#000000;"> / </span><span style="color:#000080;">cyChar</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">pmsg</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">malloc</span></em><span style="color:#000000;">(</span><span style="color:#000080;">cLinesMax</span><span style="color:#000000;">* </span><span style="color:#0000ff;">sizeof</span><span style="color:#000000;">(</span><em><span style="color:#0000ff;">MSG</span></em><span style="color:#000000;">));</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">cLines</span><span style="color:#000000;"> = 0;</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#008000;">//return 0 ;  //</span><span style="color:#008000;">继续执行WM_SIZE</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_SIZE</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">cxClient</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">LOWORD</span></em><span style="color:#000000;">(</span><span style="color:#000080;">lParam</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">cyClient</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">HIWORD</span></em><span style="color:#000000;">(</span><span style="color:#000080;">lParam</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#008000;">//</span><span style="color:#008000;">计算滚动窗口的范围</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">rectScroll</span><span style="color:#000000;">.</span><em><span style="color:#000080;">top</span></em><span style="color:#000000;"> = </span><span style="color:#000080;">cyChar</span><span style="color:#000000;">; </span><span style="color:#008000;">//</span><span style="color:#008000;">第二行开始（因第1行为标题）</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">rectScroll</span><span style="color:#000000;">.</span><em><span style="color:#880000;">left</span></em><span style="color:#000000;"> = 0;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">不等于cyClient，应等于每行高度*行数。</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">rectScroll</span><span style="color:#000000;">.</span><em><span style="color:#000080;">bottom</span></em><span style="color:#000000;"> = </span><span style="color:#000080;">cyChar</span><span style="color:#000000;">*(</span><span style="color:#000080;">cyClient</span><span style="color:#000000;"> / </span><span style="color:#000080;">cyChar</span><span style="color:#000000;">); </span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">rectScroll</span><span style="color:#000000;">.</span><em><span style="color:#880000;">right</span></em><span style="color:#000000;"> = </span><span style="color:#000080;">cxClient</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#008000;">//</span><span style="color:#008000;">重绘，该行不可删除，可能是WM_INPUTLANGCHANGE或WM_DISPLAYCHANGE引起</span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#880000;">InvalidateRect</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">, </span><em><span style="color:#a000a0;">NULL</span></em><span style="color:#000000;">, </span><em><span style="color:#a000a0;">TRUE</span></em><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#0000ff;">return</span><span style="color:#000000;"> 0;</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_KEYDOWN</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_KEYUP</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_CHAR</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_DEADCHAR</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_SYSKEYDOWN</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_SYSKEYUP</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_SYSCHAR</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_SYSDEADCHAR</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#008000;">//</span><span style="color:#008000;">重新安排消息数组</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#0000ff;">for</span><span style="color:#000000;"> (</span><span style="color:#0000ff;">int</span> <span style="color:#000080;">i</span><span style="color:#000000;"> = </span><span style="color:#000080;">cLinesMax</span><span style="color:#000000;"> - 1; </span><span style="color:#000080;">i</span><span style="color:#000000;"> &gt; 0; </span><span style="color:#000080;">i</span><span style="color:#000000;">--)</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">        {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">            <span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">] = </span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;"> - 1];</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">        }</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#008000;">//</span><span style="color:#008000;">把当前消息存入消息数组的首元素</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">pmsg</span><span style="color:#000000;">[0].</span><span style="color:#000080;">message</span><span style="color:#000000;"> = </span><span style="color:#000080;">message</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">pmsg</span><span style="color:#000000;">[0].</span><span style="color:#000080;">hwnd</span><span style="color:#000000;"> = </span><span style="color:#000080;">hwnd</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">pmsg</span><span style="color:#000000;">[0].</span><span style="color:#000080;">wParam</span><span style="color:#000000;"> = </span><span style="color:#000080;">wParam</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">pmsg</span><span style="color:#000000;">[0].</span><span style="color:#000080;">lParam</span><span style="color:#000000;"> = </span><span style="color:#000080;">lParam</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">cLines</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">min</span></em><span style="color:#000000;">(</span><span style="color:#000080;">cLines</span><span style="color:#000000;"> + 1, </span><span style="color:#000080;">cLinesMax</span><span style="color:#000000;">); </span><span style="color:#008000;">//</span><span style="color:#008000;">每按一个按键，增加一行。</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#008000;">//</span><span style="color:#008000;">滚屏</span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#880000;">ScrollWindow</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">, 0, -</span><span style="color:#000080;">cyChar</span><span style="color:#000000;">, &amp;</span><span style="color:#000080;">rectScroll</span><span style="color:#000000;">, &amp;</span><span style="color:#000080;">rectScroll</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#008000;">//return 0;  //</span><span style="color:#008000;">不直接return，因为系统击键消息还要调用DefWindowProc处理</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_PAINT</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">hdc</span><span style="color:#000000;"> = </span><em><span style="color:#880000;">BeginPaint</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">, &amp;</span><span style="color:#000080;">ps</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#880000;">SelectObject</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, </span><em><span style="color:#880000;">GetStockObject</span></em><span style="color:#000000;">(</span><em><span style="color:#a000a0;">SYSTEM_FIXED_FONT</span></em><span style="color:#000000;">));</span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#880000;">SetBkMode</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, </span><em><span style="color:#a000a0;">TRANSPARENT</span></em><span style="color:#000000;">);</span><span style="color:#008000;">//</span><span style="color:#008000;">背景模式---透明模式</span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#880000;">TextOut</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, 0, 0, </span><span style="color:#000080;">szTop</span><span style="color:#000000;">, </span><em><span style="color:#880000;">lstrlen</span></em><span style="color:#000000;">(</span><span style="color:#000080;">szTop</span><span style="color:#000000;">));</span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#880000;">TextOut</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, 0, 0, </span><span style="color:#000080;">szUnd</span><span style="color:#000000;">, </span><em><span style="color:#880000;">lstrlen</span></em><span style="color:#000000;">(</span><span style="color:#000080;">szUnd</span><span style="color:#000000;">));</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#008000;">//</span><span style="color:#008000;">显示消息数组的内容</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#0000ff;">for</span><span style="color:#000000;"> (</span><span style="color:#0000ff;">int</span> <span style="color:#000080;">i</span><span style="color:#000000;"> = 0; </span><span style="color:#000080;">i</span><span style="color:#000000;"> &lt; </span><em><span style="color:#a000a0;">min</span></em><span style="color:#000000;">(</span><span style="color:#000080;">cLines</span><span style="color:#000000;">, </span><span style="color:#000080;">cyClient</span><span style="color:#000000;"> / </span><span style="color:#000080;">cyChar</span><span style="color:#000000;"> - 1); </span><span style="color:#000080;">i</span><span style="color:#000000;">++)</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">        {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">            <span style="color:#000080;">iType</span><span style="color:#000000;"> = </span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><span style="color:#000080;">message</span><span style="color:#000000;"> == </span><em><span style="color:#a000a0;">WM_CHAR</span></em><span style="color:#000000;"> ||</span></p> 
<p style="margin-left:0;text-align:left;">                <span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><span style="color:#000080;">message</span><span style="color:#000000;"> == </span><em><span style="color:#a000a0;">WM_SYSCHAR</span></em><span style="color:#000000;"> ||</span></p> 
<p style="margin-left:0;text-align:left;">                <span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><span style="color:#000080;">message</span><span style="color:#000000;"> == </span><em><span style="color:#a000a0;">WM_DEADCHAR</span></em><span style="color:#000000;"> ||</span></p> 
<p style="margin-left:0;text-align:left;">                <span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><span style="color:#000080;">message</span><span style="color:#000000;"> == </span><em><span style="color:#a000a0;">WM_SYSDEADCHAR</span></em><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">            <span style="color:#008000;">//</span><span style="color:#008000;">检索表示键名称的字符串</span></p> 
<p style="margin-left:0;text-align:left;">            <em><span style="color:#880000;">GetKeyNameText</span></em><span style="color:#000000;">(</span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><span style="color:#000080;">lParam</span><span style="color:#000000;">, </span><span style="color:#000080;">szKeyName</span><span style="color:#000000;">, </span><span style="color:#0000ff;">sizeof</span><span style="color:#000000;">(</span><span style="color:#000080;">szKeyName</span><span style="color:#000000;">) / </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">sizeof</span><span style="color:#000000;">(</span><em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;">));</span></p> 
<p style="margin-left:0;text-align:left;">            <span style="color:#0000ff;">int</span> <span style="color:#000080;">iLen</span><span style="color:#000000;"> = </span><em><span style="color:#880000;">wsprintf</span></em><span style="color:#000000;">(</span><span style="color:#000080;">szBuf</span><span style="color:#000000;">, </span><span style="color:#000080;">szFormat</span><span style="color:#000000;">[</span><span style="color:#000080;">iType</span><span style="color:#000000;">],</span></p> 
<p style="margin-left:0;text-align:left;">                <span style="color:#000080;">szMessage</span><span style="color:#000000;">[</span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><span style="color:#000080;">message</span><span style="color:#000000;"> - </span><em><span style="color:#a000a0;">WM_KEYFIRST</span></em><span style="color:#000000;">], </span><span style="color:#008000;">//</span><span style="color:#008000;">第1个参数，消息名称</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">第2个参数，击键时虚拟键代码，字符消息时显示字符的十六进制</span></p> 
<p style="margin-left:0;text-align:left;">                <span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><span style="color:#000080;">wParam</span><span style="color:#000000;">,  </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">第3个参数字符消息为 “”，击键名称</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                (</span><em><span style="color:#0000ff;">PTSTR</span></em><span style="color:#000000;">)(</span><span style="color:#000080;">iType</span><span style="color:#000000;"> ? </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">" "</span><span style="color:#000000;">) : </span><span style="color:#000080;">szKeyName</span><span style="color:#000000;">),</span></p> 
<p style="margin-left:0;text-align:left;">                <span style="color:#008000;">//</span><span style="color:#008000;">第4个参数：字符消息时，显示字符本身</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                (</span><em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;">)(</span><span style="color:#000080;">iType</span><span style="color:#000000;"> ? </span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><span style="color:#000080;">wParam</span><span style="color:#000000;"> : </span><span style="color:#a31515;">' '</span><span style="color:#000000;">), </span></p> 
<p style="margin-left:0;text-align:left;">                <em><span style="color:#a000a0;">LOWORD</span></em><span style="color:#000000;">(</span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><span style="color:#000080;">lParam</span><span style="color:#000000;">), </span><span style="color:#008000;">//</span><span style="color:#008000;">第5个参数，重复次数</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">第6个参数，扫描码在第16-23位,共8位</span></p> 
<p style="margin-left:0;text-align:left;">                <em><span style="color:#a000a0;">HIWORD</span></em><span style="color:#000000;">(</span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><span style="color:#000080;">lParam</span><span style="color:#000000;">) &amp; 0xFF, </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">第7个参数：扩展标记，在第24位</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                0x01000000 &amp; </span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><span style="color:#000080;">lParam</span><span style="color:#000000;"> ? </span><span style="color:#000080;">szYes</span><span style="color:#000000;"> : </span><span style="color:#000080;">szNo</span></p> 
<p style="margin-left:0;text-align:left;">                <span style="color:#008000;">//WM_SYSKEYUP</span><span style="color:#008000;">和 WM_SYSKEYDOWN消息的ALT标记位始终为1,而WM_KEYUP</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">和WM_KEYDOWN消息的此 位始终为0。</span></p> 
<p style="margin-left:0;text-align:left;">                <span style="color:#008000;">//</span><span style="color:#008000;">某些非英语的键盘上，一些字符是通过Shift键、Ctrl键或Alt组合</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">键。内容代码被设置为1,但消息并不是系统击键消息</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">第8个参数：ALT标记，在第29位</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                0x20000000 &amp; </span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><span style="color:#000080;">lParam</span><span style="color:#000000;"> ? </span><span style="color:#000080;">szYes</span><span style="color:#000000;"> : </span><span style="color:#000080;">szNo</span><span style="color:#000000;">, </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">第9个参数：先前状态，在第30位</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                0x40000000 &amp; </span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><span style="color:#000080;">lParam</span><span style="color:#000000;"> ? </span><span style="color:#000080;">szDown</span><span style="color:#000000;"> : </span><span style="color:#000080;">szUp</span><span style="color:#000000;">, </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">第10个参数：转换状态，在第31位</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                0x80000000 &amp; </span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><span style="color:#000080;">lParam</span><span style="color:#000000;"> ? </span><span style="color:#000080;">szUp</span><span style="color:#000000;"> : </span><span style="color:#000080;">szDown</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">            <em><span style="color:#880000;">TextOut</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, 0, (</span><span style="color:#000080;">cyClient</span><span style="color:#000000;"> / </span><span style="color:#000080;">cyChar</span><span style="color:#000000;"> - 1 - </span><span style="color:#000080;">i</span><span style="color:#000000;">)*</span><span style="color:#000080;">cyChar</span><span style="color:#000000;">, </span><span style="color:#000080;">szBuf</span><span style="color:#000000;">, </span><span style="color:#000080;">iLen</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">        }</span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#880000;">EndPaint</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">, &amp;</span><span style="color:#000080;">ps</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#0000ff;">return</span><span style="color:#000000;"> 0;</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_DESTROY</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#0000ff;">if</span><span style="color:#000000;"> (</span><span style="color:#000080;">pmsg</span><span style="color:#000000;">) </span><em><span style="color:#a000a0;">free</span></em><span style="color:#000000;">(</span><span style="color:#000080;">pmsg</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#000080;">pmsg</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">NULL</span></em><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">        <em><span style="color:#880000;">PostQuitMessage</span></em><span style="color:#000000;">(0);</span></p> 
<p style="margin-left:0;text-align:left;">        <span style="color:#0000ff;">return</span><span style="color:#000000;"> 0;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">    }</span></p> 
<p style="margin-left:0;text-align:left;">    <span style="color:#0000ff;">return</span> <em><span style="color:#880000;">DefWindowProc</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">, </span><span style="color:#000080;">message</span><span style="color:#000000;">, </span><span style="color:#000080;">wParam</span><span style="color:#000000;">, </span><span style="color:#000080;">lParam</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">}</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">/******************************************************************************</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">SetBkMode</span><span style="color:#008000;">函数:指定设备上下文的背景混合模式。背景混合模式用于非实线的文本，阴影画笔和笔样式。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">int SetBkMode(</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  HDC hdc,</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  int mode     //</span><span style="color:#008000;">后台模式-透明或不透明</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">*******************************************************************************</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">GetKeyNameText</span><span style="color:#008000;">函数：检索表示键名称的字符串</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">int GetKeyNameTextA(</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  LONG  lParam,     //</span><span style="color:#008000;">要处理的键盘消息的第二个参数</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  LPSTR lpString,   //</span><span style="color:#008000;">保存按键名称的字符缓冲区</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  int   cchSize     //</span><span style="color:#008000;">键名的最大长度（以字符为单位），包括终止的空字符</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">*******************************************************************************</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">ScrollWindow</span><span style="color:#008000;">函数：滚动指定窗口的客户区的内容</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">BOOL ScrollWindow(</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  HWND       hWnd,</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  int        XAmount,//</span><span style="color:#008000;">指定设备水平滚动的数量</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  int        YAmount,//</span><span style="color:#008000;">指定设备垂直滚动的数量</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  const RECT *lpRect,//</span><span style="color:#008000;">指向RECT结构的指针，该结构指定要滚动的客户区域的一部分</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  const RECT *lpClipRect//</span><span style="color:#008000;">指向包含裁剪矩形坐标的RECT结构的指针 。裁剪矩形内的仅设备位会受到影响。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">                         //</span><span style="color:#008000;">从矩形的外部滚动到内部的位被绘制；从矩形内部滚动到外部的位不会绘制。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">*/</span></p> 
<p style="margin-left:0;text-align:justify;">       运行结果：</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="627" src="https://images2.imgbox.com/54/b5/TDJHGzFP_o.png" width="874"></p> 
<p style="margin-left:0;text-align:justify;">图5-4 显示键盘按键消息</p> 
<p style="margin-left:0;text-align:justify;"> <img alt="" height="5" src="https://images2.imgbox.com/75/b7/Tm4NXKlY_o.png" width="865"></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="78" src="https://images2.imgbox.com/41/bc/kUXEdW7w_o.png" width="77">总结</p> 
<p style="margin-left:0;text-align:justify;">       KEYVIEW1程序展示了它的窗口过程接收到的每一个按键和字符消息的内容。它将此消息存储在MSG结构数组中。数组的大小基于最大化窗口的大小耜等宽的系统字体。如果用户在程序运行的时候调整视频显示的大小（在此种情况下，KEYVIEW1程序会收到一个WM_DISPLAYCHANGE消息），该数组将被重新产生。KEYVIEW1程序采用标准C的 malloc函数为此数组分配内存。</p> 
<p style="margin-left:0;text-align:justify;">KEYVIEW1程序的屏幕显示。第一列显示了键盘消息。第二列显示了击键消息的虚拟键代码和键名称。这是使用GetKeyNameText 函数获得的。第三列（标注为“Char”）显示了字符消息的十六进制字符代码和字符本身，剩下的六列显示了 IParam消息参数的6个字段。</p> 
<p style="margin-left:0;text-align:justify;">为便于分栏显示该消息，KEYVIEW1程序采用了等宽字体。像上一章中讨论的那样，这需要调用 GetStockObject 和 SelectObject 函数：</p> 
<p style="margin-left:0;text-align:justify;">SelectObject(hdc, GetStockObject(SYSTEM_FXXED_FONT));</p> 
<p style="margin-left:0;text-align:justify;">为了辨识该九列数据，KEYVIEW1在客户区的上部加了标题。标题加有下划线。虽然可以产生带下划线的字体，但此处采用了不同的方法。我定义了两个字符串变量，分别为 szTop（含有文字）和szUnd（含有下划线），然后在处理WM_PAINT消息时，同时在窗口上部的同一位置显示两个字符串。通常，Windows以“opaque”（不透明）模式显示文字，这意味 着Windows在显示字符的时候抹去了字符背景。此处将导致第二个字符串（szUnd）抹去第一个字符串(szTop)。为了阻止它的发生，转换设备环境到“TRANSPARENT”（透明）模式：</p> 
<p style="margin-left:0;text-align:justify;">SeCBkMode(hdc, TRANSPARENT);</p> 
<p style="margin-left:0;text-align:justify;">这种加下划线的方法只有在使用等宽字体时才可行。否则，这种在字符下面的下划线将不会和字符等宽。</p> 
<p style="margin-left:0;text-align:justify;">【注意】ScrollWindow函数并非一个GDI绘图函数，它的第一个函数是窗口句柄，而不是设备环境句柄。ScrollWindow函数是通过移动窗口坐标实现窗口滚动效果的。</p> 
<h5 style="margin-left:0;text-align:justify;"><img alt="" height="5" src="https://images2.imgbox.com/5b/27/VjNAE9Ea_o.png" width="865"></h5> 
<h5 style="margin-left:0;text-align:justify;"><strong><a name="_Toc158796796">5.4.2 非英语键盘问题</a></strong></h5> 
<p style="margin-left:0;text-align:justify;">       Windows 系统提供了不同国家和语言版本的字符集和键盘布局解决方案，以支持各种语言和输入需求。以下是针对不同国家语言版本的字符集和键盘布局解决方案的一般指导：</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">■<strong>字符集</strong>（Code Page）：Windows 使用字符集来映射字符与数字代码之间的关系。每个国家或地区的语言版本通常都有相应的字符集，用于表示该语言版本中使用的字符。在 Windows 中，可以通过以下步骤更改字符集：</p> 
<p style="margin-left:0;text-align:justify;">●在 Windows 10 中，打开“设置”应用程序，选择“时间和语言”，然后在“区域和语言”部分选择“语言首选项”。</p> 
<p style="margin-left:0;text-align:justify;">●在“首选语言”部分，选择你所使用的语言，然后点击“选项”按钮。</p> 
<p style="margin-left:0;text-align:justify;">●在“区域设置”选项卡中，选择正确的字符集并应用更改。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">■<strong>键盘布局</strong>：Windows 支持多种键盘布局，以适应不同国家和地区的键盘输入需求。可以根据自己的键盘布局选择进行设置。在 Windows 中，可以通过以下步骤更改键盘布局：</p> 
<p style="margin-left:0;text-align:justify;">●在 Windows 10 中，打开“设置”应用程序，选择“时间和语言”，然后在“区域和语言”部分选择“语言首选项”。</p> 
<p style="margin-left:0;text-align:justify;">●在“首选语言”部分，选择你所使用的语言，然后点击“选项”按钮。</p> 
<p style="margin-left:0;text-align:justify;">●在“键盘”选项卡中，选择正确的键盘布局并应用更改。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">■<strong>语言包</strong>（Language Pack）：对于某些语言版本，Windows 提供了相应的语言包，用于提供更全面的本地化支持，包括界面翻译、日期/时间格式、货币符号等。可以通过以下步骤添加语言包：</p> 
<p style="margin-left:0;text-align:justify;">●在 Windows 10 中，打开“设置”应用程序，选择“时间和语言”，然后在“区域和语言”部分选择“语言首选项”。</p> 
<p style="margin-left:0;text-align:justify;">●在“首选语言”部分，点击“添加语言”按钮，选择你所需的语言并安装相应的语言包。</p> 
<p style="margin-left:0;text-align:justify;">请注意，具体的字符集、键盘布局和语言包选项可能因 Windows 版本和具体的语言版本而略有不同。上述步骤是基于 Windows 10 的一般指导，实际操作时可能会有细微差异。</p> 
<p style="margin-left:0;text-align:justify;">通过正确配置字符集、键盘布局和语言包，可以使 Windows 系统适应不同国家和语言版本的需求，并提供更好的本地化支持。</p> 
<p style="margin-left:0;text-align:justify;">不论是在Windows英语版本上安装俄语或希腊语键盘布局然后运行KEYVTEW1，或者是在Windows希腊语版本上安装俄语或德语键盘布局然后运行KEYVTEW1，还有是在Windows俄语版本上安装德语、俄语或希腊语键盘布局后运行KEYVTEW1，都会显示不正确字符。</p> 
<h5 style="margin-left:0;text-align:justify;"><strong><a name="_Toc158796797">5.4.3 字符集和字体</a></strong></h5> 
<p style="margin-left:0;text-align:justify;">       ■<strong>字符集</strong></p> 
<p style="margin-left:0;text-align:justify;">       在 Windows 系统中，字符集（Character Set）用于定义字符与数字代码之间的映射关系，以便正确表示和处理不同字符。Windows 支持多种字符集，包括以下常见的字符集：</p> 
<p style="margin-left:0;text-align:justify;">●ASCII（American Standard Code for Information Interchange）：ASCII 是最早的字符集之一，用于表示英文字母、数字和一些特殊字符。它使用 7 位编码，共包含 128 个字符。</p> 
<p style="margin-left:0;text-align:justify;">●Unicode：Unicode 是一种全球通用的字符编码标准，旨在支持几乎所有语言和字符。它使用 16 位或 32 位编码，可以表示超过 100 万个字符。在 Windows 中，常用的 Unicode 编码方案是 UTF-16（16 位 Unicode 转换格式），它使用 16 位编码来表示字符。在VS编译器中默认的就是Unicode字符集。</p> 
<p style="margin-left:0;text-align:justify;">●UTF-8（Unicode Transformation Format 8-bit）：UTF-8 是一种变长编码方案，用于表示 Unicode 字符。它可以使用 1 到 4 个字节来编码字符，可以表示所有 Unicode 字符。UTF-8 在互联网上广泛使用，因为它兼容 ASCII 字符集，并且可以节省存储空间。</p> 
<p style="margin-left:0;text-align:justify;">●区域特定字符集：Windows 还支持各种区域特定的字符集，用于表示特定语言或地区的字符。例如，GBK（简体中文字符集）、Big5（繁体中文字符集）、Shift_JIS（日文字符集）等。</p> 
<p style="margin-left:0;text-align:justify;">通过使用适当的字符集，Windows 可以正确地解析和显示各种字符。Unicode 已成为广泛使用的标准字符集，使得在 Windows 系统中支持多种语言和字符变得更加方便。对于大多数情况，使用 Unicode 字符集（如 UTF-8 或 UTF-16）是推荐的做法，以便在不同语言之间无缝交互和显示字符。</p> 
<p style="margin-left:0;text-align:justify;">【注意】选择正确的字符集对于文本处理、编程和跨语言交互等方面都至关重要。在开发应用程序或进行国际化工作时，确保理解和正确处理字符集是必要的。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">       ■<strong>字体</strong></p> 
<p style="margin-left:0;text-align:justify;">在 Windows 系统中，字体（Font）用于确定字符的外观、样式和形状，以便以可视化方式显示字符。Windows 提供了许多内置字体，并且还支持安装和使用其他字体。Windows支持3种字体——位图字体（bitmap fonts）、矢量字体（vector founts）和（Windows 3.1 中开始采用的）TrueType 字体。</p> 
<p style="margin-left:0;text-align:justify;">●矢量字体其实已经过时了。这些字体中的字符由简单的线条组成，但这些线条没有定义填充区域。矢量字体可以缩放至任意大小，但字符看起来有些单薄。</p> 
<p style="margin-left:0;text-align:justify;">●TrueType字体是由填充区域来定义字符的轮廓字体。TrueType字体是可缩放的，而且 字体定义中包含的“提示”信息能避免造成难看的或不可读的文本的舍入问题。Windows 利用TrueType字体达到了真正的所见即所得（what you see is what you get, WYSIWYG），使 得在显示器上显示的字体和打印机输出的字体是准确匹配的。</p> 
<p style="margin-left:0;text-align:justify;">●位图字体中，每一个字符是由对应于显示器的像素的一组位值定义的。位图字体可以放大到较大的尺寸，但字体看起来有锯齿。在设计位图字体时通常会考虑到它在显示器上的效果，所以一般在显示器上看起来很舒服。因此，Windows在标题栏、菜单、按钮和对话框中使用位图字体。</p> 
<p style="margin-left:0;text-align:justify;">你在默认的设备环境中得到的位图字体称为系统字体。你可通过调用带有 SYSTEM_FONT标识符的GetStockObject函数获得此字体的句柄。KEYVIEW1程序选择使用系统字体的等宽字体版本，用SYSTEM_FIXED_FONT表示。GetStockObject函数的另一个选择是 OEM_FIXED_FONT。</p> 
<p style="margin-left:0;text-align:justify;">对许多标准控件和用户界面组件来讲，Windows不采用系统字体，而采用字体名为 MS Sans Serif的字体（MS代表微软）。这是一种位图字体。名为SSERIFE.FON的文件包含用于分辨率为96dpi的视频显示的字体，字号为8、 10、12、14、18和24磅。你可在 GetStockObject中采用DEFAULT_GUI_FONT标识符获得此字体。Windows使用的字号大小取决于你在控制而板的【显示】程序中设置的显示分辨率。</p> 
<p style="margin-left:0;text-align:justify;">到目前为止，我己经提到了可在GetStockObject中使用的四种标识符，你能用它们获得在设备环境中使用的字体。还有其他三种标识符：ANSI_FIXED_FONT ， ANSI_VAR_FONT和DEVICE_DEFAULT_FONT。</p> 
<p style="margin-left:0;text-align:justify;">除了这些常见的字体外，Windows 还提供其他字体，如宋体、黑体、楷体等，用于支持中文字符的显示。</p> 
<p style="margin-left:0;text-align:justify;">此外，用户还可以从互联网或其他来源下载和安装各种字体。安装新字体后，它们将在应用程序中可用，并可以在文档、网页设计等方面使用。</p> 
<p style="margin-left:0;text-align:justify;">【注意】在选择字体时，应考虑所需的语言和字符集。确保选择支持所需字符集和语言的字体，以便正确显示和呈现文本。</p> 
<h5 style="margin-left:0;text-align:justify;"><strong><a name="_Toc158796798">5.4.4 第32练：显示默认字体信息</a></strong></h5> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">/*------------------------------------------------------------------</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">032  WIN32 API </span><span style="color:#008000;">每日一练</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#008000;">第32个例子STOKFONT.C：显示7种备用字体信息</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">     SetTextAlign</span><span style="color:#008000;">函数</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">     GetTextFace</span><span style="color:#008000;">函数</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">     WM_DISPLAYCHANGE</span><span style="color:#008000;">消息</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">注：将VS字符集改为“使用多字节字符集”，否则字体显式为中文乱字符</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">(c) www.bcdaren.com, 2020</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">----------------------------------------------------------------*/</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#808080;">#include</span> <span style="color:#a31515;">&lt;windows.h&gt;</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><em><span style="color:#0000ff;">LRESULT</span></em> <em><span style="color:#a000a0;">CALLBACK</span></em> <span style="color:#880000;">WndProc</span><span style="color:#000000;"> (</span><em><span style="color:#0000ff;">HWND</span></em><span style="color:#000000;">, </span><em><span style="color:#0000ff;">UINT</span></em><span style="color:#000000;">, </span><em><span style="color:#0000ff;">WPARAM</span></em><span style="color:#000000;">, </span><em><span style="color:#0000ff;">LPARAM</span></em><span style="color:#000000;">) ; </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">int</span> <em><span style="color:#a000a0;">WINAPI</span></em> <em><span style="color:#880000;">WinMain</span></em><span style="color:#000000;"> (</span><em><span style="color:#0000ff;">HINSTANCE</span></em> <span style="color:#000080;">hInstance</span><span style="color:#000000;">, </span><em><span style="color:#0000ff;">HINSTANCE</span></em> <span style="color:#000080;">hPrevInstance</span><span style="color:#000000;">, </span></p> 
<p style="margin-left:0;text-align:left;"> <em><span style="color:#0000ff;">PSTR</span></em> <span style="color:#000080;">szCmdLine</span><span style="color:#000000;">, </span><span style="color:#0000ff;">int</span> <span style="color:#000080;">iCmdShow</span><span style="color:#000000;">) </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">{ </span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em> <span style="color:#000080;">szAppName</span><span style="color:#000000;">[] = </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;"> (</span><span style="color:#a31515;">"STOKFONT.C"</span><span style="color:#000000;">) ; </span></p> 
<p style="margin-left:0;text-align:left;"><em>    </em><span style="color:#0000ff;">…</span><span style="color:#0000ff;">(</span><span style="color:#0000ff;">略)</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">return</span> <span style="color:#000080;">msg</span><span style="color:#000000;">.</span><span style="color:#000080;">wParam</span><span style="color:#000000;"> ; </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">} </span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><em><span style="color:#0000ff;">LRESULT</span></em> <em><span style="color:#a000a0;">CALLBACK</span></em> <span style="color:#880000;">WndProc</span><span style="color:#000000;"> (</span><em><span style="color:#0000ff;">HWND</span></em> <span style="color:#000080;">hwnd</span><span style="color:#000000;">, </span><em><span style="color:#0000ff;">UINT</span></em> <span style="color:#000080;">message</span><span style="color:#000000;">, </span><em><span style="color:#0000ff;">WPARAM</span></em> <span style="color:#000080;">wParam</span><span style="color:#000000;">, </span><em><span style="color:#0000ff;">LPARAM</span></em> <span style="color:#000080;">lParam</span><span style="color:#000000;">) </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">{ </span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">struct</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">     { </span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">int</span> <span style="color:#000080;">idStockFont</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;"> * </span><span style="color:#000080;">szStockFont</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">     } </span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#008000;">//7</span><span style="color:#008000;">种备用字体</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#000080;">stockfont</span><span style="color:#000000;"> [] = { </span><em><span style="color:#a000a0;">OEM_FIXED_FONT</span></em><span style="color:#000000;">, </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"OEM_FIXED_FONT"</span><span style="color:#000000;">), </span></p> 
<p style="margin-left:0;text-align:left;">                     <em><span style="color:#a000a0;">ANSI_FIXED_FONT</span></em><span style="color:#000000;">, </span><span style="color:#a31515;">"ANSI_FIXED_FONT"</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;">                     <em><span style="color:#a000a0;">ANSI_VAR_FONT</span></em><span style="color:#000000;">, </span><span style="color:#a31515;">"ANSI_VAR_FONT"</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;">                     <em><span style="color:#a000a0;">SYSTEM_FONT</span></em><span style="color:#000000;">, </span><span style="color:#a31515;">"SYSTEM_FONT"</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;">                     <em><span style="color:#a000a0;">DEVICE_DEFAULT_FONT</span></em><span style="color:#000000;">,</span><span style="color:#a31515;">"DEVICE_DEFAULT_FONT"</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;">                     <em><span style="color:#a000a0;">SYSTEM_FIXED_FONT</span></em><span style="color:#000000;">,</span><span style="color:#a31515;">"SYSTEM_FIXED_FONT"</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;">                     <em><span style="color:#a000a0;">DEFAULT_GUI_FONT</span></em><span style="color:#000000;">,</span><span style="color:#a31515;">"DEFAULT_GUI_FONT"</span><span style="color:#000000;"> };</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> <span style="color:#000080;">iFont</span><span style="color:#000000;">,</span><span style="color:#000080;">cFonts</span><span style="color:#000000;"> = </span><span style="color:#0000ff;">sizeof</span> <span style="color:#000080;">stockfont</span><span style="color:#000000;"> / </span><span style="color:#0000ff;">sizeof</span> <span style="color:#000080;">stockfont</span><span style="color:#000000;">[0];</span></p> 
<p style="margin-left:0;text-align:left;">     <em><span style="color:#0000ff;">HDC</span></em> <span style="color:#000080;">hdc</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">     <em><span style="color:#0000ff;">PAINTSTRUCT</span></em> <span style="color:#000080;">ps</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">int</span> <span style="color:#000080;">i</span><span style="color:#000000;">,</span><span style="color:#000080;">x</span><span style="color:#000000;">,</span><span style="color:#000080;">y</span><span style="color:#000000;">,</span><span style="color:#000080;">cxGrid</span><span style="color:#000000;">,</span><span style="color:#000080;">cyGrid</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">     <em><span style="color:#0000ff;">TCHAR</span></em> <span style="color:#000080;">szFaceName</span><span style="color:#000000;">[</span><em><span style="color:#a000a0;">LF_FACESIZE</span></em><span style="color:#000000;">],</span><span style="color:#000080;">szBuffer</span><span style="color:#000000;">[</span><em><span style="color:#a000a0;">LF_FACESIZE</span></em><span style="color:#000000;"> + 64];</span></p> 
<p style="margin-left:0;text-align:left;">     <em><span style="color:#0000ff;">TEXTMETRIC</span></em> <span style="color:#000080;">tm</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">switch</span><span style="color:#000000;"> (</span><span style="color:#000080;">message</span><span style="color:#000000;">)</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">     {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_CREATE</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#008000;">//</span><span style="color:#008000;">滚动条的范围0~6</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">SetScrollRange</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">,</span><em><span style="color:#a000a0;">SB_VERT</span></em><span style="color:#000000;">,0,</span><span style="color:#000080;">cFonts</span><span style="color:#000000;">-1,</span><em><span style="color:#a000a0;">TRUE</span></em><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">return</span><span style="color:#000000;"> 0;</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#008000;">//</span><span style="color:#008000;">显示分辨率更改后，WM_DISPLAYCHANGE消息将发送到所有窗口</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_DISPLAYCHANGE</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">InvalidateRect</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">,</span><em><span style="color:#a000a0;">NULL</span></em><span style="color:#000000;">,</span><em><span style="color:#a000a0;">TRUE</span></em><span style="color:#000000;">);</span><span style="color:#008000;">//</span><span style="color:#008000;">改变屏幕分辨率后重绘窗口</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">return</span><span style="color:#000000;"> 0;</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_VSCROLL</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">switch</span><span style="color:#000000;"> (</span><em><span style="color:#a000a0;">LOWORD</span></em><span style="color:#000000;">(</span><span style="color:#000080;">wParam</span><span style="color:#000000;">))</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">          {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">SB_TOP</span></em><span style="color:#000000;"> :            </span><span style="color:#000080;">iFont</span><span style="color:#000000;"> = 0;               </span><span style="color:#0000ff;">break</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">SB_BOTTOM</span></em><span style="color:#000000;"> :         </span><span style="color:#000080;">iFont</span><span style="color:#000000;"> = </span><span style="color:#000080;">cFonts</span><span style="color:#000000;"> - 1;      </span><span style="color:#0000ff;">break</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">SB_PAGEUP</span></em><span style="color:#000000;"> :</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">SB_LINEUP</span></em><span style="color:#000000;"> :         </span><span style="color:#000080;">iFont</span><span style="color:#000000;"> -= 1;              </span><span style="color:#0000ff;">break</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">SB_PAGEDOWN</span></em><span style="color:#000000;"> :</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">SB_LINEDOWN</span></em><span style="color:#000000;"> :       </span><span style="color:#000080;">iFont</span><span style="color:#000000;"> += 1;              </span><span style="color:#0000ff;">break</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">SB_THUMBPOSITION</span></em><span style="color:#000000;"> :  </span><span style="color:#000080;">iFont</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">HIWORD</span></em><span style="color:#000000;">(</span><span style="color:#000080;">wParam</span><span style="color:#000000;">);  </span><span style="color:#0000ff;">break</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">          }</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">iFont</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">max</span></em><span style="color:#000000;">(0,</span><em><span style="color:#a000a0;">min</span></em><span style="color:#000000;">(</span><span style="color:#000080;">cFonts</span><span style="color:#000000;">-1,</span><span style="color:#000080;">iFont</span><span style="color:#000000;">));</span><span style="color:#008000;">//</span><span style="color:#008000;">滚动范围检测</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">SetScrollPos</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">,</span><em><span style="color:#a000a0;">SB_VERT</span></em><span style="color:#000000;">,</span><span style="color:#000080;">iFont</span><span style="color:#000000;">,</span><em><span style="color:#a000a0;">TRUE</span></em><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">InvalidateRect</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">,</span><em><span style="color:#a000a0;">NULL</span></em><span style="color:#000000;">,</span><em><span style="color:#a000a0;">TRUE</span></em><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">return</span><span style="color:#000000;"> 0;</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_KEYDOWN</span></em><span style="color:#000000;"> : </span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">switch</span><span style="color:#000000;">(</span><span style="color:#000080;">wParam</span><span style="color:#000000;">)</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">          {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">VK_HOME</span></em><span style="color:#000000;"> :</span><em><span style="color:#880000;">SendMessage</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">,</span><em><span style="color:#a000a0;">WM_VSCROLL</span></em><span style="color:#000000;">,</span><em><span style="color:#a000a0;">SB_TOP</span></em><span style="color:#000000;">,0);        </span><span style="color:#0000ff;">break</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">VK_END</span></em><span style="color:#000000;"> :</span><em><span style="color:#880000;">SendMessage</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">,</span><em><span style="color:#a000a0;">WM_VSCROLL</span></em><span style="color:#000000;">,</span><em><span style="color:#a000a0;">SB_BOTTOM</span></em><span style="color:#000000;">,0);      </span><span style="color:#0000ff;">break</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">VK_PRIOR</span></em><span style="color:#000000;"> : </span><span style="color:#008000;">//Page Up </span><span style="color:#008000;">键</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">VK_LEFT</span></em><span style="color:#000000;"> :</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">VK_UP</span></em><span style="color:#000000;"> :</span><em><span style="color:#880000;">SendMessage</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">,</span><em><span style="color:#a000a0;">WM_VSCROLL</span></em><span style="color:#000000;">,</span><em><span style="color:#a000a0;">SB_LINEUP</span></em><span style="color:#000000;">,0);       </span><span style="color:#0000ff;">break</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">VK_NEXT</span></em><span style="color:#000000;"> :</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">VK_RIGHT</span></em><span style="color:#000000;"> :</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">VK_DOWN</span></em><span style="color:#000000;"> :</span><em><span style="color:#880000;">SendMessage</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">,</span><em><span style="color:#a000a0;">WM_VSCROLL</span></em><span style="color:#000000;">,</span><em><span style="color:#a000a0;">SB_PAGEDOWN</span></em><span style="color:#000000;">,0);   </span><span style="color:#0000ff;">break</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">          }</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">return</span><span style="color:#000000;"> 0 ; </span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_PAINT</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">hdc</span><span style="color:#000000;"> = </span><em><span style="color:#880000;">BeginPaint</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">, &amp;</span><span style="color:#000080;">ps</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#008000;">//</span><span style="color:#008000;">滚动条滑块位置iFont = 0~6</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">设置字体</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">SelectObject</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, </span><em><span style="color:#880000;">GetStockObject</span></em><span style="color:#000000;">(</span><span style="color:#000080;">stockfont</span><span style="color:#000000;">[</span><span style="color:#000080;">iFont</span><span style="color:#000000;">].</span><span style="color:#000080;">idStockFont</span><span style="color:#000000;">)); </span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">GetTextFace</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, </span><em><span style="color:#a000a0;">LF_FACESIZE</span></em><span style="color:#000000;">, </span><span style="color:#000080;">szFaceName</span><span style="color:#000000;">); </span><span style="color:#008000;">//</span><span style="color:#008000;">获取字体的字体名称</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">GetTextMetrics</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, &amp;</span><span style="color:#000080;">tm</span><span style="color:#000000;">); </span><span style="color:#008000;">//</span><span style="color:#008000;">获取字体信息</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//2</span><span style="color:#008000;">倍字符平均宽度+3倍字符最大宽度</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">cxGrid</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">max</span></em><span style="color:#000000;">(3 * </span><span style="color:#000080;">tm</span><span style="color:#000000;">.</span><em><span style="color:#000080;">tmAveCharWidth</span></em><span style="color:#000000;">, 2 * </span><span style="color:#000080;">tm</span><span style="color:#000000;">.</span><em><span style="color:#000080;">tmMaxCharWidth</span></em><span style="color:#000000;">); </span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">cyGrid</span><span style="color:#000000;"> = </span><span style="color:#000080;">tm</span><span style="color:#000000;">.</span><em><span style="color:#000080;">tmHeight</span></em><span style="color:#000000;"> + 3;</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">TextOut</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, 0, 0, </span><span style="color:#000080;">szBuffer</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;">               <em><span style="color:#880000;">wsprintf</span></em><span style="color:#000000;">(</span><span style="color:#000080;">szBuffer</span><span style="color:#000000;">, </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">" %s: Face Name = %s, CharSet = %i"</span><span style="color:#000000;">),</span></p> 
<p style="margin-left:0;text-align:left;">                    <span style="color:#000080;">stockfont</span><span style="color:#000000;">[</span><span style="color:#000080;">iFont</span><span style="color:#000000;">].</span><span style="color:#000080;">szStockFont</span><span style="color:#000000;">, </span><span style="color:#008000;">//</span><span style="color:#008000;">字体</span></p> 
<p style="margin-left:0;text-align:left;">                    <span style="color:#000080;">szFaceName</span><span style="color:#000000;">, </span><span style="color:#000080;">tm</span><span style="color:#000000;">.</span><em><span style="color:#000080;">tmCharSet</span></em><span style="color:#000000;">));   </span><span style="color:#008000;">//</span><span style="color:#008000;">字体名称和字符集</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">设置文本对齐方式：向上、居中对齐</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">SetTextAlign</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, </span><em><span style="color:#a000a0;">TA_TOP</span></em><span style="color:#000000;"> | </span><em><span style="color:#a000a0;">TA_CENTER</span></em><span style="color:#000000;">); </span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#008000;">// </span><span style="color:#008000;">垂线和水平线---画表格</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">for</span><span style="color:#000000;"> (</span><span style="color:#000080;">i</span><span style="color:#000000;"> = 0; </span><span style="color:#000080;">i</span><span style="color:#000000;"> &lt; 17; </span><span style="color:#000080;">i</span><span style="color:#000000;">++) </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">          {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">               <em><span style="color:#880000;">MoveToEx</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, (</span><span style="color:#000080;">i</span><span style="color:#000000;"> + 2) * </span><span style="color:#000080;">cxGrid</span><span style="color:#000000;">, 2 * </span><span style="color:#000080;">cyGrid</span><span style="color:#000000;">, </span><em><span style="color:#a000a0;">NULL</span></em><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">               <em><span style="color:#880000;">LineTo</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, (</span><span style="color:#000080;">i</span><span style="color:#000000;"> + 2) * </span><span style="color:#000080;">cxGrid</span><span style="color:#000000;">, 19 * </span><span style="color:#000080;">cyGrid</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">               <em><span style="color:#880000;">MoveToEx</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, </span><span style="color:#000080;">cxGrid</span><span style="color:#000000;">, (</span><span style="color:#000080;">i</span><span style="color:#000000;"> + 3) * </span><span style="color:#000080;">cyGrid</span><span style="color:#000000;">, </span><em><span style="color:#a000a0;">NULL</span></em><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">               <em><span style="color:#880000;">LineTo</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, 18 * </span><span style="color:#000080;">cxGrid</span><span style="color:#000000;">, (</span><span style="color:#000080;">i</span><span style="color:#000000;"> + 3) * </span><span style="color:#000080;">cyGrid</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">          }</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#008000;">//  </span><span style="color:#008000;">垂直和水平标题</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">for</span><span style="color:#000000;"> (</span><span style="color:#000080;">i</span><span style="color:#000000;"> = 0; </span><span style="color:#000080;">i</span><span style="color:#000000;"> &lt; 16; </span><span style="color:#000080;">i</span><span style="color:#000000;">++)</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">          {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">               <em><span style="color:#880000;">TextOut</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, (2 * </span><span style="color:#000080;">i</span><span style="color:#000000;"> + 5) * </span><span style="color:#000080;">cxGrid</span><span style="color:#000000;"> / 2, 2 * </span><span style="color:#000080;">cyGrid</span><span style="color:#000000;"> + 2, </span><span style="color:#000080;">szBuffer</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;">                    <em><span style="color:#880000;">wsprintf</span></em><span style="color:#000000;">(</span><span style="color:#000080;">szBuffer</span><span style="color:#000000;">, </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"%X-"</span><span style="color:#000000;">), </span><span style="color:#000080;">i</span><span style="color:#000000;">));</span></p> 
<p style="margin-left:0;text-align:left;">               <em><span style="color:#880000;">TextOut</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, 3 * </span><span style="color:#000080;">cxGrid</span><span style="color:#000000;"> / 2, (</span><span style="color:#000080;">i</span><span style="color:#000000;"> + 3) * </span><span style="color:#000080;">cyGrid</span><span style="color:#000000;"> + 2, </span><span style="color:#000080;">szBuffer</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;">                    <em><span style="color:#880000;">wsprintf</span></em><span style="color:#000000;">(</span><span style="color:#000080;">szBuffer</span><span style="color:#000000;">, </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"-%X"</span><span style="color:#000000;">), </span><span style="color:#000080;">i</span><span style="color:#000000;">));</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">          }</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#008000;">//</span><span style="color:#008000;">输出字符</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">for</span><span style="color:#000000;"> (</span><span style="color:#000080;">y</span><span style="color:#000000;"> = 0; </span><span style="color:#000080;">y</span><span style="color:#000000;"> &lt; 16; </span><span style="color:#000080;">y</span><span style="color:#000000;">++)</span></p> 
<p style="margin-left:0;text-align:left;">               <span style="color:#0000ff;">for</span><span style="color:#000000;"> (</span><span style="color:#000080;">x</span><span style="color:#000000;"> = 0; </span><span style="color:#000080;">x</span><span style="color:#000000;"> &lt; 16; </span><span style="color:#000080;">x</span><span style="color:#000000;">++)</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">               {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">                    <em><span style="color:#880000;">TextOut</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, (2 * </span><span style="color:#000080;">x</span><span style="color:#000000;"> + 5) * </span><span style="color:#000080;">cxGrid</span><span style="color:#000000;"> / 2,</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                         (</span><span style="color:#000080;">y</span><span style="color:#000000;"> + 3) * </span><span style="color:#000080;">cyGrid</span><span style="color:#000000;"> + 2, </span><span style="color:#000080;">szBuffer</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;">                         <em><span style="color:#880000;">wsprintf</span></em><span style="color:#000000;">(</span><span style="color:#000080;">szBuffer</span><span style="color:#000000;">, </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"%c"</span><span style="color:#000000;">), 16 * </span><span style="color:#000080;">x</span><span style="color:#000000;"> + </span><span style="color:#000080;">y</span><span style="color:#000000;">));</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">               }</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">EndPaint</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">, &amp;</span><span style="color:#000080;">ps</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">return</span><span style="color:#000000;"> 0;</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_DESTROY</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">PostQuitMessage</span></em><span style="color:#000000;">(0);</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">return</span><span style="color:#000000;"> 0;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">     }</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">return</span> <em><span style="color:#880000;">DefWindowProc</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">, </span><span style="color:#000080;">message</span><span style="color:#000000;">, </span><span style="color:#000080;">wParam</span><span style="color:#000000;">, </span><span style="color:#000080;">lParam</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">}</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">/******************************************************************************</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">GetTextFace</span><span style="color:#008000;">函数：检索被选择转换为指定的设备上下文的字体的字体名称。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">int GetTextFaceA(</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  HDC   hdc,   //</span><span style="color:#008000;">设备上下文的句柄</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  int   c,     //</span><span style="color:#008000;">指向的缓冲区的长度。对于ANSI函数，它是一个BYTE计数，对于Unicode函数，它是一个WORD计数。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  LPSTR lpName //</span><span style="color:#008000;">指向接收字体名称的缓冲区的指针。如果此参数为NULL，则该函数返回名称中的字符数，包括终止的空字符。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">*******************************************************************************</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">WM_DISPLAYCHANGE</span><span style="color:#008000;">消息：显示分辨率更改后，WM_DISPLAYCHANGE消息将发送到所有窗口。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">窗口通过其WindowProc函数接收此消息。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">参数wParam：显示器的新图像深度，以每像素位数为单位。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">lPAram</span><span style="color:#008000;">：低位字指定屏幕的水平分辨率。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">高位字指定屏幕的垂直分辨率。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">备注</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">此消息仅发送到顶级窗口。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">*******************************************************************************</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">SetTextAlign</span><span style="color:#008000;">函数：用于设置设备环境（Device Context）中文本输出的对齐方式。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">UINT SetTextAlign(</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  HDC hdc,</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  UINT align</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">参数说明：</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">hdc</span><span style="color:#008000;">：设备环境句柄（Device Context Handle），用于标识要设置文本对齐方式的设备环境。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">align</span><span style="color:#008000;">：对齐方式的标志，可以是以下值的组合：</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">TA_LEFT</span><span style="color:#008000;">：左对齐。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">TA_RIGHT</span><span style="color:#008000;">：右对齐。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">TA_CENTER</span><span style="color:#008000;">：居中对齐。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">TA_TOP</span><span style="color:#008000;">：顶部对齐。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">TA_BOTTOM</span><span style="color:#008000;">：底部对齐。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">TA_BASELINE</span><span style="color:#008000;">：基线对齐。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">返回值：</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">如果函数调用成功，返回值为先前的文本对齐方式。可以使用 GetTextAlign 函数获取先前的对齐方式。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">如果函数调用失败，返回值为 GDI_ERROR。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">*/</span></p> 
<p style="margin-left:0;text-align:justify;">       运行结果：</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="466" src="https://images2.imgbox.com/6b/b3/sjZb1Mes_o.png" width="693"></p> 
<p style="margin-left:0;text-align:justify;">图5-5 显示7种默认字体信息</p> 
<p style="margin-left:0;text-align:justify;"> <img alt="" height="5" src="https://images2.imgbox.com/09/fc/lTLU58zE_o.png" width="865"></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="78" src="https://images2.imgbox.com/80/e0/O8d5BCYr_o.png" width="77">总结</p> 
<p style="margin-left:0;text-align:justify;">       上述实例在窗口过程中首先预定义了7种备用字体的结构数组，包含字体的ID和字面名称。然后WM_CREATE消息中这种窗口滚动范围（主程序CreateWindow添加窗口滚动条）。</p> 
<p style="margin-left:0;text-align:justify;">       WM_DISPLAYCHANGE消息：显示分辨率更改后，WM_DISPLAYCHANGE消息将发送到所有窗口。窗口过程添加WM_DISPLAYCHANGE消息的处理，将窗口客户区设置为无效区域重绘。这样处理使得程序更加严谨。</p> 
<p style="margin-left:0;text-align:justify;">       接下来就是滚动条及其键盘接口的消息处理。根据滚动条的变化重新设置窗口滚动条的位置。</p> 
<p style="margin-left:0;text-align:justify;">【注意】检测滚动位置是否超出滚动范围：</p> 
<p style="margin-left:0;text-align:justify;">iFont = max(0,min(cFonts-1,iFont));//滚动范围检测</p> 
<p style="margin-left:0;text-align:justify;">WM_PAINT消息处理：根据滚动条的位置选入备用字体数组中对应的字体。调用GetTextMetrics函数获取字体信息，并将字体宽度重新设置为2倍字符平均宽度+3倍字符最大宽度，字体高设置为m.tmHeight + 3。接着由3个for循环语句输出0~255共计256个字符表格。调用函数SetTextAlign将表格内容格式设置为向上、居中对齐。</p> 
<p style="margin-left:0;text-align:justify;">【注意】上述实例只支持ANSI字符集，需要将VS字符集改为“使用多字节字符集”，否则标题栏的中文字符字体字面名称将显式为中文乱字符。</p> 
<h5 style="margin-left:0;text-align:justify;"><img alt="" height="5" src="https://images2.imgbox.com/b3/66/JoP1W189_o.png" width="865"></h5> 
<h5 style="margin-left:0;text-align:justify;"><strong><a name="_Toc158796799">5.4.5 第33练：创建逻辑字体</a></strong></h5> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">/*------------------------------------------------------------------</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">033  WIN32 API </span><span style="color:#008000;">每日一练</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#008000;">第33个例子KEYVIEW2.C：创建逻辑字体</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">     CreateFont</span><span style="color:#008000;">函数</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">     WM_INPUTLANGCHANGE</span><span style="color:#008000;">消息</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">(c) www.bcdaren.com, 2020</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">----------------------------------------------------------------*/</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#808080;">#include</span> <span style="color:#a31515;">&lt;windows.h&gt;</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><em><span style="color:#0000ff;">LRESULT</span></em> <em><span style="color:#a000a0;">CALLBACK</span></em> <span style="color:#880000;">WndProc</span><span style="color:#000000;"> (</span><em><span style="color:#0000ff;">HWND</span></em><span style="color:#000000;">, </span><em><span style="color:#0000ff;">UINT</span></em><span style="color:#000000;">, </span><em><span style="color:#0000ff;">WPARAM</span></em><span style="color:#000000;">, </span><em><span style="color:#0000ff;">LPARAM</span></em><span style="color:#000000;">) ; </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">int</span> <em><span style="color:#a000a0;">WINAPI</span></em> <em><span style="color:#880000;">WinMain</span></em><span style="color:#000000;"> (</span><em><span style="color:#0000ff;">HINSTANCE</span></em> <span style="color:#000080;">hInstance</span><span style="color:#000000;">, </span><em><span style="color:#0000ff;">HINSTANCE</span></em> <span style="color:#000080;">hPrevInstance</span><span style="color:#000000;">, </span></p> 
<p style="margin-left:0;text-align:left;"> <em><span style="color:#0000ff;">PSTR</span></em> <span style="color:#000080;">szCmdLine</span><span style="color:#000000;">, </span><span style="color:#0000ff;">int</span> <span style="color:#000080;">iCmdShow</span><span style="color:#000000;">) </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">{ </span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em> <span style="color:#000080;">szAppName</span><span style="color:#000000;">[] = </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;"> (</span><span style="color:#a31515;">"KeyView2"</span><span style="color:#000000;">) ; </span></p> 
<p style="margin-left:0;text-align:left;"><em>    </em><span style="color:#0000ff;">…</span><span style="color:#0000ff;">(</span><span style="color:#0000ff;">略)</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">return</span> <span style="color:#000080;">msg</span><span style="color:#000000;">.</span><span style="color:#000080;">wParam</span><span style="color:#000000;"> ; </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">} </span></p> 
<p style="margin-left:0;text-align:left;"><em><span style="color:#0000ff;">LRESULT</span></em> <em><span style="color:#a000a0;">CALLBACK</span></em> <span style="color:#880000;">WndProc</span><span style="color:#000000;"> (</span><em><span style="color:#0000ff;">HWND</span></em> <span style="color:#000080;">hwnd</span><span style="color:#000000;">, </span><em><span style="color:#0000ff;">UINT</span></em> <span style="color:#000080;">message</span><span style="color:#000000;">, </span><em><span style="color:#0000ff;">WPARAM</span></em> <span style="color:#000080;">wParam</span><span style="color:#000000;">, </span><em><span style="color:#0000ff;">LPARAM</span></em> <span style="color:#000080;">lParam</span><span style="color:#000000;">) </span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">{ </span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">DWORD</span> <span style="color:#000080;">dwCharSet</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">DEFAULT_CHARSET</span></em><span style="color:#000000;">;</span><span style="color:#008000;">//</span><span style="color:#008000;">默认字符集</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <span style="color:#000080;">cxClientMax</span><span style="color:#000000;">,</span><span style="color:#000080;">cyClientMax</span><span style="color:#000000;">,</span><span style="color:#000080;">cxClient</span><span style="color:#000000;">,</span><span style="color:#000080;">cyClient</span><span style="color:#000000;">,</span><span style="color:#000080;">cxChar</span><span style="color:#000000;">,</span><span style="color:#000080;">cyChar</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <span style="color:#0000ff;">int</span> <span style="color:#000080;">cLinesMax</span><span style="color:#000000;">,</span><span style="color:#000080;">cLines</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">PMSG</span></em> <span style="color:#000080;">pmsg</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">RECT</span></em> <span style="color:#000080;">rectScroll</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em> <span style="color:#000080;">szTop</span><span style="color:#000000;">[] = </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"Message       Key Char "</span><span style="color:#000000;">)</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"            Repeat Scan Ext ALT Prev Tran"</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em> <span style="color:#000080;">szUnd</span><span style="color:#000000;">[] = </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"_______       ___ ____ "</span><span style="color:#000000;">)</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"            ______ ____ ___ ___ ____ ____"</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;"> * </span><span style="color:#000080;">szFormat</span><span style="color:#000000;">[2] = {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">           <em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"%-13s %3d %-15s%c%6u %4d %3s %3s %4s %4s"</span><span style="color:#000000;">),</span></p> 
<p style="margin-left:0;text-align:left;">           <em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"%-13s            0x%04X%1s%c %6u %4d %3s %3s %4s %4s"</span><span style="color:#000000;">)</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">     };</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;"> * </span><span style="color:#000080;">szYes</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"Yes"</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;"> * </span><span style="color:#000080;">szNo</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"No"</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;"> * </span><span style="color:#000080;">szDown</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"Down"</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;"> * </span><span style="color:#000080;">szUp</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"Up"</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">static</span> <em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;"> * </span><span style="color:#000080;">szMessage</span><span style="color:#000000;">[] = {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"WM_KEYDOWN"</span><span style="color:#000000;">), </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"WM_KEYUP"</span><span style="color:#000000;">),</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"WM_CHAR"</span><span style="color:#000000;">), </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"WM_DEADCHAR"</span><span style="color:#000000;">),</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"WM_SYSKEYDOWN"</span><span style="color:#000000;">),</span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"WM_SYSKEYUP"</span><span style="color:#000000;">),</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"WM_SYSCHAR"</span><span style="color:#000000;">), </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">"WM_SYSDEADCHAR"</span><span style="color:#000000;">)</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">     };</span></p> 
<p style="margin-left:0;text-align:left;">     <em><span style="color:#0000ff;">HDC</span></em> <span style="color:#000080;">hdc</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">     <em><span style="color:#0000ff;">PAINTSTRUCT</span></em> <span style="color:#000080;">ps</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">int</span> <span style="color:#000080;">i</span><span style="color:#000000;">,</span><span style="color:#000080;">iType</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">     <em><span style="color:#0000ff;">TCHAR</span></em> <span style="color:#000080;">szBuffer</span><span style="color:#000000;">[128],</span><span style="color:#000080;">szKeyName</span><span style="color:#000000;">[32];</span></p> 
<p style="margin-left:0;text-align:left;">     <em><span style="color:#0000ff;">TEXTMETRIC</span></em> <span style="color:#000080;">tm</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">switch</span><span style="color:#000000;"> (</span><span style="color:#000080;">message</span><span style="color:#000000;">)</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">     {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#008000;">//</span><span style="color:#008000;">用于通知应用程序输入语言或输入法的变化。当用户在系统中切换输入语言或输入</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">法时，系统会发送 WM_INPUTLANGCHANGE 消息给相关的窗口。</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_INPUTLANGCHANGE</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">dwCharSet</span><span style="color:#000000;"> = </span><span style="color:#000080;">wParam</span><span style="color:#000000;">;</span><span style="color:#008000;">//</span><span style="color:#008000;">当前字体字符集</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#008000;">//</span><span style="color:#008000;">此处不能return 0;</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_CREATE</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_DISPLAYCHANGE</span></em><span style="color:#000000;">:</span><span style="color:#008000;">//</span><span style="color:#008000;">更改显示器配置</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#008000;">//</span><span style="color:#008000;">获取客户区最大尺寸</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">cxClientMax</span><span style="color:#000000;"> = </span><em><span style="color:#880000;">GetSystemMetrics</span></em><span style="color:#000000;">(</span><em><span style="color:#a000a0;">SM_CXMAXIMIZED</span></em><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">cyClientMax</span><span style="color:#000000;"> = </span><em><span style="color:#880000;">GetSystemMetrics</span></em><span style="color:#000000;">(</span><em><span style="color:#a000a0;">SM_CYMAXIMIZED</span></em><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">hdc</span><span style="color:#000000;"> = </span><em><span style="color:#880000;">GetDC</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#008000;">//</span><span style="color:#008000;">创建逻辑字体</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">SelectObject</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">,</span><em><span style="color:#880000;">CreateFont</span></em><span style="color:#000000;">(0,0,0,0,0,0,0,0,</span><span style="color:#000080;">dwCharSet</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">              0,0,0,</span><em><span style="color:#a000a0;">FIXED_PITCH</span></em><span style="color:#000000;">,</span><em><span style="color:#a000a0;">NULL</span></em><span style="color:#000000;">));</span><span style="color:#008000;">//</span><span style="color:#008000;">固定字宽</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#008000;">//</span><span style="color:#008000;">获取等宽字体信息</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">GetTextMetrics</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">,&amp;</span><span style="color:#000080;">tm</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">cxChar</span><span style="color:#000000;"> = </span><span style="color:#000080;">tm</span><span style="color:#000000;">.</span><em><span style="color:#000080;">tmAveCharWidth</span></em><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">cyChar</span><span style="color:#000000;"> = </span><span style="color:#000080;">tm</span><span style="color:#000000;">.</span><em><span style="color:#000080;">tmHeight</span></em><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">DeleteObject</span></em><span style="color:#000000;">(</span><em><span style="color:#880000;">SelectObject</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;">              <em><span style="color:#880000;">GetStockObject</span></em><span style="color:#000000;">(</span><em><span style="color:#a000a0;">SYSTEM_FONT</span></em><span style="color:#000000;">)));</span><span style="color:#008000;">//</span><span style="color:#008000;">删除逻辑字体</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">ReleaseDC</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">,</span><span style="color:#000080;">hdc</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">if</span><span style="color:#000000;">(</span><span style="color:#000080;">pmsg</span><span style="color:#000000;">)</span></p> 
<p style="margin-left:0;text-align:left;">               <em><span style="color:#a000a0;">free</span></em><span style="color:#000000;">(</span><span style="color:#000080;">pmsg</span><span style="color:#000000;">);</span><span style="color:#008000;">//</span><span style="color:#008000;">清空消息结构</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">cLinesMax</span><span style="color:#000000;"> = </span><span style="color:#000080;">cxClientMax</span><span style="color:#000000;"> / </span><span style="color:#000080;">cyChar</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">pmsg</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">malloc</span></em><span style="color:#000000;">(</span><span style="color:#000080;">cLinesMax</span><span style="color:#000000;">*</span><span style="color:#0000ff;">sizeof</span><span style="color:#000000;">(</span><em><span style="color:#0000ff;">MSG</span></em><span style="color:#000000;">));</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">cLines</span><span style="color:#000000;"> = 0;</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#008000;">//</span><span style="color:#008000;">未处理malloc异常</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">return</span><span style="color:#000000;"> 0;</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_SIZE</span></em><span style="color:#000000;">: </span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">if</span><span style="color:#000000;"> (</span><span style="color:#000080;">message</span><span style="color:#000000;"> == </span><em><span style="color:#a000a0;">WM_SIZE</span></em><span style="color:#000000;">)</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">          {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">               <span style="color:#000080;">cxClient</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">LOWORD</span></em><span style="color:#000000;">(</span><span style="color:#000080;">lParam</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">               <span style="color:#000080;">cyClient</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">HIWORD</span></em><span style="color:#000000;">(</span><span style="color:#000080;">lParam</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">          }</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#008000;">//</span><span style="color:#008000;">滚屏</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">rectScroll</span><span style="color:#000000;">.</span><em><span style="color:#000080;">left</span></em><span style="color:#000000;"> = 0;</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">rectScroll</span><span style="color:#000000;">.</span><em><span style="color:#000080;">right</span></em><span style="color:#000000;"> = </span><span style="color:#000080;">cxClient</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">rectScroll</span><span style="color:#000000;">.</span><em><span style="color:#000080;">top</span></em><span style="color:#000000;"> = </span><span style="color:#000080;">cyChar</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">rectScroll</span><span style="color:#000000;">.</span><em><span style="color:#000080;">bottom</span></em><span style="color:#000000;"> = </span><span style="color:#000080;">cyChar</span><span style="color:#000000;"> * (</span><span style="color:#000080;">cyClient</span><span style="color:#000000;"> / </span><span style="color:#000080;">cyChar</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">InvalidateRect</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">,</span><em><span style="color:#a000a0;">NULL</span></em><span style="color:#000000;">,</span><em><span style="color:#a000a0;">TRUE</span></em><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">return</span><span style="color:#000000;"> 0 ; </span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_KEYDOWN</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_KEYUP</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_CHAR</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_DEADCHAR</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_SYSCHAR</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_SYSDEADCHAR</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_SYSKEYDOWN</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_SYSKEYUP</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#008000;">//</span><span style="color:#008000;">重新调整数组存储顺序</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">for</span><span style="color:#000000;"> (</span><span style="color:#000080;">i</span><span style="color:#000000;"> = </span><span style="color:#000080;">cLinesMax</span><span style="color:#000000;"> - 1;</span><span style="color:#000080;">i</span><span style="color:#000000;"> &gt; 0;</span><span style="color:#000080;">i</span><span style="color:#000000;">--)</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">          {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">               <span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">] = </span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">-1];</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">          }</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#008000;">//</span><span style="color:#008000;">存储新的消息</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">pmsg</span><span style="color:#000000;">[0].</span><em><span style="color:#000080;">hwnd</span></em><span style="color:#000000;"> = </span><span style="color:#000080;">hwnd</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">pmsg</span><span style="color:#000000;">[0].</span><em><span style="color:#000080;">message</span></em><span style="color:#000000;"> = </span><span style="color:#000080;">message</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">pmsg</span><span style="color:#000000;">[0].</span><em><span style="color:#000080;">lParam</span></em><span style="color:#000000;"> = </span><span style="color:#000080;">lParam</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">pmsg</span><span style="color:#000000;">[0].</span><em><span style="color:#000080;">wParam</span></em><span style="color:#000000;"> = </span><span style="color:#000080;">wParam</span><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">cLines</span><span style="color:#000000;"> = </span><em><span style="color:#a000a0;">min</span></em><span style="color:#000000;">(</span><span style="color:#000080;">cLines</span><span style="color:#000000;"> + 1,</span><span style="color:#000080;">cLinesMax</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#008000;">//</span><span style="color:#008000;">向上滚动显示</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">ScrollWindow</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">,0,-</span><span style="color:#000080;">cyChar</span><span style="color:#000000;">,&amp;</span><span style="color:#000080;">rectScroll</span><span style="color:#000000;">,&amp;</span><span style="color:#000080;">rectScroll</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">break</span><span style="color:#000000;">;</span><span style="color:#008000;">//</span><span style="color:#008000;">不要使用return 返回。调用DefWindowProc，这样系统消息才能工作</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_PAINT</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#000080;">hdc</span><span style="color:#000000;"> = </span><em><span style="color:#880000;">BeginPaint</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">,&amp;</span><span style="color:#000080;">ps</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#008000;">//</span><span style="color:#008000;">创建逻辑字体---默认等宽字体</span></p> 
<p style="margin-left:0;text-align:left;">  <em><span style="color:#880000;">SelectObject</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;"><em><span style="color:#880000;">CreateFont</span></em><span style="color:#000000;">(0,0,0,0,0,0,0,0,</span><span style="color:#000080;">dwCharSet</span><span style="color:#000000;">,0,0,0,</span><em><span style="color:#a000a0;">FIXED_PITCH</span></em><span style="color:#000000;">,</span><em><span style="color:#a000a0;">NULL</span></em><span style="color:#000000;">));</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">SetBkMode</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">,</span><em><span style="color:#a000a0;">TRANSPARENT</span></em><span style="color:#000000;">);</span><span style="color:#008000;">//</span><span style="color:#008000;">设置透明模式</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">TextOut</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">,0,0,</span><span style="color:#000080;">szTop</span><span style="color:#000000;">,</span><em><span style="color:#880000;">lstrlen</span></em><span style="color:#000000;">(</span><span style="color:#000080;">szTop</span><span style="color:#000000;">));</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">TextOut</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">,0,0,</span><span style="color:#000080;">szUnd</span><span style="color:#000000;">,</span><em><span style="color:#880000;">lstrlen</span></em><span style="color:#000000;">(</span><span style="color:#000080;">szUnd</span><span style="color:#000000;">));</span></p> 
<p style="margin-left:0;text-align:left;">    </p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">for</span><span style="color:#000000;"> (</span><span style="color:#000080;">i</span><span style="color:#000000;"> = 0;</span><span style="color:#000080;">i</span><span style="color:#000000;"> &lt; </span><em><span style="color:#a000a0;">min</span></em><span style="color:#000000;">(</span><span style="color:#000080;">cLines</span><span style="color:#000000;">,</span><span style="color:#000080;">cyClient</span><span style="color:#000000;"> / </span><span style="color:#000080;">cyChar</span><span style="color:#000000;"> - 1);</span><span style="color:#000080;">i</span><span style="color:#000000;">++)</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">          {<!-- --></span></p> 
<p style="margin-left:0;text-align:left;">               <span style="color:#000080;">iType</span><span style="color:#000000;"> = </span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><em><span style="color:#000080;">message</span></em><span style="color:#000000;"> == </span><em><span style="color:#a000a0;">WM_CHAR</span></em><span style="color:#000000;"> ||</span></p> 
<p style="margin-left:0;text-align:left;">                    <span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><em><span style="color:#000080;">message</span></em><span style="color:#000000;"> == </span><em><span style="color:#a000a0;">WM_SYSCHAR</span></em><span style="color:#000000;"> ||</span></p> 
<p style="margin-left:0;text-align:left;">                    <span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><em><span style="color:#000080;">message</span></em><span style="color:#000000;"> == </span><em><span style="color:#a000a0;">WM_DEADCHAR</span></em><span style="color:#000000;"> ||</span></p> 
<p style="margin-left:0;text-align:left;">                    <span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><em><span style="color:#000080;">message</span></em><span style="color:#000000;"> == </span><em><span style="color:#a000a0;">WM_SYSDEADCHAR</span></em><span style="color:#000000;">;</span></p> 
<p style="margin-left:0;text-align:left;">               <span style="color:#008000;">//</span><span style="color:#008000;">获取按键字符名</span></p> 
<p style="margin-left:0;text-align:left;">               <em><span style="color:#880000;">GetKeyNameText</span></em><span style="color:#000000;">(</span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><em><span style="color:#000080;">lParam</span></em><span style="color:#000000;">, </span><span style="color:#000080;">szKeyName</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;">                    <span style="color:#0000ff;">sizeof</span><span style="color:#000000;">(</span><span style="color:#000080;">szKeyName</span><span style="color:#000000;">) / </span><span style="color:#0000ff;">sizeof</span><span style="color:#000000;">(</span><em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;">));</span></p> 
<p style="margin-left:0;text-align:left;">               <em><span style="color:#880000;">TextOut</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">, 0, (</span><span style="color:#000080;">cyClient</span><span style="color:#000000;"> / </span><span style="color:#000080;">cyChar</span><span style="color:#000000;"> - 1 - </span><span style="color:#000080;">i</span><span style="color:#000000;">) * </span><span style="color:#000080;">cyChar</span><span style="color:#000000;">, </span><span style="color:#000080;">szBuffer</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;">                    <em><span style="color:#880000;">wsprintf</span></em><span style="color:#000000;">(</span><span style="color:#000080;">szBuffer</span><span style="color:#000000;">, </span><span style="color:#000080;">szFormat</span><span style="color:#000000;">[</span><span style="color:#000080;">iType</span><span style="color:#000000;">],</span></p> 
<p style="margin-left:0;text-align:left;">                         <span style="color:#000080;">szMessage</span><span style="color:#000000;">[</span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><em><span style="color:#000080;">message</span></em><span style="color:#000000;"> - </span><em><span style="color:#a000a0;">WM_KEYFIRST</span></em><span style="color:#000000;">],</span></p> 
<p style="margin-left:0;text-align:left;">                         <span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><em><span style="color:#000080;">wParam</span></em><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                         (</span><em><span style="color:#0000ff;">PTSTR</span></em><span style="color:#000000;">)(</span><span style="color:#000080;">iType</span><span style="color:#000000;"> ? </span><em><span style="color:#a000a0;">TEXT</span></em><span style="color:#000000;">(</span><span style="color:#a31515;">" "</span><span style="color:#000000;">) : </span><span style="color:#000080;">szKeyName</span><span style="color:#000000;">),</span><span style="color:#008000;">//</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                         (</span><em><span style="color:#0000ff;">TCHAR</span></em><span style="color:#000000;">)(</span><span style="color:#000080;">iType</span><span style="color:#000000;"> ? </span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><em><span style="color:#000080;">wParam</span></em><span style="color:#000000;"> : </span><span style="color:#a31515;">' '</span><span style="color:#000000;">),</span></p> 
<p style="margin-left:0;text-align:left;">                         <em><span style="color:#a000a0;">LOWORD</span></em><span style="color:#000000;">(</span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><em><span style="color:#000080;">lParam</span></em><span style="color:#000000;">),</span></p> 
<p style="margin-left:0;text-align:left;">                         <em><span style="color:#a000a0;">HIWORD</span></em><span style="color:#000000;">(</span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><em><span style="color:#000080;">lParam</span></em><span style="color:#000000;">) &amp; 0xFF,</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                         0x01000000 &amp; </span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><em><span style="color:#000080;">lParam</span></em><span style="color:#000000;"> ? </span><span style="color:#000080;">szYes</span><span style="color:#000000;"> : </span><span style="color:#000080;">szNo</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                         0x20000000 &amp; </span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><em><span style="color:#000080;">lParam</span></em><span style="color:#000000;"> ? </span><span style="color:#000080;">szYes</span><span style="color:#000000;"> : </span><span style="color:#000080;">szNo</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                         0x40000000 &amp; </span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><em><span style="color:#000080;">lParam</span></em><span style="color:#000000;"> ? </span><span style="color:#000080;">szDown</span><span style="color:#000000;"> : </span><span style="color:#000080;">szUp</span><span style="color:#000000;">,</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">                         0x80000000 &amp; </span><span style="color:#000080;">pmsg</span><span style="color:#000000;">[</span><span style="color:#000080;">i</span><span style="color:#000000;">].</span><em><span style="color:#000080;">lParam</span></em><span style="color:#000000;"> ? </span><span style="color:#000080;">szUp</span><span style="color:#000000;"> : </span><span style="color:#000080;">szDown</span><span style="color:#000000;">));</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">          }</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">//</span><span style="color:#008000;">删除逻辑字体</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">DeleteObject</span></em><span style="color:#000000;">(</span><em><span style="color:#880000;">SelectObject</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hdc</span><span style="color:#000000;">,</span><em><span style="color:#880000;">GetStockObject</span></em><span style="color:#000000;">(</span><em><span style="color:#a000a0;">SYSTEM_FONT</span></em><span style="color:#000000;">))); </span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">EndPaint</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">,&amp;</span><span style="color:#000080;">ps</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">return</span><span style="color:#000000;"> 0;</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">case</span> <em><span style="color:#a000a0;">WM_DESTROY</span></em><span style="color:#000000;">:</span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="color:#880000;">PostQuitMessage</span></em><span style="color:#000000;">(0);</span></p> 
<p style="margin-left:0;text-align:left;">          <span style="color:#0000ff;">return</span><span style="color:#000000;"> 0;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">     }</span></p> 
<p style="margin-left:0;text-align:left;">     <span style="color:#0000ff;">return</span> <em><span style="color:#880000;">DefWindowProc</span></em><span style="color:#000000;">(</span><span style="color:#000080;">hwnd</span><span style="color:#000000;">, </span><span style="color:#000080;">message</span><span style="color:#000000;">, </span><span style="color:#000080;">wParam</span><span style="color:#000000;">, </span><span style="color:#000080;">lParam</span><span style="color:#000000;">);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#000000;">}</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">/***********************************************************************</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">CreateFont</span><span style="color:#008000;">函数：创建具有指定特性的逻辑字体。随后可以将逻辑字体选择为任何设备的字体。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">HFONT CreateFont(</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  int     nHeight,                // </span><span style="color:#008000;">字体的字符高度</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  int     nWidth,                 // </span><span style="color:#008000;">字体的字符宽度</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  int     nEscapement,            // </span><span style="color:#008000;">字体的字符倾斜角度</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  int     nOrientation,           // </span><span style="color:#008000;">字体的字符方向</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  int     fnWeight,               // </span><span style="color:#008000;">字体的粗细程度</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  DWORD   fdwItalic,              // </span><span style="color:#008000;">字体是否为斜体</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  DWORD   fdwUnderline,           // </span><span style="color:#008000;">字体是否有下划线</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  DWORD   fdwStrikeOut,           // </span><span style="color:#008000;">字体是否有删除线</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  DWORD   fdwCharSet,             // </span><span style="color:#008000;">字体的字符集</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  DWORD   fdwOutputPrecision,     // </span><span style="color:#008000;">字体的输出精度</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  DWORD   fdwClipPrecision,       // </span><span style="color:#008000;">字体的剪辑精度</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  DWORD   fdwQuality,             // </span><span style="color:#008000;">字体的质量</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  DWORD   fdwPitchAndFamily,      // </span><span style="color:#008000;">字体的字距和族</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">  LPCTSTR lpszFace                // </span><span style="color:#008000;">字体的名称</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">);</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">***************************************************************************</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">字符集</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">#define ANSI_CHARSET            0</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">#define DEFAULT_CHARSET         1</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">#define SYMBOL_CHARSET          2</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">#define SHIFTJIS_CHARSET        128</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">#define HANGEUL_CHARSET         129</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">#define HANGUL_CHARSET          129</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">#define GB2312_CHARSET          134</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">#define CHINESEBIG5_CHARSET     136</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">#define OEM_CHARSET             255</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">*******************************************************************************</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">WM_INPUTLANGCHANGE</span><span style="color:#008000;">消息：当窗口接收到WM_INPUTLANGCHANGE消息时，表示输入法发生了改变。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">并响应输入语言或输入法的变化，根据需要进行相应的处理，例如更新界面、重新布局等。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">#define WM_INPUTLANGCHANGE 0x0051</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">wParam</span><span style="color:#008000;">：该输入法使用的字符集。提示：可以使用TranslateCharsetInfo这个API得到字符集的信息。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#008000;">lParam</span><span style="color:#008000;">：该输入法的HKL（KeyboardLayout——键盘布局，也被称为 Input locale identifier —— 输入区域标识）。</span></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#008000;">*/</span></p> 
<p style="margin-left:0;text-align:justify;">       运行结果：</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="489" src="https://images2.imgbox.com/dd/9e/KBmN51av_o.png" width="659"></p> 
<p style="margin-left:0;text-align:justify;">图5-6 创建逻辑字体</p> 
<p style="margin-left:0;text-align:justify;"> <img alt="" height="5" src="https://images2.imgbox.com/1b/42/YLd6Gg5V_o.png" width="865"></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="78" src="https://images2.imgbox.com/96/ce/LtWcbGjT_o.png" width="77">总结</p> 
<p style="margin-left:0;text-align:justify;">       实例KEYVIEW2.C是实例KEYVIEW1.C的扩展，在KEYVIEW1.C的基础上，增加了创建逻辑字体，并使用新创建的逻辑字体显示键盘按键信息。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">       ■实例KEYVIEW2.C写的比较严谨。窗口过程处理WM_INPUTLANGCHANGE消息时，更新当前系统使用字符集：dwCharSet = wParam;//当前字体字符集。不需要返回，接着窗口过程处理WM_CREATE消息和WM_DISPLAYCHANGE消息，调用GetSystemMetrics函数获取当前窗口客户区的最大宽和高，然后调用CreateFont函数创建一个新的逻辑字体，并调用SelectObject函数将新创建的逻辑字体选入当前设备环境。最后调用GetTextMetrics函数获取已选入的新逻辑字体的字符宽和字符高。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">       ■CreateFont 函数用于创建一个逻辑字体（Logical Font）对象，该对象描述了要在设备上绘制文本时使用的字体属性。</p> 
<p style="margin-left:0;text-align:justify;">函数原型如下：</p> 
<p style="margin-left:0;text-align:justify;">       HFONT CreateFont(</p> 
<p style="margin-left:0;text-align:justify;">  int     nHeight,                           // 字体的字符高度</p> 
<p style="margin-left:0;text-align:justify;">  int     nWidth,                            // 字体的字符宽度</p> 
<p style="margin-left:0;text-align:justify;">  int     nEscapement,                   // 字体的字符倾斜角度</p> 
<p style="margin-left:0;text-align:justify;">  int     nOrientation,           // 字体的字符方向</p> 
<p style="margin-left:0;text-align:justify;">  int     fnWeight,                          // 字体的粗细程度</p> 
<p style="margin-left:0;text-align:justify;">  DWORD   fdwItalic,                      // 字体是否为斜体</p> 
<p style="margin-left:0;text-align:justify;">  DWORD   fdwUnderline,              // 字体是否有下划线</p> 
<p style="margin-left:0;text-align:justify;">  DWORD   fdwStrikeOut,              // 字体是否有删除线</p> 
<p style="margin-left:0;text-align:justify;">  DWORD   fdwCharSet,                 // 字体的字符集</p> 
<p style="margin-left:0;text-align:justify;">  DWORD   fdwOutputPrecision,    // 字体的输出精度</p> 
<p style="margin-left:0;text-align:justify;">  DWORD   fdwClipPrecision,         // 字体的剪辑精度</p> 
<p style="margin-left:0;text-align:justify;">  DWORD   fdwQuality,                  // 字体的质量</p> 
<p style="margin-left:0;text-align:justify;">  DWORD   fdwPitchAndFamily,     // 字体的字距和族</p> 
<p style="margin-left:0;text-align:justify;">  LPCTSTR lpszFace                          // 字体的名称</p> 
<p style="margin-left:0;text-align:justify;">);</p> 
<p style="margin-left:0;text-align:justify;">       ●参数说明：</p> 
<p style="margin-left:0;text-align:justify;">nHeight：字体的字符高度。可以使用正值、负值或零来指定字体的高度。正值表示像素高度，负值表示设备单位高度，零表示默认高度。</p> 
<p style="margin-left:0;text-align:justify;">nWidth：字体的字符宽度。通常使用零作为默认值。</p> 
<p style="margin-left:0;text-align:justify;">nEscapement：字体的字符倾斜角度（以 0.1 度为单位）。通常使用零作为默认值。</p> 
<p style="margin-left:0;text-align:justify;">nOrientation：字体的字符方向（以 0.1 度为单位）。通常使用零作为默认值。</p> 
<p style="margin-left:0;text-align:justify;">fnWeight：字体的粗细程度。可以是以下值之一：</p> 
<p style="margin-left:0;text-align:justify;">FW_DONTCARE：不指定粗细程度。</p> 
<p style="margin-left:0;text-align:justify;">FW_THIN：细字体。</p> 
<p style="margin-left:0;text-align:justify;">FW_NORMAL：普通字体。</p> 
<p style="margin-left:0;text-align:justify;">FW_BOLD：粗体。</p> 
<p style="margin-left:0;text-align:justify;">其他可用的粗细程度值。</p> 
<p style="margin-left:0;text-align:justify;">fdwItalic：字体是否为斜体。可以是 TRUE 表示斜体，或 FALSE 表示非斜体。</p> 
<p style="margin-left:0;text-align:justify;">fdwUnderline：字体是否有下划线。可以是 TRUE 表示有下划线，或 FALSE 表示无下划线。</p> 
<p style="margin-left:0;text-align:justify;">fdwStrikeOut：字体是否有删除线。可以是 TRUE 表示有删除线，或 FALSE 表示无删除线。</p> 
<p style="margin-left:0;text-align:justify;">fdwCharSet：字体的字符集。可以是以下之一：</p> 
<p style="margin-left:0;text-align:justify;">DEFAULT_CHARSET：默认字符集。</p> 
<p style="margin-left:0;text-align:justify;">ANSI_CHARSET：ANSI 字符集。</p> 
<p style="margin-left:0;text-align:justify;">SYMBOL_CHARSET：符号字符集。</p> 
<p style="margin-left:0;text-align:justify;">其他可用的字符集值。</p> 
<p style="margin-left:0;text-align:justify;">fdwOutputPrecision：字体的输出精度。通常使用 OUT_DEFAULT_PRECIS 作为默认值。</p> 
<p style="margin-left:0;text-align:justify;">fdwClipPrecision：字体的剪辑精度。通常使用 CLIP_DEFAULT_PRECIS 作为默认值。</p> 
<p style="margin-left:0;text-align:justify;">fdwQuality：字体的质量。可以是以下值之一：</p> 
<p style="margin-left:0;text-align:justify;">DEFAULT_QUALITY：默认质量。</p> 
<p style="margin-left:0;text-align:justify;">DRAFT_QUALITY：草稿质量。</p> 
<p style="margin-left:0;text-align:justify;">PROOF_QUALITY：校对质量。</p> 
<p style="margin-left:0;text-align:justify;">其他可用的质量值。</p> 
<p style="margin-left:0;text-align:justify;">fdwPitchAndFamily：字体的字距和族。通常使用 DEFAULT_PITCH 作为默认值。</p> 
<p style="margin-left:0;text-align:justify;">lpszFace：字体的名称。可以是字体的名称字符串，如 "Arial"、"Times New Roman" 等。</p> 
<p style="margin-left:0;text-align:justify;">●返回值：</p> 
<p style="margin-left:0;text-align:justify;">如果函数调用成功，返回值为创建的逻辑字体的句柄（HFONT）。</p> 
<p style="margin-left:0;text-align:justify;">如果函数调用失败，返回值为 NULL。</p> 
<p style="margin-left:0;text-align:justify;">使用 CreateFont 函数可以根据指定的参数创建一个逻辑字体对象，该对象可以用于在设备上绘制文本时指定字体的属性。创建的逻辑字体对象可以通过 SelectObject 函数选入设备环境中，从而在绘制文本时使用该字体。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">       ■窗口过程处理WM_PAINT消息，同样创建并选入新的逻辑字体用于显示输出。</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="5" src="https://images2.imgbox.com/16/90/aoTzLOjM_o.png" width="865"></p> 
<p style="margin-left:0;text-align:justify;"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/49d2ca360a95a5d254d40a01452a9e6e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Codeforces Round 954 (Div. 3) （A~F）（不会数学）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f2990e2efdedd21f43deabcf082b6852/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Spring】Spring Boot 快速入门</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>