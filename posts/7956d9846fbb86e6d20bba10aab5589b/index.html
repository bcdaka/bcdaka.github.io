<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>爬虫初学篇——看完这些还怕自己入门不了？ - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/7956d9846fbb86e6d20bba10aab5589b/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="爬虫初学篇——看完这些还怕自己入门不了？">
  <meta property="og:description" content="初次学习爬虫，知识笔记小分享
学scrapy框架可看：孤寒者博主的【Python爬虫必备—＞Scrapy框架快速入门篇——上】
目录🌟 一、🍉基础知识二、🍉http协议：三、🍉解析网页(1) xpath的用法：(2) bs4解析器的解释：(3) python字符编码的错误：(4) 正则表达式：(5) 拓展知识 四、🍉Requests库(1) Requests(2) Response对象的属性(3) 理解Requests库的异常：(4) 请求数据 (** kwargs参数) 五、🍉网络爬虫的“盗亦有道”(1) 网络爬虫的尺寸(2) 网络爬虫引发的问题(3) 网络爬虫的限制(4) Robots协议(5) 对Robots协议的理解 六、🍉实战案例(1) 京东商品页面的爬取(2) 亚马逊商品页面的爬取(3) 百度360搜索关键词提交(4) 网络图片的爬取和存储(5) ip地址归属地的自动获取 七、🍉Beautiful Soup库入门(1) 标签基本元素(2) 标签树下的下行遍历(3) 标签树的上行遍历(4) 标签树的平衡遍历 八、🍉信息组织与提取方法(1) 信息标记的三种形式(2) 信息提取的一般方法(3) find_all()方法 九、🍉实例：中国大学排名爬虫(1) 程序的结构设计(2) 中文对齐的问题的原因 十、🍉正则表达式(1) 正则表达式的概述(2) 正则表达式的语法和使用(3) 正则表达式的常用操作符(4) re库主要功能函数 十一、🍉实例：淘宝商品信息定向爬虫(1) 功能描述(2) 程序的结构设计 十二、🍉实例：股票数据定向爬虫(1) 功能描述：(2) 程序的结构设计 十三、🍉网络爬虫框架(1) Scrapy爬虫框架结构1. 爬虫框架2. 5&#43;2结构3. requests库和scrapy库的比较4. Scrapy 命令行：大部分操作都是通过命令行来实现 (2) Scrapy爬虫基本使用1. 步骤1：建立一个Scrapy爬虫工程2. 步骤2：在工程中产生一个Scrapy爬虫3. 步骤3：配置产生的spider 爬虫4. 步骤4：运行爬虫，获取网页5. `yield` 关键字【生成器】6. Scrapy爬虫的数据类型 (3) 实例：股票数据Scrapy实例1.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-06-17T12:57:00+08:00">
    <meta property="article:modified_time" content="2024-06-17T12:57:00+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">爬虫初学篇——看完这些还怕自己入门不了？</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>初次学习爬虫，知识笔记小分享<br> 学scrapy框架可看：<a href="https://blog.csdn.net/qq_44907926/article/details/119531324">孤寒者博主的【Python爬虫必备—＞Scrapy框架快速入门篇——上】</a></p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>目录🌟</h4> 
 <ul><li><ul><li><a href="#_9" rel="nofollow">一、🍉基础知识</a></li><li><a href="#http_23" rel="nofollow">二、🍉http协议：</a></li><li><a href="#_45" rel="nofollow">三、🍉解析网页</a></li><li><ul><li><a href="#1__xpath_47" rel="nofollow">(1) xpath的用法：</a></li><li><a href="#2__bs4_78" rel="nofollow">(2) bs4解析器的解释：</a></li><li><a href="#3__python_152" rel="nofollow">(3) python字符编码的错误：</a></li><li><a href="#4__252" rel="nofollow">(4) 正则表达式：</a></li><li><a href="#5__319" rel="nofollow">(5) 拓展知识</a></li></ul> 
   </li><li><a href="#Requests_336" rel="nofollow">四、🍉Requests库</a></li><li><ul><li><a href="#1_Requests_360" rel="nofollow">(1) Requests</a></li><li><a href="#2_Response_392" rel="nofollow">(2) Response对象的属性</a></li><li><a href="#3_Requests_406" rel="nofollow">(3) 理解Requests库的异常：</a></li><li><a href="#4___kwargs_445" rel="nofollow">(4) 请求数据 (** kwargs参数)</a></li></ul> 
   </li><li><a href="#_704" rel="nofollow">五、🍉网络爬虫的“盗亦有道”</a></li><li><ul><li><a href="#1__706" rel="nofollow">(1) 网络爬虫的尺寸</a></li><li><a href="#2__715" rel="nofollow">(2) 网络爬虫引发的问题</a></li><li><a href="#3__735" rel="nofollow">(3) 网络爬虫的限制</a></li><li><a href="#4_Robots_746" rel="nofollow">(4) Robots协议</a></li><li><a href="#5_Robots_765" rel="nofollow">(5) 对Robots协议的理解</a></li></ul> 
   </li><li><a href="#_788" rel="nofollow">六、🍉实战案例</a></li><li><ul><li><a href="#1__790" rel="nofollow">(1) 京东商品页面的爬取</a></li><li><a href="#2__806" rel="nofollow">(2) 亚马逊商品页面的爬取</a></li><li><a href="#3_360_826" rel="nofollow">(3) 百度360搜索关键词提交</a></li><li><a href="#4__869" rel="nofollow">(4) 网络图片的爬取和存储</a></li><li><a href="#5_ip_892" rel="nofollow">(5) ip地址归属地的自动获取</a></li></ul> 
   </li><li><a href="#Beautiful_Soup_909" rel="nofollow">七、🍉Beautiful Soup库入门</a></li><li><ul><li><a href="#1__911" rel="nofollow">(1) 标签基本元素</a></li><li><a href="#2__1010" rel="nofollow">(2) 标签树下的下行遍历</a></li><li><a href="#3__1048" rel="nofollow">(3) 标签树的上行遍历</a></li><li><a href="#4__1070" rel="nofollow">(4) 标签树的平衡遍历</a></li></ul> 
   </li><li><a href="#_1116" rel="nofollow">八、🍉信息组织与提取方法</a></li><li><ul><li><a href="#1__1118" rel="nofollow">(1) 信息标记的三种形式</a></li><li><a href="#2__1157" rel="nofollow">(2) 信息提取的一般方法</a></li><li><a href="#3_find_all_1175" rel="nofollow">(3) find_all()方法</a></li></ul> 
   </li><li><a href="#_1309" rel="nofollow">九、🍉实例：中国大学排名爬虫</a></li><li><ul><li><a href="#1__1310" rel="nofollow">(1) 程序的结构设计</a></li><li><a href="#2__1318" rel="nofollow">(2) 中文对齐的问题的原因</a></li></ul> 
   </li><li><a href="#_1372" rel="nofollow">十、🍉正则表达式</a></li><li><ul><li><a href="#1__1374" rel="nofollow">(1) 正则表达式的概述</a></li><li><a href="#2__1387" rel="nofollow">(2) 正则表达式的语法和使用</a></li><li><a href="#3__1406" rel="nofollow">(3) 正则表达式的常用操作符</a></li><li><a href="#4_re_1425" rel="nofollow">(4) re库主要功能函数</a></li></ul> 
   </li><li><a href="#_1672" rel="nofollow">十一、🍉实例：淘宝商品信息定向爬虫</a></li><li><ul><li><a href="#1__1674" rel="nofollow">(1) 功能描述</a></li><li><a href="#2__1680" rel="nofollow">(2) 程序的结构设计</a></li></ul> 
   </li><li><a href="#_1751" rel="nofollow">十二、🍉实例：股票数据定向爬虫</a></li><li><ul><li><a href="#1__1753" rel="nofollow">(1) 功能描述：</a></li><li><a href="#2__1770" rel="nofollow">(2) 程序的结构设计</a></li></ul> 
   </li><li><a href="#_1861" rel="nofollow">十三、🍉网络爬虫框架</a></li><li><ul><li><a href="#1_Scrapy_1863" rel="nofollow">(1) Scrapy爬虫框架结构</a></li><li><ul><li><a href="#1__1865" rel="nofollow">1. 爬虫框架</a></li><li><a href="#2_52_1870" rel="nofollow">2. 5+2结构</a></li><li><a href="#3_requestsscrapy_1930" rel="nofollow">3. requests库和scrapy库的比较</a></li><li><a href="#4_Scrapy__1955" rel="nofollow">4. Scrapy 命令行：大部分操作都是通过命令行来实现</a></li></ul> 
    </li><li><a href="#2_Scrapy_1987" rel="nofollow">(2) Scrapy爬虫基本使用</a></li><li><ul><li><a href="#1_1Scrapy_1998" rel="nofollow">1. 步骤1：建立一个Scrapy爬虫工程</a></li><li><a href="#2_2Scrapy_2041" rel="nofollow">2. 步骤2：在工程中产生一个Scrapy爬虫</a></li><li><a href="#3_3spider__2074" rel="nofollow">3. 步骤3：配置产生的spider 爬虫</a></li><li><a href="#4_4_2102" rel="nofollow">4. 步骤4：运行爬虫，获取网页</a></li><li><a href="#5_yield__2199" rel="nofollow">5. `yield` 关键字【生成器】</a></li><li><a href="#6_Scrapy_2272" rel="nofollow">6. Scrapy爬虫的数据类型</a></li></ul> 
    </li><li><a href="#3_Scrapy_2336" rel="nofollow">(3) 实例：股票数据Scrapy实例</a></li><li><ul><li><a href="#1_1Spider_2338" rel="nofollow">1. 步骤1：建立工程和Spider模板</a></li><li><a href="#2_2Spider_2365" rel="nofollow">2. 步骤2：编写Spider</a></li><li><a href="#3__3Pipelines_2415" rel="nofollow">3. 步骤3：编写Pipelines</a></li><li><a href="#4_ITEM_PIPELINES_2440" rel="nofollow">4. 配置ITEM_PIPELINES选项</a></li><li><a href="#5__2509" rel="nofollow">5. 配置并发连接选项</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h3><a id="_9"></a>一、🍉基础知识</h3> 
<ol><li>获取网页内容 
  <ol><li>http请求： 学习requests库 
    <ol><li>方法： 
      <ol><li>get方法：活得数据</li><li>post方法：创建数据</li></ol> </li></ol> </li></ol> </li><li>解析网页内容 
  <ol><li>学习html网页结构</li><li>学习beautiful soup库：解析获取到的html内容，提取信息</li></ol> </li><li>储存或者分析数据</li></ol> 
<hr> 
<h3><a id="http_23"></a>二、🍉http协议：</h3> 
<p>(1) http、Hypertext Transfer Protocol，超文本传输协议http是一个基于“请求与响应”模式的、无状态的应用层协议</p> 
<p>(2)基本格式：</p> 
<p>scheme://host[:post#]/path/……/[?query-string] [#anchor]</p> 
<table><thead><tr><th>名称</th><th>解释</th></tr></thead><tbody><tr><td>scheme</td><td>协议（例如：http，https，ftp）</td></tr><tr><td>host</td><td>服务器的IP地址或者域名</td></tr><tr><td>port#</td><td>服务器的端口（如果是走协议默认端口，缺省端口80）</td></tr><tr><td>path</td><td>访问资源的路径</td></tr><tr><td>query-string</td><td>参数，发送给http服务器的数据</td></tr><tr><td>anchor</td><td>锚（跳转到网页的指定锚点位置）</td></tr></tbody></table> 
<ul><li>当获取的网页代码出现乱码时，可能就是编码格式不一样，手动设置编码格式： 请内容 . encoding=’ 编码格式 ‘</li><li>URL是通过HTTP协议存取资源的Internet路径，一个URL对应一个数据资源</li></ul> 
<hr> 
<h3><a id="_45"></a>三、🍉解析网页</h3> 
<h4><a id="1__xpath_47"></a>(1) xpath的用法：</h4> 
<table><thead><tr><th align="center">表达式</th><th align="center">描述</th><th align="center">用法</th><th align="center">说明</th></tr></thead><tbody><tr><td align="center">nodename</td><td align="center">选取此节点的所有子节点</td><td align="center">div</td><td align="center">选取div下的所有标签</td></tr><tr><td align="center">//</td><td align="center">从全局节点中选择节点，任意位置均可</td><td align="center">//div</td><td align="center">选取整个HTML页面的所有div标签</td></tr><tr><td align="center">/</td><td align="center">选取某个节点下 的节点</td><td align="center">//head/title</td><td align="center">选取head标签下的title标签</td></tr><tr><td align="center">@</td><td align="center">选取某个属性的节点</td><td align="center">//div[@id]</td><td align="center">选取带有id属性的div标签</td></tr><tr><td align="center">.</td><td align="center">当前节点下</td><td align="center">./span</td><td align="center">选取当节点下的span标签【代码中威力强大】</td></tr></tbody></table> 
<ol><li> <p>etree.HTML(内容)：将不是html的格式的内容转换成html</p> </li><li> <p>etree.tostring(内容，encoding=‘UTF-8’).decode(‘UTF-8’):如果不是UTF-8编码格式的内容，这里可以更改成UTF-8的内容</p> </li><li> <p>etree.parse(文件路径)：parse对html导入python并解析</p> </li><li> <p>自定解析器：</p> <p>如果在浏览器上保存网页到本地，在python中获取.html文件需要利用自定解析器来解析文件内容</p> </li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 自定解析器</span>
parser<span class="token operator">=</span>etree<span class="token punctuation">.</span>HTMLParser<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span>
html<span class="token operator">=</span>etree<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>路径<span class="token punctuation">,</span>parser<span class="token operator">=</span>parser<span class="token punctuation">)</span>
result<span class="token operator">=</span>etree<span class="token punctuation">.</span>tostring<span class="token punctuation">(</span>html<span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'UTF-8'</span><span class="token punctuation">)</span>
</code></pre> 
<p>xpath中的[1]表示第一个元素，而python中的第一个是从0开始,例如：[0]</p> 
<hr> 
<h4><a id="2__bs4_78"></a>(2) bs4解析器的解释：</h4> 
<table><thead><tr><th align="center">解析器</th><th align="center">使用方法</th><th align="center">优势</th><th align="center">劣势</th></tr></thead><tbody><tr><td align="center">python标准库</td><td align="center">soup = BeautifulSoup(htmlt, ‘html.parser’)</td><td align="center">python内置标准库;执行速度适中</td><td align="center">python2.x或者python3.2x前的版本中文文档容错能力差</td></tr><tr><td align="center">lxml HTML解析器</td><td align="center">soup = BeautifulSoup(html, ‘lxml’)</td><td align="center">速度快；文档容错能力强</td><td align="center">需要安装c语言库</td></tr><tr><td align="center">lxml XML解析器</td><td align="center">soup = BeautifulSoup(html, ‘xml’)</td><td align="center">速度快；唯一支持XML的解析器</td><td align="center">需要安装c语言库</td></tr><tr><td align="center">html5lib</td><td align="center">soup = BeautifulSoup(html, ‘html5lib’)</td><td align="center">最好的容错性；以浏览器的方式解析文档；生成HTML5格式的文档；不依赖外部扩展库</td><td align="center">速度慢</td></tr></tbody></table> 
<p>可以使用列表的强制转换：</p> 
<blockquote> 
 <p>（1）bs4的使用时，soup获取的时bs4的元素类型</p> 
 <p>（2）使用list强制转换</p> 
</blockquote> 
<ol><li> <p>获取全部的单个标签：soup.find_all(‘标签’)</p> </li><li> <p>获取拥有指定属性的标签：</p> 
  <ol><li>soup.find_all(‘标签’，属性的键值对)</li><li>soup.find_all(‘标签’，attrs={键值对1，键值对2}) attrs是存储的是字典，里面可以包含html的多个属性</li></ol> </li><li> <p>获取多个指定属性的标签：</p> 
  <ul><li> <p>soup.find_all(‘标签’，属性的键值对1，属性的键值对2)</p> </li><li> <p>如果在获取时，出现python关键字与属性冲突时，在获取的时候添加一个下划线 ’ _ ’ ，例如：</p> <pre><code class="prism language-python">soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'div'</span>，class_<span class="token operator">=</span><span class="token string">'position'</span><span class="token punctuation">)</span>
</code></pre> </li></ul> </li><li> <p>获取标签属性值：</p> </li></ol> 
<p>​ 方法1:通过下标方式提取</p> 
<pre><code class="prism language-python"><span class="token number">1.</span>先锁定标签
alist<span class="token operator">=</span>soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> a <span class="token keyword">in</span> alist<span class="token punctuation">:</span>
    href<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>href<span class="token punctuation">)</span>
</code></pre> 
<p>​ 方法2：利用attrs参数提取</p> 
<pre><code class="prism language-python"><span class="token keyword">for</span> a <span class="token keyword">in</span> alist<span class="token punctuation">:</span>
	href<span class="token operator">=</span>a<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>href<span class="token punctuation">)</span>
</code></pre> 
<ol start="5"><li>获取标签内的文本信息:使用string方法</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 获取html的所有div标签，从第二个开始</span>
divs<span class="token operator">=</span>soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token comment"># 利用循环输出每个标签</span>
<span class="token keyword">for</span> div <span class="token keyword">in</span> divs<span class="token punctuation">:</span>
    <span class="token comment"># 只提取标签下的字符串</span>
    a<span class="token operator">=</span>div<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>string
    
<span class="token comment"># 提取整个div下的字符串</span>
divs<span class="token operator">=</span>soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> div <span class="token keyword">in</span> divs<span class="token punctuation">:</span>
    infos<span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span>stripped_strings<span class="token punctuation">)</span>  <span class="token comment"># stripped_strings方法是删除列表中的制表符，例如: "\n,\t"等</span>
</code></pre> 
<ol start="6"><li> <p>.get_text(strip=True):</p> <p>去除文本内容的前后空白</p> </li></ol> 
<hr> 
<h4><a id="3__python_152"></a>(3) python字符编码的错误：</h4> 
<p>​ UnicodeDecodeError: ‘utf-8’ codec can’t decode byte 0xca in position 339: invalid continuation byte——错误的原因是，尝试将字节数据解码为UTF-8编码的字符串时，遇到了一个无效的起始字节。UTF-8是一种流行的Unicode字符编码，它使用1到4个字节表示不同的Unicode字符。如果字节数据不符合UTF-8编码规则，就会引发此错误。</p> 
<p>解决方法：</p> 
<ol><li> <p>尝试使用其他编码格式</p> </li><li> <p>使用错误处理策略</p> <p><code>ignore</code>是忽略无效字符</p> <pre><code class="prism language-python">content <span class="token operator">=</span> response<span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'UTF-8'</span><span class="token punctuation">,</span>errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p>尝试不同的编码方式</p> </li></ol> 
<p>​ 如果无法确定字节数据的正确编码方式，可以尝试使用不同的编码方式进行解码，直到找到一个可以成功解码的方式。可以使用try-except语句来捕获解码错误，并尝试不同的编码方式：</p> 
<pre><code class="prism language-python">pythonCopy codedata <span class="token operator">=</span> <span class="token string">b'\xbc\xde\xcf\xbc'</span>
encodings <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> <span class="token string">'gbk'</span><span class="token punctuation">,</span> <span class="token string">'latin-1'</span><span class="token punctuation">]</span>  <span class="token comment"># 按照可能的编码方式顺序进行尝试</span>
decoded_data <span class="token operator">=</span> <span class="token boolean">None</span>
<span class="token comment"># 找到合适的编码</span>
<span class="token keyword">for</span> encoding <span class="token keyword">in</span> encodings<span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        decoded_data <span class="token operator">=</span> data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>encoding<span class="token punctuation">)</span>
        <span class="token keyword">break</span>
    <span class="token keyword">except</span> UnicodeDecodeError<span class="token punctuation">:</span>
        <span class="token keyword">continue</span>
<span class="token comment"># 如果找不到则为None      </span>
<span class="token keyword">if</span> decoded_data <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"无法解码字节数据"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>decoded_data<span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li>使用chardet库自动检测编码方式</li></ol> 
<p>如果无法确定字节数据的正确编码方式，可以使用chardet库来自动检测编码方式。chardet是一个第三方库，可以根据字节数据的特征自动检测编码方式。</p> 
<p>安装库：</p> 
<pre><code class="prism language-bash">pythonCopy codepip <span class="token function">install</span> chardet
</code></pre> 
<p>使用：</p> 
<pre><code class="prism language-python">pythonCopy codeimport chardet
data <span class="token operator">=</span> <span class="token string">b'\xbc\xde\xcf\xbc'</span>
result <span class="token operator">=</span> chardet<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
encoding <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">'encoding'</span><span class="token punctuation">]</span>
decoded_data <span class="token operator">=</span> data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>encoding<span class="token punctuation">)</span>
</code></pre> 
<p>排错：</p> 
<p>在Python爬虫中，即使代码看起来没有明显语法错误，爬取的数据仍然可能为空，这通常与以下因素有关：</p> 
<ol><li> <p><strong>目标网站结构改变</strong>：</p> 
  <ul><li>如果爬虫是基于HTML结构编写的，而目标网站进行了改版或更新，原有的选择器（如XPath或CSS Selector）可能不再有效，导致找不到预期的数据。</li></ul> </li><li> <p><strong>动态加载内容</strong>：</p> 
  <ul><li>网页上的数据可能是通过JavaScript动态加载的，直接爬取HTML源代码可能无法获取这些数据。此时需要分析网页加载逻辑，使用如Selenium、Pyppeteer等工具模拟浏览器行为，或者通过分析Ajax请求来间接获取数据。</li></ul> </li><li> <p><strong>反爬策略</strong>：</p> 
  <ul><li>目标网站可能启用了反爬虫策略，比如Cookies验证、User-Agent限制、IP封锁、验证码、登录验证等。这时，需要针对这些策略进行相应的处理，比如设置更真实的User-Agent、使用代理IP池、处理验证码或模拟登录。</li></ul> </li><li> <p><strong>请求参数不正确</strong>：</p> 
  <ul><li>请求头信息（headers）、cookies、POST数据等参数可能需要特殊配置才能获取数据，如果缺少必要参数或参数不正确，服务器可能不会返回有效数据。</li></ul> </li><li> <p><strong>网络问题</strong>：</p> 
  <ul><li>即使代码看似没问题，网络连接不稳定或服务器端出现问题也可能导致无法获取数据。</li></ul> </li><li> <p><strong>解析逻辑错误</strong>：</p> 
  <ul><li>数据解析环节可能出现问题，例如正则表达式匹配不正确，或者在解析HTML或JSON时引用了不存在的键或属性。</li></ul> </li><li> <p><strong>API调用权限或频率限制</strong>：</p> 
  <ul><li>若爬取的是API接口，可能存在调用频率限制、API密钥失效或没有必要的授权。</li></ul> </li><li> <p><strong>数据缓存问题</strong>：</p> 
  <ul><li>如果爬虫有缓存机制并且缓存了错误的结果，新的爬取可能会直接读取缓存而非从服务器获取新数据。</li></ul> </li></ol> 
<p>要解决这个问题，可以从以下几个步骤入手：</p> 
<ul><li>检查并确认请求网址是否正确且能够正常访问；</li><li>使用开发者工具查看网页加载过程，确认数据是如何加载和呈现的；</li><li>检查请求头和请求体是否符合目标网站的要求；</li><li>检查解析代码逻辑，特别是提取数据的部分；</li><li>检测网络状况以及是否有反爬措施，调整爬虫策略；</li><li>对于动态加载内容，确保相应脚本能够正确执行或模拟；</li><li>针对可能出现的API限制，合理安排请求间隔，遵循网站的使用协议。</li></ul> 
<hr> 
<h4><a id="4__252"></a>(4) 正则表达式：</h4> 
<ol><li>语法：reslut=re.match(‘匹配内容’，内容文件) 
  <ul><li>输出匹配：reslut.group()</li></ul> </li></ol> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">"""
    正则表达式，又称规则表达式（Regular Expression），是使用单个字符串来描述、匹配某个句法规则的字符串，常被用来检索、替换那些符合某个模式（规则）的文本
    正则的三个基础方法
        import re
        1.1从头开始搜索，开头第一个如果不匹配则匹配不成功
            re.match(匹配规则， 被匹配字符串)
        1.2 搜索整个容器，匹配则成功，不匹配返回None
            re.search(匹配规则， 被匹配字符串)
        1.3 匹配整个字符串，找出全部匹配项
            re.findall(匹配规则， 被匹配字符串)
        1.4 字符串的 r 标记，表示当前字符串是原始字符串，即内部的转义字符无效而是普通字符
        1.5 数量匹配：
            （1）* ：匹配前一个规则的字符出现0至无数次
            （2）+ ：匹配前一个规则的字符出现1至无数次 就是至少有一次
            （3）？ ：匹配前一个规则的字符出现0次或者1次
            （4）{m}:匹配前一个规则的字符出现m次
            （5）{m,}：匹配前一个规则的字符出现最少m次
            （6）{m,n}：匹配前一个规则的字符出现m到n次
        1.6 边界匹配
            （1）^ :匹配字符串开头
            （2）$ :匹配字符串结尾
            （3）\b :匹配一个单词的边界
            （4）\B :匹配非单词边界
       1.7 分组匹配
            （1）| :匹配左右任意一个表达式
            （2）() :将括号字符串作为一个分组
"""</span>
<span class="token keyword">import</span> re
<span class="token comment"># 练习</span>
s <span class="token operator">=</span> <span class="token string">" itheima1. @ @ python2 !!666  ##itcast3"</span>
<span class="token comment"># 匹配 . 使用\.</span>
re1<span class="token operator">=</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\.'</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re1<span class="token punctuation">)</span>
<span class="token comment"># 自定义匹配字符 使用[ ]</span>
re2<span class="token operator">=</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'[A-Z,\W]'</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re2<span class="token punctuation">)</span>
<span class="token comment"># 匹配整数 使用\d</span>
re3<span class="token operator">=</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\d'</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re3<span class="token punctuation">)</span>
<span class="token comment"># 匹配非数字 使用\D</span>
re4<span class="token operator">=</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\D'</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re4<span class="token punctuation">)</span>
<span class="token comment"># 匹配空格 和tab 使用 \s</span>
re5<span class="token operator">=</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\s'</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re5<span class="token punctuation">)</span>
<span class="token comment"># 匹配非空白 \S</span>
re6<span class="token operator">=</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\S'</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re6<span class="token punctuation">)</span>
<span class="token comment"># 匹配单字符 如：a-z A-Z 0—9 _\</span>
re7<span class="token operator">=</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\w'</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re7<span class="token punctuation">)</span>
<span class="token comment"># 匹配非单词字符 \W</span>
re8<span class="token operator">=</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\W'</span><span class="token punctuation">,</span>s<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re8<span class="token punctuation">)</span>
<span class="token comment"># 匹配账号，只能由字母和数字组成，长度限制6到10位</span>
<span class="token comment"># 规则为： ^[0-9a-zA-Z]{6, 10}$</span>
<span class="token comment"># 匹配QQ号，要求纯数字，长度5-11，第一位不为0</span>
<span class="token comment"># 规则为：^[1-9][0-9]{4, 10}&amp;</span>
<span class="token comment"># [1-9]匹配第一位，[0-9]匹配后面4到10位</span>
</code></pre> 
<hr> 
<h4><a id="5__319"></a>(5) 拓展知识</h4> 
<ol><li>爬取图片是不需要解码的</li></ol> 
<pre><code class="prism language-python">content<span class="token operator">=</span>response<span class="token punctuation">.</span>content
</code></pre> 
<ol start="2"><li>保存数据：wb是写入比特流数值</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'路径'</span><span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
	f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h3><a id="Requests_336"></a>四、🍉Requests库</h3> 
<p><a href="https://python123.io/student/courses/10673/groups" rel="nofollow">Python123</a></p> 
<p><code>学习流程图</code>：</p> 
<p><img src="https://images2.imgbox.com/80/09/itEk1hR3_o.png" alt="![外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传](https://img-home.csdnimg.cn/images/20230724024159.png?origin_url"></p> 
<hr> 
<p><code>python的集成工具：</code></p> 
<table><thead><tr><th align="center">文本工具类IDE</th><th align="center">集成工具类IDE</th></tr></thead><tbody><tr><td align="center">IDLE</td><td align="center">Pycharm</td></tr><tr><td align="center">Notepad++</td><td align="center">Wing</td></tr><tr><td align="center">Sublime Text</td><td align="center">PyDev &amp; Eclipse</td></tr><tr><td align="center">Vim &amp; Emacs</td><td align="center">Visual Studio</td></tr><tr><td align="center">Atom</td><td align="center">Anaconda &amp; Spyder</td></tr><tr><td align="center">Komodo Edit</td><td align="center">Canopy</td></tr></tbody></table> 
<p>推荐使用的是：Sublime Text 、Wing 、Pycharm 、Anaconda (科学计算机和数据分析的专题)</p> 
<h4><a id="1_Requests_360"></a>(1) Requests</h4> 
<ul><li> <p>自动爬取HTML页面，自动网络请求提交</p> </li><li> <p>最常用的是get请求方法</p> </li></ul> 
<table><thead><tr><th align="center">方法</th><th align="left">说明</th></tr></thead><tbody><tr><td align="center">requests.request()</td><td align="left">构造一个请求，支撑以下各方法的基础方法</td></tr><tr><td align="center">requests.get()</td><td align="left">获取html网页的主要方法，对应于http的get</td></tr><tr><td align="center">requests.head()</td><td align="left">获取html网页头信息的方法，对应于http的head</td></tr><tr><td align="center">requests.post()</td><td align="left">向html网页提交post请求的方法，对应于http的post</td></tr><tr><td align="center">requests.put()</td><td align="left">向html网页提交put请求的方法，对应于http的put</td></tr><tr><td align="center">requests.patch()</td><td align="left">向html网页提交局部修改请求，对应于http的patch</td></tr><tr><td align="center">requests.delete()</td><td align="left">向html页面提交删除请求，对应http的delete</td></tr></tbody></table> 
<ul><li> <p>理解patch和put的区别</p> <pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
假设url位置有一组数据UserInfo，包括UserID、UserName等20个字段
需求：用户修改了UserName，其他不变
- 采用patch，仅向url提交userName的局部更新请求
- 采用put，必须将所有20个字段一并提交到url，未提交字段被删除
patch的最主要好处：节省网络带宽
'''</span>
</code></pre> </li></ul> 
<h4><a id="2_Response_392"></a>(2) Response对象的属性</h4> 
<ul><li>请求：获取html网页</li></ul> 
<table><thead><tr><th align="center">属性</th><th align="left">说明</th></tr></thead><tbody><tr><td align="center">r.statu_code</td><td align="left">http请求的返回状态，200表示连接成功，其他表示失败或者另有原因</td></tr><tr><td align="center">r.text</td><td align="left">http响应内容的字符串形式，即，url对应的页面内容</td></tr><tr><td align="center">r.encoding</td><td align="left">从http header中猜测的响应内容编码方式</td></tr><tr><td align="center">r.apparent_encoding</td><td align="left">从内容中分析出的响应内容编码方式(备选编码方式)</td></tr><tr><td align="center">r.content</td><td align="left">http响应内容的二进制形式</td></tr></tbody></table> 
<h4><a id="3_Requests_406"></a>(3) 理解Requests库的异常：</h4> 
<ul><li> <p>网络连接有风险</p> </li><li> <p>异常处理很重要</p> </li></ul> 
<table><thead><tr><th>异常</th><th>说明</th></tr></thead><tbody><tr><td>requests.ConnectionError</td><td>网络连接错位于异常，如DNS查询失败，拒绝连接等</td></tr><tr><td>requests.HTTPError</td><td>http错误异常</td></tr><tr><td>requests.URLRequired</td><td>url缺失异常</td></tr><tr><td>requests.TooManyRedirects</td><td>超过最大重定向次数，产生重定向异常</td></tr><tr><td>requests.ConnectTimeout</td><td>连接远程服务器超时异常</td></tr><tr><td>requests.Timeout</td><td>请求URL超时，产生超时异常</td></tr><tr><td>r.raise_for_status() 【response】</td><td>如果不是200，产生异常requests.HTTPError</td></tr></tbody></table> 
<ul><li>使用try……except排错框架</li></ul> 
<pre><code class="prism language-bash"><span class="token function">import</span> requests

def getHTMLText<span class="token punctuation">(</span>url<span class="token punctuation">)</span>:
    try:
        <span class="token assign-left variable">r</span><span class="token operator">=</span>requests.get<span class="token punctuation">(</span>url,timeout<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
        <span class="token comment"># 如果状态不是200，引发HTTPError异常</span>
        r.raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token assign-left variable">r.encoding</span><span class="token operator">=</span>r.apparent_encoding
        <span class="token builtin class-name">return</span> r.text
    except:
        <span class="token builtin class-name">return</span> <span class="token string">"产生异常"</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__mian__"</span><span class="token builtin class-name">:</span>
    <span class="token assign-left variable">url</span><span class="token operator">=</span><span class="token string">"http://www.baidu.com"</span>
    print<span class="token punctuation">(</span>getHTMLText<span class="token punctuation">(</span>url<span class="token punctuation">))</span>
</code></pre> 
<hr> 
<h4><a id="4___kwargs_445"></a>(4) 请求数据 (** kwargs参数)</h4> 
<ul><li> <p>requests.request(method,url,** kwargs)</p> <p><code>**kwargs:控制访问的参数，均为可选项</code></p> <p>method：请求方式</p> </li></ul> 
<table><thead><tr><th align="center"></th><th>参数</th><th>说明</th></tr></thead><tbody><tr><td align="center">1</td><td>params</td><td>跟在url连接后面，查询（搜索）的含义，字典或者字流格式</td></tr><tr><td align="center">2</td><td>data</td><td>终点作为向服务器提供或提交资源时使用，字典、字节序列或文件对象，作为Request的内容</td></tr><tr><td align="center">3</td><td>json</td><td>JSON格式的数据，作为Request的内容</td></tr><tr><td align="center">4</td><td>headers</td><td>字典、HTTP定制头</td></tr><tr><td align="center">5</td><td>cookies</td><td>字典或CookieJar，Request中的cookie</td></tr><tr><td align="center">6</td><td>auth</td><td>元组，支持HTTP认证功能</td></tr><tr><td align="center">7</td><td>files</td><td>字典类型，传输文件</td></tr><tr><td align="center">8</td><td>timeout</td><td>设定超时时间，秒为单位</td></tr><tr><td align="center">9</td><td>poroxies</td><td>字典类型，设定访问代理服务器，可以增加登录认证</td></tr><tr><td align="center">10</td><td>allow_redirects</td><td>True/False,默认为True，重定向开关</td></tr><tr><td align="center">11</td><td>stream</td><td>True/False,默认为True，获取内容立即下载开关</td></tr><tr><td align="center">12</td><td>verify</td><td>True/False,默认为True，认证SSL证书开关</td></tr><tr><td align="center">13</td><td>cert</td><td>本地SSL证书路径</td></tr></tbody></table> 
<ol><li>params</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"https://example.com/search"</span>
params <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token string">"Python爬虫"</span><span class="token punctuation">,</span>
    <span class="token string">"page"</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span> <span class="token comment"># 最终得到url = https://example.com/search?query=Python爬虫&amp;page=1</span>
</code></pre> 
<ol start="2"><li>data</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"https://example.com/login"</span>
<span class="token comment"># 相当于填写表单数据，如登录表单，post请求</span>
data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"your_username"</span><span class="token punctuation">,</span>
    <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"your_password"</span>
<span class="token punctuation">}</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span> 
</code></pre> 
<ol start="3"><li> <p>json</p> <p><code>json</code>参数的作用是简化向API发送JSON数据的过程，确保了数据的正确序列化和HTTP头部的恰当设置，非常适合与那些期望接收JSON输入的现代Web服务交互。</p> </li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> json
url <span class="token operator">=</span> <span class="token string">"https://api.example.com/data"</span>
data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"key"</span><span class="token punctuation">:</span> <span class="token string">"value"</span><span class="token punctuation">,</span>
    <span class="token string">"another_key"</span><span class="token punctuation">:</span> <span class="token string">"another_value"</span>
<span class="token punctuation">}</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> json<span class="token operator">=</span>data<span class="token punctuation">)</span>
<span class="token comment"># 注意：requests库内部会自动将data转换为JSON字符串，</span>
<span class="token comment"># 并设置Content-Type为application/json</span>
<span class="token comment"># data是一个Python字典，通过json=data传递给requests.post方法后，requests会将其转换为JSON字符串{"key": "value", "another_key": "another_value"}并设置请求头，以表明发送的是JSON格式的数据。</span>
</code></pre> 
<ol start="4"><li> <p>headers</p> <p>实际上是http头的相关域，它对应了向某一个url访问时所发起的http头字段，利用这个字段定制某个访问url的http的协议头</p> 
  <ul><li><code>User-Agent</code>: 指定客户端的信息，很多网站会根据这个字段判断访问者是浏览器还是爬虫，有时需要将其设置为常见的浏览器字符串来避免被识别为爬虫。</li><li><code>Accept-Language</code>: 指定客户端接受的语言种类，可以帮助获取特定语言的网页内容。</li><li><code>Content-Type</code>: 当发送POST请求且包含请求体时，这个字段指定了数据的格式，如<code>application/x-www-form-urlencoded</code>、<code>application/json</code>等。</li><li><code>Authorization</code>: 如果网站需要认证，可以通过这个字段提供Token或其他认证信息。</li></ul> <pre><code class="prism language-python"><span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"https://example.com"</span>
headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3"</span><span class="token punctuation">,</span>
    <span class="token string">"Accept-Language"</span><span class="token punctuation">:</span> <span class="token string">"en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span> <span class="token comment"># 模仿浏览器，请求数据</span>
</code></pre> </li><li> <p>cookies</p> <p>从http中解析cookies，它可以是字典，也可以是cookieJar形式；</p> <p>解释：通过<code>cookies</code>参数携带相应的cookie信息，可以使爬虫模拟已登录用户的行为，访问那些需要登录后才能查看的内容。这在爬取需要身份验证的网站数据时尤为重要。</p> <p>作用：<code>cookies</code>参数在Python爬虫中的作用是模拟浏览器的cookie机制，帮助爬虫程序绕过登录限制，访问受保护的内容，或是维持与服务器的会话状态，提高数据抓取的准确性和效率。</p> <pre><code class="prism language-python"><span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"https://example.com/userinfo"</span>
cookies <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"sessionid"</span><span class="token punctuation">:</span> <span class="token string">"abcdef123456"</span><span class="token punctuation">,</span>
    <span class="token string">"user"</span><span class="token punctuation">:</span> <span class="token string">"example_user"</span>
<span class="token punctuation">}</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookies<span class="token punctuation">)</span>
</code></pre> </li><li> <p>auth</p> <p>字段是一个元组类型，它是支持http认证功能的，<code>auth</code>参数可以是一个元组，通常包含用户名和密码，或者是一个<code>AuthBase</code>的子类实例，用于自定义认证方案。</p> <pre><code class="prism language-python"><span class="token comment"># 基本HTTP认证</span>
<span class="token keyword">from</span> requests<span class="token punctuation">.</span>auth <span class="token keyword">import</span> HTTPBasicAuth
url <span class="token operator">=</span> <span class="token string">"https://api.example.com/private"</span>
username <span class="token operator">=</span> <span class="token string">"your_username"</span>
password <span class="token operator">=</span> <span class="token string">"your_password"</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> auth<span class="token operator">=</span>HTTPBasicAuth<span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># API密钥认证</span>
<span class="token keyword">class</span> <span class="token class-name">APITokenAuth</span><span class="token punctuation">(</span>requests<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>AuthBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>token <span class="token operator">=</span> token
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">:</span>
        r<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Authorization'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'Token </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>token<span class="token punctuation">}</span></span><span class="token string">'</span></span>
        <span class="token keyword">return</span> r
url <span class="token operator">=</span> <span class="token string">"https://api.example.com/data"</span>
token <span class="token operator">=</span> <span class="token string">"your_api_token"</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> auth<span class="token operator">=</span>APITokenAuth<span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># OAuth认证</span>
对于支持OAuth的API，虽然直接通过auth参数处理可能较为复杂（通常需要先通过一系列步骤获取访问令牌），但也可以根据具体流程封装认证逻辑到自定义的AuthBase子类中。
通过合理使用auth参数，Python爬虫能够安全有效地访问那些需要认证的资源，确保了数据请求的合法性与安全性。
</code></pre> </li><li> <p>files</p> <p>如何使用<code>files</code>参数上传一个图片文件</p> <pre><code class="prism language-python"><span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"https://example.com/upload"</span>
file_path <span class="token operator">=</span> <span class="token string">"/path/to/your/image.jpg"</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    files <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'image'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token string">'image/jpeg'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>  <span class="token comment"># 文件名，文件对象，MIME类型</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
</code></pre> <p>在这个例子中，我们首先打开要上传的图片文件，并以二进制模式读取(<code>'rb'</code>)。然后，我们将文件信息构造成一个字典，其中键 <code>'image'</code> 是服务器端预期接收文件的字段名，值是一个元组，包含文件名（这里也可以是任意字符串，服务器端可能会用作文件名）、文件对象和文件的MIME类型。最后，通过<code>requests.post()</code>方法发送POST请求，并将这个字典作为<code>files</code>参数传入。</p> <p><code>files</code>参数的使用让Python爬虫能够执行涉及文件上传的任务，如图片上传、文件分享网站的数据抓取等场景。</p> </li><li> <p>timeout</p> <p>用于设置网络请求的超时时间，如果一个请求超过指定的秒数还没有得到响应，<code>requests</code>库将会抛出一个异常，而不是无限期地等待下去</p> <pre><code class="prism language-python"><span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"https://example.com"</span>
timeout <span class="token operator">=</span> <span class="token number">5</span>  <span class="token comment"># 设置超时时间为5秒</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> timeout<span class="token operator">=</span>timeout<span class="token punctuation">)</span>
    <span class="token comment"># 处理响应数据</span>
<span class="token keyword">except</span> requests<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>Timeout<span class="token punctuation">:</span>
    <span class="token comment"># 超时处理逻辑</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"请求超时"</span><span class="token punctuation">)</span>
<span class="token comment"># 请求https://example.com在5秒内没有得到服务器的响应，程序将不会一直等待，而是立即执行except块中的代码，打印出“请求超时”的信息</span>
</code></pre> </li><li> <p>proxies</p> <p>解释：<code>proxies</code> 参数用于配置HTTP或HTTPS代理服务器。代理服务器作为中间人，可以接收你的爬虫程序发出的网络请求，然后转发给目标服务器，并将响应结果再返回给你的爬虫。</p> <p>目的：</p> 
  <ol><li><strong>匿名性</strong>：隐藏真实IP地址，防止被目标网站识别和封锁，尤其是在进行大量请求时，减少被封禁的风险。</li><li><strong>地域限制绕过</strong>：通过选择不同地区的代理服务器，可以访问地理位置受限的内容或服务，比如某些网站仅对特定国家或地区开放。</li><li><strong>性能优化</strong>：如果目标服务器对你的物理位置响应较慢，使用地理位置更近的代理服务器可以加快访问速度。</li><li><strong>负载均衡和带宽管理</strong>：企业级应用中，可能会利用代理服务器来分配请求，优化网络资源使用。</li></ol> <pre><code class="prism language-python"><span class="token keyword">import</span> requests
proxies <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"http"</span><span class="token punctuation">:</span> <span class="token string">"http://代理服务器地址:端口"</span><span class="token punctuation">,</span>
    <span class="token string">"https"</span><span class="token punctuation">:</span> <span class="token string">"https://代理服务器地址:端口"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://example.com"</span><span class="token punctuation">,</span> proxies<span class="token operator">=</span>proxies<span class="token punctuation">)</span>
</code></pre> <p>代码解释：<code>proxies</code>参数是一个字典，其中键为协议名（“http” 或 “https”），值为代理服务器的URL（包括协议、地址和端口）。这样，所有通过<code>requests</code>发起的请求都会通过指定的代理服务器进行。</p> <p>注意：使用代理时应遵守目标网站的使用条款和服务协议，合法合规地进行数据抓取，尊重网站的Robots协议，并尽量减少对目标服务器的负担。同时，选择稳定可靠的代理服务对于爬虫的成功运行至关重要。</p> </li><li> <p>allow_redirects</p> <p><code>requests</code>库会自动处理重定向，即自动向新的URL发送请求。当设置为<code>False</code>时，则不自动处理重定向，而是直接返回原始的重定向响应。</p> </li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token comment"># 允许重定向</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://example.com/redirect'</span><span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>url<span class="token punctuation">)</span>  <span class="token comment"># 最终重定向后的URL</span>
<span class="token comment"># 禁止重定向</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://example.com/redirect'</span><span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>  <span class="token comment"># 可能会得到一个重定向的状态码，如301或302</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'location'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 获取重定向的目标URL，而不是自动访问</span>
</code></pre> 
<ol start="11"><li> <p>stream</p> 
  <ul><li>解释：在使用Python的<code>requests</code>库进行网络请求时，<code>stream</code>参数是一个非常实用的选项，它的主要作用是控制是否立即下载响应内容。当设置<code>stream=True</code>时，<code>requests</code>不会立即下载整个响应体，而是等到你需要时才按需读取，这对于大文件下载或者仅需处理部分响应内容的场景非常有用</li><li><code>stream</code>参数的作用： 
    <ol><li>节省内存：对于大型文件的下载，如果直接下载整个响应体到内存中，可能会消耗大量内存资源。使用<code>stream=True</code>可以让数据边下载边处理，减少内存占用。</li><li>按需读取：当你只想读取响应的一部分内容，而不是全部时，使用流式处理可以更加高效。例如，你可能只需要检查响应的前几行来决定是否继续下载剩余内容。</li><li>长时间运行的连接：在某些情况下，保持连接打开并逐步处理响应内容是有益的，比如实时数据流处理。</li></ol> </li></ul> <pre><code class="prism language-python"><span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"http://example.com/large_file.zip"</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> stream<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 检查请求是否成功</span>
<span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
    <span class="token comment"># 打开一个本地文件用于保存下载的内容</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'large_file.zip'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        <span class="token keyword">for</span> chunk <span class="token keyword">in</span> response<span class="token punctuation">.</span>iter_content<span class="token punctuation">(</span>chunk_size<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
            <span class="token comment"># 如果chunk不是空的，才写入文件</span>
            <span class="token keyword">if</span> chunk<span class="token punctuation">:</span> 
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>
</code></pre> </li><li> <p>verify</p> 
  <ul><li><code>verify=True</code>，这意味着<code>requests</code>会验证服务器的SSL证书，确保与之建立的HTTPS连接是安全的，可以防止中间人攻击。</li><li>有时候你可能需要关闭这个验证，比如在测试环境中，或者当遇到自签名证书（self-signed certificate）或证书链不完整的情况，这时可以将<code>verify</code>设置为<code>False</code>。不过，这样做会降低安全性，应该谨慎考虑，并仅在确信不会导致安全问题的情况下使用。</li></ul> <pre><code class="prism language-python"><span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"https://example.com"</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p>cert</p> 
  <ul><li><code>cert</code>参数可以接收一个表示客户端证书文件路径的字符串，或者一个包含证书文件路径和私钥文件路径的元组。</li><li><code>cert</code> 参数用于指定HTTPS请求时的客户端证书。当目标网站或API需要客户端提供安全证书进行身份验证时，就需要用到这个参数。这对于访问那些启用了客户端证书认证的HTTPS服务尤为重要，比如一些内部系统、银行接口或是高度安全的API。</li></ul> <pre><code class="prism language-python"><span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"https://example.com/api/secure-endpoint"</span>
cert <span class="token operator">=</span> <span class="token string">"/path/to/client.pem"</span>  <span class="token comment"># 单个文件包含证书和私钥</span>
<span class="token comment"># 或者，如果证书和私钥分开：</span>
<span class="token comment"># cert = ("/path/to/cert.pem", "/path/to/key.pem")</span>
response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> cert<span class="token operator">=</span>cert<span class="token punctuation">)</span>
</code></pre> </li></ol> 
<hr> 
<h3><a id="_704"></a>五、🍉网络爬虫的“盗亦有道”</h3> 
<h4><a id="1__706"></a>(1) 网络爬虫的尺寸</h4> 
<table><thead><tr><th align="left">1</th><th>2</th><th>3</th></tr></thead><tbody><tr><td align="left">小规模，数据量爬取速度不敏感Requests库 &gt;90%</td><td>中规模，数据规模较大爬取速度敏感Scrapy库</td><td>大规模，搜索引擎爬取速度关键定制开发</td></tr><tr><td align="left">爬取网页 玩转网页</td><td>爬取网站 爬取系列网站</td><td>爬取全网</td></tr></tbody></table> 
<h4><a id="2__715"></a>(2) 网络爬虫引发的问题</h4> 
<ol><li> <p>骚扰问题</p> <p>网络爬虫的“性能骚扰”：web服务器默认接收人类访问。受限于编写水平和目的，网络爬虫将会为Web服务带来巨大的资源开销</p> </li><li> <p>法律风险</p> <p>服务器上的数据有产权归属，网络爬虫获取数据后牟利将带来法律风险</p> </li><li> <p>隐私泄露</p> <p>网络爬虫可能具备突破简单访问控制的能力，获得被保护数据从而泄露个人隐私</p> </li></ol> 
<h4><a id="3__735"></a>(3) 网络爬虫的限制</h4> 
<ul><li>来源审查：判断User-Agent进行限制 
  <ul><li>检查来访Http协议头的User-Agent域，只响应浏览器或友好爬虫的访问</li></ul> </li><li>发布公告：Robots协议 
  <ul><li>告知所有爬虫网站的爬取策略，要求爬虫遵守</li></ul> </li></ul> 
<h4><a id="4_Robots_746"></a>(4) Robots协议</h4> 
<ul><li> <p>Robots（Robots Exclusion Standard，网络爬虫排除标准协议）是机器人的意思。robots协议是放在网站的根目录上的，如果一个网站无robots协议，则是该网站允许所有爬虫爬取该网站，所有的爬虫都要遵循robots协议。</p> </li><li> <p>作用：网站告知网络爬虫哪些页面可以抓取，哪些不行</p> </li><li> <p>形式：在网站根目录下的robots.txt文件</p> </li><li> <p>robots协议基本语法：</p> </li></ul> 
<pre><code class="prism language-python"><span class="token comment"># disallow：表示不允许爬取的内容</span>
<span class="token comment"># *代表所有，/代表根目录</span>
</code></pre> 
<ul><li>Robots协议的使用 
  <ol><li>网络爬虫：自动或人工识别robots.txt，再进行内容爬取。</li><li>约束性：Robots协议是建议但非约束性，网络爬虫可以不遵守，但存在法律风险。</li></ol> </li></ul> 
<h4><a id="5_Robots_765"></a>(5) 对Robots协议的理解</h4> 
<table><thead><tr><th>1</th><th>2</th><th>3</th></tr></thead><tbody><tr><td>访问量很小：可以遵守 ； 访问量较大：建议遵守</td><td>非商业且偶尔：建议遵守 ； 商业利益：必须遵守</td><td>必须遵守</td></tr><tr><td>爬取网页 玩转网页</td><td>爬取网站 爬取系列网站</td><td>爬取全网</td></tr></tbody></table> 
<p>例如：</p> 
<pre><code class="prism language-bash">http://www.baidu.com/robots.txt
http://www.news,sina.com.cn/robots.txt
http://www.qq.com/robots.txt
http://news.qq.com/robots.txt
http://www.moe.edu.cn/robots.txt <span class="token punctuation">(</span>无robots协议<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_788"></a>六、🍉实战案例</h3> 
<h4><a id="1__790"></a>(1) 京东商品页面的爬取</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
url<span class="token operator">=</span><span class="token string">"https://item.jd.com/100077414769.html"</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 如果状态码是200则正常运行</span>
    r<span class="token punctuation">.</span>encoding<span class="token operator">=</span>r<span class="token punctuation">.</span>apparent_encoding
    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">1000</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"爬取失败"</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2__806"></a>(2) 亚马逊商品页面的爬取</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests

url<span class="token operator">=</span><span class="token string">"https://www.amazon.cn/gp/product/B01M8L5Z3Y"</span>
headers<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
    <span class="token string">"User-Agent"</span><span class="token punctuation">:</span><span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36"</span>
<span class="token punctuation">}</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 如果状态码是200则正常运行</span>
    r<span class="token punctuation">.</span>encoding<span class="token operator">=</span>r<span class="token punctuation">.</span>apparent_encoding
    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"爬取失败"</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="3_360_826"></a>(3) 百度360搜索关键词提交</h4> 
<ul><li>百度的关键词接口：</li></ul> 
<p>http://www.baidu.com/s?wd=<code>keyword</code></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests

url<span class="token operator">=</span><span class="token string">"http://www.baidu.com/s"</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    kv<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">'wd'</span><span class="token punctuation">:</span><span class="token string">'Python'</span>
    <span class="token punctuation">}</span>
    r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>params<span class="token operator">=</span>kv<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 如果状态码是200则正常运行</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"爬取失败"</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>360的关键词接口</li></ul> 
<p>http://www.so.com/s?q=<code>keyword</code></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests

url<span class="token operator">=</span><span class="token string">"http://www.so.com/s"</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    kv<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">'q'</span><span class="token punctuation">:</span><span class="token string">'Python'</span>
    <span class="token punctuation">}</span>
    r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>params<span class="token operator">=</span>kv<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 如果状态码是200则正常运行</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"爬取失败"</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="4__869"></a>(4) 网络图片的爬取和存储</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> os
url<span class="token operator">=</span><span class="token string">"http://image.nationalgeograhic.com.cn/2017/20170211061910157.jpg"</span>
root<span class="token operator">=</span><span class="token string">"F://music//"</span>
path <span class="token operator">=</span> root <span class="token operator">+</span>url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>root<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        r<span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>r<span class="token punctuation">.</span>content<span class="token punctuation">)</span>
            f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"文件保存成功"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"文件已存在"</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"爬取失败"</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="5_ip_892"></a>(5) ip地址归属地的自动获取</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests

url<span class="token operator">=</span><span class="token string">"http://m.ip138.com/ip.asp?ip="</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">'202.204.80.112'</span><span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>encoding<span class="token operator">=</span>r<span class="token punctuation">.</span>apparent_encoding
    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">500</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"爬取失败"</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="Beautiful_Soup_909"></a>七、🍉Beautiful Soup库入门</h3> 
<h4><a id="1__911"></a>(1) 标签基本元素</h4> 
<table><thead><tr><th>基本元素</th><th>说明</th></tr></thead><tbody><tr><td>Tag</td><td>标签，最基本的信息组织单元，分别用&lt;&gt;和&lt;/&gt;标明开头和结尾</td></tr><tr><td>Name</td><td>标签的名字，<p>……</p>的名字是‘p’，格式：.name</td></tr><tr><td>Attributes</td><td>标签的属性，字典形式组织，格式：.attrs</td></tr><tr><td>NavigableString</td><td>标签内非属性字符串，&lt;&gt;……&lt;/&gt;中字符串，格式：.string</td></tr><tr><td>Comment</td><td>标签内字符串的注释部分，一种特殊的Comment类型</td></tr></tbody></table> 
<ol><li> <p>最基本的信息单元</p> <pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
url<span class="token operator">=</span><span class="token string">"http://python123.io/ws/demo.html"</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    response<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    response<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
    html<span class="token operator">=</span>response<span class="token punctuation">.</span>text
    soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
    title<span class="token operator">=</span>soup<span class="token punctuation">.</span>title
    a<span class="token operator">=</span>soup<span class="token punctuation">.</span>a
    <span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span>a<span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"爬取失败"</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p>标签的名字</p> <pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
url<span class="token operator">=</span><span class="token string">"http://python123.io/ws/demo.html"</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    response<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    response<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
    html<span class="token operator">=</span>response<span class="token punctuation">.</span>text
    soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
    title<span class="token operator">=</span>soup<span class="token punctuation">.</span>title<span class="token punctuation">.</span>name <span class="token comment"># 获取标签的尖括号里面的内容</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"爬取失败"</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p>标签属性</p> <pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
url<span class="token operator">=</span><span class="token string">"http://python123.io/ws/demo.html"</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    response<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    response<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
    html<span class="token operator">=</span>response<span class="token punctuation">.</span>text
    soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
    a<span class="token operator">=</span>soup<span class="token punctuation">.</span>a
    <span class="token builtin">id</span><span class="token operator">=</span>a<span class="token punctuation">.</span>attrs <span class="token comment"># 查看a标签里的属性</span>
    id_class<span class="token operator">=</span>a<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span> <span class="token comment"># 获取属性的键值对，就是属性内容</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>id_class<span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"爬取失败"</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p>标签内非属性字符串</p> <pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
url<span class="token operator">=</span><span class="token string">"http://python123.io/ws/demo.html"</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    response<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    response<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
    html<span class="token operator">=</span>response<span class="token punctuation">.</span>text
    soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
    p<span class="token operator">=</span>soup<span class="token punctuation">.</span>p<span class="token punctuation">.</span>string
    <span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"爬取失败"</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p>标签内字符串的注释部分</p> <pre><code class="prism language-python"><span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
    soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span><span class="token string">"&lt;b&gt;&lt;!--This is a comment--&gt;&lt;/b&gt;&lt;p&gt;This is not a comment&lt;/p&gt;"</span><span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>b<span class="token punctuation">.</span>string<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"爬取失败"</span><span class="token punctuation">)</span>
</code></pre> </li></ol> 
<h4><a id="2__1010"></a>(2) 标签树下的下行遍历</h4> 
<table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>.contents</td><td>子节点的列表，将所有儿子节点存入列表</td></tr><tr><td>.children</td><td>子节点的迭代类型，与.contents类似，用于循环遍历儿子节点</td></tr><tr><td>.descendants</td><td>子孙节点的迭代类型，包含所有子孙节点，用于循环遍历</td></tr></tbody></table> 
<ol><li> <p>遍历下行</p> <pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
url<span class="token operator">=</span><span class="token string">"http://python123.io/ws/demo.html"</span>
response<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
head<span class="token operator">=</span>soup<span class="token punctuation">.</span>head<span class="token punctuation">.</span>contents
body<span class="token operator">=</span>soup<span class="token punctuation">.</span>body<span class="token punctuation">.</span>contents
<span class="token keyword">print</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
</code></pre> </li><li> <p>遍历下行</p> <pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
url<span class="token operator">=</span><span class="token string">"http://python123.io/ws/demo.html"</span>
response<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
<span class="token comment"># 遍历儿子节点</span>
<span class="token keyword">for</span> child <span class="token keyword">in</span> soup<span class="token punctuation">.</span>body<span class="token punctuation">.</span>children<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
<span class="token comment"># 遍历子孙节点</span>
<span class="token keyword">for</span> child <span class="token keyword">in</span> soup<span class="token punctuation">.</span>body<span class="token punctuation">.</span>descendants<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
</code></pre> </li></ol> 
<h4><a id="3__1048"></a>(3) 标签树的上行遍历</h4> 
<table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>.parent</td><td>节点的父亲标签</td></tr><tr><td>.parents</td><td>节点先辈标签的迭代类型，用于循环遍历辈点</td></tr></tbody></table> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
url<span class="token operator">=</span><span class="token string">"http://python123.io/ws/demo.html"</span>
response<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
title<span class="token operator">=</span>soup<span class="token punctuation">.</span>title<span class="token punctuation">.</span>parent
<span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
<span class="token keyword">for</span> parent <span class="token keyword">in</span> soup<span class="token punctuation">.</span>a<span class="token punctuation">.</span>parents<span class="token punctuation">:</span>
    <span class="token keyword">if</span> parent <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="4__1070"></a>(4) 标签树的平衡遍历</h4> 
<table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>.next_sibling</td><td>返回按照HTML文本顺序的下一个平行节点标签</td></tr><tr><td>.previous_sibling</td><td>返回按照HTML文本顺序的上一个平行节点标签</td></tr><tr><td>.next_siblings</td><td>迭代类型，返回按照HTML文本顺序的后续所有平行节点标签</td></tr><tr><td>.previous_siblings</td><td>迭代类型，返回按照HTML文本顺序的前续所有平行节点标签</td></tr></tbody></table> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
url<span class="token operator">=</span><span class="token string">"http://python123.io/ws/demo.html"</span>
response<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
a0<span class="token operator">=</span>soup<span class="token punctuation">.</span>a<span class="token punctuation">.</span>next_sibling
<span class="token keyword">print</span><span class="token punctuation">(</span>a0<span class="token punctuation">)</span>
a1<span class="token operator">=</span>soup<span class="token punctuation">.</span>a<span class="token punctuation">.</span>next_sibling<span class="token punctuation">.</span>next_sibling
<span class="token keyword">print</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span>
a2<span class="token operator">=</span>soup<span class="token punctuation">.</span>a<span class="token punctuation">.</span>previous_sibling
<span class="token keyword">print</span><span class="token punctuation">(</span>a2<span class="token punctuation">)</span>
a3<span class="token operator">=</span>soup<span class="token punctuation">.</span>a<span class="token punctuation">.</span>previous_sibling<span class="token punctuation">.</span>previous_sibling
<span class="token keyword">print</span><span class="token punctuation">(</span>a3<span class="token punctuation">)</span>
a4<span class="token operator">=</span>soup<span class="token punctuation">.</span>a<span class="token punctuation">.</span>parent
<span class="token keyword">print</span><span class="token punctuation">(</span>a4<span class="token punctuation">)</span>
<span class="token comment"># 遍历后续节点</span>
<span class="token keyword">for</span> sibling <span class="token keyword">in</span> soup<span class="token punctuation">.</span>a<span class="token punctuation">.</span>next_sibling<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>sibling<span class="token punctuation">)</span>
<span class="token comment"># 遍历前续节点</span>
<span class="token keyword">for</span> sibling <span class="token keyword">in</span> soup<span class="token punctuation">.</span>a<span class="token punctuation">.</span>previous_sibling<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>sibling<span class="token punctuation">)</span>
</code></pre> 
<ul><li> <p>.prettify()为HTML文本&lt;&gt;及其内容增加更加”\n“</p> </li><li> <p>.prettofuy()可用与标签，方法：.prettift()</p> </li></ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
url<span class="token operator">=</span><span class="token string">"http://python123.io/ws/demo.html"</span>
response<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>soup<span class="token punctuation">.</span>prettify<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_1116"></a>八、🍉信息组织与提取方法</h3> 
<h4><a id="1__1118"></a>(1) 信息标记的三种形式</h4> 
<p>json</p> 
<pre><code class="prism language-json"><span class="token string-property property">"key"</span><span class="token operator">:</span><span class="token string">"value"</span>
<span class="token string-property property">"key"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"value1"</span><span class="token punctuation">,</span><span class="token string">"value2"</span><span class="token punctuation">]</span>
<span class="token string-property property">"key"</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token string-property property">"subkey"</span><span class="token operator">:</span><span class="token string">"subvalue"</span><span class="token punctuation">}</span>
</code></pre> 
<ul><li>信息有类型，适合程序处理(js)，较XML简洁</li><li>移动应用云端和节点的信息通信，无注释</li></ul> 
<p>yaml</p> 
<pre><code class="prism language-yaml">key<span class="token punctuation">:</span>vlaue
key<span class="token punctuation">:</span><span class="token comment">#Comment</span>
<span class="token punctuation">-</span>vlaue1
<span class="token punctuation">-</span>vlaue2
<span class="token key atrule">key</span><span class="token punctuation">:</span>
	subkey<span class="token punctuation">:</span>subvlaue
</code></pre> 
<ul><li>信息无类型，文本信息比例最高，可读性好</li><li>各类系统的配置文件，有注释易读</li></ul> 
<p>xml</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>……<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
注释：<span class="token comment">&lt;!-- --&gt;</span>
</code></pre> 
<ul><li>最早的通用信息标记语言，可扩展性好，但繁琐。</li><li>Internet上的信息交互与传递</li></ul> 
<h4><a id="2__1157"></a>(2) 信息提取的一般方法</h4> 
<ul><li> <p>方法一：</p> <p>完整解析信息的标记形式，再提取关键信息。XML、JSON、YAML ，需要标记解析器；</p> <p>优点：信息解析准确；缺点：提取过程繁琐，速度慢。</p> </li><li> <p>方法二：</p> <p>无视标记形式，直接搜索关键信息。对信息的文本查找函数即可。</p> <p>优点：提取过程简洁，速度较快。缺点：提取结果准确性与信息内容相关</p> </li><li> <p>融合方法：</p> <p>结合形式解析与搜索方法，提取关键信息。XML、JSON、YAML、搜索。需要标记解析器及文本查找函数。</p> </li></ul> 
<h4><a id="3_find_all_1175"></a>(3) find_all()方法</h4> 
<pre><code class="prism language-python"><span class="token operator">&lt;&gt;</span><span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>name<span class="token punctuation">,</span>attrs<span class="token punctuation">,</span>recursive<span class="token punctuation">,</span>string<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">"""
返回一个列表类型，存储查找的结果
name：对标签名称的检索字符串
attrs：对标签属性值的检索字符串，可标注属性检索
recursive：是否对子孙全部检索，默认True
string：&lt;&gt;……&lt;/&gt;中字符串区域的检索字符串
"""</span>
</code></pre> 
<ol><li>name：</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://python123.io/ws/demo.html"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>r<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
<span class="token comment"># 单个标签查找</span>
a<span class="token operator">=</span>soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token comment"># 多个标签查找用列表</span>
b<span class="token operator">=</span>soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://python123.io/ws/demo.html"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>r<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> tag <span class="token keyword">in</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>tag<span class="token punctuation">.</span>name<span class="token punctuation">)</span>

<span class="token comment"># 返回结果</span>
<span class="token triple-quoted-string string">"""
html
head
title
body
p
b
p
a
a
"""</span>
</code></pre> 
<ol start="2"><li>attrs</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://python123.io/ws/demo.html"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>r<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
<span class="token comment"># 属性的查找</span>
link1<span class="token operator">=</span>soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'link1'</span><span class="token punctuation">,</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>link1<span class="token punctuation">)</span>
p<span class="token operator">=</span>soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span><span class="token string">'course'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> re
r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://python123.io/ws/demo.html"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>r<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
<span class="token comment"># 利用正则表达式的函数compile搜索属性单词搜索</span>
link<span class="token operator">=</span>soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">'lin'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>recursive</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> re
r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://python123.io/ws/demo.html"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>r<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
<span class="token comment"># 是否对子孙全部检索</span>
a<span class="token operator">=</span>soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span>recursive<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
</code></pre> 
<ol start="4"><li>string</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> re
r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://python123.io/ws/demo.html"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>r<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
<span class="token comment"># 搜索字符串</span>
<span class="token builtin">str</span><span class="token operator">=</span>soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>string<span class="token operator">=</span><span class="token string">'Basic Python'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span>
<span class="token comment"># 利用正则表达式搜索关键词</span>
python<span class="token operator">=</span>soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>string<span class="token operator">=</span>re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">'py'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>python<span class="token punctuation">)</span>
</code></pre> 
<ol start="5"><li>拓展：</li></ol> 
<table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>&lt;&gt;.find()</td><td>搜索且只返回一个结果，字符串类型，同.find_all参数</td></tr><tr><td>&lt;&gt;.find_parents()</td><td>在先辈节点中搜索，返回列表类型，同.find_all参数</td></tr><tr><td>&lt;&gt;.find_parent()</td><td>在先辈节点中返回一个结果，字符串类型，同.find_all参数</td></tr><tr><td>&lt;&gt;.find_next_siblings()</td><td>在后续平行节点中搜索，返回列表类型，同.find_all参数</td></tr><tr><td>&lt;&gt;.find_next_sibling()</td><td>在后续平行节点中返回一个结果，字符串类型，同.find_all参数</td></tr><tr><td>&lt;&gt;.find_previous_siblings()</td><td>在前序平行节点中搜索，返回列表类型，同.find_all参数</td></tr><tr><td>&lt;&gt;.find_previous_sibling()</td><td>在前序平行节点中返回一个结果，字符串类型，同.find_all参数</td></tr></tbody></table> 
<p>提取属性的方法：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://python123.io/ws/demo.html"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>r<span class="token punctuation">,</span><span class="token string">"html.parser"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> link <span class="token keyword">in</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    提取属性的三种方法
    """</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>link<span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>link<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'href'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>link<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><code>特</code>：soup(…) 等价于 soup.find_all(…)</p> 
<h3><a id="_1309"></a>九、🍉实例：中国大学排名爬虫</h3> 
<h4><a id="1__1310"></a>(1) 程序的结构设计</h4> 
<ul><li>步骤1：从网络上获取大学排名网页内容——getHTMLText()</li><li>步骤2：提取网页内容中信息到合适的数据结构——fillUnivList()</li><li>步骤3：利用数据结构展示并输出结果——printUnivList()</li></ul> 
<p><a href="https://www.shanghairanking.cn/rankings/bcur/2024" rel="nofollow">【软科排名】2024年最新软科中国大学排名|中国最好大学排名 (shanghairanking.cn)</a></p> 
<h4><a id="2__1318"></a>(2) 中文对齐的问题的原因</h4> 
<p><img src="https://images2.imgbox.com/e3/3a/4rxiRejO_o.png" alt="![外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传](https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=C%3A%5CUsers%5C29496%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20240520100132695.png&amp;pos_id=img-9t2WSPCM-1718533492537"></p> 
<table><thead><tr><th align="center">:</th><th align="center">&lt;填充&gt;</th><th align="center">&lt;对齐&gt;</th><th align="center">&lt;宽度&gt;</th><th align="center">,</th><th align="center">&lt;.精度&gt;</th><th align="center">&lt;类型&gt;</th></tr></thead><tbody><tr><td align="center">引导符号</td><td align="center">用于填充的单个字符</td><td align="center">&lt;左对齐 ；&gt; 右对齐；^剧中对齐</td><td align="center">槽的设定输出宽度</td><td align="center">数字的千位分隔符，适用于整数和浮点数</td><td align="center">浮点数小数部分的精度或字符串的最大输出长度</td><td align="center">整数类型b,c,d,o,x,X浮点数类型e,E,f,%</td></tr></tbody></table> 
<ul><li>中文对齐问题的解决：当中文字符宽度不够时，采用西文字符填充；中西文字符占用宽度不同，采用中文字符的空格填充<code>chr(12288)</code>.</li></ul> 
<p>代码块：<a href="https://www.icourse163.org/learn/BIT-1001870001?tid=1472329486#/learn/content?type=detail&amp;id=1258134685&amp;cid=1292474335" rel="nofollow">Python网络爬虫与信息提取_中国大学MOOC(慕课) (icourse163.org)</a></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> bs4
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> re

<span class="token keyword">def</span> <span class="token function">getHTMLText</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
        r<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
        r<span class="token punctuation">.</span>encoding<span class="token operator">=</span>r<span class="token punctuation">.</span>apparent_encoding
        <span class="token keyword">return</span> r<span class="token punctuation">.</span>text
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"网页信息爬取错误"</span>

<span class="token keyword">def</span> <span class="token function">fillUnivList</span><span class="token punctuation">(</span>ulist<span class="token punctuation">,</span> html<span class="token punctuation">)</span><span class="token punctuation">:</span>
    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">"html.parser"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> tr <span class="token keyword">in</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'tbody'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>children<span class="token punctuation">:</span>
        <span class="token comment"># 检测tr标签的类型的类型，如果tr标签的类型不是bs4库定义的tag类型，将过滤掉</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>tr<span class="token punctuation">,</span>bs4<span class="token punctuation">.</span>element<span class="token punctuation">.</span>Tag<span class="token punctuation">)</span><span class="token punctuation">:</span>
            tds<span class="token operator">=</span>tr<span class="token punctuation">(</span><span class="token string">'td'</span><span class="token punctuation">)</span>
            ulist<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>tds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>string<span class="token punctuation">,</span>tds<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>string<span class="token punctuation">,</span>tds<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>string<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">printUnivList</span><span class="token punctuation">(</span>ulist<span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tplt<span class="token operator">=</span><span class="token string">"{0:10}\t{1:{3}^10}\t{2:^10}"</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"{:10}\t{:^6}\t{:^10}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"排名"</span><span class="token punctuation">,</span><span class="token string">"学校名称"</span><span class="token punctuation">,</span><span class="token string">"总分"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
        u<span class="token operator">=</span>ulist<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>tplt<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>u<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>u<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>u<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">12288</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    uinfo<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    url<span class="token operator">=</span><span class="token string">""</span>
    html<span class="token operator">=</span>getHTMLText<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    fillUnivList<span class="token punctuation">(</span>uinfo<span class="token punctuation">,</span>html<span class="token punctuation">)</span>
    printUnivList<span class="token punctuation">(</span>uinfo<span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span>

</code></pre> 
<hr> 
<h3><a id="_1372"></a>十、🍉正则表达式</h3> 
<h4><a id="1__1374"></a>(1) 正则表达式的概述</h4> 
<ul><li>通用的字符串表达框架</li><li>简洁表达一组字符串的表达式</li><li>针对字符串表达“简洁”和“特征”思想的工具</li><li>判断某字符串的特征归属</li></ul> 
<p>正则表达式在文本处理中十分常用</p> 
<ol><li>表达式文本类型的特征（病毒、入侵等）</li><li>同时查找或替换一组字符串</li><li>匹配字符串的全部或部分</li></ol> 
<h4><a id="2__1387"></a>(2) 正则表达式的语法和使用</h4> 
<ol><li> <p>语法：</p> <p>正则表达式语法由字符和操作符构成</p> </li></ol> 
<pre><code class="prism language-python">P<span class="token punctuation">(</span>Y<span class="token operator">|</span>YT<span class="token operator">|</span>YTH<span class="token operator">|</span>YTHO<span class="token punctuation">)</span>?N
</code></pre> 
<ol start="2"><li> <p>使用</p> <p>编译：将符合正则表达式语法的字符串转换成正则表达式特征。</p> </li></ol> 
<p><img src="https://images2.imgbox.com/12/c7/lmdO0KDe_o.png" alt=""></p> 
<h4><a id="3__1406"></a>(3) 正则表达式的常用操作符</h4> 
<table><thead><tr><th>操作符</th><th>说明</th><th>实例</th></tr></thead><tbody><tr><td>.</td><td>表示任何单个字符，除”\n“以外</td><td></td></tr><tr><td>[ ]</td><td>字符集，对单个字符给出取值范围</td><td>[abc]表示a、b、c，[a-z]表示a到z单个字符</td></tr><tr><td>[^ ]</td><td>非字符集，对单个字符给出排除范围</td><td>[^abc]表示非a或b或c的单个字符</td></tr><tr><td>*</td><td>前一个字符0次或无限次扩展</td><td>abc*表示ab、abc、abcc、abcc等</td></tr><tr><td>+</td><td>前一个字符1次或无限次扩展</td><td>abc+表示abc、abcc、abccc等</td></tr><tr><td>?</td><td>前一个字符0次或1次扩展</td><td>abc？表示av、abc</td></tr><tr><td>|</td><td>左右表达式任意一个</td><td>abc|def表示abc、def</td></tr><tr><td>{m}</td><td>扩展前一个字符m次</td><td>ab{2}c表示abbc</td></tr><tr><td>{m,n}</td><td>扩展前一个字符m至n次(含n)</td><td>ab{1，2}c表示abc、abbc</td></tr><tr><td>^</td><td>匹配字符串开头</td><td>^abc表示abc且在一个字符串的开头</td></tr><tr><td>$</td><td>匹配字符串结尾</td><td>abc$表示abc且在一个字符串的结尾</td></tr><tr><td>()</td><td>分组标记，内部只能使用|操作符</td><td>(abc)表示abc，(abc|def)表示abc、def</td></tr><tr><td>\d</td><td>数字，等价于[0-9]</td><td></td></tr><tr><td>\w</td><td>单词字符，等价于[A-Za-z0-9]</td><td></td></tr></tbody></table> 
<h4><a id="4_re_1425"></a>(4) re库主要功能函数</h4> 
<table><thead><tr><th>函数</th><th>说明</th></tr></thead><tbody><tr><td>re.search(pattern, string)</td><td>在一个字符串中搜索匹配正则表达式的第一个位置，返回match对象</td></tr><tr><td>re.match(pattern, string)</td><td>从一个字符串的开始位置起匹配正则表达式，返回match对象</td></tr><tr><td>re.findall(pattern, string)</td><td>搜索字符串，以列表类型返回全部能匹配的子串</td></tr><tr><td>re.split(pattern, string)</td><td>将一个字符串按照正则表达式匹配结果进行分割，返回列表类型</td></tr><tr><td>re.finditer(pattern, string)</td><td>搜索字符串，返回一个匹配结果的迭代类型，每个迭代元素是match对象</td></tr><tr><td>re.sub(pattern, string)</td><td>在一个字符串中替换所有匹配正则表达式的字串，返回替换后的字符串</td></tr><tr><td>re.compile(pattern[, flags])</td><td></td></tr><tr><td>re.escape(string)</td><td></td></tr></tbody></table> 
<hr> 
<p><code>re</code>模块中常用函数的简单介绍：</p> 
<p>语法：</p> 
<pre><code class="prism language-python">re<span class="token punctuation">.</span>函数<span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> string，flags<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>pattern：正则表达式的字符串或原生字符串表示</li><li>string：待匹配字符串</li><li>flags：正则表达式使用时的控制标记</li></ul> 
<ol><li> <p><strong>re.search(pattern, string，flags=0)</strong>:<br> 在字符串中搜索匹配正则表达式<code>pattern</code>的第一个位置，返回一个匹配对象，如果没有找到匹配的，则返回None。</p> <pre><code class="prism language-python"><span class="token keyword">import</span> re
<span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'\d+'</span><span class="token punctuation">,</span> <span class="token string">'hello 123 world'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'找到匹配:'</span><span class="token punctuation">,</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'未找到匹配'</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p><strong>re.match(pattern, string，flags=0)</strong>:<br> 从字符串的起始位置匹配正则表达式<code>pattern</code>，如果起始位置没有匹配到，则返回None。注意这与<code>search()</code>不同，<code>search()</code>会扫描整个字符串以查找匹配项。</p> <pre><code class="prism language-python"><span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">r'\d+'</span><span class="token punctuation">,</span> <span class="token string">'123 hello world'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'找到匹配:'</span><span class="token punctuation">,</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'未找到匹配'</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p><strong>re.findall(pattern, string)</strong>:<br> 返回字符串中所有与正则表达式<code>pattern</code>相匹配的所有非重叠匹配项的列表。如果未找到匹配项，则返回空列表。</p> <pre><code class="prism language-python">matches <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\b\w+\b'</span><span class="token punctuation">,</span> <span class="token string">'Hello World! This is a test.'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>matches<span class="token punctuation">)</span>
<span class="token comment"># 输出：['Hello', 'World', 'This', 'is', 'a', 'test']</span>
</code></pre> </li><li> <p><strong>re.sub(pattern, repl, string, count=0, flags)</strong>:<br> 将字符串中所有与正则表达式<code>pattern</code>匹配的部分替换为<code>repl</code>，并返回修改后的字符串。<code>count</code>参数可以指定替换的最大次数，默认为0，表示替换所有匹配项。</p> <pre><code class="prism language-python">result <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'\d+'</span><span class="token punctuation">,</span> <span class="token string">'NUMBER'</span><span class="token punctuation">,</span> <span class="token string">'hello 123 world 456'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token comment"># 输出：'hello NUMBER world NUMBER'</span>
</code></pre> </li><li> <p><strong>re.compile(pattern[, flags])</strong>:<br> 编译正则表达式字符串为一个正则表达式对象，这样可以提高使用相同模式进行多次匹配的效率。</p> <pre><code class="prism language-python">pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'\d+'</span><span class="token punctuation">)</span>
<span class="token keyword">match</span> <span class="token operator">=</span> pattern<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">'123 hello'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'找到匹配:'</span><span class="token punctuation">,</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p><strong>re.escape(string)</strong>:<br> 转义字符串中的特殊字符，使得它们在正则表达式中作为字面值字符对待。</p> <pre><code class="prism language-python">pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>escape<span class="token punctuation">(</span><span class="token string">'['</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">r'\d+'</span> <span class="token operator">+</span> re<span class="token punctuation">.</span>escape<span class="token punctuation">(</span><span class="token string">']'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">match</span> <span class="token operator">=</span> pattern<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'[123]'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'找到匹配:'</span><span class="token punctuation">,</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p><strong>re.split(pattern,string,maxsplit=0,flags=0)</strong>:</p> <p>将一个字符串按照正则表达式匹配进行分割返回列表类型</p> 
  <ul><li>maxsplit：最大分割数，剩余部分作为最后一个元素输出</li></ul> <pre><code class="prism language-python"><span class="token keyword">import</span> re
result1<span class="token operator">=</span>re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r'[1-9]\d{5}'</span><span class="token punctuation">,</span><span class="token string">'BIT100081 TSU100084'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result1<span class="token punctuation">)</span>
result2<span class="token operator">=</span>re<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">r'[1-9]\d{5}'</span><span class="token punctuation">,</span><span class="token string">'BIT100081 TSU100084'</span><span class="token punctuation">,</span>maxsplit<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span>
</code></pre> </li><li> <p><strong>re.finditer(pattern, string)</strong>:</p> <p>搜索字符串，返回一个匹配结果的迭代类型，每个迭代元素是，match对象</p> <pre><code class="prism language-python"><span class="token keyword">import</span> re
<span class="token keyword">for</span> m <span class="token keyword">in</span> re<span class="token punctuation">.</span>finditer<span class="token punctuation">(</span><span class="token string">r'[1-9]\d{5}'</span><span class="token punctuation">,</span><span class="token string">'BIT100081 TSU100084'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> m<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> </li></ol> 
<p><code>拓展</code>:</p> 
<ol><li>re库的另一种等价用法：</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 第一种 函数式用法：一次性操作</span>
rst<span class="token operator">=</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'[1-9]\d{5}'</span><span class="token punctuation">,</span><span class="token string">'BIT 100081'</span><span class="token punctuation">)</span>
<span class="token comment"># 第二种 面对对象用法：编译后的多次操作</span>
pat<span class="token operator">=</span>ree<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'[1-9]\d{5}'</span><span class="token punctuation">)</span>
rst<span class="token operator">=</span>pat<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'BIT 100081'</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="2"><li> <p>match对象介绍</p> <p>Match对象一次匹配的结果，包含匹配的很多信息</p> <pre><code class="prism language-python"><span class="token keyword">import</span> re
<span class="token keyword">match</span><span class="token operator">=</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'[1-9]\d{5}'</span><span class="token punctuation">,</span><span class="token string">'BIT 100081'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <p>match对象的属性：</p> 
  <table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>.string</td><td>待匹配的文本</td></tr><tr><td>.re</td><td>匹配时使用的patter对象（正则表达式）</td></tr><tr><td>.pos</td><td>正则表达式搜索文本的开始位置</td></tr><tr><td>.endpos</td><td>正则表达式搜索文本的结束位置</td></tr></tbody></table><p>match对象的方法：</p> 
  <table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>.group(0)</td><td>获得匹配的字符串</td></tr><tr><td>.start()</td><td>匹配字符串在原始字符串的开始位置</td></tr><tr><td>.end()</td><td>匹配字符串在原始字符串的结束位置</td></tr><tr><td>.span()</td><td>返回(.start(),.end())</td></tr></tbody></table><pre><code class="prism language-python"><span class="token keyword">import</span> re
<span class="token keyword">match</span><span class="token operator">=</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'[1-9]\d{5}'</span><span class="token punctuation">,</span><span class="token string">'BIT100081 TSU100084'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>string<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>re<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>pos<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>endpos<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>end<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>span<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> </li><li> <p>贪婪匹配</p> <p>Re默认采用贪婪匹配，即输出匹配最长的字串</p> <pre><code class="prism language-python"><span class="token keyword">import</span> re
<span class="token keyword">match</span><span class="token operator">=</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'PY.*N'</span><span class="token punctuation">,</span><span class="token string">'PYANBNCNDN'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <p>最小匹配：如何输出最短的子串呢？</p> <pre><code class="prism language-python"><span class="token keyword">import</span> re
<span class="token keyword">match</span><span class="token operator">=</span>re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'PY.*?N'</span><span class="token punctuation">,</span><span class="token string">'PYANBNCNDN'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <p>最小匹配操作符</p> 
  <table><thead><tr><th>操作符</th><th>说明</th></tr></thead><tbody><tr><td>*？</td><td>前一个字符0次或无限次扩展，最小匹配</td></tr><tr><td>+？</td><td>前一个字符1次或无限次扩展，最小匹配</td></tr><tr><td>？？</td><td>前一个字符0次或1次扩展，最小匹配</td></tr><tr><td>{m，n}？</td><td>扩展前一个字符m至n次（含n），最小匹配</td></tr></tbody></table></li><li> <p>典型例子：</p> <p>在Python中，可以使用<code>re</code>模块（正则表达式模块）来匹配IP地址。一个基本的IPv4地址由四个0到255之间的数字组成，每部分之间用点(“.”)分隔。下面是一个简单的例子，展示了如何编写一个正则表达式来匹配这样的IP地址：</p> </li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> re

<span class="token keyword">def</span> <span class="token function">is_valid_ip</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 定义IP地址的正则表达式</span>
    ip_pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'^((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$'</span><span class="token punctuation">)</span>
    <span class="token comment"># 使用正则表达式匹配IP地址</span>
    <span class="token keyword">if</span> ip_pattern<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>
    
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># 测试函数</span>
    ips <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"192.168.1.1"</span><span class="token punctuation">,</span> <span class="token string">"255.255.255.255"</span><span class="token punctuation">,</span> <span class="token string">"123.456.789.0"</span><span class="token punctuation">,</span> <span class="token string">"1.2.3"</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> ip <span class="token keyword">in</span> ips<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>ip<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>is_valid_ip<span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre> 
<p>这段代码首先导入了<code>re</code>模块，并定义了一个函数<code>is_valid_ip</code>，该函数使用一个正则表达式来检查输入的字符串是否符合IPv4地址的格式。正则表达式的详细解释如下：</p> 
<ul><li><code>^</code>：表示字符串的开始。</li><li><code>((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}</code>：这部分匹配前三部分的数字，每部分数字范围是0到255，后面跟着一个点(“.”)。其中， 
  <ul><li><code>25[0-5]</code> 匹配从250到255的数字，</li><li><code>2[0-4][0-9]</code> 匹配从200到249的数字，</li><li><code>[01]?[0-9][0-9]?</code> 匹配0到199的数字，包括前导零的情况。</li><li><code>\.</code> 表示匹配点字符本身（因为点在正则表达式中有特殊含义，所以需要用反斜杠转义）。</li></ul> </li><li><code>(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$</code>：这部分匹配第四部分的数字，后面跟上字符串的结束标志<code>$</code>。</li></ul> 
<p>经典正则表达式实例：</p> 
<table><thead><tr><th>表达式</th><th>解释</th></tr></thead><tbody><tr><td>^ [A-Z a-z]+$</td><td>由26个字母组成的字符串</td></tr><tr><td>^ [A-Z a-Z 0-9]+$</td><td>由26个字母和数字组成的字符串</td></tr><tr><td>^-?\d+$</td><td>整数形式的字符串</td></tr><tr><td>^ [0-9] * [1-9] [0-9] * $</td><td>正整数形式的字符串</td></tr><tr><td>[1-9] \d{5}</td><td>中国境内邮政编码，6位</td></tr><tr><td>[\u 4e00-\u9fa5]</td><td>匹配中文字符</td></tr><tr><td>\d {3}-d{8}|\d{4}-\d{7}</td><td>国内电话号码，010-68913536</td></tr></tbody></table> 
<hr> 
<h3><a id="_1672"></a>十一、🍉实例：淘宝商品信息定向爬虫</h3> 
<h4><a id="1__1674"></a>(1) 功能描述</h4> 
<ul><li>目标：获取淘宝搜索页面的信息，提取其中的商品名称和价格</li><li>理解：淘宝的搜索接口、翻页的处理</li><li>技术路线：requests-re</li></ul> 
<h4><a id="2__1680"></a>(2) 程序的结构设计</h4> 
<p>步骤1：提交商品搜索请求，循坏获取页面。</p> 
<pre><code class="prism language-bash">https://s.taobao.com/search?initiative_id<span class="token operator">=</span>staobaoz_20240525<span class="token operator">&amp;</span><span class="token assign-left variable">page</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token assign-left variable">q</span><span class="token operator">=</span>%E4%B9%A6%E5%8C%85<span class="token operator">&amp;</span><span class="token assign-left variable">tab</span><span class="token operator">=</span>all
https://s.taobao.com/search?initiative_id<span class="token operator">=</span>staobaoz_20240525<span class="token operator">&amp;</span><span class="token assign-left variable">page</span><span class="token operator">=</span><span class="token number">2</span><span class="token operator">&amp;</span><span class="token assign-left variable">q</span><span class="token operator">=</span>%E4%B9%A6%E5%8C%85<span class="token operator">&amp;</span><span class="token assign-left variable">tab</span><span class="token operator">=</span>all
https://s.taobao.com/search?initiative_id<span class="token operator">=</span>staobaoz_20240525<span class="token operator">&amp;</span><span class="token assign-left variable">page</span><span class="token operator">=</span><span class="token number">3</span><span class="token operator">&amp;</span><span class="token assign-left variable">q</span><span class="token operator">=</span>%E4%B9%A6%E5%8C%85<span class="token operator">&amp;</span><span class="token assign-left variable">tab</span><span class="token operator">=</span>all
https://s.taobao.com/search?page<span class="token operator">=</span><span class="token number">2</span><span class="token operator">&amp;</span><span class="token assign-left variable">q</span><span class="token operator">=</span>%E4%B9%A6%E5%8C%85<span class="token operator">&amp;</span><span class="token assign-left variable">tab</span><span class="token operator">=</span>all
https://s.taobao.com/search?page<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token assign-left variable">q</span><span class="token operator">=</span>%E4%B9%A6%E5%8C%85<span class="token operator">&amp;</span><span class="token assign-left variable">tab</span><span class="token operator">=</span>all
https://s.taobao.com/search?page<span class="token operator">=</span><span class="token number">3</span><span class="token operator">&amp;</span><span class="token assign-left variable">q</span><span class="token operator">=</span>%E4%B9%A6%E5%8C%85<span class="token operator">&amp;</span><span class="token assign-left variable">tab</span><span class="token operator">=</span>all
</code></pre> 
<p>步骤2：对于每个页面，提取商品名称和价格信息</p> 
<p>步骤3：将信息输出到屏幕上。</p> 
<p><code>代码块</code>：</p> 
<pre><code class="prism language-python"><span class="token comment">#CrowTaobaoPrice.py</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> re

<span class="token keyword">def</span> <span class="token function">getHTMLText</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>
        r<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
        r<span class="token punctuation">.</span>encoding <span class="token operator">=</span> r<span class="token punctuation">.</span>apparent_encoding
        <span class="token keyword">return</span> r<span class="token punctuation">.</span>text
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">""</span>
    
<span class="token keyword">def</span> <span class="token function">parsePage</span><span class="token punctuation">(</span>ilt<span class="token punctuation">,</span> html<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        plt <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\"view_price\"\:\"[\d\.]*\"'</span><span class="token punctuation">,</span>html<span class="token punctuation">)</span>
        tlt <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\"raw_title\"\:\".*?\"'</span><span class="token punctuation">,</span>html<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>plt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            price <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>plt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            title <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>tlt<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            ilt<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>price <span class="token punctuation">,</span> title<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">printGoodsList</span><span class="token punctuation">(</span>ilt<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tplt <span class="token operator">=</span> <span class="token string">"{:4}\t{:8}\t{:16}"</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>tplt<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"序号"</span><span class="token punctuation">,</span> <span class="token string">"价格"</span><span class="token punctuation">,</span> <span class="token string">"商品名称"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    count <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> g <span class="token keyword">in</span> ilt<span class="token punctuation">:</span>
        count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>tplt<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> g<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> g<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    goods <span class="token operator">=</span> <span class="token string">'书包'</span>
    depth <span class="token operator">=</span> <span class="token number">3</span>
    start_url <span class="token operator">=</span> <span class="token string">'https://s.taobao.com/search?q='</span> <span class="token operator">+</span> goods
    infoList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>depth<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            url <span class="token operator">=</span> start_url <span class="token operator">+</span> <span class="token string">'&amp;s='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">44</span><span class="token operator">*</span>i<span class="token punctuation">)</span>
            html <span class="token operator">=</span> getHTMLText<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
            parsePage<span class="token punctuation">(</span>infoList<span class="token punctuation">,</span> html<span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
    printGoodsList<span class="token punctuation">(</span>infoList<span class="token punctuation">)</span>
    
main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h3><a id="_1751"></a>十二、🍉实例：股票数据定向爬虫</h3> 
<h4><a id="1__1753"></a>(1) 功能描述：</h4> 
<ul><li>目标：获取上交所和深交所所有股票的名称和交易信息</li><li>输出：保存到文件中</li><li>技术路线：requests-bs4-re</li></ul> 
<p>候选数据网站的选择</p> 
<pre><code class="prism language-bash">新浪股票:http://finance.sina.com.cn/stock/
百度股票:https://gupiao.baidu.com/stock/
</code></pre> 
<ul><li>选取原则：股票信息静态存在于HTML页面中，非js代码生成，没有Robots协议限制。</li><li>选取方法：浏览器F12，源代码查看等。</li><li>选取心态：不要纠结于某个网络，多找信息源，选择尝试</li></ul> 
<h4><a id="2__1770"></a>(2) 程序的结构设计</h4> 
<pre><code class="prism language-python">东方财富网：http<span class="token punctuation">:</span><span class="token operator">//</span>quote<span class="token punctuation">.</span>eastmoney<span class="token punctuation">.</span>com<span class="token operator">/</span>stocklist<span class="token punctuation">.</span>html
百度股票：https<span class="token punctuation">:</span><span class="token operator">//</span>gupiao<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token operator">/</span>stock<span class="token operator">/</span>
单个股票：https<span class="token punctuation">:</span><span class="token operator">//</span>gupiao<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token operator">/</span>stock<span class="token operator">/</span>sz002439<span class="token punctuation">.</span>html
</code></pre> 
<ul><li> <p>步骤1：从东方财富网获取股票列表</p> <p>步骤2：根据股票列表逐个到百度股票获取个股信息</p> </li><li> <p>步骤3：将结果存储到文件</p> </li></ul> 
<p><code>代码块</code>：</p> 
<pre><code class="prism language-python"><span class="token comment">#CrawBaiduStocksB.py</span>
<span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> traceback
<span class="token keyword">import</span> re

<span class="token keyword">def</span> <span class="token function">getHTMLText</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> code<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        r<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
        r<span class="token punctuation">.</span>encoding <span class="token operator">=</span> code
        <span class="token keyword">return</span> r<span class="token punctuation">.</span>text
    <span class="token keyword">except</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">""</span>

<span class="token keyword">def</span> <span class="token function">getStockList</span><span class="token punctuation">(</span>lst<span class="token punctuation">,</span> stockURL<span class="token punctuation">)</span><span class="token punctuation">:</span>
    html <span class="token operator">=</span> getHTMLText<span class="token punctuation">(</span>stockURL<span class="token punctuation">,</span> <span class="token string">"GB2312"</span><span class="token punctuation">)</span>
    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span> 
    a <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            href <span class="token operator">=</span> i<span class="token punctuation">.</span>attrs<span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span>
            lst<span class="token punctuation">.</span>append<span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r"[s][hz]\d{6}"</span><span class="token punctuation">,</span> href<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>

<span class="token keyword">def</span> <span class="token function">getStockInfo</span><span class="token punctuation">(</span>lst<span class="token punctuation">,</span> stockURL<span class="token punctuation">,</span> fpath<span class="token punctuation">)</span><span class="token punctuation">:</span>
    count <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> stock <span class="token keyword">in</span> lst<span class="token punctuation">:</span>
        url <span class="token operator">=</span> stockURL <span class="token operator">+</span> stock <span class="token operator">+</span> <span class="token string">".html"</span>
        html <span class="token operator">=</span> getHTMLText<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> html<span class="token operator">==</span><span class="token string">""</span><span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            infoDict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
            soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>
            stockInfo <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span>attrs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span><span class="token string">'stock-bets'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

            name <span class="token operator">=</span> stockInfo<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>attrs<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'class'</span><span class="token punctuation">:</span><span class="token string">'bets-name'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            infoDict<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'股票名称'</span><span class="token punctuation">:</span> name<span class="token punctuation">.</span>text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            
            keyList <span class="token operator">=</span> stockInfo<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'dt'</span><span class="token punctuation">)</span>
            valueList <span class="token operator">=</span> stockInfo<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'dd'</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>keyList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                key <span class="token operator">=</span> keyList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>text
                val <span class="token operator">=</span> valueList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>text
                infoDict<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val
            
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fpath<span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span> <span class="token builtin">str</span><span class="token punctuation">(</span>infoDict<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span> <span class="token punctuation">)</span>
                count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\r当前进度: {:.2f}%"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>count<span class="token operator">*</span><span class="token number">100</span><span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>lst<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\r当前进度: {:.2f}%"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>count<span class="token operator">*</span><span class="token number">100</span><span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>lst<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span>
            <span class="token keyword">continue</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    stock_list_url <span class="token operator">=</span> <span class="token string">'http://quote.eastmoney.com/stocklist.html'</span>
    stock_info_url <span class="token operator">=</span> <span class="token string">'https://gupiao.baidu.com/stock/'</span>
    output_file <span class="token operator">=</span> <span class="token string">'D:/BaiduStockInfo.txt'</span>
    slist<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    getStockList<span class="token punctuation">(</span>slist<span class="token punctuation">,</span> stock_list_url<span class="token punctuation">)</span>
    getStockInfo<span class="token punctuation">(</span>slist<span class="token punctuation">,</span> stock_info_url<span class="token punctuation">,</span> output_file<span class="token punctuation">)</span>

main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h3><a id="_1861"></a>十三、🍉网络爬虫框架</h3> 
<h4><a id="1_Scrapy_1863"></a>(1) Scrapy爬虫框架结构</h4> 
<h5><a id="1__1865"></a>1. 爬虫框架</h5> 
<ul><li>爬虫框架是实现爬虫功能的一个软件结构和功能组件集合</li><li>爬虫框架是一个半成品，能够帮助用户实现专业网络爬虫</li></ul> 
<h5><a id="2_52_1870"></a>2. 5+2结构</h5> 
<p><img src="https://images2.imgbox.com/e8/fe/Li11g6Ie_o.png" alt="在这里插入图片描述"></p> 
<p>数据流的三个路径</p> 
<blockquote> 
 <ol><li>Engine从Spider处获得爬取请求（Requests）</li><li>Engine将爬取请求转发给Scheduler，用于调度</li><li>Engine从Scheduler处获得下一个要爬取的请求</li><li>Engine将爬取请求通过中间件发送给Downloader</li><li>爬取网页后，Downloader形成响应（Response）通过中间件发给Engine</li><li>Engine将收到的响应通过中间件发送给Spider处理</li><li>Spider处理响应后产生爬取项（scraped Item）和新的爬取请求（requests）给Engine</li><li>Engine将爬取项发送给Item Pipeline（框架出口）</li><li>Engine将爬取请求发送给Scheduler</li></ol> 
</blockquote> 
<p>数据流的出入口</p> 
<blockquote> 
 <p>Engine控制各模块数据流，不间断从Scheduler处获得爬取请求，直至请求为空</p> 
 <ul><li> <p>框架入口：Spider的初始爬取请求</p> </li><li> <p>框架出口：Item Pipeline</p> </li></ul> 
</blockquote> 
<hr> 
<ol><li>Engine：不需要用户修改 
  <ul><li>控制所有模块之间的数据流</li><li>根据条件触发事件</li></ul> </li><li>Downloader：不需要用户修改 
  <ul><li>根据请求下载页面</li></ul> </li><li>Scheduler：不需要用户修改 
  <ul><li>对所有爬取请求进行调度管理</li></ul> </li><li>Spider：需要用户编写配置代码 
  <ul><li>解析Downloader返回的响应（Response）</li><li>产生爬取项（scraped item）</li><li>产生额外的爬取请求（Request）</li></ul> </li><li>Item Pipelines 
  <ul><li>以流水线方式处理Spider 产生的爬取项。</li><li>由一组操作顺序组成，类似流水线，每一个操作是一个Item Pipeline类型</li><li>可能操作包括：清理、检验和查重爬取项中的HTML数据、将数据存储到数据库。</li></ul> </li></ol> 
<p>Downloader Middleware : 用户可以编写配置代码</p> 
<pre><code class="prism language-python"><span class="token comment"># 目的：实施Engine、Scheduler和Downloader之间进行用户可配置的控制</span>
<span class="token comment"># 功能：修改、丢弃、新增请求或响应</span>
</code></pre> 
<p>Spider Middleware：用户可以编写配置代码</p> 
<pre><code class="prism language-python"><span class="token comment"># 目的：对请求和爬取项的再处理</span>
<span class="token comment"># 功能：修改、丢弃、新增请求或爬取项</span>
</code></pre> 
<hr> 
<h5><a id="3_requestsscrapy_1930"></a>3. requests库和scrapy库的比较</h5> 
<ol><li> <p>相同点：</p> 
  <ul><li>两者都可以进行页面请求和爬取，Python爬虫的两个重要技术路线。</li><li>两者可用性都好，文档丰富，入门简单。</li><li>两者都没有处理js、提交表单、应对验证码等功能（可扩展）</li></ul> </li><li> <p>不同点</p> </li></ol> 
<table><thead><tr><th>requests</th><th>Scrapy</th></tr></thead><tbody><tr><td>页面级爬虫</td><td>网站级爬虫</td></tr><tr><td>功能库</td><td>框架</td></tr><tr><td>并发性考虑不足，性能较差</td><td>并发性，性能较好</td></tr><tr><td>终点在于页面下载</td><td>终点在于爬虫结构</td></tr><tr><td>定制灵活</td><td>一般定制灵活，深度定制困难</td></tr><tr><td>上手十分简单</td><td>入门稍难</td></tr></tbody></table> 
<ol start="3"><li>选用哪个技术路线开发爬虫 
  <ul><li>非常小的需求，requests库</li><li>不太小的需求，Scrapy框架</li><li>定制程度很高的需求（不考虑规模），自搭框架，requests &gt; Scrapy</li></ul> </li></ol> 
<hr> 
<h5><a id="4_Scrapy__1955"></a>4. Scrapy 命令行：大部分操作都是通过命令行来实现</h5> 
<ol><li> <p>Scrapy是为持续运行设计的专业爬虫框架，提供操作的Scraoy命令行</p> </li><li> <p>Scrapy命令行格式：</p> </li></ol> 
<pre><code class="prism language-python"><span class="token operator">&gt;</span>scrapy <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span><span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">[</span>args<span class="token punctuation">]</span>
</code></pre> 
<table><thead><tr><th>序号</th><th>命令</th><th>说明</th><th>格式</th></tr></thead><tbody><tr><td>1</td><td>startproject</td><td>创建一个新工程</td><td>scrapy startproject [dir]</td></tr><tr><td>2</td><td>genspider</td><td>创建一个爬虫</td><td>scrapy gebspider [options] </td></tr><tr><td>3</td><td>settings</td><td>获得爬虫配置信息</td><td>scrapy settings [options]</td></tr><tr><td>4</td><td>crawl</td><td>运行一个爬虫</td><td>scrapy crawl </td></tr><tr><td>5</td><td>list</td><td>列出工程中所有爬虫</td><td>scrapy list</td></tr><tr><td>6</td><td>shell</td><td>启动URL调试命令行</td><td>scrapy shell [url]</td></tr></tbody></table> 
<p><code>注</code>：1、2、4常用</p> 
<ol start="3"><li> <p>Scrapy爬虫的命令行逻辑</p> <p>为什么Scrapy采用命令行创建和运行爬虫？</p> 
  <ul><li>命令行（不是图形界面）更容易自动化，适合脚本控制</li><li>本质上，Scrapy是给程序用的，功能（而不是界面）更重要。</li></ul> </li></ol> 
<hr> 
<h4><a id="2_Scrapy_1987"></a>(2) Scrapy爬虫基本使用</h4> 
<p>Scrapy爬虫的使用步骤</p> 
<blockquote> 
 <ol><li>步骤1：创建一个工程和Spider模板</li><li>步骤2：编写Spider</li><li>步骤3：Item Pipeline</li><li>步骤4：优化配置策略</li></ol> 
</blockquote> 
<hr> 
<h5><a id="1_1Scrapy_1998"></a>1. 步骤1：建立一个Scrapy爬虫工程</h5> 
<p>创建工程，生成工程目录（python123demo/【外层目录】，包含scrapy.cfg【部署Scrapy爬虫的配置文件】）生成的工程目录</p> 
<p><img src="https://images2.imgbox.com/96/4a/VvcJ8GEr_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/10/03/qMvuvz4a_o.png" alt="在这里插入图片描述"></p> 
<p><code>python123demo/</code>：外层目录</p> 
<p><code>scrapy.cfg</code>：部署Scrapy爬虫的配置文件</p> 
<p><code>python123demo/</code>：Scrapy框架的用户自定义的配置文件</p> 
<p><code>__int__.py</code>：初始化脚本</p> 
<p><code>items.py</code>：Items代码模块（继承类）</p> 
<p><code>middlewares.py</code>：Middlewares代码模块（继承类）</p> 
<p><code>pipelines.py</code>：Pipelines代码模块（继承类）</p> 
<p><code>settings.py</code>：Scrapy爬虫的配置文件</p> 
<p><code>spiders/</code>：Spiders代码模块目录（继承类）</p> 
<pre><code class="prism language-bash">D:<span class="token punctuation">\</span><span class="token operator">&gt;</span>E:
E:<span class="token punctuation">\</span><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> <span class="token punctuation">\</span>Hui<span class="token punctuation">\</span>爬虫<span class="token punctuation">\</span>自修案例
<span class="token comment"># 创建工程</span>
E:<span class="token punctuation">\</span>Hui<span class="token punctuation">\</span>爬虫<span class="token punctuation">\</span>自修案例<span class="token operator">&gt;</span>scrapy startproject python123demo
New Scrapy project <span class="token string">'python123demo'</span>, using template directory <span class="token string">'D:\Software\python3.12.2\Lib\site-packages\scrapy\templates\project'</span>, created in:
    E:<span class="token punctuation">\</span>Hui<span class="token punctuation">\</span>爬虫<span class="token punctuation">\</span>自修案例<span class="token punctuation">\</span>python123demo

You can start your first spider with:
    <span class="token builtin class-name">cd</span> python123demo
    scrapy genspider example example.com
    

</code></pre> 
<h5><a id="2_2Scrapy_2041"></a>2. 步骤2：在工程中产生一个Scrapy爬虫</h5> 
<pre><code class="prism language-bash"><span class="token comment"># 创建demo文件</span>
E:<span class="token punctuation">\</span>Hui<span class="token punctuation">\</span>爬虫<span class="token punctuation">\</span>自修案例<span class="token operator">&gt;</span>cd python123demo
E:<span class="token punctuation">\</span>Hui<span class="token punctuation">\</span>爬虫<span class="token punctuation">\</span>自修案例<span class="token punctuation">\</span>python123demo<span class="token operator">&gt;</span>scrapy genspider demo python123.io
Created spider <span class="token string">'demo'</span> using template <span class="token string">'basic'</span> <span class="token keyword">in</span> module:
  python123demo.spiders.demo
</code></pre> 
<p><code>spiders/</code>：Spiders代码模块目录（继承类）</p> 
<p><code>__init__.py</code>：初始文件，无需修改</p> 
<p><code>__pycache__</code>：缓存目录，无需修改</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> scrapy

<span class="token keyword">class</span> <span class="token class-name">DemoSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 当前爬虫的名字</span>
    name <span class="token operator">=</span> <span class="token string">"demo"</span>
    <span class="token comment"># 最开始用户提交给命令行的域名：指的是爬虫在爬取网站的时候，它只能爬取这个域名以下的相关链接</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"python123.io"</span><span class="token punctuation">]</span>
    <span class="token comment"># 以列表形式包含的一个或多个url，就是scrapy框架所要爬取的初始页面</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"https://python123.io"</span><span class="token punctuation">]</span>

    <span class="token comment">#解析页面的空方法，用于处理响应，解析内容形成字典，发现新的url爬取请求</span>
    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>

</code></pre> 
<h5><a id="3_3spider__2074"></a>3. 步骤3：配置产生的spider 爬虫</h5> 
<ul><li>初始化url地址</li><li>获取页面后的解析方式</li></ul> 
<pre><code class="prism language-python"><span class="token keyword">import</span> scrapy

<span class="token keyword">class</span> <span class="token class-name">DemoSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 当前爬虫的名字</span>
    name <span class="token operator">=</span> <span class="token string">"demo"</span>
    <span class="token comment"># 最开始用户提交给命令行的域名：指的是爬虫在爬取网站的时候，它只能爬取这个域名以下的相关链接</span>
    <span class="token comment"># allowed_domains = ["python123.io"]</span>
    <span class="token comment"># 以列表形式包含的一个或多个url，就是scrapy框架所要爬取的初始页面</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"http://python123.io/ws/demo.html"</span><span class="token punctuation">]</span>

    <span class="token comment">#解析页面的空方法，用于处理响应，解析内容形成字典，发现新的url爬取请求</span>
    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 将response响应的内容写入html文件中</span>
        fnaem<span class="token operator">=</span>response<span class="token punctuation">.</span>url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fnaem<span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Saved file </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">pass</span>
</code></pre> 
<h5><a id="4_4_2102"></a>4. 步骤4：运行爬虫，获取网页</h5> 
<p>保存在<code>E:\Hui\爬虫\自修案例\python123demo</code> 路径下为<code>demo.html</code></p> 
<pre><code class="prism language-python">E<span class="token punctuation">:</span>\Hui\爬虫\自修案例\python123demo<span class="token operator">&gt;</span>scrapy crawl demo
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">40</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>log<span class="token punctuation">]</span> INFO<span class="token punctuation">:</span> Scrapy <span class="token number">2.11</span><span class="token number">.2</span> started <span class="token punctuation">(</span>bot<span class="token punctuation">:</span> python123demo<span class="token punctuation">)</span>
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">40</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>log<span class="token punctuation">]</span> INFO<span class="token punctuation">:</span> Versions<span class="token punctuation">:</span> lxml <span class="token number">5.2</span><span class="token number">.1</span><span class="token number">.0</span><span class="token punctuation">,</span> libxml2 <span class="token number">2.11</span><span class="token number">.7</span><span class="token punctuation">,</span> cssselect <span class="token number">1.2</span><span class="token number">.0</span><span class="token punctuation">,</span> parsel <span class="token number">1.9</span><span class="token number">.1</span><span class="token punctuation">,</span> w3lib <span class="token number">2.1</span><span class="token number">.2</span><span class="token punctuation">,</span> Twisted <span class="token number">24.3</span><span class="token number">.0</span><span class="token punctuation">,</span> Python <span class="token number">3.12</span><span class="token number">.2</span> <span class="token punctuation">(</span>tags<span class="token operator">/</span>v3<span class="token punctuation">.</span><span class="token number">12.2</span><span class="token punctuation">:</span>6abddd9<span class="token punctuation">,</span> Feb  <span class="token number">6</span> <span class="token number">2024</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">:</span><span class="token number">26</span><span class="token punctuation">:</span><span class="token number">36</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>MSC v<span class="token punctuation">.</span><span class="token number">1937</span> <span class="token number">64</span> bit <span class="token punctuation">(</span>AMD64<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pyOpenSSL <span class="token number">24.1</span><span class="token number">.0</span> <span class="token punctuation">(</span>OpenSSL <span class="token number">3.2</span><span class="token number">.1</span> <span class="token number">30</span> Jan <span class="token number">2024</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cryptography <span class="token number">42.0</span><span class="token number">.7</span><span class="token punctuation">,</span> Platform Windows<span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">10.0</span><span class="token number">.22631</span><span class="token operator">-</span>SP0
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">40</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>addons<span class="token punctuation">]</span> INFO<span class="token punctuation">:</span> Enabled addons<span class="token punctuation">:</span>
<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">40</span> <span class="token punctuation">[</span>asyncio<span class="token punctuation">]</span> DEBUG<span class="token punctuation">:</span> Using selector<span class="token punctuation">:</span> SelectSelector
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">40</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>log<span class="token punctuation">]</span> DEBUG<span class="token punctuation">:</span> Using reactor<span class="token punctuation">:</span> twisted<span class="token punctuation">.</span>internet<span class="token punctuation">.</span>asyncioreactor<span class="token punctuation">.</span>AsyncioSelectorReactor
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">40</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>log<span class="token punctuation">]</span> DEBUG<span class="token punctuation">:</span> Using asyncio event loop<span class="token punctuation">:</span> asyncio<span class="token punctuation">.</span>windows_events<span class="token punctuation">.</span>_WindowsSelectorEventLoop
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">40</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>extensions<span class="token punctuation">.</span>telnet<span class="token punctuation">]</span> INFO<span class="token punctuation">:</span> Telnet Password<span class="token punctuation">:</span> 77de2e6d491b1e81
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">40</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>middleware<span class="token punctuation">]</span> INFO<span class="token punctuation">:</span> Enabled extensions<span class="token punctuation">:</span>
<span class="token punctuation">[</span><span class="token string">'scrapy.extensions.corestats.CoreStats'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.extensions.telnet.TelnetConsole'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.extensions.logstats.LogStats'</span><span class="token punctuation">]</span>
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">40</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>crawler<span class="token punctuation">]</span> INFO<span class="token punctuation">:</span> Overridden settings<span class="token punctuation">:</span>
<span class="token punctuation">{<!-- --></span><span class="token string">'BOT_NAME'</span><span class="token punctuation">:</span> <span class="token string">'python123demo'</span><span class="token punctuation">,</span>
 <span class="token string">'FEED_EXPORT_ENCODING'</span><span class="token punctuation">:</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span>
 <span class="token string">'NEWSPIDER_MODULE'</span><span class="token punctuation">:</span> <span class="token string">'python123demo.spiders'</span><span class="token punctuation">,</span>
 <span class="token string">'REQUEST_FINGERPRINTER_IMPLEMENTATION'</span><span class="token punctuation">:</span> <span class="token string">'2.7'</span><span class="token punctuation">,</span>
 <span class="token string">'ROBOTSTXT_OBEY'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
 <span class="token string">'SPIDER_MODULES'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'python123demo.spiders'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
 <span class="token string">'TWISTED_REACTOR'</span><span class="token punctuation">:</span> <span class="token string">'twisted.internet.asyncioreactor.AsyncioSelectorReactor'</span><span class="token punctuation">}</span>
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">40</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>middleware<span class="token punctuation">]</span> INFO<span class="token punctuation">:</span> Enabled downloader middlewares<span class="token punctuation">:</span>
<span class="token punctuation">[</span><span class="token string">'scrapy.downloadermiddlewares.offsite.OffsiteMiddleware'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.downloadermiddlewares.robotstxt.RobotsTxtMiddleware'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.downloadermiddlewares.retry.RetryMiddleware'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.downloadermiddlewares.redirect.RedirectMiddleware'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.downloadermiddlewares.cookies.CookiesMiddleware'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.downloadermiddlewares.stats.DownloaderStats'</span><span class="token punctuation">]</span>
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">40</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>middleware<span class="token punctuation">]</span> INFO<span class="token punctuation">:</span> Enabled spider middlewares<span class="token punctuation">:</span>
<span class="token punctuation">[</span><span class="token string">'scrapy.spidermiddlewares.httperror.HttpErrorMiddleware'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.spidermiddlewares.referer.RefererMiddleware'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.spidermiddlewares.urllength.UrlLengthMiddleware'</span><span class="token punctuation">,</span>
 <span class="token string">'scrapy.spidermiddlewares.depth.DepthMiddleware'</span><span class="token punctuation">]</span>
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">40</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>middleware<span class="token punctuation">]</span> INFO<span class="token punctuation">:</span> Enabled item pipelines<span class="token punctuation">:</span>
<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">40</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>core<span class="token punctuation">.</span>engine<span class="token punctuation">]</span> INFO<span class="token punctuation">:</span> Spider opened
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">40</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>extensions<span class="token punctuation">.</span>logstats<span class="token punctuation">]</span> INFO<span class="token punctuation">:</span> Crawled <span class="token number">0</span> pages <span class="token punctuation">(</span>at <span class="token number">0</span> pages<span class="token operator">/</span><span class="token builtin">min</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scraped <span class="token number">0</span> items <span class="token punctuation">(</span>at <span class="token number">0</span> items<span class="token operator">/</span><span class="token builtin">min</span><span class="token punctuation">)</span>
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">40</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>extensions<span class="token punctuation">.</span>telnet<span class="token punctuation">]</span> INFO<span class="token punctuation">:</span> Telnet console listening on <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">6023</span>
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">41</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>downloadermiddlewares<span class="token punctuation">.</span>redirect<span class="token punctuation">]</span> DEBUG<span class="token punctuation">:</span> Redirecting <span class="token punctuation">(</span><span class="token number">301</span><span class="token punctuation">)</span> to <span class="token operator">&lt;</span>GET https<span class="token punctuation">:</span><span class="token operator">//</span>python123<span class="token punctuation">.</span>io<span class="token operator">/</span>robots<span class="token punctuation">.</span>txt<span class="token operator">&gt;</span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>GET http<span class="token punctuation">:</span><span class="token operator">//</span>python123<span class="token punctuation">.</span>io<span class="token operator">/</span>robots<span class="token punctuation">.</span>txt<span class="token operator">&gt;</span>
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">41</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>core<span class="token punctuation">.</span>engine<span class="token punctuation">]</span> DEBUG<span class="token punctuation">:</span> Crawled <span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span>GET https<span class="token punctuation">:</span><span class="token operator">//</span>python123<span class="token punctuation">.</span>io<span class="token operator">/</span>robots<span class="token punctuation">.</span>txt<span class="token operator">&gt;</span> <span class="token punctuation">(</span>referer<span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">41</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>downloadermiddlewares<span class="token punctuation">.</span>redirect<span class="token punctuation">]</span> DEBUG<span class="token punctuation">:</span> Redirecting <span class="token punctuation">(</span><span class="token number">301</span><span class="token punctuation">)</span> to <span class="token operator">&lt;</span>GET https<span class="token punctuation">:</span><span class="token operator">//</span>python123<span class="token punctuation">.</span>io<span class="token operator">/</span>ws<span class="token operator">/</span>demo<span class="token punctuation">.</span>html<span class="token operator">&gt;</span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>GET http<span class="token punctuation">:</span><span class="token operator">//</span>python123<span class="token punctuation">.</span>io<span class="token operator">/</span>ws<span class="token operator">/</span>demo<span class="token punctuation">.</span>html<span class="token operator">&gt;</span>
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">41</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>core<span class="token punctuation">.</span>engine<span class="token punctuation">]</span> DEBUG<span class="token punctuation">:</span> Crawled <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span>GET https<span class="token punctuation">:</span><span class="token operator">//</span>python123<span class="token punctuation">.</span>io<span class="token operator">/</span>ws<span class="token operator">/</span>demo<span class="token punctuation">.</span>html<span class="token operator">&gt;</span> <span class="token punctuation">(</span>referer<span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">41</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>core<span class="token punctuation">.</span>scraper<span class="token punctuation">]</span> ERROR<span class="token punctuation">:</span> Spider error processing <span class="token operator">&lt;</span>GET https<span class="token punctuation">:</span><span class="token operator">//</span>python123<span class="token punctuation">.</span>io<span class="token operator">/</span>ws<span class="token operator">/</span>demo<span class="token punctuation">.</span>html<span class="token operator">&gt;</span> <span class="token punctuation">(</span>referer<span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span><span class="token punctuation">:</span>
  File <span class="token string">"D:\Software\python3.12.2\Lib\site-packages\twisted\internet\defer.py"</span><span class="token punctuation">,</span> line <span class="token number">1078</span><span class="token punctuation">,</span> <span class="token keyword">in</span> _runCallbacks
    current<span class="token punctuation">.</span>result <span class="token operator">=</span> callback<span class="token punctuation">(</span>  <span class="token comment"># type: ignore[misc]</span>
                     <span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span>
  File <span class="token string">"D:\Software\python3.12.2\Lib\site-packages\scrapy\spiders\__init__.py"</span><span class="token punctuation">,</span> line <span class="token number">82</span><span class="token punctuation">,</span> <span class="token keyword">in</span> _parse
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>response<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
           <span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span>
  File <span class="token string">"E:\Hui\爬虫\自修案例\python123demo\python123demo\spiders\demo.py"</span><span class="token punctuation">,</span> line <span class="token number">18</span><span class="token punctuation">,</span> <span class="token keyword">in</span> parse
    self<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Saved file </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
                           <span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span><span class="token operator">^</span>
NameError<span class="token punctuation">:</span> name <span class="token string">'name'</span> <span class="token keyword">is</span> <span class="token keyword">not</span> defined<span class="token punctuation">.</span> Did you mean<span class="token punctuation">:</span> <span class="token string">'self.name'</span>?
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">41</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>core<span class="token punctuation">.</span>engine<span class="token punctuation">]</span> INFO<span class="token punctuation">:</span> Closing spider <span class="token punctuation">(</span>finished<span class="token punctuation">)</span>
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">41</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>statscollectors<span class="token punctuation">]</span> INFO<span class="token punctuation">:</span> Dumping Scrapy stats<span class="token punctuation">:</span>
<span class="token punctuation">{<!-- --></span><span class="token string">'downloader/request_bytes'</span><span class="token punctuation">:</span> <span class="token number">896</span><span class="token punctuation">,</span>
 <span class="token string">'downloader/request_count'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
 <span class="token string">'downloader/request_method_count/GET'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
 <span class="token string">'downloader/response_bytes'</span><span class="token punctuation">:</span> <span class="token number">1981</span><span class="token punctuation">,</span>
 <span class="token string">'downloader/response_count'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
 <span class="token string">'downloader/response_status_count/200'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
 <span class="token string">'downloader/response_status_count/301'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
 <span class="token string">'downloader/response_status_count/404'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
 <span class="token string">'elapsed_time_seconds'</span><span class="token punctuation">:</span> <span class="token number">0.954325</span><span class="token punctuation">,</span>
 <span class="token string">'finish_reason'</span><span class="token punctuation">:</span> <span class="token string">'finished'</span><span class="token punctuation">,</span>
 <span class="token string">'finish_time'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">(</span><span class="token number">2024</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">875924</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span>datetime<span class="token punctuation">.</span>timezone<span class="token punctuation">.</span>utc<span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token string">'log_count/DEBUG'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
 <span class="token string">'log_count/ERROR'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
 <span class="token string">'log_count/INFO'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
 <span class="token string">'response_received_count'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
 <span class="token string">'robotstxt/request_count'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
 <span class="token string">'robotstxt/response_count'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
 <span class="token string">'robotstxt/response_status_count/404'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
 <span class="token string">'scheduler/dequeued'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
 <span class="token string">'scheduler/dequeued/memory'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
 <span class="token string">'scheduler/enqueued'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
 <span class="token string">'scheduler/enqueued/memory'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
 <span class="token string">'spider_exceptions/NameError'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
 <span class="token string">'start_time'</span><span class="token punctuation">:</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">(</span><span class="token number">2024</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">26</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">39</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">921599</span><span class="token punctuation">,</span> tzinfo<span class="token operator">=</span>datetime<span class="token punctuation">.</span>timezone<span class="token punctuation">.</span>utc<span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token number">2024</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">26</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">41</span> <span class="token punctuation">[</span>scrapy<span class="token punctuation">.</span>core<span class="token punctuation">.</span>engine<span class="token punctuation">]</span> INFO<span class="token punctuation">:</span> Spider closed <span class="token punctuation">(</span>finished<span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h5><a id="5_yield__2199"></a>5. <code>yield</code> 关键字【生成器】</h5> 
<ul><li>生成器是一个不断产生值的函数</li><li>包含yield语句的函数时一个生成器</li><li>生成器每次产生一个值（yield语句），函数被冻结，被唤醒后再产生一个值。</li></ul> 
<ol><li>普通写法：</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> scrapy

<span class="token keyword">class</span> <span class="token class-name">DemoSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 当前爬虫的名字</span>
    name <span class="token operator">=</span> <span class="token string">"demo"</span>
    <span class="token comment"># 最开始用户提交给命令行的域名：指的是爬虫在爬取网站的时候，它只能爬取这个域名以下的相关链接</span>
    <span class="token comment"># allowed_domains = ["python123.io"]</span>
    <span class="token comment"># 以列表形式包含的一个或多个url，就是scrapy框架所要爬取的初始页面</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"http://python123.io/ws/demo.html"</span><span class="token punctuation">]</span>
    <span class="token comment">#解析页面的空方法，用于处理响应，解析内容形成字典，发现新的url爬取请求</span>
    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 将response响应的内容写入html文件中</span>
        fnaem<span class="token operator">=</span>response<span class="token punctuation">.</span>url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fnaem<span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Saved file </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">pass</span>
</code></pre> 
<ol start="2"><li>生成器<code>yield</code>写法：</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> scrapy

<span class="token keyword">class</span> <span class="token class-name">DemoSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">"demo"</span>
    <span class="token keyword">def</span> <span class="token function">start_requests</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        urls<span class="token operator">=</span><span class="token punctuation">[</span>
            <span class="token string">'http://python123.io/ws/dem.html'</span>
        <span class="token punctuation">]</span>
        <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">:</span>
            <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        fname<span class="token operator">=</span>response<span class="token punctuation">.</span>url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fname<span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>log<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Saved file </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>fname<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre> 
<ol start="3"><li>yield一般都是于for循环连用，例如：</li></ol> 
<pre><code class="prism language-python"><span class="token comment"># 生成器写法</span>
<span class="token keyword">def</span> <span class="token function">gen</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> i<span class="token operator">**</span><span class="token number">2</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> gen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">" "</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
    
<span class="token comment">#普通写法</span>
<span class="token keyword">def</span> <span class="token function">square</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    ls<span class="token operator">=</span> <span class="token punctuation">[</span>i<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> ls

<span class="token keyword">for</span> i <span class="token keyword">in</span> square<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token string">" "</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="6_Scrapy_2272"></a>6. Scrapy爬虫的数据类型</h5> 
<ol><li> <p>Request类</p> <p><code>class scrapy.http.Request()</code>:</p> 
  <ul><li>Request对象表示一个HTTP请求</li><li>由Spider生成，由Downloader执行</li></ul> 
  <table><thead><tr><th>属性或方法</th><th>说明</th></tr></thead><tbody><tr><td>.url</td><td>Request对应的请求url地址</td></tr><tr><td>.method</td><td>对应的请求方法，‘GET’‘PODT’等</td></tr><tr><td>.headers</td><td>字典类型风格的请求头</td></tr><tr><td>.body</td><td>请求内容主体，字符串类型</td></tr><tr><td>.meta</td><td>用户添加的扩展信息，在Scrapy内部模块间传递信息使用</td></tr><tr><td>.copy()</td><td>复制该请求</td></tr></tbody></table></li><li> <p>Response类</p> <p><code>class scrapy.http.Response()</code>:</p> 
  <ul><li>Response对象表示一个HTTP响应。</li><li>由Downloader生成，由Spider处理</li></ul> 
  <table><thead><tr><th>属性或方法</th><th>说明</th></tr></thead><tbody><tr><td>.url</td><td>Response对应的请求url地址</td></tr><tr><td>.status</td><td>HTTP状态码，默认是200</td></tr><tr><td>.headers</td><td>Respnse对应的头部信息</td></tr><tr><td>.body</td><td>Response对应的内容信息，字符串类型</td></tr><tr><td>.flags</td><td>一组标记</td></tr><tr><td>.request</td><td>产生Response类型对应的Request对象</td></tr><tr><td>.copy()</td><td>复制该响应</td></tr></tbody></table></li><li> <p>Item类</p> <p><code>class scrapy.item.Item()</code>:</p> 
  <ul><li>Item对象表示一个从HTML页面中提取的信息内容</li><li>由Spider生成，由Item Pipeline处理。</li><li>Item类型字典类型，可以按照字典类型操作。</li></ul> </li><li> <p>Scrapy爬虫提取信息的方法</p> <p>Scrapy爬虫支持多种HTML信息提取方法</p> 
  <ul><li> <p>Beautiful Soup</p> </li><li> <p>lxml</p> </li><li> <p>re</p> </li><li> <p>Xpath Selector</p> </li><li> <p>CSS Selector</p> <pre><code class="prism language-python"><span class="token comment"># CSS Selector的基本使用（CSS Selector由W3C组织维护并规范）</span>
<span class="token operator">&lt;</span>HTML<span class="token operator">&gt;</span><span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'a::attr(href)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#a：标签名称  href：标签属性</span>
</code></pre> </li></ul> </li></ol> 
<hr> 
<h4><a id="3_Scrapy_2336"></a>(3) 实例：股票数据Scrapy实例</h4> 
<h5><a id="1_1Spider_2338"></a>1. 步骤1：建立工程和Spider模板</h5> 
<p>打开终端：<code>win+R</code>，输入<code>cmd</code>，建立工程</p> 
<pre><code class="prism language-cmd"># 进入文件
D:\&gt;cd \Software\pycharm\web_request
# 创建工程，其文件中包含：BaiduStocks 文件和 scrapy.cfg 文件
D:\Software\pycharm\web_request&gt;scrapy startproject BaiduStocks
New Scrapy project 'BaiduStocks', using template directory 'D:\Software\python3.12.2\Lib\site-packages\scrapy\templates\project', created in:
    D:\Software\pycharm\web_request\BaiduStocks
    
You can start your first spider with:
    cd BaiduStocks
    scrapy genspider example example.com
# 切换视图
D:\Software\pycharm\web_request&gt;cd BaiduStocks
# 创建爬虫 spiders模板
D:\Software\pycharm\web_request\BaiduStocks&gt;scrapy genspider stocks baidu.com
Created spider 'stocks' using template 'basic' in module:
  BaiduStocks.spiders.stocks
</code></pre> 
<p>进一步修改<code>spiders/stocks.py</code>文件</p> 
<h5><a id="2_2Spider_2365"></a>2. 步骤2：编写Spider</h5> 
<p>配置<code>stocks.py</code>文件；修改对返回页面的处理；修改对新增URL爬取请求的处理</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> scrapy
<span class="token keyword">import</span> re


<span class="token keyword">class</span> <span class="token class-name">StocksSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">"stocks"</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"baidu.com"</span><span class="token punctuation">]</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"http://quote.eastmoney.com/stocklist.html"</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 对这个页面的所有a标签进行提取</span>
        <span class="token comment"># 使用CSS选择器来定位HTML中的元素</span>
        <span class="token comment"># .extract()这个方法应用于前面的选择器表达式结果上，用于从选择器匹配到的所有元素中提取出实际的文本内容。</span>
        <span class="token keyword">for</span> href <span class="token keyword">in</span> response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'a::attr(href)'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># 匹配正确的url链接</span>
                stock<span class="token operator">=</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r"[s][hz]\d{6}"</span><span class="token punctuation">,</span>href<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                <span class="token comment"># 组成个股链接</span>
                url<span class="token operator">=</span><span class="token string">"https://gupiao.baidu.com/stock/"</span><span class="token operator">+</span>stock<span class="token operator">+</span><span class="token string">".html"</span>
                <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span>callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_stock<span class="token punctuation">)</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                <span class="token keyword">continue</span>

    <span class="token keyword">def</span> <span class="token function">parse_stock</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        infoDict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        stockInfo <span class="token operator">=</span> response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'.stock-bets'</span><span class="token punctuation">)</span>
        name <span class="token operator">=</span> stockInfo<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'.bets-name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        keyList <span class="token operator">=</span> stockInfo<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'dt'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
        valueList <span class="token operator">=</span> stockInfo<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'dd'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>keyList<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            key <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'&gt;.*&lt;/dt&gt;'</span><span class="token punctuation">,</span> keyList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                val <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'\d+\.?.*&lt;/dd&gt;'</span><span class="token punctuation">,</span> valueList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                val <span class="token operator">=</span> <span class="token string">'--'</span>
            infoDict<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val

        infoDict<span class="token punctuation">.</span>update<span class="token punctuation">(</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">'股票名称'</span><span class="token punctuation">:</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'\s.*\('</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> \
                         re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">'\&gt;.*\&lt;'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">yield</span> infoDict
</code></pre> 
<h5><a id="3__3Pipelines_2415"></a>3. 步骤3：编写Pipelines</h5> 
<p>配置<code>pipelines.py</code>文件；定义对爬虫取项（Scraped Item）的处理类</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">BaidustocksPipeline</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> item

<span class="token keyword">class</span> <span class="token class-name">BaidustocksInfoPipeline</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">open_spider</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'BaiduStockInfo.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">close_spider</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            line <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'\n'</span>
            self<span class="token punctuation">.</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>line<span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
        <span class="token keyword">return</span> item
</code></pre> 
<h5><a id="4_ITEM_PIPELINES_2440"></a>4. 配置ITEM_PIPELINES选项</h5> 
<p>配置<code>settings.py</code>文件</p> 
<pre><code class="prism language-python">ITEM_PIPELINES <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'BaiduStocks.pipelines.BaidustocksInfoPipeline'</span><span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>程序运行</p> 
<pre><code class="prism language-cmd">D:\Software\pycharm\web_request\BaiduStocks&gt;scrapy crawl stocks
D:\Software\pycharm\web_request\BaiduStocks\BaiduStocks\spiders\stocks.py:39: SyntaxWarning: invalid escape sequence '\s'
  {'股票名称': re.findall('\s.*\(', name)[0].split()[0] + \
D:\Software\pycharm\web_request\BaiduStocks\BaiduStocks\spiders\stocks.py:40: SyntaxWarning: invalid escape sequence '\&gt;'
  re.findall('\&gt;.*\&lt;', name)[0][1:-1]})
2024-05-27 18:01:29 [scrapy.utils.log] INFO: Scrapy 2.11.2 started (bot: BaiduStocks)
2024-05-27 18:01:29 [scrapy.utils.log] INFO: Versions: lxml 5.2.1.0, libxml2 2.11.7, cssselect 1.2.0, parsel 1.9.1, w3lib 2.1.2, Twisted 24.3.0, Python 3.12.2 (tags/v3.12.2:6abddd9, Feb  6 2024, 21:26:36) [MSC v.1937 64 bit (AMD64)], pyOpenSSL 24.1.0 (OpenSSL 3.2.1 30 Jan 2024), cryptography 42.0.7, Platform Windows-11-10.0.22631-SP0
2024-05-27 18:01:29 [scrapy.addons] INFO: Enabled addons:
[]
2024-05-27 18:01:29 [asyncio] DEBUG: Using selector: SelectSelector
2024-05-27 18:01:29 [scrapy.utils.log] DEBUG: Using reactor: twisted.internet.asyncioreactor.AsyncioSelectorReactor
2024-05-27 18:01:29 [scrapy.utils.log] DEBUG: Using asyncio event loop: asyncio.windows_events._WindowsSelectorEventLoop
2024-05-27 18:01:29 [scrapy.extensions.telnet] INFO: Telnet Password: 3876dc1b1227236a
2024-05-27 18:01:29 [scrapy.middleware] INFO: Enabled extensions:
['scrapy.extensions.corestats.CoreStats',
 'scrapy.extensions.telnet.TelnetConsole',
 'scrapy.extensions.logstats.LogStats']
2024-05-27 18:01:29 [scrapy.crawler] INFO: Overridden settings:
{'BOT_NAME': 'BaiduStocks',
 'FEED_EXPORT_ENCODING': 'utf-8',
 'NEWSPIDER_MODULE': 'BaiduStocks.spiders',
 'REQUEST_FINGERPRINTER_IMPLEMENTATION': '2.7',
 'ROBOTSTXT_OBEY': True,
 'SPIDER_MODULES': ['BaiduStocks.spiders'],
 'TWISTED_REACTOR': 'twisted.internet.asyncioreactor.AsyncioSelectorReactor'}
2024-05-27 18:01:29 [scrapy.middleware] INFO: Enabled downloader middlewares:
['scrapy.downloadermiddlewares.offsite.OffsiteMiddleware',
 'scrapy.downloadermiddlewares.robotstxt.RobotsTxtMiddleware',
 'scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware',
 'scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware',
 'scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware',
 'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware',
 'scrapy.downloadermiddlewares.retry.RetryMiddleware',
 'scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware',
 'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware',
 'scrapy.downloadermiddlewares.redirect.RedirectMiddleware',
 'scrapy.downloadermiddlewares.cookies.CookiesMiddleware',
 'scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware',
 'scrapy.downloadermiddlewares.stats.DownloaderStats']
2024-05-27 18:01:29 [scrapy.middleware] INFO: Enabled spider middlewares:
['scrapy.spidermiddlewares.httperror.HttpErrorMiddleware',
 'scrapy.spidermiddlewares.referer.RefererMiddleware',
 'scrapy.spidermiddlewares.urllength.UrlLengthMiddleware',
 'scrapy.spidermiddlewares.depth.DepthMiddleware']
2024-05-27 18:01:29 [scrapy.middleware] INFO: Enabled item pipelines:
['BaiduStocks.pipelines.BaidustocksInfoPipeline']
2024-05-27 18:01:29 [scrapy.core.engine] INFO: Spider opened
2024-05-27 18:01:29 [scrapy.extensions.logstats] INFO: Crawled 0 pages (at 0 pages/min), scraped 0 items (at 0 items/min)
2024-05-27 18:01:29 [scrapy.extensions.telnet] INFO: Telnet console listening on 127.0.0.1:6023
2024-05-27 18:01:29 [scrapy.downloadermiddlewares.offsite] DEBUG: Filtered offsite request to 'quote.eastmoney.com': &lt;GET http://quote.eastmoney.com/robots.txt&gt;
2024-05-27 18:01:29 [scrapy.downloadermiddlewares.redirect] DEBUG: Redirecting (302) to &lt;GET http://quote.eastmoney.com/center/gridlist.html#hs_a_board&gt; from &lt;GET http://quote.eastmoney.com/stocklist.html&gt;
2024-05-27 18:01:30 [scrapy.core.engine] DEBUG: Crawled (200) &lt;GET http://quote.eastmoney.com/center/gridlist.html#hs_a_board&gt; (referer: None)
</code></pre> 
<h5><a id="5__2509"></a>5. 配置并发连接选项</h5> 
<p><code>settings.py</code>文件</p> 
<table><thead><tr><th>选项</th><th>说明</th></tr></thead><tbody><tr><td>CONCURRENT_REQUESTS</td><td>Downloader最大并发请求下载数量，默认为32</td></tr><tr><td>CONCURRENT_ITEMS</td><td>Item Pipeline最大并发ITEM处理数量，默认100</td></tr><tr><td>CONCURRENT_REQUESTS_PER_DOMAIN</td><td>每个目标域名最大的并发请求数量，默认8</td></tr><tr><td>CONCURRENT_REQUESTS_PER_IP</td><td>每个目标IP最大的并发请求数量，默认0，非0有效</td></tr></tbody></table>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1468b88cdb75a8bfc77b16aae65b0d40/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【python】pandas常见文件读取方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2fd06f00bb3a5b1774a728ca144a389a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Django从入门到精通：First [Django版本.Python面向对象.Web基础.创建Django项目]</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>