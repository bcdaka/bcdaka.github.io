<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Kubernetes】身份认证与鉴权 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/40bf41b6ec2bb0173cbb80e71ad0ac30/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="【Kubernetes】身份认证与鉴权">
  <meta property="og:description" content="一，认证 所有 Kubernetes 集群有两类用户：由Kubernetes管理的ServiceAccounts(服务账户)和(Users Accounts)普通账户。
两种账户的区别：
普通帐户是针对(人)用户的，服务账户针对Pod进程普通帐户是全局性。在集群所有namespaces中，名称具有唯一性。通常，群集的普通帐户可以与企业数据库同步，新的普通帐户创建需要特殊权限。服务账户创建目的是更轻量化，允许集群用户为特定任务创建服务账户普通帐户和服务账户的审核注意事项不同。对于复杂系统的配置包，可以包括对该系统的各种组件的服务账户的定义。 1，User Accounts 普通账户是假定被外部或独立服务管理的，由管理员分配 keys用户像使用 Keystone 或 google 账号一样，被存储在包含Usernames和Passwords的list 的文件里.
需要注意:在Kubernetes 中不能通过API调用将普通用户添加到焦群中。
2，Service Accounts # 获取Service Accounts kubectl get serviceaccount 或者 [sa] 自动化的三种控制器：
2.1 Service Account Admission Controller 通过 Admission Controller 插件来实现对 pod 修改，它是apiserver 的一部分。创建或更新 pod 时会同步进行修改 pod。当插件处于激活状态(在大多数发行版中都默认情况)创建或修改 pod 时，会按以下操作执行:
如果 pod 没有设置 serviceAccount，则将 ServiceAccount设置为 default。确保 pod 引用的 ServiceAccount 存在，否则将会拒绝请求。如果 pod 不包含任何 ImagePullsecrets，则将ServiceAccount的 lmagePullsecrets 会添加到 pod 中。为包含 API访问的 Token 的 pod 添加了一个 volume。把 volumesource 添加到安装在 pod 的每个容器中，挂载在/var/run/secrets/kubernetes.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-08-13T19:27:56+08:00">
    <meta property="article:modified_time" content="2024-08-13T19:27:56+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Kubernetes】身份认证与鉴权</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>一，认证</h2> 
<p>所有 Kubernetes 集群有两类用户：由Kubernetes管理的ServiceAccounts(服务账户)和(Users Accounts)普通账户。</p> 
<p><strong>两种账户的区别：</strong></p> 
<ul><li>普通帐户是针对(人)用户的，服务账户针对Pod进程</li><li>普通帐户是全局性。在集群所有namespaces中，名称具有唯一性。</li><li>通常，群集的普通帐户可以与企业数据库同步，新的普通帐户创建需要特殊权限。服务账户创建目的是更轻量化，允许集群用户为特定任务创建服务账户</li><li>普通帐户和服务账户的审核注意事项不同。</li><li>对于复杂系统的配置包，可以包括对该系统的各种组件的服务账户的定义。</li></ul> 
<h4><a id="1User__Accounts_9"></a>1，User Accounts</h4> 
<p>普通账户是假定被外部或独立服务管理的，由管理员分配 keys用户像使用 Keystone 或 google 账号一样，被存储在包含Usernames和Passwords的list 的文件里.</p> 
<p>需要注意:在Kubernetes 中不能通过API调用将普通用户添加到焦群中。</p> 
<h4><a id="2Service__Accounts_14"></a>2，Service Accounts</h4> 
<pre><code class="prism language-python"><span class="token comment"># 获取Service Accounts</span>
kubectl get serviceaccount 或者 <span class="token punctuation">[</span>sa<span class="token punctuation">]</span>
</code></pre> 
<p>自动化的三种控制器：</p> 
<h6><a id="21_Service_Account_Admission_Controller_22"></a>2.1 Service Account Admission Controller</h6> 
<p>通过 Admission Controller 插件来实现对 pod 修改，它是apiserver 的一部分。创建或更新 pod 时会同步进行修改 pod。当插件处于激活状态(在大多数发行版中都默认情况)创建或修改 pod 时，会按以下操作执行:</p> 
<ul><li>如果 pod 没有设置 serviceAccount，则将 ServiceAccount设置为 default。</li><li>确保 pod 引用的 ServiceAccount 存在，否则将会拒绝请求。</li><li>如果 pod 不包含任何 ImagePullsecrets，则将ServiceAccount的 lmagePullsecrets 会添加到 pod 中。</li><li>为包含 API访问的 Token 的 pod 添加了一个 volume。</li><li>把 volumesource 添加到安装在 pod 的每个容器中，挂载在/var/run/secrets/kubernetes.io/serviceaccount.</li></ul> 
<h6><a id="22_Token_Controller_30"></a>2.2 Token Controller</h6> 
<h6><a id="23_Service_Account_Controller_31"></a>2.3 Service Account Controller</h6> 
<p>Service Account Controller 在namespaces 里管理ServiceAccount，并确保每个有效的 namespaces 中都存在一个名为"default" 的ServiceAccount。</p> 
<h2><a id="RBAC_37"></a>二，授权（RBAC）</h2> 
<h4><a id="Role_38"></a>角色：Role</h4> 
<p>代表一个角色，会包会一组权限，没有拒绝规则，只是附加允许。它是 Namespace 级别的资源，只能作用与Namespace之内。</p> 
<pre><code class="prism language-python"><span class="token comment">#查春已有的角色信息</span>
kubectl get role <span class="token operator">-</span>n ingress<span class="token operator">-</span>nginx <span class="token operator">-</span>o yaml
</code></pre> 
<p><img src="https://images2.imgbox.com/f0/69/s7Eu2HRG_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="ClusterRole_47"></a>集群角色：ClusterRole</h4> 
<p>功能与 Role 一样，区别是资源类型为集群类型，而 Role 只在Namespace</p> 
<pre><code class="prism language-python"><span class="token comment"># 查看某个集群角色的详细信息</span>
kubectl get clusterrole <span class="token punctuation">[</span>集群名<span class="token punctuation">]</span> <span class="token operator">-</span>o yaml
</code></pre> 
<h4><a id="RoleBinding_54"></a>角色绑定：RoleBinding</h4> 
<p>Role 或 ClusterRole 只是用于制定权限集合，具体作用与什么对象上，需要使用 RoleBinding 来进行绑走。</p> 
<p>作用于 Namespace 内，可以将 Role 或 ClusterRole 绑定到User、Group、service Account 上.</p> 
<pre><code class="prism language-python"><span class="token comment">#查看 rolebinding 信息</span>
kubectl get rolebinding <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">all</span><span class="token operator">-</span>namespaces
或
kubectl get rolebinding <span class="token operator">-</span>A


<span class="token comment">#查看指定 rolebinding 的配置信息</span>
kubectl get rolebinding <span class="token operator">&lt;</span>role_binding_name<span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">all</span><span class="token operator">-</span>namespaces <span class="token operator">-</span>oyaml
或
kubectl get rolebinding <span class="token operator">&lt;</span>role_binding_name<span class="token operator">&gt;</span> <span class="token operator">-</span>A <span class="token operator">-</span>oyaml
</code></pre> 
<p><img src="https://images2.imgbox.com/13/27/YIRiaBt5_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="ClusterRoleBinding_72"></a>集群角色绑定：ClusterRoleBinding</h4> 
<p>相关内容同角色绑定！<br> <img src="https://images2.imgbox.com/39/14/B4Jm0Qg8_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d6f6e5b818cbfb53f4702b06e3c5756e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Layui——隐藏表单项后不再进行验证</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/978854eb71d8c21809b9e5b23b697fe9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">学习记录——day30 网络编程 端口号port 套接字socket TCP实现网络通信</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>