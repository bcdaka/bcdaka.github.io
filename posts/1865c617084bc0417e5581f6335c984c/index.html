<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>快速部署stable diffusion@Ubuntu - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/1865c617084bc0417e5581f6335c984c/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="快速部署stable diffusion@Ubuntu">
  <meta property="og:description" content="Stable Diffusion可以根据文本描述生成相关的图像，是当前最热门的文生图模型。
在Ubuntu下，可以选择快速安装，或者手动一步步安装。
快速安装 使用文档中的方法，先下载一个sh文件，然后执行这个文件，就自动安装依赖，自动启动服务了。
首先安装好需要的库 # Debian-based: sudo apt install wget git python3 python3-venv libgl1 libglib2.0-0 # Red Hat-based: sudo dnf install wget git python3 gperftools-libs libglvnd-glx # openSUSE-based: sudo zypper install wget git python3 libtcmalloc4 libglvnd # Arch-based: sudo pacman -S wget git python3 下载sh并执行： wget -q https://raw.githubusercontent.com/AUTOMATIC1111/stable-diffusion-webui/master/webui.sh sh webui.sh 如果github抽风导致git clone失败，可以进入webui.sh文件，修改其中的&#34;${GIT}&#34; clone https://github.com/AUTOMATIC1111/stable-diffusion-webui.git &#34;${clone_dir}&#34;
到 &#34;${GIT}&#34; clone --depth 2 https://github.com/AUTOMATIC1111/stable-diffusion-webui.git &#34;${clone_dir}&#34; ，可以提高成功率。
也可以手动去进行git clone指令。
后面按部就班一路安装成功即可。
也可以手动安装，手动安装可以较自由的选择torch版本等。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-22T22:50:54+08:00">
    <meta property="article:modified_time" content="2024-04-22T22:50:54+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">快速部署stable diffusion@Ubuntu</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>Stable Diffusion可以根据文本描述生成相关的图像，是当前最热门的文生图模型。</p> 
<p>在Ubuntu下，可以选择快速安装，或者手动一步步安装。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/dd/2a/GNatsYXr_o.png"></p> 
<h2>快速安装</h2> 
<p>使用文档中的方法，先下载一个sh文件，然后执行这个文件，就自动安装依赖，自动启动服务了。</p> 
<h3>首先安装好需要的库</h3> 
<pre><code># Debian-based:
sudo apt install wget git python3 python3-venv libgl1 libglib2.0-0
# Red Hat-based:
sudo dnf install wget git python3 gperftools-libs libglvnd-glx 
# openSUSE-based:
sudo zypper install wget git python3 libtcmalloc4 libglvnd
# Arch-based:
sudo pacman -S wget git python3</code></pre> 
<h3>下载sh并执行：</h3> 
<pre><code>wget -q https://raw.githubusercontent.com/AUTOMATIC1111/stable-diffusion-webui/master/webui.sh
sh webui.sh </code></pre> 
<p>如果github抽风导致git clone失败，可以进入webui.sh文件，修改其中的"${GIT}" clone https://github.com/AUTOMATIC1111/stable-diffusion-webui.git "${clone_dir}"<br>  到 "${GIT}" clone --depth 2 https://github.com/AUTOMATIC1111/stable-diffusion-webui.git "${clone_dir}" ，可以提高成功率。</p> 
<p>也可以手动去进行git clone指令。</p> 
<p></p> 
<p>后面按部就班一路安装成功即可。</p> 
<p></p> 
<p>也可以手动安装，手动安装可以较自由的选择torch版本等。</p> 
<h2>手动一步步安装</h2> 
<h3>下载源代码</h3> 
<pre><code>git clone --depth 2 https://github.com/AUTOMATIC1111/stable-diffusion-webui.git</code></pre> 
<h3>进入目录，使用conda安装pytorch等依赖</h3> 
<pre><code>cd stable-diffusion-webui
conda env update --file environment-wsl2.yaml --prune</code></pre> 
<h4>安装好后激活环境</h4> 
<pre><code>conda activate automatic</code></pre> 
<p></p> 
<h3>下载模型</h3> 
<p>到huggingface网站下载模型，比如可以从gitee镜像下载：<a href="https://gitee.com/hf-models/stable-diffusion-v1-5" rel="nofollow" title="stable-diffusion-v1-5: Mirror of https://huggingface.co/runwayml/stable-diffusion-v1-5">stable-diffusion-v1-5: Mirror of https://huggingface.co/runwayml/stable-diffusion-v1-5</a></p> 
<p>可以从hf-mirrot.com这个镜像下载：<a href="https://hf-mirror.com/runwayml/stable-diffusion-v1-5/resolve/main/v1-5-pruned-emaonly.ckpt" rel="nofollow" title="https://hf-mirror.com/runwayml/stable-diffusion-v1-5/resolve/main/v1-5-pruned-emaonly.ckpt">https://hf-mirror.com/runwayml/stable-diffusion-v1-5/resolve/main/v1-5-pruned-emaonly.ckpt</a> </p> 
<p>下载这个文件：v1-5-pruned-emaonly.ckpt</p> 
<p>将下载的文件改名成model.ckpt并放入指定目录：stable-diffusion-webui/models/Stable-diffusion/model.ckpt</p> 
<p>比如</p> 
<pre><code>mv v1-5-pruned-emaonly.ckpt ~/github/stable-diffusion-webui/models/Stable-diffusion/model.ckpt</code></pre> 
<p></p> 
<h3>启动服务</h3> 
<pre><code>python3 launch.py</code></pre> 
<p>如果是cpu环境，需要加上参数：</p> 
<pre><code>python launch.py --skip-torch-cuda-test 1
</code></pre> 
<p></p> 
<h2>调试</h2> 
<h3>报错RuntimeError: Torch is not able to use GPU</h3> 
<p>raise RuntimeError( RuntimeError: Torch is not able to use GPU; add --skip-torch-cuda-test to COMMANDLINE_ARGS variable to disable this check</p> 
<p>加上参数执行:python launch.py --skip-torch-cuda-test 1</p> 
<h3>报错git clone Error code: 128</h3> 
<p>  File "/home/linuxskywalk/github/stable-diffusion-webui/modules/launch_utils.py", line 115, in run<br>     raise RuntimeError("\n".join(error_bits))<br> RuntimeError: Couldn't clone Stable Diffusion.<br> Command: "git" clone --config core.filemode=false "https://github.com/Stability-AI/stablediffusion.git" "/home/linuxskywalk/github/stable-diffusion-webui/repositories/stable-diffusion-stability-ai"<br> Error code: 128<br> 是github repo下载出错，加上--depth 2 ，然后手工执行：</p> 
<p>"git" clone --depth 2 --config core.filemode=false "https://github.com/Stability-AI/stablediffusion.git" "/home/linuxskywalk/github/stable-diffusion-webui/repositories/stable-diffusion-stability-ai"</p> 
<p>如果还不行，就想其它办法，比如github不抽风的时候下载。</p> 
<p></p> 
<h3>报错RuntimeError: Couldn't fetch Stable Diffusion XL.</h3> 
<p>    run(f'"{git}" -C "{dir}" fetch --refetch --no-auto-gc', f"Fetching all contents for {name}", f"Couldn't fetch {name}", live=True)<br>   File "/home/linuxskywalk/github/stable-diffusion-webui/modules/launch_utils.py", line 115, in run<br>     raise RuntimeError("\n".join(error_bits))<br> RuntimeError: Couldn't fetch Stable Diffusion XL.<br> Command: "git" -C "/home/linuxskywalk/github/stable-diffusion-webui/repositories/generative-models" fetch --refetch --no-auto-gc<br> Error code: 129<br> 使用conda install git试试</p> 
<p>还是不行。原来generative-models不能用--depth 2 这个参数，因为用了之后可能拿不到repo branch</p> 
<p>删除该目录，重新安装</p> 
<p>git clone https://github.com/Stability-AI/generative-models.git<br> ok了</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4da6230ea231eec7a609ff621e5424bd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Midjourney基础操作</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c532c76a4e96a0c1aa81b8a9e4760c1a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">代码训练LeetCode(15)买卖股票</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>