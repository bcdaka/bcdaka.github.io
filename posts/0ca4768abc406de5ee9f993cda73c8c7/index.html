<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>YOLOv8训练自己的数据集(超详细) - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/0ca4768abc406de5ee9f993cda73c8c7/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="YOLOv8训练自己的数据集(超详细)">
  <meta property="og:description" content="一、准备深度学习环境 本人的笔记本电脑系统是：Windows10
YOLO系列最新版本的YOLOv8已经发布了，详细介绍可以参考我前面写的博客，目前ultralytics已经发布了部分代码以及说明，可以在github上下载YOLOv8代码，代码文件夹中会有requirements.txt文件，里面描述了所需要的安装包。
本文最终安装的pytorch版本是1.8.1，torchvision版本是0.9.1，python是3.7.10，其他的依赖库按照requirements.txt文件安装即可。
然后还需要安装ultralytics，目前YOLOv8核心代码都封装在这个依赖包里面，可通过以下命令安装
pip install ultralytics 二、 准备自己的数据集 本人在训练YOLOv8时，选择的数据格式是VOC，因此下面将介绍如何将自己的数据集转换成可以直接让YOLOv8进行使用。
1、创建数据集 我的数据集都在保存在mydata文件夹（名字可以自定义），目录结构如下，将之前labelImg标注好的xml文件和图片放到对应目录下
mydata
…images # 存放图片
…xml # 存放图片对应的xml文件
…dataSet #之后会在Main文件夹内自动生成train.txt，val.txt，test.txt和trainval.txt四个文件，存放训练集、验证集、测试集图片的名字（无后缀.jpg）
示例如下：
mydata文件夹下内容如下：
image为VOC数据集格式中的JPEGImages，内容如下： xml文件夹下面为.xml文件（标注工具采用labelImage），内容如下： dataSet 文件夹下面存放训练集、验证集、测试集的划分，通过脚本生成，可以创建一个split_train_val.py文件，代码内容如下： # coding:utf-8 import os import random import argparse parser = argparse.ArgumentParser() # xml文件的地址，根据自己的数据进行修改 xml一般存放在Annotations下 parser.add_argument(&#39;--xml_path&#39;, default=&#39;xml&#39;, type=str, help=&#39;input xml label path&#39;) # 数据集的划分，地址选择自己数据下的ImageSets/Main parser.add_argument(&#39;--txt_path&#39;, default=&#39;dataSet&#39;, type=str, help=&#39;output txt label path&#39;) opt = parser.parse_args() trainval_percent = 1.0 train_percent = 0.9 xmlfilepath = opt.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-01-13T15:23:06+08:00">
    <meta property="article:modified_time" content="2023-01-13T15:23:06+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">YOLOv8训练自己的数据集(超详细)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="%C2%A0%E4%B8%80%E3%80%81%E5%87%86%E5%A4%87%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83"> 一、准备深度学习环境</h2> 
<p>本人的笔记本电脑系统是：Windows10<br> YOLO系列最新版本的YOLOv8已经发布了，详细介绍可以参考<a class="link-info" href="https://blog.csdn.net/qq_40716944/article/details/128609569?spm=1001.2014.3001.5502" title="我前面写的博客">我前面写的博客</a>，目前ultralytics已经发布了<a class="link-info" href="https://github.com/ultralytics/ultralytics" title="部分代码以及说明">部分代码以及说明</a>，可以在<a class="link-info" href="https://github.com/ultralytics/ultralytics" title="github上下载YOLOv8代码">github上下载YOLOv8代码</a>，代码文件夹中会有requirements.txt文件，里面描述了所需要的安装包。</p> 
<p>本文最终安装的pytorch版本是<strong>1.8.1</strong>，torchvision版本是<strong>0.9.1</strong>，python是<strong>3.7.10</strong>，其他的依赖库按照requirements.txt文件安装即可。</p> 
<p><img alt="" height="860" src="https://images2.imgbox.com/6d/2f/A4ZitRxW_o.png" width="479"></p> 
<p>然后还需要安装ultralytics，目前YOLOv8核心代码都封装在这个依赖包里面，可通过以下命令安装</p> 
<pre><code class="language-python">pip install ultralytics</code></pre> 
<h2 id="%E4%BA%8C%E3%80%81%C2%A0%E5%87%86%E5%A4%87%E8%87%AA%E5%B7%B1%E7%9A%84%E6%95%B0%E6%8D%AE%E9%9B%86">二、 准备自己的数据集</h2> 
<p>本人在训练YOLOv8时，选择的数据格式是VOC，因此下面将介绍如何将自己的数据集转换成可以直接让YOLOv8进行使用。</p> 
<h4 id="1%E3%80%81%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E9%9B%86">1、创建数据集</h4> 
<p>我的数据集都在保存在mydata文件夹（名字可以自定义），目录结构如下，将之前labelImg标注好的xml文件和图片放到对应目录下<br> mydata<br> …images # 存放图片<br> …xml # 存放图片对应的xml文件<br> …dataSet #之后会在Main文件夹内自动生成train.txt，val.txt，test.txt和trainval.txt四个文件，存放训练集、验证集、测试集图片的名字（无后缀.jpg）<br> 示例如下：<br> mydata文件夹下内容如下：</p> 
<p><img alt="" height="101" src="https://images2.imgbox.com/d5/c0/2vmRHltt_o.png" width="666"></p> 
<ul><li>image为VOC数据集格式中的JPEGImages，内容如下：</li></ul> 
<p><img alt="" height="332" src="https://images2.imgbox.com/93/54/866RCgGI_o.png" width="654"></p> 
<ul><li>xml文件夹下面为.xml文件（标注工具采用labelImage），内容如下： </li></ul> 
<p><img alt="" height="379" src="https://images2.imgbox.com/01/79/PIKc8FLI_o.png" width="641"></p> 
<ul><li>dataSet 文件夹下面存放训练集、验证集、测试集的划分，通过脚本生成，可以创建一个<strong>split_train_val.py</strong>文件，代码内容如下：</li></ul> 
<pre><code class="language-python"># coding:utf-8

import os
import random
import argparse

parser = argparse.ArgumentParser()
# xml文件的地址，根据自己的数据进行修改 xml一般存放在Annotations下
parser.add_argument('--xml_path', default='xml', type=str, help='input xml label path')
# 数据集的划分，地址选择自己数据下的ImageSets/Main
parser.add_argument('--txt_path', default='dataSet', type=str, help='output txt label path')
opt = parser.parse_args()

trainval_percent = 1.0
train_percent = 0.9
xmlfilepath = opt.xml_path
txtsavepath = opt.txt_path
total_xml = os.listdir(xmlfilepath)
if not os.path.exists(txtsavepath):
    os.makedirs(txtsavepath)

num = len(total_xml)
list_index = range(num)
tv = int(num * trainval_percent)
tr = int(tv * train_percent)
trainval = random.sample(list_index, tv)
train = random.sample(trainval, tr)

file_trainval = open(txtsavepath + '/trainval.txt', 'w')
file_test = open(txtsavepath + '/test.txt', 'w')
file_train = open(txtsavepath + '/train.txt', 'w')
file_val = open(txtsavepath + '/val.txt', 'w')

for i in list_index:
    name = total_xml[i][:-4] + '\n'
    if i in trainval:
        file_trainval.write(name)
        if i in train:
            file_train.write(name)
        else:
            file_val.write(name)
    else:
        file_test.write(name)

file_trainval.close()
file_train.close()
file_val.close()
file_test.close()
</code></pre> 
<ul><li> 运行代码后，在dataSet 文件夹下生成下面四个txt文档：</li></ul> 
<p><img alt="" height="83" src="https://images2.imgbox.com/c8/f8/pwWlJnVG_o.png" width="651"></p> 
<ul><li>三个txt文件里面的内容如下： </li></ul> 
<p class="img-center"><img alt="" height="453" src="https://images2.imgbox.com/c0/e4/NeAbVmv2_o.png" width="536"></p> 
<p></p> 
<h4 id="%C2%A02%E3%80%81%E8%BD%AC%E6%8D%A2%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F"> 2、转换数据格式</h4> 
<p>接下来准备labels，把数据集格式转换成yolo_txt格式，即将每个xml标注提取bbox信息为txt格式，每个图像对应一个txt文件，文件每一行为一个目标的信息，包括class, x_center, y_center, width, height格式。格式如下：</p> 
<p><img alt="" height="680" src="https://images2.imgbox.com/22/46/ToEHIzpu_o.png" width="722"></p> 
<ul><li> 创建voc_label.py文件，将训练集、验证集、测试集生成<strong>label标签（训练中要用到）</strong>，同时将数据集路径导入txt文件中，代码内容如下：</li></ul> 
<pre><code class="language-python"># -*- coding: utf-8 -*-
import xml.etree.ElementTree as ET
import os
from os import getcwd

sets = ['train', 'val', 'test']
classes = ["a", "b"]   # 改成自己的类别
abs_path = os.getcwd()
print(abs_path)

def convert(size, box):
    dw = 1. / (size[0])
    dh = 1. / (size[1])
    x = (box[0] + box[1]) / 2.0 - 1
    y = (box[2] + box[3]) / 2.0 - 1
    w = box[1] - box[0]
    h = box[3] - box[2]
    x = x * dw
    w = w * dw
    y = y * dh
    h = h * dh
    return x, y, w, h

def convert_annotation(image_id):
    in_file = open('data/mydata/xml/%s.xml' % (image_id), encoding='UTF-8')
    out_file = open('data/mydata/labels/%s.txt' % (image_id), 'w')
    tree = ET.parse(in_file)
    root = tree.getroot()
    size = root.find('size')
    w = int(size.find('width').text)
    h = int(size.find('height').text)
    for obj in root.iter('object'):
        # difficult = obj.find('difficult').text
        difficult = obj.find('Difficult').text
        cls = obj.find('name').text
        if cls not in classes or int(difficult) == 1:
            continue
        cls_id = classes.index(cls)
        xmlbox = obj.find('bndbox')
        b = (float(xmlbox.find('xmin').text), float(xmlbox.find('xmax').text), float(xmlbox.find('ymin').text),
             float(xmlbox.find('ymax').text))
        b1, b2, b3, b4 = b
        # 标注越界修正
        if b2 &gt; w:
            b2 = w
        if b4 &gt; h:
            b4 = h
        b = (b1, b2, b3, b4)
        bb = convert((w, h), b)
        out_file.write(str(cls_id) + " " + " ".join([str(a) for a in bb]) + '\n')

wd = getcwd()
for image_set in sets:
    if not os.path.exists('data/mydata/labels/'):
        os.makedirs('data/mydata/labels/')
    image_ids = open('data/mydata/dataSet/%s.txt' % (image_set)).read().strip().split()
    list_file = open('paper_data/%s.txt' % (image_set), 'w')
    for image_id in image_ids:
        list_file.write(abs_path + '/mydata/images/%s.jpg\n' % (image_id))
        convert_annotation(image_id)
    list_file.close()
</code></pre> 
<h4 id="%C2%A03%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"> 3、配置文件</h4> 
<p>1）数据集的配置<br> 在mydata文件夹下新建一个mydata.yaml文件（可以自定义命名），用来存放训练集和验证集的划分文件（train.txt和val.txt），这两个文件是通过运行voc_label.py代码生成的，然后是目标的类别数目和具体类别列表，mydata.yaml内容如下：</p> 
<p class="img-center"><img alt="" height="431" src="https://images2.imgbox.com/80/65/rwOCSKs7_o.png" width="757"></p> 
<p></p> 
<p>2) 选择一个你需要的模型<br> 在ultralytics/models/v8/目录下是模型的配置文件，这边提供s、m、l、x版本，逐渐增大（随着架构的增大，训练时间也是逐渐增大），假设采用yolov8x.yaml，只用修改一个参数，把nc改成自己的类别数,需要取整（可选） 如下：</p> 
<p class="img-center"><img alt="" height="727" src="https://images2.imgbox.com/0d/08/fFI23Mzb_o.png" width="874"></p> 
<p>  至此，自定义数据集已创建完毕，接下来就是训练模型了。</p> 
<p></p> 
<h2 id="%C2%A0%E4%B8%89%E3%80%81%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83"> 三、模型训练</h2> 
<h4 id="1%E3%80%81%E4%B8%8B%E8%BD%BD%E9%A2%84%E8%AE%AD%E7%BB%83%E6%A8%A1%E5%9E%8B">1、下载预训练模型</h4> 
<p><a class="link-info" href="https://github.com/ultralytics/assets/releases" title="在YOLOv8的GitHub开源网址上下载对应版本的模型">在YOLOv8的GitHub开源网址上下载对应版本的模型</a></p> 
<p class="img-center"><img alt="" height="550" src="https://images2.imgbox.com/a5/cf/WTsvvU4X_o.png" width="1115"></p> 
<h4> 2、训练</h4> 
<p></p> 
<p>接下来就可以开始训练模型了，命令如下：</p> 
<pre><code class="language-python">yolo task=detect mode=train model=yolov8x.yaml data=mydata.yaml epochs=1000 batch=16</code></pre> 
<p></p> 
<p>以上参数解释如下：</p> 
<p>task：选择任务类型，可选['detect', 'segment', 'classify', 'init']</p> 
<p>mode: 选择是训练、验证还是预测的任务蕾西 可选['train', 'val', 'predict']</p> 
<p>model: 选择yolov8不同的模型配置文件，可选yolov8s.yaml、yolov8m.yaml、yolov8l.yaml、yolov8x.yaml</p> 
<p>data: 选择生成的数据集配置文件</p> 
<p>epochs：指的就是训练过程中整个数据集将被迭代多少次,显卡不行你就调小点。<br> batch：一次看完多少张图片才进行权重更新，梯度下降的mini-batch,显卡不行你就调小点。<br>  </p> 
<p>训练过程如下所示</p> 
<p class="img-center"><img alt="" height="397" src="https://images2.imgbox.com/40/55/ykxs4Vh7_o.png" width="1200"></p> 
<p></p> 
<h2 id="%E5%9B%9B%E3%80%81%E6%A8%A1%E5%9E%8B%E6%B5%8B%E8%AF%95"></h2> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/58429a1aa1a7ef3dcdf14344979facb7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">yolov5s模型剪枝详细过程(v6.0)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0c4b4b16d3a8e97eafe2228de76dcebb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">拓扑排序 （算法思想&#43;图解&#43;模板&#43;练习题）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>