<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>深入分析 Android ContentProvider (一) - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/f946ea0e65ef13d46888e25a9565d803/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="深入分析 Android ContentProvider (一)">
  <meta property="og:description" content="文章目录 深入分析 Android ContentProvider (一)1. Android 中的 ContentProvider 设计说明1.1. ContentProvider 的设计初衷1.2. ContentProvider 的基本结构1.3. ContentProvider 的实现示例：实现一个简单的 ContentProvider 1.4. ContentProvider 的使用 2. ContentProvider 的设计优势3. ContentProvider 的注意事项4. 总结 深入分析 Android ContentProvider (一) 1. Android 中的 ContentProvider 设计说明 ContentProvider 是 Android 中四大组件之一，主要用于在不同应用之间共享数据。ContentProvider 提供了一个一致的接口，使得应用能够以一种受控和安全的方式访问和修改存储的数据。通过 ContentProvider，数据可以被跨进程共享，而不必将数据直接暴露给其他应用。
1.1. ContentProvider 的设计初衷 数据共享：在 Android 中，应用之间的直接数据访问是不允许的。ContentProvider 提供了一种标准化的方式，使得应用可以安全地共享数据。数据封装：通过 ContentProvider，数据存取逻辑可以封装在一个单独的组件中，其他组件只需通过 ContentProvider 提供的接口进行数据操作。统一接口：ContentProvider 提供了一个统一的接口，支持多种数据存取方式（如插入、删除、更新、查询），并且支持对数据进行事务操作。 1.2. ContentProvider 的基本结构 一个典型的 ContentProvider 包括以下几个部分：
URI：统一资源标识符，用于定位 ContentProvider 中的数据。MIME 类型：用于标识返回的数据类型。数据存储：实际存储数据的地方，如数据库、文件等。数据操作方法：用于操作数据的标准方法，如 query、insert、update 和 delete。 1.3. ContentProvider 的实现 要实现一个 ContentProvider，需要继承 ContentProvider 类并实现其抽象方法。以下是一个简单的示例：">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-20T16:49:07+08:00">
    <meta property="article:modified_time" content="2024-07-20T16:49:07+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">深入分析 Android ContentProvider (一)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_Android_ContentProvider__1" rel="nofollow">深入分析 Android ContentProvider (一)</a></li><li><a href="#1_Android__ContentProvider__2" rel="nofollow">1. Android 中的 ContentProvider 设计说明</a></li><li><ul><li><a href="#11_ContentProvider__5" rel="nofollow">1.1. ContentProvider 的设计初衷</a></li><li><a href="#12_ContentProvider__11" rel="nofollow">1.2. ContentProvider 的基本结构</a></li><li><a href="#13_ContentProvider__19" rel="nofollow">1.3. ContentProvider 的实现</a></li><li><ul><li><a href="#_ContentProvider_23" rel="nofollow">示例：实现一个简单的 ContentProvider</a></li></ul> 
    </li><li><a href="#14_ContentProvider__187" rel="nofollow">1.4. ContentProvider 的使用</a></li></ul> 
   </li><li><a href="#2_ContentProvider__228" rel="nofollow">2. ContentProvider 的设计优势</a></li><li><a href="#3_ContentProvider__235" rel="nofollow">3. ContentProvider 的注意事项</a></li><li><a href="#4__241" rel="nofollow">4. 总结</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_Android_ContentProvider__1"></a>深入分析 Android ContentProvider (一)</h3> 
<h3><a id="1_Android__ContentProvider__2"></a>1. Android 中的 ContentProvider 设计说明</h3> 
<p>ContentProvider 是 Android 中四大组件之一，主要用于在不同应用之间共享数据。ContentProvider 提供了一个一致的接口，使得应用能够以一种受控和安全的方式访问和修改存储的数据。通过 ContentProvider，数据可以被跨进程共享，而不必将数据直接暴露给其他应用。</p> 
<h4><a id="11_ContentProvider__5"></a>1.1. ContentProvider 的设计初衷</h4> 
<ol><li><strong>数据共享</strong>：在 Android 中，应用之间的直接数据访问是不允许的。ContentProvider 提供了一种标准化的方式，使得应用可以安全地共享数据。</li><li><strong>数据封装</strong>：通过 ContentProvider，数据存取逻辑可以封装在一个单独的组件中，其他组件只需通过 ContentProvider 提供的接口进行数据操作。</li><li><strong>统一接口</strong>：ContentProvider 提供了一个统一的接口，支持多种数据存取方式（如插入、删除、更新、查询），并且支持对数据进行事务操作。</li></ol> 
<h4><a id="12_ContentProvider__11"></a>1.2. ContentProvider 的基本结构</h4> 
<p>一个典型的 ContentProvider 包括以下几个部分：</p> 
<ol><li><strong>URI</strong>：统一资源标识符，用于定位 ContentProvider 中的数据。</li><li><strong>MIME 类型</strong>：用于标识返回的数据类型。</li><li><strong>数据存储</strong>：实际存储数据的地方，如数据库、文件等。</li><li><strong>数据操作方法</strong>：用于操作数据的标准方法，如 <code>query</code>、<code>insert</code>、<code>update</code> 和 <code>delete</code>。</li></ol> 
<h4><a id="13_ContentProvider__19"></a>1.3. ContentProvider 的实现</h4> 
<p>要实现一个 ContentProvider，需要继承 <code>ContentProvider</code> 类并实现其抽象方法。以下是一个简单的示例：</p> 
<h5><a id="_ContentProvider_23"></a>示例：实现一个简单的 ContentProvider</h5> 
<ol><li><strong>创建数据库和表</strong></li></ol> 
<p>首先，需要创建一个 SQLite 数据库来存储数据。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DatabaseHelper</span> <span class="token keyword">extends</span> <span class="token class-name">SQLiteOpenHelper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DATABASE_NAME</span> <span class="token operator">=</span> <span class="token string">"example.db"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">DATABASE_VERSION</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TABLE_NAME</span> <span class="token operator">=</span> <span class="token string">"example"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">COLUMN_ID</span> <span class="token operator">=</span> <span class="token string">"_id"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">COLUMN_NAME</span> <span class="token operator">=</span> <span class="token string">"name"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TABLE_CREATE</span> <span class="token operator">=</span>
            <span class="token string">"CREATE TABLE "</span> <span class="token operator">+</span> <span class="token constant">TABLE_NAME</span> <span class="token operator">+</span> <span class="token string">" ("</span> <span class="token operator">+</span>
            <span class="token constant">COLUMN_ID</span> <span class="token operator">+</span> <span class="token string">" INTEGER PRIMARY KEY AUTOINCREMENT, "</span> <span class="token operator">+</span>
            <span class="token constant">COLUMN_NAME</span> <span class="token operator">+</span> <span class="token string">" TEXT);"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DatabaseHelper</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token constant">DATABASE_NAME</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token constant">DATABASE_VERSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">SQLiteDatabase</span> db<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span><span class="token constant">TABLE_CREATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onUpgrade</span><span class="token punctuation">(</span><span class="token class-name">SQLiteDatabase</span> db<span class="token punctuation">,</span> <span class="token keyword">int</span> oldVersion<span class="token punctuation">,</span> <span class="token keyword">int</span> newVersion<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        db<span class="token punctuation">.</span><span class="token function">execSQL</span><span class="token punctuation">(</span><span class="token string">"DROP TABLE IF EXISTS "</span> <span class="token operator">+</span> <span class="token constant">TABLE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">onCreate</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li><strong>实现 ContentProvider</strong></li></ol> 
<p>实现 ContentProvider 类并覆盖其方法。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExampleProvider</span> <span class="token keyword">extends</span> <span class="token class-name">ContentProvider</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">AUTHORITY</span> <span class="token operator">=</span> <span class="token string">"com.example.provider"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">BASE_PATH</span> <span class="token operator">=</span> <span class="token string">"example"</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Uri</span> <span class="token constant">CONTENT_URI</span> <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"content://"</span> <span class="token operator">+</span> <span class="token constant">AUTHORITY</span> <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> <span class="token constant">BASE_PATH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">SQLiteDatabase</span> database<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CONTENT_TYPE</span> <span class="token operator">=</span> <span class="token string">"vnd.android.cursor.dir/vnd.example.example"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CONTENT_ITEM_TYPE</span> <span class="token operator">=</span> <span class="token string">"vnd.android.cursor.item/vnd.example.example"</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">EXAMPLES</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token constant">EXAMPLE_ID</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">UriMatcher</span> uriMatcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UriMatcher</span><span class="token punctuation">(</span><span class="token class-name">UriMatcher</span><span class="token punctuation">.</span><span class="token constant">NO_MATCH</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>
        uriMatcher<span class="token punctuation">.</span><span class="token function">addURI</span><span class="token punctuation">(</span><span class="token constant">AUTHORITY</span><span class="token punctuation">,</span> <span class="token constant">BASE_PATH</span><span class="token punctuation">,</span> <span class="token constant">EXAMPLES</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        uriMatcher<span class="token punctuation">.</span><span class="token function">addURI</span><span class="token punctuation">(</span><span class="token constant">AUTHORITY</span><span class="token punctuation">,</span> <span class="token constant">BASE_PATH</span> <span class="token operator">+</span> <span class="token string">"/#"</span><span class="token punctuation">,</span> <span class="token constant">EXAMPLE_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DatabaseHelper</span> helper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatabaseHelper</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        database <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">getWritableDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Nullable</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Cursor</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Uri</span> uri<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> projection<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> selection<span class="token punctuation">,</span>
                        <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> selectionArgs<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> sortOrder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Cursor</span> cursor<span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>uriMatcher<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token constant">EXAMPLES</span><span class="token operator">:</span>
                cursor <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">DatabaseHelper</span><span class="token punctuation">.</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> projection<span class="token punctuation">,</span> selection<span class="token punctuation">,</span> selectionArgs<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> sortOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">EXAMPLE_ID</span><span class="token operator">:</span>
                cursor <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">DatabaseHelper</span><span class="token punctuation">.</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> projection<span class="token punctuation">,</span> <span class="token class-name">DatabaseHelper</span><span class="token punctuation">.</span><span class="token constant">COLUMN_ID</span> <span class="token operator">+</span> <span class="token string">"=?"</span><span class="token punctuation">,</span>
                        <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">ContentUris</span><span class="token punctuation">.</span><span class="token function">parseId</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> sortOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Unknown URI: "</span> <span class="token operator">+</span> uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        cursor<span class="token punctuation">.</span><span class="token function">setNotificationUri</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> cursor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Nullable</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Uri</span> uri<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>uriMatcher<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token constant">EXAMPLES</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token constant">CONTENT_TYPE</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">EXAMPLE_ID</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token constant">CONTENT_ITEM_TYPE</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Unknown URI: "</span> <span class="token operator">+</span> uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Nullable</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Uri</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Uri</span> uri<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ContentValues</span> values<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">long</span> id <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">DatabaseHelper</span><span class="token punctuation">.</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Uri</span> returnUri <span class="token operator">=</span> <span class="token class-name">ContentUris</span><span class="token punctuation">.</span><span class="token function">withAppendedId</span><span class="token punctuation">(</span><span class="token constant">CONTENT_URI</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">notifyChange</span><span class="token punctuation">(</span>returnUri<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> returnUri<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SQLException</span><span class="token punctuation">(</span><span class="token string">"Failed to insert row into "</span> <span class="token operator">+</span> uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Uri</span> uri<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> selection<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> selectionArgs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> rowsDeleted<span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>uriMatcher<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token constant">EXAMPLES</span><span class="token operator">:</span>
                rowsDeleted <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">DatabaseHelper</span><span class="token punctuation">.</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> selection<span class="token punctuation">,</span> selectionArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">EXAMPLE_ID</span><span class="token operator">:</span>
                rowsDeleted <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">DatabaseHelper</span><span class="token punctuation">.</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> <span class="token class-name">DatabaseHelper</span><span class="token punctuation">.</span><span class="token constant">COLUMN_ID</span> <span class="token operator">+</span> <span class="token string">"=?"</span><span class="token punctuation">,</span>
                        <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">ContentUris</span><span class="token punctuation">.</span><span class="token function">parseId</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Unknown URI: "</span> <span class="token operator">+</span> uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rowsDeleted <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">notifyChange</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> rowsDeleted<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Uri</span> uri<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ContentValues</span> values<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> selection<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> selectionArgs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> rowsUpdated<span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>uriMatcher<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token constant">EXAMPLES</span><span class="token operator">:</span>
                rowsUpdated <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">DatabaseHelper</span><span class="token punctuation">.</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> values<span class="token punctuation">,</span> selection<span class="token punctuation">,</span> selectionArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token constant">EXAMPLE_ID</span><span class="token operator">:</span>
                rowsUpdated <span class="token operator">=</span> database<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">DatabaseHelper</span><span class="token punctuation">.</span><span class="token constant">TABLE_NAME</span><span class="token punctuation">,</span> values<span class="token punctuation">,</span> <span class="token class-name">DatabaseHelper</span><span class="token punctuation">.</span><span class="token constant">COLUMN_ID</span> <span class="token operator">+</span> <span class="token string">"=?"</span><span class="token punctuation">,</span>
                        <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">ContentUris</span><span class="token punctuation">.</span><span class="token function">parseId</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Unknown URI: "</span> <span class="token operator">+</span> uri<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>rowsUpdated <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">notifyChange</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> rowsUpdated<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li><strong>在 Manifest 中声明 ContentProvider</strong></li></ol> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>provider</span>
    <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.ExampleProvider<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>authorities</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.provider<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<h4><a id="14_ContentProvider__187"></a>1.4. ContentProvider 的使用</h4> 
<ol><li><strong>查询数据</strong></li></ol> 
<pre><code class="prism language-java"><span class="token class-name">Uri</span> uri <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"content://com.example.provider/example"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Cursor</span> cursor <span class="token operator">=</span> <span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>cursor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">moveToNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> cursor<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>cursor<span class="token punctuation">.</span><span class="token function">getColumnIndexOrThrow</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 处理数据</span>
    <span class="token punctuation">}</span>
    cursor<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li><strong>插入数据</strong></li></ol> 
<pre><code class="prism language-java"><span class="token class-name">ContentValues</span> values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Example Name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Uri</span> uri <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"content://com.example.provider/example"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Uri</span> newUri <span class="token operator">=</span> <span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="3"><li><strong>更新数据</strong></li></ol> 
<pre><code class="prism language-java"><span class="token class-name">ContentValues</span> values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Updated Name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Uri</span> uri <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"content://com.example.provider/example/1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> rowsUpdated <span class="token operator">=</span> <span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> values<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="4"><li><strong>删除数据</strong></li></ol> 
<pre><code class="prism language-java"><span class="token class-name">Uri</span> uri <span class="token operator">=</span> <span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"content://com.example.provider/example/1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> rowsDeleted <span class="token operator">=</span> <span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="2_ContentProvider__228"></a>2. ContentProvider 的设计优势</h3> 
<ol><li><strong>数据共享</strong>：提供了标准化的数据共享接口，使得不同应用可以安全地共享数据。</li><li><strong>数据封装</strong>：将数据存取逻辑封装在 ContentProvider 中，降低了模块间的耦合度。</li><li><strong>统一访问</strong>：通过统一的 URI 和接口访问数据，简化了数据操作。</li><li><strong>跨进程通信</strong>：支持跨进程访问数据，使得应用之间可以实现复杂的数据交互。</li></ol> 
<h3><a id="3_ContentProvider__235"></a>3. ContentProvider 的注意事项</h3> 
<ol><li><strong>性能考虑</strong>：由于 ContentProvider 通常用于跨进程数据共享，频繁的跨进程调用会有性能开销，需注意优化查询和数据操作。</li><li><strong>权限管理</strong>：确保数据访问权限的安全性，通过权限声明和检查，防止数据泄露和未经授权的访问。</li><li><strong>数据一致性</strong>：确保在高并发场景下的数据一致性，必要时使用事务机制。</li></ol> 
<h3><a id="4__241"></a>4. 总结</h3> 
<p>ContentProvider 是 Android 中用于数据共享和跨进程通信的重要组件，通过统一的接口和标准化的 URI 访问方式，提供了安全、封装和</p> 
<table><tbody><tr><td bgcolor="#FF0066"> <font size="5" color="#ffffff" face="宋体"> <b> 欢迎点赞|关注|收藏|评论，您的肯定是我创作的动力 </b> </font> </td></tr></tbody></table> 
<font size="20"> </font> 
<p><img src="https://images2.imgbox.com/42/ea/pzmuxC55_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d0c41db2830543885cc2ef15e2daeaf0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Go: IM系统接入ws进行消息发送以及群聊功能 (5)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6c6176f024c86e6da57d08ec258018b1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;初阶学习第二弹——入门学习C&#43;&#43;</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>