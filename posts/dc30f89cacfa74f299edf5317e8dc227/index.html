<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Web Speech API（2）—— SpeechSynthesis - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/dc30f89cacfa74f299edf5317e8dc227/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Web Speech API（2）—— SpeechSynthesis">
  <meta property="og:description" content="Web Speech API 使你能够将语音数据合并到 Web 应用程序中。Web Speech API 有两个部分：SpeechSynthesis 语音合成（文本到语音 TTS）和 SpeechRecognition 语音识别（异步语音识别）。
Speech synthesis 语音合成 (也被称作是文本转为语音，英语简写是 tts) 包括接收 app 中需要语音合成的文本，再在设备麦克风播放出来这两个过程。
Web Speech API 对此有一个主要控制接口——SpeechSynthesis ，外加一些处理如何表示要被合成的文本 (也被称为 utterances)，用什么声音来播出 utterances 等工作的相关接口。
语音合成 1.SpeechSynthesis
语音合成服务的控制器接口，可用于获取设备上可用的合成语音，开始、暂停以及其他相关命令的信息。
属性 SpeechSynthesis.paused 只读
当SpeechSynthesis 处于暂停状态时， Boolean 值返回 true 。
SpeechSynthesis.pending 只读
当语音播放队列到目前为止保持没有说完的语音时， Boolean 值返回 true 。
SpeechSynthesis.speaking 只读
当语音谈话正在进行的时候，即使SpeechSynthesis处于暂停状态， Boolean 返回 true 。
事件操作 SpeechSynthesis.onvoiceschanged
当由SpeechSynthesis.getVoices()方法返回的SpeechSynthesisVoice列表改变时触发。
方法 SpeechSynthesis.cancel()
移除所有语音谈话队列中的谈话。
SpeechSynthesis.getVoices()
返回当前设备所有可用声音的 SpeechSynthesisVoice列表。
SpeechSynthesis.pause()
把 SpeechSynthesis 对象置为暂停状态。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-21T10:22:42+08:00">
    <meta property="article:modified_time" content="2024-05-21T10:22:42+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Web Speech API（2）—— SpeechSynthesis</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>Web Speech API 使你能够将语音数据合并到 Web 应用程序中。Web Speech API 有两个部分：SpeechSynthesis 语音合成（文本到语音 TTS）和 SpeechRecognition 语音识别（异步语音识别）。</p> 
<p></p> 
<h3><strong><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Speech_API/Using_the_Web_Speech_API#speech_synthesis" rel="nofollow" title="Speech synthesis">Speech synthesis</a></strong></h3> 
<p>语音合成 (也被称作是文本转为语音，英语简写是 tts) 包括接收 app 中需要语音合成的文本，再在设备麦克风播放出来这两个过程。</p> 
<p>Web Speech API 对此有一个主要控制接口——<u><code><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SpeechSynthesis" rel="nofollow" title="SpeechSynthesis">SpeechSynthesis</a></code></u> ，外加一些处理如何表示要被合成的文本 (也被称为 utterances)，用什么声音来播出 utterances 等工作的相关接口。</p> 
<h3><strong><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Speech_API#%E8%AF%AD%E9%9F%B3%E5%90%88%E6%88%90" rel="nofollow" title="语音合成">语音合成</a></strong></h3> 
<p><u><code>1.</code></u><u><code><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SpeechSynthesis" rel="nofollow" title="SpeechSynthesis">SpeechSynthesis</a></code></u></p> 
<p>语音合成服务的控制器接口，可用于获取设备上可用的合成语音，开始、暂停以及其他相关命令的信息。</p> 
<h3><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SpeechSynthesis#%E5%B1%9E%E6%80%A7" rel="nofollow" title="属性">属性</a></h3> 
<p><u><code><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SpeechSynthesis/paused" rel="nofollow" title="SpeechSynthesis.paused">SpeechSynthesis.paused</a></code></u> 只读</p> 
<p>当<code>SpeechSynthesis</code> 处于暂停状态时， <u><code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean" rel="nofollow" title="Boolean">Boolean</a></code></u> 值返回 <code>true</code> 。</p> 
<p><u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesis/pending" rel="nofollow" title="SpeechSynthesis.pending">SpeechSynthesis.pending</a></code></u> 只读</p> 
<p>当语音播放队列到目前为止保持没有说完的语音时， <u><code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean" rel="nofollow" title="Boolean">Boolean</a></code></u> 值返回 <code>true</code> 。</p> 
<p><u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesis/speaking" rel="nofollow" title="SpeechSynthesis.speaking">SpeechSynthesis.speaking</a></code></u> 只读</p> 
<p>当语音谈话正在进行的时候，即使<code>SpeechSynthesis</code>处于暂停状态， <u><code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean" rel="nofollow" title="Boolean">Boolean</a></code></u> 返回 <code>true</code> 。</p> 
<h4><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SpeechSynthesis#%E4%BA%8B%E4%BB%B6%E6%93%8D%E4%BD%9C" rel="nofollow" title="事件操作">事件操作</a></h4> 
<p><u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesis/voiceschanged_event" rel="nofollow" title="SpeechSynthesis.onvoiceschanged">SpeechSynthesis.onvoiceschanged</a></code></u></p> 
<p>当由<u><code><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SpeechSynthesis/getVoices" rel="nofollow" title="SpeechSynthesis.getVoices()">SpeechSynthesis.getVoices()</a></code></u>方法返回的<u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisVoice" rel="nofollow" title="SpeechSynthesisVoice">SpeechSynthesisVoice</a></code></u>列表改变时触发。</p> 
<h3><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SpeechSynthesis#%E6%96%B9%E6%B3%95" rel="nofollow" title="方法">方法</a></h3> 
<p><u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesis/cancel" rel="nofollow" title="SpeechSynthesis.cancel()">SpeechSynthesis.cancel()</a></code></u></p> 
<p>移除所有语音谈话队列中的谈话。</p> 
<p><u><code><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SpeechSynthesis/getVoices" rel="nofollow" title="SpeechSynthesis.getVoices()">SpeechSynthesis.getVoices()</a></code></u></p> 
<p>返回当前设备所有可用声音的 <u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisVoice" rel="nofollow" title="SpeechSynthesisVoice">SpeechSynthesisVoice</a></code></u>列表。</p> 
<p><u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesis/pause" rel="nofollow" title="SpeechSynthesis.pause()">SpeechSynthesis.pause()</a></code></u></p> 
<p>把 <code>SpeechSynthesis</code> 对象置为暂停状态。</p> 
<p><u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesis/resume" rel="nofollow" title="SpeechSynthesis.resume()">SpeechSynthesis.resume()</a></code></u></p> 
<p>把 <code>SpeechSynthesis</code> 对象置为一个非暂停状态：如果已经暂停了则继续。</p> 
<p><u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesis/speak" rel="nofollow" title="SpeechSynthesis.speak()">SpeechSynthesis.speak()</a></code></u></p> 
<p>添加一个 <u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance" rel="nofollow" title="utterance">utterance</a></code></u> 到语音谈话队列；它将会在其他语音谈话播放完之后播放。</p> 
<p></p> 
<p></p> 
<p><u><code>2.</code></u><u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisErrorEvent" rel="nofollow" title="SpeechSynthesisErrorEvent">SpeechSynthesisErrorEvent</a></code></u></p> 
<p>包含了在发音服务处理 <u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance" rel="nofollow" title="SpeechSynthesisUtterance">SpeechSynthesisUtterance</a></code></u> 对象过程中的信息及报错信息。</p> 
<p><u><code>3.</code></u><u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisEvent" rel="nofollow" title="SpeechSynthesisEvent">SpeechSynthesisEvent</a></code></u></p> 
<p>包含了经由发音服务处理过的 <u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance" rel="nofollow" title="SpeechSynthesisUtterance">SpeechSynthesisUtterance</a></code></u> 对象当前状态的信息。</p> 
<p><u><code>4.</code></u><u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisUtterance" rel="nofollow" title="SpeechSynthesisUtterance">SpeechSynthesisUtterance</a></code></u></p> 
<p>表示一次发音请求。其中包含了将由语音服务朗读的内容，以及如何朗读它（例如：语种、音高、音量）。</p> 
<p><u><code>5.</code></u><u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/SpeechSynthesisVoice" rel="nofollow" title="SpeechSynthesisVoice">SpeechSynthesisVoice</a></code></u></p> 
<p>表示系统提供的一个声音。每个 <code>SpeechSynthesisVoice</code> 都有与之相关的发音服务，包括了语种、名称 和 URI 等信息。</p> 
<p><u><code><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/speechSynthesis" rel="nofollow" title="Window.speechSynthesis">Window.speechSynthesis</a></code></u></p> 
<p>由规格文档指定的，被称为 <code>SpeechSynthesisGetter</code> 的 <code>[NoInterfaceObject]</code> 接口的一部分，在 <code>Window</code> 对象中实现，<code>speechSynthesis</code> 属性可用于访问 <u><code><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SpeechSynthesis" rel="nofollow" title="SpeechSynthesis">SpeechSynthesis</a></code></u> 控制器，从而获取语音合成功能的入口。</p> 
<h4><u><strong><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Speech_API#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7" rel="nofollow" title="浏览器兼容性">浏览器兼容性</a></strong></u></h4> 
<p>目前主流浏览器版本（截止2024-5-21）</p> 
<p>Firefox （126.0）</p> 
<p>Chrome（125.0.6422.61）</p> 
<p>Safari（15.6.1）</p> 
<pre><code class="language-javascript">&lt;template&gt;
  &lt;div class="s-s-wrap"&gt;
    &lt;textarea
      id="text-to-speak"
      rows="10"
      cols="50"
      placeholder="Enter text here"
    &gt;&lt;/textarea&gt;
    &lt;br /&gt;&lt;br /&gt;
    &lt;label for="voices"&gt;Voice:&lt;/label&gt;
    &lt;select id="voices"&gt;&lt;/select&gt;
    &lt;br /&gt;&lt;br /&gt;
    &lt;label for="rate"&gt;Rate:&lt;/label&gt;
    &lt;input type="range" id="rate" min="0.5" max="2" value="1" step="0.1" /&gt;
    &lt;span id="rate-value"&gt;1&lt;/span&gt;
    &lt;br /&gt;&lt;br /&gt;
    &lt;label for="pitch"&gt;Pitch:&lt;/label&gt;
    &lt;input type="range" id="pitch" min="0" max="2" value="1" step="0.1" /&gt;
    &lt;span id="pitch-value"&gt;1&lt;/span&gt;
    &lt;br /&gt;&lt;br /&gt;
    &lt;label for="volume"&gt;Volume:&lt;/label&gt;
    &lt;input type="range" id="volume" min="0" max="1" value="1" step="0.1" /&gt;
    &lt;span id="volume-value"&gt;1&lt;/span&gt;
    &lt;br /&gt;&lt;br /&gt;
    &lt;button id="speak-btn" @click="speak" style="margin-right: 10px"&gt;
      Speak
    &lt;/button&gt;
    &lt;button id="cancel-btn" @click="cancel" style="margin-right: 10px"&gt;
      cancel
    &lt;/button&gt;
    &lt;button id="pause-btn" @click="pause" style="margin-right: 10px"&gt;
      pause
    &lt;/button&gt;
    &lt;button id="resume-btn" @click="resume" style="margin-right: 10px"&gt;
      resume
    &lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
/* 
大千世界,无奇不有。我陈平安,唯有一剑,可搬山,倒海,降妖,镇魔,敕神,摘星,断江,摧城,开天!&lt;mark name="highlight"&gt;我叫陈平安&lt;/mark&gt;,平平安安的平安。我是一名剑客。
*/
let voices = []
export default {
  mounted() {
    this.populateVoices()
    let synth = window.speechSynthesis
    /* 
    因为 Firefox 不支持SpeechSynthesis.onvoiceschanged ，
    所以很常规地只是返回语音对象列表当SpeechSynthesis.getVoices() 被触发。
    但是 Chrome 就有点不同了，在SpeechSynthesis.getVoices() 被触发时，
    先要等待事件触发 (有点绕~按照下面代码，populateVoices 函数在 Firefox 运行一次，在 Chrome 中运行两次)：
    */
    if (synth.onvoiceschanged !== undefined) {
      synth.onvoiceschanged = this.populateVoices
    }
    // 监听
    const rate = document.getElementById('rate')
    rate.addEventListener('change', this.setRateValue)

    const pitch = document.getElementById('pitch')
    pitch.addEventListener('change', this.setPitchValue)

    const volume = document.getElementById('volume')
    volume.addEventListener('change', this.setVolumeValue)
  },
  methods: {
    // 使用设备可使用的不同的语音选项展示
    populateVoices() {
      // 引用window.speechSynthesis这个api
      let synth = window.speechSynthesis
      // 调用SpeechSynthesis.getVoices()
      // 这个函数返回包含所有可用语音 (SpeechSynthesisVoice对象) 的列表
      voices = synth.getVoices()

      const voicesDropdown = document.getElementById('voices')
      // 循环填入声音的名称（从SpeechSynthesisVoice.name获取），语音的语言（从SpeechSynthesisVoice.lang获取）
      // 引擎默认的 (SpeechSynthesisVoice.default属性是true)
      voicesDropdown.innerHTML = voices
        .map(
          (voice, i) =&gt;
            `&lt;option value="${i}"&gt;${voice.name} (${voice.lang})&lt;/option&gt;`
        )
        .join('')
    },
    // 设置语速
    setRateValue() {
      const rate = document.getElementById('rate')
      const rateValue = document.getElementById('rate-value')
      rateValue.textContent = rate.value
    },
    setPitchValue() {
      const pitch = document.getElementById('pitch')
      const pitchValue = document.getElementById('pitch-value')
      pitchValue.textContent = pitch.value
    },
    setVolumeValue() {
      const volume = document.getElementById('volume')
      const volumeValue = document.getElementById('volume-value')
      volumeValue.textContent = volume.value
    },
    speak() {
      let synth = window.speechSynthesis
      console.log('speak', synth)
      if (synth.speaking) {
        console.error('speechSynthesis.speaking')
        return
      }
      const textArea = document.getElementById('text-to-speak')
      const voicesDropdown = document.getElementById('voices')
      // 创建一个新的SpeechSynthesisUtterance() 实例——把文本输入框中的值作为参数传递。
      const utterThis = new SpeechSynthesisUtterance(textArea.value)
      // const utterThis = new SpeechSynthesisUtterance()
      // utterThis.text = '这是一段&lt;mark name="highlight"&gt;重要的&lt;/mark&gt;文本。'
      console.log(voices, 'voices', voices[voicesDropdown.value])
      // 使用哪种语音
      // 把匹配的语音对象设置为SpeechSynthesisUtterance.voice 的属性值
      utterThis.voice = voices[voicesDropdown.value]

      const rate = document.getElementById('rate')
      const pitch = document.getElementById('pitch')
      const volume = document.getElementById('volume')
      // 设置语速
      utterThis.rate = rate.value
      // 设置音高（音调）
      utterThis.pitch = pitch.value
      // 设置音量(响度)
      utterThis.volume = volume.value
      // 错误监听
      utterThis.onerror = event =&gt; {
        console.log(`speech-synthesis-错误监听: ${event}`)
      }
      // 暂停操作监听
      utterThis.onpause = event =&gt; {
        const char = event.utterance.text.charAt(event.charIndex)
        console.log(
          event,
          `当前暂停位置的字符索引:${event.charIndex}, 文本内容:"${event.utterance.text}", 具体字符: "${char}".`
        )
      }
      // 边界监听
      utterThis.onboundary = event =&gt; {
        console.log(event, `${event.name}  时间： ${event.elapsedTime} 秒.`)
      }
      // 标记监听
      utterThis.onmark = event =&gt; {
        console.log('标记监听', event)
        if (event.name === 'highlight') {
          console.log('朗读到达标记：' + event.name)
          // 在这里执行您想要的操作，比如高亮显示文本、播放声音等
        }
      }
      // 调用 SpeechSynthesis.speak() 开始说话
      // 把 SpeechSynthesisUtterance 实例作为参数传递
      synth.speak(utterThis)
    },
    cancel() {
      let synth = window.speechSynthesis
      console.log('cancel', synth)
      synth.cancel()
    },
    pause() {
      let synth = window.speechSynthesis
      console.log('pause', synth)
      synth.pause()
    },
    resume() {
      let synth = window.speechSynthesis
      console.log('resume', synth)
      synth.resume()
    }
  }
}
&lt;/script&gt;

&lt;style&gt;
.s-s-wrap {
  width: 370px;
  margin: auto;
}
&lt;/style&gt;
</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f04002b58169d4d775b041f4a46b65eb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[Android]运行项目报错The application could not be installed: INSTALL_FAILED_SHARED_USER_INCOMPATIBLE</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/223db1939896aaf91d38f1fd4c868f5e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">AI写作：kimi智能AI助手如何下载以及怎么使用？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>