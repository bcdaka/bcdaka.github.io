<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>YOLOv8æµ‹è¯•3ï¼šåœ¨Pythonä¸­å°†YOLOv8æ¨¡å‹å°è£…æˆAPIæ¥å£ä½¿ç”¨ï¼ˆä¸Šä¼ æµ‹è¯•å›¾ç‰‡å¹¶è¿”å›è¯†åˆ«ç»“æœï¼Œé™„æµ‹è¯•ä»£ç ï¼‰ - ç¼–ç¨‹å¤§å’–</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/df30baa425e2624fc10b3b2412fb3215/">
  <meta property="og:site_name" content="ç¼–ç¨‹å¤§å’–">
  <meta property="og:title" content="YOLOv8æµ‹è¯•3ï¼šåœ¨Pythonä¸­å°†YOLOv8æ¨¡å‹å°è£…æˆAPIæ¥å£ä½¿ç”¨ï¼ˆä¸Šä¼ æµ‹è¯•å›¾ç‰‡å¹¶è¿”å›è¯†åˆ«ç»“æœï¼Œé™„æµ‹è¯•ä»£ç ï¼‰">
  <meta property="og:description" content="ä¸€ã€æ¦‚è¿° è®°å½•æ—¶é—´ [2024-4-4]
æœ¬æ–‡è®²è¿°çš„æ˜¯åœ¨Windowsç³»ç»Ÿï¼ˆPython&#43;PyTorch&#43;Conda&#43;cpuï¼‰ä¸­YOLOv8æ¨¡å‹çš„ç®€å•åº”ç”¨ã€‚è¿™é‡Œé™„å¸¦ä¸ŠYOLOv8å®˜æ–¹æ–‡æ¡£ï¼Œé‡Œé¢è®°è½½äº†è¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¦‚æœè§‰å¾—çœ‹æ–‡æ¡£æ¯”è¾ƒéº»çƒ¦çš„è¯ï¼Œå¯ä»¥ç›´æ¥çœ‹æ–‡ç« ï¼Œéœ€è¦ç”¨åˆ°çš„éƒ¨åˆ†å·²ç»åœ¨æ–‡ç« ä¸­è¿›è¡Œäº†æ‘˜å½•ã€‚
ç»è¿‡äº†å‰å‡ æ¬¡çš„å°è¯•ï¼Œæˆ‘ä»¬ä¸ä»…èƒ½ä½¿ç”¨CLIçš„æ–¹å¼è¿è¡Œyolov8n.ptæ¨¡å‹ï¼Œå¯¹å›¾åƒå’Œè§†é¢‘è¿›è¡Œç›®æ ‡è¯†åˆ«ï¼Œå¹¶å¾—åˆ°ç»“æœã€‚
å‚è€ƒæ–‡ç« ï¼šYOLOv8æ¨¡å‹çš„ç®€å•æµ‹è¯•ï¼ŒWindowsç¯å¢ƒä¸‹å®‰è£…éƒ¨ç½²ï¼ˆPython&#43;PyTorch&#43;Conda&#43;cpu&#43;CLIï¼‰
ä¹Ÿå¯ä»¥åœ¨PyCharmé›†æˆå¼€å‘ç¯å¢ƒä¸­ç¼–å†™ç®€å•çš„pythonæ–‡ä»¶ï¼Œä»¥pythonçš„æ–¹å¼å¯¹YOLOv8æ¨¡å‹è¿›è¡Œç®€å•çš„æµ‹è¯•ã€‚
å‚è€ƒæ–‡ç« ï¼šYOLOv8æ¨¡å‹çš„ç®€å•æµ‹è¯•2ï¼ŒPyCharmé›†æˆå¼€å‘ç¯å¢ƒå®‰è£…ä½¿ç”¨ï¼ˆWindows&#43;Python&#43;PyTorch&#43;Conda&#43;cpuï¼‰
åŒæ—¶ä¹Ÿäº†è§£äº†åœ¨Pythonä¸­ä½¿ç”¨Flaskå°è£…ç½‘ç»œæ¥å£çš„æ–¹æ³•ï¼Œèƒ½å®ç°æ–‡ä»¶çš„ä¸Šä¼ ã€‚
å‚è€ƒæ–‡ç« ï¼šAPIæ¥å£ç®€å•ä½¿ç”¨ï¼ˆäºŒï¼‰ï¼šPythonä¸­ä½¿ç”¨Flaskï¼ˆæ¥å£å°è£…æ•´ç†ç‰ˆï¼Œå«æ–‡ä»¶ä¸Šä¼ æ¥å£çš„è¯¦ç»†å®ç°ï¼‰
æ¥ä¸‹æ¥ï¼Œæœ¬æ–‡å°†ä»‹ç»åœ¨Pythonä¸­å°†YOLOv8æ¨¡å‹å°è£…æˆAPIæ¥å£ä½¿ç”¨çš„æ–¹æ³•ï¼Œç„¶åé€šè¿‡è°ƒç”¨å°è£…å¥½çš„APIæ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ä¸Šä¼ è‡ªå®šä¹‰çš„æµ‹è¯•å›¾ç‰‡ï¼Œå¹¶è¿”å›è¯†åˆ«ç»“æœã€‚è¯†åˆ«ç»“æœæœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯å®Œæˆè¯†åˆ«åçš„å›¾ç‰‡ï¼›å¦ä¸€ç§æ˜¯è¯†åˆ«ç›®æ ‡çš„ç±»å‹ï¼Œä»¥åŠå®ƒä»¬åœ¨å›¾ç‰‡ä¸­çš„åæ ‡ã€å¤§å°ï¼Œä»¥æ–‡æœ¬å½¢å¼è¿”å›ã€‚
äºŒã€æ€è·¯æ•´ç† æƒ³è¦å®ç°åœ¨Pythonä¸­å°†YOLOv8æ¨¡å‹å°è£…æˆAPIæ¥å£ä½¿ç”¨ï¼Œé¦–å…ˆæ•´ç†ä¸‹æ€è·¯ï¼š
ï¼ˆæœåŠ¡ç«¯ï¼‰ä½¿ç”¨Flaskæ¡†æ¶ç¼–å†™ä¸€ä¸ªç®€å•çš„æµ‹è¯•å®ä¾‹ï¼Œå¯ä»¥å®ç°æ–‡ä»¶ä¸Šä¼ ï¼ˆå®¢æˆ·ç«¯ï¼‰é€šè¿‡APIæ¥å£ï¼Œä»¥æ–‡ä»¶å½¢å¼ä¸Šä¼ è‡ªå®šä¹‰çš„æµ‹è¯•å›¾ç‰‡ï¼ˆæœåŠ¡ç«¯ï¼‰è·å–å›¾ç‰‡åç§°å’Œç±»å‹ï¼Œç„¶åä¿å­˜åˆ°æŒ‡å®šè·¯å¾„ï¼ˆæœåŠ¡ç«¯ï¼‰ä¸‹è½½å¹¶ä½¿ç”¨YOLOv8æ¨¡å‹è¿›è¡Œå›¾ç‰‡é¢„æµ‹/è¯†åˆ«ï¼ˆæœåŠ¡ç«¯ï¼‰ä¿å­˜å›¾ç‰‡ç›®æ ‡è¯†åˆ«çš„ç»“æœï¼ˆæœåŠ¡ç«¯ï¼‰è¿”å›ç›®æ ‡è¯†åˆ«çš„ç»“æœï¼ˆå®¢æˆ·ç«¯ï¼‰å¾—åˆ°æœåŠ¡ç«¯è¿”å›çš„è¯†åˆ«ç»“æœ ä¸‰ã€è¿‡ç¨‹å®ç° æ­¤å¤„ä¸»è¦è®²è¿°è¿™ä¸ªæ¡ˆä¾‹çš„å®ç°è¿‡ç¨‹ï¼Œæƒ³è¦ç›´æ¥ä¸Šæ‰‹çš„æœ‹å‹å¯ä»¥åœ¨æ–‡ç« ä¸‹åŠéƒ¨åˆ†è·å–è¯¦ç»†å®Œæ•´ç‰ˆçš„æµ‹è¯•ä»£ç å“¦ã€‚
1. ç¼–å†™æµ‹è¯•å®ä¾‹ ï¼ˆæœåŠ¡ç«¯ï¼‰ä½¿ç”¨Flaskæ¡†æ¶ç¼–å†™ä¸€ä¸ªç®€å•çš„æµ‹è¯•å®ä¾‹ï¼Œå¯ä»¥å®ç°æ–‡ä»¶ä¸Šä¼ 
ç®€å•äº†è§£ ç®€å•çš„æµ‹è¯•å®ä¾‹å¦‚ä¸‹ï¼š
from flask import Flask, request app = Flask(__name__) @app.route(&#39;/...&#39;) def hanshu(): # è¿™é‡Œæ˜¯å†™æ¥å£å‡½æ•°çš„åœ°æ–¹ if __name__ == &#39;__main__&#39;: app.run() æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çš„ç½‘ç»œæ¥å£å‚è€ƒè¿™ä¸ªï¼šï¼ˆç®€å•çœ‹ä¸€ä¸‹å³å¯ï¼‰
@app.post(&#39;/upload&#39;) def upload(): # æ–‡ä»¶ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå…¶ idä¸º file # å¦‚æœæ²¡æœ‰æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚ï¼Œè¿”å› No file part if &#39;file&#39; not in request.files: return &#34;No file part&#34; # è·å–ä¸Šä¼ çš„æ–‡ä»¶ file = request.files[&#39;file&#39;] # è·å–æ–‡ä»¶å if file.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-04T16:38:12+08:00">
    <meta property="article:modified_time" content="2024-04-04T16:38:12+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ç¼–ç¨‹å¤§å’–" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ç¼–ç¨‹å¤§å’–</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">YOLOv8æµ‹è¯•3ï¼šåœ¨Pythonä¸­å°†YOLOv8æ¨¡å‹å°è£…æˆAPIæ¥å£ä½¿ç”¨ï¼ˆä¸Šä¼ æµ‹è¯•å›¾ç‰‡å¹¶è¿”å›è¯†åˆ«ç»“æœï¼Œé™„æµ‹è¯•ä»£ç ï¼‰</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>ä¸€ã€æ¦‚è¿°</h2> 
<blockquote> 
 <p>è®°å½•æ—¶é—´ [2024-4-4]</p> 
</blockquote> 
<br> 
<p>æœ¬æ–‡è®²è¿°çš„æ˜¯åœ¨<code>Windows</code>ç³»ç»Ÿï¼ˆ<code>Python</code>+<code>PyTorch</code>+<code>Conda</code>+<code>cpu</code>ï¼‰ä¸­<code>YOLOv8</code>æ¨¡å‹çš„ç®€å•åº”ç”¨ã€‚è¿™é‡Œé™„å¸¦ä¸Š<code>YOLOv8</code><a href="https://docs.ultralytics.com/zh/" rel="nofollow">å®˜æ–¹æ–‡æ¡£</a>ï¼Œé‡Œé¢è®°è½½äº†è¯¦ç»†çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¦‚æœè§‰å¾—çœ‹æ–‡æ¡£æ¯”è¾ƒéº»çƒ¦çš„è¯ï¼Œå¯ä»¥ç›´æ¥çœ‹æ–‡ç« ï¼Œéœ€è¦ç”¨åˆ°çš„éƒ¨åˆ†å·²ç»åœ¨æ–‡ç« ä¸­è¿›è¡Œäº†æ‘˜å½•ã€‚</p> 
<br> 
<p>ç»è¿‡äº†å‰å‡ æ¬¡çš„å°è¯•ï¼Œæˆ‘ä»¬ä¸ä»…èƒ½ä½¿ç”¨<code>CLI</code>çš„æ–¹å¼è¿è¡Œ<code>yolov8n.pt</code>æ¨¡å‹ï¼Œå¯¹å›¾åƒå’Œè§†é¢‘è¿›è¡Œç›®æ ‡è¯†åˆ«ï¼Œå¹¶å¾—åˆ°ç»“æœã€‚<br> å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/Sareur_1879/article/details/137203261">YOLOv8æ¨¡å‹çš„ç®€å•æµ‹è¯•ï¼ŒWindowsç¯å¢ƒä¸‹å®‰è£…éƒ¨ç½²ï¼ˆPython+PyTorch+Conda+cpu+CLIï¼‰</a></p> 
<br> 
<p>ä¹Ÿå¯ä»¥åœ¨<code>PyCharm</code>é›†æˆå¼€å‘ç¯å¢ƒä¸­ç¼–å†™ç®€å•çš„<code>python</code>æ–‡ä»¶ï¼Œä»¥<code>python</code>çš„æ–¹å¼å¯¹<code>YOLOv8</code>æ¨¡å‹è¿›è¡Œç®€å•çš„æµ‹è¯•ã€‚<br> å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/Sareur_1879/article/details/137230918">YOLOv8æ¨¡å‹çš„ç®€å•æµ‹è¯•2ï¼ŒPyCharmé›†æˆå¼€å‘ç¯å¢ƒå®‰è£…ä½¿ç”¨ï¼ˆWindows+Python+PyTorch+Conda+cpuï¼‰</a></p> 
<br> 
<p>åŒæ—¶ä¹Ÿäº†è§£äº†åœ¨<code>Python</code>ä¸­ä½¿ç”¨<code>Flask</code>å°è£…ç½‘ç»œæ¥å£çš„æ–¹æ³•ï¼Œèƒ½å®ç°æ–‡ä»¶çš„ä¸Šä¼ ã€‚<br> å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/Sareur_1879/article/details/137330298">APIæ¥å£ç®€å•ä½¿ç”¨ï¼ˆäºŒï¼‰ï¼šPythonä¸­ä½¿ç”¨Flaskï¼ˆæ¥å£å°è£…æ•´ç†ç‰ˆï¼Œå«æ–‡ä»¶ä¸Šä¼ æ¥å£çš„è¯¦ç»†å®ç°ï¼‰</a></p> 
<br> 
<p><strong>æ¥ä¸‹æ¥ï¼Œæœ¬æ–‡å°†ä»‹ç»åœ¨<code>Python</code>ä¸­å°†<code>YOLOv8</code>æ¨¡å‹å°è£…æˆ<code>API</code>æ¥å£ä½¿ç”¨çš„æ–¹æ³•ï¼Œç„¶åé€šè¿‡è°ƒç”¨å°è£…å¥½çš„<code>API</code>æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ä¸Šä¼ è‡ªå®šä¹‰çš„æµ‹è¯•å›¾ç‰‡ï¼Œå¹¶è¿”å›è¯†åˆ«ç»“æœã€‚è¯†åˆ«ç»“æœæœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯å®Œæˆè¯†åˆ«åçš„å›¾ç‰‡ï¼›å¦ä¸€ç§æ˜¯è¯†åˆ«ç›®æ ‡çš„ç±»å‹ï¼Œä»¥åŠå®ƒä»¬åœ¨å›¾ç‰‡ä¸­çš„åæ ‡ã€å¤§å°ï¼Œä»¥æ–‡æœ¬å½¢å¼è¿”å›ã€‚</strong></p> 
<br> 
<h2><a id="_39"></a>äºŒã€æ€è·¯æ•´ç†</h2> 
<br> 
<p>æƒ³è¦å®ç°åœ¨<code>Python</code>ä¸­å°†<code>YOLOv8</code>æ¨¡å‹å°è£…æˆ<code>API</code>æ¥å£ä½¿ç”¨ï¼Œé¦–å…ˆæ•´ç†ä¸‹æ€è·¯ï¼š</p> 
<ul><li>ï¼ˆæœåŠ¡ç«¯ï¼‰ä½¿ç”¨<code>Flask</code>æ¡†æ¶ç¼–å†™ä¸€ä¸ªç®€å•çš„æµ‹è¯•å®ä¾‹ï¼Œå¯ä»¥å®ç°æ–‡ä»¶ä¸Šä¼ </li><li>ï¼ˆå®¢æˆ·ç«¯ï¼‰é€šè¿‡<code>API</code>æ¥å£ï¼Œä»¥æ–‡ä»¶å½¢å¼ä¸Šä¼ è‡ªå®šä¹‰çš„æµ‹è¯•å›¾ç‰‡</li><li>ï¼ˆæœåŠ¡ç«¯ï¼‰è·å–å›¾ç‰‡åç§°å’Œç±»å‹ï¼Œç„¶åä¿å­˜åˆ°æŒ‡å®šè·¯å¾„</li><li>ï¼ˆæœåŠ¡ç«¯ï¼‰ä¸‹è½½å¹¶ä½¿ç”¨<code>YOLOv8</code>æ¨¡å‹è¿›è¡Œå›¾ç‰‡é¢„æµ‹/è¯†åˆ«</li><li>ï¼ˆæœåŠ¡ç«¯ï¼‰ä¿å­˜å›¾ç‰‡ç›®æ ‡è¯†åˆ«çš„ç»“æœ</li><li>ï¼ˆæœåŠ¡ç«¯ï¼‰è¿”å›ç›®æ ‡è¯†åˆ«çš„ç»“æœ</li><li>ï¼ˆå®¢æˆ·ç«¯ï¼‰å¾—åˆ°æœåŠ¡ç«¯è¿”å›çš„è¯†åˆ«ç»“æœ</li></ul> 
<br> 
<h2><a id="_60"></a>ä¸‰ã€è¿‡ç¨‹å®ç°</h2> 
<blockquote> 
 <p>æ­¤å¤„ä¸»è¦è®²è¿°è¿™ä¸ªæ¡ˆä¾‹çš„å®ç°è¿‡ç¨‹ï¼Œ<strong>æƒ³è¦ç›´æ¥ä¸Šæ‰‹çš„æœ‹å‹å¯ä»¥åœ¨æ–‡ç« ä¸‹åŠéƒ¨åˆ†è·å–è¯¦ç»†å®Œæ•´ç‰ˆçš„æµ‹è¯•ä»£ç å“¦ã€‚</strong></p> 
</blockquote> 
<br> 
<h3><a id="1__67"></a>1. ç¼–å†™æµ‹è¯•å®ä¾‹</h3> 
<blockquote> 
 <p>ï¼ˆæœåŠ¡ç«¯ï¼‰ä½¿ç”¨<code>Flask</code>æ¡†æ¶ç¼–å†™ä¸€ä¸ªç®€å•çš„æµ‹è¯•å®ä¾‹ï¼Œå¯ä»¥å®ç°æ–‡ä»¶ä¸Šä¼ </p> 
</blockquote> 
<br> 
<h4><a id="_76"></a>ç®€å•äº†è§£</h4> 
<br> 
<p>ç®€å•çš„æµ‹è¯•å®ä¾‹å¦‚ä¸‹ï¼š</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/...'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hanshu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># è¿™é‡Œæ˜¯å†™æ¥å£å‡½æ•°çš„åœ°æ–¹</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<p>æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çš„ç½‘ç»œæ¥å£å‚è€ƒè¿™ä¸ªï¼šï¼ˆç®€å•çœ‹ä¸€ä¸‹å³å¯ï¼‰</p> 
<pre><code class="prism language-python"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">'/upload'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># æ–‡ä»¶ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå…¶ idä¸º file</span>
    <span class="token comment"># å¦‚æœæ²¡æœ‰æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚ï¼Œè¿”å› No file part</span>
    <span class="token keyword">if</span> <span class="token string">'file'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>files<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"No file part"</span>

    <span class="token comment"># è·å–ä¸Šä¼ çš„æ–‡ä»¶</span>
    <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span>

    <span class="token comment"># è·å–æ–‡ä»¶å</span>
    <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">.</span>filename <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"No selected file"</span>

    <span class="token comment"># file_format è·å–æ–‡ä»¶ç±»å‹ï¼Œå¹¶è¿”å›</span>
    <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        filename <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>filename
        file_format <span class="token operator">=</span> filename<span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token string">"File format is: "</span> <span class="token operator">+</span> file_format<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<h4><a id="_132"></a>åˆ›å»ºæµ‹è¯•æ–‡ä»¶</h4> 
<br> 
<p>ç„¶åï¼Œå¼€å§‹åŠ¨æ‰‹æ“ä½œã€‚</p> 
<p>ä½¿ç”¨<code>PyCharm</code>æ‰“å¼€æˆ‘ä»¬ä¹‹å‰ä»<a href="https://github.com/ultralytics/ultralytics">ä»“åº“</a>ä¸‹è½½çš„<code>YOLOv8</code>é¡¹ç›®<code>ultralytics-main</code>ï¼Œæ‰¾åˆ°<code>tests</code>ç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹æ–°å»º<code>image_test.py</code>æ–‡ä»¶ã€‚</p> 
<br> 
<h4><a id="_145"></a>å¯¼å…¥ä¾èµ–</h4> 
<br> 
<p>å¯¼å…¥<code>YOLOv8</code>é¡¹ç›®è¿è¡Œæ‰€éœ€çš„ä¾èµ–å’Œé…ç½®ï¼š</p> 
<pre><code class="prism language-python"><span class="token comment"># Ultralytics YOLO ğŸš€, AGPL-3.0 license</span>

<span class="token keyword">import</span> contextlib
<span class="token keyword">from</span> copy <span class="token keyword">import</span> copy
<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path

<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pytest
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> yaml
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">import</span> ToTensor

<span class="token keyword">from</span> ultralytics <span class="token keyword">import</span> RTDETR<span class="token punctuation">,</span> YOLO
<span class="token keyword">from</span> ultralytics<span class="token punctuation">.</span>cfg <span class="token keyword">import</span> TASK2DATA
<span class="token keyword">from</span> ultralytics<span class="token punctuation">.</span>data<span class="token punctuation">.</span>build <span class="token keyword">import</span> load_inference_source
<span class="token keyword">from</span> ultralytics<span class="token punctuation">.</span>utils <span class="token keyword">import</span> <span class="token punctuation">(</span>
    ASSETS<span class="token punctuation">,</span>
    DEFAULT_CFG<span class="token punctuation">,</span>
    DEFAULT_CFG_PATH<span class="token punctuation">,</span>
    LINUX<span class="token punctuation">,</span>
    MACOS<span class="token punctuation">,</span>
    ONLINE<span class="token punctuation">,</span>
    ROOT<span class="token punctuation">,</span>
    WEIGHTS_DIR<span class="token punctuation">,</span>
    WINDOWS<span class="token punctuation">,</span>
    Retry<span class="token punctuation">,</span>
    checks<span class="token punctuation">,</span>
    is_dir_writeable<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">from</span> ultralytics<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>downloads <span class="token keyword">import</span> download
<span class="token keyword">from</span> ultralytics<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>torch_utils <span class="token keyword">import</span> TORCH_1_9<span class="token punctuation">,</span> TORCH_1_13

MODEL <span class="token operator">=</span> WEIGHTS_DIR <span class="token operator">/</span> <span class="token string">"path with spaces"</span> <span class="token operator">/</span> <span class="token string">"yolov8n.pt"</span>  <span class="token comment"># test spaces in path</span>
CFG <span class="token operator">=</span> <span class="token string">"yolov8n.yaml"</span>
SOURCE <span class="token operator">=</span> ASSETS <span class="token operator">/</span> <span class="token string">"bus.jpg"</span>
TMP <span class="token operator">=</span> <span class="token punctuation">(</span>ROOT <span class="token operator">/</span> <span class="token string">"../tests/tmp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># temp directory for test files</span>
IS_TMP_WRITEABLE <span class="token operator">=</span> is_dir_writeable<span class="token punctuation">(</span>TMP<span class="token punctuation">)</span>
</code></pre> 
<br> 
<p>å¯¼å…¥<code>Flask</code>æ¡†æ¶ä½¿ç”¨æ‰€éœ€ä¾èµ–ï¼šï¼ˆå¦‚æœ<code>Flask</code>ä¾èµ–æŠ¥é”™ï¼Œè¯´æ˜æ²¡æœ‰å¯¼å…¥æˆåŠŸï¼Œé‡æ–°å¯¼å…¥ä¸€ä¸‹å³å¯ã€‚ï¼‰</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> send_file
</code></pre> 
<br> 
<h4><a id="_209"></a>ç¼–å†™æ–‡ä»¶ä¸Šä¼ æ¥å£</h4> 
<br> 
<pre><code class="prism language-python">app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">'/image'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">return_image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">"Succeed"</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5001</span><span class="token punctuation">)</span>
</code></pre> 
<p>å¤§å®¶å¯ä»¥è‡ªè¡Œæµ‹è¯•ä¸‹è¿™ä¸ªæ¥å£å¯ä¸å¯ç”¨ï¼Œåé¢æˆ‘ä»¬åœ¨<code>return_image()</code>å‡½æ•°ä¸­ç¼–å†™å†…å®¹ã€‚</p> 
<br> 
<h4><a id="_236"></a>åˆ›å»ºä¸Šä¼ ç›®å½•</h4> 
<br> 
<p>åœ¨<code>ultralytics-main/tests/tmp/</code>ç›®å½•ä¸‹æ–°å»º<code>upload</code>æ–‡ä»¶å¤¹ï¼Œç”¨æ¥å­˜æ”¾æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ã€‚</p> 
<br> 
<h3><a id="2__248"></a>2. ä¸Šä¼ æµ‹è¯•å›¾ç‰‡</h3> 
<blockquote> 
 <p>ï¼ˆå®¢æˆ·ç«¯ï¼‰é€šè¿‡<code>API</code>æ¥å£ï¼Œä»¥æ–‡ä»¶å½¢å¼ä¸Šä¼ è‡ªå®šä¹‰çš„æµ‹è¯•å›¾ç‰‡</p> 
</blockquote> 
<br> 
<p>è¿™é‡Œç®€å•å†™ä¸€ä¸ª<code>HTML</code>æ–‡ä»¶ç”¨äºæµ‹è¯•å³å¯ï¼š</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>æ–‡ä»¶ä¸Šä¼ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    
    <span class="token comment">&lt;!--actionä¸­å†™å…¥è¯·æ±‚çš„URL--&gt;</span>
    <span class="token comment">&lt;!--methodä¸­å†™å…¥è¯·æ±‚çš„æ–¹æ³•ï¼Œå¦‚ get/post...--&gt;</span>
    
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://127.0.0.1:5001/image<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ä¸Šä¼ <span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
	
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<br> 
<h3><a id="3__289"></a>3. è·å–å›¾ç‰‡ä¿¡æ¯å¹¶ä¿å­˜</h3> 
<blockquote> 
 <p>ï¼ˆæœåŠ¡ç«¯ï¼‰è·å–å›¾ç‰‡åç§°å’Œç±»å‹ï¼Œç„¶åä¿å­˜åˆ°æŒ‡å®šè·¯å¾„</p> 
</blockquote> 
<br> 
<p>åœ¨<code>return_image()</code>å‡½æ•°ä¸­ç¼–å†™å†…å®¹ï¼š</p> 
<pre><code class="prism language-python"><span class="token comment"># 1. è·å–ä¸Šä¼ çš„å›¾ç‰‡èµ„æº</span>

<span class="token comment"># æ–‡ä»¶ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå…¶ idä¸º file</span>
<span class="token comment"># å¦‚æœæ²¡æœ‰æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚ï¼Œè¿”å› No file part</span>
<span class="token keyword">if</span> <span class="token string">'file'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>files<span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">"No file part"</span>

<span class="token comment"># è·å–å›¾ç‰‡æ–‡ä»¶</span>
<span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span>

<span class="token comment"># è·å–æ–‡ä»¶å</span>
<span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">.</span>filename <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">"No selected file"</span>

filename <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>filename

<span class="token comment"># 2. ä¿å­˜åˆ°æŒ‡å®šä½ç½®</span>
<span class="token builtin">file</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>TMP <span class="token operator">/</span> <span class="token string">'upload'</span> <span class="token operator">/</span> filename<span class="token punctuation">)</span>
</code></pre> 
<br> 
<h3><a id="4__325"></a>4. è¿›è¡Œå›¾ç‰‡é¢„æµ‹</h3> 
<blockquote> 
 <p>ï¼ˆæœåŠ¡ç«¯ï¼‰ä¸‹è½½å¹¶ä½¿ç”¨<code>YOLOv8</code>æ¨¡å‹è¿›è¡Œå›¾ç‰‡é¢„æµ‹/è¯†åˆ«</p> 
</blockquote> 
<br> 
<p>åœ¨<code>return_image()</code>å‡½æ•°ä¸­ç¼–å†™å†…å®¹ï¼š</p> 
<pre><code class="prism language-python"><span class="token comment"># 3. ä½¿ç”¨ YOLOv8æ¨¡å‹å¯¹è¯¥å›¾ç‰‡è¿›è¡Œé¢„æµ‹</span>
model <span class="token operator">=</span> YOLO<span class="token punctuation">(</span>MODEL<span class="token punctuation">)</span>

<span class="token comment"># Define path to the image file</span>
source <span class="token operator">=</span> TMP <span class="token operator">/</span> <span class="token string">'upload'</span> <span class="token operator">/</span> filename

<span class="token comment"># å…·ä½“è¦åœ¨ predictä¸­æ·»åŠ ä¸€äº›å‚æ•°</span>
model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>source<span class="token punctuation">)</span>
</code></pre> 
<br> 
<h3><a id="5__352"></a>5. ä¿å­˜å›¾ç‰‡ç›®æ ‡è¯†åˆ«çš„ç»“æœ</h3> 
<blockquote> 
 <p>ï¼ˆæœåŠ¡ç«¯ï¼‰ä¿å­˜å›¾ç‰‡ç›®æ ‡è¯†åˆ«çš„ç»“æœ</p> 
</blockquote> 
<br> 
<h4><a id="_360"></a>å›¾ç‰‡ç»“æœ</h4> 
<br> 
<p>æˆ‘ä»¬è¦ä¿å­˜<strong>è¯†åˆ«åçš„å›¾ç‰‡ç»“æœ</strong>ï¼Œä¸»è¦ä½¿ç”¨çš„å‚æ•°æ˜¯<code>save</code>ï¼Œæˆ‘ä»¬è®¾ç½®<code>save=True</code>å³å¯ã€‚</p> 
<pre><code class="prism language-python"><span class="token comment"># 4. ä¿å­˜ç»“æœ</span>
results <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>source<span class="token punctuation">,</span> save<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> imgsz<span class="token operator">=</span><span class="token number">320</span><span class="token punctuation">,</span> conf<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<h4><a id="_376"></a>æ–‡æœ¬ç»“æœ</h4> 
<br> 
<p>å¦‚æœè¦ä¿å­˜<strong>è¯†åˆ«ç›®æ ‡çš„ç±»å‹ï¼Œä»¥åŠå®ƒä»¬åœ¨å›¾ç‰‡ä¸­çš„åæ ‡ã€å¤§å°ï¼Œä»¥æ–‡æœ¬å½¢å¼è¿”å›</strong></p> 
<p>åˆ™ä½¿ç”¨å‚æ•°<code>save_txt</code>ï¼Œè®¾ç½®ä¸º<code>True</code>ï¼š</p> 
<pre><code class="prism language-python">results <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>source<span class="token punctuation">,</span> save_txt<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>ç»“æœä¼šä»¥<code>txt</code>æ–‡ä»¶çš„å½¢å¼ä¿å­˜åœ¨<code>tests\tmp\runs\detect\predict[i]\labels</code>ç›®å½•ä¸‹ã€‚</strong></p> 
<br> 
<h3><a id="6__398"></a>6. è¿”å›ç›®æ ‡è¯†åˆ«çš„ç»“æœ</h3> 
<blockquote> 
 <p>ï¼ˆæœåŠ¡ç«¯ï¼‰è¿”å›ç›®æ ‡è¯†åˆ«çš„ç»“æœ</p> 
</blockquote> 
<br> 
<h4><a id="_406"></a>å›¾ç‰‡ç»“æœ</h4> 
<br> 
<p><code>send_file(image_path)</code>æ˜¯ç›´æ¥å°†è¿”å›çš„ç»“æœåœ¨æµè§ˆå™¨ä¸­è¿›è¡Œé¢„è§ˆï¼Œ</p> 
<p><strong>å¦‚æœæƒ³è¦ä¸‹è½½å›¾ç‰‡ï¼Œå°±æ·»åŠ <code>as_attachment=True</code>å‚æ•°ã€‚</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># è·å–æ–‡ä»¶ä¿å­˜çš„è·¯å¾„</span>
save_path <span class="token operator">=</span> Path<span class="token punctuation">(</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>save_dir<span class="token punctuation">)</span>
image_path <span class="token operator">=</span> save_path <span class="token operator">/</span> filename

<span class="token comment"># 5. è¿”å›ç»“æœ</span>
<span class="token keyword">return</span> send_file<span class="token punctuation">(</span>image_path<span class="token punctuation">)</span>
<span class="token comment"># ä¸‹è½½ç‰ˆ</span>
<span class="token keyword">return</span> send_file<span class="token punctuation">(</span>image_path<span class="token punctuation">,</span> as_attachment<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<h4><a id="_432"></a>æ–‡æœ¬ç»“æœ</h4> 
<br> 
<p>æƒ³è¦è·å–<strong>è¯†åˆ«ç›®æ ‡çš„ç±»å‹ï¼Œä»¥åŠå®ƒä»¬åœ¨å›¾ç‰‡ä¸­çš„åæ ‡ã€å¤§å°</strong>çš„ä¿¡æ¯ï¼Œ</p> 
<p>æˆ‘ä»¬éœ€è¦è¯»å–<code>tests\tmp\runs\detect\predict[i]\labels</code>ç›®å½•ä¸­çš„<code>txt</code>æ–‡ä»¶</p> 
<pre><code class="prism language-python"><span class="token comment"># è·å–æ–‡ä»¶ä¿å­˜çš„è·¯å¾„</span>
save_path <span class="token operator">=</span> Path<span class="token punctuation">(</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>save_dir<span class="token punctuation">)</span>

<span class="token comment"># è·å–labelæ ‡ç­¾æ–‡ä»¶</span>
<span class="token keyword">for</span> r <span class="token keyword">in</span> results<span class="token punctuation">:</span>
    im_name <span class="token operator">=</span> Path<span class="token punctuation">(</span>r<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span>stem
    labels <span class="token operator">=</span> save_path <span class="token operator">/</span> <span class="token string-interpolation"><span class="token string">f"labels/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>im_name<span class="token punctuation">}</span></span><span class="token string">.txt"</span></span>

<span class="token comment"># è¯»å–æ ‡ç­¾æ–‡ä»¶ä¸­çš„å†…å®¹</span>
txt_file <span class="token operator">=</span> labels
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>txt_file<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    content <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># è¿”å›ç»“æœ</span>
<span class="token keyword">return</span> content
</code></pre> 
<br> 
<h3><a id="7__465"></a>7. å¾—åˆ°è¿”å›ç»“æœ</h3> 
<blockquote> 
 <p>ï¼ˆå®¢æˆ·ç«¯ï¼‰å¾—åˆ°æœåŠ¡ç«¯è¿”å›çš„è¯†åˆ«ç»“æœ</p> 
</blockquote> 
<br> 
<h4><a id="_473"></a>å›¾ç‰‡ç»“æœ</h4> 
<br> 
<p><strong>æˆ‘ä»¬å¯ä»¥ç”¨ä¸Šé¢å†™çš„<code>HTML</code>æ–‡ä»¶æ¥è¿›è¡Œæµ‹è¯•ï¼ŒåŒå‡»è¿è¡Œï¼Œé€‰æ‹©æ–‡ä»¶ï¼Œç„¶åä¸Šä¼ å³å¯ã€‚</strong></p> 
<p>è¿™é‡Œä¸ºäº†å‘ˆç°ç»“æœæ›´åŠ ç›´è§‚ï¼Œæ‰€ä»¥ä½¿ç”¨äº†<code>Postman</code>æ¥æµ‹è¯•ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p> 
<br> 
<p><strong>æ³¨æ„ï¼šæµ‹è¯•å›¾ç‰‡ç´ ææ¥æºäºç½‘ç»œï¼Œä»…ç”¨äºæµ‹è¯•æ¼”ç¤ºã€‚</strong></p> 
<p><img src="https://images2.imgbox.com/26/57/KCVIh6Vu_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" width="700"></p> 
<br> 
<h4><a id="_494"></a>æ–‡æœ¬ç»“æœ</h4> 
<br> 
<p>å¦‚å›¾æ‰€ç¤ºï¼Œè¿”å›è¯†åˆ«ç›®æ ‡çš„ç±»å‹ï¼Œä»¥åŠå®ƒä»¬åœ¨å›¾ç‰‡ä¸­çš„åæ ‡ã€å¤§å°ç­‰ä¿¡æ¯ã€‚</p> 
<p><img src="https://images2.imgbox.com/81/c0/xzRU3h8r_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" width="700"></p> 
<br> 
<p><strong>ä¸‹é¢å¯¹<code>YOLOv8</code>æ ‡ç­¾æ–‡ä»¶<code>label</code>ä¸­çš„å†…å®¹è¿›è¡Œè§£é‡Šï¼š</strong></p> 
<ul><li>å¦‚å›¾ï¼Œåœ¨é¡¹ç›®ä¸­æ‰“å¼€ä¸€ä¸ªæ¨¡å‹è®­ç»ƒæ–‡ä»¶è¿›è¡ŒæŸ¥çœ‹</li><li>ä»¥ç¬¬ä¸€è¡Œæ ‡ç­¾ä¸ºä¾‹ï¼Œé¦–ä¸ªæ•°å­—<code>5</code>ä»£è¡¨çš„æ˜¯<code>names</code>ä¸­çš„ç¬¬äº”ç±»ï¼Œå³<code>bus</code></li><li>åé¢çš„å››ä¸ªå‚æ•°åˆ†åˆ«æ˜¯<code>bus</code>åœ¨å›¾ç‰‡ä¸­çš„çºµæ¨ªåæ ‡ï¼Œä»¥åŠå®ƒçš„é•¿å®½</li><li>é€šè¿‡è¿™äº›å‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¡®å®šè¯†åˆ«ç›®æ ‡çš„ç±»å‹ï¼Œä»¥åŠå®ƒåœ¨å›¾ç‰‡ä¸­çš„ä½ç½®å•¦</li></ul> 
<br> 
<p><img src="https://images2.imgbox.com/09/eb/Z91Ab1fO_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" width="700"></p> 
<br> 
<h2><a id="_526"></a>å››ã€è¯¦ç»†å®Œæ•´ç‰ˆæµ‹è¯•ä»£ç </h2> 
<br> 
<h3><a id="1__532"></a>1. å¾—åˆ°å›¾ç‰‡ç›®æ ‡ç‰ˆæœ¬</h3> 
<br> 
<p><code>image_test.py</code></p> 
<pre><code class="prism language-python"><span class="token comment"># Ultralytics YOLO ğŸš€, AGPL-3.0 license</span>

<span class="token keyword">import</span> contextlib
<span class="token keyword">from</span> copy <span class="token keyword">import</span> copy
<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path

<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pytest
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> yaml
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">import</span> ToTensor

<span class="token keyword">from</span> ultralytics <span class="token keyword">import</span> RTDETR<span class="token punctuation">,</span> YOLO
<span class="token keyword">from</span> ultralytics<span class="token punctuation">.</span>cfg <span class="token keyword">import</span> TASK2DATA
<span class="token keyword">from</span> ultralytics<span class="token punctuation">.</span>data<span class="token punctuation">.</span>build <span class="token keyword">import</span> load_inference_source
<span class="token keyword">from</span> ultralytics<span class="token punctuation">.</span>utils <span class="token keyword">import</span> <span class="token punctuation">(</span>
    ASSETS<span class="token punctuation">,</span>
    DEFAULT_CFG<span class="token punctuation">,</span>
    DEFAULT_CFG_PATH<span class="token punctuation">,</span>
    LINUX<span class="token punctuation">,</span>
    MACOS<span class="token punctuation">,</span>
    ONLINE<span class="token punctuation">,</span>
    ROOT<span class="token punctuation">,</span>
    WEIGHTS_DIR<span class="token punctuation">,</span>
    WINDOWS<span class="token punctuation">,</span>
    Retry<span class="token punctuation">,</span>
    checks<span class="token punctuation">,</span>
    is_dir_writeable<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">from</span> ultralytics<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>downloads <span class="token keyword">import</span> download
<span class="token keyword">from</span> ultralytics<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>torch_utils <span class="token keyword">import</span> TORCH_1_9<span class="token punctuation">,</span> TORCH_1_13

<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> send_file

MODEL <span class="token operator">=</span> WEIGHTS_DIR <span class="token operator">/</span> <span class="token string">"path with spaces"</span> <span class="token operator">/</span> <span class="token string">"yolov8n.pt"</span>  <span class="token comment"># test spaces in path</span>
CFG <span class="token operator">=</span> <span class="token string">"yolov8n.yaml"</span>
SOURCE <span class="token operator">=</span> ASSETS <span class="token operator">/</span> <span class="token string">"bus.jpg"</span>
TMP <span class="token operator">=</span> <span class="token punctuation">(</span>ROOT <span class="token operator">/</span> <span class="token string">"../tests/tmp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># temp directory for test files</span>
IS_TMP_WRITEABLE <span class="token operator">=</span> is_dir_writeable<span class="token punctuation">(</span>TMP<span class="token punctuation">)</span>

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">'/image'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">return_image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. è·å–ä¸Šä¼ çš„å›¾ç‰‡èµ„æº</span>

    <span class="token comment"># æ–‡ä»¶ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå…¶ idä¸º file</span>
    <span class="token comment"># å¦‚æœæ²¡æœ‰æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚ï¼Œè¿”å› No file part</span>
    <span class="token keyword">if</span> <span class="token string">'file'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>files<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"No file part"</span>

    <span class="token comment"># è·å–å›¾ç‰‡æ–‡ä»¶</span>
    <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span>

    <span class="token comment"># è·å–æ–‡ä»¶å</span>
    <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">.</span>filename <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"No selected file"</span>

    filename <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>filename

    <span class="token comment"># 2. ä¿å­˜åˆ°æŒ‡å®šä½ç½®</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>TMP <span class="token operator">/</span> <span class="token string">'upload'</span> <span class="token operator">/</span> filename<span class="token punctuation">)</span>

    <span class="token comment"># 3. ä½¿ç”¨ YOLOv8æ¨¡å‹å¯¹è¯¥å›¾ç‰‡è¿›è¡Œé¢„æµ‹</span>
    model <span class="token operator">=</span> YOLO<span class="token punctuation">(</span>MODEL<span class="token punctuation">)</span>

    <span class="token comment"># Define path to the image file</span>
    source <span class="token operator">=</span> TMP <span class="token operator">/</span> <span class="token string">'upload'</span> <span class="token operator">/</span> filename

    <span class="token comment"># 4. ä¿å­˜ç»“æœ</span>
    results <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>source<span class="token punctuation">,</span> save<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> imgsz<span class="token operator">=</span><span class="token number">320</span><span class="token punctuation">,</span> conf<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>

    <span class="token comment"># è·å–æ–‡ä»¶ä¿å­˜çš„è·¯å¾„</span>
    save_path <span class="token operator">=</span> Path<span class="token punctuation">(</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>save_dir<span class="token punctuation">)</span>
    image_path <span class="token operator">=</span> save_path <span class="token operator">/</span> filename

    <span class="token comment"># 5. è¿”å›ç»“æœ</span>
    <span class="token keyword">return</span> send_file<span class="token punctuation">(</span>image_path<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5001</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<h3><a id="2__632"></a>2. å¾—åˆ°æ–‡æœ¬å‚æ•°ç‰ˆæœ¬</h3> 
<br> 
<p><code>text_test.py</code></p> 
<pre><code class="prism language-python"><span class="token comment"># Ultralytics YOLO ğŸš€, AGPL-3.0 license</span>

<span class="token keyword">import</span> contextlib
<span class="token keyword">from</span> copy <span class="token keyword">import</span> copy
<span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path

<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pytest
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> yaml
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>transforms <span class="token keyword">import</span> ToTensor

<span class="token keyword">from</span> ultralytics <span class="token keyword">import</span> RTDETR<span class="token punctuation">,</span> YOLO
<span class="token keyword">from</span> ultralytics<span class="token punctuation">.</span>cfg <span class="token keyword">import</span> TASK2DATA
<span class="token keyword">from</span> ultralytics<span class="token punctuation">.</span>data<span class="token punctuation">.</span>build <span class="token keyword">import</span> load_inference_source
<span class="token keyword">from</span> ultralytics<span class="token punctuation">.</span>utils <span class="token keyword">import</span> <span class="token punctuation">(</span>
    ASSETS<span class="token punctuation">,</span>
    DEFAULT_CFG<span class="token punctuation">,</span>
    DEFAULT_CFG_PATH<span class="token punctuation">,</span>
    LINUX<span class="token punctuation">,</span>
    MACOS<span class="token punctuation">,</span>
    ONLINE<span class="token punctuation">,</span>
    ROOT<span class="token punctuation">,</span>
    WEIGHTS_DIR<span class="token punctuation">,</span>
    WINDOWS<span class="token punctuation">,</span>
    Retry<span class="token punctuation">,</span>
    checks<span class="token punctuation">,</span>
    is_dir_writeable<span class="token punctuation">,</span>
<span class="token punctuation">)</span>
<span class="token keyword">from</span> ultralytics<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>downloads <span class="token keyword">import</span> download
<span class="token keyword">from</span> ultralytics<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>torch_utils <span class="token keyword">import</span> TORCH_1_9<span class="token punctuation">,</span> TORCH_1_13

<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> send_file

MODEL <span class="token operator">=</span> WEIGHTS_DIR <span class="token operator">/</span> <span class="token string">"path with spaces"</span> <span class="token operator">/</span> <span class="token string">"yolov8n.pt"</span>  <span class="token comment"># test spaces in path</span>
CFG <span class="token operator">=</span> <span class="token string">"yolov8n.yaml"</span>
SOURCE <span class="token operator">=</span> ASSETS <span class="token operator">/</span> <span class="token string">"bus.jpg"</span>
TMP <span class="token operator">=</span> <span class="token punctuation">(</span>ROOT <span class="token operator">/</span> <span class="token string">"../tests/tmp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resolve<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># temp directory for test files</span>
IS_TMP_WRITEABLE <span class="token operator">=</span> is_dir_writeable<span class="token punctuation">(</span>TMP<span class="token punctuation">)</span>

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>post</span><span class="token punctuation">(</span><span class="token string">'/text'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">return_text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 1. è·å–ä¸Šä¼ çš„å›¾ç‰‡èµ„æº</span>

    <span class="token comment"># æ–‡ä»¶ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œå…¶ idä¸º file</span>
    <span class="token comment"># å¦‚æœæ²¡æœ‰æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚ï¼Œè¿”å› No file part</span>
    <span class="token keyword">if</span> <span class="token string">'file'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>files<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"No file part"</span>

    <span class="token comment"># è·å–å›¾ç‰‡æ–‡ä»¶</span>
    <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span>

    <span class="token comment"># è·å–æ–‡ä»¶å</span>
    <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">.</span>filename <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"No selected file"</span>

    filename <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>filename

    <span class="token comment"># 2. ä¿å­˜åˆ°æŒ‡å®šä½ç½®</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span>TMP <span class="token operator">/</span> <span class="token string">'upload'</span> <span class="token operator">/</span> filename<span class="token punctuation">)</span>

    <span class="token comment"># 3. ä½¿ç”¨ YOLOv8æ¨¡å‹å¯¹è¯¥å›¾ç‰‡è¿›è¡Œé¢„æµ‹</span>
    model <span class="token operator">=</span> YOLO<span class="token punctuation">(</span>MODEL<span class="token punctuation">)</span>

    <span class="token comment"># Define path to the image file</span>
    source <span class="token operator">=</span> TMP <span class="token operator">/</span> <span class="token string">'upload'</span> <span class="token operator">/</span> filename

    <span class="token comment"># 4. ä¿å­˜ç»“æœ</span>
    results <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>source<span class="token punctuation">,</span> save_txt<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token comment"># è·å–æ–‡ä»¶ä¿å­˜çš„è·¯å¾„</span>
    save_path <span class="token operator">=</span> Path<span class="token punctuation">(</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>save_dir<span class="token punctuation">)</span>

    <span class="token comment"># è·å–labelæ ‡ç­¾æ–‡ä»¶</span>
    <span class="token keyword">for</span> r <span class="token keyword">in</span> results<span class="token punctuation">:</span>
        im_name <span class="token operator">=</span> Path<span class="token punctuation">(</span>r<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span>stem
        labels <span class="token operator">=</span> save_path <span class="token operator">/</span> <span class="token string-interpolation"><span class="token string">f"labels/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>im_name<span class="token punctuation">}</span></span><span class="token string">.txt"</span></span>

    <span class="token comment"># è¯»å–æ ‡ç­¾æ–‡ä»¶ä¸­çš„å†…å®¹</span>
    txt_file <span class="token operator">=</span> labels
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>txt_file<span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        content <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 5. è¿”å›ç»“æœ</span>
    <span class="token keyword">return</span> content

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5001</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<h2><a id="_742"></a>äº”ã€æ€»ç»“</h2> 
<br> 
<p>æœ¬æ–‡åœ¨<code>Python</code>ä¸­å°†<code>YOLOv8</code>æ¨¡å‹å°è£…æˆ<code>API</code>æ¥å£è¿›è¡Œä½¿ç”¨ï¼Œé€šè¿‡è°ƒç”¨å°è£…å¥½çš„<code>API</code>æ¥å£æ¥å®ç°è‡ªå®šä¹‰æµ‹è¯•å›¾ç‰‡çš„ä¸Šä¼ ï¼Œå¹¶è¿”å›è¯†åˆ«ç»“æœã€‚è¯†åˆ«ç»“æœæœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯å®Œæˆè¯†åˆ«åçš„å›¾ç‰‡ï¼›å¦ä¸€ç§æ˜¯è¯†åˆ«ç›®æ ‡çš„ç±»å‹ï¼Œä»¥åŠå®ƒä»¬åœ¨å›¾ç‰‡ä¸­çš„åæ ‡ã€å¤§å°ï¼Œä»¥æ–‡æœ¬å½¢å¼è¿”å›ã€‚</p> 
<br> 
<p><strong>ä¸€äº›å‚è€ƒèµ„æ–™</strong></p> 
<p><code>YOLOv8</code>å®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.ultralytics.com/zh/</p> 
<p><code>YOLOv8</code>æ¨¡å‹ä»“åº“åœ°å€ï¼šhttps://github.com/ultralytics/ultralytics</p> 
<p><code>PyCharm</code>å®˜ç½‘ï¼šhttps://www.jetbrains.com/pycharm/download/?section=windows</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3f759bc11e455c0c9c50abe0efcd7a7a/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">ã€2024ã€‘springbootæ”¯ä»˜å®æ²™ç®±æ”¯ä»˜è¯¦ç»†æ­¥éª¤ï¼ˆä¸€ç¯‡æå®šï¼‰</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/360ae062585406db221c52ab992a11fb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">æ‰‹æŠŠæ‰‹æ•™ä½ Paragon NTFS for Mac v15.9.314ç ´è§£ç‰ˆä¸‹è½½</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ç¼–ç¨‹å¤§å’–.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>