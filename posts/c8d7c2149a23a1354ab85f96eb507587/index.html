<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>2024 年最新 Python 基于 itchat 开源框架搭建微信机器人详细教程（更新中） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/c8d7c2149a23a1354ab85f96eb507587/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="2024 年最新 Python 基于 itchat 开源框架搭建微信机器人详细教程（更新中）">
  <meta property="og:description" content="概述 ntwork 开源框架 ItChat 是一个基于 Python 的微信个人号接口库。它通过封装微信 API，使得开发者可以使用 Python 来方便地与微信进行交互，实现一系列微信相关的功能。这些功能包括但不限于发送和接收消息、获取好友列表和详细信息、以及进行群聊操作等。ItChat 提供了一套简洁而强大的 API，让开发者能够轻松地在 Python 中执行微信相关的操作。
ItChat 支持 Python 2.x 和 3.x 版本，并且可以在多个操作系统平台上运行，包括 Windows、Mac 和 Linux 等。这使得开发者可以根据自己的需求和环境选择适合的 Python 版本和操作系统。
ItCha t的入门使用相对简单。首先，你需要通过 pip 命令安装 ItChat 库。安装完成后，你可以通过引入 ItChat 模块，并调用其提供的函数来实现所需的功能。例如，你可以使用 ItChat 的 login() 函数来扫码登录微信，然后使用 get_friends() 函数来获取好友列表和详细信息。此外 ItChat 还提供了发送消息、注册消息回复等功能，使开发者能够根据自己的需求定制微信机器人的行为。
ItChat 不仅是一个功能强大的工具，也是一个开源项目，这意味着开发者可以根据自己的需求对其进行扩展和定制。通过 ItChat，你可以开发出各种有趣的微信应用，如自动回复消息、数据采集、搭建微信聊天机器人等。
框架 API 文档：https://itchat.readthedocs.io/zh/latest/api/
下载安装 itchat 库 使用 pip 进行安装下载 itchat 库
pip install itchat 清华大学开源软件镜像站
使用如下命令配置 pip 使用清华大学的镜像源：
pip install itchat -i https://pypi.tuna.tsinghua.edu.cn/simple 如果永久设置这个镜像源，可以创建一个 pip 配置文件（例如：~/.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-20T13:29:45+08:00">
    <meta property="article:modified_time" content="2024-05-20T13:29:45+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">2024 年最新 Python 基于 itchat 开源框架搭建微信机器人详细教程（更新中）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_ntwork__0"></a>概述 ntwork 开源框架</h3> 
<p>ItChat 是一个基于 Python 的微信个人号接口库。它通过封装微信 API，使得开发者可以使用 Python 来方便地与微信进行交互，实现一系列微信相关的功能。这些功能包括但不限于发送和接收消息、获取好友列表和详细信息、以及进行群聊操作等。ItChat 提供了一套简洁而强大的 API，让开发者能够轻松地在 Python 中执行微信相关的操作。</p> 
<p>ItChat 支持 Python 2.x 和 3.x 版本，并且可以在多个操作系统平台上运行，包括 Windows、Mac 和 Linux 等。这使得开发者可以根据自己的需求和环境选择适合的 Python 版本和操作系统。</p> 
<p>ItCha t的入门使用相对简单。首先，你需要通过 pip 命令安装 ItChat 库。安装完成后，你可以通过引入 ItChat 模块，并调用其提供的函数来实现所需的功能。例如，你可以使用 ItChat 的 login() 函数来扫码登录微信，然后使用 get_friends() 函数来获取好友列表和详细信息。此外 ItChat 还提供了发送消息、注册消息回复等功能，使开发者能够根据自己的需求定制微信机器人的行为。</p> 
<p>ItChat 不仅是一个功能强大的工具，也是一个开源项目，这意味着开发者可以根据自己的需求对其进行扩展和定制。通过 ItChat，你可以开发出各种有趣的微信应用，如自动回复消息、数据采集、搭建微信聊天机器人等。</p> 
<p><strong>框架 API 文档：<a href="https://itchat.readthedocs.io/zh/latest/api/" rel="nofollow">https://itchat.readthedocs.io/zh/latest/api/</a></strong></p> 
<h3><a id="_itchat__12"></a>下载安装 itchat 库</h3> 
<p>使用 pip 进行安装下载 itchat 库</p> 
<pre><code>pip install itchat
</code></pre> 
<p><strong>清华大学开源软件镜像站</strong></p> 
<p>使用如下命令配置 pip 使用清华大学的镜像源：</p> 
<pre><code>pip install itchat -i https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre> 
<p>如果永久设置这个镜像源，可以创建一个 pip 配置文件（例如：~/.pip/pip.conf）并添加如下内容：</p> 
<pre><code class="prism language-ini">[global]  
index-url = https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre> 
<h3><a id="itchat__33"></a>itchat 登录异常解决方案</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat

itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行测试结果</p> 
<pre><code>Getting uuid of QR code.
Downloading QR code.
Please scan the QR code to log in.
Please press confirm on your phone.
Traceback (most recent call last):
······
xml.parsers.expat.ExpatError: mismatched tag: line 64, column 4
</code></pre> 
<p><strong>异常解决方案：更新 itchat 库</strong></p> 
<p><code>itchat 库 zip 压缩包链接</code> <a href="https://download.csdn.net/download/qq_47452807/89129949?spm=1001.2014.3001.5503">https://download.csdn.net/download/qq_47452807/89129949?spm=1001.2014.3001.5503</a></p> 
<p><strong>点击 <code>立即下载</code> 下载新的 itchat 库 zip 压缩包</strong></p> 
<p><img src="https://images2.imgbox.com/7e/1e/lDIrc93d_o.png" alt="在这里插入图片描述"><br> <strong>解压缩 &gt; itchat 文件夹</strong></p> 
<p><img src="https://images2.imgbox.com/b4/c0/tdUFoLnP_o.png" alt="在这里插入图片描述"><br> <strong>进行 site-packages 替换 itchat 原库文件夹</strong></p> 
<p><img src="https://images2.imgbox.com/b9/f2/30gvDhB4_o.png" alt="在这里插入图片描述"></p> 
<p><strong>重新运行测试</strong></p> 
<pre><code>Ready to login.
Getting uuid of QR code.
Downloading QR code.
Please press confirm on your phone.
Loading the contact, this may take a little while.
Login successfully as 一语中的
Start auto replying.
</code></pre> 
<h3><a id="itchat__75"></a>itchat 协议说明</h3> 
<p>特别注意：使用itchat或其他类似工具进行微信操作需要遵守微信的使用协议和相关法律法规，不得用于非法或恶意目的。同时，由于微信的协议和接口可能随时变化，使用 itchat 等第三方工具时需要注意及时更新和适配。</p> 
<p>现在注册的微信已经禁止网页版登陆了，itchat 是基于 web 协议，如果你的微信是 2017 年之后的，或者未进行实名认证的微信号，可能会遇到登录失败的报错。请选择合理的微信号进行登录。</p> 
<h3><a id="_83"></a>给文件传输助手发信息</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat

itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span><span class="token punctuation">)</span>
itchat<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'Hello, filehelper'</span><span class="token punctuation">,</span> toUserName<span class="token operator">=</span><span class="token string">'filehelper'</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行结果：</p> 
<p><img src="https://images2.imgbox.com/80/b0/PIX0WzPF_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_93"></a>自动回复文本消息</h3> 
<p><strong>自动回复文本消息</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat
<span class="token keyword">from</span> itchat<span class="token punctuation">.</span>content <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token decorator annotation punctuation">@itchat<span class="token punctuation">.</span>msg_register</span><span class="token punctuation">(</span>TEXT<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">text_reply</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> msg<span class="token punctuation">.</span>text

itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span><span class="token punctuation">)</span>
itchat<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>函数说明：</strong></p> 
<p>开启一个消息注册器监听来自用户私信的文本类型消息，自动回复用户私信发送消息的内容（文本消息）</p> 
<p>测试结果</p> 
<p><img src="https://images2.imgbox.com/96/70/2sogndE7_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_116"></a>自动回复群消息</h3> 
<p>开启一个消息注册器监听来自群的文本类型消息。当收到一个来自微信群的文本消息时，请调用定义的处理函数，实现自动回复。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat
<span class="token keyword">from</span> itchat<span class="token punctuation">.</span>content <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token decorator annotation punctuation">@itchat<span class="token punctuation">.</span>msg_register</span><span class="token punctuation">(</span>TEXT<span class="token punctuation">,</span> isGroupChat<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">text_reply</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> msg<span class="token punctuation">.</span>isAt<span class="token punctuation">:</span>
        msg<span class="token punctuation">.</span>user<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">u'@%s I received: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>actualNickName<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>

itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span><span class="token punctuation">)</span>
itchat<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><code>itchat.msg_register</code> 这是 itchat 库中的一个函数，用于注册消息处理函数。当你收到微信消息时，itchat会根据你的注册情况调用相应的处理函数。</p> 
<p><code>TEXT</code> 这是一个常量，代表文本消息类型。当itchat收到一个文本消息时，它会检查是否有为这个类型注册的处理函数。</p> 
<p><code>isGroupChat=True</code> 这是一个参数，用于指定这个函数只处理来自微信群的文本消息，而不是来自好友或公众号等其他来源的消息。</p> 
<p><strong>运行结果：</strong></p> 
<p><img src="https://images2.imgbox.com/67/03/6osofZeB_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="itchat__140"></a>itchat 消息类型</h3> 
<p>消息注册器消息类型：itchat.content</p> 
<pre><code class="prism language-python">TEXT       <span class="token operator">=</span> <span class="token string">'Text'</span>
MAP        <span class="token operator">=</span> <span class="token string">'Map'</span>
CARD       <span class="token operator">=</span> <span class="token string">'Card'</span>
NOTE       <span class="token operator">=</span> <span class="token string">'Note'</span>
SHARING    <span class="token operator">=</span> <span class="token string">'Sharing'</span>
PICTURE    <span class="token operator">=</span> <span class="token string">'Picture'</span>
RECORDING  <span class="token operator">=</span> VOICE <span class="token operator">=</span> <span class="token string">'Recording'</span>
ATTACHMENT <span class="token operator">=</span> <span class="token string">'Attachment'</span>
VIDEO      <span class="token operator">=</span> <span class="token string">'Video'</span>
FRIENDS    <span class="token operator">=</span> <span class="token string">'Friends'</span>
SYSTEM     <span class="token operator">=</span> <span class="token string">'System'</span>
</code></pre> 
<h3><a id="_uuid__157"></a>获取 uuid 账号标识</h3> 
<p>如何要进行登录你需要先得到一个 uuid，当下载 QRcode 需要传递 uuid 生成二维码，为了检查登录状态，还需要 uuid 判断当前用户。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat

uuid <span class="token operator">=</span> itchat<span class="token punctuation">.</span>get_QRuuid<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_166"></a>控制台登录二维码显示</h3> 
<p>通过以下命令可以在登陆的时候使用命令行显示二维码：</p> 
<pre><code class="prism language-python">itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>enableCmdQR<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>部分系统可能字幅宽度有不同，可以通过将enableCmdQR赋值为特定的倍数进行调整：</p> 
<pre><code class="prism language-python">itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>enableCmdQR<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>注意：部分 linux 系统，块字符的宽度为一个字符（正常应为两字符）故赋值为 2</p> 
</blockquote> 
<p>默认控制台背景色是暗色（黑色）。若背景色是浅色（白色）将 enableCmdQR 赋值为负值：</p> 
<pre><code class="prism language-python">itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>enableCmdQR<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_187"></a>二维码图片显示</h3> 
<p>itchat 库提供了 get_QR 函数用于下载显示二维码。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_QR</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> uuid<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> enableCmdQR<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> picDir<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> qrCallback<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token string">''</span>' download <span class="token keyword">and</span> show qrcode
</code></pre> 
<p><strong>获取登录二维码并且显示</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat

uuid <span class="token operator">=</span> itchat<span class="token punctuation">.</span>get_QRuuid<span class="token punctuation">(</span><span class="token punctuation">)</span>
itchat<span class="token punctuation">.</span>get_QR<span class="token punctuation">(</span>uuid<span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>注意：执行 itchat.auto_login() 自动登录功能生成二维码进行预览显示。</p> 
</blockquote> 
<h3><a id="_203"></a>检测登录状态</h3> 
<p>输出当前微信登陆状态的状态码</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat

uuid <span class="token operator">=</span> itchat<span class="token punctuation">.</span>get_QRuuid<span class="token punctuation">(</span><span class="token punctuation">)</span>
status_code <span class="token operator">=</span> itchat<span class="token punctuation">.</span>check_login<span class="token punctuation">(</span>uuid<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>status_code<span class="token punctuation">)</span>
</code></pre> 
<p>如果未设置 uuid 则将使用您获取的最新 uuid：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat

status_code <span class="token operator">=</span> itchat<span class="token punctuation">.</span>check_login<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>status_code<span class="token punctuation">)</span>
</code></pre> 
<p><strong>状态码说明</strong></p> 
<pre><code class="prism language-python"><span class="token operator">-</span> <span class="token number">200</span><span class="token punctuation">:</span> 登陆成功
<span class="token operator">-</span> <span class="token number">201</span><span class="token punctuation">:</span> 等待客户端确认登陆
<span class="token operator">-</span> <span class="token number">408</span><span class="token punctuation">:</span> uuid 超时
<span class="token operator">-</span> <span class="token number">0</span>  <span class="token punctuation">:</span> 异常报错
</code></pre> 
<h3><a id="_229"></a>主动退出登陆</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat

itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span><span class="token punctuation">)</span>

time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

item
</code></pre> 
<h3><a id="_242"></a>退出程序暂存登陆状态</h3> 
<p>通过如下命令登陆，即使程序关闭，一定时间内重新开启也可以不用重新扫码。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat

itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>hotReload<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_itchatpkl_250"></a>保存登陆数据 itchat.pkl</h3> 
<p><strong>pickle 数据格式说明</strong></p> 
<p>pkl 是 Python 编程语言中的一种数据序列化文件格式，其全称是 pickle。这种格式可以将 Python 中的任意对象转换为一种可以保存到磁盘上或通过网络传输的格式，然后再将这些对象从磁盘上读取出来或者从网络上接收过来，重新还原为原来的 Python 对象。这种能力使得 pkl 格式文件在 Python 编程中非常有用，尤其是在需要保存和加载复杂数据结构或自定义对象时。</p> 
<p>具体来说 pkl 文件是以二进制格式保存的，它包含了对象的状态信息，包括对象的数据和方法。这种存储方式可以将Python项目过程中用到的一些暂时变量、或者需要提取、暂存的字符串、列表、字典等数据保存起来，然后在需要使用的时候再进行加载。</p> 
<p>在 Python 中 pickle 模块提供了 <code>dump()</code> 和 <code>load()</code> 函数，用于将 Python 对象保存到 pkl 文件和从 pkl 文件加载对象到内存中。使用这些函数，可以方便地实现 Python 对象的序列化和反序列化，从而实现数据的持久化存储和传输。</p> 
<p>需要注意的是，由于pkl文件是以二进制格式保存的，因此在不同的操作系统或Python版本之间可能会出现兼容性问题。此外，在处理来自不可信来源的pkl文件时也需要格外小心，因为加载恶意构造的pkl文件可能会导致安全问题。</p> 
<p><strong>存储登陆数据</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat
itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>hotReload<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>


itchat<span class="token punctuation">.</span>dump_login_status<span class="token punctuation">(</span><span class="token string">"itchat.pkl"</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>加载登陆数据</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat

itchat<span class="token punctuation">.</span>load_login_status<span class="token punctuation">(</span><span class="token string">"itchat.pkl"</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>注意：itchat.pkl 存储了例如联系人数据、群组数据、个人信息数据······</p> 
</blockquote> 
<h3><a id="_282"></a>获取联系人数据</h3> 
<p>获取当前登陆微信下全部联系人数据（本地数据 / 实时数据）</p> 
<p><strong>get_friends 函数</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_friends</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> update<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre> 
<blockquote> 
 <p>特别注意：如果不设置 update 获取是本地 local 数据（itchat.pkl 数据）</p> 
</blockquote> 
<p><strong><code>读取实时数据</code>：读取当前登陆态数据</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat
itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>hotReload<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

friendList <span class="token operator">=</span> itchat<span class="token punctuation">.</span>get_friends<span class="token punctuation">(</span>update<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> friend <span class="token keyword">in</span> friendList<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>friend<span class="token punctuation">)</span>
</code></pre> 
<p><strong><code>读取本地数据</code>：不登录也同样可以读取数据（itchat.pkl 数据加载）</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat

itchat<span class="token punctuation">.</span>load_login_status<span class="token punctuation">(</span><span class="token string">"itchat.pkl"</span><span class="token punctuation">)</span>
friendList <span class="token operator">=</span> itchat<span class="token punctuation">.</span>get_friends<span class="token punctuation">(</span>update<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> friend <span class="token keyword">in</span> friendList<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>friend<span class="token punctuation">)</span>
</code></pre> 
<p>我们没有进行 itchat 扫描登陆操作，通过加载 itchat.pkl 登陆数据，同样查询到联系人数据。</p> 
<h3><a id="_319"></a>查询联系人用户数据</h3> 
<p>使用 search_friends 方法可以搜索用户</p> 
<pre><code class="prism language-python"><span class="token number">1.</span> 仅获取自己的用户信息。
<span class="token number">2.</span> 获取特定 UserName 的用户信息。
<span class="token number">3.</span> 获取备注、微信号、昵称中的任何一项等于 name 键值的用户。
<span class="token number">4.</span> 获取备注、微信号、昵称分别等于相应键值的用户。
<span class="token number">5.</span> ······
</code></pre> 
<p><strong>函数体说明</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">search_friends</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> userName<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> remarkName<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> nickName<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> wechatAccount<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre> 
<p><strong>案例说明</strong></p> 
<p>获取自己的用户信息，返回自己的属性字典</p> 
<pre><code class="prism language-python">itchat<span class="token punctuation">.</span>search_friends<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>获取特定 UserName 的用户信息</p> 
<pre><code class="prism language-python">itchat<span class="token punctuation">.</span>search_friends<span class="token punctuation">(</span>userName<span class="token operator">=</span><span class="token string">'@abcdefg1234567'</span><span class="token punctuation">)</span>
</code></pre> 
<p>获取任何一项等于 name 键值的用户</p> 
<pre><code class="prism language-python">itchat<span class="token punctuation">.</span>search_friends<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'littlecodersh'</span><span class="token punctuation">)</span>
</code></pre> 
<p>获取分别对应相应键值的用户</p> 
<pre><code class="prism language-python">itchat<span class="token punctuation">.</span>search_friends<span class="token punctuation">(</span>wechatAccount<span class="token operator">=</span><span class="token string">'littlecodersh'</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>组合查询</strong></p> 
<pre><code class="prism language-python">itchat<span class="token punctuation">.</span>search_friends<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'LittleCoder机器人'</span><span class="token punctuation">,</span> wechatAccount<span class="token operator">=</span><span class="token string">'littlecodersh'</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong><code>wechatAccount 安全性特别说明</code></strong></p> 
<p>由于腾讯考虑安全性问题，更新了 web 端安全信息保护机制。目前来说，微信网页端已经无法获取用户微信账号 wechatAccount 属性。所以 itchat.search_friends(wechatAccount=‘littlecodersh’) 查询都是为 [] 空。</p> 
<h3><a id="_374"></a>用户属性案例说明</h3> 
<p><strong>查询指定 userName 用户信息</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat
itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>hotReload<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

friends <span class="token operator">=</span> itchat<span class="token punctuation">.</span>search_friends<span class="token punctuation">(</span>userName<span class="token operator">=</span><span class="token string">'@16b071aa1a7c5b67b0c7911ede8cc53db5bd0c4d63f059142be7a5d6168ff074'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>friends<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>查询昵称 ‘番茄土豆’ 用户信息（相较于 userName 来说 nickName 更方便使用）</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat
itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>hotReload<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

friends <span class="token operator">=</span> itchat<span class="token punctuation">.</span>search_friends<span class="token punctuation">(</span>nickName<span class="token operator">=</span><span class="token string">'番茄土豆'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>friends<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>数据格式说明</strong></p> 
<pre><code class="prism language-json"><span class="token string-property property">'MemberList'</span><span class="token operator">:</span> <span class="token string">'&lt;ContactList: []&gt;'</span><span class="token punctuation">,</span>  
<span class="token string-property property">'Uin'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  
<span class="token string-property property">'UserName'</span><span class="token operator">:</span> <span class="token string">'@16b071aa1a7c5b67b0c7911ede8cc53db5bd0c4d63f059142be7a5d6168ff074'</span><span class="token punctuation">,</span>  
<span class="token string-property property">'NickName'</span><span class="token operator">:</span> <span class="token string">'番茄土豆'</span><span class="token punctuation">,</span>  
<span class="token string-property property">'HeadImgUrl'</span><span class="token operator">:</span> <span class="token string">'/cgi-bin/mmwebwx-bin/webwxgeticon?seq=768678887&amp;username=@16b071aa1a7c5b67b0c7911ede8cc53db5bd0c4d63f059142be7a5d6168ff074&amp;skey=@crypt_13d84e54_651a5a10883168912a00eb384261832c'</span><span class="token punctuation">,</span>  
<span class="token string-property property">'ContactFlag'</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>  
<span class="token string-property property">'MemberCount'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  
<span class="token string-property property">'RemarkName'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  
<span class="token string-property property">'HideInputBarFlag'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  
<span class="token string-property property">'Sex'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  
<span class="token string-property property">'Signature'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  
<span class="token string-property property">'VerifyFlag'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  
<span class="token string-property property">'OwnerUin'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  
<span class="token string-property property">'PYInitial'</span><span class="token operator">:</span> <span class="token string">'PJTD'</span><span class="token punctuation">,</span>  
<span class="token string-property property">'PYQuanPin'</span><span class="token operator">:</span> <span class="token string">'panjiatudou'</span><span class="token punctuation">,</span>  
<span class="token string-property property">'RemarkPYInitial'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  
<span class="token string-property property">'RemarkPYQuanPin'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  
<span class="token string-property property">'StarFriend'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  
<span class="token string-property property">'AppAccountFlag'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  
<span class="token string-property property">'Statues'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  
<span class="token string-property property">'AttrStatus'</span><span class="token operator">:</span> <span class="token number">102437</span><span class="token punctuation">,</span>  
<span class="token string-property property">'Province'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  
<span class="token string-property property">'City'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  
<span class="token string-property property">'Alias'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  
<span class="token string-property property">'SnsFlag'</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  
<span class="token string-property property">'UniFriend'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  
<span class="token string-property property">'DisplayName'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  
<span class="token string-property property">'ChatRoomId'</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  
<span class="token string-property property">'KeyWord'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  
<span class="token string-property property">'EncryChatRoomId'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>  
<span class="token string-property property">'IsOwner'</span><span class="token operator">:</span> <span class="token number">0</span>  
</code></pre> 
<h3><a id="_427"></a>设置联系人置顶</h3> 
<p>在 itchat 的早期版本中，set_pinned 方法用来设置某个微信好友为置顶好友的。但是，由于微信官方接口的变化，这个方法现在可能已经无法使用了。</p> 
<p><strong>查询昵称：番茄土豆的联系人设置置顶操作</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat
itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>hotReload<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>


friend_list <span class="token operator">=</span> itchat<span class="token punctuation">.</span>search_friends<span class="token punctuation">(</span>nickName<span class="token operator">=</span><span class="token string">'番茄土豆'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> friend_list<span class="token punctuation">:</span>
    contact <span class="token operator">=</span> friend_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    userName <span class="token operator">=</span> contact<span class="token punctuation">.</span>UserName
    baseResponse <span class="token operator">=</span> itchat<span class="token punctuation">.</span>set_pinned<span class="token punctuation">(</span>userName<span class="token operator">=</span>userName<span class="token punctuation">,</span> isPinned<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> baseResponse<span class="token punctuation">[</span><span class="token string">'BaseResponse'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Ret'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"fail"</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>baseResponse 属性</strong></p> 
<pre><code class="prism language-python"><span class="token punctuation">{<!-- --></span><span class="token string">'BaseResponse'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'Ret'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'ErrMsg'</span><span class="token punctuation">:</span> <span class="token string">'请求成功'</span><span class="token punctuation">,</span> <span class="token string">'RawMsg'</span><span class="token punctuation">:</span> <span class="token string">'请求成功'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_456"></a>资源上传案例</h3> 
<p>进行资源文件上传微信服务器获取媒体 ID 即 MediaId。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">upload_file</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> fileDir<span class="token punctuation">,</span> isPicture<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> isVideo<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> toUserName<span class="token operator">=</span><span class="token string">'filehelper'</span><span class="token punctuation">,</span> file_<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> preparedFile<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre> 
<p><strong>上传图片资源类型案例</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat  
  
itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>hotReload<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  
  
baseResponse <span class="token operator">=</span> itchat<span class="token punctuation">.</span>upload_file<span class="token punctuation">(</span><span class="token string">'image.jpg'</span><span class="token punctuation">,</span> isPicture<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> baseResponse<span class="token punctuation">[</span><span class="token string">'BaseResponse'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Ret'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
    MediaId <span class="token operator">=</span> baseResponse<span class="token punctuation">[</span><span class="token string">'MediaId'</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"fail"</span><span class="token punctuation">)</span>
</code></pre> 
<p>baseResponse</p> 
<pre><code class="prism language-python"><span class="token punctuation">{<!-- --></span><span class="token string">'BaseResponse'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'Ret'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'ErrMsg'</span><span class="token punctuation">:</span> <span class="token string">'请求成功'</span><span class="token punctuation">,</span> <span class="token string">'RawMsg'</span><span class="token punctuation">:</span> <span class="token string">'请求成功'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'MediaId'</span><span class="token punctuation">:</span> <span class="token string">'@crypt_e4c0786c_eb0f1099f841e1f83929986d0cf72492fce0876379a21067dc3b8f5fcbcb2bde100a639cf8abb8e6b54b74305187c3bf9ef4dfa1a71d5e255c114b90f27b44aa7c32d4770a79308c1c562a562872afec89d2ed2ce6762de846161b1f3958bdd0681477e152e1f49bcd32c1d36bcabf85b43b5a5ba641d78ccd7bd3aef24a045763d8015b7c980a65663f190b4787f50c2230f67064e9e1ac62382e0a69e91693f347643103e9283742a0ffe9ca4cf3bc080da5c9dd9d5acda2eb4874c56960c6837380e27968593474be01ddc1a633326d8e74c09651b3255026fe665084a5dbca8e29bacc70e84d08e5dec6e74f95fc224251d55ae7f832fe25580d3fa086c1b099d0c2d180fa6615b478eb0e09af6e91cc8b0ff4571f928593c0d68e6be951'</span><span class="token punctuation">,</span> <span class="token string">'StartPos'</span><span class="token punctuation">:</span> <span class="token number">54082</span><span class="token punctuation">,</span> <span class="token string">'CDNThumbImgHeight'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'CDNThumbImgWidth'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'EncryFileName'</span><span class="token punctuation">:</span> <span class="token string">'image%2Ejpg'</span><span class="token punctuation">}</span>
</code></pre> 
<p><strong>上传视频资源类型案例</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat  
  
itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>hotReload<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  
  
baseResponse <span class="token operator">=</span> itchat<span class="token punctuation">.</span>upload_file<span class="token punctuation">(</span><span class="token string">'video.mp4'</span><span class="token punctuation">,</span> isVideo<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>baseResponse<span class="token punctuation">)</span>

<span class="token keyword">if</span> baseResponse<span class="token punctuation">[</span><span class="token string">'BaseResponse'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Ret'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
    MediaId <span class="token operator">=</span> baseResponse<span class="token punctuation">[</span><span class="token string">'MediaId'</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"fail"</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_499"></a>发送图片类型消息</h3> 
<p>send_image 函数：发送指定用户指定图片类型</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">send_image</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> fileDir<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> toUserName<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> mediaId<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> file_<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre> 
<p><strong>函数说明：</strong></p> 
<pre><code class="prism language-python">属性 toUserName：指定所需要发送给他（她）图片的用户。

属性 fileDir：	文件地址，默认情况下 send_image 会先把本地图片资源上传到微信服务器，然后进行发送图片。

属性 mediaId：	媒体 Id，通过 itchat<span class="token punctuation">.</span>upload_file 获取，若配置了，就不会重复加载本地资源，先上传微信服务器，然后再进行发送，而是直接从微信服务器进行读取，然后进行发送图片。
 
属性 file_：		指定<span class="token builtin">file</span> 对象。配置打开状态下 <span class="token builtin">file</span> 对象（<span class="token keyword">with</span> <span class="token builtin">open</span> ··· 打开）。
</code></pre> 
<p><strong>查询昵称 <code>番茄土豆</code> 联系人发送 image.jpg 图片</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat
itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>hotReload<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>


itchat<span class="token punctuation">.</span>dump_login_status<span class="token punctuation">(</span><span class="token string">"itchat.pkl"</span><span class="token punctuation">)</span>

friend_list <span class="token operator">=</span> itchat<span class="token punctuation">.</span>search_friends<span class="token punctuation">(</span>nickName<span class="token operator">=</span><span class="token string">'番茄土豆'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> friend_list<span class="token punctuation">:</span>
    friend <span class="token operator">=</span> friend_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    baseResponse <span class="token operator">=</span> itchat<span class="token punctuation">.</span>send_image<span class="token punctuation">(</span>fileDir<span class="token operator">=</span><span class="token string">"image.jpg"</span><span class="token punctuation">,</span> toUserName<span class="token operator">=</span>friend<span class="token punctuation">.</span>UserName<span class="token punctuation">)</span>
    <span class="token keyword">if</span> baseResponse<span class="token punctuation">[</span><span class="token string">'BaseResponse'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Ret'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"fail"</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行结果</p> 
<p><img src="https://images2.imgbox.com/07/7b/E1rOHhDR_o.png" alt="在这里插入图片描述"></p> 
<p><strong>文件错误 baseResponse 常见报错</strong></p> 
<blockquote> 
 <p>{‘BaseResponse’: {‘ErrMsg’: ‘文件位置错误’, ‘Ret’: -1002, ‘RawMsg’: ‘No file found in specific dir’}}</p> 
</blockquote> 
<p><strong>配置 MediaId 进行发送图片（案例实验）</strong></p> 
<p>准备两张相同大小、相同分辨率、相同文件类型的图片 image1.jpg、image2.jpg（可以随便找张图片复制一个副本进行实验）</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> time
<span class="token keyword">import</span> itchat

itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>hotReload<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>


itchat<span class="token punctuation">.</span>dump_login_status<span class="token punctuation">(</span><span class="token string">"itchat.pkl"</span><span class="token punctuation">)</span>

friend_list <span class="token operator">=</span> itchat<span class="token punctuation">.</span>search_friends<span class="token punctuation">(</span>nickName<span class="token operator">=</span><span class="token string">'夜雨星空'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> friend_list<span class="token punctuation">:</span>
    friend <span class="token operator">=</span> friend_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第 1 次开始时间："</span><span class="token punctuation">,</span> start_time<span class="token punctuation">)</span>
    baseResponse <span class="token operator">=</span> itchat<span class="token punctuation">.</span>send_image<span class="token punctuation">(</span>fileDir<span class="token operator">=</span><span class="token string">"image1.jpg"</span><span class="token punctuation">,</span> toUserName<span class="token operator">=</span>friend<span class="token punctuation">.</span>UserName<span class="token punctuation">)</span>
    <span class="token keyword">if</span> baseResponse<span class="token punctuation">[</span><span class="token string">'BaseResponse'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Ret'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"fail"</span><span class="token punctuation">)</span>
    end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第 1 次结束时间："</span><span class="token punctuation">,</span> end_time<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第 1 次花费时间："</span><span class="token punctuation">,</span> end_time <span class="token operator">-</span> start_time<span class="token punctuation">)</span>

    MediaId <span class="token operator">=</span> <span class="token boolean">None</span>
    baseResponse <span class="token operator">=</span> itchat<span class="token punctuation">.</span>upload_file<span class="token punctuation">(</span><span class="token string">'image2.jpg'</span><span class="token punctuation">,</span> isPicture<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> baseResponse<span class="token punctuation">[</span><span class="token string">'BaseResponse'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Ret'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        MediaId <span class="token operator">=</span> baseResponse<span class="token punctuation">[</span><span class="token string">'MediaId'</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"fail"</span><span class="token punctuation">)</span>

    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> MediaId<span class="token punctuation">:</span>
        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第 2 次开始时间："</span><span class="token punctuation">,</span> start_time<span class="token punctuation">)</span>
        baseResponse <span class="token operator">=</span> itchat<span class="token punctuation">.</span>send_image<span class="token punctuation">(</span>fileDir<span class="token operator">=</span><span class="token string">"image2.jpg"</span><span class="token punctuation">,</span> toUserName<span class="token operator">=</span>friend<span class="token punctuation">.</span>UserName<span class="token punctuation">,</span> mediaId<span class="token operator">=</span>MediaId<span class="token punctuation">)</span>
        <span class="token keyword">if</span> baseResponse<span class="token punctuation">[</span><span class="token string">'BaseResponse'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Ret'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>baseResponse<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"fail"</span><span class="token punctuation">)</span>
        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第 2 次结束时间："</span><span class="token punctuation">,</span> end_time<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第 2 次花费时间："</span><span class="token punctuation">,</span> end_time <span class="token operator">-</span> start_time<span class="token punctuation">)</span>

	time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"image.jpg"</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> image<span class="token punctuation">:</span>

        start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第 3 次开始时间："</span><span class="token punctuation">,</span> start_time<span class="token punctuation">)</span>
        baseResponse <span class="token operator">=</span> itchat<span class="token punctuation">.</span>send_image<span class="token punctuation">(</span>toUserName<span class="token operator">=</span>friend<span class="token punctuation">.</span>UserName<span class="token punctuation">,</span> file_<span class="token operator">=</span>image<span class="token punctuation">)</span>
        <span class="token keyword">if</span> baseResponse<span class="token punctuation">[</span><span class="token string">'BaseResponse'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Ret'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>baseResponse<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"fail"</span><span class="token punctuation">)</span>
        end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第 3 次结束时间："</span><span class="token punctuation">,</span> end_time<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"第 3 次花费时间："</span><span class="token punctuation">,</span> end_time <span class="token operator">-</span> start_time<span class="token punctuation">)</span>
</code></pre> 
<p>实验结果：</p> 
<pre><code class="prism language-python">第 <span class="token number">1</span> 次开始时间： <span class="token number">1713025956.1631649</span>
success
第 <span class="token number">1</span> 次结束时间： <span class="token number">1713025957.1552198</span>
第 <span class="token number">1</span> 次花费时间： <span class="token number">0.9920549392700195</span>
success
第 <span class="token number">2</span> 次开始时间： <span class="token number">1713025962.2728899</span>
success
第 <span class="token number">2</span> 次结束时间： <span class="token number">1713025962.7113612</span>
第 <span class="token number">2</span> 次花费时间： <span class="token number">0.43847131729125977</span>
第 <span class="token number">3</span> 次开始时间： <span class="token number">1713025967.712695</span>
success
第 <span class="token number">3</span> 次结束时间： <span class="token number">1713025968.5231287</span>
第 <span class="token number">3</span> 次花费时间： <span class="token number">0.8104338645935059</span>
</code></pre> 
<p>实验数据表明：第一次的时间是 0.90 秒，第二次的时间是 0.33 秒，第三次的时间是 0.81 秒。说明提前把图片资源数据上传到微信服务器，都要比每次本地读取图片资源上传的时间开销要短。</p> 
<p>常见问题</p> 
<blockquote> 
 <p>{‘BaseResponse’: {‘ErrMsg’: ‘参数错误’, ‘Ret’: -1005, ‘RawMsg’: ‘Either fileDir or file_ should be specific’}} 文件路径 fileDir 和 file_ 必须要指定一个。</p> 
</blockquote> 
<h3><a id="_637"></a>发送视频类型消息</h3> 
<p><strong>查询昵称 <code>夜雨星空</code> 联系人发送 video.mp4 视频</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat
itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>hotReload<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>


itchat<span class="token punctuation">.</span>dump_login_status<span class="token punctuation">(</span><span class="token string">"itchat.pkl"</span><span class="token punctuation">)</span>

friend_list <span class="token operator">=</span> itchat<span class="token punctuation">.</span>search_friends<span class="token punctuation">(</span>nickName<span class="token operator">=</span><span class="token string">'夜雨星空'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> friend_list<span class="token punctuation">:</span>
    friend <span class="token operator">=</span> friend_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    baseResponse <span class="token operator">=</span> itchat<span class="token punctuation">.</span>send_video<span class="token punctuation">(</span>fileDir<span class="token operator">=</span><span class="token string">"video.mp4"</span><span class="token punctuation">,</span> toUserName<span class="token operator">=</span>friend<span class="token punctuation">.</span>UserName<span class="token punctuation">)</span>
    <span class="token keyword">if</span> baseResponse<span class="token punctuation">[</span><span class="token string">'BaseResponse'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Ret'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"fail"</span><span class="token punctuation">)</span>
</code></pre> 
<p>测试结果<br> <img src="https://images2.imgbox.com/fa/92/Baft1koA_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_658"></a>接收语音类型消息</h3> 
<p>开启一个私聊监听语音消息的消息注册器，存储私信的语音数据。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat
<span class="token keyword">from</span> itchat<span class="token punctuation">.</span>content <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> time

itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>hotReload<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@itchat<span class="token punctuation">.</span>msg_register</span><span class="token punctuation">(</span>VOICE<span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">download_voice</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span>
    get_download_fn <span class="token operator">=</span> msg<span class="token punctuation">[</span><span class="token string">'Text'</span><span class="token punctuation">]</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"voice_</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">str</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">.mp3"</span></span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>get_download_fn<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>

itchat<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>msg 消息体</p> 
<pre><code class="prism language-python"><span class="token punctuation">{<!-- --></span><span class="token string">'MsgId'</span><span class="token punctuation">:</span> <span class="token string">'5692830849988916957'</span><span class="token punctuation">,</span> <span class="token string">'FromUserName'</span><span class="token punctuation">:</span> <span class="token string">'@c0fe14053c62806a81dddb991a99310762a24834c5659209e734b4a8f28e9cf4'</span><span class="token punctuation">,</span> <span class="token string">'ToUserName'</span><span class="token punctuation">:</span> <span class="token string">'@1c36f5debae32a8091e98b867bd3942b880c025866707bc030759313a59616bf'</span><span class="token punctuation">,</span> <span class="token string">'MsgType'</span><span class="token punctuation">:</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token string">'Content'</span><span class="token punctuation">:</span> <span class="token string">'@f775c6e5de55b0355b2898694e8b33290adce345777eaecf27f83af03663a376d7069003478ce56bdfb935976a0856e53f61ed2a6e50a66803a7b83a6b305cb820617d71ffb4db4064b0a7a08ad04afdf32e6f2f3e1a97694c12ebe9f289dc331f8cda876b8bf0bef46c023917ed48d3843596068fe6950ee111ec729e7209aebc9ee29a0030a5d8711a22a469dbc4c38386c9c455aeb04ddaf3b37d052508b1598ad1a40e12deb2c4c789608c09552e94a18b77d82239992d54a3341d69e466a1bc2fb06909ae69b72d9ddf6a6f962e702e49bb26247bcd7f82a9f3b2d5c4891a060c0c54c812c8c17b046dd3a951fabab83e378690594084913f9d3d3a5afaf02379dcae8d106c7f934ab4303c08f18a0ccabb899cd93e6be0eba2d0b0207a249af537a729cd84e839f833c5b1f3832d6c53250a97c73822481f89eb4ea94bb80b3d4598ad6063b0d5f07b3b00f4ca7477ac22de031f78627d4e6176cbdfa721d039167e61f502baccc6c803ca3b347e7777715686e7ab90d79e86747c453693fcca3e424dcd4c1db4d5635d75cd3d47e059b81dbfb6f1a2e943a5dd3f154c55575827e5c52531139862df8a7f2d3a41d272077655e98b4c9ab75f127caff484269a0120b2f89297756259e732b2ff5b4d073be1a0336ef8ac52a2504e5fd6'</span><span class="token punctuation">,</span> <span class="token string">'Status'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'ImgStatus'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'CreateTime'</span><span class="token punctuation">:</span> <span class="token number">1713029115</span><span class="token punctuation">,</span> <span class="token string">'VoiceLength'</span><span class="token punctuation">:</span> <span class="token number">1648</span><span class="token punctuation">,</span> <span class="token string">'PlayLength'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'FileName'</span><span class="token punctuation">:</span> <span class="token string">'240414-012516.mp3'</span><span class="token punctuation">,</span> <span class="token string">'FileSize'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'MediaId'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'Url'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'AppMsgType'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'StatusNotifyCode'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'StatusNotifyUserName'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'RecommendInfo'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'UserName'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'NickName'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'QQNum'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'Province'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'City'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'Content'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'Signature'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'Alias'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'Scene'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'VerifyFlag'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'AttrStatus'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'Sex'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'Ticket'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'OpCode'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'ForwardFlag'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'AppInfo'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'AppID'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'Type'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'HasProductId'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'Ticket'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'ImgHeight'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'ImgWidth'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'SubMsgType'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'NewMsgId'</span><span class="token punctuation">:</span> <span class="token number">5692830849988916957</span><span class="token punctuation">,</span> <span class="token string">'OriContent'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'EncryFileName'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'User'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>User<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'MemberList'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>ContactList<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token string">'Uin'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'UserName'</span><span class="token punctuation">:</span> <span class="token string">'@c0fe14053c62806a81dddb991a99310762a24834c5659209e734b4a8f28e9cf4'</span><span class="token punctuation">,</span> <span class="token string">'NickName'</span><span class="token punctuation">:</span> <span class="token string">'王牌哥哥'</span><span class="token punctuation">,</span> <span class="token string">'HeadImgUrl'</span><span class="token punctuation">:</span> <span class="token string">'/cgi-bin/mmwebwx-bin/webwxgeticon?seq=768687014&amp;username=@c0fe14053c62806a81dddb991a99310762a24834c5659209e734b4a8f28e9cf4&amp;skey=@crypt_13d84e54_0eb12882a8a3a1f04047afebf03db315'</span><span class="token punctuation">,</span> <span class="token string">'ContactFlag'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'MemberCount'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'RemarkName'</span><span class="token punctuation">:</span> <span class="token string">'糯米宝宝'</span><span class="token punctuation">,</span> <span class="token string">'HideInputBarFlag'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'Sex'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'Signature'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'VerifyFlag'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'OwnerUin'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'PYInitial'</span><span class="token punctuation">:</span> <span class="token string">'WPGG'</span><span class="token punctuation">,</span> <span class="token string">'PYQuanPin'</span><span class="token punctuation">:</span> <span class="token string">'wangpaigege'</span><span class="token punctuation">,</span> <span class="token string">'RemarkPYInitial'</span><span class="token punctuation">:</span> <span class="token string">'NMBB'</span><span class="token punctuation">,</span> <span class="token string">'RemarkPYQuanPin'</span><span class="token punctuation">:</span> <span class="token string">'nuomibaobao'</span><span class="token punctuation">,</span> <span class="token string">'StarFriend'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'AppAccountFlag'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'Statues'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'AttrStatus'</span><span class="token punctuation">:</span> <span class="token number">4135</span><span class="token punctuation">,</span> <span class="token string">'Province'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'City'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'Alias'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'SnsFlag'</span><span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token string">'UniFriend'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'DisplayName'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'ChatRoomId'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'KeyWord'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'EncryChatRoomId'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'IsOwner'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token string">'Type'</span><span class="token punctuation">:</span> <span class="token string">'Recording'</span><span class="token punctuation">,</span> <span class="token string">'Text'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>function get_download_fn<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token builtin">locals</span><span class="token operator">&gt;</span><span class="token punctuation">.</span>download_fn at <span class="token number">0x000002D7F7C763E0</span><span class="token operator">&gt;</span><span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>get_download_fn：&lt;function get_download_fn..download_fn at 0x0000020E7E2B63E0&gt;</p> 
</blockquote> 
<p><strong>存储语音数据</strong></p> 
<p><img src="https://images2.imgbox.com/f9/90/HAKAarJG_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_690"></a>发送文件类型消息</h3> 
<p><code>send_file</code>：发送文件函数（指定群 / 用户发送文件）</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">send_file</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> fileDir<span class="token punctuation">,</span> toUserName<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> mediaId<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> file_<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre> 
<p><strong>函数说明：</strong></p> 
<pre><code class="prism language-python">属性 toUserName：指定所需要发送给他（她）文件资源的用户。

属性 fileDir：	文件地址，默认情况下 send_file 会先把本地文件资源上传到微信服务器，然后进行发送文件资源。

属性 mediaId：	媒体 Id，通过 itchat<span class="token punctuation">.</span>upload_file 获取，若配置了，就不会重复加载本地资源，先上传微信服务器，然后再进行发送，而是直接从微信服务器进行读取，然后进行发送图片。
 
属性 file_：		指定 <span class="token builtin">file</span> 对象。配置打开状态下 <span class="token builtin">file</span> 对象（<span class="token keyword">with</span> <span class="token builtin">open</span> ··· 打开）。
</code></pre> 
<p><strong>查询昵称 <code>夜雨星空</code> 联系人发送 helloworld.docx 文档</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat
itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>hotReload<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>


itchat<span class="token punctuation">.</span>dump_login_status<span class="token punctuation">(</span><span class="token string">"itchat.pkl"</span><span class="token punctuation">)</span>

friend_list <span class="token operator">=</span> itchat<span class="token punctuation">.</span>search_friends<span class="token punctuation">(</span>nickName<span class="token operator">=</span><span class="token string">'夜雨星空'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> friend_list<span class="token punctuation">:</span>
    friend <span class="token operator">=</span> friend_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    baseResponse <span class="token operator">=</span> itchat<span class="token punctuation">.</span>send_file<span class="token punctuation">(</span>fileDir<span class="token operator">=</span><span class="token string">"./helloworld.docx"</span><span class="token punctuation">,</span> toUserName<span class="token operator">=</span>friend<span class="token punctuation">.</span>UserName<span class="token punctuation">)</span>
    <span class="token keyword">if</span> baseResponse<span class="token punctuation">[</span><span class="token string">'BaseResponse'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Ret'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"fail"</span><span class="token punctuation">)</span>
</code></pre> 
<p>测试结果</p> 
<p><img src="https://images2.imgbox.com/58/7b/6rc4ja6j_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_728"></a>获取微信群数据</h3> 
<p>获取当前登陆微信下全部微信群数据（本地数据 / 实时数据）</p> 
<p><strong>get_chatrooms 函数</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_chatrooms</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> update<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> contactOnly<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre> 
<blockquote> 
 <p>特别注意：如果不设置 update 获取是本地 local 数据（itchat.pkl 数据）。属性 contactOnly 如果配置了 True，则仅返回 starred 标记了的微信群。</p> 
</blockquote> 
<p><strong><code>读取实时数据</code>：读取当前登陆态数据</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat
itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>hotReload<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

chatroom_list <span class="token operator">=</span> itchat<span class="token punctuation">.</span>get_chatrooms<span class="token punctuation">(</span>update<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> room <span class="token keyword">in</span> chatroom_list<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>room<span class="token punctuation">)</span>
</code></pre> 
<p><strong><code>读取本地数据</code>：不登录也同样可以读取数据（itchat.pkl 数据加载）</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat

itchat<span class="token punctuation">.</span>dump_login_status<span class="token punctuation">(</span><span class="token string">"itchat.pkl"</span><span class="token punctuation">)</span>
chatroom_list <span class="token operator">=</span> itchat<span class="token punctuation">.</span>get_chatrooms<span class="token punctuation">(</span>update<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> room <span class="token keyword">in</span> chatroom_list<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>room<span class="token punctuation">)</span>
</code></pre> 
<p>我们没有进行 itchat 扫描登陆操作，通过加载 itchat.pkl 登陆数据，同样查询到微信群数据。</p> 
<h3><a id="_764"></a>设置微信群名称</h3> 
<p>查询 “唤醒手腕测试群” 微信群设置新的群名称：唤醒手腕新群</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat
itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span>hotReload<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>


itchat<span class="token punctuation">.</span>dump_login_status<span class="token punctuation">(</span><span class="token string">"itchat.pkl"</span><span class="token punctuation">)</span>
chatroom_list <span class="token operator">=</span> itchat<span class="token punctuation">.</span>get_chatrooms<span class="token punctuation">(</span>update<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> room <span class="token keyword">in</span> chatroom_list<span class="token punctuation">:</span>
    <span class="token keyword">if</span> room<span class="token punctuation">.</span>NickName <span class="token operator">==</span> <span class="token string">"唤醒手腕测试群"</span><span class="token punctuation">:</span>
        baseResponse <span class="token operator">=</span> itchat<span class="token punctuation">.</span>set_chatroom_name<span class="token punctuation">(</span>chatroomUserName<span class="token operator">=</span>room<span class="token punctuation">.</span>UserName<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"唤醒手腕新群"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> baseResponse<span class="token punctuation">[</span><span class="token string">'BaseResponse'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Ret'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"fail"</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>特别注意：由于微信 web 协议限制（设置群名称功能可能已经失效了）</p> 
</blockquote> 
<h3><a id="_785"></a>查询微信群发送消息</h3> 
<p>通过 get_friends 方法可以轻松获取所有的好友（好友首位是自己）。进行判断群名匹配，从而获取群的 UserName 属性进行发送指定群消息。</p> 
<p><strong>.env 配置文件</strong></p> 
<pre><code class="prism language-python">SEND_ROOM_NAME<span class="token operator">=</span>唤醒手腕测试群
</code></pre> 
<p><strong>实现源码</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat
<span class="token keyword">from</span> itchat<span class="token punctuation">.</span>content <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token keyword">import</span> dotenv
dotenv<span class="token punctuation">.</span>load_dotenv<span class="token punctuation">(</span><span class="token string">'.env'</span><span class="token punctuation">)</span>

itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span><span class="token punctuation">)</span>

chatroom_list <span class="token operator">=</span> itchat<span class="token punctuation">.</span>get_chatrooms<span class="token punctuation">(</span>update<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> room <span class="token keyword">in</span> chatroom_list<span class="token punctuation">:</span>
    <span class="token keyword">if</span> room<span class="token punctuation">.</span>NickName <span class="token operator">==</span> os<span class="token punctuation">.</span>getenv<span class="token punctuation">(</span><span class="token string">"SEND_ROOM_NAME"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        GROUP_USERNAME <span class="token operator">=</span> room<span class="token punctuation">.</span>UserName

message <span class="token operator">=</span> <span class="token string">"唤醒手腕"</span>        
itchat<span class="token punctuation">.</span>send_msg<span class="token punctuation">(</span>msg<span class="token operator">=</span>message<span class="token punctuation">,</span> toUserName<span class="token operator">=</span>GROUP_USERNAME<span class="token punctuation">)</span>

itchat<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_814"></a>实现消息群发助手</h3> 
<p>通过 get_friends 方法可以轻松获取所有的好友（好友首位是自己）。基于不同的好友可以发送不同的消息。这条程序运行后是真的会发消息出去，如果只是演示目的，把 itchat.send 改为 print 即可。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> itchat
<span class="token keyword">import</span> time
itchat<span class="token punctuation">.</span>auto_login<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>

SINCERE_WISH <span class="token operator">=</span> <span class="token string">u'祝%s新年快乐！'</span>

friendList <span class="token operator">=</span> itchat<span class="token punctuation">.</span>get_friends<span class="token punctuation">(</span>update<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> friend <span class="token keyword">in</span> friendList<span class="token punctuation">:</span>
    itchat<span class="token punctuation">.</span>send<span class="token punctuation">(</span>SINCERE_WISH <span class="token operator">%</span> <span class="token punctuation">(</span>friend<span class="token punctuation">[</span><span class="token string">'DisplayName'</span><span class="token punctuation">]</span> <span class="token keyword">or</span> friend<span class="token punctuation">[</span><span class="token string">'NickName'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> friend<span class="token punctuation">[</span><span class="token string">'UserName'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">.5</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_829"></a>登陆稳定性常见问题</h3> 
<p>命令行登录一段时间后无法与服务器正常交互，这是因为微信网页端存在心跳机制，一段时间不交互将会断开连接。另外，每次获取数据时（webwxsync）记得更新 SyncKey。</p> 
<p>待更新······</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dc877fdcfeba1b8024112b14ddbd40f0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MySQL中存储过程（详解，一篇就够了！！！）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c4398cccef22c424d639a4b2333d4959/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">0基础从前端到Web3 —— Vite &#43; React &#43; TS moveCall a &#43; b</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>