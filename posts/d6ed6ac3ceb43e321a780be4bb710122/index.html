<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>小程序嵌套H5 - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/d6ed6ac3ceb43e321a780be4bb710122/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="小程序嵌套H5">
  <meta property="og:description" content="在微信小程序中内嵌H5页面是一种常见的需求，因为H5页面具有灵活性和跨平台性，可以弥补小程序原生代码的不足。
微信小程序自带的 web-view 组件相当于 HTML页面中的 iframe ，方便我们在微信小程序中打开一个 H5 页面；从微信小程序基础库1.6.4开始，我们就可以在小程序内放置一个&lt;web-view&gt;组件来链接我们的HTML页面了。
web-view使用前提：业务域名 由于个人类型的小程序暂不支持使用。只有非个人类型小程序可以配置业务域名
1、扫码登录微信公众平台；
2、开发管理 —— 开发设置 —— 业务域名 进行添加、修改；
3、配置完业务域名后，还需要下载校验文件（步骤2中第四张图的红色框部分），并将校验文件放置在域名根目录下（让后端去操作）。这一步相当于是让对方授权你能打开他的网页，比如要在你的小程序中打开百度，就需要百度去把这个校验文件放到他的域名根目录下得到他的授权；
4、设置业务域名时，报检查校验怎见石板，可以参考业务域名设置--校验文件检查失败自查指引 微信开放社区进行自查。
web-view链接打不开问题 打不开某个外部网页链接：
检查是否配置了小程序的业务域名，注意外部网页内再次 iframe 内嵌的其他域名也需要配置
检查是否为 https 协议，不支持http协议，不支持 IP 地址
打不开公众号文章：检查小程序是否已关联该公众号
外部网页链接、公众号文章链接在开发工具、体验版上可以打开，正式版上不行：
检查开发工具上是否开启了 “ 不校验合法域名、web-view业务域名、TLS版本以及HTTPS证书 ” 选项，开发工具上开启这个选项，不用配置业务域名或关联小程序也能打开链接，在开发工具上将该选项关掉，也就打不开了，该选项位置如下图；体验版上能打开是因为打开了 “ 开发调试 ”，关闭开发调试后，同样也是打不开。
web-view的基本使用 官方web-view组件使用：web-view | 微信开放文档
每个页面只能有一个 web-view组件，并且 web-view组件将默认展示在最高层级
index.wxml
&lt;view class=&#34;page-body&#34;&gt; &lt;web-view src=&#34;{{webUrl}}&#34;&gt;&lt;/web-view&gt; &lt;/view&gt; index.js
data: { webUrl: app.globalData.BASE_URL &#43; &#34;contacts&#34; }, H5页面和小程序跳转及传参 web-view提供的跳转接口 跳转基本流程 在小程序中新建一个web-view组件，指定URL为要嵌入的H5页面的链接。
在H5页面中添加微信小程序JS SDK的引入，在H5页面中可以通过JS SDK调用小程序API。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-25T15:05:50+08:00">
    <meta property="article:modified_time" content="2023-12-25T15:05:50+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">小程序嵌套H5</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>在微信小程序中内嵌H5页面是一种常见的需求，因为H5页面具有灵活性和跨平台性，可以弥补小程序原生代码的不足。</p> 
<p>微信小程序自带的 web-view 组件相当于 HTML页面中的 iframe ，方便我们在微信小程序中打开一个 H5 页面；从微信小程序基础库1.6.4开始，我们就可以在小程序内放置一个&lt;web-view&gt;组件来链接我们的HTML页面了。</p> 
<h6>web-view使用前提：业务域名</h6> 
<p>由于<strong>个人类型的小程序暂不支持使用。</strong>只有非个人类型小程序可以配置业务域名</p> 
<p>1、扫码登录<a href="https://mp.weixin.qq.com/" rel="nofollow" title="微信公众平台">微信公众平台</a>；</p> 
<p>2、开发管理 —— 开发设置 —— 业务域名 进行添加、修改；</p> 
<p><img alt="" height="448" src="https://images2.imgbox.com/91/df/BAZCgq2R_o.png" width="1142"></p> 
<p><img alt="" height="624" src="https://images2.imgbox.com/3a/9b/VYLmlwVD_o.png" width="1095"></p> 
<p>3、配置完业务域名后，还需要下载校验文件（步骤2中第四张图的红色框部分），并将校验文件放置在域名根目录下（让后端去操作）。这一步相当于是让对方授权你能打开他的网页，比如要在你的小程序中打开百度，就需要百度去把这个校验文件放到他的域名根目录下得到他的授权；</p> 
<p>4、设置业务域名时，报检查校验怎见石板，可以参考业务域名设置--校验文件检查失败自查指引 微信开放社区进行自查。</p> 
<h6>web-view链接打不开问题</h6> 
<ul><li> <p>打不开某个外部网页链接：</p> </li><li> <p>检查是否配置了小程序的业务域名，注意外部网页内再次 iframe 内嵌的其他域名也需要配置</p> 
  <ul><li> <p>检查是否为 https 协议，不支持http协议，不支持 IP 地址</p> </li><li> <p>打不开公众号文章：检查小程序是否已关联该公众号</p> </li></ul></li><li> <p>外部网页链接、公众号文章链接在开发工具、体验版上可以打开，正式版上不行：</p> 
  <ul><li> <p>检查开发工具上是否开启了 “ 不校验合法域名、web-view业务域名、TLS版本以及HTTPS证书 ” 选项，开发工具上开启这个选项，不用配置业务域名或关联小程序也能打开链接，在开发工具上将该选项关掉，也就打不开了，该选项位置如下图；体验版上能打开是因为打开了 “ 开发调试 ”，关闭开发调试后，同样也是打不开。</p> </li></ul></li></ul> 
<p><img alt="" height="871" src="https://images2.imgbox.com/d3/9f/85hcrP13_o.png" width="398"></p> 
<h6>web-view的基本使用</h6> 
<p>官方web-view组件使用：<a href="https://developers.weixin.qq.com/miniprogram/dev/component/web-view.html" rel="nofollow" title="web-view | 微信开放文档">web-view | 微信开放文档</a></p> 
<p>每个页面只能有一个 web-view组件，并且 web-view组件将默认展示在最高层级</p> 
<p><img alt="" height="508" src="https://images2.imgbox.com/af/89/82YNWTCE_o.png" width="1168"></p> 
<p>index.wxml</p> 
<pre><code>&lt;view class="page-body"&gt;
    &lt;web-view src="{<!-- -->{webUrl}}"&gt;&lt;/web-view&gt;
&lt;/view&gt;</code></pre> 
<p>index.js</p> 
<pre><code>data: {
    webUrl: app.globalData.BASE_URL + "contacts"
},</code></pre> 
<h6>H5页面和小程序跳转及传参</h6> 
<h6>web-view提供的跳转接口</h6> 
<p><img alt="" height="595" src="https://images2.imgbox.com/ee/38/FSTkpa1T_o.png" width="1165"></p> 
<h6>跳转基本流程</h6> 
<ul><li> <p>在小程序中新建一个web-view组件，指定URL为要嵌入的H5页面的链接。</p> </li><li> <p>在H5页面中添加微信小程序JS SDK的引入，在H5页面中可以通过JS SDK调用小程序API。</p> </li><li> <p>在小程序中设置跨域请求的安全域名，H5页面需要在此安全域名下。</p> </li><li> <p>在需要向小程序传递参数的H5页面</p> </li></ul> 
<h6>H5 跳转回小程序</h6> 
<p>在内嵌网页中跳回小程序，需引入JS-SDK</p> 
<pre><code>//安装插件
npm i -S weixin-js-sdk 
//引入
import wx from 'weixin-js-sdk'</code></pre> 
<p>在需要返回小程序的H5页面使用下面代码：</p> 
<pre><code>wx.miniProgram.navigateTo({
  url: "/pages/index", //小程序地址
});</code></pre> 
<p>注意：</p> 
<ul><li> <p>web-view 网页与小程序之间不支持除 JSSDK 提供的接口之外的通信；</p> </li><li> <p>在 iOS 中，若存在JSSDK接口调用无响应的情况，可在 web-view 的 src 后面加个#wechat_redirect解决；</p> </li><li> <p>避免在链接中带有中文字符，在 iOS 中会有打开白屏的问题，建议加一下 encodeURIComponent；</p> </li></ul> 
<h6>小程序和H5之间传参</h6> 
<p>小程序和H5之间互相跳转，如果需要传递参数的话可以通过 url 路径拼接的方式来传递参数</p> 
<p>小程序向H5传参：</p> 
<ul><li> <p>微信小程序向H5传参</p> </li></ul> 
<pre><code>   /**
   * 页面的初始数据
   */
  data: {
    webUrl: app.globalData.BASE_URL +'eventDetail'
  },  
  /**
   * 生命周期函数--监听页面加载
   */
  onLoad(options) {
    let queryString = 'id=1&amp;name=anna'
    this.setData({
      webUrl: this.data.webUrl + '?' + queryString
    })
  },</code></pre> 
<ul><li> <p>H5接收参数</p> </li></ul> 
<pre><code>created() {
    this.detailData = this.$route.query
},</code></pre> 
<p>H5向小程序传参：</p> 
<ul><li> <p>H5向小程序传递参数</p> </li></ul> 
<pre><code>linkPath(route) {
        if (route.query) {
          url = url + '?params=' + JSON.stringify(route.query)
        }
        wx.miniProgram.redirectTo({
          url, //小程序地址
        })
}</code></pre> 
<ul><li> <p>小程序接收参数</p> </li></ul> 
<pre><code>  var util = require('../../../utils/util')
  /**
   * 生命周期函数--监听页面加载
   */
  onLoad(options) {
    const params  = JSON.parse( options.params )
    let queryString = util.queryUrl(params)
  },</code></pre> 
<p>utile.js</p> 
<pre><code>const queryUrl = params =&gt; {
  let queryString = Object.keys(params)
  .map(function (key) {
    return key + '=' + encodeURIComponent(params[key])
  })
  .join('&amp;')

  return queryString
}

const formatNumber = n =&gt; {
  n = n.toString()
  return n[1] ? n : `0${n}`
}

module.exports = {
  formatTime,
  queryUrl
}</code></pre> 
<h6>JSON数据处理</h6> 
<p>在传递参数过程中，使用了json处理参数可能会报 <code>Unexpected token % in JSON at position 0</code>这类报错问题，问题原因就是里面有特殊符号，需要对json数据做处理</p> 
<p><img alt="" height="367" src="https://images2.imgbox.com/6d/e4/bF3zixEY_o.png" width="947"></p> 
<pre><code>转换string类型时 用encodeURIComponent编码包一下
url = url + '?params=' + encodeURIComponent(JSON.stringify(route.query))
转换成原来的类型decodeURIComponent先解码回来再转换回来
const params  = JSON.parse( decodeURIComponent( options.params ) )</code></pre> 
<h6>自定义导航名</h6> 
<p>web-view页面的标题取决于H5嵌入页面的title标题，该组件不支持自定义组件导航栏</p> 
<p>可以通过修改title标题修改导航栏标题</p> 
<pre><code>mounted() {
    document.title = '通讯录'
},</code></pre> 
<p>注意：在微信开发者工具上可能会出现仅在第一次进入h5生效，进入h5后再改title的话并不能修改成功，由于微信开发者工具上不稳定，在上传后真机是可以的。</p> 
<h6>判断是否是微信环境</h6> 
<p>当有<strong>差异化功能时</strong>就可以通过<code>微信sdk</code>的接口进行<strong>当前是否小程序/公众号的判断</strong>，然后进行webview新页面的开发。</p> 
<p>微信小程序提供了两种判断方法</p> 
<ul><li> <p>wx.miniProgram.getEnv：获取当前环境</p> </li></ul> 
<pre><code>    / 判断是否是小程序端
    isMiniPrograms() {
      var isMiniprogram = false;
      // 判断是否是小程序打开
      wx.miniProgram.getEnv(res =&gt; {
        console.log(res.miniprogram)
        if (res.miniprogram) {
          //在小程序中
          isMiniprogram = true;
        }
      });
      return isMiniprogram;
    }</code></pre> 
<ul><li> <p>在网页内可通过<code>window.__wxjs_environment</code>变量判断是否在小程序环境，建议在<code>WeixinJSBridgeReady</code>回调中使用</p> </li></ul> 
<pre><code>const isWx =
      window.__wxjs_environment === 'miniprogram' || /miniProgram/i.test(navigator.userAgent.toLowerCase())</code></pre> 
<h6>相关注意事项</h6> 
<ul><li> <p>打开的域名没有在小程序管理后台设置业务域名（注意是业务域名，不是服务器域名）</p> </li><li> <p>打开的页面必须为https服务</p> </li><li> <p>打开的页面302过去的地址也必须设置过业务域名</p> </li><li> <p>web-view空白问题，请升级微信客户端到 6.5.16</p> </li><li> <p>页面可以包含iframe，但是iframe的地址必须为业务域名</p> </li><li> <p>web-view不支持支付能力，web-view的API能力见web-view的文档说明</p> </li><li> <p>开发者自己检查自己的https服务是否正常，测试方法：普通浏览器打开对应的地址</p> </li><li> <p>如果web-view使用了公众号授权的服务，开发者工具提示网页开发者的问题，请见：<a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1455784140" rel="nofollow" title="概述 | 微信开放文档">概述 | 微信开放文档</a></p> </li></ul> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1b1f36cff518c9d827b0d65adcbd961e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【PostGIS】PostgreSQL15&#43;对应PostGIS安装教程及空间数据可视化</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/46fb41d070f820c4786fdf84ef7fd3b3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java取出list中的某几个属性组成一个新的集合的几种方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>