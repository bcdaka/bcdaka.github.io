<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>纯净化安装EasyConnect：macOS Sonoma使用docker安装EasyConnect---docker-easyconnect - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/2b45acd5e6db2f789a18ba0d7ec30691/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="纯净化安装EasyConnect：macOS Sonoma使用docker安装EasyConnect---docker-easyconnect">
  <meta property="og:description" content="macOS Sonoma使用docker安装EasyConnect 硬软件配置以及安装背景硬软件配置安装背景 需要准备的工具使用方法：具体操作1.安装docker-easyconnect1.1纯命令行版 EasyConnect（amd64 架构）1.2图形界面版 EasyConnect（x86、amd64、arm64、mips64el 架构） 2.登录vpn1.使用web登录2.使用VNC Viewer登录3.使用命令行进行登录 代理1.使用Proxy SwitchyOmega进行代理2.使用clash进行代理 总结 硬软件配置以及安装背景 硬软件配置 MacBook Pro（2.4 GHz 八核Intel Core i9）macOS Sonoma 14.4 (23E214)EasyConnect_7_6_7_4 安装背景 在公司内网访问过程中，需使用VPN。但在下载并尝试使用EasyConnect时，发现应用打开后无反应。即便通过网页登录，应用也会不断重启，严重影响了电脑的正常使用。考虑到EasyConnect的口碑及可能存在的安全风险，我决定采用一种更安全的方式——使用docker来部署EasyConnect。在网上找到一个使用docker部署EasyConnect的方案，尽管在搭建过程中遇到了不少问题，但最终还是成功解决了。以下是我的经验分享，希望对遇到类似问题的朋友有所帮助。
需要准备的工具 Docker：开源的容器引擎，对于开发者来说相当熟悉。可以从其官网下载。docker-easyconnect：让深信服的 VPN 软件 EasyConnect 或 aTrust 运行在 docker
中，提供 socks5 和 http代理服务和网关供宿主机连接使用。软件使用可以项目地址找到。VNC Viewer：远程桌面控制软件。当登录VPN需要图形验证码或手机验证码时，此软件尤为有用，可在下载地址获取软件。如果只需密码就可以登录，请忽略本软件。Clash：代理客户端，我使用的是clash-verge-rev（v1.5.8），可从下载地址获取。Proxy SwitchyOmega：Chrome代理插件，如果只浏览器访问特定代理地址时，推荐使用此插件，操作更为简便。 使用方法： 首先，安装Docker，然后下载并运行docker-easyconnect的镜像。运行成功后，将提供socks5和http代理服务及网关，供宿主机连接使用。接着，通过代理插件或Clash代理，即可实现访问内网地址。
具体操作 1.安装docker-easyconnect 1.1纯命令行版 EasyConnect（amd64 架构） 注意，纯命令行版本仅支持以下登录方式：用户名&#43;密码、硬件特征码。
安装Docker并运行；在终端输入： docker run --rm --device /dev/net/tun --cap-add NET_ADMIN -ti -p 127.0.0.1:1080:1080 -p 127.0.0.1:8888:8888 -e EC_VER=7.6.3 -e CLI_OPTS=&#34;-d vpnaddress -u username -p password&#34;">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-05-07T14:53:38+08:00">
    <meta property="article:modified_time" content="2024-05-07T14:53:38+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">纯净化安装EasyConnect：macOS Sonoma使用docker安装EasyConnect---docker-easyconnect</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>macOS Sonoma使用docker安装EasyConnect</h4> 
 <ul><li><a href="#_1" rel="nofollow">硬软件配置以及安装背景</a></li><li><ul><li><a href="#_2" rel="nofollow">硬软件配置</a></li><li><a href="#_7" rel="nofollow">安装背景</a></li></ul> 
  </li><li><a href="#_9" rel="nofollow">需要准备的工具</a></li><li><a href="#_16" rel="nofollow">使用方法：</a></li><li><a href="#_19" rel="nofollow">具体操作</a></li><li><ul><li><a href="#1dockereasyconnect_20" rel="nofollow">1.安装docker-easyconnect</a></li><li><ul><li><a href="#11_EasyConnectamd64__21" rel="nofollow">1.1纯命令行版 EasyConnect（amd64 架构）</a></li><li><a href="#12_EasyConnectx86amd64arm64mips64el__34" rel="nofollow">1.2图形界面版 EasyConnect（x86、amd64、arm64、mips64el 架构）</a></li></ul> 
   </li><li><a href="#2vpn_59" rel="nofollow">2.登录vpn</a></li><li><ul><li><a href="#1web_60" rel="nofollow">1.使用web登录</a></li><li><a href="#2VNC_Viewer_70" rel="nofollow">2.使用VNC Viewer登录</a></li><li><a href="#3_79" rel="nofollow">3.使用命令行进行登录</a></li></ul> 
   </li><li><a href="#_81" rel="nofollow">代理</a></li><li><ul><li><a href="#1Proxy_SwitchyOmega_82" rel="nofollow">1.使用Proxy SwitchyOmega进行代理</a></li><li><a href="#2clash_92" rel="nofollow">2.使用clash进行代理</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_100" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>硬软件配置以及安装背景</h2> 
<h3><a id="_2"></a>硬软件配置</h3> 
<ul><li>MacBook Pro（2.4 GHz 八核<strong>Intel</strong> Core i9）</li><li>macOS Sonoma 14.4 (23E214)</li><li>EasyConnect_7_6_7_4</li></ul> 
<h3><a id="_7"></a>安装背景</h3> 
<p>在公司内网访问过程中，需使用VPN。但在下载并尝试使用EasyConnect时，发现应用打开后无反应。即便通过网页登录，应用也会不断重启，严重影响了电脑的正常使用。考虑到EasyConnect的口碑及可能存在的安全风险，我决定采用一种更安全的方式——使用docker来部署EasyConnect。在网上找到一个使用docker部署EasyConnect的方案，尽管在搭建过程中遇到了不少问题，但最终还是成功解决了。以下是我的经验分享，希望对遇到类似问题的朋友有所帮助。</p> 
<h2><a id="_9"></a>需要准备的工具</h2> 
<ul><li>Docker：开源的容器引擎，对于开发者来说相当熟悉。可以从其<a href="https://www.docker.com/products/docker-desktop/" rel="nofollow">官网下载</a>。</li><li>docker-easyconnect：让深信服的 VPN 软件 EasyConnect 或 aTrust 运行在 docker<br> 中，提供 socks5 和 http代理服务和网关供宿主机连接使用。软件使用可以<a href="https://github.com/docker-easyconnect/docker-easyconnect">项目地址</a>找到。</li><li>VNC Viewer：远程桌面控制软件。当登录VPN需要图形验证码或手机验证码时，此软件尤为有用，可在<a href="https://www.realvnc.com/en/connect/download/viewer/macos/" rel="nofollow">下载地址</a>获取软件。如果只需密码就可以登录，请忽略本软件。</li><li>Clash：代理客户端，我使用的是clash-verge-rev（v1.5.8），可从<a href="https://github.com/clash-verge-rev/clash-verge-rev/tags">下载地址</a>获取。</li><li>Proxy SwitchyOmega：Chrome代理插件，如果只浏览器访问特定代理地址时，推荐使用此插件，操作更为简便。</li></ul> 
<h2><a id="_16"></a>使用方法：</h2> 
<p>首先，安装Docker，然后下载并运行docker-easyconnect的镜像。运行成功后，将提供socks5和http代理服务及网关，供宿主机连接使用。接着，通过代理插件或Clash代理，即可实现访问内网地址。</p> 
<h2><a id="_19"></a>具体操作</h2> 
<h3><a id="1dockereasyconnect_20"></a>1.安装docker-easyconnect</h3> 
<h4><a id="11_EasyConnectamd64__21"></a>1.1纯命令行版 EasyConnect（amd64 架构）</h4> 
<p>注意，纯命令行版本仅支持以下登录方式：<strong>用户名+密码、硬件特征码。</strong></p> 
<ul><li><a href="https://docs.docker.com/get-docker/" rel="nofollow">安装Docker并运行；</a></li><li>在终端输入：</li></ul> 
<pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> <span class="token parameter variable">--device</span> /dev/net/tun --cap-add NET_ADMIN <span class="token parameter variable">-ti</span> <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:1080:1080 <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:8888:8888 <span class="token parameter variable">-e</span> <span class="token assign-left variable">EC_VER</span><span class="token operator">=</span><span class="token number">7.6</span>.3 <span class="token parameter variable">-e</span> <span class="token assign-left variable">CLI_OPTS</span><span class="token operator">=</span><span class="token string">"-d vpnaddress -u username -p password"</span> hagb/docker-easyconnect:cli
</code></pre> 
<p>其中 -e EC_VER=7.6.7 表示使用 7.6.7 版本的 EasyConnect，请根据实际情况修改版本号（选择 7.6.7 或 7.6.3，详见 <a href="https://github.com/docker-easyconnect/docker-easyconnect/blob/master/doc/usage.md#easyconnect-%E7%89%88%E6%9C%AC%E9%80%89%E6%8B%A9">EasyConnect 版本选择</a>）；</p> 
<ul><li>根据提示输入服务器地址、登录凭据。<br> 对于需要短信验证码或图形验证码的登录方式，此版本可能无法满足需求。因此，下面将介绍图形界面版的安装方式。</li></ul> 
<h4><a id="12_EasyConnectx86amd64arm64mips64el__34"></a>1.2图形界面版 EasyConnect（x86、amd64、arm64、mips64el 架构）</h4> 
<p><a href="https://docs.docker.com/get-docker/" rel="nofollow">安装Docker并运行；</a><br> 在终端输入：</p> 
<pre><code class="prism language-bash"> <span class="token function">docker</span> run <span class="token parameter variable">--rm</span> <span class="token parameter variable">--device</span> /dev/net/tun --cap-add NET_ADMIN <span class="token parameter variable">-ti</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">PASSWORD</span><span class="token operator">=</span>xxxx <span class="token parameter variable">-e</span> <span class="token assign-left variable">URLWIN</span><span class="token operator">=</span><span class="token number">1</span>  <span class="token parameter variable">-e</span> <span class="token assign-left variable">IPTABLES_LEGACY</span><span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">-v</span> <span class="token environment constant">$HOME</span>/.ecdata:/root <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:5901:5901 <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:21080:1080 <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:28888:8888 <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:54530:54530  <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:54631:54631   hagb/docker-easyconnect:7.6.7
</code></pre> 
<p>末尾 EasyConnect 版本号 7.6.7 请根据实际情况修改；arm64 和 mips64el 架构需要加入 -e DISABLE_PKG_VERSION_XML=1 参数；<br> 这是一个使用 Docker 运行 EasyConnect VPN 客户端的命令，下面是各个参数的解释：</p> 
<table><thead><tr><th>项目</th><th>Value</th></tr></thead><tbody><tr><td>docker run</td><td>这是 Docker 的基本命令，用于运行一个新的容器。</td></tr><tr><td>–rm</td><td>运行容器后，容器执行完毕会自动删除。调试完成后，<strong>这个参数后期要删除</strong>。</td></tr><tr><td>–device /dev/net/tun</td><td>让容器可以直接使用宿主机上的 /dev/net/tun 设备。这在需要在容器中建立网络隧道时是必须的。</td></tr><tr><td>–cap-add NET_ADMIN</td><td><strong>是不可少的。 因为 VPN 要创建 tun 网络接口</strong>。为容器添加NET_ADMIN能力，这允许容器管理网络设置，例如设置IP地址、路由等。</td></tr><tr><td>-ti</td><td>这是两个参数 -t 和 -i 的组合。参数 -t 分配一个伪终端或终端，并且 -i 让容器的标准输入保持开启。</td></tr><tr><td>-e PASSWORD=xxxx</td><td>设置容器内的环境变量 PASSWORD 的值为 xxxx。使用VNC时要输入这个密码，可以自行设置自己常用的密码。</td></tr><tr><td>-e URLWIN=1</td><td>默认为空，此时当 VPN 前端想要调用浏览器时，不会弹窗，若该变量设为任何非空值，则会弹出一个包含链接的对话框供用户复制。</td></tr><tr><td>-e IPTABLES_LEGACY=1 -</td><td>默认为空。设为非空值时强制要求 <code>iptables-legacy</code>。使用旧式的 iptables 命令，主要目的是和 WSL 保持兼容。在部分发行版的 WSL 版本上，缺少了这个环境变量会使得 VPN 不能正常运行。（非必要不选）</td></tr><tr><td>-v $HOME/.ecdata:/root</td><td>挂载宿主机的 $HOME/.ecdata 目录到容器的 /root 目录。这样，容器可以访问宿主机上的这个目录，并且任何在容器中对这个目录的修改都会反映到宿主机上。</td></tr><tr><td>-p 127.0.0.1:5901:5901</td><td><code>5901</code> 端口开启 VNC 服务器，VNC连接使用这个接口。第一个端口是宿主机的端口，如果被占用改一个没被占用的端口即可。</td></tr><tr><td>-p 127.0.0.1:21080:1080</td><td>Socks5 代理端口。Clash和 Proxy SwitchyOmega走Socks5代理时要配置的端口。</td></tr><tr><td>-p 127.0.0.1:28888:8888</td><td>HTTP 代理端口；</td></tr><tr><td>-p 127.0.0.1:54530:54530</td><td>将容器的 <code>54530</code>（EasyConnect）端口映射到宿主机，之后便可以在宿主机上打开 VPN 服务器的网页进行登录。</td></tr><tr><td>-p 127.0.0.1:54631:54631</td><td>将容器的 <code>54631</code>（aTrust） 端口映射到宿主机，之后便可以在宿主机上打开 VPN 服务器的网页进行登录。</td></tr><tr><td>hagb/docker-easyconnect:7.6.7</td><td>EasyConnect 版本号 7.6.7 请根据实际情况修改；</td></tr></tbody></table> 
<h3><a id="2vpn_59"></a>2.登录vpn</h3> 
<h4><a id="1web_60"></a>1.使用web登录</h4> 
<ul><li>参考1.2安装docker-easyconnect，使用EasyConnect需要开启54530端口，使用aTrust的开启54631。下面是我使用EasyConnect的命令:</li></ul> 
<pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> <span class="token parameter variable">--device</span> /dev/net/tun --cap-add NET_ADMIN <span class="token parameter variable">-ti</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">URLWIN</span><span class="token operator">=</span><span class="token number">1</span>  <span class="token parameter variable">-v</span> <span class="token environment constant">$HOME</span>/.ecdata:/root <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:21080:1080 <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:28888:8888 <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:54530:54530    hagb/docker-easyconnect:7.6.7         
</code></pre> 
<p><img src="https://images2.imgbox.com/42/64/GekMS1cH_o.png" alt="web登录安装命令"><br> 会有报错，忽略就好，不影响使用。</p> 
<ul><li>因为 EasyConnect 使用了一份自签证书，所以使用EasyConnect web 登录需要提前在相应浏览器打开<code>https://127.0.0.1:54530</code> 并选择忽略证书错误。</li><li>打开自己内网vpn登录地址，进行登录即可。</li></ul> 
<h4><a id="2VNC_Viewer_70"></a>2.使用VNC Viewer登录</h4> 
<ul><li>安装好远程桌面控制软件VNC Viewer，具体安装方法就不介绍了。</li><li>参考1.2安装docker-easyconnect，需要开启5901 端口来连接 VNC 服务器，如果宿主机的端口被占用，改一个没被占用的端口即可。下面是一个实例：</li></ul> 
<pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> <span class="token parameter variable">--device</span> /dev/net/tun --cap-add NET_ADMIN <span class="token parameter variable">-ti</span> <span class="token parameter variable">-e</span> <span class="token assign-left variable">PASSWORD</span><span class="token operator">=</span>xxxx <span class="token parameter variable">-e</span> <span class="token assign-left variable">URLWIN</span><span class="token operator">=</span><span class="token number">1</span>  <span class="token parameter variable">-e</span> <span class="token assign-left variable">IPTABLES_LEGACY</span><span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">-v</span> <span class="token environment constant">$HOME</span>/.ecdata:/root <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:5901:5901 <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:21080:1080 <span class="token parameter variable">-p</span> <span class="token number">127.0</span>.0.1:28888:8888    hagb/docker-easyconnect:7.6.7         
</code></pre> 
<ul><li>使用VNC Viewer进行连接：打开 VNC Viewer，点击左上角的 File -&gt; New connection，在弹出的对话框中的 VNC Server 中填入 127.0.0.1:5901 （宿主机的端口），Name 随便填一个。然后点击ok进行创建。<br> <img src="https://images2.imgbox.com/76/37/wFRI5c26_o.png" alt="在这里插入图片描述"></li><li>创建完成以后，双击打开，需要输入密码xxxx(安装docker-easyconnect时设置的密码)，然后就会跳出登录的界面，正常进行登录就行。</li></ul> 
<h4><a id="3_79"></a>3.使用命令行进行登录</h4> 
<p>参照1.1，这种只适用用户名密码登录的客户端。</p> 
<h3><a id="_81"></a>代理</h3> 
<h4><a id="1Proxy_SwitchyOmega_82"></a>1.使用Proxy SwitchyOmega进行代理</h4> 
<p>Proxy SwitchyOmega是一个Chrome的插件，如果使用代理只是为了浏览网页，建议使用这种方式。</p> 
<ul><li>在插件市场安装好插件后（当然这种插件会有很多，自己找一个可用的即可），打开插件的选项，首先配置代理服务器。</li></ul> 
<p><img src="https://images2.imgbox.com/87/05/tNFg0v8j_o.png" alt="在这里插入图片描述"></p> 
<ul><li>协议选<strong>Socks5</strong>，代理端口写<strong>宿主机</strong>的端口。</li><li>情景模式配置好规则，点击应用选项。<br> <img src="https://images2.imgbox.com/ce/34/aHQRL8gL_o.png" alt="在这里插入图片描述"></li><li>输入内网地址进行验证</li></ul> 
<h4><a id="2clash_92"></a>2.使用clash进行代理</h4> 
<p>docker run -d --restart=always --restart=on-failure --device /dev/net/tun --cap-add NET_ADMIN -ti -e URLWIN=1 -v $HOME/.ecdata:/root -p 127.0.0.1:21080:1080 -p 127.0.0.1:28888:8888 -p 127.0.0.1:54530:54530 hagb/docker-easyconnect:7.6.7</p> 
<p>-d：以后台模式运行容器。<br> –restart=always：容器退出时总是重启容器。<br> –restart=on-failure：容器退出时，如果退出状态码不为 0，则重启容器。</p> 
<h2><a id="_100"></a>总结</h2> 
<p>总结一下，纯净化安装EasyConnect一共三步，第一步是安装docker-easyconnect，第二步是登录vpn，第三步是使用代理软件进行代理转发。<br> 安装docker-easyconnect时，需要判断是否要使用图形化界面进行登录，如果需要参考2.1、2.2章节。<br> 登录vpn有三种方式，只需要用户名和密码就能登录的直接使用命令行进行登录。如果需要图形验证码，就需要使用web登录或者VNC Viewer登录，两种二选一即可。<br> 代理转发可以使用浏览器插件或者clash。浏览器插件的优点是简单，无需安装新软件。缺点是如果连接数据库，git等资源时无法代理，这时就需要使用clash。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/839489efbd822230315277f00e1191a2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C#WinForm连接sql server数据库进行增删改查详细步骤（包会）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7dc17b00f8a16948f5f8c7fe511fa9cf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">当AI遇见现实：数智化时代的人类社会新图景</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>