<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>本地搭建【文档助手】大模型版（LangChain&#43;llama&#43;Streamlit） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/e34f5dd8150b9ee6f76dbff510169b27/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="本地搭建【文档助手】大模型版（LangChain&#43;llama&#43;Streamlit）">
  <meta property="og:description" content="概述 本文的文档助手就是：我们上传一个文档，然后在对话框中输入问题，大模型会把问题的答案返回。
安装步骤 先下载代码到本地 LangChain调用llama模型的示例代码：https://github.com/afaqueumer/DocQA（代码不是本人写的，尊重原创）
git clone https://github.com/afaqueumer/DocQA.git 环境安装 双击 setup_env.bat 如果没反应可能是缺少环境，打开控制台手动执行一下，缺python或者pip的自己根据报错下载一下 如果llama-cpp-python安装报错
（1）需要下载Visual Studio
（2）打开Visual Studio，工具，获取工具和功能
（3）等待下载完，重新运行setup_env.bat
如果还有报错【error C2061: 语法错误:】，那么可能是Visual Studio的版本太低了，我一开始用的是2019版本，后来换成了2022
更新为2022之后重复上面操作
下载一个靠谱的模型
https://huggingface.co/TheBloke/Llama-2-7B-GGUF
本文用的是：TheBloke/Llama-2-7B-GGUF中的最精简版
进入DocQA，修改app.py 原始
llm = LlamaCpp(model_path=&#34;./models/llama-7b.ggmlv3.q4_0.bin&#34;) embeddings = LlamaCppEmbeddings(model_path=&#34;models/llama-7b.ggmlv3.q4_0.bin&#34;) 这里改成自己下载的模型地址，比如：llama-2-7b.Q2_K.gguf
llm = LlamaCpp(model_path=&#34;../llama.cpp/models/7B/llama-2-7b.Q2_K.gguf&#34;) embeddings = LlamaCppEmbeddings(model_path=&#34;../llama.cpp/models/7B/llama-2-7b.Q2_K.gguf&#34;) 运行 双击run_app.bat 测试 准备好一个txt文档
As of October this year, there were nearly 2,500 geographical indication products in China The reporter learned from the State Intellectual Property Office that in recent years, the quantity and quality of China&#39;s geographical indication products have risen rapidly.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-24T18:34:13+08:00">
    <meta property="article:modified_time" content="2023-12-24T18:34:13+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">本地搭建【文档助手】大模型版（LangChain&#43;llama&#43;Streamlit）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>概述</h2> 
<p>本文的文档助手就是：我们上传一个文档，然后在对话框中输入问题，大模型会把问题的答案返回。</p> 
<h2><a id="_2"></a>安装步骤</h2> 
<ol><li>先下载代码到本地</li></ol> 
<p>LangChain调用llama模型的示例代码：https://github.com/afaqueumer/DocQA（代码不是本人写的，尊重原创）</p> 
<pre><code class="prism language-java">git clone https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>afaqueumer<span class="token operator">/</span><span class="token class-name">DocQA</span><span class="token punctuation">.</span>git
</code></pre> 
<ol start="2"><li>环境安装</li></ol> 
<pre><code class="prism language-java">双击 setup_env<span class="token punctuation">.</span>bat
</code></pre> 
<ul><li>如果没反应可能是缺少环境，打开控制台手动执行一下，缺python或者pip的自己根据报错下载一下</li></ul> 
<p>如果<strong>llama-cpp-python安装报错</strong><br> （1）需要下载Visual Studio<br> （2）打开Visual Studio，工具，获取工具和功能<br> <img src="https://images2.imgbox.com/d7/6d/a011BDEk_o.png" alt="请添加图片描述"><br> （3）等待下载完，重新运行setup_env.bat</p> 
<p>如果还有报错【<strong>error C2061: 语法错误:</strong>】，那么可能是Visual Studio的版本太低了，我一开始用的是2019版本，后来换成了2022<br> <img src="https://images2.imgbox.com/a5/55/eHEPVzWI_o.png" alt="在这里插入图片描述"><br> 更新为2022之后重复上面操作</p> 
<ol start="3"><li>下载一个靠谱的模型<br> https://huggingface.co/TheBloke/Llama-2-7B-GGUF<br> 本文用的是：TheBloke/Llama-2-7B-GGUF中的最精简版<br> <img src="https://images2.imgbox.com/94/c4/suGP1ioN_o.png" alt="在这里插入图片描述"></li><li>进入DocQA，修改app.py</li></ol> 
<p>原始</p> 
<pre><code class="prism language-java">llm <span class="token operator">=</span> <span class="token class-name">LlamaCpp</span><span class="token punctuation">(</span>model_path<span class="token operator">=</span><span class="token string">"./models/llama-7b.ggmlv3.q4_0.bin"</span><span class="token punctuation">)</span>
embeddings <span class="token operator">=</span> <span class="token class-name">LlamaCppEmbeddings</span><span class="token punctuation">(</span>model_path<span class="token operator">=</span><span class="token string">"models/llama-7b.ggmlv3.q4_0.bin"</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里改成自己下载的模型地址，比如：llama-2-7b.Q2_K.gguf</p> 
<pre><code class="prism language-java">llm <span class="token operator">=</span> <span class="token class-name">LlamaCpp</span><span class="token punctuation">(</span>model_path<span class="token operator">=</span><span class="token string">"../llama.cpp/models/7B/llama-2-7b.Q2_K.gguf"</span><span class="token punctuation">)</span>
embeddings <span class="token operator">=</span> <span class="token class-name">LlamaCppEmbeddings</span><span class="token punctuation">(</span>model_path<span class="token operator">=</span><span class="token string">"../llama.cpp/models/7B/llama-2-7b.Q2_K.gguf"</span><span class="token punctuation">)</span>
</code></pre> 
<ol start="5"><li>运行</li></ol> 
<pre><code class="prism language-java">双击run_app<span class="token punctuation">.</span>bat
</code></pre> 
<p><img src="https://images2.imgbox.com/80/d1/TN28xwlP_o.png" alt="在这里插入图片描述"></p> 
<ol start="6"><li>测试</li></ol> 
<p>准备好一个txt文档</p> 
<pre><code class="prism language-java"><span class="token class-name">As</span> of <span class="token class-name">October</span> <span class="token keyword">this</span> year<span class="token punctuation">,</span> there were nearly <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">500</span> geographical indication products in <span class="token class-name">China</span>
<span class="token class-name">The</span> reporter learned from the <span class="token class-name">State</span> <span class="token class-name">Intellectual</span> <span class="token class-name">Property</span> <span class="token class-name">Office</span> that in recent years<span class="token punctuation">,</span> the quantity and quality of <span class="token class-name">China</span>'s geographical indication products have risen <span class="token class-name"><span class="token namespace">rapidly<span class="token punctuation">.</span></span> As</span> of <span class="token class-name">October</span> <span class="token keyword">this</span> year<span class="token punctuation">,</span> <span class="token class-name">China</span> has approved a total of <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">495</span> geographical indication products<span class="token punctuation">,</span> and approved <span class="token number">7</span><span class="token punctuation">,</span><span class="token number">013</span> geographical indications <span class="token keyword">to</span> <span class="token namespace">be</span> registered as collective trademarks and certification <span class="token class-name"><span class="token namespace">trademarks<span class="token punctuation">.</span></span> In</span> <span class="token number">2021</span><span class="token punctuation">,</span> the direct output value of <span class="token constant">GI</span> products exceeded <span class="token number">700</span> billion <span class="token class-name"><span class="token namespace">yuan<span class="token punctuation">.</span></span>
In</span> recent years<span class="token punctuation">,</span> the <span class="token class-name">State</span> <span class="token class-name">Intellectual</span> <span class="token class-name">Property</span> <span class="token class-name">Office</span> has conscientiously implemented the decisions and arrangements of the <span class="token constant">CPC</span> <span class="token class-name">Central</span> <span class="token class-name">Committee</span> and the <span class="token class-name">State</span> <span class="token class-name">Council</span><span class="token punctuation">,</span> actively and steadily promoted the unified acceptance channels<span class="token punctuation">,</span> unified special signs<span class="token punctuation">,</span> unified announcements<span class="token punctuation">,</span> unified protection and supervision<span class="token punctuation">,</span> unified foreign cooperation and other work<span class="token punctuation">,</span> and further improved the system of protection<span class="token punctuation">,</span> management and application of geographical <span class="token class-name"><span class="token namespace">indications<span class="token punctuation">.</span></span>
In</span> terms of institutional construction<span class="token punctuation">,</span> the <span class="token class-name">State</span> <span class="token class-name">Intellectual</span> <span class="token class-name">Property</span> <span class="token class-name">Office</span> issued the <span class="token string">"14th Five-Year Plan for the Protection and Use of Geographical Indications"</span><span class="token punctuation">,</span> formulated and issued a unified special indication <span class="token keyword">for</span> geographical indications<span class="token punctuation">,</span> revised and issued the <span class="token string">"Measures for the Protection of Foreign Geographical Indication Products"</span><span class="token punctuation">,</span> and launched the legislative work on geographical indications<span class="token punctuation">;</span> <span class="token class-name">In</span> the year<span class="token punctuation">,</span> a total of <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">416</span> cases of infringement of geographical indications were investigated and dealt <span class="token keyword">with</span> <span class="token namespace">across</span> the country<span class="token punctuation">,</span> involving an amount of <span class="token number">9.28</span> million yuan and a fine of <span class="token number">13.023</span> million yuan
</code></pre> 
<p>上传到页面中<br> <img src="https://images2.imgbox.com/c0/cf/62ZjK7C6_o.png" alt="在这里插入图片描述"><br> 没有GPU的痛苦，运行太慢了</p> 
<p>注意：别用中文问，这个模型好像不支持中文，换一个支持中文的模型就行了<br> <img src="https://images2.imgbox.com/d0/60/GsciTnNN_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c9b14e9c1e55a6e4fcccec75f088c515/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于llama-index对embedding模型进行微调</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e3a289ae98ec1ee56d30c7b8a8e33d8b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Springboot文件下载方式（直接下载）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>