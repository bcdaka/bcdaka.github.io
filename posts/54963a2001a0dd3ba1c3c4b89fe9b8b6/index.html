<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ctfshow-web入门-php特性（web127-web131） - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/54963a2001a0dd3ba1c3c4b89fe9b8b6/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="ctfshow-web入门-php特性（web127-web131）">
  <meta property="og:description" content="目录
1、web127
2、web128
3、web129
4、web130
5、web131
1、web127 代码审计：
$ctf_show = md5($flag); 将 $flag 变量进行 MD5 哈希运算，并将结果赋值给 $ctf_show。 $url = $_SERVER[&#39;QUERY_STRING&#39;]; 获取当前请求的查询字符串（query string），查询字符串是 URL 中位于问号 (?) 之后的部分，通常包含一个或多个参数和值。 之后对查询字符串采用正则匹配过滤掉了一些符号，符合要求则会将 $_GET 数组中的键值对作为变量导入到当前的符号表中。换句话说，extract($_GET); 会将 URL 查询参数中的每个键值对转换成同名的变量。
最后要求 $ctf_show===&#39;ilove36d&#39; 就会输出 flag。
由于下划线被过滤掉了，我们采用非法字符参数名转换绕过，payload：
?ctf show=ilove36d 原本空格、点都是非法的，中括号也是可行的，但是中括号和点被过滤了，因此这里使用空格。 2、web128 代码审计：
check($str) 函数检查字符串 $str 是否包含数字或字母，如果包含，返回 false，否则返回 true。
也就是说传入的 f1 不能包含大小写字母和数字。
var_dump(call_user_func(call_user_func($f1,$f2))); call_user_func 函数：用于调用指定的回调函数，并可以传递参数给该回调函数，第一个参数是被调用的回调函数，其余参数是回调函数的参数。
这里还进行了嵌套：
（1）内层 call_user_func($f1, $f2)
首先调用 $f1 函数，并传递参数 $f2，结果是 $f1($f2) 的返回值。
（2）外层 call_user_func(...)
外层 call_user_func 接收内层调用的返回值作为它的第一个参数，要正确执行，内层返回值应该是一个函数名或可调用的回调，外层 call_user_func 将再次调用这个返回的回调函数，不传递任何额外的参数。">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-17T14:40:10+08:00">
    <meta property="article:modified_time" content="2024-07-17T14:40:10+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ctfshow-web入门-php特性（web127-web131）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="1%E3%80%81web127-toc" style="margin-left:0px;"><a href="#1%E3%80%81web127" rel="nofollow">1、web127</a></p> 
<p id="2%E3%80%81web128-toc" style="margin-left:0px;"><a href="#2%E3%80%81web128" rel="nofollow">2、web128</a></p> 
<p id="3%E3%80%81web129-toc" style="margin-left:0px;"><a href="#3%E3%80%81web129" rel="nofollow">3、web129</a></p> 
<p id="4%E3%80%81web130-toc" style="margin-left:0px;"><a href="#4%E3%80%81web130" rel="nofollow">4、web130</a></p> 
<p id="5%E3%80%81web131-toc" style="margin-left:0px;"><a href="#5%E3%80%81web131" rel="nofollow">5、web131</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="1%E3%80%81web127">1、web127</h2> 
<p><img alt="" height="968" src="https://images2.imgbox.com/b3/df/6QhusizD_o.png" width="1200"></p> 
<p>代码审计：</p> 
<pre><code class="hljs">$ctf_show = md5($flag);</code></pre> 
<p>将 $flag 变量进行 MD5 哈希运算，并将结果赋值给 $ctf_show。 </p> 
<pre><code class="hljs">$url = $_SERVER['QUERY_STRING'];</code></pre> 
<p>获取当前请求的查询字符串（query string），查询字符串是 URL 中位于问号 (?) 之后的部分，通常包含一个或多个参数和值。 </p> 
<p>之后对查询字符串采用正则匹配过滤掉了一些符号，符合要求则会将 $_GET 数组中的键值对作为变量导入到当前的符号表中。换句话说，extract($_GET); 会将 URL 查询参数中的每个键值对转换成同名的变量。</p> 
<p>最后要求 $ctf_show==='ilove36d' 就会输出 flag。</p> 
<p>由于下划线被过滤掉了，我们采用非法字符参数名转换绕过，payload：</p> 
<pre><code class="hljs">?ctf show=ilove36d</code></pre> 
<p>原本空格、点都是非法的，中括号也是可行的，但是中括号和点被过滤了，因此这里使用空格。 </p> 
<p><img alt="" height="736" src="https://images2.imgbox.com/fa/96/ILzs1ddf_o.png" width="1200"></p> 
<p></p> 
<h2 id="2%E3%80%81web128" style="background-color:transparent;">2、web128</h2> 
<p><img alt="" height="778" src="https://images2.imgbox.com/eb/36/LFQW5jZT_o.png" width="1200"></p> 
<p>代码审计：</p> 
<p>check($str) 函数检查字符串 $str 是否包含数字或字母，如果包含，返回 false，否则返回 true。</p> 
<p>也就是说传入的 f1 不能包含大小写字母和数字。</p> 
<pre><code class="hljs">var_dump(call_user_func(call_user_func($f1,$f2)));</code></pre> 
<p>call_user_func 函数：用于调用指定的回调函数，并可以传递参数给该回调函数，第一个参数是被调用的回调函数，其余参数是回调函数的参数。</p> 
<p>这里还进行了嵌套：</p> 
<p>（1）内层 call_user_func($f1, $f2)</p> 
<p>首先调用 $f1 函数，并传递参数 $f2，结果是 $f1($f2) 的返回值。</p> 
<p>（2）外层 call_user_func(...)</p> 
<p>外层 call_user_func 接收内层调用的返回值作为它的第一个参数，要正确执行，内层返回值应该是一个函数名或可调用的回调，外层 call_user_func 将再次调用这个返回的回调函数，不传递任何额外的参数。</p> 
<p>最后，var_dump 将打印出外层 call_user_func 的返回值。</p> 
<p><strong>新知识：gettext 函数</strong></p> 
<p>php 扩展目录下如果有 php_gettext.dll，就可以用 _() 来代替 gettext() 函数，_() 就是 gettext() 的别名，常常被用来简化代码。</p> 
<p>gettext 函数用于在 PHP 应用程序中实现国际化（i18n）和本地化（l10n），说白了就是根据当前语言环境输出翻译后的字符串。</p> 
<p>我们测一下 phpinfo，payload：</p> 
<pre><code class="hljs">?f1=_&amp;f2=phpinfo</code></pre> 
<p><img alt="" height="703" src="https://images2.imgbox.com/0a/4e/vuOWayWS_o.png" width="1200"></p> 
<p>那么我们如何输出 $flag 呢？</p> 
<p>使用 get_defined_vars() 函数，该函数会返回由所有已定义变量所组成的数组，其中肯定就包括了 $flag，payload：</p> 
<pre><code class="hljs">?f1=_&amp;f2=get_defined_vars</code></pre> 
<p><img alt="" height="743" src="https://images2.imgbox.com/d5/c1/3E6AeDZf_o.png" width="1200"></p> 
<p>拿到 flag：ctfshow{d7ac7aa1-12c0-4813-8671-786cc26a35d1}</p> 
<p></p> 
<h2 id="3%E3%80%81web129" style="background-color:transparent;">3、web129</h2> 
<p><img alt="" height="550" src="https://images2.imgbox.com/68/1e/57vjfA3A_o.png" width="964"></p> 
<p>stripos 函数：查找字符串在另一字符串中第一次出现的位置（不区分大小写）。</p> 
<p>用法：stripos(<em>string,find,start</em>)</p> 
<table><tbody><tr><th>参数</th><th>描述</th></tr><tr><td><em>string</em></td><td>必需。规定被搜索的字符串。</td></tr><tr><td><em>find</em></td><td>必需。规定要查找的字符。</td></tr><tr><td><em>start</em></td><td>可选。规定开始搜索的位置。</td></tr></tbody></table> 
<p> 代码审计：</p> 
<p>如果变量 $f 包含子字符串 'ctfshow'，并且位置大于 0，</p> 
<p>就会调用 readfile 函数读取文件内容并输出。</p> 
<p>看了一下提示，不太清楚这里这个 ctfshow 目录是猜出来的？payload：</p> 
<pre><code class="hljs">?f=/ctfshow/../../../../var/www/html/flag.php</code></pre> 
<p>然后又试了一下，穿一层其实就到了根目录：</p> 
<pre><code class="hljs">?f=/ctfshow/../var/www/html/flag.php</code></pre> 
<p>查看源码： </p> 
<p><img alt="" height="956" src="https://images2.imgbox.com/9d/e3/vuQLj8T5_o.png" width="1200"></p> 
<p>拿到 flag：ctfshow{eeabef32-301f-4abe-a668-69e458e8ef80}</p> 
<p></p> 
<p>此外还参考了师傅们的其他方法：</p> 
<p>（1）利用 filter 伪协议支持多种编码方式，而无效的编码方式就被忽略掉了</p> 
<p>payload：</p> 
<pre><code class="hljs">?f=php://filter/convert.iconv.utf8.utf16|ctfshow/resource=flag.php</code></pre> 
<p><img alt="" height="792" src="https://images2.imgbox.com/ad/5c/s8DbAD8h_o.png" width="1200"></p> 
<p>（2）远程文件包含</p> 
<p>错误示范：</p> 
<p>这里我直接将文件命名为 ctfshow.php</p> 
<p><img alt="" height="106" src="https://images2.imgbox.com/25/66/b2SRkj3z_o.png" width="416">】</p> 
<p>内容如下，先测一下 phpinfo：</p> 
<p><img alt="" height="150" src="https://images2.imgbox.com/c1/a6/PqJbgbOi_o.png" width="325"></p> 
<p>包含解析成功</p> 
<p><img alt="" height="777" src="https://images2.imgbox.com/da/68/SBfa5FDz_o.png" width="1200"></p> 
<p>试了下命令执行：</p> 
<p><img alt="" height="107" src="https://images2.imgbox.com/2d/2c/z1BMFVuK_o.png" width="491"></p> 
<p>返回 0，可能位置没对（还试了 /var/www/html/flag.php 也没有成功）</p> 
<p><img alt="" height="229" src="https://images2.imgbox.com/05/8c/Iog7Gcg4_o.png" width="479"></p> 
<p>再试一下一句话木马：</p> 
<p><img alt="" height="113" src="https://images2.imgbox.com/d4/12/HhafyJh6_o.png" width="412"></p> 
<p>执行成功</p> 
<p><img alt="" height="791" src="https://images2.imgbox.com/bc/86/wCh1bm9C_o.png" width="1200"></p> 
<p>看了下当前确实是在 html 下，但是无法查看上一层目录的文件</p> 
<p><img alt="" height="241" src="https://images2.imgbox.com/d2/de/y7HnSrAA_o.png" width="436"></p> 
<p>后面才发现，我这里调用的就是我自己服务器上的木马，回显的内容也是我服务器里面的东西，并没有搞到题目环境里面去。</p> 
<p>应该将一句话木马写为 txt 后缀：</p> 
<p><img alt="" height="724" src="https://images2.imgbox.com/d7/0c/tQrFR8ix_o.png" width="1200"></p> 
<p>包含进去了但是调用不成功</p> 
<p><img alt="" height="232" src="https://images2.imgbox.com/85/a3/LUOcPvEL_o.png" width="428"></p> 
<p>还是说不是这样来的，不太会这个，知道怎么来的师傅可以讲解一下，谢谢。</p> 
<p><img alt="" height="770" src="https://images2.imgbox.com/6a/f4/OdzKXiUl_o.png" width="1200"></p> 
<p></p> 
<h2 id="4%E3%80%81web130">4、web130</h2> 
<p><img alt="" height="633" src="https://images2.imgbox.com/6d/29/TswfIaQ0_o.png" width="1022"></p> 
<p>晃眼一看是不能匹配到 'ctfshow'，仔细一看：+? 这部分是一个非贪婪模式的匹配，匹配任意单个字符（除了换行符），+ 表示匹配前面的字符一次或多次，? 表示尽可能少地匹配字符，避免匹配过多。换句话说只是要求 ctfshow 前面不能有字符。</p> 
<p>但是下面 stripos 函数又要求 'ctfshow' 不能出现开头，不过仔细一看，这里是强等于，会先比较类型，<strong>stripos 函数如果未发现字符串会返回 FALSE</strong>，但是这里是可以找到字符串 ctfshow 的，因此返回字符串第一次出现的位置，尽管 stripos 函数返回 0 ，但是与 FALSE 进行强比较时还是会返回 false，因为 0 表示整数值的零，FALSE 表示布尔值的假，数据类型不同，也就是说 if 语句还是不会成立，走的是输出 flag。</p> 
<p><img alt="" height="515" src="https://images2.imgbox.com/32/6c/9am6BAvR_o.png" width="936"></p> 
<p>只有弱比较时才是相等的：</p> 
<p><img alt="" height="541" src="https://images2.imgbox.com/94/9a/JyFTUi5a_o.png" width="1003"></p> 
<p>payload：</p> 
<pre><code class="hljs">f=ctfshow</code></pre> 
<p><img alt="" height="805" src="https://images2.imgbox.com/09/d3/9NzGLUp9_o.png" width="1180"></p> 
<p>拿到 flag：ctfshow{9d0c4a57-e9a2-4d7f-9328-ec30e5508eef}</p> 
<p>还可以使用数组绕过：</p> 
<pre><code class="language-php">f[]=111</code></pre> 
<p><img alt="" height="781" src="https://images2.imgbox.com/be/38/wx5IBrGy_o.png" width="1181"></p> 
<p></p> 
<h2 id="5%E3%80%81web131">5、web131</h2> 
<p><img alt="" height="596" src="https://images2.imgbox.com/5a/e7/y0xoEvDw_o.png" width="1147"></p> 
<p>这里既要求 ctfshow 前面不能有字符，但又要求得找到字符串 36Dctfshow。</p> 
<p>利用 preg_match 的回溯绕过，回溯次数默认上限是 100 万。</p> 
<p>先生成一百万个字符：</p> 
<pre><code class="language-php">&lt;?php

// 设置生成字符串的长度
$length = 1000000;

// 生成包含一百万个数字 "1" 的字符串
$onesString = str_repeat('1', $length);

// 输出结果
echo $onesString;

?&gt;
</code></pre> 
<p><img alt="" height="882" src="https://images2.imgbox.com/58/4f/FwbPuuLX_o.png" width="1200"> payload：</p> 
<pre><code class="language-php">f=100万个字符加上36Dctfshow</code></pre> 
<p><img alt="" height="963" src="https://images2.imgbox.com/ef/14/9BYYoTYU_o.png" width="1200"></p> 
<p>拿到 flag：ctfshow{cc7a5bff-350e-4f22-863b-e604a2679ecf}</p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e7047acbd5a380bdac4c7046918d9c5e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言中for、while、do while、break、continue、goto的使用方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/46a06b6cc89f17f0bd10dc4306c5708e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">免费开源 | AI绘画 数字人工具合集大放送！六款超强AI数字人工具使用测评！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>