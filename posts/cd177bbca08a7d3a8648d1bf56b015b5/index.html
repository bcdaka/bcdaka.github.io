<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Yolopose关键点检测：自己标注数据集，制作数据集(一) - 编程大咖</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://bcdaka.github.io/posts/cd177bbca08a7d3a8648d1bf56b015b5/">
  <meta property="og:site_name" content="编程大咖">
  <meta property="og:title" content="Yolopose关键点检测：自己标注数据集，制作数据集(一)">
  <meta property="og:description" content="前言 最近实习需要搞的工程涉及到姿态估计，对这2天的学习做一下总结归纳，第一步就是准备数据集，查资料后发现window环境下使用的标注软件就是labelme（coco-annotator好像就可以直接输出coco格式的JSON文件，后期继续学习），labelme产出的JSON文件需要转换到coco格式的JSON文件，然后将JSON文件转成Yolo需要的txt文件，才能送工程进行训练，转来转去的个人感觉非常麻烦。
本博文主要内容是分享关键点的labelme2coco——JSON文件转换，cocoJSON2cocotxt的转换，以及coco_kpts文件夹的内容布局。
一、labelme标注关键点的使用： 用labelme标注关键点与后续的labelme2coco转换代码息息相关，假设标注对象是人体，关键点有17个：“nose”,“left_eye”, “right_eye”,“left_ear”, “right_ear”,“left_shoulder”, “right_shoulder”,“left_elbow”, “right_elbow”,“left_wrist”, “right_wrist”,“left_hip”, “right_hip”,“left_knee”, “right_knee”,“left_ankle”, “right_ankle”，label编号从1依次排到17，然后再把人用rectangle框出来label编号为bbox(Yolopose是需要画框的，并且numclass已经固定好了为person)，所有的Group id都不用写，JSON文件会自动补上null但不影响我们后续操作，填写label及Group id的界面如下图所示：
选取一张图片，把17个关键点都标注出来，再把人框出来，如果对象显示半个身体，不满17个关键点，也无所谓，没有哪个部位就把那个部位标注数值空出来就可以了，一张图片操作结束后，就如下图所示：
coco图片的格式是12位数字，标注完后的JSON文件用相同的名称命名即可。
二、labelme2coco_keypoints.py CSDN上的其他转换代码，我都没法直接跑，也没有相关的讲解，于是我就拿了现有的代码修改了一些，并记录了我的学习过程。先介绍一下哪些部分需要修改的，然后在附上整个代码，以17个人体关键点标注好的JSON文件为例。
&#34;keypoints&#34;:#这是固定的，要是其他的关键点标注，则需要修改内容并且与前面的label编号一一对应。 [ &#34;nose&#34;, &#34;left_eye&#34;, &#34;right_eye&#34;, &#34;left_ear&#34;, &#34;right_ear&#34;, &#34;left_shoulder&#34;, &#34;right_shoulder&#34;, &#34;left_elbow&#34;, &#34;right_elbow&#34;, &#34;left_wrist&#34;, &#34;right_wrist&#34;, &#34;left_hip&#34;, &#34;right_hip&#34;, &#34;left_knee&#34;, &#34;right_knee&#34;, &#34;left_ankle&#34;, &#34;right_ankle&#34; ], &#34;skeleton&#34;: [ [16, 14], [14, 12], [17, 15], [15, 13], [12, 13], [6, 12], [7, 13], [6, 7], [6, 8], [7, 9], [8, 10], [9, 11], [2, 3], [1, 2], [1, 3], [2, 4], [3, 5], [4, 6], [5, 7] ] json_file[-17:-5]#这是为了取文件的名称，比如000000000001，如果文件名称变了，则需要修改 json_file[-17:-4]#这是为了取文件的名称，比如000000000001.">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-12-07T16:30:33+08:00">
    <meta property="article:modified_time" content="2022-12-07T16:30:33+08:00">

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
  


</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="编程大咖" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">编程大咖</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Yolopose关键点检测：自己标注数据集，制作数据集(一)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言</h2> 
<p>最近实习需要搞的工程涉及到姿态估计，对这2天的学习做一下总结归纳，第一步就是准备数据集，查资料后发现window环境下使用的标注软件就是labelme（coco-annotator好像就可以直接输出coco格式的JSON文件，后期继续学习），labelme产出的JSON文件需要转换到coco格式的JSON文件，然后将JSON文件转成Yolo需要的txt文件，才能送工程进行训练，转来转去的个人感觉非常麻烦。<br> 本博文主要内容是分享关键点的labelme2coco——JSON文件转换，cocoJSON2cocotxt的转换，以及coco_kpts文件夹的内容布局。</p> 
<h2><a id="labelme_3"></a>一、labelme标注关键点的使用：</h2> 
<p>用labelme标注关键点与后续的labelme2coco转换代码息息相关，假设标注对象是人体，关键点有17个：“nose”,“left_eye”, “right_eye”,“left_ear”, “right_ear”,“left_shoulder”, “right_shoulder”,“left_elbow”, “right_elbow”,“left_wrist”, “right_wrist”,“left_hip”, “right_hip”,“left_knee”, “right_knee”,“left_ankle”, “right_ankle”，label编号从1依次排到17，然后再把人用rectangle框出来label编号为bbox(Yolopose是需要画框的，并且numclass已经固定好了为person)，所有的Group id都不用写，JSON文件会自动补上null但不影响我们后续操作，填写label及Group id的界面如下图所示：<br> <img src="https://images2.imgbox.com/df/09/4DwHi3PY_o.png" alt="在这里插入图片描述"><br> 选取一张图片，把17个关键点都标注出来，再把人框出来，如果对象显示半个身体，不满17个关键点，也无所谓，没有哪个部位就把那个部位标注数值空出来就可以了，一张图片操作结束后，就如下图所示：<br> <img src="https://images2.imgbox.com/44/1c/vSO9uzKA_o.png" alt="在这里插入图片描述"><br> coco图片的格式是12位数字，标注完后的JSON文件用相同的名称命名即可。<br> <img src="https://images2.imgbox.com/ed/d7/xQsXDZec_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/54/26/2lRWn0fH_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="labelme2coco_keypointspy_10"></a>二、labelme2coco_keypoints.py</h2> 
<p>CSDN上的其他转换代码，我都没法直接跑，也没有相关的讲解，于是我就拿了现有的代码修改了一些，并记录了我的学习过程。先介绍一下哪些部分需要修改的，然后在附上整个代码，以17个人体关键点标注好的JSON文件为例。</p> 
<pre><code class="prism language-c"><span class="token string">"keypoints"</span><span class="token operator">:</span>#这是固定的，要是其他的关键点标注，则需要修改内容并且与前面的label编号一一对应。
                    <span class="token punctuation">[</span>
                        <span class="token string">"nose"</span><span class="token punctuation">,</span>
                        <span class="token string">"left_eye"</span><span class="token punctuation">,</span> <span class="token string">"right_eye"</span><span class="token punctuation">,</span>
                        <span class="token string">"left_ear"</span><span class="token punctuation">,</span> <span class="token string">"right_ear"</span><span class="token punctuation">,</span>
                        <span class="token string">"left_shoulder"</span><span class="token punctuation">,</span> <span class="token string">"right_shoulder"</span><span class="token punctuation">,</span>
                        <span class="token string">"left_elbow"</span><span class="token punctuation">,</span> <span class="token string">"right_elbow"</span><span class="token punctuation">,</span>
                        <span class="token string">"left_wrist"</span><span class="token punctuation">,</span> <span class="token string">"right_wrist"</span><span class="token punctuation">,</span>
                        <span class="token string">"left_hip"</span><span class="token punctuation">,</span> <span class="token string">"right_hip"</span><span class="token punctuation">,</span>
                        <span class="token string">"left_knee"</span><span class="token punctuation">,</span> <span class="token string">"right_knee"</span><span class="token punctuation">,</span>
                        <span class="token string">"left_ankle"</span><span class="token punctuation">,</span> <span class="token string">"right_ankle"</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">"skeleton"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>
                <span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-c">json_file<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">17</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span>#这是为了取文件的名称，比如<span class="token number">000000000001</span>，如果文件名称变了，则需要修改
json_file<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">17</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span>#这是为了取文件的名称，比如<span class="token number">000000000001.</span><span class="token punctuation">(</span>多一个<span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre> 
<p>keypoints 里面放的是（x,y,v）：x，y是坐标值，v一般取2，0代表没有该点，1代表该点存在但是被遮挡了，2代表该点存在且没有被遮挡。(具体可以参考coco数据集的格式，本文主要介绍如何应用)</p> 
<pre><code class="prism language-c">keypoints <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token number">17</span>  #这里是我们标注的关节点个数  如有改动，需要修改
</code></pre> 
<pre><code class="prism language-c">json_path <span class="token operator">=</span> r<span class="token char">'E:\val2017\Json'</span>   #存放需要转换的json文件夹，变动需要修改
</code></pre> 
<pre><code class="prism language-c">c <span class="token operator">=</span> <span class="token function">tococo</span><span class="token punctuation">(</span>json_path<span class="token punctuation">,</span> save_path<span class="token operator">=</span>r<span class="token char">'E:\val2017\annotations\val.json'</span><span class="token punctuation">,</span> a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  #输出的地址及名称，变动需要修改
</code></pre> 
<p>整个代码如下，可以做到一个文件夹下所有的JSON文件一起转换并输出一个coco格式的JSON文件</p> 
<pre><code class="prism language-c">import numpy as np
import json
import glob
import codecs
import os

class <span class="token function">MyEncoder</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>JSONEncoder<span class="token punctuation">)</span><span class="token operator">:</span>
    def <span class="token keyword">default</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token function">isinstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> np<span class="token punctuation">.</span>integer<span class="token punctuation">)</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token keyword">int</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
        elif <span class="token function">isinstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> np<span class="token punctuation">.</span>floating<span class="token punctuation">)</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token keyword">float</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
        elif <span class="token function">isinstance</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">)</span><span class="token operator">:</span>
            <span class="token keyword">return</span> obj<span class="token punctuation">.</span><span class="token function">tolist</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token function">super</span><span class="token punctuation">(</span>MyEncoder<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>


class <span class="token function">tococo</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token operator">:</span>
    def <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> jsonfile<span class="token punctuation">,</span> save_path<span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token operator">:</span>
        self<span class="token punctuation">.</span>images <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>categories <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token string">"supercategory"</span><span class="token operator">:</span> <span class="token string">"person"</span><span class="token punctuation">,</span>
                <span class="token string">"id"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token string">"name"</span><span class="token operator">:</span> <span class="token string">"person"</span><span class="token punctuation">,</span>
                <span class="token string">"keypoints"</span><span class="token operator">:</span>
                    <span class="token punctuation">[</span>
                        <span class="token string">"nose"</span><span class="token punctuation">,</span>
                        <span class="token string">"left_eye"</span><span class="token punctuation">,</span> <span class="token string">"right_eye"</span><span class="token punctuation">,</span>
                        <span class="token string">"left_ear"</span><span class="token punctuation">,</span> <span class="token string">"right_ear"</span><span class="token punctuation">,</span>
                        <span class="token string">"left_shoulder"</span><span class="token punctuation">,</span> <span class="token string">"right_shoulder"</span><span class="token punctuation">,</span>
                        <span class="token string">"left_elbow"</span><span class="token punctuation">,</span> <span class="token string">"right_elbow"</span><span class="token punctuation">,</span>
                        <span class="token string">"left_wrist"</span><span class="token punctuation">,</span> <span class="token string">"right_wrist"</span><span class="token punctuation">,</span>
                        <span class="token string">"left_hip"</span><span class="token punctuation">,</span> <span class="token string">"right_hip"</span><span class="token punctuation">,</span>
                        <span class="token string">"left_knee"</span><span class="token punctuation">,</span> <span class="token string">"right_knee"</span><span class="token punctuation">,</span>
                        <span class="token string">"left_ankle"</span><span class="token punctuation">,</span> <span class="token string">"right_ankle"</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string">"skeleton"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>annotations <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>jsonfile <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">listdir</span><span class="token punctuation">(</span>jsonfile<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>save_path <span class="token operator">=</span> save_path  # 保存json的路径
        self<span class="token punctuation">.</span>class_id <span class="token operator">=</span> a  # class  我们的类别只有一个 person
        self<span class="token punctuation">.</span>coco <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>path <span class="token operator">=</span> jsonfile

    def <span class="token function">labelme_to_coco</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">for</span> num<span class="token punctuation">,</span> json_file in <span class="token function">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>jsonfile<span class="token punctuation">)</span><span class="token operator">:</span>
            json_file <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>path<span class="token punctuation">,</span> json_file<span class="token punctuation">)</span>
            data <span class="token operator">=</span> codecs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>json_file<span class="token punctuation">,</span> <span class="token char">'r'</span><span class="token punctuation">)</span>
            data <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>images<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token function">get_images</span><span class="token punctuation">(</span>json_file<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">17</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token char">'jpg'</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">"imageHeight"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">"imageWidth"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            shapes <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"shapes"</span><span class="token punctuation">]</span>
            annotation <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  # 一个annotation代表一张图片中的所有samples
            num_keypoints <span class="token operator">=</span> <span class="token number">0</span>
            keypoints <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token number">17</span>  #这里是我们标注的关节点个数  如有改动，需要修改
            flag <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> shape in shapes<span class="token operator">:</span>
                <span class="token keyword">if</span> shape<span class="token punctuation">[</span><span class="token char">'shape_type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'rectangle'</span> or shape<span class="token punctuation">[</span><span class="token string">"label"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'bbox'</span><span class="token operator">:</span>
                    bbox <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
                    temp <span class="token operator">=</span> shape<span class="token punctuation">[</span><span class="token string">"points"</span><span class="token punctuation">]</span>
                    try<span class="token operator">:</span>
                        x_min <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>temp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> temp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    except IndexError as e<span class="token operator">:</span>
                        <span class="token function">print</span><span class="token punctuation">(</span><span class="token char">'class: {}, image: {}'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>class_id<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span>json_file<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">17</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

                    x_max <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>temp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> temp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    y_min <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>temp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> temp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    y_max <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>temp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> temp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    bbox<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>x_min<span class="token punctuation">)</span>
                    bbox<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>y_min<span class="token punctuation">)</span>
                    w <span class="token operator">=</span> x_max <span class="token operator">-</span> x_min <span class="token operator">+</span> <span class="token number">1</span>
                    h <span class="token operator">=</span> y_max <span class="token operator">-</span> y_min <span class="token operator">+</span> <span class="token number">1</span>
                    bbox<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span>
                    bbox<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span>
                    annotation<span class="token punctuation">[</span><span class="token char">'bbox'</span><span class="token punctuation">]</span> <span class="token operator">=</span> bbox
                    flag <span class="token operator">=</span> flag <span class="token operator">+</span> <span class="token number">1</span>
                <span class="token keyword">else</span><span class="token operator">:</span>
                    idx <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>shape<span class="token punctuation">[</span><span class="token char">'label'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

                    try<span class="token operator">:</span>
                        keypoints<span class="token punctuation">[</span><span class="token punctuation">(</span>idx <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> shape<span class="token punctuation">[</span><span class="token char">'points'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                        keypoints<span class="token punctuation">[</span><span class="token punctuation">(</span>idx <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> shape<span class="token punctuation">[</span><span class="token char">'points'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
                        keypoints<span class="token punctuation">[</span><span class="token punctuation">(</span>idx <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span>
                        num_keypoints <span class="token operator">=</span> num_keypoints <span class="token operator">+</span> <span class="token number">1</span>
                    except IndexError as e<span class="token operator">:</span>
                        <span class="token function">print</span><span class="token punctuation">(</span><span class="token char">'class: {}, image: {}'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>class_id<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">(</span>json_file<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">17</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token keyword">if</span> flag <span class="token operator">==</span> <span class="token number">0</span><span class="token operator">:</span>
                <span class="token function">print</span><span class="token punctuation">(</span><span class="token char">'{}\\{} does not contain bbox\n'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>class_id<span class="token punctuation">,</span> json_file<span class="token punctuation">)</span><span class="token punctuation">)</span>
            annotation<span class="token punctuation">[</span><span class="token char">'segmentation'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
            annotation<span class="token punctuation">[</span><span class="token char">'num_keypoints'</span><span class="token punctuation">]</span> <span class="token operator">=</span> num_keypoints
            annotation<span class="token punctuation">[</span><span class="token char">'iscrowd'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
            annotation<span class="token punctuation">[</span><span class="token char">'keypoints'</span><span class="token punctuation">]</span> <span class="token operator">=</span> keypoints
            annotation<span class="token punctuation">[</span><span class="token char">'image_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>json_file<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">17</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  # 对应的图片ID
            <span class="token keyword">if</span> <span class="token char">'bbox'</span> not in annotation<span class="token operator">:</span>
                annotation<span class="token punctuation">[</span><span class="token char">'bbox'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token char">'imageWidth'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token char">'imageHeight'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
                annotation<span class="token punctuation">[</span><span class="token char">'area'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">else</span><span class="token operator">:</span>
                annotation<span class="token punctuation">[</span><span class="token char">'area'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>bbox<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> bbox<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            annotation<span class="token punctuation">[</span><span class="token char">'category_id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
            annotation<span class="token punctuation">[</span><span class="token char">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>json_file<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">17</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  # 对象id
            self<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>annotation<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>image_id <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>json_file<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">17</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>coco<span class="token punctuation">[</span><span class="token string">"images"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>images
        self<span class="token punctuation">.</span>coco<span class="token punctuation">[</span><span class="token string">"categories"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>categories
        self<span class="token punctuation">.</span>coco<span class="token punctuation">[</span><span class="token string">"annotations"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>annotations



    def <span class="token function">get_images</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> height<span class="token punctuation">,</span> width<span class="token punctuation">)</span><span class="token operator">:</span>
        image <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        image<span class="token punctuation">[</span><span class="token string">"height"</span><span class="token punctuation">]</span> <span class="token operator">=</span> height
        image<span class="token punctuation">[</span><span class="token char">'width'</span><span class="token punctuation">]</span> <span class="token operator">=</span> width
        image<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">(</span>filename<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">16</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        image<span class="token punctuation">[</span><span class="token string">"file_name"</span><span class="token punctuation">]</span> <span class="token operator">=</span> filename
        <span class="token keyword">return</span> image

    def <span class="token function">get_categories</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> class_id<span class="token punctuation">)</span><span class="token operator">:</span>
        category <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        category<span class="token punctuation">[</span><span class="token string">"supercategory"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"person"</span>
        category<span class="token punctuation">[</span><span class="token char">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> class_id
        category<span class="token punctuation">[</span><span class="token char">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> name
        <span class="token keyword">return</span> category

    def <span class="token function">save_json</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token operator">:</span>
        self<span class="token punctuation">.</span><span class="token function">labelme_to_coco</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        coco_data <span class="token operator">=</span> self<span class="token punctuation">.</span>coco
        # 保存json文件
        json<span class="token punctuation">.</span><span class="token function">dump</span><span class="token punctuation">(</span>coco_data<span class="token punctuation">,</span> <span class="token function">open</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>save_path<span class="token punctuation">,</span> <span class="token char">'w'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> cls<span class="token operator">=</span>MyEncoder<span class="token punctuation">)</span>  # indent<span class="token operator">=</span><span class="token number">4</span> 更加美观显示
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>image_id


json_path <span class="token operator">=</span> r<span class="token char">'E:\val2017\Json_old'</span>   #保存json的文件夹路径
c <span class="token operator">=</span> <span class="token function">tococo</span><span class="token punctuation">(</span>json_path<span class="token punctuation">,</span> save_path<span class="token operator">=</span>r<span class="token char">'E:\val2017\annotations_old\val.json'</span><span class="token punctuation">,</span> a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  #我们将我们的左右json文件合成为一个json文件，这是最后json文件的名称
image_id <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">save_json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>本人将5个JSON文件放在同一个文件夹下运行转换代码，最后val.json通过VS2022(其他软件也可以)打开后内容如下所示：<br> <img src="https://images2.imgbox.com/c5/30/Bo7AoPlD_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="coco_apicocoJSON_226"></a>三、coco api来检查coco格式的JSON文件是否有问题</h2> 
<pre><code class="prism language-c"># <span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin python3
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">encoding</span>    <span class="token expression"><span class="token operator">:</span> utf<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span></span></span>
# @author     <span class="token operator">:</span>   liangjian
# @software   <span class="token operator">:</span> PyCharm
# @file       <span class="token operator">:</span>   <span class="token number">0408.</span>py
# @Time       <span class="token operator">:</span>   <span class="token number">2021</span><span class="token operator">/</span><span class="token number">4</span><span class="token operator">/</span><span class="token number">8</span> <span class="token number">21</span><span class="token operator">:</span><span class="token number">51</span>
import skimage<span class="token punctuation">.</span>io as io
import pylab
import time as time
import json
import numpy as np
from collections import defaultdict
import itertools
import matplotlib<span class="token punctuation">.</span>pyplot as plt
from matplotlib<span class="token punctuation">.</span>collections import PatchCollection


def <span class="token function">_isArrayLike</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">return</span> <span class="token function">hasattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token char">'__iter__'</span><span class="token punctuation">)</span> and <span class="token function">hasattr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token char">'__len__'</span><span class="token punctuation">)</span>


class COCO<span class="token operator">:</span>
    def <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> annotation_file<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token string">""</span>"
        Constructor of Microsoft COCO helper class <span class="token keyword">for</span> reading and visualizing annotations<span class="token punctuation">.</span>
        <span class="token operator">:</span>param <span class="token function">annotation_file</span> <span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token operator">:</span> location of annotation file
        <span class="token operator">:</span>param <span class="token function">image_folder</span> <span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token operator">:</span> location to the folder that hosts images<span class="token punctuation">.</span>
        <span class="token operator">:</span><span class="token keyword">return</span><span class="token operator">:</span>
        <span class="token string">""</span>"
        <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">load</span> <span class="token expression">dataset</span></span>
        self<span class="token punctuation">.</span>dataset<span class="token punctuation">,</span> self<span class="token punctuation">.</span>anns<span class="token punctuation">,</span> self<span class="token punctuation">.</span>cats<span class="token punctuation">,</span> self<span class="token punctuation">.</span>imgs <span class="token operator">=</span> <span class="token function">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>imgToAnns<span class="token punctuation">,</span> self<span class="token punctuation">.</span>catToImgs <span class="token operator">=</span> <span class="token function">defaultdict</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">defaultdict</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>
        <span class="token keyword">if</span> not annotation_file <span class="token operator">==</span> None<span class="token operator">:</span>
            <span class="token function">print</span><span class="token punctuation">(</span>'loading annotations into memory<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>'<span class="token punctuation">)</span>
            tic <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            dataset <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token function">open</span><span class="token punctuation">(</span>annotation_file<span class="token punctuation">,</span> <span class="token char">'r'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            assert <span class="token function">type</span><span class="token punctuation">(</span>dataset<span class="token punctuation">)</span> <span class="token operator">==</span> dict<span class="token punctuation">,</span> 'annotation file format <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> not supported'<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>dataset<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token char">'Done (t={:0.2f}s)'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> tic<span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>dataset <span class="token operator">=</span> dataset
            self<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    def <span class="token function">createIndex</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">create</span> <span class="token expression">index</span></span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token char">'creating index...'</span><span class="token punctuation">)</span>
        anns<span class="token punctuation">,</span> cats<span class="token punctuation">,</span> imgs <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        imgToAnns<span class="token punctuation">,</span> catToImgs <span class="token operator">=</span> <span class="token function">defaultdict</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">defaultdict</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token char">'annotations'</span> in self<span class="token punctuation">.</span>dataset<span class="token operator">:</span>
            <span class="token keyword">for</span> ann in self<span class="token punctuation">.</span>dataset<span class="token punctuation">[</span><span class="token char">'annotations'</span><span class="token punctuation">]</span><span class="token operator">:</span>
                imgToAnns<span class="token punctuation">[</span>ann<span class="token punctuation">[</span><span class="token char">'image_id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>ann<span class="token punctuation">)</span>
                anns<span class="token punctuation">[</span>ann<span class="token punctuation">[</span><span class="token char">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> ann

        <span class="token keyword">if</span> <span class="token char">'images'</span> in self<span class="token punctuation">.</span>dataset<span class="token operator">:</span>
            <span class="token keyword">for</span> img in self<span class="token punctuation">.</span>dataset<span class="token punctuation">[</span><span class="token char">'images'</span><span class="token punctuation">]</span><span class="token operator">:</span>
                imgs<span class="token punctuation">[</span>img<span class="token punctuation">[</span><span class="token char">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> img

        <span class="token keyword">if</span> <span class="token char">'categories'</span> in self<span class="token punctuation">.</span>dataset<span class="token operator">:</span>
            <span class="token keyword">for</span> cat in self<span class="token punctuation">.</span>dataset<span class="token punctuation">[</span><span class="token char">'categories'</span><span class="token punctuation">]</span><span class="token operator">:</span>
                cats<span class="token punctuation">[</span>cat<span class="token punctuation">[</span><span class="token char">'id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> cat

        <span class="token keyword">if</span> <span class="token char">'annotations'</span> in self<span class="token punctuation">.</span>dataset and <span class="token char">'categories'</span> in self<span class="token punctuation">.</span>dataset<span class="token operator">:</span>
            <span class="token keyword">for</span> ann in self<span class="token punctuation">.</span>dataset<span class="token punctuation">[</span><span class="token char">'annotations'</span><span class="token punctuation">]</span><span class="token operator">:</span>
                catToImgs<span class="token punctuation">[</span>ann<span class="token punctuation">[</span><span class="token char">'category_id'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>ann<span class="token punctuation">[</span><span class="token char">'image_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token function">print</span><span class="token punctuation">(</span><span class="token char">'index created!'</span><span class="token punctuation">)</span>

        <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">create</span> <span class="token expression">class members</span></span>
        self<span class="token punctuation">.</span>anns <span class="token operator">=</span> anns
        self<span class="token punctuation">.</span>imgToAnns <span class="token operator">=</span> imgToAnns
        self<span class="token punctuation">.</span>catToImgs <span class="token operator">=</span> catToImgs
        self<span class="token punctuation">.</span>imgs <span class="token operator">=</span> imgs
        self<span class="token punctuation">.</span>cats <span class="token operator">=</span> cats

    def <span class="token function">getCatIds</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> catNms<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> supNms<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> catIds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token string">""</span>"
        filtering parameters<span class="token punctuation">.</span> <span class="token keyword">default</span> skips that filter<span class="token punctuation">.</span>
        <span class="token operator">:</span>param <span class="token function">catNms</span> <span class="token punctuation">(</span>str array<span class="token punctuation">)</span>  <span class="token operator">:</span> get cats <span class="token keyword">for</span> given cat names
        <span class="token operator">:</span>param <span class="token function">supNms</span> <span class="token punctuation">(</span>str array<span class="token punctuation">)</span>  <span class="token operator">:</span> get cats <span class="token keyword">for</span> given supercategory names
        <span class="token operator">:</span>param <span class="token function">catIds</span> <span class="token punctuation">(</span><span class="token keyword">int</span> array<span class="token punctuation">)</span>  <span class="token operator">:</span> get cats <span class="token keyword">for</span> given cat ids
        <span class="token operator">:</span><span class="token keyword">return</span><span class="token operator">:</span> <span class="token function">ids</span> <span class="token punctuation">(</span><span class="token keyword">int</span> array<span class="token punctuation">)</span>   <span class="token operator">:</span> integer array of cat ids
        <span class="token string">""</span>"
        catNms <span class="token operator">=</span> catNms <span class="token keyword">if</span> <span class="token function">_isArrayLike</span><span class="token punctuation">(</span>catNms<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">[</span>catNms<span class="token punctuation">]</span>
        supNms <span class="token operator">=</span> supNms <span class="token keyword">if</span> <span class="token function">_isArrayLike</span><span class="token punctuation">(</span>supNms<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">[</span>supNms<span class="token punctuation">]</span>
        catIds <span class="token operator">=</span> catIds <span class="token keyword">if</span> <span class="token function">_isArrayLike</span><span class="token punctuation">(</span>catIds<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">[</span>catIds<span class="token punctuation">]</span>

        <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>catNms<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">len</span><span class="token punctuation">(</span>supNms<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">len</span><span class="token punctuation">(</span>catIds<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token operator">:</span>
            cats <span class="token operator">=</span> self<span class="token punctuation">.</span>dataset<span class="token punctuation">[</span><span class="token char">'categories'</span><span class="token punctuation">]</span>

        <span class="token keyword">else</span><span class="token operator">:</span>
            cats <span class="token operator">=</span> self<span class="token punctuation">.</span>dataset<span class="token punctuation">[</span><span class="token char">'categories'</span><span class="token punctuation">]</span>
            <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">print</span><span class="token expression"><span class="token punctuation">(</span></span><span class="token char">' '</span><span class="token expression"><span class="token punctuation">)</span></span></span>
            <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">print</span><span class="token expression"><span class="token punctuation">(</span></span><span class="token char">'keypoints的cat就只有人1种'</span><span class="token expression"><span class="token punctuation">)</span></span></span>
            <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">print</span><span class="token expression"><span class="token punctuation">(</span>cats<span class="token punctuation">)</span></span></span>
            cats <span class="token operator">=</span> cats <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>catNms<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">[</span>cat <span class="token keyword">for</span> cat in cats <span class="token keyword">if</span> cat<span class="token punctuation">[</span><span class="token char">'name'</span><span class="token punctuation">]</span> in catNms<span class="token punctuation">]</span>
            cats <span class="token operator">=</span> cats <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>supNms<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">[</span>cat <span class="token keyword">for</span> cat in cats <span class="token keyword">if</span> cat<span class="token punctuation">[</span><span class="token char">'supercategory'</span><span class="token punctuation">]</span> in supNms<span class="token punctuation">]</span>
            cats <span class="token operator">=</span> cats <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>catIds<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">[</span>cat <span class="token keyword">for</span> cat in cats <span class="token keyword">if</span> cat<span class="token punctuation">[</span><span class="token char">'id'</span><span class="token punctuation">]</span> in catIds<span class="token punctuation">]</span>
            <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">print</span><span class="token expression"><span class="token punctuation">(</span>cats<span class="token punctuation">)</span></span></span>
        ids <span class="token operator">=</span> <span class="token punctuation">[</span>cat<span class="token punctuation">[</span><span class="token char">'id'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> cat in cats<span class="token punctuation">]</span>
        <span class="token keyword">return</span> ids

    def <span class="token function">loadCats</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ids<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token string">""</span>"
        Load cats with the specified ids<span class="token punctuation">.</span>
        <span class="token operator">:</span>param <span class="token function">ids</span> <span class="token punctuation">(</span><span class="token keyword">int</span> array<span class="token punctuation">)</span>       <span class="token operator">:</span> integer ids specifying cats
        <span class="token operator">:</span><span class="token keyword">return</span><span class="token operator">:</span> <span class="token function">cats</span> <span class="token punctuation">(</span>object array<span class="token punctuation">)</span> <span class="token operator">:</span> loaded cat objects
        <span class="token string">""</span>"
        <span class="token keyword">if</span> <span class="token function">_isArrayLike</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>cats<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token keyword">for</span> id in ids<span class="token punctuation">]</span>
        elif <span class="token function">type</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">int</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>cats<span class="token punctuation">[</span>ids<span class="token punctuation">]</span><span class="token punctuation">]</span>

    def <span class="token function">getImgIds</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> imgIds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> catIds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token char">''</span>'
        Get img ids that satisfy given filter conditions<span class="token punctuation">.</span>
        <span class="token operator">:</span>param <span class="token function">imgIds</span> <span class="token punctuation">(</span><span class="token keyword">int</span> array<span class="token punctuation">)</span> <span class="token operator">:</span> get imgs <span class="token keyword">for</span> given ids
        <span class="token operator">:</span>param <span class="token function">catIds</span> <span class="token punctuation">(</span><span class="token keyword">int</span> array<span class="token punctuation">)</span> <span class="token operator">:</span> get imgs with all given cats
        <span class="token operator">:</span><span class="token keyword">return</span><span class="token operator">:</span> <span class="token function">ids</span> <span class="token punctuation">(</span><span class="token keyword">int</span> array<span class="token punctuation">)</span>  <span class="token operator">:</span> integer array of img ids
        <span class="token char">''</span>'
        imgIds <span class="token operator">=</span> imgIds <span class="token keyword">if</span> <span class="token function">_isArrayLike</span><span class="token punctuation">(</span>imgIds<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">[</span>imgIds<span class="token punctuation">]</span>
        catIds <span class="token operator">=</span> catIds <span class="token keyword">if</span> <span class="token function">_isArrayLike</span><span class="token punctuation">(</span>catIds<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">[</span>catIds<span class="token punctuation">]</span>

        <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>imgIds<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">len</span><span class="token punctuation">(</span>catIds<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token operator">:</span>
            ids <span class="token operator">=</span> self<span class="token punctuation">.</span>imgs<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token operator">:</span>
            ids <span class="token operator">=</span> <span class="token function">set</span><span class="token punctuation">(</span>imgIds<span class="token punctuation">)</span>
            <span class="token keyword">for</span> i<span class="token punctuation">,</span> catId in <span class="token function">enumerate</span><span class="token punctuation">(</span>catIds<span class="token punctuation">)</span><span class="token operator">:</span>
                <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span> and <span class="token function">len</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token operator">:</span>
                    ids <span class="token operator">=</span> <span class="token function">set</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>catToImgs<span class="token punctuation">[</span>catId<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token operator">:</span>
                    ids <span class="token operator">&amp;=</span> <span class="token function">set</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>catToImgs<span class="token punctuation">[</span>catId<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">list</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span>

    def <span class="token function">loadImgs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ids<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token string">""</span>"
        Load anns with the specified ids<span class="token punctuation">.</span>
        <span class="token operator">:</span>param <span class="token function">ids</span> <span class="token punctuation">(</span><span class="token keyword">int</span> array<span class="token punctuation">)</span>       <span class="token operator">:</span> integer ids specifying img
        <span class="token operator">:</span><span class="token keyword">return</span><span class="token operator">:</span> <span class="token function">imgs</span> <span class="token punctuation">(</span>object array<span class="token punctuation">)</span> <span class="token operator">:</span> loaded img objects
        <span class="token string">""</span>"
        <span class="token keyword">if</span> <span class="token function">_isArrayLike</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>imgs<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token keyword">for</span> id in ids<span class="token punctuation">]</span>
        elif <span class="token function">type</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">int</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>imgs<span class="token punctuation">[</span>ids<span class="token punctuation">]</span><span class="token punctuation">]</span>

    def <span class="token function">getAnnIds</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> imgIds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> catIds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> areaRng<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> iscrowd<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token string">""</span>"
        Get ann ids that satisfy given filter conditions<span class="token punctuation">.</span> <span class="token keyword">default</span> skips that filter
        <span class="token operator">:</span>param <span class="token function">imgIds</span>  <span class="token punctuation">(</span><span class="token keyword">int</span> array<span class="token punctuation">)</span>     <span class="token operator">:</span> get anns <span class="token keyword">for</span> given imgs
               <span class="token function">catIds</span>  <span class="token punctuation">(</span><span class="token keyword">int</span> array<span class="token punctuation">)</span>     <span class="token operator">:</span> get anns <span class="token keyword">for</span> given cats
               <span class="token function">areaRng</span> <span class="token punctuation">(</span><span class="token keyword">float</span> array<span class="token punctuation">)</span>   <span class="token operator">:</span> get anns <span class="token keyword">for</span> given area <span class="token function">range</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>g<span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token number">0</span> inf<span class="token punctuation">]</span><span class="token punctuation">)</span>
               <span class="token function">iscrowd</span> <span class="token punctuation">(</span>boolean<span class="token punctuation">)</span>       <span class="token operator">:</span> get anns <span class="token keyword">for</span> given crowd <span class="token function">label</span> <span class="token punctuation">(</span>False or True<span class="token punctuation">)</span>
        <span class="token operator">:</span><span class="token keyword">return</span><span class="token operator">:</span> <span class="token function">ids</span> <span class="token punctuation">(</span><span class="token keyword">int</span> array<span class="token punctuation">)</span>       <span class="token operator">:</span> integer array of ann ids
        <span class="token string">""</span>"
        imgIds <span class="token operator">=</span> imgIds <span class="token keyword">if</span> <span class="token function">_isArrayLike</span><span class="token punctuation">(</span>imgIds<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">[</span>imgIds<span class="token punctuation">]</span>
        catIds <span class="token operator">=</span> catIds <span class="token keyword">if</span> <span class="token function">_isArrayLike</span><span class="token punctuation">(</span>catIds<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">[</span>catIds<span class="token punctuation">]</span>

        <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>imgIds<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">len</span><span class="token punctuation">(</span>catIds<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">len</span><span class="token punctuation">(</span>areaRng<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token operator">:</span>
            anns <span class="token operator">=</span> self<span class="token punctuation">.</span>dataset<span class="token punctuation">[</span><span class="token char">'annotations'</span><span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token operator">:</span>
            # 根据imgIds找到所有的ann
            <span class="token keyword">if</span> not <span class="token function">len</span><span class="token punctuation">(</span>imgIds<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token operator">:</span>
                lists <span class="token operator">=</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>imgToAnns<span class="token punctuation">[</span>imgId<span class="token punctuation">]</span> <span class="token keyword">for</span> imgId in imgIds <span class="token keyword">if</span> imgId in self<span class="token punctuation">.</span>imgToAnns<span class="token punctuation">]</span>
                anns <span class="token operator">=</span> <span class="token function">list</span><span class="token punctuation">(</span>itertools<span class="token punctuation">.</span>chain<span class="token punctuation">.</span><span class="token function">from_iterable</span><span class="token punctuation">(</span>lists<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token operator">:</span>
                anns <span class="token operator">=</span> self<span class="token punctuation">.</span>dataset<span class="token punctuation">[</span><span class="token char">'annotations'</span><span class="token punctuation">]</span>
            # 通过各类条件如catIds对anns进行筛选
            anns <span class="token operator">=</span> anns <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>catIds<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">[</span>ann <span class="token keyword">for</span> ann in anns <span class="token keyword">if</span> ann<span class="token punctuation">[</span><span class="token char">'category_id'</span><span class="token punctuation">]</span> in catIds<span class="token punctuation">]</span>
            anns <span class="token operator">=</span> anns <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>areaRng<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token punctuation">[</span>ann <span class="token keyword">for</span> ann in anns <span class="token keyword">if</span>
                                                   ann<span class="token punctuation">[</span><span class="token char">'area'</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> areaRng<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> and ann<span class="token punctuation">[</span><span class="token char">'area'</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> areaRng<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> not iscrowd <span class="token operator">==</span> None<span class="token operator">:</span>
            ids <span class="token operator">=</span> <span class="token punctuation">[</span>ann<span class="token punctuation">[</span><span class="token char">'id'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> ann in anns <span class="token keyword">if</span> ann<span class="token punctuation">[</span><span class="token char">'iscrowd'</span><span class="token punctuation">]</span> <span class="token operator">==</span> iscrowd<span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token operator">:</span>

            ids <span class="token operator">=</span> <span class="token punctuation">[</span>ann<span class="token punctuation">[</span><span class="token char">'id'</span><span class="token punctuation">]</span> <span class="token keyword">for</span> ann in anns<span class="token punctuation">]</span>
        <span class="token keyword">return</span> ids

    def <span class="token function">loadAnns</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ids<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token string">""</span>"
        Load anns with the specified ids<span class="token punctuation">.</span>
        <span class="token operator">:</span>param <span class="token function">ids</span> <span class="token punctuation">(</span><span class="token keyword">int</span> array<span class="token punctuation">)</span>       <span class="token operator">:</span> integer ids specifying anns
        <span class="token operator">:</span><span class="token keyword">return</span><span class="token operator">:</span> <span class="token function">anns</span> <span class="token punctuation">(</span>object array<span class="token punctuation">)</span> <span class="token operator">:</span> loaded ann objects
        <span class="token string">""</span>"
        <span class="token keyword">if</span> <span class="token function">_isArrayLike</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>anns<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token keyword">for</span> id in ids<span class="token punctuation">]</span>
        elif <span class="token function">type</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">int</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>anns<span class="token punctuation">[</span>ids<span class="token punctuation">]</span><span class="token punctuation">]</span>

    def <span class="token function">showAnns</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> anns<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token string">""</span>"
        Display the specified annotations<span class="token punctuation">.</span>
        <span class="token operator">:</span>param <span class="token function">anns</span> <span class="token punctuation">(</span>array of object<span class="token punctuation">)</span><span class="token operator">:</span> annotations to display
        <span class="token operator">:</span><span class="token keyword">return</span><span class="token operator">:</span> None
        <span class="token string">""</span>"
        <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>anns<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token number">0</span>
        <span class="token keyword">if</span> <span class="token char">'segmentation'</span> in anns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> or <span class="token char">'keypoints'</span> in anns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">:</span>
            datasetType <span class="token operator">=</span> <span class="token char">'instances'</span>
        elif <span class="token char">'caption'</span> in anns<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">:</span>
            datasetType <span class="token operator">=</span> <span class="token char">'captions'</span>
        <span class="token keyword">else</span><span class="token operator">:</span>
            raise <span class="token function">Exception</span><span class="token punctuation">(</span><span class="token char">'datasetType not supported'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> datasetType <span class="token operator">==</span> <span class="token char">'instances'</span><span class="token operator">:</span>
            ax <span class="token operator">=</span> plt<span class="token punctuation">.</span><span class="token function">gca</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            ax<span class="token punctuation">.</span><span class="token function">set_autoscale_on</span><span class="token punctuation">(</span>False<span class="token punctuation">)</span>
            polygons <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            color <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> ann in anns<span class="token operator">:</span>
                c <span class="token operator">=</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.6</span> <span class="token operator">+</span> <span class="token number">0.4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tolist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">if</span> <span class="token char">'segmentation'</span> <span class="token expression">in ann<span class="token operator">:</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>     <span class="token directive keyword">if</span> <span class="token expression"><span class="token function">type</span><span class="token punctuation">(</span>ann<span class="token punctuation">[</span></span><span class="token char">'segmentation'</span><span class="token expression"><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> list<span class="token operator">:</span></span></span>
                #         # polygon
                <span class="token macro property"><span class="token directive-hash">#</span>         <span class="token directive keyword">for</span> <span class="token expression">seg in ann<span class="token punctuation">[</span></span><span class="token char">'segmentation'</span><span class="token expression"><span class="token punctuation">]</span><span class="token operator">:</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>             <span class="token directive keyword">poly</span> <span class="token expression"><span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>seg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reshape</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>seg<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>             <span class="token directive keyword">polygons</span><span class="token expression"><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">Polygon</span><span class="token punctuation">(</span>poly<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>             <span class="token directive keyword">color</span><span class="token expression"><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>     <span class="token directive keyword">else</span><span class="token expression"><span class="token operator">:</span></span></span>
                #         # mask
                <span class="token macro property"><span class="token directive-hash">#</span>         <span class="token directive keyword">t</span> <span class="token expression"><span class="token operator">=</span> self<span class="token punctuation">.</span>imgs<span class="token punctuation">[</span>ann<span class="token punctuation">[</span></span><span class="token char">'image_id'</span><span class="token expression"><span class="token punctuation">]</span><span class="token punctuation">]</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>         <span class="token directive keyword">if</span> <span class="token expression"><span class="token function">type</span><span class="token punctuation">(</span>ann<span class="token punctuation">[</span></span><span class="token char">'segmentation'</span><span class="token expression"><span class="token punctuation">]</span><span class="token punctuation">[</span></span><span class="token char">'counts'</span><span class="token expression"><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> list<span class="token operator">:</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>             <span class="token directive keyword">rle</span> <span class="token expression"><span class="token operator">=</span> maskUtils<span class="token punctuation">.</span><span class="token function">frPyObjects</span><span class="token punctuation">(</span><span class="token punctuation">[</span>ann<span class="token punctuation">[</span></span><span class="token char">'segmentation'</span><span class="token expression"><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">[</span></span><span class="token char">'height'</span><span class="token expression"><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">[</span></span><span class="token char">'width'</span><span class="token expression"><span class="token punctuation">]</span><span class="token punctuation">)</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>         <span class="token directive keyword">else</span><span class="token expression"><span class="token operator">:</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>             <span class="token directive keyword">rle</span> <span class="token expression"><span class="token operator">=</span> <span class="token punctuation">[</span>ann<span class="token punctuation">[</span></span><span class="token char">'segmentation'</span><span class="token expression"><span class="token punctuation">]</span><span class="token punctuation">]</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>         <span class="token directive keyword">m</span> <span class="token expression"><span class="token operator">=</span> maskUtils<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>rle<span class="token punctuation">)</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>         <span class="token directive keyword">img</span> <span class="token expression"><span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">ones</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> m<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">(</span>余下全部）<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span>（from <span class="token number">1</span>， <span class="token number">10</span>张取一张）<span class="token punctuation">)</span> <span class="token punctuation">)</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>         <span class="token directive keyword">if</span> <span class="token expression">ann<span class="token punctuation">[</span></span><span class="token char">'iscrowd'</span><span class="token expression"><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">(</span>余下全部）<span class="token operator">:</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>             <span class="token directive keyword">color</span><span class="token expression">_mask <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2.0</span><span class="token punctuation">,</span><span class="token number">166.0</span><span class="token punctuation">,</span><span class="token number">101.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">255</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>         <span class="token directive keyword">if</span> <span class="token expression">ann<span class="token punctuation">[</span></span><span class="token char">'iscrowd'</span><span class="token expression"><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token operator">:</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>             <span class="token directive keyword">color</span><span class="token expression">_mask <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">(</span>余下全部）<span class="token punctuation">,</span> <span class="token number">3</span>（from <span class="token number">1</span>， <span class="token number">10</span>张取一张）<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">tolist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>         <span class="token directive keyword">for</span> <span class="token expression">i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">3</span>（from <span class="token number">1</span>， <span class="token number">10</span>张取一张）<span class="token punctuation">)</span><span class="token operator">:</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>             <span class="token directive keyword">img</span><span class="token expression"><span class="token punctuation">[</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> color_mask<span class="token punctuation">[</span>i<span class="token punctuation">]</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span>         <span class="token directive keyword">ax</span><span class="token expression"><span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token function">dstack</span><span class="token punctuation">(</span> <span class="token punctuation">(</span>img<span class="token punctuation">,</span> m<span class="token operator">*</span><span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
                <span class="token keyword">if</span> <span class="token char">'keypoints'</span> in ann and <span class="token function">type</span><span class="token punctuation">(</span>ann<span class="token punctuation">[</span><span class="token char">'keypoints'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> list<span class="token operator">:</span>
                    <span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">turn</span> <span class="token expression">skeleton into zero<span class="token operator">-</span>based index</span></span>
                    sks <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token function">loadCats</span><span class="token punctuation">(</span>ann<span class="token punctuation">[</span><span class="token char">'category_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token char">'skeleton'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
                    kp <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span>ann<span class="token punctuation">[</span><span class="token char">'keypoints'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    x <span class="token operator">=</span> kp<span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">::</span><span class="token number">3</span><span class="token punctuation">]</span>
                    y <span class="token operator">=</span> kp<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">::</span><span class="token number">3</span><span class="token punctuation">]</span>
                    v <span class="token operator">=</span> kp<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">::</span><span class="token number">3</span><span class="token punctuation">]</span>
                    <span class="token keyword">for</span> sk in sks<span class="token operator">:</span>
                        <span class="token keyword">if</span> np<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span>sk<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">:</span>
                        #     # 画点之间的连接线
                            plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>sk<span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span>sk<span class="token punctuation">]</span><span class="token punctuation">,</span> linewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> color<span class="token operator">=</span>c<span class="token punctuation">)</span>
                    # 画点
                    plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>v <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span>v <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token char">'o'</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> markerfacecolor<span class="token operator">=</span>c<span class="token punctuation">,</span> markeredgecolor<span class="token operator">=</span><span class="token char">'k'</span><span class="token punctuation">,</span>
                             markeredgewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
                    plt<span class="token punctuation">.</span><span class="token function">plot</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span>v <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span>v <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token char">'o'</span><span class="token punctuation">,</span> markersize<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> markerfacecolor<span class="token operator">=</span>c<span class="token punctuation">,</span> markeredgecolor<span class="token operator">=</span>c<span class="token punctuation">,</span>
                             markeredgewidth<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
            p <span class="token operator">=</span> <span class="token function">PatchCollection</span><span class="token punctuation">(</span>polygons<span class="token punctuation">,</span> facecolor<span class="token operator">=</span>color<span class="token punctuation">,</span> linewidths<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> alpha<span class="token operator">=</span><span class="token number">0.4</span><span class="token punctuation">)</span>
            ax<span class="token punctuation">.</span><span class="token function">add_collection</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
            p <span class="token operator">=</span> <span class="token function">PatchCollection</span><span class="token punctuation">(</span>polygons<span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token char">'none'</span><span class="token punctuation">,</span> edgecolors<span class="token operator">=</span>color<span class="token punctuation">,</span> linewidths<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
            ax<span class="token punctuation">.</span><span class="token function">add_collection</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
        elif datasetType <span class="token operator">==</span> <span class="token char">'captions'</span><span class="token operator">:</span>
            <span class="token keyword">for</span> ann in anns<span class="token operator">:</span>
                <span class="token function">print</span><span class="token punctuation">(</span>ann<span class="token punctuation">[</span><span class="token char">'caption'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


pylab<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token char">'figure.figsize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span>

annFile <span class="token operator">=</span> r<span class="token char">'E:\val2017\annotations_old\val.json'</span>     #转换之后的json文件路径
img_prefix <span class="token operator">=</span> r<span class="token char">'E:\val2017'</span>	#图片文件夹路径

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">initialize</span> <span class="token expression">COCO api <span class="token keyword">for</span> instance annotations</span></span>
coco <span class="token operator">=</span> <span class="token function">COCO</span><span class="token punctuation">(</span>annFile<span class="token punctuation">)</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">get</span><span class="token expression"><span class="token function">CatIds</span><span class="token punctuation">(</span>catNms<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> supNms<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> catIds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span></span>
# 通过输入类别的名字、大类的名字或是种类的id，来筛选得到图片所属类别的id
catIds <span class="token operator">=</span> coco<span class="token punctuation">.</span><span class="token function">getCatIds</span><span class="token punctuation">(</span>catNms<span class="token operator">=</span><span class="token punctuation">[</span><span class="token char">'person'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">get</span><span class="token expression"><span class="token function">ImgIds</span><span class="token punctuation">(</span>imgIds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> catIds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span></span>
# 通过图片的id或是所属种类的id得到图片的id
imgIds <span class="token operator">=</span> coco<span class="token punctuation">.</span><span class="token function">getImgIds</span><span class="token punctuation">(</span>catIds<span class="token operator">=</span>catIds<span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">img</span><span class="token expression">Ids <span class="token operator">=</span> coco<span class="token punctuation">.</span><span class="token function">getImgIds</span><span class="token punctuation">(</span>imgIds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1407</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span></span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">load</span><span class="token expression"><span class="token function">Imgs</span><span class="token punctuation">(</span>ids<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span></span>
# 得到图片的id信息后，就可以用loadImgs得到图片的信息了
# 在这里我们随机选取之前list中的一张图片
img <span class="token operator">=</span> coco<span class="token punctuation">.</span><span class="token function">loadImgs</span><span class="token punctuation">(</span>imgIds<span class="token punctuation">[</span>np<span class="token punctuation">.</span>random<span class="token punctuation">.</span><span class="token function">randint</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>imgIds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
I <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">imread</span><span class="token punctuation">(</span><span class="token char">'%s/%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>img_prefix<span class="token punctuation">,</span> img<span class="token punctuation">[</span><span class="token char">'file_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">axis</span><span class="token punctuation">(</span><span class="token char">'off'</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> plt<span class="token punctuation">.</span><span class="token function">gca</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">get</span><span class="token expression"><span class="token function">AnnIds</span><span class="token punctuation">(</span>imgIds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> catIds<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> areaRng<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> iscrowd<span class="token operator">=</span>None<span class="token punctuation">)</span></span></span>
# 通过输入图片的id、类别的id、实例的面积、是否是人群来得到图片的注释id
annIds <span class="token operator">=</span> coco<span class="token punctuation">.</span><span class="token function">getAnnIds</span><span class="token punctuation">(</span>imgIds<span class="token operator">=</span>img<span class="token punctuation">[</span><span class="token char">'id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> catIds<span class="token operator">=</span>catIds<span class="token punctuation">,</span> iscrowd<span class="token operator">=</span>None<span class="token punctuation">)</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">load</span><span class="token expression"><span class="token function">Anns</span><span class="token punctuation">(</span>ids<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></span></span>
# 通过注释的id，得到注释的信息
anns <span class="token operator">=</span> coco<span class="token punctuation">.</span><span class="token function">loadAnns</span><span class="token punctuation">(</span>annIds<span class="token punctuation">)</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token char">'anns:'</span><span class="token punctuation">,</span> anns<span class="token punctuation">)</span>

coco<span class="token punctuation">.</span><span class="token function">showAnns</span><span class="token punctuation">(</span>anns<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span>I<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">axis</span><span class="token punctuation">(</span><span class="token char">'off'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>需要修改的地方为</p> 
<pre><code class="prism language-c">annFile <span class="token operator">=</span> r<span class="token char">'E:\val2017\annotations\val.json'</span>     #转换之后的coco格式json文件路径
img_prefix <span class="token operator">=</span> r<span class="token char">'E:\val2017'</span>	#图片文件夹路径
</code></pre> 
<p>如果不出意外的话，就不会出现意外了，可以看到你标注的效果如下图所示：<br> <img src="https://images2.imgbox.com/01/7e/jj13YUbP_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_529"></a>总结</h2> 
<p>至此，labelme下的JSON转coco格式的JSON就完成了，由于篇幅问题，coco格式的JSON转yolo需要的txt相关介绍，在Yolopose关键点检测：自己标注数据集，制作数据集(二)中有相关讲解。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d0b815a4a5388ce6716faa2a3b6ec4cc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SpringBoot3整合MyBatis报错：Property ‘sqlSessionFactory‘ or ‘sqlSessionTemplate‘ are required</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d170f3e0acd19d4516ac75d3ebc10d7d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">转义序列字符(\0,\n,\r,\t,\v,\a,\f,\b,\\,\‘,\“,\?)详解，转义字符对应的全称，输出结果和对应的ASCII码值详解；</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 编程大咖.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://www.w3counter.com/tracker.js?id=151347"></script>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>